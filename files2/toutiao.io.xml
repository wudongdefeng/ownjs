<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>96eadc4a735d167c81cd620a3af88417</guid>
<title>è¿™å¯èƒ½æ˜¯æœ€è½»é‡é«˜æ•ˆçš„è¿ç»´ç›‘æ§å·¥å…·ï¼šå¼€æº WGCLOUD</title>
<link>https://toutiao.io/k/l55l3jp</link>
<content:encoded>&lt;div&gt;&lt;div&gt;
  &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>574431334596030377dab76f757b056b</guid>
<title>å¾’æ‰‹ç”¨ Go å†™ä¸ª Redis æœåŠ¡å™¨</title>
<link>https://toutiao.io/k/t9ic9wp</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.66640625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/xBgIbW1vdNPWkD6xmM3YDpLKRk9icwRvyvo6aWc1Pz3duHADKROA748khObVndvFBt9tZwTqMfIKZ876WHEDibww/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;span&gt;ä½œè€…ï¼šHDT3213&lt;br/&gt;&lt;/span&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥çš„å¼€æºé¡¹ç›®æ˜¯ Godisï¼šä¸€ä¸ªç”¨ Go è¯­è¨€å®ç°çš„ Redis æœåŠ¡å™¨ã€‚æ”¯æŒï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;5 ç§æ•°æ®ç»“æ„ï¼ˆstringã€listã€hashã€setã€sortedsetï¼‰&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è‡ªåŠ¨è¿‡æœŸï¼ˆTTLï¼‰&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å‘å¸ƒè®¢é˜…ã€åœ°ç†ä½ç½®ã€æŒä¹…åŒ–ç­‰åŠŸèƒ½&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.2294736842105263&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNPWkD6xmM3YDpLKRk9icwRvyyIuib3RuttVFnsljC8XwPgicGkL1zibBcKKAhTERZRwKnzEaesYZhcfXQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1900&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½ æˆ–è®¸ä¸éœ€è¦è‡ªå·±å®ç° Redis æœåŠ¡ï¼Œä½†ä½ æ˜¯å¦åŒçƒ¦äº†æ¯å¤©éƒ½æ˜¯å†™å¢åˆ æ”¹æŸ¥çš„ä¸šåŠ¡ä»£ç ï¼Œæƒ³æé«˜ç¼–ç¨‹æ°´å¹³è¯•å›¾ä»é›¶å†™ä¸ªé¡¹ç›®æ‰“å¼€ IDE å´å‘ç°æ— ä»ä¸‹æ‰‹ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åŠ¨æ‰‹é€ è½®å­ä¸€å®šæ˜¯æé«˜ç¼–ç¨‹èƒ½åŠ›çš„å¥½åŠæ³•ï¼Œä¸‹é¢å°±å¸¦å¤§å®¶ç”¨ Go ä»é›¶å¼€å§‹å†™ä¸€ä¸ª Redis æœåŠ¡å™¨ï¼ˆGodisï¼‰ï¼Œä»ä¸­ä½ å°†å­¦åˆ°ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å¦‚ä½•ç¼–å†™ Go è¯­è¨€ TCP æœåŠ¡å™¨&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è®¾è®¡å¹¶å®ç°å®‰å…¨å¯é çš„é€šä¿¡åè®®ï¼ˆredis åè®®ï¼‰&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦‚ä½•ä½¿ç”¨ Go è¯­è¨€å¼€å‘é«˜å¹¶å‘ç¨‹åº&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è®¾è®¡å’Œå®ç°åˆ†å¸ƒå¼é›†ç¾¤ä»¥åŠåˆ†å¸ƒå¼äº‹åŠ¡&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç†Ÿæ‚‰é“¾è¡¨ã€å“ˆå¸Œè¡¨ã€è·³è¡¨ä»¥åŠæ—¶é—´è½®ç­‰å¸¸ç”¨æ•°æ®ç»“æ„&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åƒä¸‡ä¸è¦æ‹…å¿ƒå†…å®¹å¤ªéš¾ï¼ï¼è™½ç„¶ç¤ºä¾‹ä»£ç æ˜¯ Goï¼Œä½†å°±ç®—ä½ ä¸ä¼š Go è¯­è¨€ä¹Ÿä¸ä¼šå½±å“ä½ ç†è§£ Redis çš„åŸç†å’Œåº•å±‚åè®®ä»¥åŠé«˜æ€§èƒ½çš„ç§˜å¯†ã€‚è€Œä¸”ä½œè€…ä¸ºäº†ç…§é¡¾åˆ°å¹¿å¤§è¯»è€…ï¼Œå¯¹æŠ€æœ¯çš„è®²è§£åšäº†ä¼˜åŒ–ã€‚ç¤ºä¾‹ä»£ç åœ¨åŸé¡¹ç›®åŸºç¡€ä¸Šåšäº†ç®€åŒ–ï¼Œå¹¶é€è¡Œåœ°åŠ äº†æ³¨é‡Šã€‚å¦‚æœæ˜¯é«˜çº§ç©å®¶ï¼Œè¯·ç›´æ¥è®¿é—®é¡¹ç›®é˜…è¯»æºç ï¼š&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;https://github.com/HDT3213/godis&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸‹é¢è®©æˆ‘ä»¬ä¸€èµ·æ‹¨å¼€ Redis çš„è¿·é›¾ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;ä¸€ã€å†™ä¸ª TCP æœåŠ¡å™¨&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¼—æ‰€å‘¨çŸ¥ Redis æ˜¯ C/S æ¨¡å‹ï¼Œä½¿ç”¨ TCP åè®®è¿›è¡Œé€šä¿¡ã€‚æ¥ä¸‹æ¥å°±ä»å®ç° TCP æœåŠ¡ç«¯å¼€å§‹ã€‚ä½œä¸ºå¹¿æ³›ç”¨äºæœåŠ¡ç«¯çš„ç¼–ç¨‹è¯­è¨€ Golang æä¾›äº†éå¸¸ç®€æ´çš„ TCP æ¥å£ï¼Œæ‰€ä»¥å®ç°èµ·æ¥ååˆ†æ–¹ä¾¿ã€‚ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;ListenAndServe&lt;/span&gt;&lt;span&gt;(addressÂ &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â ç»‘å®šç›‘å¬åœ°å€&lt;/span&gt;&lt;br/&gt;Â Â Â Â listener,Â errÂ :=Â net.Listen(&lt;span&gt;&quot;tcp&quot;&lt;/span&gt;,Â address)&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â log.Fatal(fmt.Sprintf(&lt;span&gt;&quot;listenÂ err:Â %v&quot;&lt;/span&gt;,Â err))&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;defer&lt;/span&gt;Â listener.Close()&lt;br/&gt;Â Â Â Â log.Println(fmt.Sprintf(&lt;span&gt;&quot;bind:Â %s,Â startÂ listening...&quot;&lt;/span&gt;,Â address))&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â AcceptÂ ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰æ–°çš„è¿æ¥å»ºç«‹æˆ–è€…listenä¸­æ–­æ‰ä¼šè¿”å›&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â conn,Â errÂ :=Â listener.Accept()&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â é€šå¸¸æ˜¯ç”±äºlistenerè¢«å…³é—­æ— æ³•ç»§ç»­ç›‘å¬å¯¼è‡´çš„é”™è¯¯&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â log.Fatal(fmt.Sprintf(&lt;span&gt;&quot;acceptÂ err:Â %v&quot;&lt;/span&gt;,Â err))&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â å¼€å¯æ–°çš„Â goroutineÂ å¤„ç†è¯¥è¿æ¥&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;go&lt;/span&gt;Â Handle(conn)&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;Handle&lt;/span&gt;&lt;span&gt;(connÂ net.Conn)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â readerÂ :=Â bufio.NewReader(conn)&lt;br/&gt;Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â ReadStringÂ ä¼šä¸€ç›´é˜»å¡ç›´åˆ°é‡åˆ°åˆ†éš”ç¬¦Â &#x27;\n&#x27;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â é‡åˆ°åˆ†éš”ç¬¦åÂ ReadStringÂ ä¼šè¿”å›ä¸Šæ¬¡é‡åˆ°åˆ†éš”ç¬¦åˆ°ç°åœ¨æ”¶åˆ°çš„æ‰€æœ‰æ•°æ®&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â è‹¥åœ¨é‡åˆ°åˆ†éš”ç¬¦ä¹‹å‰å‘ç”Ÿå¼‚å¸¸,Â ReadStringÂ ä¼šè¿”å›å·²æ”¶åˆ°çš„æ•°æ®å’Œé”™è¯¯ä¿¡æ¯&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â msg,Â errÂ :=Â reader.ReadString(&lt;span&gt;&#x27;\n&#x27;&lt;/span&gt;)&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â é€šå¸¸é‡åˆ°çš„é”™è¯¯æ˜¯è¿æ¥ä¸­æ–­æˆ–è¢«å…³é—­ï¼Œç”¨io.EOFè¡¨ç¤º&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ ==Â io.EOFÂ {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â log.Println(&lt;span&gt;&quot;connectionÂ close&quot;&lt;/span&gt;)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â log.Println(err)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â bÂ :=Â []&lt;span&gt;byte&lt;/span&gt;(msg)&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â å°†æ”¶åˆ°çš„ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â conn.Write(b)&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â ListenAndServe(&lt;span&gt;&quot;:8000&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ğŸ‘Œ è‡³æ­¤åªç”¨äº† 40 è¡Œä»£ç å°±æå®šæœåŠ¡ç«¯å•¦ï¼å¯åŠ¨ä¸Šé¢çš„ TCP æœåŠ¡åï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥ &lt;code&gt;telnet 127.0.0.1 8000&lt;/code&gt; å°±å¯ä»¥è¿æ¥åˆ°åˆšå†™å¥½çš„æœåŠ¡å™¨ï¼Œå®ƒä¼šå°†ä½ å‘é€çš„æ¶ˆæ¯åŸæ ·è¿”å›ç»™ä½ ï¼ˆæ‰€ä»¥è¯·ä¸è¦éª‚å®ƒï¼‰ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.2675925925925926&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNPWkD6xmM3YDpLKRk9icwRvyuibu0TPqyuw0zws5DwMnC0m4dRic0QxoiaqrxVsC3ZxU93z9qGVx6licKA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ª TCP æœåŠ¡å™¨çš„éå¸¸ç®€å•ï¼Œä¸»åç¨‹è°ƒç”¨ accept å‡½æ•°æ¥ç›‘å¬ç«¯å£ï¼Œæ¥å—æ–°è¿æ¥åå¼€å¯ä¸€ä¸ª Goroutine æ¥å¤„ç†å®ƒã€‚è¿™ç§ç®€å•çš„é˜»å¡ IO æ¨¡å‹æœ‰äº›ç±»ä¼¼äºæ—©æœŸçš„ Tomcat/Apache æœåŠ¡å™¨ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é˜»å¡ IO æ¨¡å‹æ˜¯ä½¿ç”¨&lt;strong&gt;ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥&lt;/strong&gt;ï¼Œåœ¨æ²¡æœ‰æ”¶åˆ°æ–°æ•°æ®æ—¶ç›‘å¬çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°æ•°æ®å°±ç»ªåçº¿ç¨‹è¢«å”¤é†’è¿›è¡Œå¤„ç†ã€‚å› ä¸ºé˜»å¡ IO æ¨¡å‹éœ€è¦å¼€å¯å¤§é‡çº¿ç¨‹å¹¶ä¸”é¢‘ç¹åœ°è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€ä»¥å®ƒçš„æ•ˆç‡å¾ˆä½ã€‚è€Œ Redis ä½¿ç”¨çš„ epoll æŠ€æœ¯ï¼ˆIO å¤šè·¯å¤ç”¨ï¼‰ç”¨&lt;strong&gt;ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤§é‡è¿æ¥&lt;/strong&gt;ï¼Œæå¤§åœ°æé«˜äº†ååé‡ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„ TCP æœåŠ¡å™¨ä¼šæ¯” Redis æ…¢å¾ˆå¤šå—ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“ç„¶ä¸ä¼šï¼ŒGolang åˆ©ç”¨ Goroutine è°ƒåº¦å¼€é”€è¿œè¿œå°äºçº¿ç¨‹è°ƒåº¦å¼€é”€çš„ä¼˜åŠ¿å°è£…å‡º &lt;code&gt;goroutine-per-connection&lt;/code&gt; é£æ ¼çš„æç®€æ¥å£ï¼Œè€Œä¸” net/tcp åº“å°† epoll å°è£…æˆäº†é˜»å¡ IO çš„æ ·å­ï¼Œåœ¨äº«å— epoll é«˜æ€§èƒ½çš„åŒæ—¶é¿å…äº†åŸç”Ÿ epoll æ¥å£æ‰€éœ€çš„å¤æ‚å¼‚æ­¥ä»£ç ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨ä½œè€…çš„ç”µè„‘ä¸Š Redis æ¯ç§’å¯ä»¥å“åº” 10.6k ä¸ª PING å‘½ä»¤ï¼Œè€Œ Godisï¼ˆå®Œæ•´ä»£ç ï¼‰ çš„ååé‡ä¸º 9.2 kqps ç›¸å·®å¹¶ä¸å¤§ã€‚æƒ³äº†è§£æ›´å¤š Golang é«˜æ€§èƒ½çš„ãŠ™ï¸å¯†ï¼Œå¯ä»¥æœç´¢ &lt;code&gt;go netpoller&lt;/code&gt; æˆ–è€… &lt;code&gt;go è¯­è¨€ ç½‘ç»œè½®è¯¢å™¨&lt;/code&gt; å…³é”®å­—&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦å¤–ï¼Œåˆæ ¼çš„ TCP çš„æœåŠ¡å™¨åœ¨å…³é—­çš„æ—¶å€™ä¸åº”è¯¥ä¸€åœäº†ä¹‹ï¼Œè€Œéœ€è¦å®Œæˆå“åº”å·²æ¥æ”¶çš„è¯·æ±‚ã€é‡Šæ”¾ TCP è¿æ¥ç­‰å¿…è¦çš„æ¸…ç†å·¥ä½œã€‚è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬ä¸€èˆ¬ç§°ä¸º &lt;code&gt;ä¼˜é›…å…³é—­&lt;/code&gt; æˆ–è€… &lt;code&gt;graceful shutdown&lt;/code&gt;ï¼Œä¼˜é›…å…³é—­æ­¥éª¤ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;é¦–å…ˆï¼Œå…³é—­ listener åœæ­¢æ¥å—æ–°è¿æ¥&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç„¶åï¼Œéå†æ‰€æœ‰å­˜æ´»è¿æ¥é€ä¸ªå…³é—­&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¼˜é›…å…³é—­çš„ä»£ç æ¯”è¾ƒå¤šï¼Œè¿™é‡Œå°±ä¸å®Œæ•´è´´å‡ºäº†ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;äºŒã€é€è§† Redis åè®®&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨è§£å†³å®Œé€šä¿¡åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ææ¸…æ¥š Redis çš„åè®®ï¼Œå…¶å®å°±æ˜¯ä¸€å¥—åºåˆ—åŒ–åè®®ç±»ä¼¼ JSONã€Protocol Buffersï¼Œä½ çœ‹åº•å±‚å…¶å®ä¹Ÿå°±æ˜¯ä¸€äº›åŸºç¡€çš„çŸ¥è¯†ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è‡ª Redis 2.0 ä»¥åçš„é€šä¿¡ç»Ÿä¸€ä¸º RESP åè®®ï¼ˆREdis Serialization Protocol)ï¼Œè¯¥åè®®æ˜“äºå®ç°ä¸ä»…å¯ä»¥é«˜æ•ˆçš„è¢«ç¨‹åºè§£æï¼Œè¿˜èƒ½å¤Ÿè¢«äººç±»è¯»æ‡‚å®¹æ˜“è°ƒè¯•ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;RESP æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å®‰å…¨çš„æ–‡æœ¬åè®®ï¼Œå·¥ä½œäº TCP åè®®ä¸Šã€‚RESP ä»¥è¡Œä½œä¸ºå•ä½ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘é€çš„å‘½ä»¤æˆ–æ•°æ®ä¸€å¾‹ä»¥ &lt;code&gt;\r\n&lt;/code&gt;ï¼ˆCRLFï¼‰ä½œä¸ºæ¢è¡Œç¬¦ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;äºŒè¿›åˆ¶å®‰å…¨æ˜¯æŒ‡å…è®¸åè®®ä¸­å‡ºç°ä»»æ„å­—ç¬¦è€Œä¸ä¼šå¯¼è‡´æ•…éšœã€‚æ¯”å¦‚ C è¯­è¨€çš„å­—ç¬¦ä¸²ä»¥ &lt;code&gt;\0&lt;/code&gt; ä½œä¸ºç»“å°¾ä¸å…è®¸å­—ç¬¦ä¸²ä¸­é—´å‡ºç° &lt;code&gt;\0&lt;/code&gt;ï¼Œè€Œ Go è¯­è¨€çš„ string åˆ™å…è®¸å‡ºç° &lt;code&gt;\0&lt;/code&gt;ï¼Œæˆ‘ä»¬è¯´ Go è¯­è¨€çš„ string æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œè€Œ C è¯­è¨€å­—ç¬¦ä¸²ä¸æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;RESP çš„äºŒè¿›åˆ¶å®‰å…¨æ€§å…è®¸æˆ‘ä»¬åœ¨ key æˆ–è€… value ä¸­åŒ…å« &lt;code&gt;\r&lt;/code&gt; æˆ–è€… &lt;code&gt;\n&lt;/code&gt; è¿™æ ·çš„ç‰¹æ®Šå­—ç¬¦ã€‚åœ¨ä½¿ç”¨ Redis å­˜å‚¨ protobufã€msgpack ç­‰äºŒè¿›åˆ¶æ•°æ®æ—¶ï¼ŒäºŒè¿›åˆ¶å®‰å…¨æ€§å°¤ä¸ºé‡è¦ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;RESP å®šä¹‰äº† 5 ç§æ ¼å¼ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ç®€å•å­—ç¬¦ä¸²ï¼ˆSimple Stringï¼‰ï¼šæœåŠ¡å™¨ç”¨æ¥è¿”å›ç®€å•çš„ç»“æœï¼Œæ¯”å¦‚ &quot;OK&quot; éäºŒè¿›åˆ¶å®‰å…¨ï¼Œä¸”ä¸å…è®¸æ¢è¡Œ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;é”™è¯¯ä¿¡æ¯ï¼ˆErrorï¼‰ï¼šæœåŠ¡å™¨ç”¨æ¥è¿”å›ç®€å•çš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ &quot;ERR Invalid Synatx&quot; éäºŒè¿›åˆ¶å®‰å…¨ï¼Œä¸”ä¸å…è®¸æ¢è¡Œ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ•´æ•°ï¼ˆIntegerï¼‰ï¼šllenã€scard ç­‰å‘½ä»¤çš„è¿”å›å€¼ï¼Œ64 ä½æœ‰ç¬¦å·æ•´æ•°&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å­—ç¬¦ä¸²ï¼ˆBulk Stringï¼‰ï¼šäºŒè¿›åˆ¶å®‰å…¨å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ get ç­‰å‘½ä»¤çš„è¿”å›å€¼&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ•°ç»„ï¼ˆArrayï¼Œåˆç§° Multi Bulk Stringsï¼‰ï¼šBulk String æ•°ç»„ï¼Œå®¢æˆ·ç«¯å‘é€æŒ‡ä»¤ä»¥åŠ lrange ç­‰å‘½ä»¤å“åº”çš„æ ¼å¼&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;RESP é€šè¿‡ç¬¬ä¸€ä¸ªå­—ç¬¦æ¥è¡¨ç¤ºæ ¼å¼ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ç®€å•å­—ç¬¦ä¸²ï¼šä»¥&quot;+&quot; å¼€å§‹ï¼Œ å¦‚ï¼š&quot;+OK\r\n&quot;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;é”™è¯¯ï¼šä»¥&quot;-&quot; å¼€å§‹ï¼Œå¦‚ï¼š&quot;-ERR Invalid Synatx\r\n&quot;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ•´æ•°ï¼šä»¥&quot;:&quot;å¼€å§‹ï¼Œå¦‚ï¼š&quot;:1\r\n&quot;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å­—ç¬¦ä¸²ï¼šä»¥ &lt;code&gt;$&lt;/code&gt; å¼€å§‹&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ•°ç»„ï¼šä»¥ &lt;code&gt;*&lt;/code&gt; å¼€å§‹&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸‹é¢è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…ä¾‹å­æ¥ç†è§£åè®®ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.1 å­—ç¬¦ä¸²&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å­—ç¬¦ä¸²ï¼ˆBulk Stringï¼‰æœ‰ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œä¸º &lt;code&gt;$&lt;/code&gt;+æ­£æ–‡é•¿åº¦ï¼Œç¬¬äºŒè¡Œä¸ºå®é™…å†…å®¹ã€‚å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;$3&lt;/span&gt;\r\nSET\r\n&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å­—ç¬¦ä¸²ï¼ˆBulk Stringï¼‰æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œå°±æ˜¯è¯´å¯ä»¥åœ¨ Bulk String å†…éƒ¨åŒ…å« &quot;\r\n&quot; å­—ç¬¦ï¼ˆè¡Œå°¾çš„ CRLF è¢«éšè—ï¼‰ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;$4&lt;/span&gt;&lt;br/&gt;a\r\nb&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.2 ç©º&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;$-1&lt;/code&gt; è¡¨ç¤º nilï¼Œæ¯”å¦‚ä½¿ç”¨ get å‘½ä»¤æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„ key æ—¶ï¼Œå“åº”å³ä¸º &lt;code&gt;$-1&lt;/code&gt;ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.3 æ•°ç»„&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ•°ç»„ï¼ˆArrayï¼‰æ ¼å¼ç¬¬ä¸€è¡Œä¸º &quot;*&quot;+æ•°ç»„é•¿åº¦ï¼Œå…¶åæ˜¯ç›¸åº”æ•°é‡çš„ å­—ç¬¦ä¸²ï¼ˆBulk Stringï¼‰ã€‚æ¯”å¦‚ &lt;code&gt;[&quot;foo&quot;, &quot;bar&quot;]&lt;/code&gt; çš„æŠ¥æ–‡ï¼ˆä¼ è¾“æ—¶çš„å†…å®¹ï¼‰ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;*2&lt;br/&gt;&lt;span&gt;$3&lt;/span&gt;&lt;br/&gt;foo&lt;br/&gt;&lt;span&gt;$3&lt;/span&gt;&lt;br/&gt;bar&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å®¢æˆ·ç«¯ä¹Ÿä½¿ç”¨ æ•°ç»„ï¼ˆArrayï¼‰æ ¼å¼å‘æœåŠ¡ç«¯å‘é€æŒ‡ä»¤ã€‚å‘½ä»¤æœ¬èº«å°†ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¯”å¦‚ &lt;code&gt;SET key value&lt;/code&gt; æŒ‡ä»¤çš„ RESP æŠ¥æ–‡ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;*3&lt;br/&gt;&lt;span&gt;$3&lt;/span&gt;&lt;br/&gt;SET&lt;br/&gt;&lt;span&gt;$3&lt;/span&gt;&lt;br/&gt;key&lt;br/&gt;&lt;span&gt;$5&lt;/span&gt;&lt;br/&gt;value&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å°†æ¢è¡Œç¬¦æ‰“å°å‡ºæ¥ï¼š&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;*3\r\n$3\r\nSET\r\n$3\r\nkey\r\n$5\r\nvalue\r\n&lt;/code&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.4 è§£æé¢„å¤‡&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;çŸ¥é“å¸¸ç”¨çš„ RESP æŠ¥æ–‡å†…å®¹åï¼Œå°±å¯ä»¥å¼€å§‹ç€æ‰‹è§£æäº†ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ RESP æ˜¯ &lt;code&gt;äºŒè¿›åˆ¶å®‰å…¨&lt;/code&gt; çš„åè®®ï¼Œå®ƒå…è®¸åœ¨æ­£æ–‡ä¸­ä½¿ç”¨ &lt;code&gt;\r\n&lt;/code&gt; å­—ç¬¦ã€‚ä¸¾ä¾‹æ¥è¯´ Redis å¯ä»¥æ­£ç¡®æ¥æ”¶å¹¶æ‰§è¡Œ &lt;code&gt;SET &quot;a\r\nb&quot; hellogithub&lt;/code&gt; æŒ‡ä»¤ï¼Œè¿™æ¡æŒ‡ä»¤çš„æ­£ç¡®æŠ¥æ–‡æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;*3Â Â &lt;br/&gt;&lt;span&gt;$3&lt;/span&gt;&lt;br/&gt;SET&lt;br/&gt;&lt;span&gt;$4&lt;/span&gt;&lt;br/&gt;a\r\nbÂ &lt;br/&gt;&lt;span&gt;$11&lt;/span&gt;&lt;br/&gt;hellogithub&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“ &lt;code&gt;ReadBytes&lt;/code&gt; è¯»å–åˆ°ç¬¬äº”è¡Œ &quot;a\r\nb\r\n&quot; æ—¶ä¼šå°†å…¶è¯¯è®¤ä¸ºä¸¤è¡Œï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;*3Â Â &lt;br/&gt;&lt;span&gt;$3&lt;/span&gt;&lt;br/&gt;SET&lt;br/&gt;&lt;span&gt;$4&lt;/span&gt;&lt;br/&gt;aÂ Â //Â é”™è¯¯çš„åˆ†è¡Œ&lt;br/&gt;bÂ //Â é”™è¯¯çš„åˆ†è¡Œ&lt;br/&gt;&lt;span&gt;$11&lt;/span&gt;&lt;br/&gt;hellogithub&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å› æ­¤å½“è¯»å–åˆ°ç¬¬å››è¡Œ &lt;code&gt;$4&lt;/code&gt; åï¼Œä¸åº”è¯¥ç»§ç»­ä½¿ç”¨ &lt;code&gt;ReadBytes(&#x27;\n&#x27;)&lt;/code&gt; è¯»å–ä¸‹ä¸€è¡Œï¼Œåº”ä½¿ç”¨ &lt;code&gt;io.ReadFull(reader, msg)&lt;/code&gt; æ–¹æ³•æ¥è¯»å–æŒ‡å®šé•¿åº¦çš„å†…å®¹ã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;msgÂ =Â &lt;span&gt;make&lt;/span&gt;([]&lt;span&gt;byte&lt;/span&gt;,Â &lt;span&gt;4&lt;/span&gt;Â +Â &lt;span&gt;2&lt;/span&gt;)Â &lt;span&gt;//Â æ­£æ–‡é•¿åº¦4Â +Â æ¢è¡Œç¬¦é•¿åº¦2&lt;/span&gt;&lt;br/&gt;_,Â errÂ =Â io.ReadFull(reader,Â msg)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.5 ç¼–å†™ RESP åè®®è§£æå™¨&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è§£å†³å®Œä¸Šé¢å†…å®¹åŒ…å« &quot;\r\n&quot; çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ”¾æ‰‹ç¼–å†™ Redis åè®®è§£æå™¨å•¦ï¼&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â PayloadÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â DataÂ redis.Reply&lt;br/&gt;Â ErrÂ Â error&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â ParseStreamÂ é€šè¿‡Â io.ReaderÂ è¯»å–æ•°æ®å¹¶å°†ç»“æœé€šè¿‡Â channelÂ å°†ç»“æœè¿”å›ç»™è°ƒç”¨è€…&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â æµå¼å¤„ç†çš„æ¥å£é€‚åˆä¾›å®¢æˆ·ç«¯/æœåŠ¡ç«¯ä½¿ç”¨&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;ParseStream&lt;/span&gt;&lt;span&gt;(readerÂ io.Reader)&lt;/span&gt;Â &amp;lt;-&lt;span&gt;chan&lt;/span&gt;Â *&lt;span&gt;Payload&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â chÂ :=Â &lt;span&gt;make&lt;/span&gt;(&lt;span&gt;chan&lt;/span&gt;Â *Payload)&lt;br/&gt;Â &lt;span&gt;go&lt;/span&gt;Â parse0(reader,Â ch)&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â ch&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç”±äºè§£æå™¨çš„ä»£ç æ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªç®€å•åœ°ä»‹ç»ä¸€ä¸‹æ ¸å¿ƒæµç¨‹ã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;parse0&lt;/span&gt;&lt;span&gt;(readerÂ io.Reader,Â chÂ &lt;span&gt;chan&lt;/span&gt;&amp;lt;-Â *Payload)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â åˆå§‹åŒ–è¯»å–çŠ¶æ€&lt;/span&gt;&lt;br/&gt;Â Â Â Â readingMultiLineÂ :=Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â Â Â Â expectedArgsCountÂ :=Â &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;var&lt;/span&gt;Â argsÂ [][]&lt;span&gt;byte&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;var&lt;/span&gt;Â bulkLenÂ &lt;span&gt;int64&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°Â RESPÂ æ˜¯ä»¥è¡Œä¸ºå•ä½çš„&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â å› ä¸ºè¡Œåˆ†ä¸ºç®€å•å­—ç¬¦ä¸²å’ŒäºŒè¿›åˆ¶å®‰å…¨çš„Â BulkStringï¼Œæˆ‘ä»¬éœ€è¦å°è£…ä¸€ä¸ªÂ readLineÂ å‡½æ•°æ¥å…¼å®¹&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â line,Â errÂ =Â readLine(reader,Â bulkLen)&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {Â &lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â å¤„ç†é”™è¯¯&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹åˆšåˆšè¯»å–çš„è¡Œè¿›è¡Œè§£æ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æˆ‘ä»¬ç®€å•çš„å°†Â ReplyÂ åˆ†ä¸ºä¸¤ç±»:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â å•è¡Œ:Â StatusReply,Â IntReply,Â ErrorReply&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â å¤šè¡Œ:Â BulkReply,Â MultiBulkReply&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â !readingMultiLineÂ {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â isMulitBulkHeader(line)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â æˆ‘ä»¬æ”¶åˆ°äº†Â MulitBulkReplyÂ çš„ç¬¬ä¸€è¡Œ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â è·å¾—Â MulitBulkReplyÂ ä¸­Â BulkStringÂ çš„ä¸ªæ•°&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â expectedArgsCountÂ =Â parseMulitBulkHeader(line)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â ç­‰å¾…Â MulitBulkReplyÂ åç»­è¡Œ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â readingMultiLineÂ =Â &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â isBulkHeader(line)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â æˆ‘ä»¬æ”¶åˆ°äº†Â BulkReplyÂ çš„ç¬¬ä¸€è¡Œ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â è·å¾—Â BulkReplyÂ ç¬¬äºŒè¡Œçš„é•¿åº¦,Â é€šè¿‡Â bulkLenÂ å‘Šè¯‰Â readLineÂ å‡½æ•°ä¸‹ä¸€è¡ŒÂ BulkStringÂ çš„é•¿åº¦&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bulkLenÂ =Â parseBulkHeader()&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â è¿™ä¸ªÂ ReplyÂ ä¸­ä¸€å…±æœ‰Â 1Â ä¸ªÂ BulkString&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â expectedArgsCountÂ =Â &lt;span&gt;1&lt;/span&gt;Â &lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â ç­‰å¾…Â BulkReplyÂ åç»­è¡Œ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â readingMultiLineÂ =Â &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â å¤„ç†Â StatusReply,Â IntReply,Â ErrorReplyÂ ç­‰å•è¡ŒÂ Reply&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â replyÂ :=Â parseSingleLineReply(line)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â é€šè¿‡Â chÂ è¿”å›ç»“æœ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â emitReply(ch)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â è¿›å…¥æ­¤åˆ†æ”¯è¯´æ˜æˆ‘ä»¬æ­£åœ¨ç­‰å¾…Â MulitBulkReplyÂ æˆ–Â BulkReplyÂ çš„åç»­è¡Œ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â MulitBulkReplyÂ çš„åç»­è¡Œæœ‰ä¸¤ç§ï¼ŒBulkHeaderÂ æˆ–è€…Â BulkString&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â isBulkHeader(line)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bulkLenÂ =Â parseBulkHeader()&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â æˆ‘ä»¬æ­£åœ¨è¯»å–ä¸€ä¸ªÂ BulkString,Â å®ƒå¯èƒ½æ˜¯Â MulitBulkReplyÂ æˆ–Â BulkReplyÂ &lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â argsÂ =Â &lt;span&gt;append&lt;/span&gt;(args,Â line)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â &lt;span&gt;len&lt;/span&gt;(args)Â ==Â expectedArgsCountÂ {Â &lt;span&gt;//Â æˆ‘ä»¬å·²ç»è¯»å–äº†æ‰€æœ‰åç»­è¡Œ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â é€šè¿‡Â chÂ è¿”å›ç»“æœ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â emitReply(ch)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â é‡ç½®çŠ¶æ€,Â å‡†å¤‡è§£æä¸‹ä¸€æ¡Â Reply&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â readingMultiLineÂ =Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â expectedArgsCountÂ =Â &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â argsÂ =Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bulkLenÂ =Â &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ä¸‰ã€å®ç°å†…å­˜æ•°æ®åº“&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è‡³æ­¤æˆ‘ä»¬å·²ç»æå®šæ•°æ®æ¥æ”¶å’Œè§£æçš„éƒ¨åˆ†äº†ï¼Œå‰©ä¸‹å°±æ˜¯æˆ‘ä»¬åº”è¯¥æŠŠæ•°æ®å­˜åœ¨å“ªé‡Œäº†ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æŠ›å¼€æŒä¹…åŒ–éƒ¨åˆ†ï¼Œä½œä¸ºåŸºäºå†…å­˜çš„ KV æ•°æ®åº“ Redis çš„æ‰€æœ‰æ•°æ®éœ€è¦éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­çš„å“ˆå¸Œè¡¨ï¼Œè€Œè¿™ä¸ªå“ˆå¸Œè¡¨å°±æ˜¯æˆ‘ä»¬ä»Šå¤©éœ€è¦ç¼–å†™çš„æœ€åä¸€ä¸ªç»„ä»¶ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸å•çº¿ç¨‹çš„ Redis ä¸åŒæˆ‘ä»¬å®ç°çš„ Redisï¼ˆgodisï¼‰æ˜¯å¹¶è¡Œå·¥ä½œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è€ƒè™‘å„ç§å¹¶å‘å®‰å…¨é—®é¢˜ã€‚å¸¸è§çš„å¹¶å‘å®‰å…¨å“ˆå¸Œè¡¨è®¾è®¡æœ‰å‡ ç§ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;code&gt;sync.map&lt;/code&gt;ï¼šGolang å®˜æ–¹æä¾›çš„å¹¶å‘å“ˆå¸Œè¡¨ï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚ä½†æ˜¯åœ¨ &lt;code&gt;m.dirty&lt;/code&gt; åˆšè¢«æå‡åä¼šå°† &lt;code&gt;m.read&lt;/code&gt; å¤åˆ¶åˆ°æ–°çš„ &lt;code&gt;m.dirty&lt;/code&gt; ä¸­ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹å¤åˆ¶æ“ä½œä¼šé˜»å¡æ‰€æœ‰åç¨‹ï¼Œå­˜åœ¨è¾ƒå¤§çš„éšæ‚£ã€‚&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;code&gt;juc.ConcurrentHashMap&lt;/code&gt;ï¼šJava çš„å¹¶å‘å“ˆå¸Œè¡¨é‡‡ç”¨åˆ†æ®µé”å®ç°ã€‚åœ¨è¿›è¡Œæ‰©å®¹æ—¶è®¿é—®å“ˆå¸Œè¡¨çº¿ç¨‹éƒ½å°†ååŠ©è¿›è¡Œ rehash æ“ä½œï¼Œåœ¨ rehash ç»“æŸå‰æ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½ä¼šé˜»å¡ã€‚å› ä¸ºç¼“å­˜æ•°æ®åº“ä¸­é”®å€¼å¯¹æ•°é‡å·¨å¤§ä¸”å¯¹è¯»å†™æ“ä½œå“åº”æ—¶é—´è¦æ±‚è¾ƒé«˜ï¼Œä½¿ç”¨ juc çš„ç­–ç•¥æ˜¯ä¸åˆé€‚çš„ã€‚&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;code&gt;memcached hashtable&lt;/code&gt;ï¼šåœ¨åå°çº¿ç¨‹è¿›è¡Œ rehash æ“ä½œæ—¶ï¼Œä¸»çº¿ç¨‹ä¼šåˆ¤æ–­è¦è®¿é—®çš„å“ˆå¸Œæ§½æ˜¯å¦å·²è¢« rehash ä»è€Œå†³å®šæ“ä½œ old_hashtable è¿˜æ˜¯æ“ä½œ new_hashtableã€‚è¿™ç§è®¾è®¡è¢«ç§°ä¸º&lt;strong&gt;æ¸è¿›å¼ rehash&lt;/strong&gt; å®ƒçš„ä¼˜ç‚¹æ˜¯ rehash æ“ä½œåŸºæœ¬ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„è¯»å†™ï¼Œæ˜¯æœ€ç†æƒ³çš„çš„æ–¹æ¡ˆã€‚&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†æ¸è¿›å¼ rehash çš„å®ç°éå¸¸å¤æ‚ï¼Œæ‰€ä»¥ godis é‡‡ç”¨ Golang ç¤¾åŒºå¹¿æ³›ä½¿ç”¨çš„åˆ†æ®µé”ç­–ç•¥ï¼ˆéä¸Šé¢çš„ä¸‰ç§ï¼‰ï¼Œå°±æ˜¯å°† key åˆ†æ•£åˆ°å›ºå®šæ•°é‡çš„ shard ä¸­é¿å…è¿›è¡Œæ•´ä½“ rehash æ“ä½œã€‚shard æ˜¯æœ‰é”ä¿æŠ¤çš„ mapï¼Œå½“ shard è¿›è¡Œ rehash æ—¶ä¼šé˜»å¡ shard å†…çš„è¯»å†™ï¼Œä½†ä¸ä¼šå¯¹å…¶ä»– shard é€ æˆå½±å“ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.5855728429985856&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/xBgIbW1vdNPWkD6xmM3YDpLKRk9icwRvyAgDiaNQU6ny3uGJqrZIhKlT4MLibuX6BWDeHwaAN5BdbYBs7XRhhawgg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;707&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â ConcurrentDictÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â tableÂ []*Shard&lt;br/&gt;Â Â Â Â countÂ &lt;span&gt;int32&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt;Â ShardÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â mÂ Â Â Â Â &lt;span&gt;map&lt;/span&gt;[&lt;span&gt;string&lt;/span&gt;]&lt;span&gt;interface&lt;/span&gt;{}&lt;br/&gt;Â Â Â Â mutexÂ sync.RWMutex&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(dictÂ *ConcurrentDict)&lt;/span&gt;Â &lt;span&gt;spread&lt;/span&gt;&lt;span&gt;(hashCodeÂ &lt;span&gt;uint32&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;uint32&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â tableSizeÂ :=Â &lt;span&gt;uint32&lt;/span&gt;(&lt;span&gt;len&lt;/span&gt;(dict.table))&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â (tableSizeÂ -Â &lt;span&gt;1&lt;/span&gt;)Â &amp;amp;Â &lt;span&gt;uint32&lt;/span&gt;(hashCode)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(dictÂ *ConcurrentDict)&lt;/span&gt;Â &lt;span&gt;getShard&lt;/span&gt;&lt;span&gt;(indexÂ &lt;span&gt;uint32&lt;/span&gt;)&lt;/span&gt;Â *&lt;span&gt;Shard&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â dict.table[index]&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(dictÂ *ConcurrentDict)&lt;/span&gt;Â &lt;span&gt;Get&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;(valÂ &lt;span&gt;interface&lt;/span&gt;{},Â existsÂ &lt;span&gt;bool&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â hashCodeÂ :=Â fnv32(key)&lt;br/&gt;Â indexÂ :=Â dict.spread(hashCode)&lt;br/&gt;Â shardÂ :=Â dict.getShard(index)&lt;br/&gt;Â shard.mutex.RLock()&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â shard.mutex.RUnlock()&lt;br/&gt;Â val,Â existsÂ =Â shard.m[key]&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(dictÂ *ConcurrentDict)&lt;/span&gt;Â &lt;span&gt;Put&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;,Â valÂ &lt;span&gt;interface&lt;/span&gt;{})&lt;/span&gt;Â &lt;span&gt;(resultÂ &lt;span&gt;int&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â dictÂ ==Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;panic&lt;/span&gt;(&lt;span&gt;&quot;dictÂ isÂ nil&quot;&lt;/span&gt;)&lt;br/&gt;Â }&lt;br/&gt;Â hashCodeÂ :=Â fnv32(key)&lt;br/&gt;Â indexÂ :=Â dict.spread(hashCode)&lt;br/&gt;Â shardÂ :=Â dict.getShard(index)&lt;br/&gt;Â shard.mutex.Lock()&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â shard.mutex.Unlock()&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â _,Â okÂ :=Â shard.m[key];Â okÂ {&lt;br/&gt;Â Â shard.m[key]Â =Â val&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â shard.m[key]Â =Â val&lt;br/&gt;Â Â dict.addCount()&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;ConcurrentDict&lt;/code&gt; å¯ä»¥ä¿è¯å¯¹å•ä¸ª key æ“ä½œçš„å¹¶å‘å®‰å…¨æ€§ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•æ»¡è¶³å¹¶å‘å®‰å…¨çš„éœ€æ±‚ï¼Œä¸¾ä¾‹æ¥è¯´ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Incr å‘½ä»¤éœ€è¦å®Œæˆï¼š&lt;code&gt;è¯»å– -&amp;gt; åšåŠ æ³• -&amp;gt; å†™å…¥&lt;/code&gt; ä¸‰æ­¥æ“ä½œï¼Œè¯»å–å’Œå†™å…¥ä¸¤æ­¥æ“ä½œä¸æ˜¯åŸå­æ€§çš„&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;MSETNX å‘½ä»¤å½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®šé”®éƒ½ä¸å­˜åœ¨æ—¶æ‰€æœ‰ç»™å®šé”®è®¾ç½®å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ã€Œæ£€æŸ¥å¤šä¸ªkeyæ˜¯å¦å­˜åœ¨ã€ä»¥åŠã€Œå†™å…¥å¤šä¸ªkeyã€è¿™ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å› æ­¤æˆ‘ä»¬éœ€è¦å®ç° &lt;code&gt;db.Locker&lt;/code&gt; ç”¨äºé”å®šä¸€ä¸ªæˆ–ä¸€ç»„ key ç›´åˆ°æˆ‘ä»¬å®Œæˆæ‰€æœ‰æ“ä½œåå†é‡Šæ”¾ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å®ç° &lt;code&gt;db.Locker&lt;/code&gt; æœ€ç›´æ¥çš„æƒ³æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ª &lt;code&gt;map[string]*sync.RWMutex&lt;/code&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;åŠ é”è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼šåˆå§‹åŒ– mutex -&amp;gt; åŠ é”&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è§£é”è¿‡ç¨‹ä¹Ÿåˆ†ä¸ºä¸¤æ­¥: è§£é” -&amp;gt; é‡Šæ”¾mutex&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é‚£ä¹ˆå­˜åœ¨ä¸€ä¸ªæ— æ³•è§£å†³çš„å¹¶å‘é—®é¢˜ï¼š&lt;/p&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;æ—¶é—´&lt;/th&gt;&lt;th&gt;åç¨‹A&lt;/th&gt;&lt;th&gt;åç¨‹B&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;td&gt;locker[&quot;a&quot;].Unlock()&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;locker[&quot;a&quot;] = &amp;amp;sync.RWMutex{}&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;3&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;td&gt;delete(locker[&quot;a&quot;])&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;4&lt;/td&gt;&lt;td&gt;locker[&quot;a&quot;].Lock()&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç”±äº t3 æ—¶åç¨‹ B é‡Šæ”¾äº†é”ï¼Œt4 æ—¶åç¨‹ A è¯•å›¾åŠ é”ä¼šå¤±è´¥ã€‚è‹¥åç¨‹Båœ¨è§£é”æ—¶ä¸æ‰§è¡Œ &lt;code&gt;delete(locker[&quot;a&quot;])&lt;/code&gt; å°±å¯ä»¥é¿å…è¯¥å¼‚å¸¸çš„å‘ç”Ÿï¼Œä½†æ˜¯è¿™æ ·ä¼šé€ æˆä¸¥é‡çš„å†…å­˜æ³„éœ²ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬æ³¨æ„åˆ°å“ˆå¸Œæ§½çš„æ•°é‡è¿œå°‘äº key çš„æ•°é‡ï¼Œåè¿‡æ¥è¯´å¤šä¸ªé”®å¯ä»¥å…±ç”¨ä¸€ä¸ªå“ˆå¸Œæ§½ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸å†ç›´æ¥å¯¹ key è¿›è¡ŒåŠ é”è€Œæ˜¯é”å®š key æ‰€åœ¨çš„å“ˆå¸Œæ§½ä¹Ÿå¯ä»¥ä¿è¯å®‰å…¨ï¼Œå¦ä¸€æ–¹é¢å“ˆå¸Œæ§½æ•°é‡è¾ƒå°‘å³ä½¿ä¸é‡Šæ”¾ä¹Ÿä¸ä¼šæ¶ˆè€—å¤ªå¤šå†…å­˜ã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â LocksÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â tableÂ []*sync.RWMutex&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;Make&lt;/span&gt;&lt;span&gt;(tableSizeÂ &lt;span&gt;int&lt;/span&gt;)&lt;/span&gt;Â *&lt;span&gt;Locks&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â tableÂ :=Â &lt;span&gt;make&lt;/span&gt;([]*sync.RWMutex,Â tableSize)&lt;br/&gt;Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â iÂ :=Â &lt;span&gt;0&lt;/span&gt;;Â iÂ &amp;lt;Â tableSize;Â i++Â {&lt;br/&gt;Â Â Â Â Â Â Â Â table[i]Â =Â &amp;amp;sync.RWMutex{}&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &amp;amp;Locks{&lt;br/&gt;Â Â Â Â Â Â Â Â table:Â table,&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(locksÂ *Locks)&lt;/span&gt;&lt;span&gt;Lock&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â indexÂ :=Â locks.spread(fnv32(key))&lt;br/&gt;Â Â Â Â muÂ :=Â locks.table[index]&lt;br/&gt;Â Â Â Â mu.Lock()&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(locksÂ *Locks)&lt;/span&gt;&lt;span&gt;UnLock&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â indexÂ :=Â locks.spread(fnv32(key))&lt;br/&gt;Â Â Â Â muÂ :=Â locks.table[index]&lt;br/&gt;Â Â Â Â mu.Unlock()&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨é”å®šå¤šä¸ª key æ—¶éœ€è¦æ³¨æ„ï¼Œè‹¥ åç¨‹A æŒæœ‰ é”®a çš„é”è¯•å›¾è·å¾— é”®b çš„é”ï¼Œæ­¤æ—¶ åç¨‹B æŒæœ‰ é”®b çš„é”è¯•å›¾è·å¾— é”®a çš„é”åˆ™ä¼šå½¢æˆæ­»é”ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è§£å†³æ–¹æ³•æ˜¯æ‰€æœ‰åç¨‹éƒ½æŒ‰ç…§ç›¸åŒé¡ºåºåŠ é”ï¼Œè‹¥ä¸¤ä¸ªåç¨‹éƒ½æƒ³è·å¾— é”®a å’Œ é”®b çš„é”ï¼Œé‚£ä¹ˆå¿…é¡»å…ˆè·å– é”®a çš„é”åè·å– é”®b çš„é”ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¾ªç¯ç­‰å¾…ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åˆ°ç›®å‰ä¸ºæ­¢æ„å»º Redis æœåŠ¡å™¨æ‰€éœ€çš„åŸºæœ¬ç»„ä»¶å·²ç»å¤‡é½ï¼Œåªéœ€è¦å°† TCP æœåŠ¡å™¨ã€åè®®è§£æå™¨ä¸å“ˆå¸Œè¡¨ç»„è£…èµ·æ¥æˆ‘ä»¬çš„ Redis æœåŠ¡å™¨å°±å¯ä»¥å¼€å§‹å·¥ä½œå•¦ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ€åï¼Œä»¥ä¸Šä»£ç å‡ç®€åŒ–è‡ªæˆ‘å†™çš„ Godisï¼šä¸€ä¸ªå¼€æºä»…ç”¨ Go è¯­è¨€å®ç°çš„ Redis æœåŠ¡å™¨ã€‚æœŸå¾…æ‚¨çš„å…³æ³¨å’Œ Starï¼š&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;é¡¹ç›®åœ°å€ï¼šhttps://github.com/HDT3213/godis&lt;/p&gt;&lt;/blockquote&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;/h1&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;å››ã€ç»“æŸ&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¾ˆå¤šæœ‹å‹çš„æ—¥å¸¸å·¥ä½œä¸»è¦æ˜¯ç¼–å†™ä¸šåŠ¡ä»£ç ï¼Œå¯¹äºæ¡†æ¶ã€æ•°æ®åº“ã€ä¸­é—´ä»¶è¿™äº›â€œæ¶æ„â€ã€â€œåº•å±‚ä»£ç â€ æœ‰ä¸€äº›ææƒ§æ„Ÿã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†æœ¬æ–‡æˆ‘ä»¬åªå†™äº† 3 ä¸ªç»„ä»¶ï¼Œå…±è®¡å‡ ç™¾è¡Œä»£ç å°±å®ç°äº†ä¸€ä¸ªåŸºæœ¬çš„ Redis æœåŠ¡å™¨ã€‚æ‰€ä»¥åº•å±‚çš„æŠ€æœ¯å¹¶ä¸éš¾ï¼Œåªè¦ä½ å¯¹æŠ€æœ¯æ„Ÿå…´è¶£ç”±æµ…å…¥æ·±ã€ä»ç®€åˆ°ç¹ï¼Œâ€œåº•å±‚ä»£ç â€ä¹Ÿå¹¶ä¸ç¥ç§˜ã€‚&lt;/p&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;span&gt;- END -&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzA5MzYyNzQ0MQ==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNOqkqThUJBICyFBlvLvTyOCgBpibwWotSxGExfnOYFfPiaL9yn3GMUOCEVYN2RNslGCdQwgZy6ticdyA/0?wx_fmt=png&quot; data-nickname=&quot;HelloGitHub&quot; data-alias=&quot;GitHub520&quot; data-signature=&quot;åˆ†äº« GitHub ä¸Šæœ‰è¶£ã€å…¥é—¨çº§çš„å¼€æºé¡¹ç›®ã€‚&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;å…´è¶£æ˜¯æœ€å¥½çš„è€å¸ˆï¼Œ&lt;strong&gt;HelloGitHub&lt;/strong&gt; å‘ç°ç¼–ç¨‹çš„ä¹è¶£&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f1f493d211a282bb989d3d7f277ec432</guid>
<title>æˆ‘ç”¨ Python ç”»äº†ä¸€ç›˜ç²½å­é€ç»™å¤§å®¶</title>
<link>https://toutiao.io/k/qsz5fkd</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.1484375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/PvP6qjUpvIq22XWicwbh9WLklk2X51zvGDY3xRkicCsOhnJT9WlCz1onvvsdWwBQoB0icZfCQh9yIRoic41IXwNWEQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;Mzg3MzYzNzIxNg==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/IhkoHbB7IaCFYeyB7a25IMBkibiciaG1PpwH9KrrUhhJBibcWJU3cXBG7NIynR5lWE7srQ6A9Z4mmqcZtPicycxvMDQ/0?wx_fmt=png&quot; data-nickname=&quot;GitHubè”ç›Ÿ&quot; data-alias=&quot;GitHubUN&quot; data-signature=&quot;æ¯å¤©åˆ†äº« GitHub ä¸Šæœ‰è¶£ã€å®ç”¨çš„å¼€æºé¡¹ç›®ã€‚å†…å®¹åŒ…æ‹¬ä½†ä¸é™äº Javaã€Pythonã€Goã€å‰ç«¯ã€æ•°æ®åˆ†æã€AI ç­‰ã€‚&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»Šå¤©æ˜¯ç«¯åˆèŠ‚ï¼Œé¦–å…ˆç¥å¤§å®¶ç«¯åˆå®‰åº·ï¼Œè¯´åˆ°ç«¯åˆèŠ‚ï¼Œç²½å­åˆ™æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œç°åœ¨ç²½å­çš„ç§ç±»ä¹Ÿæ˜¯äº”èŠ±å…«é—¨ï¼Œä½†æˆ‘è¿˜æ˜¯å–œæ¬¢ä¼ ç»Ÿçš„ç™½æ£•å­ï¼Œä½ å–œæ¬¢å“ªç§ç²½å­å‘¢ï¼Ÿåœ¨å¤§å®¶åƒç€ç¾å‘³ç²½å­çš„åŒæ—¶ï¼Œæœ¬æ–‡æˆ‘ä»¬ç”»ä¸€ç›˜ç²½å­é€ç»™å¤§å®¶ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å…ˆç¹ä¸ºå¿«&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬å…ˆæ¥æ¬£èµä¸€ä¸‹æœ€ç»ˆçš„æ•ˆæœå›¾ï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.6727664155005382&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/PvP6qjUpvIpbW93CXlo5rBW3icWdbsqBGUeZIC16BjSOV4kTYflNISjScdRQKpH0asbUon61fKuqhJ6peyNWib3A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;929&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ•´ä½“åˆ†ä¸‰éƒ¨åˆ†ç»„æˆï¼šç›˜å­ã€ç²½å­ã€æ–‡å­—ï¼Œä¸‹é¢æˆ‘ä»¬å±•å¼€æ¥è¯´ä¸€ä¸‹ç›¸åº”å®ç°ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ç›˜å­å®ç°&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¦–å…ˆï¼Œæˆ‘ä»¬æ¥ç”»ä¸€ä¸ªç›˜å­ï¼Œç›˜å­çš„ç»„æˆæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªæ¤­åœ†å†åŠ ä¸Šå¡«å……è‰²ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;#Â ç”»ç›˜å­&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;def&lt;/span&gt;Â &lt;span&gt;plate&lt;/span&gt;&lt;span&gt;(a,Â b,Â angle,Â steps,Â rotateAngle)&lt;/span&gt;:&lt;/span&gt;&lt;br/&gt;Â Â Â Â minAngleÂ =Â (&lt;span&gt;2&lt;/span&gt;Â *Â math.piÂ /Â &lt;span&gt;360&lt;/span&gt;)Â *Â angleÂ /Â steps&lt;br/&gt;Â Â Â Â rotateAngleÂ =Â rotateAngleÂ /Â &lt;span&gt;360&lt;/span&gt;Â *Â &lt;span&gt;2&lt;/span&gt;Â *Â math.pi&lt;br/&gt;Â Â Â Â penup()Â &lt;span&gt;#Â èµ·ç¬”&lt;/span&gt;&lt;br/&gt;Â Â Â Â setpos(bÂ *Â math.sin(rotateAngle),Â -bÂ *Â math.cos(rotateAngle))&lt;br/&gt;Â Â Â Â pendown()Â &lt;span&gt;#Â è½ç¬”&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â iÂ &lt;span&gt;in&lt;/span&gt;Â range(steps):&lt;br/&gt;Â Â Â Â Â Â Â Â nextPointÂ =Â [aÂ *Â math.sin((iÂ +Â &lt;span&gt;1&lt;/span&gt;)Â *Â minAngle),Â -bÂ *Â math.cos((iÂ +Â &lt;span&gt;1&lt;/span&gt;)Â *Â minAngle)]&lt;br/&gt;Â Â Â Â Â Â Â Â nextPointÂ =Â [nextPoint[&lt;span&gt;0&lt;/span&gt;]Â *Â math.cos(rotateAngle)Â -Â nextPoint[&lt;span&gt;1&lt;/span&gt;]Â *Â math.sin(rotateAngle),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â nextPoint[&lt;span&gt;0&lt;/span&gt;]Â *Â math.sin(rotateAngle)Â +Â nextPoint[&lt;span&gt;1&lt;/span&gt;]Â *Â math.cos(rotateAngle)]&lt;br/&gt;Â Â Â Â Â Â Â Â setpos(nextPoint)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.6702937976060935&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/PvP6qjUpvIpbW93CXlo5rBW3icWdbsqBG9OdIgQzziaPQG5SxMa5V4df2acC1Of8eq0Bpu5RNtA25W4ibqZDVZ8icw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;919&quot;/&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ç²½å­å®ç°&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¥ç€ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æœ¬æ–‡æœ€æ ¸å¿ƒçš„éƒ¨åˆ†-ç²½å­çš„å®ç°ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;#Â ç”»ç²½å­&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;def&lt;/span&gt;Â &lt;span&gt;rice_dumpling&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;:&lt;/span&gt;&lt;br/&gt;Â Â Â Â pensize(&lt;span&gt;2&lt;/span&gt;)Â &lt;span&gt;#Â ç”»ç¬”å®½åº¦&lt;/span&gt;&lt;br/&gt;Â Â Â Â pencolor(&lt;span&gt;2&lt;/span&gt;,Â &lt;span&gt;51&lt;/span&gt;,Â &lt;span&gt;12&lt;/span&gt;)Â &lt;span&gt;#Â ç”»ç¬”é¢œè‰²&lt;/span&gt;&lt;br/&gt;Â Â Â Â fillcolor(&lt;span&gt;4&lt;/span&gt;,Â &lt;span&gt;77&lt;/span&gt;,Â &lt;span&gt;19&lt;/span&gt;)Â &lt;span&gt;#Â å¡«å……è‰²&lt;/span&gt;&lt;br/&gt;Â Â Â Â begin_fill()&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;200&lt;/span&gt;)Â &lt;span&gt;#Â å‘å‰&lt;/span&gt;&lt;br/&gt;Â Â Â Â circle(&lt;span&gt;15&lt;/span&gt;,Â &lt;span&gt;120&lt;/span&gt;)Â &lt;span&gt;#ç”»åœ†å¼§&lt;/span&gt;&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;Â Â Â Â circle(&lt;span&gt;15&lt;/span&gt;,Â &lt;span&gt;120&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;Â Â Â Â circle(&lt;span&gt;15&lt;/span&gt;,Â &lt;span&gt;120&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;Â Â Â Â circle(&lt;span&gt;15&lt;/span&gt;,Â &lt;span&gt;60&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;Â Â Â Â circle(&lt;span&gt;15&lt;/span&gt;,Â &lt;span&gt;90&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;173&lt;/span&gt;)&lt;br/&gt;Â Â Â Â circle(&lt;span&gt;1&lt;/span&gt;,Â &lt;span&gt;90&lt;/span&gt;)&lt;br/&gt;Â Â Â Â end_fill()&lt;br/&gt;Â Â Â Â penup()&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;Â Â Â Â right(&lt;span&gt;60&lt;/span&gt;)&lt;br/&gt;Â Â Â Â back(&lt;span&gt;105&lt;/span&gt;)&lt;br/&gt;Â Â Â Â aÂ =Â pos()&lt;br/&gt;Â Â Â Â pendown()&lt;br/&gt;Â Â Â Â color(&lt;span&gt;60&lt;/span&gt;,Â &lt;span&gt;67&lt;/span&gt;,Â &lt;span&gt;0&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fillcolor(&lt;span&gt;85&lt;/span&gt;,Â &lt;span&gt;97&lt;/span&gt;,Â &lt;span&gt;9&lt;/span&gt;)&lt;br/&gt;Â Â Â Â begin_fill()&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;120&lt;/span&gt;)&lt;br/&gt;Â Â Â Â goto(a)&lt;br/&gt;Â Â Â Â penup()&lt;br/&gt;Â Â Â Â back(&lt;span&gt;15&lt;/span&gt;)&lt;br/&gt;Â Â Â Â left(&lt;span&gt;90&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;20&lt;/span&gt;)&lt;br/&gt;Â Â Â Â right(&lt;span&gt;90&lt;/span&gt;)&lt;br/&gt;Â Â Â Â pendown()&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;Â Â Â Â right(&lt;span&gt;120&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;24&lt;/span&gt;)&lt;br/&gt;Â Â Â Â right(&lt;span&gt;60&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;120&lt;/span&gt;)&lt;br/&gt;Â Â Â Â right(&lt;span&gt;60&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;24&lt;/span&gt;)&lt;br/&gt;Â Â Â Â end_fill()&lt;br/&gt;Â Â Â Â begin_fill()&lt;br/&gt;Â Â Â Â left(&lt;span&gt;110&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;65&lt;/span&gt;)&lt;br/&gt;Â Â Â Â left(&lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;24&lt;/span&gt;)&lt;br/&gt;Â Â Â Â left(&lt;span&gt;80&lt;/span&gt;)&lt;br/&gt;Â Â Â Â fd(&lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;Â Â Â Â end_fill()&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.759765625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/PvP6qjUpvIpbW93CXlo5rBW3icWdbsqBGUeYdptJjibc5mwrLQHr8PMKQusYXfQcDGdUwesQkksbe3uic92eficscw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;512&quot;/&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;æ–‡å­—å®ç°&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬å†æ¥ç€çœ‹ä¸€ä¸‹å¦‚ä½•æ·»åŠ æ–‡å­—ï¼Œæ¯”å¦‚æˆ‘è¦æ·»åŠ çš„æ–‡å­—æ˜¯ï¼šç¥å¤§å®¶ç«¯åˆå®‰åº·ï¼Œæ·»åŠ æ–‡å­—å®ç°å¾ˆå®¹æ˜“ï¼Œåªéœ€ä¸€è¡Œä»£ç å³å¯ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;write(&lt;span&gt;&quot;ç¥å¤§å®¶ç«¯åˆå®‰åº·&quot;&lt;/span&gt;,Â move=&lt;span&gt;False&lt;/span&gt;,Â align=&lt;span&gt;&quot;center&quot;&lt;/span&gt;,Â font=(&lt;span&gt;&quot;ComicÂ Sans&quot;&lt;/span&gt;,Â &lt;span&gt;18&lt;/span&gt;,Â &lt;span&gt;&quot;bold&quot;&lt;/span&gt;))&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ–‡ä¸­å…¨éƒ¨ä»£ç å·²ç»ä¸ºå¤§å®¶æ•´ç†å¥½äº†ï¼Œæœ‰éœ€è¦çš„åœ¨å…¬ä¼—å·&lt;strong&gt;&lt;span&gt;Pythonå°äºŒ&lt;/span&gt;&lt;/strong&gt;åå°å›å¤&lt;strong&gt;&lt;span&gt;ç«¯åˆ&lt;/span&gt;&lt;/strong&gt;å³å¯è·å–ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœå¤§å®¶è§‰å¾—æœ¬æ–‡æœ‰ä¸€ç‚¹å¸®åŠ©çš„è¯ï¼Œè®°å¾—éšæ‰‹ç‚¹ä¸ªèµæ”¯æŒä¸€ä¸‹~&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzU3Mzk1ODA5OQ==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/PvP6qjUpvIpUwwib3ughYzyRWGgnRezhFgwicOtsUTHoYCGlVibuic6LN0mUYjVJ3jP9W5zvwwyhdrNJEqOv8X9QSQ/0?wx_fmt=png&quot; data-nickname=&quot;Pythonå°äºŒ&quot; data-alias=&quot;pythonXE&quot; data-signature=&quot;å›å¤ 1024 å…è´¹é¢†å–å­¦ä¹ èµ„æ–™&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_reward_qrcode&quot;&gt;
                                &lt;p class=&quot;tips_global&quot;&gt;Long-press QR code to transfer me a reward&lt;/p&gt;
                                                                &lt;p class=&quot;reward_tips&quot;&gt;åˆ†äº«ã€åœ¨çœ‹ã€èµæ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ&lt;/p&gt;
                                &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; id=&quot;js_reward_qrcode_img&quot;/&gt;&lt;/span&gt;
                                &lt;p class=&quot;tips_global&quot;&gt;As required by Apple&#x27;s new policy, the Reward feature has been disabled on Weixin for iOS. You can still reward an Official Account by transferring money via QR code.&lt;/p&gt;
                            &lt;/div&gt;
                                                                            
                              
            &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>79b06314eac04b88114da736653a77cd</guid>
<title>ä¸€æ–‡ç†è§£ Kafka å¦‚ä½•æ¶ˆæ¯ä¸ä¸¢å¤±</title>
<link>https://toutiao.io/k/rupupf1</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p data-source-line=&quot;1&quot;&gt;æœ¬æ–‡åªèšç„¦äºKafkaç³»ç»Ÿçš„æ¶ˆæ¯ä¸¢å¤±ï¼Œå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒå‡ºç°æ•°æ®ä¸¢å¤±ï¼Œæ’æŸ¥æ—¶è¦å…ˆä»é“¾è·¯ä¸Šåˆ†æ®µå®šä½ï¼Œç¼©å°é—®é¢˜èŒƒå›´ã€‚&lt;/p&gt;&lt;p data-source-line=&quot;3&quot;&gt;å¦‚æœå¯¹Kafkaä¸äº†è§£çš„è¯ï¼Œå¯ä»¥å…ˆçœ‹è¿™ç¯‡åšå®¢ã€Š&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzUyNzgyNzAwNg==&amp;amp;mid=2247484251&amp;amp;idx=1&amp;amp;sn=92d6b50c5987f4f80316313db05b56ff&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-linktype=&quot;2&quot;&gt;ä¸€æ–‡å¿«é€Ÿäº†è§£Kafka&lt;/a&gt;ã€‹ã€‚&lt;/p&gt;&lt;h2 data-source-line=&quot;5&quot;&gt;æ•°æ®ä¸¢å¤±çš„åŸå› &lt;/h2&gt;&lt;h3 data-source-line=&quot;7&quot;&gt;ç”Ÿäº§è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ&lt;/h3&gt;&lt;p data-source-line=&quot;9&quot;&gt;ç”Ÿäº§è€…(Producer) è°ƒç”¨sendæ–¹æ³•å‘é€æ¶ˆæ¯ä¹‹åï¼Œæ¶ˆæ¯å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜å¹¶æ²¡æœ‰å‘é€è¿‡å»ã€‚&lt;/p&gt;&lt;p data-source-line=&quot;11&quot;&gt;è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;&lt;p data-source-line=&quot;13&quot;&gt;ä¸èƒ½è®¤ä¸ºåœ¨è°ƒç”¨sendæ–¹æ³•å‘é€æ¶ˆæ¯ä¹‹åæ¶ˆæ¯æ¶ˆæ¯å‘é€æˆåŠŸäº†ã€‚ä¸ºäº†ç¡®å®šæ¶ˆæ¯æ˜¯å‘é€æˆåŠŸï¼Œéœ€è¦åˆ¤æ–­æ¶ˆæ¯å‘é€çš„ç»“æœã€‚ä½†è¦æ³¨æ„çš„æ˜¯Kafkaç”Ÿäº§è€…(Producer) ä½¿ç”¨sendæ–¹æ³•å‘é€æ¶ˆæ¯å®æ˜¯å¼‚æ­¥çš„æ“ä½œï¼Œè™½ç„¶å¯ä»¥é€šè¿‡get()æ–¹æ³•è·å–è°ƒç”¨ç»“æœï¼Œä½†é™ä½ä¸šåŠ¡æœåŠ¡çš„ååé‡ã€‚ä¼˜åŒ–çš„æ–¹å¼æ˜¯æ”¹ä¸ºå›è°ƒå‡½æ•°çš„å½¢å¼ã€‚&lt;/p&gt;&lt;p data-source-line=&quot;15&quot;&gt;æ­¤å¤–ï¼Œå¯¹äºä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘Producerç«¯è®¾ç½®&lt;code&gt;retries&lt;/code&gt;ï¼ˆé‡è¯•æ¬¡æ•°ï¼‰è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„å€¼ï¼Œä¸€èˆ¬æ˜¯3ã€‚è®¾ç½®å®Œæˆä¹‹åï¼Œå½“å‡ºç°ç½‘ç»œé—®é¢˜ä¹‹åèƒ½å¤Ÿè‡ªåŠ¨é‡è¯•æ¶ˆæ¯å‘é€ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚å¦å¤–ï¼Œå»ºè®®å°†é‡è¯•é—´éš”è®¾ç½®é•¿ä¸€äº›ï¼Œå› ä¸ºé—´éš”æ—¶é—´å¤ªå°ï¼Œå¯èƒ½ä¸€æ¬¡ç½‘ç»œæ³¢åŠ¨çš„æ—¶é—´é‡è¯•å…¨éƒ¨ç»“æŸäº†ã€‚&lt;/p&gt;&lt;h3 data-source-line=&quot;17&quot;&gt;æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ&lt;/h3&gt;&lt;p data-source-line=&quot;19&quot;&gt;è‡ªåŠ¨æäº¤å¼€å¯ä¼šå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼šå½“æ¶ˆè´¹è€…pollåˆ°è¿™ä¸ªæ¶ˆæ¯ï¼Œè¿˜æ²¡è¿›è¡ŒçœŸæ­£æ¶ˆè´¹çš„æ—¶å€™ï¼Œoffsetè¢«è‡ªåŠ¨æäº¤çš„åŒæ—¶æ¶ˆè´¹è€…æŒ‚æ‰äº†ã€‚&lt;/p&gt;&lt;p data-source-line=&quot;21&quot;&gt;è§£å†³åŠæ³•ï¼š&lt;/p&gt;&lt;p data-source-line=&quot;23&quot;&gt;å…³é—­è‡ªåŠ¨æäº¤offsetï¼ˆå³ï¼š&lt;code&gt;enable.auto.commit&lt;/code&gt;ä¸ºfalseï¼‰ï¼Œæ¯æ¬¡åœ¨çœŸæ­£æ¶ˆè´¹å®Œæ¶ˆæ¯ä¹‹åï¼Œæ‰‹åŠ¨æäº¤offsetã€‚&lt;/p&gt;&lt;p data-source-line=&quot;25&quot;&gt;ä½†è¿™æ ·è¿˜æ˜¯ä¼šå­˜åœ¨æ¶ˆè´¹è€…åˆšæ¶ˆè´¹å®Œæ¶ˆæ¯ï¼Œè¿˜æ²¡æäº¤offsetï¼Œç»“æœå®•æœºäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶ˆæ¯ç†è®ºä¸Šå°±ä¼šè¢«æ¶ˆè´¹ä¸¤æ¬¡ï¼Œå› æ­¤æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§æ˜¯éœ€è¦ä¿è¯ã€‚å¯ä»¥æŸ¥çœ‹åšå®¢ã€Š&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzUyNzgyNzAwNg==&amp;amp;mid=2247484349&amp;amp;idx=1&amp;amp;sn=b54c0819bc100db816cda52d11476401&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-linktype=&quot;2&quot;&gt;ä¸€æ–‡ç†è§£å¦‚ä½•å®ç°æ¥å£çš„å¹‚ç­‰æ€§&lt;/a&gt;ã€‹ï¼Œæœ‰è¿™ç§é—®é¢˜å¯¹åº”çš„è§£å†³æ–¹æ¡ˆ&lt;/p&gt;&lt;h3 data-source-line=&quot;27&quot;&gt;Kafkaç³»ç»Ÿå†…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µ&lt;/h3&gt;&lt;p data-source-line=&quot;29&quot;&gt;å‡å¦‚leaderå‰¯æœ¬æ‰€åœ¨çš„brokerçªç„¶æŒ‚æ‰ï¼Œé‚£ä¹ˆå°±è¦ä»followerå‰¯æœ¬é‡æ–°é€‰å‡ºä¸€ä¸ªleaderï¼Œä½†æ˜¯leaderçš„æ•°æ®è¿˜æœ‰ä¸€äº›æ²¡æœ‰è¢«followerå‰¯æœ¬çš„åŒæ­¥çš„è¯ï¼Œå°±ä¼šé€ æˆæ¶ˆæ¯ä¸¢å¤±ã€‚&lt;/p&gt;&lt;p data-source-line=&quot;31&quot;&gt;è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;&lt;p data-source-line=&quot;33&quot;&gt;ä¸ºäº†å‡å°‘Kafkaç³»ç»Ÿå†…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µï¼ŒKafkaéœ€è¦é…ç½®å¦‚ä¸‹å‡ ä¸ªå‚æ•°ï¼š&lt;/p&gt;&lt;ol data-source-line=&quot;35&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;Producerç«¯è®¾ç½®&lt;code&gt;acks&lt;/code&gt;=allã€‚&lt;code&gt;acks&lt;/code&gt;çš„é»˜è®¤å€¼ä¸º1ï¼Œä»£è¡¨æ¶ˆæ¯è¢«leaderå‰¯æœ¬æ¥æ”¶ä¹‹åå°±ç®—è¢«æˆåŠŸå‘é€ã€‚å½“é…ç½®&lt;code&gt;acks&lt;/code&gt;=allä»£è¡¨åˆ™æ‰€æœ‰å‰¯æœ¬éƒ½è¦æ¥æ”¶åˆ°è¯¥æ¶ˆæ¯ä¹‹åè¯¥æ¶ˆæ¯æ‰ç®—çœŸæ­£æˆåŠŸè¢«å‘é€ã€‚ï¼ˆå‰¯æœ¬åªæ˜¯å°†æ¶ˆæ¯å­˜å‚¨åœ¨PageCacheä¸Šçš„ï¼Œå®šæœŸflushåˆ°ç£ç›˜ä¸Šçš„ï¼Œå¦‚æœå‡ºç°æ–­ç”µæˆ–è€…æœºå™¨æ•…éšœç­‰ï¼ŒPageCacheä¸Šçš„æ•°æ®å°±ä¸¢å¤±äº†ã€‚ä½†è®¾ç½®è®¾ç½®äº†&lt;code&gt;acks&lt;/code&gt;=allï¼Œå‡ºç°å¤šä¸ªå‰¯æœ¬åŒæ—¶æŒ‚æ‰çš„æ¦‚ç‡æ¯”LeaderæŒ‚æ‰çš„æ¦‚ç‡å°±å°å¾ˆå¤š)&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;topicè®¾ç½®&lt;code&gt;replication.factor&lt;/code&gt;&amp;gt;=3ã€‚ä¸ºäº†ä¿è¯leaderå‰¯æœ¬èƒ½æœ‰follower å‰¯æœ¬èƒ½åŒæ­¥æ¶ˆæ¯ï¼Œä¸€èˆ¬ä¼šè®¾ç½®&lt;code&gt;replication.factor&lt;/code&gt;&amp;gt;=3ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯æ¯ä¸ªåˆ†åŒº(partition)è‡³å°‘æœ‰3ä¸ªå‰¯æœ¬ã€‚è™½ç„¶é€ æˆäº†æ•°æ®å†—ä½™ï¼Œä½†æ˜¯å¸¦æ¥äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;è®¾ç½®&lt;code&gt;min.insync.replicas&lt;/code&gt;&amp;gt;1ã€‚ä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦è®¾ç½®&lt;code&gt;min.insync.replicas&lt;/code&gt;&amp;gt;1ï¼Œè¿™æ ·é…ç½®ä»£è¡¨æ¶ˆæ¯è‡³å°‘è¦è¢«å†™å…¥åˆ°2ä¸ªå‰¯æœ¬æ‰ç®—æ˜¯è¢«æˆåŠŸå‘é€ï¼ˆé»˜è®¤å€¼ä¸º1ï¼‰ã€‚åœ¨å®é™…ç”Ÿäº§ä¸­åº”å°½é‡é¿å…&lt;code&gt;min.insync.replicas&lt;/code&gt;å€¼ä¸º1ï¼Œæ­¤å¤–ï¼Œä¸ºäº†ä¿è¯æ•´ä¸ªKafkaæœåŠ¡çš„é«˜å¯ç”¨æ€§ï¼Œä½ éœ€è¦ç¡®ä¿&lt;code&gt;replication.factor&lt;/code&gt;&amp;gt;&lt;code&gt;min.insync.replicas&lt;/code&gt;ï¼Œå¦åˆ™æœ‰ä¸€ä¸ªå‰¯æœ¬æŒ‚æ‰ï¼Œæ•´ä¸ªåˆ†åŒºå°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚æ¨èè®¾ç½®æˆ&lt;code&gt;replication.factor&lt;/code&gt;=&lt;code&gt;min.insync.replicas&lt;/code&gt;+1ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;è®¾ç½®&lt;code&gt;unclean.leader.election.enable&lt;/code&gt;=falseã€‚å³ä¸å…è®¸Unclean leaderé€‰ä¸¾ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Producerç«¯è®¾ç½®&lt;code&gt;retries&lt;/code&gt;ã€‚é…åˆ&lt;code&gt;acks&lt;/code&gt;=allï¼Œè¿™æ ·å¯ä»¥ä¿è¯leaderæŒ‚æ‰ä¹‹åï¼ŒProducerä¼šé‡æ–°å‘é€æ¶ˆæ¯ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;blockquote data-source-line=&quot;41&quot;&gt;&lt;p&gt;Unclean leaderé€‰ä¸¾ï¼šKafkaæŠŠä¸åœ¨ISRåˆ—è¡¨ä¸­çš„å­˜æ´»å‰¯æœ¬ç§°ä¸ºâ€œéåŒæ­¥å‰¯æœ¬â€ï¼Œè¿™äº›å‰¯æœ¬ä¸­çš„æ¶ˆæ¯è¿œè¿œè½åäºleaderï¼Œå¦‚æœé€‰ä¸¾è¿™ç§å‰¯æœ¬ä½œä¸ºleaderçš„è¯å°±å¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±ã€‚Kafka brokerç«¯æä¾›äº†ä¸€ä¸ªå‚æ•°unclean.leader.election.enableï¼Œç”¨äºæ§åˆ¶æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬å‚ä¸leaderé€‰ä¸¾ï¼›å¦‚æœå¼€å¯ï¼Œåˆ™å½“ISRä¸ºç©ºæ—¶å°±ä¼šä»è¿™äº›å‰¯æœ¬ä¸­é€‰ä¸¾æ–°çš„leaderï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºUnclean leaderé€‰ä¸¾ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-source-line=&quot;43&quot;&gt;å¼‚å¸¸å¯¼è‡´çš„æ•°æ®ä¸¢å¤±&lt;/h3&gt;&lt;p data-source-line=&quot;45&quot;&gt;å•æ¡æ•°æ®çš„é•¿åº¦è¶…è¿‡é™åˆ¶ä¼šä¸¢å¤±æ•°æ®ï¼ŒæŠ¥kafka.common.MessageSizeTooLargeExceptionå¼‚å¸¸ï¼Œå¯¼è‡´ç”Ÿäº§è€…æ¶ˆæ¯ç§¯å‹ï¼Œå†…å­˜ä¸Šå‡ã€‚&lt;/p&gt;&lt;p data-source-line=&quot;47&quot;&gt;è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;&lt;p data-source-line=&quot;49&quot;&gt;ä¿®æ”¹Kafka Brokerçš„é…ç½®ï¼Œä¿®æ”¹å•æ¡æ¶ˆæ¯çš„æœ€å¤§é•¿åº¦ã€å•æ¡æ¶ˆæ¯çš„æœ€å¤§é•¿åº¦ç­‰å‚æ•°é…ç½®ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>55295b614fcbea228b772148b66d4e85</guid>
<title>å°† Android ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯æ•´åˆè‡³åº”ç”¨ä¸­</title>
<link>https://toutiao.io/k/31et261</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;RichText ztext Post-RichText&quot;&gt;&lt;p&gt;&lt;i&gt;æœ¬æ–‡æ˜¯ Android ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒç¯‡ï¼Œ&lt;b&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/378815607&quot; class=&quot;internal&quot;&gt;ä¸Šç¯‡æ–‡ç« &lt;/a&gt;&lt;/b&gt;&lt;/i&gt; &lt;i&gt;ä¸»è¦é€šè¿‡æ¯”è¾ƒä¼ ç»Ÿç”¨æˆ·åå’Œå¯†ç çš„è®¤è¯æ–¹å¼å’Œç”Ÿç‰©è¯†åˆ«èº«ä»½è®¤è¯æ–¹å¼çš„ä¸åŒï¼Œä»¥åŠä»‹ç»ç”Ÿç‰©è¯†åˆ«åŠ å¯†çš„ä¸åŒåŠ å¯†æ–¹å¼ï¼Œæ¥å‘å¼€å‘è€…å±•ç¤ºä¸ºä½•éœ€è¦åœ¨åº”ç”¨ä¸­ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«èº«ä»½è®¤è¯æŠ€æœ¯ã€‚&lt;/i&gt;&lt;/p&gt;&lt;p&gt;ä¸ºäº†æ‹“å±•ä¼ ç»Ÿçš„ç™»å½•æˆæƒæµç¨‹ï¼Œä½¿å…¶æ”¯æŒç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯ï¼Œæ‚¨å¯ä»¥åœ¨ç”¨æˆ·æˆåŠŸç™»å½•ä¹‹åæç¤ºç”¨æˆ·å¯ç”¨ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯ã€‚å›¾ 1A å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„ç™»å½•æµç¨‹ï¼Œæ‚¨å¯èƒ½å·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚å½“ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œä¸”åº”ç”¨è·å–åˆ°æœåŠ¡å™¨è¿”å›çš„ userToken ä¹‹åï¼Œå†æç¤ºç”¨æˆ·æ˜¯å¦å¯ç”¨ï¼Œå¦‚å›¾ 1B æ‰€ç¤ºã€‚ä¸€æ—¦å¯ç”¨ï¼Œæ¯æ¬¡ç”¨æˆ·éœ€è¦ç™»å½•æ—¶ï¼Œåº”ç”¨éƒ½åº”å½“è‡ªåŠ¨å¼¹å‡ºç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯å¯¹è¯æ¡†ï¼Œå¦‚å›¾ 2 æ‰€ç¤ºã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-bad30d51c677e1b4a17742ab157b90fd_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;668&quot; data-rawheight=&quot;777&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic2.zhimg.com/v2-bad30d51c677e1b4a17742ab157b90fd_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;668&quot; data-rawheight=&quot;777&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic2.zhimg.com/v2-bad30d51c677e1b4a17742ab157b90fd_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-bad30d51c677e1b4a17742ab157b90fd_b.jpg&quot;/&gt;&lt;figcaption&gt;â–³ å›¾ 1A: å…¸å‹çš„ç™»å½•ç•Œé¢&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-d6446cdb273789f0866cfea57f341ea5_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;457&quot; data-rawheight=&quot;1007&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic2.zhimg.com/v2-d6446cdb273789f0866cfea57f341ea5_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;457&quot; data-rawheight=&quot;1007&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic2.zhimg.com/v2-d6446cdb273789f0866cfea57f341ea5_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-d6446cdb273789f0866cfea57f341ea5_b.jpg&quot;/&gt;&lt;figcaption&gt;â–³ å›¾ 1B: å¯ç”¨ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-7c4f55f7b65100bb71d57b2720819559_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;496&quot; data-rawheight=&quot;1027&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic2.zhimg.com/v2-7c4f55f7b65100bb71d57b2720819559_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;496&quot; data-rawheight=&quot;1027&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic2.zhimg.com/v2-7c4f55f7b65100bb71d57b2720819559_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-7c4f55f7b65100bb71d57b2720819559_b.jpg&quot;/&gt;&lt;figcaption&gt;â–³ å›¾ 2: ç¡®è®¤ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯è¿›è¡Œç™»å½•&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;åœ¨å›¾ 2 ä¸­çš„ç•Œé¢æœ‰ä¸€ä¸ªç¡®å®šæŒ‰é’®ï¼Œå®é™…ä¸Šè¯¥æŒ‰é’®æ˜¯å¯é€‰çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæ‚¨å¼€å‘çš„æ˜¯ä¸€ä¸ªé¤å…çš„åº”ç”¨ï¼Œå»ºè®®æ˜¾ç¤ºè¯¥æŒ‰é’®ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯çš„æ–¹å¼è®©é¡¾å®¢æ”¯ä»˜ç”¨é¤è´¹ç”¨ã€‚å¯¹äºæ•æ„Ÿçš„äº¤æ˜“å’Œæ”¯ä»˜ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨è¦æ±‚ç”¨æˆ·è¿›è¡Œç¡®è®¤ã€‚è‹¥è¦åœ¨ç•Œé¢ä¸­åŒ…å«æ­¤ç¡®è®¤æŒ‰é’®ï¼Œæ‚¨å¯ä»¥åœ¨æ„å»º &lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//developer.android.google.cn/reference/androidx/biometric/BiometricPrompt.PromptInfo&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;BiometricPrompt.PromptInfo&lt;/a&gt;&lt;/b&gt; æ—¶è°ƒç”¨ setConfirmationRequired(true) å³å¯ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‚¨ä¸è°ƒç”¨ &lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//developer.android.google.cn/reference/androidx/biometric/BiometricPrompt.PromptInfo.Builder%23setConfirmationRequired%28boolean%29&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;setConfirmationRequired(true)&lt;/a&gt;&lt;/b&gt;ï¼Œç³»ç»Ÿä¼šé»˜è®¤å°†å…¶è®¾ç½®ä¸º trueã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;æ¥å…¥ç”Ÿç‰©è¯†åˆ«çš„è®¾è®¡æµç¨‹&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ç¤ºä¾‹ä¸­çš„ä»£ç ä½¿ç”¨äº†å¸¦æœ‰ CryptoObject å®ä¾‹çš„åŠ å¯†ç‰ˆ BiometricPromptã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœæ‚¨çš„åº”ç”¨éœ€è¦è®¤è¯ï¼Œé‚£ä¹ˆæ‚¨å°±åº”è¯¥åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ LoginActivity ç»„ä»¶ä½œä¸ºåº”ç”¨çš„ç™»å½•ç•Œé¢ã€‚æ— è®ºåº”ç”¨è¦æ±‚è¿›è¡Œèº«ä»½éªŒè¯çš„é¢‘ç‡å¤šé«˜ï¼Œåªè¦éœ€è¦éªŒè¯ï¼Œå°±åº”è¯¥è¿™ä¹ˆåšã€‚è‹¥ç”¨æˆ·ä¹‹å‰å·²è®¤è¯è¿‡ï¼Œé‚£ä¹ˆ LoginActivity å°†è°ƒç”¨ finish() æ–¹æ³•ï¼Œè®©ç”¨æˆ·ç»§ç»­ä½¿ç”¨ã€‚å¦‚æœç”¨æˆ·è¿˜æ²¡æœ‰è¿›è¡Œèº«ä»½éªŒè¯ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥æ£€æŸ¥ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯æ˜¯å¦å¯ç”¨ã€‚&lt;/p&gt;&lt;p&gt;æœ‰å¾ˆå¤šæ–¹æ³•æ¥æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†ç”Ÿç‰©è¯†åˆ«ã€‚ä¸å…¶åœ¨å„ç§ä¸åŒçš„æ›¿ä»£æ–¹æ¡ˆä¸­å‘¨æ—‹ï¼Œä¸å¦‚æˆ‘ä»¬ç›´æ¥æ·±å…¥ç ”ç©¶ä¸€ä¸ªç‰¹åˆ«çš„æ–¹æ³•: ç›´æ¥æ£€æŸ¥è‡ªå®šä¹‰å±æ€§ &lt;code&gt;ciphertextWrapper&lt;/code&gt; æ˜¯å¦æ˜¯ nullã€‚å½“ç”¨æˆ·åœ¨æ‚¨çš„åº”ç”¨ä¸­å¯ç”¨ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯åï¼Œæ‚¨å°±å¯ä»¥åˆ›å»ºä¸€ä¸ª &lt;code&gt;CiphertextWrapper&lt;/code&gt; æ•°æ®ç±»ï¼Œæ¥å°†åŠ å¯†åçš„ &lt;code&gt;userToken&lt;/code&gt; (ä¹Ÿå°±æ˜¯ ciphertext) å­˜å‚¨åœ¨ &lt;code&gt;SharedPreferences&lt;/code&gt; æˆ– &lt;b&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/111267510&quot; class=&quot;internal&quot;&gt;Room&lt;/a&gt;&lt;/b&gt; è¿™æ ·çš„æŒä¹…æ€§å­˜å‚¨ä¸­ã€‚å› æ­¤ï¼Œè‹¥ &lt;code&gt;ciphertextWrapper&lt;/code&gt; ä¸æ˜¯ nullï¼Œå°±ç›¸å½“äºæ‚¨æ‹¥æœ‰äº†è®¿é—®è¿œç¨‹æœåŠ¡æ‰€éœ€çš„å·²åŠ å¯†çš„ &lt;code&gt;userToken&lt;/code&gt;ï¼Œè¿™ä¹Ÿæ„å‘³ç€å½“å‰ç”Ÿç‰©è¯†åˆ«å·²å¯ç”¨ã€‚&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertextWrapper&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;c1&quot;&gt;// ç”¨æˆ·å·²å¯ç”¨äº†ç”Ÿç‰©è¯†åˆ«
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ç”Ÿç‰©è¯†åˆ«æœªå¯ç”¨
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‹¥ç”Ÿç‰©è¯†åˆ«æœªè¢«å¯ç”¨ï¼Œåˆ™ç”¨æˆ·å¯ä»¥å•å‡» (å¦‚å›¾ 1B æ‰€ç¤º) ä»¥å¯ç”¨å®ƒï¼Œè¿™æ—¶æ‚¨å°†å‘ç”¨æˆ·å±•ç¤ºç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯æç¤ºæ¡†ï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚&lt;/p&gt;&lt;p&gt;å¦‚ä¸‹ä»£ç ç¤ºä¾‹ä¸­ï¼Œ&lt;code&gt;showBiometricPromptForEncryption()&lt;/code&gt; å±•ç¤ºäº†å¦‚ä½•è®¾ç½®ä¸ BiometricPrompt å…³è”çš„åŠ å¯†å¯†é’¥ã€‚æœ¬è´¨ä¸Šï¼Œå°±æ˜¯ä»ä¸€ä¸ª &lt;code&gt;String&lt;/code&gt; åˆå§‹åŒ–å‡ºä¸€ä¸ª &lt;code&gt;Cipher&lt;/code&gt;ï¼Œç„¶åå°†è¯¥ &lt;code&gt;Cipher&lt;/code&gt; ä¼ é€’ç»™ &lt;code&gt;CryptoObject&lt;/code&gt;ã€‚æœ€åå†å°† &lt;code&gt;CryptoObject&lt;/code&gt; ä¼ é€’ç»™ &lt;code&gt;biometricPrompt.authenticate(promptInfo, cryptoObject)&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;n&quot;&gt;binding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;useBiometrics&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setOnClickListener&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;showBiometricPromptForEncryption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;....&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;showBiometricPromptForEncryption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;canAuthenticate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BiometricManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;applicationContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;canAuthenticate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;canAuthenticate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BiometricManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BIOMETRIC_SUCCESS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;secretKeyName&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SECRET_KEY_NAME&lt;/span&gt;
       &lt;span class=&quot;n&quot;&gt;cryptographyManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CryptographyManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
       &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;cipher&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cryptographyManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getInitializedCipherForEncryption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secretKeyName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;biometricPrompt&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;BiometricPromptUtils&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createBiometricPrompt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encryptAndStoreServerToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;promptInfo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BiometricPromptUtils&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createPromptInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;n&quot;&gt;biometricPrompt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authenticate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;promptInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BiometricPrompt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CryptoObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-15120357c3aaea87e1fb8c9e6c20b431_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;700&quot; data-rawheight=&quot;838&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic2.zhimg.com/v2-15120357c3aaea87e1fb8c9e6c20b431_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;700&quot; data-rawheight=&quot;838&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic2.zhimg.com/v2-15120357c3aaea87e1fb8c9e6c20b431_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-15120357c3aaea87e1fb8c9e6c20b431_b.jpg&quot;/&gt;&lt;figcaption&gt;â–³ å›¾ 3: æ¿€æ´»ç”Ÿç‰©è¯†åˆ«çš„æç¤º&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;åœ¨å›¾ 2 å’Œå›¾ 3 æ‰€ç¤ºçš„åœºæ™¯ä¸‹ï¼Œåº”ç”¨åªæœ‰ &lt;code&gt;userToken&lt;/code&gt; è¿™ä¸ªæ•°æ®ã€‚ä½†æ˜¯é™¤éç”¨æˆ·æ¯æ¬¡æ‰“å¼€åº”ç”¨éƒ½è¦è¾“å…¥ä¸€æ¬¡å¯†ç ï¼Œå¦åˆ™è¯¥ &lt;code&gt;userToken&lt;/code&gt; å°±éœ€è¦æŒä¹…åŒ–ç”¨äºä¹‹åçš„ä¼šè¯ã€‚ç„¶è€Œï¼Œå¦‚æœæ‚¨ç›´æ¥å­˜å‚¨äº†æœªåŠ å¯†çš„ &lt;code&gt;userToken&lt;/code&gt;ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯èƒ½ä¾µå…¥è®¾å¤‡è¯»å–æ˜æ–‡çš„ &lt;code&gt;userToken&lt;/code&gt;ï¼Œç„¶åä½¿ç”¨å®ƒä»è¿œç¨‹æœåŠ¡å™¨ä¸Šè·å–æ•°æ®ã€‚å› æ­¤ï¼Œåœ¨å°† &lt;code&gt;userToken&lt;/code&gt; ä¿å­˜åˆ°æœ¬åœ°ä¹‹å‰ï¼Œæœ€å¥½å…ˆå°†å…¶åŠ å¯†ï¼Œè¿™å°±æ˜¯å›¾ 3 ä¸­ BiometricPrompt çš„ä½œç”¨ã€‚å½“ç”¨æˆ·ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«éªŒè¯èº«ä»½åï¼Œæ‚¨çš„ç›®æ ‡æ˜¯ä½¿ç”¨ BiometricPrompt è§£é”å¯†é’¥ (å¯ä»¥ä½¿ç”¨ &lt;i&gt;auth-per-use&lt;/i&gt; å¯†é’¥ï¼Œä¹Ÿå¯ä½¿ç”¨ &lt;i&gt;time-bound&lt;/i&gt; å¯†é’¥)ï¼Œç„¶åç”¨è¯¥å¯†é’¥å¯¹æœåŠ¡å™¨ç”Ÿæˆçš„ userToken è¿›è¡ŒåŠ å¯†ï¼Œå†å°†å…¶ä¿å­˜åˆ°æœ¬åœ°ã€‚è‡ªæ­¤ï¼Œå½“ç”¨æˆ·éœ€è¦ç™»å½•æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«éªŒè¯èº«ä»½ (å³ç”Ÿç‰©è¯†åˆ«è®¤è¯ -&amp;gt; è§£é”å¯†é’¥ -&amp;gt; è§£å¯† userToken è¿›è¡Œæ•°æ®è®¿é—®)ã€‚&lt;/p&gt;&lt;p&gt;è¿™é‡Œè¦æ³¨æ„åŒºåˆ†ç”¨æˆ·æ˜¯ç¬¬ä¸€æ¬¡å¯ç”¨ç”Ÿç‰©è¯†åˆ«ï¼Œè¿˜æ˜¯åœ¨ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«è¿›è¡Œç™»å½•ã€‚å¯ç”¨ç”Ÿç‰©è¯†åˆ«æ—¶ï¼Œåº”ç”¨è°ƒç”¨ &lt;code&gt;showBiometricPromptForEncryption()&lt;/code&gt; æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ª &lt;code&gt;Cipher&lt;/code&gt; ç”¨äºåŠ å¯† &lt;code&gt;userToken&lt;/code&gt;ã€‚å¦ä¸€æ–¹é¢ï¼Œè‹¥ç”¨æˆ·æ˜¯åœ¨ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«è¿›è¡Œç™»å½•ï¼Œé‚£åº”è¯¥è°ƒç”¨ &lt;code&gt;showBiometricPromptForDecryption()&lt;/code&gt; æ–¹æ³•ï¼Œå®ƒä¼šåˆå§‹åŒ–ä¸€ä¸ªç”¨äºè§£å¯†çš„ &lt;code&gt;Cipher&lt;/code&gt;ï¼Œå†ä½¿ç”¨è¯¥ &lt;code&gt;Cipher&lt;/code&gt; æ¥è§£å¯† &lt;code&gt;userToken&lt;/code&gt;ã€‚&lt;/p&gt;&lt;p&gt;å¯ç”¨ç”Ÿç‰©è¯†åˆ«ä¹‹åï¼Œç”¨æˆ·ä¸‹æ¬¡è¿”å›åº”ç”¨æ—¶ï¼Œä¼šé€šè¿‡ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯å¯¹è¯æ¡†è¿›è¡Œè®¤è¯ï¼Œå¦‚å›¾ 4 æ‰€ç¤ºã€‚è¯·æ³¨æ„ï¼Œç”±äºå›¾ 4 æ˜¯ç”¨äºç™»å½•åº”ç”¨ï¼Œè€Œå›¾ 2 æ˜¯ç”¨äºç¡®å®šäº¤æ˜“çš„ï¼Œæ‰€ä»¥åœ¨å›¾ 4 ä¸­æ²¡æœ‰ç¡®è®¤æŒ‰é’®ï¼Œå› ä¸ºç™»å½•è¡Œä¸ºæ˜¯ä¸€ä¸ªè¢«åŠ¨çš„ã€æ˜“é€†å‘æ¢å¤çš„è¡Œä¸ºã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-275de074244b16d3d49ad9293f4ecebf_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;683&quot; data-rawheight=&quot;812&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic4.zhimg.com/v2-275de074244b16d3d49ad9293f4ecebf_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;683&quot; data-rawheight=&quot;812&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic4.zhimg.com/v2-275de074244b16d3d49ad9293f4ecebf_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-275de074244b16d3d49ad9293f4ecebf_b.jpg&quot;/&gt;&lt;figcaption&gt;â–³ å›¾ 4&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;è‹¥è¦ä¸ºæ‚¨çš„ç”¨æˆ·å®ç°è¿™ä¸€æµç¨‹ï¼Œå½“æ‚¨çš„ &lt;code&gt;LoginActivity&lt;/code&gt; å®Œæˆè®¤è¯è¿‡ç¨‹åï¼Œä½¿ç”¨æˆåŠŸé€šè¿‡ BiometricPrompt è®¤è¯è§£é”çš„åŠ å¯†å¯¹è±¡æ¥è§£å¯† &lt;code&gt;userToken&lt;/code&gt;ï¼Œç„¶ååœ¨ &lt;code&gt;LoginActivity&lt;/code&gt; ä¸­è°ƒç”¨ &lt;code&gt;finish()&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onResume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onResume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

   &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertextWrapper&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SampleAppUser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fakeToken&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;showBiometricPromptForDecryption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;c1&quot;&gt;// ç”¨æˆ·å·²ç»æˆåŠŸç™»å½•ï¼Œå› æ­¤ç›´æ¥è¿›å…¥æ¥ä¸‹æ¥çš„åº”ç”¨æµç¨‹
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;           &lt;span class=&quot;c1&quot;&gt;// ä¹‹åçš„å°±äº¤ç»™å¼€å‘è€…æ‚¨æ¥å®Œæˆäº†
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;           &lt;span class=&quot;n&quot;&gt;updateApp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;already_signedin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;....&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;showBiometricPromptForDecryption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;ciphertextWrapper&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textWrapper&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&amp;gt;&lt;/span&gt;
       &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;canAuthenticate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BiometricManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;applicationContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;canAuthenticate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
       &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;canAuthenticate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BiometricManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BIOMETRIC_SUCCESS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;secretKeyName&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secret_key_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;cipher&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cryptographyManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getInitializedCipherForDecryption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
               &lt;span class=&quot;n&quot;&gt;secretKeyName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initializationVector&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                      &lt;span class=&quot;n&quot;&gt;biometricPrompt&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;
               &lt;span class=&quot;n&quot;&gt;BiometricPromptUtils&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createBiometricPrompt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                   &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                   &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decryptServerTokenFromStorage&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;promptInfo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BiometricPromptUtils&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createPromptInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;biometricPrompt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authenticate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;promptInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BiometricPrompt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CryptoObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;decryptServerTokenFromStorage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BiometricPrompt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AuthenticationResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;ciphertextWrapper&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textWrapper&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&amp;gt;&lt;/span&gt;
       &lt;span class=&quot;n&quot;&gt;authResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cryptoObject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;plaintext&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;
               &lt;span class=&quot;n&quot;&gt;cryptographyManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decryptData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;textWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ciphertext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;SampleAppUser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fakeToken&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;plaintext&lt;/span&gt;
           &lt;span class=&quot;c1&quot;&gt;// ç°åœ¨æ‚¨æœ‰äº† tokenï¼Œå°±å¯ä»¥æŸ¥è¯¢æœåŠ¡å™¨ä¸Šçš„å…¶ä»–æ•°æ®äº†
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;           &lt;span class=&quot;c1&quot;&gt;// æˆ‘ä»¬ä¹‹æ‰€ä»¥ç§°è¿™ä¸ªä¸º fakeTokenï¼Œæ˜¯å› ä¸ºå®ƒå¹¶ä¸æ˜¯çœŸæ­£ä»æœåŠ¡å™¨ä¸­è·å–åˆ°çš„
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;           &lt;span class=&quot;c1&quot;&gt;// åœ¨çœŸå®åœºæ™¯ä¸‹ï¼Œæ‚¨ä¼šåœ¨ä»æœåŠ¡å™¨ä¸Šè·å–åˆ° token æ•°æ®
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;           &lt;span class=&quot;c1&quot;&gt;// æ­¤æ—¶ï¼Œå®ƒæ‰èƒ½ç®—æ˜¯ä¸€ä¸ªçœŸæ­£çš„ token
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;           &lt;span class=&quot;n&quot;&gt;updateApp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;already_signedin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;å®Œæ•´çš„è“å›¾&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å›¾ 5 å±•ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„å·¥ç¨‹è®¾è®¡æµç¨‹å›¾ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ‰€æ¨èçš„æµç¨‹ã€‚æ—¢ç„¶æ‚¨åœ¨å®é™…ç¼–ç è¿‡ç¨‹ä¸­å¯èƒ½ä¼šåœ¨å¾ˆå¤šåœ°æ–¹åç¦»æ­¤æµç¨‹ï¼Œä¾‹å¦‚ï¼Œæ‚¨æ‰€ä½¿ç”¨çš„åŠ å¯†è§£å†³æ–¹æ¡ˆä¸­è§£é”å¯†é’¥å¯èƒ½åªä¼šç”¨äºåŠ å¯†è€Œä¸ç”¨äºè§£å¯†ï¼Œä½†æ˜¯åœ¨è¿™é‡Œæˆ‘ä»¬ä»ç„¶å¸Œæœ›èƒ½å¤Ÿé€šè¿‡æä¾›è¿™æ ·ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ä¸ºå¯èƒ½éœ€è¦çš„å¼€å‘è€…ä»¬æä¾›å¸®åŠ©ã€‚&lt;/p&gt;&lt;p&gt;å‡¡æ˜¯å›¾ä¸­æåˆ° &lt;b&gt;å¯†é’¥&lt;/b&gt; çš„åœ°æ–¹ï¼Œæ‚¨éƒ½å¯ä»¥æŒ‰ç…§éœ€æ±‚ä½¿ç”¨ auth-per-use å¯†é’¥æˆ–æ˜¯ time-bound å¯†é’¥ã€‚å¦å¤–ï¼Œå‡¡æ˜¯å›¾ä¸­æåˆ°çš„ &quot;åº”ç”¨ä¸­çš„å­˜å‚¨ç³»ç»Ÿ&quot; çš„åœ°æ–¹ï¼Œæ‚¨ä¹Ÿéƒ½å¯ä»¥å°†å…¶ç†è§£ä¸ºæ‚¨æ‰€åçˆ±çš„ç»“æ„åŒ–å­˜å‚¨: &lt;b&gt;&lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//developer.android.google.cn/reference/android/content/SharedPreferences&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;SharedPreferences&lt;/a&gt;&lt;/code&gt;&lt;/b&gt;ã€&lt;b&gt;&lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//developer.android.google.cn/jetpack/androidx/releases/room&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Room&lt;/a&gt;&lt;/code&gt;&lt;/b&gt; æˆ–æ˜¯ä»»ä½•åˆ«çš„å­˜å‚¨æ–¹æ¡ˆã€‚æœ€åï¼Œå¯¹äº userToken æ‚¨å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ä¸ªä»¤ç‰Œï¼Œæœ‰äº†å®ƒå°±å¯ä»¥å»æœåŠ¡å™¨ä¸Šè®¿é—®è¢«ä¿æŠ¤çš„ç”¨æˆ·æ•°æ®ã€‚æœåŠ¡å™¨é€šå¸¸ä¼šå°†è¿™ç§ä»¤ç‰Œä½œä¸ºè°ƒç”¨æ–¹å·²è¢«æˆæƒçš„è¯æ®ã€‚&lt;/p&gt;&lt;p&gt;å›¾ä¸­çš„ &quot;å¯¹ userToken è¿›è¡ŒåŠ å¯†&quot; çš„ç®­å¤´å¾ˆå¯èƒ½ä¼šæŒ‡å‘ &quot;ç™»å½•å®Œæˆ&quot;ï¼Œè€Œä¸æ˜¯å›åˆ° &quot;LoginActivity&quot;ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯åœ¨å›¾ä¸­è®©å…¶æŒ‡å‘äº† &quot;LoginActivity&quot;ï¼Œå°±æ˜¯ä¸ºäº†æé†’å¤§å®¶æ³¨æ„ï¼Œåœ¨ç”¨æˆ·ç‚¹å‡» &quot;æ¿€æ´»ç”Ÿç‰©è¯†åˆ«&quot; åï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„ Activity (ä¾‹å¦‚ EnableBiometricAuthActivity)ï¼Œä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–ï¼Œæ›´å…·å¯è¯»æ€§ã€‚æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥åˆ›å»ºå¸¦æœ‰ä¸¤ä¸ª Fragment çš„ LoginActivity: ä¸€ä¸ª Fragmentsç”¨äºå®é™…çš„è®¤è¯æµç¨‹ï¼Œå¦ä¸€ä¸ªç”¨æ¥å“åº”ç”¨æˆ·ç‚¹å‡» &quot;å¯ç”¨ç”Ÿç‰©è¯†åˆ«&quot;ã€‚&lt;/p&gt;&lt;p&gt;é™¤äº†ä¸‹é¢è¿™ä¸ªæµç¨‹å›¾ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å‘å¸ƒäº†ä¸€ä¸ªè®¾è®¡æŒ‡å—ï¼Œæ‚¨å¯ä»¥åœ¨è®¾è®¡åº”ç”¨æ—¶è¿›è¡Œå‚è€ƒã€‚å¦å¤–ï¼Œæˆ‘ä»¬ &lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/android/security-samples/tree/master/BiometricLoginKotlin&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;åœ¨ Github ä¸Šçš„ç¤ºä¾‹ä»£ç &lt;/a&gt;&lt;/b&gt; å¸Œæœ›ä¹Ÿèƒ½å¤Ÿå¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£å¦‚ä½•ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯æŠ€æœ¯ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-0dade1949ed511b2120cdf891d6d1498_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1860&quot; data-rawheight=&quot;1999&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic1.zhimg.com/v2-0dade1949ed511b2120cdf891d6d1498_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1860&quot; data-rawheight=&quot;1999&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic1.zhimg.com/v2-0dade1949ed511b2120cdf891d6d1498_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-0dade1949ed511b2120cdf891d6d1498_b.jpg&quot;/&gt;&lt;figcaption&gt;â–³ å›¾ 5: ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«åŒæœåŠ¡å™¨è·å–æˆæƒçš„å®Œæ•´è“å›¾&lt;/figcaption&gt;&lt;/figure&gt;&lt;h2&gt;&lt;b&gt;æ€»ç»“&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å¦‚ä½•æ‰©å±• UI æ¥æ”¯æŒç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯ï¼›&lt;/li&gt;&lt;li&gt;é’ˆå¯¹ç”Ÿç‰©è¯†åˆ«èº«ä»½éªŒè¯çš„æµç¨‹ï¼Œæ‚¨çš„åº”ç”¨åº”ç€é‡è§£å†³çš„å…³é”®ç‚¹æ˜¯ä»€ä¹ˆï¼›&lt;/li&gt;&lt;li&gt;å¦‚ä½•è®¾è®¡æ‚¨çš„ä»£ç æ¥å¤„ç†ç”Ÿç‰©è¯†åˆ«è®¤è¯çš„ä¸åŒåœºæ™¯ï¼›&lt;/li&gt;&lt;li&gt;ç™»å½•æµç¨‹çš„å®Œæ•´å·¥ç¨‹è®¾è®¡å›¾ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ç¥æ‚¨ç¼–ç æ„‰å¿«ï¼&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>