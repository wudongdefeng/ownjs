<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>f8028b4fcba6fdffdceecadd411cf538</guid>
<title>欢迎加入读者圈子，一起交流！</title>
<link>https://toutiao.io/k/mv211dm</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                                                     &quot; id=&quot;js_content&quot;&gt;
            &lt;p&gt;&lt;span&gt;&lt;strong&gt;欢迎加入读者圈子，一起交流！&lt;br/&gt;↓↓↓&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;558&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;307&quot; data-ratio=&quot;0.5493333333333333&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/AjN1jquNavich3VaNkKeiaAwUhz7TQbQmic4fFsr58X9PAYleYzxqc1K1vZjeBoZDMUsmia0xH67EQYINGRvNOtLmA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;750&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;圈子剧透&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1、600+圈子成员，以中高级程序员为主，更有架构师、CTO坐镇交流；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2、1000+优质主题，数十G独家资料，每日分享，精挑细选；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3、全年52期专属邮件周报，让你轻松掌握业界资讯、技术干货，提升认知水平；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;4、全年52本好书共读，让你花最少的时间，获取更好的知识；&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;……&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;心动不如行动，赶快加入吧！&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
          &lt;/div&gt;

          

          



           
                                
                    
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>1683f8529a7650b5cf924ccc65cb118c</guid>
<title>Go 引入箭头函数，你支持吗？</title>
<link>https://toutiao.io/k/dxg460b</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                                                     &quot; id=&quot;js_content&quot;&gt;
            &lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;23&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section mpa-from-tpl=&quot;t&quot;&gt;&lt;p&gt;&lt;span&gt;阅读本文大概需要 1 分钟。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大家好，我是 polarisxu。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Go 中有匿名函数，但即使是简单的函数，也需要完整的编写函数：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;(x, y &lt;span&gt;int&lt;/span&gt;)&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt;&lt;/span&gt; { &lt;span&gt;return&lt;/span&gt; x &amp;lt; y }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但很多其他语言，有简写方式，这就是轻量级匿名函数语法。即：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;(x, y) =&amp;gt; { x &amp;lt; y }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;即箭头函数。如果你没有见过这样的语法，咋一看会有点懵？！&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然，目前还是在激烈讨论阶段，能不能最终引入还未知。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我个人感觉，Go 还是别增加语法糖，搞得语言很复杂了，只有一种解决方案没啥不好，你觉得呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;提案讨论地址：https://github.com/golang/go/issues/21498。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.566815144766147&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/UzjmETLXwBZeNbYzaYlJk2ooaLSlOHh0x0JXbRFyqLiaIib51BTLUVpLRU1icIdicWYiasLSyZXpdW46Rich1Y1mQJLw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1796&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;/section&gt;&lt;hr/&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;往期推荐&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/UzjmETLXwBYuP3ncUTaemHXQYjOZDS40VoicqII73Hu9RncJv06g0kJhnrVicSmUfJRg5Wf9qcDHj7zf5vTjns5A/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;258&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;我是 polarisxu，北大硕士毕业，曾在 360 等知名互联网公司工作，10多年技术研发与架构经验！2012 年接触 Go 语言并创建了 Go 语言中文网！著有《&lt;/span&gt;&lt;span&gt;Go语言编程之旅&lt;/span&gt;&lt;span&gt;》、开源图书《&lt;/span&gt;&lt;span&gt;Go语言标准库&lt;/span&gt;&lt;span&gt;》等。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;坚持输出技术（包括 Go、Rust 等技术）、职场心得和创业感悟！欢迎关注「polarisxu」一起成长！也欢迎加我微信好友交流：&lt;/span&gt;&lt;span&gt;gopherstudio&lt;/span&gt;&lt;/p&gt;
          &lt;/div&gt;

          

          



           
                                
                    
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>12abf24c44139672e98ccc2aaa13fb39</guid>
<title>InnoDB 对 Buffer Pool 的奇思妙想</title>
<link>https://toutiao.io/k/5hfac2o</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot;&gt;本文读完需&lt;span&gt;&lt;strong&gt;9&lt;/strong&gt;&lt;/span&gt;分钟，速读仅需&lt;span&gt;&lt;strong&gt;5&lt;/strong&gt;&lt;/span&gt;分钟。&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.025936599423631124&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ibqicBWEiaFhaUkEs3YhX1fKvaBcTc3V7YooNTGXoXQEGE8V3BGstZA0g9OpLlWicaefuM0zBUvxG3mPIlLdP7vnYw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;694&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;前言&lt;br/&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;大家好，我是阿星，又跟大家见面了。&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;相信很多小伙伴在面试中都被问过「为什么要用缓存？」，大部分人都是回答：「减少数据库的磁盘&lt;code&gt;IO&lt;/code&gt;压力」。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但是&lt;code&gt;MySQL&lt;/code&gt;真的有如此不堪吗？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;每次增删改查都要去走磁盘&lt;code&gt;IO&lt;/code&gt;吗？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;今天就聊聊&lt;code&gt;InnoDB&lt;/code&gt;对&lt;code&gt;Buffer Pool&lt;/code&gt;的奇思妙想。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Buffer Pool&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;先梳理出问题，再思考如何解决问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;假设我们就是&lt;code&gt;InnoDB&lt;/code&gt;，我们要如何去解决磁盘&lt;code&gt;IO&lt;/code&gt;问题？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个简单，做缓存就好了，所以&lt;code&gt;MySQL&lt;/code&gt;需要申请一块内存空间，这块内存空间称为&lt;code&gt;Buffer Pool&lt;/code&gt;。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;223&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.39901477832512317&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzrwsV4W0iagzHRStB22JelLrTX4miaicVNyMG8OSAHG0KWrsoMica6nvvug/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;609&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;Buffer Pool&lt;/code&gt;是申请下来了，但是&lt;code&gt;Buffer Pool&lt;/code&gt;里面放什么，要怎么规划？&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;缓存页&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;MySQL&lt;/code&gt;数据是以页为单位，每页默认&lt;code&gt;16KB&lt;/code&gt;，称为数据页，在&lt;code&gt;Buffer Pool&lt;/code&gt;里面会划分出若干&lt;strong&gt;个缓存页&lt;/strong&gt;与数据页对应。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;479&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.857849196538937&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSz7UHKNLm8PaWmBEVHGJFxI7ib2JzsIETgtwpPxltetKVn3hs91ZXSn9Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;809&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;感觉还少了点什么，我们如何知道缓存页对应那个数据页呢？&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;描述数据&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所有还需要缓存页的元数据信息，可以称为&lt;strong&gt;描述数据&lt;/strong&gt;，它与缓存页一一对应，包含一些所属表空间、数据页的编号、&lt;code&gt;Buffer Pool&lt;/code&gt;中的地址等等。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;484&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.8679950186799502&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzpjGX3qfibNtulxQCjAMkTibvH3sKko21up0rjn4hRM8v3icrKQQvTN6CQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;803&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;后续对数据的增删改查都是在&lt;code&gt;Buffer Pool&lt;/code&gt;里操作&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;查询：从磁盘加载到缓存，后续直接查缓存&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;插入：直接写入缓存&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;更新删除：缓存中存在直接更新，不存在加载数据页到缓存更新&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可能有小伙伴担心，&lt;code&gt;MySQL&lt;/code&gt;宕机了，数据不就全丢了吗？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个不用担心，因为&lt;code&gt;InnoDB&lt;/code&gt;提供了&lt;code&gt;WAL&lt;/code&gt;技术（Write-Ahead Logging），通过&lt;code&gt;redo log&lt;/code&gt;让&lt;code&gt;MySQL&lt;/code&gt;拥有了崩溃恢复能力。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再配合空闲时，会有异步线程做缓存页刷盘，保证数据的持久性与完整性。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;486&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.8702770780856424&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzVadY8m1MQ7KtjFzy5sEAdpLKIblbDQIEiauM7sKUUB5Emo3khh69uGA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;794&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果不能理解&lt;code&gt;redo log&lt;/code&gt;是如何恢复数据的，可以看看阿星前面两篇文章&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;另外，直接更新数据的缓存页称为&lt;strong&gt;脏页&lt;/strong&gt;，缓存页刷盘后称为&lt;strong&gt;干净页&lt;/strong&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;Free链表&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;MySQL&lt;/code&gt;数据库启动时，按照设置的&lt;code&gt;Buffer Pool&lt;/code&gt;大小，去找操作系统申请一块内存区域，作为&lt;code&gt;Buffer Pool&lt;/code&gt;（&lt;strong&gt;假设申请了512MB&lt;/strong&gt;）。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;申请完毕后，会按照默认缓存页的&lt;code&gt;16KB&lt;/code&gt;以及对应的&lt;code&gt;800Byte&lt;/code&gt;的描述数据，在&lt;code&gt;Buffer Pool&lt;/code&gt;中划分出来一个一个的缓存页和它们对应的描述数据。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;426&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.762945914844649&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzISr1h07a3KOvFYFOPlEALTBRicfCTX2RHemYVHeLnVdGLKsVj3H1PGQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;869&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;MySQL&lt;/code&gt;运行起来后，会不停的执行增删改查，需要从磁盘读取一个一个的数据页放入&lt;code&gt;Buffer Pool&lt;/code&gt;对应的缓存页里，把数据缓存起来，以后就可以在内存里执行增删改查。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;602&quot; data-backw=&quot;558&quot; data-ratio=&quot;1.0785070785070785&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzYKwkB2bGugr1cTbe6YJztxrzwvwaZWkfWyN4mmhFhVia5lhU4qYVP6Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;777&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但是这个过程必然涉及一个问题，&lt;strong&gt;哪些缓存页是空闲的&lt;/strong&gt;？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了解决这个问题，我们使用链表结构，把空闲缓存页的&lt;strong&gt;描述数据&lt;/strong&gt;放入链表中，这个链表称为&lt;code&gt;free&lt;/code&gt;链表。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;针对&lt;code&gt;free&lt;/code&gt;链表我们要做如下设计&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;196&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.3504442250740375&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzwic43rpiawNO5ntkqpmymPK4ddYwgAIB1z173rD1vtzMuibMWicNkBibV2Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1013&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最终呈现出来的，是由空闲缓存页的&lt;strong&gt;描述数据&lt;/strong&gt;组成的&lt;code&gt;free&lt;/code&gt;链表。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;505&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.9044481054365733&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzW4KseSdGVoLm0DqrYC6N0kkW1ls2lOjdaibhFiaNr5MqD4Qbo6sQibAsA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;607&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;有了&lt;code&gt;free&lt;/code&gt;链表之后，我们只需要从&lt;code&gt;free&lt;/code&gt;链表获取一个&lt;strong&gt;描述数据&lt;/strong&gt;，就可以获取到对应的缓存页。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;426&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.7628318584070797&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzf4zVDNmqbKDXbl45VE4C9fRl7uLMlfibraBSQrl6Vyp8V8AYVmgdia3w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1130&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;往&lt;strong&gt;描述数据&lt;/strong&gt;与&lt;strong&gt;缓存页&lt;/strong&gt;写入数据后，就将该&lt;strong&gt;描述数据&lt;/strong&gt;移出&lt;code&gt;free&lt;/code&gt;链表。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;缓存页哈希表&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;数据页是缓存进去了，但是又一个问题来了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下次查询数据时，如何在&lt;code&gt;Buffer Pool&lt;/code&gt;里快速定位到对应的缓存页呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;难道需要一个&lt;strong&gt;非空闲的描述数据&lt;/strong&gt;链表，再通过&lt;strong&gt;表空间号+数据页编号&lt;/strong&gt;遍历查找吗？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这样做也可以实现，但是效率不太高，时间复杂度是&lt;code&gt;O(N)&lt;/code&gt;。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;194&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.34835566382460414&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSz247HiaLyA5PGruyldYCAZ7TA5mZSqKAlwS3MbpKeVE7FNaoWiav55BYQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;821&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所以我们可以换一个结构，使用哈希表来缓存它们间的映射关系，时间复杂度是&lt;code&gt;O(1)&lt;/code&gt;。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;220&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.3940345368916798&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzdaQ9TAP6m07jrcMAMGh8pUw8Hzlj1HBZ8XMrOXZfoicfIEoQ227KU2w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;637&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;表空间号+数据页号&lt;/strong&gt;，作为一个&lt;code&gt;key&lt;/code&gt;，然后缓存页的地址作为&lt;code&gt;value&lt;/code&gt;。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;每次加载数据页到空闲缓存页时，就写入一条映射关系到&lt;strong&gt;缓存页哈希表&lt;/strong&gt;中。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;413&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.7392739273927392&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzPfxia6zvzUqI4SJD9PpSVavh5sEFF0HGkdR9gAWNA1Ooa3G3QYeouIw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1212&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;后续的查询，就可以通过&lt;strong&gt;缓存页哈希表&lt;/strong&gt;路由定位了。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;Flush链表&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;还记得之前有说过「&lt;strong&gt;空闲时会有异步线程做缓存页刷盘，保证数据的持久性与完整性&lt;/strong&gt;」吗？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;新问题来了，难道每次把&lt;code&gt;Buffer Pool&lt;/code&gt;里所有的缓存页都刷入磁盘吗？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然不能这样做，磁盘&lt;code&gt;IO&lt;/code&gt;开销太大了，应该把&lt;strong&gt;脏页&lt;/strong&gt;刷入磁盘才对（更新过的缓存页）。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可是我们怎么知道，那些缓存页是&lt;strong&gt;脏页&lt;/strong&gt;？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;很简单，参照&lt;code&gt;free&lt;/code&gt;链表，弄个&lt;code&gt;flush&lt;/code&gt;链表出来就好了，只要缓存页被更新，就将它的&lt;strong&gt;描述数据&lt;/strong&gt;加入&lt;code&gt;flush&lt;/code&gt;链表。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;针对&lt;code&gt;flush&lt;/code&gt;链表我们要做如下设计&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;新增&lt;code&gt;flush&lt;/code&gt;基础节点&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;描述数据添加&lt;code&gt;flush&lt;/code&gt;节点指针&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;200&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.3584905660377358&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSz2k4gicPfHicSqcHqeTtFGH9Pb7n1Wxo0pRETAZJtszz9xhd3kULstz1Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1007&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最终呈现出来的，是由更新过数据的缓存页&lt;strong&gt;描述数据&lt;/strong&gt;组成的&lt;code&gt;flush&lt;/code&gt;链表。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;527&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.9451114922813036&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSz79jHx0d2xicwGHvdAFZlckSdwgoMWHbFTjwml1HmbVwcUrzFTJCTonA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;583&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;后续异步线程都从&lt;code&gt;flush&lt;/code&gt;链表刷缓存页，当&lt;code&gt;Buffer Pool&lt;/code&gt;内存不足时，也会优先刷&lt;code&gt;flush&lt;/code&gt;链表里的缓存页。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;LRU链表&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前看来&lt;code&gt;Buffer Pool&lt;/code&gt;的功能已经比较完善了。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;452&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.8096885813148789&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzg2yibXsUFugyX1h0ZT1ct5ec4hWeqcUdlKEOHf9ic9Cc2EBIUXIvia4lA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1156&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但是仔细思考下，发现还有一个问题没处理。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;MySQL&lt;/code&gt;数据库随着系统的运行会不停的把磁盘上的数据页加载到空闲的缓存页里去，因此&lt;code&gt;free&lt;/code&gt;链表中的空闲缓存页会越来越少，直到没有，最后磁盘的数据页无法加载。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;326&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.5849731663685152&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzMcVVTk5SXaNgUppwdYRrXjE3bzFSg4vZeU8C5MdXukUicSzAItmEKqw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1118&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了解决这个问题，我们需要淘汰缓存页，腾出空闲缓存页。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可是我们要优先淘汰那些缓存页？总不能一股脑直接全部淘汰吧？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里就要借鉴&lt;code&gt;LRU&lt;/code&gt;算法思想，把最少使用的缓存页淘汰（命中率低），提供&lt;code&gt;LRU&lt;/code&gt;链表出来。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;针对&lt;code&gt;LRU&lt;/code&gt;链表我们要做如下设计&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;188&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.33724340175953077&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzOMdrlAGb7xNyibq6GrZicDsJbjg5P0HvRJnxENdZnD3icNC6bia1RBK5ZQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1023&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;实现思路也很简单，只要是查询或修改过缓存页，就把该缓存页的描述数据放入链表头部，也就说近期访问的数据一定在链表头部。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;165&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.296086508753862&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSz7baibQA3lUtkbvibOctreMl8wK21DBuTWvqfL12hSO3lwliajicAlZdA1Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1942&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当&lt;code&gt;free&lt;/code&gt;链表为空的时候，直接淘汰&lt;code&gt;LRU&lt;/code&gt;链表尾部缓存页即可。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;LRU链表优化&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;麻雀虽小五脏俱全，基本&lt;code&gt;Buffer Pool&lt;/code&gt;里与缓存页相关的组件齐全了。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;428&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.7663551401869159&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzW0ToicMUfI2CjMJ6dsZcy3VvXF1RsWbQOIkmdB6LqqBib0G55ia7Tu1ng/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1284&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但是缓存页淘汰这里还有点问题，如果仅仅只是使用&lt;code&gt;LRU&lt;/code&gt;链表的机制，有两个场景会让&lt;strong&gt;热点数据&lt;/strong&gt;被淘汰。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;预读机制是指&lt;code&gt;MySQL&lt;/code&gt;加载数据页时，可能会把它相邻的数据页一并加载进来（局部性原理）。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这样会带来一个问题，预读进来的数据页，其实我们没有访问，但是它却排在前面。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;280&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.5011210762331838&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSz9YnRHPpZBwCgics3UXVibtZdGOJnUfrvkdU2bmMZW0NPhUSj27P37vwg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;892&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;正常来说，淘汰缓存页时，应该把这个预读的淘汰，结果却把尾部的淘汰了，这是不合理的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们接着来看第二个场景全表扫描，如果&lt;strong&gt;表数据量大&lt;/strong&gt;，大量的数据页会把空闲缓存页用完。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最终&lt;code&gt;LRU&lt;/code&gt;链表前面都是全表扫描的数据，之前频繁访问的热点数据全部到队尾了，淘汰缓存页时就把&lt;strong&gt;热点数据页&lt;/strong&gt;给淘汰了。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;262&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.46986607142857145&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzN6rP6mMyb4Xm77xaq6uFMuibExtlXiaYt1PS3GSFWhLnB6wyXt8CMXoA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;896&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了解决上述的问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们需要给&lt;code&gt;LRU&lt;/code&gt;链表做冷热数据分离设计，把&lt;code&gt;LRU&lt;/code&gt;链表按一定比例，分为冷热区域，热区域称为&lt;code&gt;young&lt;/code&gt;区域，冷区域称为&lt;code&gt;old&lt;/code&gt;区域。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;以7:3为例，young区域70%，old`区域30%&lt;/strong&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-backh=&quot;178&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.31882202304737517&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nzibSg1dO1RTZY5uYMEsAgSzk1DKfvTzGyQVv6ZKWmR7cFRSFy3B2VWNqksred9hUjw7vWic1iayUMjA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1562&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如上图所示，数据页第一次加载进缓存页的时候，是先放入冷数据区域的头部，如果1秒后再次访问缓存页，则会移动到热区域的头部。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这样就保证了&lt;strong&gt;预读机制&lt;/strong&gt;与&lt;strong&gt;全表扫描&lt;/strong&gt;加载的数据都在链表队尾。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;young&lt;/code&gt;区域其实还可以做一个小优化，为了防止&lt;code&gt;young&lt;/code&gt;区域节点频繁移动到表头。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;young&lt;/code&gt;区域前面&lt;code&gt;1/4&lt;/code&gt;被访问不会移动到链表头部，只有后面的&lt;code&gt;3/4&lt;/code&gt;被访问了才会。&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;记住是按照某个比例将&lt;code&gt;LRU&lt;/code&gt;链表分成两部分，不是某些节点固定是&lt;code&gt;young&lt;/code&gt;区域的，某些节点固定是&lt;code&gt;old&lt;/code&gt;区域的，随着程序的运行，某个节点所属的区域也可能发生变化。&lt;/p&gt;&lt;/blockquote&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;小结&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其实&lt;code&gt;MySQL&lt;/code&gt;就是这样实现&lt;code&gt;Buffer Pool&lt;/code&gt;缓存页的，只不过它里面的链表全&lt;strong&gt;是双向链表&lt;/strong&gt;，阿星这里偷个懒，但是不影响理解思路。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;读到这里，我相信大家对&lt;code&gt;Buffer Pool&lt;/code&gt;缓存页有了深刻的认知，也知道从一个增删改查开始，如何缓存数据、定位缓存、缓存刷盘、缓存淘汰。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里留问题给大家思考，&lt;code&gt;Free、Flush、LRU&lt;/code&gt;这三个链表之间的联系，随着&lt;code&gt;MySQL&lt;/code&gt;一直在运行，它们会产生怎样的联动。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;MySQL好文推荐&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;/&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;非常感谢各位小哥哥小姐姐们能看到这里，原创不易，文章有帮助可以关注、点个赞、分享与评论，都是支持（莫要白嫖）！&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;愿你我都能奔赴在各自想去的路上，我们下篇文章见。&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzAwMDg2OTAxNg==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/23OQmC1ia8nziaXQQjkzSxQkAmbFAzI9BLo4UHedGwVNmDuNZa8BvPSOI7V8ibNdHXFt89c7xrY9YvibafERPUubtQ/0?wx_fmt=png&quot; data-nickname=&quot;程序猿阿星&quot; data-alias=&quot;cxyax1993&quot; data-signature=&quot;一起成长进阶！专注技术原理、源码，通过图解方式输出技术，这里将会分享操作系统、计算机网络、Java、分布式、数据库等精品原创文章&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;/section&gt;
          &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>fbb311756cccbd7cf2de8e61b2aea4b4</guid>
<title>学会Sequelize，让你操作数据更丝滑</title>
<link>https://toutiao.io/k/xs21vtq</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzIxNjgwMDIzMA==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/udZl15qqib0OiahcrjrJncW0GOiclg6Jic6IQHYeIGzfXSbZicLUeUxNyQVmPSelMxQxTSu8wAibsyXjy9U3pVfic7FGA/0?wx_fmt=png&quot; data-nickname=&quot;全栈前端精选&quot; data-alias=&quot;Just_FED&quot; data-signature=&quot;内容为王，精选为则。从前端到全栈，定期分享前端、客户端、Node、面试、职场感悟等相关高质量文章。小白的大神养成记，你我共勉！&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;Sequelize 是一个基于 promise 的 Node.js ORM, 目前支持 Postgres, MySQL, MariaDB, SQLite 以及 Microsoft SQL Server. 它具有强大的事务支持, 关联关系, 预读和延迟加载,读取复制等功能。&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;一、前言&lt;/span&gt;&lt;/h2&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;本文希望通过下面的知识讲解及一些实战经验分享，给予即将入门或正在学习的同学一些帮助。&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在之前刚接触 &lt;code&gt;Sequelize&lt;/code&gt; 的时候，遇到挺多问题，比如数据的聚合统计应该怎么做？复杂的排序规则应该怎么写？索引这块应该如何定义？性能如何衡量？等等这些问题，后来经过自己的琢磨及与后台人员交流探讨，这些问题都得予解决。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们直接进入主题，学习目录结构如下：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;二、入门&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;1.配置&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;module&lt;/span&gt;.exports = &lt;span&gt;&lt;span&gt;()&lt;/span&gt; =&amp;gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;const&lt;/span&gt; config = (exports = {})&lt;br/&gt; config.sequelize = {&lt;br/&gt;  &lt;span&gt;//支持的数据库类型&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;dialect&lt;/span&gt;: &lt;span&gt;&#x27;mysql&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;//连接数据库的主机&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;host&lt;/span&gt;: &lt;span&gt;&#x27;localhost&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;//连接数据库的端口&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;port&lt;/span&gt;: &lt;span&gt;3306&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;//数据库名称&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;database&lt;/span&gt;: &lt;span&gt;&#x27;db_test&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;//数据库用户名&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;username&lt;/span&gt;: &lt;span&gt;&#x27;root&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;//数据库密码&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;password&lt;/span&gt;: &lt;span&gt;&#x27;xxxxxx&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;//设置标准时区&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;timezone&lt;/span&gt;: &lt;span&gt;&#x27;+08:00&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;//配置&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;dialectOptions&lt;/span&gt;: {&lt;br/&gt;    &lt;span&gt;// 时间格式化，返回字符串&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;dateStrings&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;    typeCast(field, next) {&lt;br/&gt;      &lt;span&gt;if&lt;/span&gt; (field.type === &lt;span&gt;&#x27;DATETIME&#x27;&lt;/span&gt;) {&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; field.string()&lt;br/&gt;      }&lt;br/&gt;      &lt;span&gt;return&lt;/span&gt; next()&lt;br/&gt;    }&lt;br/&gt;  }&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; config&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;注：如果没有加 &lt;code&gt;dialectOptions&lt;/code&gt; 配置上的 &lt;code&gt;typeCast&lt;/code&gt; 属性值为 &lt;code&gt;true&lt;/code&gt;的话，返回的时间是 &lt;code&gt;ISO&lt;/code&gt; 标准时间日期字符。（如：&#x27;2022-04-16T15:02:08.017Z&#x27;）&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;2.创建模型&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2.1 常用数据类型&lt;span/&gt;&lt;/h4&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;类型&lt;/th&gt;&lt;th&gt;说明&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;INTEGER&lt;/td&gt;&lt;td&gt;整数类型&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;STRING&lt;/td&gt;&lt;td&gt;字符串&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;TEXT&lt;/td&gt;&lt;td&gt;文本类型&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;BOOLEAN&lt;/td&gt;&lt;td&gt;布尔类型&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;DATE&lt;/td&gt;&lt;td&gt;时间类型&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;hr data-tool=&quot;mdnice编辑器&quot;/&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;像数字、字符类型默认都有一些长度的限定，有时候因为长度问题导致接口出错，所以需要根据情况而定。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;还有其他类型就不一一列了，需要用到的可以参照文档看看。&lt;span&gt;Sequelize数据类型&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2.2 定义模型&lt;span/&gt;&lt;/h4&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;module&lt;/span&gt;.exports = &lt;span&gt;(&lt;span&gt;app&lt;/span&gt;) =&amp;gt;&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; { STRING, INTEGER, DATE } = app.Sequelize&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; model = app.model.define(&lt;br/&gt;    &lt;span&gt;&#x27;student&#x27;&lt;/span&gt;,&lt;br/&gt;    {&lt;br/&gt;     &lt;br/&gt;      &lt;span&gt;id&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;//类型&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: INTEGER(&lt;span&gt;11&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;//是否允许为空&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;//是否为主键&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;primaryKey&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;//自动自增&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;autoIncrement&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;//备注&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生id&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;name&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: STRING(&lt;span&gt;50&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生姓名&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;class_id&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: INTEGER(&lt;span&gt;11&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;班级&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;cid&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: STRING(&lt;span&gt;50&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;unique&lt;/span&gt;: &lt;span&gt;&#x27;cid&#x27;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;身份证&#x27;&lt;/span&gt;,&lt;br/&gt;      }&lt;br/&gt;    },&lt;br/&gt;    {&lt;br/&gt;      &lt;span&gt;// 启动时间，设置为ture会自动生成创建和更新时间，默认字段名称为createAt、updateAt。&lt;/span&gt;&lt;br/&gt;      &lt;span&gt;timestamps&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;//对应的表名将与model名相同&lt;/span&gt;&lt;br/&gt;      &lt;span&gt;freezeTableName&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;//表备注&lt;/span&gt;&lt;br/&gt;      &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;表1&#x27;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;//创建时间字段别名或不展示&lt;/span&gt;&lt;br/&gt;      &lt;span&gt;createdAt&lt;/span&gt;: &lt;span&gt;&#x27;createTime&#x27;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;//更新时间字段别名或不展示&lt;/span&gt;&lt;br/&gt;      &lt;span&gt;updatedAt&lt;/span&gt;: &lt;span&gt;&#x27;updateTime&#x27;&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  )&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; model&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;model.sync(options)&lt;/code&gt; 可自动执行 &lt;code&gt;SQL&lt;/code&gt; 语句建表，但这个不建议用，第一这么做容易出现问题，第二我们的规范也不允许这么做。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2.3 表字段规范&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里讲的是我们公司的 &lt;code&gt;SQL&lt;/code&gt; 规范，先来看一个案例：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;`student`&lt;/span&gt; (&lt;br/&gt;  &lt;span&gt;`id`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; AUTO_INCREMENT &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;学生id&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`name`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;50&lt;/span&gt;) &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;学生姓名&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`cid`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;50&lt;/span&gt;) &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;身份证&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`class_id`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;班级&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`create_time`&lt;/span&gt; datetime &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`update_time`&lt;/span&gt; datetime &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;更新时间&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`mobile`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;50&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;手机号&#x27;&lt;/span&gt;,&lt;br/&gt;  PRIMARY &lt;span&gt;KEY&lt;/span&gt; (&lt;span&gt;`id`&lt;/span&gt;),&lt;br/&gt;  &lt;span&gt;UNIQUE&lt;/span&gt; &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`cid_unique`&lt;/span&gt; (&lt;span&gt;`cid`&lt;/span&gt;),&lt;br/&gt;  &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`class_id`&lt;/span&gt; (&lt;span&gt;`class_id`&lt;/span&gt;)&lt;br/&gt;) &lt;span&gt;ENGINE&lt;/span&gt; = &lt;span&gt;InnoDB&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CHARSET&lt;/span&gt; = utf8mb4 &lt;span&gt;COMMENT&lt;/span&gt; = &lt;span&gt;&#x27;学生表&#x27;&lt;/span&gt;;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;审核结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.1793020457280385&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/T81bAV0NNNicmZXVG8OfNgUuXLY9dpgLm6TLMo4H9EsjVdAoANIBGJ1VX4qR1L6kbMMaotS98aaVRp2DFV0l6ibA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1662&quot; title=&quot;审核结果&quot;/&gt;&lt;figcaption&gt;审核结果&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面讲一下基本的设计规范：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;1) 禁用关键字&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在设计的时候注意不要用到关键字，比如 &lt;code&gt;name&lt;/code&gt;、&lt;code&gt;type&lt;/code&gt;、&lt;code&gt;status&lt;/code&gt; 等字段。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;常见关键字：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5688259109311741&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/T81bAV0NNNicmZXVG8OfNgUuXLY9dpgLmowXxPPGGmLb6zD0IIaa2gsjLeqA6Ar1k8Qj5jPSFH4Q3nviaRaL8X0Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1976&quot; title=&quot;关键字&quot;/&gt;&lt;figcaption&gt;关键字&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;2) 字段禁止默认值为null&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;从上面的案例中 &lt;code&gt;mobile&lt;/code&gt; 字段使用了允许为 &lt;code&gt;null&lt;/code&gt; 值，审核平台这块没有强限制，但不建议用 &lt;code&gt;null&lt;/code&gt; 为默认值，很容易出现问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;3) 需要添加字段注释和表注释&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;`student`&lt;/span&gt; (&lt;br/&gt;  &lt;span&gt;`id`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; AUTO_INCREMENT &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;学生id&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`username`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;50&lt;/span&gt;) &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;学生姓名&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`cid`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;50&lt;/span&gt;) &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;身份证&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`class_id`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;班级&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`create_time`&lt;/span&gt; datetime &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;创建时间&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`update_time`&lt;/span&gt; datetime &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;更新时间&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`mobile`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;50&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; &lt;span&gt;COMMENT&lt;/span&gt; &lt;span&gt;&#x27;手机号&#x27;&lt;/span&gt;,&lt;br/&gt;  PRIMARY &lt;span&gt;KEY&lt;/span&gt; (&lt;span&gt;`id`&lt;/span&gt;),&lt;br/&gt;  &lt;span&gt;UNIQUE&lt;/span&gt; &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`cid`&lt;/span&gt; (&lt;span&gt;`cid`&lt;/span&gt;),&lt;br/&gt;  &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`iclass_id`&lt;/span&gt; (&lt;span&gt;`class_id`&lt;/span&gt;)&lt;br/&gt;) &lt;span&gt;ENGINE&lt;/span&gt; = &lt;span&gt;InnoDB&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CHARSET&lt;/span&gt; = utf8mb4 &lt;span&gt;COMMENT&lt;/span&gt; = &lt;span&gt;&#x27;学生表&#x27;&lt;/span&gt;;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;4）创建时间和更新时间字段&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该表中必须含有 &lt;code&gt;create_time&lt;/code&gt; 和 &lt;code&gt;update_time&lt;/code&gt; 字段，如果没有该2个字段的话审核会不通过。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;5) 索引命名&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;唯一索引：必须以 &lt;code&gt;uniq_&lt;/code&gt; 前缀命名。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;普通索引：必须以 &lt;code&gt;idx_&lt;/code&gt; 前缀命名。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6824085005903188&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/T81bAV0NNNicmZXVG8OfNgUuXLY9dpgLmAA6KRbqv1ibP45M3sJAG8SA32Ps7xwat2R0Nl2SwFE2mv6TfibGVvCDA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1694&quot; title=&quot;索引命名&quot;/&gt;&lt;figcaption&gt;索引命名&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;6) 其它&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;以上是常用的基本规范，更多根据自己公司情况而定。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.增删改查&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.1 create&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;创建数据&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; values = {&lt;br/&gt; &lt;span&gt;username&lt;/span&gt;: &lt;span&gt;&#x27;张三&#x27;&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;age&lt;/span&gt;: &lt;span&gt;18&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span&gt;const&lt;/span&gt; result = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.create(values)&lt;br/&gt;&lt;span&gt;console&lt;/span&gt;.log(result)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.2 findAll&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查询数据并返回数组&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; filter = {&lt;br/&gt; &lt;span&gt;username&lt;/span&gt;: &lt;span&gt;&#x27;张三&#x27;&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;age&lt;/span&gt;: &lt;span&gt;18&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span&gt;const&lt;/span&gt; result = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.findAll({&lt;br/&gt; &lt;span&gt;where&lt;/span&gt;: filter&lt;br/&gt;})&lt;br/&gt;&lt;span&gt;console&lt;/span&gt;.log(result)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.3 findAndCountAll&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查询数据并返回总数和数组列表&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; filter = {&lt;br/&gt; &lt;span&gt;username&lt;/span&gt;: &lt;span&gt;&#x27;张三&#x27;&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;age&lt;/span&gt;: &lt;span&gt;18&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span&gt;const&lt;/span&gt; result = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.findAndCountAll({&lt;br/&gt; &lt;span&gt;where&lt;/span&gt;: filter&lt;br/&gt;})&lt;br/&gt;&lt;span&gt;console&lt;/span&gt;.log(result)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.4 findOne&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查询某一条数据返回对象&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; filter = {&lt;br/&gt; &lt;span&gt;id&lt;/span&gt;: &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span&gt;const&lt;/span&gt; result = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.findOne({&lt;br/&gt; &lt;span&gt;where&lt;/span&gt;: filter&lt;br/&gt;})&lt;br/&gt;&lt;span&gt;console&lt;/span&gt;.log(result)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.5 count&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;返回总条数&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; total = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.count()&lt;br/&gt;&lt;span&gt;console&lt;/span&gt;.log(total)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.6 update&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;更新数据&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; value = {&lt;br/&gt; &lt;span&gt;id&lt;/span&gt;: &lt;span&gt;2&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;username&lt;/span&gt;: &lt;span&gt;&#x27;张三&#x27;&lt;/span&gt;,&lt;br/&gt; &lt;span&gt;age&lt;/span&gt;: &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span&gt;const&lt;/span&gt; result = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.update(value)&lt;br/&gt;&lt;span&gt;console&lt;/span&gt;.log(result)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.7 destroy&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;删除数据&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; filter = {&lt;br/&gt; &lt;span&gt;id&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span&gt;const&lt;/span&gt; result = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.destroy({&lt;br/&gt; &lt;span&gt;where&lt;/span&gt;: filter&lt;br/&gt;})&lt;br/&gt;&lt;span&gt;console&lt;/span&gt;.log(result)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.8 其它&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;还有一些其他的方法，具体可以看看&lt;span&gt;Sequelize方法文档&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt;。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;4.查询条件&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个具体的查询用法就不一一说了，根据自己需要的查询条件看下对应的查询功能即可。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;this&lt;/span&gt;.Op = &lt;span&gt;this&lt;/span&gt;.app.Sequelize.Op&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.model.findAll({&lt;br/&gt;  &lt;span&gt;where&lt;/span&gt;: {&lt;br/&gt;    [Op.and]: [{ &lt;span&gt;a&lt;/span&gt;: &lt;span&gt;5&lt;/span&gt; }, { &lt;span&gt;b&lt;/span&gt;: &lt;span&gt;6&lt;/span&gt; }],            &lt;span&gt;// (a = 5) AND (b = 6)&lt;/span&gt;&lt;br/&gt;    [Op.or]: [{ &lt;span&gt;a&lt;/span&gt;: &lt;span&gt;5&lt;/span&gt; }, { &lt;span&gt;b&lt;/span&gt;: &lt;span&gt;6&lt;/span&gt; }],             &lt;span&gt;// (a = 5) OR (b = 6)&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;someAttribute&lt;/span&gt;: {&lt;br/&gt;      &lt;span&gt;// 基本&lt;/span&gt;&lt;br/&gt;      [Op.eq]: &lt;span&gt;3&lt;/span&gt;,                              &lt;span&gt;// = 3&lt;/span&gt;&lt;br/&gt;      [Op.ne]: &lt;span&gt;20&lt;/span&gt;,                             &lt;span&gt;// != 20&lt;/span&gt;&lt;br/&gt;      [Op.is]: &lt;span&gt;null&lt;/span&gt;,                           &lt;span&gt;// IS NULL&lt;/span&gt;&lt;br/&gt;      [Op.not]: &lt;span&gt;true&lt;/span&gt;,                          &lt;span&gt;// IS NOT TRUE&lt;/span&gt;&lt;br/&gt;      [Op.or]: [&lt;span&gt;5&lt;/span&gt;, &lt;span&gt;6&lt;/span&gt;],                         &lt;span&gt;// (someAttribute = 5) OR (someAttribute = 6)&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;      &lt;span&gt;// 使用方言特定的列标识符 (以下示例中使用 PG):&lt;/span&gt;&lt;br/&gt;      [Op.col]: &lt;span&gt;&#x27;user.organization_id&#x27;&lt;/span&gt;,        &lt;span&gt;// = &quot;user&quot;.&quot;organization_id&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;      &lt;span&gt;// 数字比较&lt;/span&gt;&lt;br/&gt;      [Op.gt]: &lt;span&gt;6&lt;/span&gt;,                              &lt;span&gt;// &amp;gt; 6&lt;/span&gt;&lt;br/&gt;      [Op.gte]: &lt;span&gt;6&lt;/span&gt;,                             &lt;span&gt;// &amp;gt;= 6&lt;/span&gt;&lt;br/&gt;      [Op.lt]: &lt;span&gt;10&lt;/span&gt;,                             &lt;span&gt;// &amp;lt; 10&lt;/span&gt;&lt;br/&gt;      [Op.lte]: &lt;span&gt;10&lt;/span&gt;,                            &lt;span&gt;// &amp;lt;= 10&lt;/span&gt;&lt;br/&gt;      [Op.between]: [&lt;span&gt;6&lt;/span&gt;, &lt;span&gt;10&lt;/span&gt;],                   &lt;span&gt;// BETWEEN 6 AND 10&lt;/span&gt;&lt;br/&gt;      [Op.notBetween]: [&lt;span&gt;11&lt;/span&gt;, &lt;span&gt;15&lt;/span&gt;],               &lt;span&gt;// NOT BETWEEN 11 AND 15&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;      &lt;span&gt;// 其它操作符&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;      [Op.all]: sequelize.literal(&lt;span&gt;&#x27;SELECT 1&#x27;&lt;/span&gt;), &lt;span&gt;// &amp;gt; ALL (SELECT 1)&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;      [Op.in]: [&lt;span&gt;1&lt;/span&gt;, &lt;span&gt;2&lt;/span&gt;],                         &lt;span&gt;// IN [1, 2]&lt;/span&gt;&lt;br/&gt;      [Op.notIn]: [&lt;span&gt;1&lt;/span&gt;, &lt;span&gt;2&lt;/span&gt;],                      &lt;span&gt;// NOT IN [1, 2]&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;      [Op.like]: &lt;span&gt;&#x27;%hat&#x27;&lt;/span&gt;,                       &lt;span&gt;// LIKE &#x27;%hat&#x27;&lt;/span&gt;&lt;br/&gt;      [Op.notLike]: &lt;span&gt;&#x27;%hat&#x27;&lt;/span&gt;,                    &lt;span&gt;// NOT LIKE &#x27;%hat&#x27;&lt;/span&gt;&lt;br/&gt;      [Op.startsWith]: &lt;span&gt;&#x27;hat&#x27;&lt;/span&gt;,                  &lt;span&gt;// LIKE &#x27;hat%&#x27;&lt;/span&gt;&lt;br/&gt;      [Op.endsWith]: &lt;span&gt;&#x27;hat&#x27;&lt;/span&gt;,                    &lt;span&gt;// LIKE &#x27;%hat&#x27;&lt;/span&gt;&lt;br/&gt;      [Op.substring]: &lt;span&gt;&#x27;hat&#x27;&lt;/span&gt;,                   &lt;span&gt;// LIKE &#x27;%hat%&#x27;&lt;/span&gt;&lt;br/&gt;      [Op.iLike]: &lt;span&gt;&#x27;%hat&#x27;&lt;/span&gt;,                      &lt;span&gt;// ILIKE &#x27;%hat&#x27; (不区分大小写) (仅 PG)&lt;/span&gt;&lt;br/&gt;      [Op.notILike]: &lt;span&gt;&#x27;%hat&#x27;&lt;/span&gt;,                   &lt;span&gt;// NOT ILIKE &#x27;%hat&#x27;  (仅 PG)&lt;/span&gt;&lt;br/&gt;      [Op.regexp]: &lt;span&gt;&#x27;^[h|a|t]&#x27;&lt;/span&gt;,                 &lt;span&gt;// REGEXP/~ &#x27;^[h|a|t]&#x27; (仅 MySQL/PG)&lt;/span&gt;&lt;br/&gt;      [Op.notRegexp]: &lt;span&gt;&#x27;^[h|a|t]&#x27;&lt;/span&gt;,              &lt;span&gt;// NOT REGEXP/!~ &#x27;^[h|a|t]&#x27; (仅 MySQL/PG)&lt;/span&gt;&lt;br/&gt;      [Op.iRegexp]: &lt;span&gt;&#x27;^[h|a|t]&#x27;&lt;/span&gt;,                &lt;span&gt;// ~* &#x27;^[h|a|t]&#x27; (仅 PG)&lt;/span&gt;&lt;br/&gt;      [Op.notIRegexp]: &lt;span&gt;&#x27;^[h|a|t]&#x27;&lt;/span&gt;,             &lt;span&gt;// !~* &#x27;^[h|a|t]&#x27; (仅 PG)&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;      [Op.any]: [&lt;span&gt;2&lt;/span&gt;, &lt;span&gt;3&lt;/span&gt;],                        &lt;span&gt;// ANY ARRAY[2, 3]::INTEGER (仅 PG)&lt;/span&gt;&lt;br/&gt;      [Op.match]: Sequelize.fn(&lt;span&gt;&#x27;to_tsquery&#x27;&lt;/span&gt;, &lt;span&gt;&#x27;fat &amp;amp; rat&#x27;&lt;/span&gt;) &lt;span&gt;// 匹配文本搜索字符串 &#x27;fat&#x27; 和 &#x27;rat&#x27; (仅 PG)&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;      &lt;span&gt;// 在 Postgres 中, Op.like/Op.iLike/Op.notLike 可以结合 Op.any 使用:&lt;/span&gt;&lt;br/&gt;      [Op.like]: { [Op.any]: [&lt;span&gt;&#x27;cat&#x27;&lt;/span&gt;, &lt;span&gt;&#x27;hat&#x27;&lt;/span&gt;] }  &lt;span&gt;// LIKE ANY ARRAY[&#x27;cat&#x27;, &#x27;hat&#x27;]&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  }&lt;br/&gt;});&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;三、进阶&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;1.联表查询&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;1.1 一对一&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如学生表和身份证表，一名学生只会有一个身份证号码，一张身份证只会对应一名学生。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这种就是一对一的关系，如图：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.49171270718232046&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/T81bAV0NNNicmZXVG8OfNgUuXLY9dpgLmBYS72BcXIvTg8aEBAxJCYRQn8qaGUylA1bIPKYiaK3l73ibFE9DynpCQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1086&quot; title=&quot;一对一&quot;/&gt;&lt;figcaption&gt;一对一&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;假如学生表作为主表，身份证表作为副表，那边这张副表的外键就是学生表的id。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在使用 &lt;code&gt;Sequelize&lt;/code&gt; 库中，我们想通过学生表关联到相应的身份证表信息，可通过 &lt;code&gt;hasOne&lt;/code&gt; 方法做关联：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;student.hasOne(card, {&lt;span&gt;foreignKey&lt;/span&gt; : &lt;span&gt;&#x27;id&#x27;&lt;/span&gt;});&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果我们想通过身份证表反向关联到学生表，这是可以用 &lt;code&gt;belongsTo&lt;/code&gt; 方法做关联：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;card.belongsTo(student, {&lt;span&gt;foreignKey&lt;/span&gt; : &lt;span&gt;&#x27;cid&#x27;&lt;/span&gt;});&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;总结一下 &lt;code&gt;hasOne&lt;/code&gt; 和 &lt;code&gt;belongsTo&lt;/code&gt; 的区别：&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;方法&lt;/th&gt;&lt;th&gt;说明&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;hasOne&lt;/td&gt;&lt;td&gt;正向关联，可以理解为一名学生拥有一张身份证。&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;belongsTo&lt;/td&gt;&lt;td&gt;反向关联，可以理解为一张身份证属于一名学生。&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;1.2 一对多&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如学生表和班级表，一名学生只有一个班级，一个班级由多名学生组成，这种是一对多（多对一）的关系，如图：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.578853046594982&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/T81bAV0NNNicmZXVG8OfNgUuXLY9dpgLm5GgbGloG9CvxqkhJqdEhWkPhD97IJB0dffgoOt8CH4CzPONCtKrv6Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1116&quot; title=&quot;一对多&quot;/&gt;&lt;figcaption&gt;一对多&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在使用 &lt;code&gt;Sequelize&lt;/code&gt; 库中，可通过 &lt;code&gt;hasMany&lt;/code&gt; 方法做关联：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt;.&lt;span&gt;hasMany&lt;/span&gt;(&lt;span&gt;student&lt;/span&gt;, &lt;/span&gt;{foreignKey : &lt;span&gt;&#x27;class_id&#x27;&lt;/span&gt;});&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;1.3 多对多&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如学生表和课程表，一名学生可以有多门课程，一门课程可以由多名学生参与，这种是多对多的关系，如图：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4672897196261682&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/T81bAV0NNNicmZXVG8OfNgUuXLY9dpgLm9JrstVzIXiarwUmOYM6RH9sUFmOkk5kGaVT3Zg53ObsOzVSocqibr8lw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1498&quot; title=&quot;多对多&quot;/&gt;&lt;figcaption&gt;多对多&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在使用 &lt;code&gt;Sequelize&lt;/code&gt; 库中，可通过 &lt;code&gt;belongsToMany&lt;/code&gt; 方法做关联：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; Student = sequelize.define(&lt;span&gt;&#x27;Student&#x27;&lt;/span&gt;, { &lt;span&gt;name&lt;/span&gt;: DataTypes.STRING });&lt;br/&gt;&lt;span&gt;const&lt;/span&gt; Course = sequelize.define(&lt;span&gt;&#x27;Course&#x27;&lt;/span&gt;, { &lt;span&gt;name&lt;/span&gt;: DataTypes.STRING });&lt;br/&gt;&lt;span&gt;const&lt;/span&gt; StudentCourse = sequelize.define(&lt;span&gt;&#x27;StudentCourse&#x27;&lt;/span&gt;, {&lt;br/&gt;  &lt;span&gt;studentId&lt;/span&gt;: {&lt;br/&gt;    &lt;span&gt;type&lt;/span&gt;: DataTypes.INTEGER,&lt;br/&gt;    &lt;span&gt;references&lt;/span&gt;: {&lt;br/&gt;      &lt;span&gt;model&lt;/span&gt;: Student,&lt;br/&gt;      &lt;span&gt;key&lt;/span&gt;: &lt;span&gt;&#x27;id&#x27;&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  },&lt;br/&gt;  &lt;span&gt;courseId&lt;/span&gt;: {&lt;br/&gt;    &lt;span&gt;type&lt;/span&gt;: DataTypes.INTEGER,&lt;br/&gt;    &lt;span&gt;references&lt;/span&gt;: {&lt;br/&gt;      &lt;span&gt;model&lt;/span&gt;: Course,&lt;br/&gt;      &lt;span&gt;key&lt;/span&gt;: &lt;span&gt;&#x27;id&#x27;&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  }&lt;br/&gt;});&lt;br/&gt;Student.belongsToMany(Course, { &lt;span&gt;through&lt;/span&gt;: StudentCourse });&lt;br/&gt;Course.belongsToMany(Student, { &lt;span&gt;through&lt;/span&gt;: StudentCourse });&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;1.4 联表查询优劣&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;优点：联表查询用起来很方便，不需要做太多了处理，尤其在 B 端场景会用的比较多。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;缺点：对于 C 端这种流量较大场景，使用联表查询效率会很低下，可能会导致服务器崩溃，所以现在大多数在 C 端都不采用 SQL 自带的联表查询功能，一般会通过代码逻辑来处理，大大减少查询效率。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;有兴趣的可以了解下 &lt;code&gt;mysql&lt;/code&gt; 联表查询的步骤是怎样的，这样对比起来会更加直观一点。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;2.分组&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;举个例子，你想对订单各个状态的数量进行一个统计，你应该会怎么做？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在之前不知道分组这个功能时，我是这么做的：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; obj = {}&lt;br/&gt;obj.problemAmoumt = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.count()&lt;br/&gt;obj.resolvedAmoumt = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.count({&lt;br/&gt;  &lt;span&gt;where&lt;/span&gt;: {&lt;br/&gt;    &lt;span&gt;problemStatus&lt;/span&gt;:&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;  }&lt;br/&gt;})&lt;br/&gt;&lt;span&gt;return&lt;/span&gt; ctx.returnStatus.SUCCESS(obj)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这似乎看起来很粗暴。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;后来发现可通过 SQL 语句中的 &lt;code&gt;group&lt;/code&gt; 进行一个分组，&lt;code&gt;group&lt;/code&gt; 是指定要进行分组的字段，示例如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;this&lt;/span&gt;.model.count({&lt;br/&gt; &lt;span&gt;attributes&lt;/span&gt;: [&lt;span&gt;&#x27;order_status&#x27;&lt;/span&gt;],&lt;br/&gt; &lt;span&gt;group&lt;/span&gt;: &lt;span&gt;&#x27;order_status&#x27;&lt;/span&gt;&lt;br/&gt;})&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最终转换成 SQL 语句如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;SELECT&lt;/span&gt; &lt;span&gt;`order_status`&lt;/span&gt;, &lt;span&gt;count&lt;/span&gt;(*) &lt;span&gt;AS&lt;/span&gt; &lt;span&gt;`count`&lt;/span&gt; &lt;span&gt;FROM&lt;/span&gt; &lt;span&gt;`order_list`&lt;/span&gt; &lt;span&gt;AS&lt;/span&gt; &lt;span&gt;`order_list`&lt;/span&gt; &lt;span&gt;GROUP&lt;/span&gt; &lt;span&gt;BY&lt;/span&gt; &lt;span&gt;`order_status`&lt;/span&gt;;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;返回结果&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;[&lt;br/&gt; {&lt;br/&gt;     &lt;span&gt;&quot;order_status&quot;&lt;/span&gt;: 1,&lt;br/&gt;     &lt;span&gt;&quot;count&quot;&lt;/span&gt;: 4&lt;br/&gt; },&lt;br/&gt; {&lt;br/&gt;     &lt;span&gt;&quot;order_status&quot;&lt;/span&gt;: 2,&lt;br/&gt;     &lt;span&gt;&quot;count&quot;&lt;/span&gt;: 2&lt;br/&gt; },&lt;br/&gt; {&lt;br/&gt;     &lt;span&gt;&quot;order_status&quot;&lt;/span&gt;: 3,&lt;br/&gt;     &lt;span&gt;&quot;count&quot;&lt;/span&gt;: 2&lt;br/&gt; }&lt;br/&gt;]&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;思考：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1.分组在应用时会不会有坑？自己在使用时可以看看。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2.如果想对 &lt;code&gt;order_status&lt;/code&gt; 进行一个别名 &lt;code&gt;bbb&lt;/code&gt; 字段返回，这时的查询语句应该如何调整？&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.聚合函数&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.1 count&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;统计总数，比如统计各个订单的数量：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;this&lt;/span&gt;.model.findAll({&lt;br/&gt;  &lt;span&gt;attributes&lt;/span&gt;: [&lt;br/&gt;    &lt;span&gt;&#x27;orderStatus&#x27;&lt;/span&gt;,&lt;br/&gt;    [sequelize.fn(&lt;span&gt;&#x27;count&#x27;&lt;/span&gt;, sequelize.col(&lt;span&gt;&#x27;order_status&#x27;&lt;/span&gt;)), &lt;span&gt;&#x27;total&#x27;&lt;/span&gt;]&lt;br/&gt;  ],&lt;br/&gt;  &lt;span&gt;group&lt;/span&gt;: &lt;span&gt;&#x27;orderStatus&#x27;&lt;/span&gt;&lt;br/&gt;})&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.2 sum&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;求和，比如统计全部同学的成绩总数：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;this&lt;/span&gt;.model.findAll({&lt;br/&gt;  &lt;span&gt;attributes&lt;/span&gt;: [&lt;br/&gt;    [sequelize.fn(&lt;span&gt;&#x27;sum&#x27;&lt;/span&gt;, sequelize.col(&lt;span&gt;&#x27;score&#x27;&lt;/span&gt;)), &lt;span&gt;&#x27;score&#x27;&lt;/span&gt;]&lt;br/&gt;  ]&lt;br/&gt;})&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.3 max&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查询最大值，比如找到这个分数最高的同学：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;this.model.findAll({&lt;br/&gt;  attributes: [&lt;br/&gt;    [sequelize.fn(&lt;span&gt;&#x27;max&#x27;&lt;/span&gt;, sequelize.col(&lt;span&gt;&#x27;score&#x27;&lt;/span&gt;)), &lt;span&gt;&#x27;score&#x27;&lt;/span&gt;]&lt;br/&gt;  ]&lt;br/&gt;})&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3.4 min&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;查询最小值，比如找到这个分数最低的同学：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;this&lt;/span&gt;.model.findAll({&lt;br/&gt;  &lt;span&gt;attributes&lt;/span&gt;: [&lt;br/&gt;    [sequelize.fn(&lt;span&gt;&#x27;min&#x27;&lt;/span&gt;, sequelize.col(&lt;span&gt;&#x27;score&#x27;&lt;/span&gt;)), &lt;span&gt;&#x27;score&#x27;&lt;/span&gt;]&lt;br/&gt;  ]&lt;br/&gt;})&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然这些方法也可以通过 &lt;code&gt;this.model.方法(字段名称)&lt;/code&gt; 来实现，参数为指定的字段。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;4 索引&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;索引就是一种将数据库中的记录按照特殊形式存储的数据结构。通过索引，能够提高数据查询的效率，从而提升服务器的性能。&lt;/p&gt;&lt;/blockquote&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;4.1 主键索引&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一个表只能由一个主键索引，且不为空。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可通过 &lt;code&gt;primaryKey&lt;/code&gt; 属性来设置主键，通常会把 &lt;code&gt;id&lt;/code&gt; 设为该表的主键，当然你也可以指定其它字段来作为主键，该字段值必须是唯一的。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt; &lt;span&gt;const&lt;/span&gt; student = app.model.define(&lt;br/&gt;    &lt;span&gt;&#x27;student&#x27;&lt;/span&gt;,&lt;br/&gt;    {&lt;br/&gt;      &lt;span&gt;id&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: INTEGER(&lt;span&gt;11&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;primaryKey&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;autoIncrement&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;default&lt;/span&gt;: &lt;span&gt;10000&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生id&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;name&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: STRING(&lt;span&gt;50&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生姓名&#x27;&lt;/span&gt;,&lt;br/&gt;      }&lt;br/&gt;    }&lt;br/&gt; )&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; student&lt;br/&gt;      &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;4.2 唯一索引&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;唯一索引的列的值必须唯一，但是允许出现空值。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可通过 &lt;code&gt;unique&lt;/code&gt; 属性设置为唯一索引，值为 &lt;code&gt;true&lt;/code&gt; 的话，索引名称会自动生成，也可以设置为自定义索引名称。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt; &lt;span&gt;const&lt;/span&gt; student = app.model.define(&lt;br/&gt;    &lt;span&gt;&#x27;student&#x27;&lt;/span&gt;,&lt;br/&gt;    {&lt;br/&gt;      &lt;span&gt;id&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: INTEGER(&lt;span&gt;11&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;primaryKey&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;autoIncrement&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;default&lt;/span&gt;: &lt;span&gt;10000&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生id&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;name&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: STRING(&lt;span&gt;50&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生姓名&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;cid&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: STRING(&lt;span&gt;50&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;unique&lt;/span&gt;: &lt;span&gt;&#x27;cid_unique&#x27;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;身份证&#x27;&lt;/span&gt;,&lt;br/&gt;      }&lt;br/&gt;    }&lt;br/&gt; )&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; student&lt;br/&gt;      &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;4.3 组合索引&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用多个列组合构建的索引，这多个列中的值不允许有空值。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; student = app.model.define(&lt;br/&gt;    &lt;span&gt;&#x27;student&#x27;&lt;/span&gt;,&lt;br/&gt;    {&lt;br/&gt;      &lt;span&gt;id&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: INTEGER(&lt;span&gt;11&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;primaryKey&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;autoIncrement&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;default&lt;/span&gt;: &lt;span&gt;10000&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生id&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;name&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: STRING(&lt;span&gt;50&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生姓名&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;class_id&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: INTEGER(&lt;span&gt;11&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;班级&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;cid&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: STRING(&lt;span&gt;50&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;unique&lt;/span&gt;: &lt;span&gt;&#x27;cid&#x27;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;身份证&#x27;&lt;/span&gt;,&lt;br/&gt;      }&lt;br/&gt;    },&lt;br/&gt;    {&lt;br/&gt;      &lt;span&gt;indexes&lt;/span&gt;: [{&lt;br/&gt;        &lt;span&gt;name&lt;/span&gt;: &lt;span&gt;&#x27;name&#x27;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;fields&lt;/span&gt;: [&lt;span&gt;&#x27;name&#x27;&lt;/span&gt;]&lt;br/&gt;      }, {&lt;br/&gt;        &lt;span&gt;name&lt;/span&gt;: &lt;span&gt;&#x27;cid&#x27;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;fields&lt;/span&gt;: [&lt;span&gt;&#x27;cid&#x27;&lt;/span&gt;]&lt;br/&gt;      }]&lt;br/&gt;    }&lt;br/&gt;  )&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; student&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;4.4 普通索引&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用表中的普通列构建的索引，没有任何限制。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用法只要在 &lt;code&gt;indexed&lt;/code&gt; 属性里不设置 &lt;code&gt;unique&lt;/code&gt; 字段即可。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; student = app.model.define(&lt;br/&gt;    &lt;span&gt;&#x27;student&#x27;&lt;/span&gt;,&lt;br/&gt;    {&lt;br/&gt;      &lt;span&gt;id&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: INTEGER(&lt;span&gt;11&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;primaryKey&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;autoIncrement&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;default&lt;/span&gt;: &lt;span&gt;10000&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生id&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;name&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: STRING(&lt;span&gt;50&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;学生姓名&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;class_id&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: INTEGER(&lt;span&gt;11&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;班级&#x27;&lt;/span&gt;,&lt;br/&gt;      },&lt;br/&gt;      &lt;span&gt;cid&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;type&lt;/span&gt;: STRING(&lt;span&gt;50&lt;/span&gt;),&lt;br/&gt;        &lt;span&gt;allowNull&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;unique&lt;/span&gt;: &lt;span&gt;&#x27;cid&#x27;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;validate&lt;/span&gt;: {&lt;br/&gt;          &lt;span&gt;notEmpty&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        },&lt;br/&gt;        &lt;span&gt;comment&lt;/span&gt;: &lt;span&gt;&#x27;身份证&#x27;&lt;/span&gt;,&lt;br/&gt;      }&lt;br/&gt;    },&lt;br/&gt;    {&lt;br/&gt;      &lt;span&gt;indexes&lt;/span&gt;: [{&lt;br/&gt;     &lt;span&gt;unique&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;name&lt;/span&gt;: &lt;span&gt;&#x27;name&#x27;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;fields&lt;/span&gt;: [&lt;span&gt;&#x27;name&#x27;&lt;/span&gt;]&lt;br/&gt;      }, {&lt;br/&gt;     &lt;span&gt;unique&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;name&lt;/span&gt;: &lt;span&gt;&#x27;class_id&#x27;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;fields&lt;/span&gt;: [&lt;span&gt;&#x27;class_id&#x27;&lt;/span&gt;]&lt;br/&gt;      }]&lt;br/&gt;    }&lt;br/&gt;  )&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; student&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;4.5 加与不加索引的区别？&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;优点：增加索引会提供查询效率&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;缺点：增加内存空间&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们来看一条查询语句：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;explain&lt;/span&gt; &lt;span&gt;select&lt;/span&gt; * &lt;span&gt;from&lt;/span&gt; &lt;span&gt;`experience_problem_list`&lt;/span&gt; &lt;span&gt;where&lt;/span&gt; &lt;span&gt;`experience_problem_list`&lt;/span&gt;.&lt;span&gt;`page_type`&lt;/span&gt; = &lt;span&gt;2&lt;/span&gt;;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;先看看没加索引的执行结果：&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;type&lt;/th&gt;&lt;th&gt;possible_keys&lt;/th&gt;&lt;th&gt;key&lt;/th&gt;&lt;th&gt;key_len&lt;/th&gt;&lt;th&gt;ref&lt;/th&gt;&lt;th&gt;rows&lt;/th&gt;&lt;th&gt;filtered&lt;/th&gt;&lt;th&gt;Extra&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;ALL&lt;/td&gt;&lt;td&gt;(NULL)&lt;/td&gt;&lt;td&gt;(NULL)&lt;/td&gt;&lt;td&gt;(NULL)&lt;/td&gt;&lt;td&gt;(NULL)&lt;/td&gt;&lt;td&gt;16416&lt;/td&gt;&lt;td&gt;10&lt;/td&gt;&lt;td&gt;(NULL)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表中总共有16416条数据，扫描行数也是16416条。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再看下加了索引的执行结果：&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;type&lt;/th&gt;&lt;th&gt;possible_keys&lt;/th&gt;&lt;th&gt;key&lt;/th&gt;&lt;th&gt;key_len&lt;/th&gt;&lt;th&gt;ref&lt;/th&gt;&lt;th&gt;rows&lt;/th&gt;&lt;th&gt;filtered&lt;/th&gt;&lt;th&gt;Extra&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;ref&lt;/td&gt;&lt;td&gt;page_type&lt;/td&gt;&lt;td&gt;page_type&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;td&gt;const&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;td&gt;100&lt;/td&gt;&lt;td&gt;Using where&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们来看下 &lt;code&gt;rows&lt;/code&gt; 字段的对比，加了索引的扫描行数只有4条，由此可以看到，加索引的查询效率大大高于普通查询。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5.事务&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以理解为一个事务对应的是一组完整的业务，并且在这个事务中所作的一切操作要么全部成功，要么全部失败，只要有一个操作没成功，整个事务都将回滚到事务开始前。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里简单放一个官方使用案例吧：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;// 首先,我们开始一个事务并将其保存到变量中&lt;/span&gt;&lt;br/&gt;&lt;span&gt;const&lt;/span&gt; t = &lt;span&gt;await&lt;/span&gt; sequelize.transaction();&lt;br/&gt;&lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;  &lt;span&gt;// 然后,我们进行一些调用以将此事务作为参数传递:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; user = &lt;span&gt;await&lt;/span&gt; User.create({&lt;br/&gt;    &lt;span&gt;firstName&lt;/span&gt;: &lt;span&gt;&#x27;Bart&#x27;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;lastName&lt;/span&gt;: &lt;span&gt;&#x27;Simpson&#x27;&lt;/span&gt;&lt;br/&gt;  }, { &lt;span&gt;transaction&lt;/span&gt;: t });&lt;br/&gt;  &lt;span&gt;await&lt;/span&gt; user.addSibling({&lt;br/&gt;    &lt;span&gt;firstName&lt;/span&gt;: &lt;span&gt;&#x27;Lisa&#x27;&lt;/span&gt;,&lt;br/&gt;    &lt;span&gt;lastName&lt;/span&gt;: &lt;span&gt;&#x27;Simpson&#x27;&lt;/span&gt;&lt;br/&gt;  }, { &lt;span&gt;transaction&lt;/span&gt;: t });&lt;br/&gt;  &lt;span&gt;// 如果执行到此行,且没有引发任何错误.&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;// 我们提交事务.&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;await&lt;/span&gt; t.commit();&lt;br/&gt;} &lt;span&gt;catch&lt;/span&gt; (error) {&lt;br/&gt;  &lt;span&gt;// 如果执行到达此行,则抛出错误.&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;// 我们回滚事务.&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;await&lt;/span&gt; t.rollback();&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;四、实战演练&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;1.查询数据不想返回内置的数据结构，只想单纯返回纯数据结构怎么处理？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;来看下默认返回查询的数据结果：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;{&lt;br/&gt;  &lt;span&gt;count&lt;/span&gt;: &lt;span&gt;8&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;rows&lt;/span&gt;: [&lt;br/&gt;    student {&lt;br/&gt;      &lt;span&gt;dataValues&lt;/span&gt;: [&lt;span&gt;Object&lt;/span&gt;],&lt;br/&gt;      &lt;span&gt;_previousDataValues&lt;/span&gt;: [&lt;span&gt;Object&lt;/span&gt;],&lt;br/&gt;      &lt;span&gt;uniqno&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;_changed&lt;/span&gt;: &lt;span&gt;Set&lt;/span&gt;(&lt;span&gt;0&lt;/span&gt;) {},&lt;br/&gt;      &lt;span&gt;_options&lt;/span&gt;: [&lt;span&gt;Object&lt;/span&gt;],&lt;br/&gt;      &lt;span&gt;isNewRecord&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  ]&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里 &lt;code&gt;rows&lt;/code&gt; 里面对象返回了很多层，在业务处理时可能取值会不太方便，我们可以在调用方法的参数里加上 &lt;code&gt;raw&lt;/code&gt; 等于 &lt;code&gt;true&lt;/code&gt;，就返回正常的数据格式。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; result = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.findAll({&lt;br/&gt; &lt;span&gt;where&lt;/span&gt;: filter,&lt;br/&gt; &lt;span&gt;raw&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;})&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;返回：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;{&lt;br/&gt;  &lt;span&gt;count&lt;/span&gt;: &lt;span&gt;8&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;rows&lt;/span&gt;: [&lt;br/&gt;    {&lt;br/&gt;      &lt;span&gt;id&lt;/span&gt;: &lt;span&gt;8&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;name&lt;/span&gt;: &lt;span&gt;&#x27;张三&#x27;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;cid&lt;/span&gt;: &lt;span&gt;&#x27;xxx&#x27;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;createTime&lt;/span&gt;: &lt;span&gt;&#x27;2022-04-08 18:06:52&#x27;&lt;/span&gt;,&lt;br/&gt;      &lt;span&gt;updateTime&lt;/span&gt;: &lt;span&gt;&#x27;2022-04-08 18:06:52&#x27;&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;  ]&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;2.如果列表筛选涉及到主副表应该怎么查询合适？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;有几种方案：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1）直接用 &lt;code&gt;mysql&lt;/code&gt; 语句做表关联即可，但性能比较低下。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2）用代码逻辑处理，但写起来可能有点绕，但效率比直接用 &lt;code&gt;mysql&lt;/code&gt; 表关联效率高。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;3）如果主表字段固定且不多的话，可以直接冗余副表中，但如果后续主表加字段的话，副表更新是个问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;4）采用 &lt;code&gt;ES&lt;/code&gt;，将这2张表的数据合并同步到 &lt;code&gt;ES&lt;/code&gt; 的一张表里，但 &lt;code&gt;ES&lt;/code&gt; 使用场景一般都是量很大的，加上 &lt;code&gt;nodejs&lt;/code&gt; 新增其它数据库交互，有额外的开销成本。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;综合以上考虑，如果是内部项目，量也不是很多的话，查询比较复杂的话可以直接采用第一种方法，如果逻辑相对比较简单，也可以采用第二种方法。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;3.分组 group 遇到的问题。&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;group&lt;/code&gt; 只能填写已有的查询字段。比如你表中有这个字段 &lt;code&gt;aaa&lt;/code&gt;，但查询返回的字段 &lt;code&gt;aaa&lt;/code&gt; 被过滤了，这时不能以 &lt;code&gt;aaa&lt;/code&gt; 进行分组。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;4.如何获取今日、最近7天、一个月的数据？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可通过字符串函数 &lt;code&gt;DATE_FORMAT&lt;/code&gt; 实现：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1）首先通过时间选择器获取到今日、最近7天、一个月的开始时间和结束时间。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2）然后使用对改模型使用 &lt;code&gt;count&lt;/code&gt; 进行查询，这时获取到的知识该时期的总条数。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;3）对改数据进行分组，使用 &lt;code&gt;group&lt;/code&gt; 属性，字段为创建的时间，但我们创建的时间是包含时分秒的，如果这么聚合的话，生成的数据并不是我们想到的，我们需要的是针对年月日，所以需要对这个时间进行一个处理。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;[&lt;br/&gt;    {&lt;br/&gt;        &lt;span&gt;&quot;create_time&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-12 17:02:36&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;    },&lt;br/&gt;    {&lt;br/&gt;        &lt;span&gt;&quot;create_time&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-14 17:02:38&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;    },&lt;br/&gt;    {&lt;br/&gt;        &lt;span&gt;&quot;create_time&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-14 17:03:38&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;    },&lt;br/&gt;    {&lt;br/&gt;        &lt;span&gt;&quot;create_time&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-14 17:03:58&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;]&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个显然不是我们想要的一个结果。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;4）然后函数 &lt;code&gt;DATE_FORMAT&lt;/code&gt;，将时间格式化为年月日。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;总体实现如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt; countArr = &lt;span&gt;await&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.model.count({&lt;br/&gt;  &lt;span&gt;where&lt;/span&gt;: filter,&lt;br/&gt;  &lt;span&gt;attributes&lt;/span&gt;: [&lt;br/&gt;    [sequelize.fn(&lt;span&gt;&#x27;DATE_FORMAT&#x27;&lt;/span&gt;, sequelize.col(&lt;span&gt;&#x27;create_time&#x27;&lt;/span&gt;), &lt;span&gt;&#x27;%Y-%m-%d&#x27;&lt;/span&gt;), &lt;span&gt;&#x27;createTime&#x27;&lt;/span&gt;],&lt;br/&gt;  ], &lt;span&gt;group&lt;/span&gt;: &lt;span&gt;&#x27;createTime&#x27;&lt;/span&gt;,&lt;br/&gt;})&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;假设我想获取4月10日-4月14日的数据，正常返回结构如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;[&lt;br/&gt;    {&lt;br/&gt;        &lt;span&gt;&quot;createTime&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-12&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;    },&lt;br/&gt;    {&lt;br/&gt;        &lt;span&gt;&quot;createTime&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-14&quot;&lt;/span&gt;,&lt;br/&gt;        &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;3&lt;/span&gt;&lt;br/&gt;    }&lt;br/&gt;]&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;5）因为表中只有12号和14号的数据，10、11、13号没有，这块需要自己对代码进行一个处理，把其它日期没有的数据为0即可。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最终希望达到的效果：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;[&lt;br/&gt; {&lt;br/&gt;     &lt;span&gt;&quot;time&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-10&quot;&lt;/span&gt;,&lt;br/&gt;     &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;0&lt;/span&gt;&lt;br/&gt; },&lt;br/&gt; {&lt;br/&gt;     &lt;span&gt;&quot;time&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-11&quot;&lt;/span&gt;,&lt;br/&gt;     &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;0&lt;/span&gt;&lt;br/&gt; },&lt;br/&gt; {&lt;br/&gt;     &lt;span&gt;&quot;time&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-12&quot;&lt;/span&gt;,&lt;br/&gt;     &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;&lt;br/&gt; },&lt;br/&gt; {&lt;br/&gt;     &lt;span&gt;&quot;time&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-13&quot;&lt;/span&gt;,&lt;br/&gt;     &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;0&lt;/span&gt;&lt;br/&gt; },&lt;br/&gt; {&lt;br/&gt;     &lt;span&gt;&quot;time&quot;&lt;/span&gt;: &lt;span&gt;&quot;2022-04-14&quot;&lt;/span&gt;,&lt;br/&gt;     &lt;span&gt;&quot;count&quot;&lt;/span&gt;: &lt;span&gt;3&lt;/span&gt;&lt;br/&gt; }&lt;br/&gt;]&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;五、问题思考&lt;/span&gt;&lt;/h2&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;如果想要获取一年中每个月的订单量，应该怎么查询？&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;答案：关注  &quot;&lt;strong&gt;大转转FE&lt;/strong&gt;&quot; 公众号，回复&quot;统计&quot;、&quot;一年&quot;其中一个即可&lt;/p&gt;&lt;/blockquote&gt;&lt;ol start=&quot;2&quot; data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;如何根据查询条件的顺序，返回相应的数据顺序？&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;答案：关注  &quot;&lt;strong&gt;大转转FE&lt;/strong&gt;&quot; 公众号，，回复&quot;filed&quot;、&quot;排序&quot;其中一个即可&lt;/p&gt;&lt;/blockquote&gt;&lt;ol start=&quot;3&quot; data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;如何进行动态分表？&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;答案：关注  &quot;&lt;strong&gt;大转转FE&lt;/strong&gt;&quot; 公众号，回复&quot;分表&quot;即可。&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;注：如果您还有其它问题想交流，欢迎在底部留言。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;参考资料&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;span&gt;[1]&lt;/span&gt;&lt;p&gt;Sequelize数据类型: &lt;em&gt;https://www.sequelize.com.cn/core-concepts/model-basics&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2]&lt;/span&gt;&lt;p&gt;Sequelize方法文档: &lt;em&gt;https://www.sequelize.com.cn/core-concepts/model-querying-finders&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>917f994a96784b2577afbc1e5ca27a44</guid>
<title>面试官提问三个Go接口的概念，10年gopher竟无言以对</title>
<link>https://toutiao.io/k/xn3xy8i</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                                                     &quot; id=&quot;js_content&quot;&gt;
            &lt;p&gt;&lt;span&gt;自 Go 1.18后， Go的interface的含义有所变化, 三个新的和Go接口有关的概念很多人还不知道: &lt;strong&gt;&lt;code&gt;type set&lt;/code&gt;&lt;/strong&gt;&lt;span&gt;(类型集合)、&lt;/span&gt;&lt;strong&gt;&lt;code&gt;specific type&lt;/code&gt;&lt;/strong&gt;&lt;span&gt;(特定类型)和&lt;/span&gt;&lt;strong&gt;&lt;code&gt;structural type&lt;/code&gt;&lt;/strong&gt;&lt;span&gt;(结构类型)&lt;/span&gt;&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;h2&gt;&lt;span&gt;&lt;strong&gt;1 type set (类型集合)&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;span&gt;type set称之为类型集合，一些关注Go泛型的朋友其实也对此有些了解，它是Go 1.18新增加的一个概念。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Go 1.18之前，Go的接口代表了一组方法的集合(method set),凡是实现了这些方法集合的类型，都被称之为实现了这个接口。Go不像Java语言，需要显示地定义某个类实现某个接口，Go不需要这样，在Go中，只要一个类型实现了某个接口定义的所有方法，它就实现了这个接口，可以赋值给这个接口类型的变量，或者作为这个接口类型的方法的实参或者返回值，这种设计有时候也被叫做&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;code&gt;鸭子类型&lt;/code&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;(duck typing)。只要它走起来像鸭子，叫起来像鸭子，那么它就是鸭子，这是一个很经典的对鸭子类型的描述。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在Go 1.18中，接口不再代表方法的集合了，而是代表类型的集合(type set)。只要某种类型在这个接口的类型集合中，那么我们就说这种类型实现了这个接口。如果这个接口被用作类型约束，那么在这个接口定义的类型集合中的任意一个元素，都可以实例化这个类型参数。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;所以，实际上，为了支持接口作为类型约束的扩展，Go语言规范不得不重新定义接口的含义了，这也是类型集合出现的原因。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;其实，接口的方法集的概念还在 一个接口的方法集是这个接口的类型集合中所有元素的方法集的&lt;/span&gt;&lt;strong&gt;交集&lt;/strong&gt;。&lt;/p&gt;&lt;p&gt;本文假定你对Go泛型有了一定的了解。假定你还不了解，那么你必须知道，Go 1.18中接口除了原先的方法元素还，还支持包含类型元素，类型元素可以是某个类型&lt;code&gt;T&lt;/code&gt;、或者是近似类型&lt;code&gt;~T&lt;/code&gt;,或者是它们的联合&lt;code&gt;int|int8|int16|int32|int64|~string&lt;/code&gt;。&lt;/p&gt;&lt;p&gt;&lt;span&gt;如果一个接口&lt;/span&gt;&lt;code&gt;I&lt;/code&gt;&lt;span&gt;嵌入了另外一个接口&lt;/span&gt;&lt;code&gt;E&lt;/code&gt;&lt;span&gt;,那么&lt;/span&gt;&lt;code&gt;I&lt;/code&gt;&lt;span&gt;的类型集是它显示定义的类型集合和嵌入的接口&lt;/span&gt;&lt;code&gt;E&lt;/code&gt;&lt;span&gt;的类型集合的交集。相当于&lt;/span&gt;&lt;code&gt;E&lt;/code&gt;&lt;span&gt;把接口&lt;/span&gt;&lt;code&gt;I&lt;/code&gt;&lt;span&gt;的类型集收窄了。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;如何判断一个接口的类型集呢？请遵循下面的原则:&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;一个方法的类型集合是定义这个方法的所有类型，也就是只要某个类型的方法集包含这个方法，那么它就属于这个方法的类型集合&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;比如接口中有&lt;/span&gt;&lt;code&gt;String() string&lt;/code&gt;&lt;span&gt;这样一个方法，那么所有实现这个方法的类型都属于&lt;/span&gt;&lt;code&gt;String() string&lt;/code&gt;&lt;span&gt;定义的类型集合，比如&lt;/span&gt;&lt;code&gt;net.IP&lt;/code&gt;&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;一个非接口类型的类型集合就是只包含这个类型的类型集合&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;比如&lt;/span&gt;&lt;code&gt;int&lt;/code&gt;&lt;span&gt;的类型集合只包含&lt;/span&gt;&lt;code&gt;int&lt;/code&gt;&lt;span&gt;这样一个元素&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;近似元素&lt;/span&gt;&lt;code&gt;~T&lt;/code&gt;&lt;span&gt;的类型集合是所有底层类型为&lt;/span&gt;&lt;code&gt;T&lt;/code&gt;&lt;span&gt;的所有类型的集合&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;比如&lt;/span&gt;&lt;code&gt;type MyInt int&lt;/code&gt;&lt;span&gt;中的&lt;/span&gt;&lt;code&gt;MyInt&lt;/code&gt;&lt;span&gt;就属于&lt;/span&gt;&lt;code&gt;~int&lt;/code&gt;&lt;span&gt;的类型集合&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;联合元素&lt;/span&gt;&lt;code&gt;t1|t2|…|tn&lt;/code&gt;&lt;span&gt;的类型集合是这些联合元素类型集合的&lt;strong&gt;并集&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;span&gt;下面的例子列举了一些类型的集合：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.8480278422273781&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vbERicIdYZbDVvSSniabTPBrvSB2JibsxNicDZctsIfB8aGicQJU9463XflXaT0XlGDoahP9q7FoueNbxTiaPqULVT2w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;862&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h2&gt;&lt;span&gt;&lt;strong&gt;2 specific type (特定类型) 和 specific type set&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;接口另外一个很重要的概念就是&lt;/span&gt;&lt;code&gt;specific type&lt;/code&gt;&lt;span&gt; (特定类型)&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;只有包含类型元素的接口才定义了特定类型(可能是空的类型)。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;如果不严格的讲，特定类型是出现在类型元素中定义的那些类型&lt;/span&gt;&lt;code&gt;T&lt;/code&gt;&lt;span&gt;、&lt;/span&gt;&lt;code&gt;~T&lt;/code&gt;&lt;span&gt;、&lt;/span&gt;&lt;code&gt;t1|t2|...|tn&lt;/code&gt;&lt;span&gt;中的&lt;/span&gt;&lt;code&gt;t1&lt;/code&gt;&lt;span&gt;、&lt;/span&gt;&lt;code&gt;t2&lt;/code&gt;&lt;span&gt;、&lt;/span&gt;&lt;code&gt;...&lt;/code&gt;&lt;span&gt;、&lt;/span&gt;&lt;code&gt;tn&lt;/code&gt;&lt;span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;更准确地说，对于给定的接口&lt;/span&gt;&lt;code&gt;I&lt;/code&gt;&lt;span&gt;，特定类型的集合对应于该接口代表的类型集合&lt;/span&gt;&lt;span&gt;&lt;strong&gt;𝑅&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;，这里要求&lt;/span&gt;&lt;span&gt;&lt;strong&gt;𝑅&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;是非空且有限的。否则，如果&lt;/span&gt;&lt;span&gt;&lt;strong&gt;𝑅&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;为空或无限，则接口没有特定类型。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;对于一个给定的接口、类型元素或者类型，它代表的类型集合&lt;/span&gt;&lt;span&gt;&lt;strong&gt;𝑅&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;定义如下：&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;对于一个没有任何类型元素的接口，它的&lt;strong&gt;𝑅&lt;/strong&gt;是所有的元素(无限)&lt;br/&gt;所以它没有特定类型&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;如果一个接口有类型元素，它的&lt;strong&gt;𝑅&lt;/strong&gt;是它的元素代表的类型的交集&lt;br/&gt;至于有没有特定类型要看&lt;strong&gt;𝑅&lt;/strong&gt;是否是非空且有限&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;对于一个非接口类型&lt;/span&gt;&lt;code&gt;&lt;span&gt;T&lt;/span&gt;&lt;/code&gt;&lt;span&gt;,或者&lt;/span&gt;&lt;code&gt;&lt;span&gt;~T&lt;/span&gt;&lt;/code&gt;&lt;span&gt;, 它的&lt;strong&gt;𝑅&lt;/strong&gt;是包含类型&lt;/span&gt;&lt;code&gt;&lt;span&gt;T&lt;/span&gt;&lt;/code&gt;&lt;span&gt;的集合&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;对于联合元素&lt;/span&gt;&lt;code&gt;&lt;span&gt;t1|t2|…|tn&lt;/span&gt;&lt;/code&gt;&lt;span&gt;, 它的&lt;strong&gt;𝑅&lt;/strong&gt;是这些项代表类型的&lt;strong&gt;并集&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;下面是特定类型的例子:&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.46916299559471364&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vbERicIdYZbDVvSSniabTPBrvSB2JibsxNic4jrgr4X4LBSlYvLqiabpp4QzRICKcNibibDsJ0QRZ1QqZYw6VRibWy6JBg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;908&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;br/&gt;&lt;span/&gt;&lt;/section&gt;&lt;h2&gt;&lt;span&gt;&lt;strong&gt;type set vs specific type set&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;类型集合和特定类型集合还是有区别的，从上面它们的定义可以看出来。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;一个接口即使类型为空，它的特定类型集合可能不为空。&lt;/strong&gt;&lt;br/&gt;比如&lt;code&gt;interface{ int; m() }&lt;/code&gt;,它的类型集合是空的(int没有实现m方法)，但是它的特定类型是&lt;code&gt;int&lt;/code&gt;。&lt;/p&gt;&lt;p&gt;&lt;strong&gt;一个接口即使有有限的特定类型，它的类型集合也可能是无限的&lt;/strong&gt;&lt;br/&gt;比如&lt;code&gt;interface{ ~int; m() }&lt;/code&gt;,它的特定类型是int，但是它的类型集合确是无限的&lt;span&gt;(任何底层为int并且实现了方法m的类型都属于它的类型集合)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;那么定义特定类型有什么用呢？&lt;/span&gt;&lt;/p&gt;&lt;h2&gt;&lt;br/&gt;&lt;/h2&gt;&lt;h2&gt;&lt;span&gt;&lt;strong&gt;特定类型的应用&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;span&gt;特定类型主要用于判断类型参数是否支持索引, 像&lt;/span&gt;&lt;code&gt;a[x]&lt;/code&gt;这样的类型。&lt;/p&gt;&lt;p&gt;比如一个表达式&lt;code&gt;a[x]&lt;/code&gt;, &lt;code&gt;a&lt;/code&gt;这个实例的类型可能是数组、指向数组的指针、slice、字符串、map。&lt;/p&gt;&lt;p&gt;如果&lt;code&gt;a&lt;/code&gt;的类型是类型参数&lt;code&gt;P&lt;/code&gt;的话，那么我们的代码&lt;code&gt;a[x]&lt;/code&gt;在什么条件下才不会编译出错？&lt;/p&gt;&lt;section&gt;&lt;span&gt;要求的条件就和特定类型有关了：&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;P必须有特定类型&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;对于P的特定类型的值a，支持&lt;/span&gt;&lt;code&gt;&lt;span&gt;a[x]&lt;/span&gt;&lt;/code&gt;&lt;span&gt;这种索引写法&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;P的所有特定类型必须相同。在这里，string类型的元素类型是byte (&lt;/span&gt;&lt;span&gt;https://github.com/golang/go/issues/49551&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;如果P的特定类型包含map类型的话，那么它的所有特定类型必须是map,而且所有的key的类型是相同的&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;所以有时候你定义了一个包含map、slice、string的联合元素接口的话，这个接口的实例你不能使用&lt;/span&gt;&lt;code&gt;&lt;span&gt;a[x]&lt;/span&gt;&lt;/code&gt;&lt;span&gt;索引类型，元素的类型都是int&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;a[x]&lt;/span&gt;&lt;/code&gt;&lt;span&gt;是数组、slice、string的索引为x的元素，或者是map类型key为x的元素，a[x]的类型必须相同&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;如果P的特定类型包含string类型，那么不能给&lt;/span&gt;&lt;code&gt;&lt;span&gt;a[x]&lt;/span&gt;&lt;/code&gt;&lt;span&gt;赋值(字符串是不可变的)&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;特定类型还用作类型转化定义上。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;对于一个变量&lt;/span&gt;&lt;code&gt;x&lt;/code&gt;&lt;span&gt;,如果它的类型是&lt;/span&gt;&lt;code&gt;V&lt;/code&gt;&lt;span&gt;, 要转换成的类型是&lt;/span&gt;&lt;code&gt;T&lt;/code&gt;&lt;span&gt;, 只要满足下面一条，x就可以转换成&lt;/span&gt;&lt;code&gt;T&lt;/code&gt;&lt;span&gt;类型:&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;一句话，是类型参数就满足每一个特定类型，不是类型参数就满足这个类型。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;另外，对于类型参数，要调用内&lt;/span&gt;建的函数&lt;code&gt;len&lt;/code&gt;、&lt;code&gt;cap&lt;/code&gt;，必须要求它们的特定类型允许使用这些内建函数。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;3 structural type (结构类型)&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;一个接口&lt;code&gt;T&lt;/code&gt;要被成为结构化的(&lt;code&gt;structural&lt;/code&gt;),需要满足下面的条件之一:&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;存在一个单一的类型&lt;/span&gt;&lt;code&gt;&lt;span&gt;U&lt;/span&gt;&lt;/code&gt;&lt;span&gt;,它是&lt;/span&gt;&lt;code&gt;&lt;span&gt;T&lt;/span&gt;&lt;/code&gt;&lt;span&gt;的类型集合中的每一个元素相同的底层类型&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;T&lt;/span&gt;&lt;/code&gt;&lt;span&gt;的类型集合只包含chan类型，并且它们的元素类型都是&lt;/span&gt;&lt;code&gt;&lt;span&gt;E&lt;/span&gt;&lt;/code&gt;&lt;span&gt;, 所有的chan的方向包含相同的方向(不一定要求完全相同)&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;结构化类型包含一个结构类型，根据上面的条件不同，结构类型可能是:&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;类型&lt;/span&gt;&lt;code&gt;&lt;span&gt;U&lt;/span&gt;&lt;/code&gt;&lt;span&gt;, 或者&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;如果&lt;/span&gt;&lt;code&gt;&lt;span&gt;T&lt;/span&gt;&lt;/code&gt;&lt;span&gt;只包含双向chan的话，结构类型为&lt;/span&gt;&lt;code&gt;&lt;span&gt;chan E&lt;/span&gt;&lt;/code&gt;&lt;span&gt;,否则可能是&lt;/span&gt;&lt;code&gt;&lt;span&gt;chan&amp;lt;- E&lt;/span&gt;&lt;/code&gt;&lt;span&gt;或者&lt;/span&gt;&lt;code&gt;&lt;span&gt;&amp;lt;-chan E&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;span&gt;下面是包含结构类型的结构化接口:&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.422790202342918&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vbERicIdYZbDVvSSniabTPBrvSB2JibsxNiczWZ5r1jdd7d6C1fVd6sEibAk2fzlqZZEYhLkBGGOmnvrmMcch9bGzrQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;939&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在Go语言规范中，并没有对结构化接口有更多的介绍，如何使用，更多是是它内部获取底层的结构类型，以及做类型检查，比如下面的例子就会报&lt;/span&gt;&lt;code&gt;no structural type&lt;/code&gt;&lt;span&gt;编译错误:&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.4534769833496572&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vbERicIdYZbDVvSSniabTPBrvSB2JibsxNicOg7AcbwIVFjyb9DlvH2C3fficJdkBeawWdVsJpAJF50em1ibQFOicFzqQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1021&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;下面的代码也会报&lt;/span&gt;&lt;code&gt;M has no structural type&lt;/code&gt;&lt;span&gt;编译错误:&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;578&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;255&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.35798816568047337&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vbERicIdYZbDVvSSniabTPBrvSB2JibsxNicDbRJjuSKpNfTBrLyMvaAAPfoibF2lnIC8NGvwLRHNlIT8EGAt4FLx6g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1014&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;比如下面大家使用Go泛型的时候常会犯的错误,虽然&lt;/span&gt;&lt;code&gt;[]byte&lt;/code&gt;&lt;span&gt;、&lt;/span&gt;&lt;code&gt;map[int]byte&lt;/code&gt;&lt;span&gt;、&lt;/span&gt;&lt;code&gt;string&lt;/code&gt;&lt;span&gt;都能range,而且key(index)、value类型都一样，但是也会报&lt;/span&gt;&lt;code&gt;R has no structural type&lt;/code&gt;&lt;span&gt;错误:&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5991820040899796&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vbERicIdYZbDVvSSniabTPBrvSB2JibsxNicwZKpONEm0tmC8R8VWI9tPzplfs1dAVwRR3iasCL1YZoiaEY1qsnrYKKQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;978&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;END&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;br/&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzA4ODg0NDkzOA==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/vbERicIdYZbC53rq7PQziczkzCA4pIPx8Xdx2r0a6FgQWEicTOgFNY1KlJD3jSKQKlTiavwTUgHS1HMXza2RYApkDw/0?wx_fmt=png&quot; data-nickname=&quot;GoCN&quot; data-alias=&quot;golangchina&quot; data-signature=&quot;最具规模和生命力的 Go 开发者社区&quot; data-from=&quot;0&quot;/&gt;&lt;span/&gt;&lt;span/&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;-猜你想看-&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;想要了解Go更多内容，欢迎扫描下方👇 关注 公众号，回复关键词 [实战群]  ,就有机会进群和我们进行交流~&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5763688760806917&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vbERicIdYZbDrrBk1KBPqY1QNI320ZK2IIycDa77FcDQAeAFJRVb240xr8biceh23auy7ZpPibEYXPNOnmfsEewkw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;694&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong/&gt;&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;分享、在看与点赞，至少我要拥有一个叭~&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img __bg_gif&quot; data-ratio=&quot;0.2106667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/vbERicIdYZbB79dKphkWU3rVKFiaZGWHEic0qXJ8QAeF6XRTLwTCEgUxxiamV13wPv9kMtaqrOtsrVibdHzvYiaxCwgA/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;750&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.696&quot; data-type=&quot;gif&quot; data-w=&quot;500&quot; class=&quot;__bg_gif&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/vbERicIdYZbB79dKphkWU3rVKFiaZGWHEicOoCY9eHaUhZY0vkZibusOg9ibjGibicfyjHiaWfkN9QOiclK2DnfLh4KYTLA/640?wx_fmt=gif&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;
          &lt;/div&gt;

          

          



           
                                
                    
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>