<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>a96c2bbdbffb1b7fc4092fe5928133a2</guid>
<title>参加了个算法比赛，真是一言难尽啊</title>
<link>https://toutiao.io/k/3mxn8wi</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;span/&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;hello大家好呀，我是小楼。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上周参加了一个区的程序员技能比赛的初赛，其实就是算法比赛，虽然最后结果是过了初赛，但过程真是一言难尽啊。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这次的算法比赛和ACM非常类似，虽然我大学是数学专业，虽然大学也修过ACM这门课，但是我的算法是真的不行，很菜很菜的那种。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9123076923076923&quot; data-type=&quot;jpeg&quot; data-w=&quot;650&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJ0aDZsCNFK6tl3s6eKJYSBibq78UDfLLEtITIWJKmkdTwneCHBgop3dg/640?wx_fmt=jpeg&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;好在这次比赛是组（抱大腿）队模式，3人一组，3个小时时间，一共7道算法题，1入门，2简单，2中等，2困难。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;10分钟写出入门题，但...&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;由于我知道我比较菜，所以比赛一开始，我就挑了一个看起来最简单的题目做，难题交给队友。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果是3个小时过去，这个看起来最简单的题目，愣是没有做出来，下面就结合这道题讲讲我的心路历程。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这道题的描述是这样的：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.0455991516436904&quot; data-type=&quot;png&quot; data-w=&quot;943&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJ64CD0icFDWOWGibX30zWgtFVoHg2C9trLXR0nhIT7YqV5icXZ86zmibXng/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;看起来文字很多，其实要表达的很简单，就是输入一些成绩，每个成绩输进去时，如果超过全班最好成绩则输出prefect，如果超过自己的最好成绩则输出great，如果没超过自己最好成绩则输出bad。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;是不是很简单？用一个max变量保存全班最好成绩，用一个map保存每个人的最好成绩，不就解决了吗？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;不过这是我第一次用这个oj系统，连用户都是刚注册的，所以我还特地看了一会输入输出的demo，这次比赛只能使用ACM的输入输出模式，例如如果用的是Go语言，输入输出应该是这样：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.1206225680933852&quot; data-type=&quot;png&quot; data-w=&quot;514&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJpNJI3f2f1oUck1DYJeFWFLEO46pScvicU8IHDphjWAYJicGAorys9XZA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;学会了输入输出之后，一口气写入如下的解法：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; main&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;fmt&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;main&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; n &lt;span&gt;int&lt;/span&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; name &lt;span&gt;string&lt;/span&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; x &lt;span&gt;float32&lt;/span&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; max &lt;span&gt;float32&lt;/span&gt;&lt;br/&gt; scores := &lt;span&gt;make&lt;/span&gt;(&lt;span&gt;map&lt;/span&gt;[&lt;span&gt;string&lt;/span&gt;]&lt;span&gt;float32&lt;/span&gt;, n)&lt;br/&gt;&lt;br/&gt; fmt.Scan(&amp;amp;n)&lt;br/&gt; &lt;span&gt;for&lt;/span&gt; i := &lt;span&gt;0&lt;/span&gt;; i &amp;lt; n; i++ {&lt;br/&gt;  fmt.Scan(&amp;amp;name, &amp;amp;x)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; x &amp;gt; max || i == &lt;span&gt;0&lt;/span&gt; {&lt;br/&gt;   fmt.Println(&lt;span&gt;&quot;perfect&quot;&lt;/span&gt;)&lt;br/&gt;   max = x&lt;br/&gt;   scores[name] = x&lt;br/&gt;  } &lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;   &lt;span&gt;if&lt;/span&gt; s, ok := scores[name]; ok {&lt;br/&gt;    &lt;span&gt;if&lt;/span&gt; x &amp;gt; s {&lt;br/&gt;     fmt.Println(&lt;span&gt;&quot;great&quot;&lt;/span&gt;)&lt;br/&gt;     scores[name] = x&lt;br/&gt;    } &lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;     fmt.Println(&lt;span&gt;&quot;bad&quot;&lt;/span&gt;)&lt;br/&gt;    }&lt;br/&gt;   } &lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;    fmt.Println(&lt;span&gt;&quot;great&quot;&lt;/span&gt;)&lt;br/&gt;    scores[name] = x&lt;br/&gt;   }&lt;br/&gt;  }&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在我正得意，觉得这题10分钟就能解决的时候，提交上去的代码竟然超时了，在比赛时没有截图，提交后显示有少数用例超过了2秒，oj的判定原理是准备一堆测试用例，如果全部通过则判定为通过，当然这批测试用例肯定不是那么好通过的，设计者会出各种极端的case。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;优化map性能&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;调转头去仔细审题，果然时间和空间都有限制：&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;时间限制：C/C++ 1秒，其他语言2秒&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;空间限制：C/C++ 262144K，其他语言524288K&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;64bit IO Format: %lld&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这题除了有map的读写，其他都是O(1)复杂度，性能不够难道是map性能不够？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果是map的性能不够，不够在哪里呢？众所周知，map的原理一般是这样：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5354539430086149&quot; data-type=&quot;png&quot; data-w=&quot;1509&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJW3G3ibM0bXQLIfrLypHY9STW8ROUoshrVS0fVBRXf9wzgd7LjYHo0OQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当一些key存入map时，会先对key计算hash值，在map中找到对应的hash槽，这个槽之后一般是个链表（有的语言也会做一些优化成树状，这里我们简化为链表），因为不同的key的hash值可能会重复（冲突），冲突了只能把key排成一个链表，每次查找时都要遍历链表。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所以有没有可能，设计者给出了一堆hash值重复的name，数量又多，导致每次插入、查找时都要遍历链表，性能下降，导致超时？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;于是再仔细审题，我发现输入的姓名和成绩是有限制的：&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;name保证长度不超过6，仅由小写英文字母组成，每个名字代表唯一一个同学&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;x为1位小数，0≤x≤300&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;name最长为6，且为小写字母&lt;/strong&gt;，这点给了我一点启发，能不能让查询map变成O(1)复杂度？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;显然可以的，小写字母范围为&lt;strong&gt;a~z&lt;/strong&gt;，如果看成数字就是1-26，也就是27进制，所以每个name可以表示为一个27进制的数，这样就可以把所有人的成绩放到一个大数组里去，按name的27进制进行O(1)的查找。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为什么是27进制而不是26，因为name没说是多少位，比如只有5位，那空出的一位怎么表示？只能用0表示了，a-z就是1-26，合起来是27进制。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;参考10进制计算法则，27进制应该这样计算（以roshi为例）：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.20679886685552407&quot; data-type=&quot;png&quot; data-w=&quot;1059&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJzibpLribfxVKy0fJGNOCXhDo01G1CBdamI30KTicenmvqkkA7fm1X49dQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;计算出的值即为数组的下标，那么这个数组的最大值是多少呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;26 * 27^5 + 26 * 27^4 + 26 * 27^3 + 26 * 27^2 + 26 * 27^1 + 26 * 27^0&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;很容易算出来是：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;387420488&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;需要这么大个数组，大概3亿多，输入成绩是个1位小数，可以转换为int，大概4个字节，掐指一算得 &lt;strong&gt;1513361KB&lt;/strong&gt;，好像比要求的&lt;strong&gt;524288K&lt;/strong&gt;多，先不管空间，写一版跑跑看，万一能过呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;很简单写出代码：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; main&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;fmt&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;main&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; n &lt;span&gt;int&lt;/span&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; name &lt;span&gt;string&lt;/span&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; x &lt;span&gt;int32&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; fmt.Scan(&amp;amp;n)&lt;br/&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; scores [&lt;span&gt;387420488&lt;/span&gt;]&lt;span&gt;int32&lt;/span&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; exist [&lt;span&gt;387420488&lt;/span&gt;]&lt;span&gt;int32&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; max &lt;span&gt;int32&lt;/span&gt;&lt;br/&gt; &lt;span&gt;for&lt;/span&gt; i := &lt;span&gt;0&lt;/span&gt;; i &amp;lt; n; i++ {&lt;br/&gt;  fmt.Scan(&amp;amp;name, &amp;amp;x)&lt;br/&gt;&lt;br/&gt;  idx := mapIndex(name)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; x &amp;gt; max || i == &lt;span&gt;0&lt;/span&gt; {&lt;br/&gt;   fmt.Printf(&lt;span&gt;&quot;perfect\n&quot;&lt;/span&gt;)&lt;br/&gt;   max = x&lt;br/&gt;   scores[idx] = x&lt;br/&gt;   exist[idx] = &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;  } &lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;   &lt;span&gt;if&lt;/span&gt; exist[idx] == &lt;span&gt;0&lt;/span&gt; || x &amp;gt; scores[idx] {&lt;br/&gt;    fmt.Printf(&lt;span&gt;&quot;great\n&quot;&lt;/span&gt;)&lt;br/&gt;    scores[idx] = x&lt;br/&gt;    exist[idx] = &lt;span&gt;1&lt;/span&gt;&lt;br/&gt;   } &lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;    fmt.Printf(&lt;span&gt;&quot;bad\n&quot;&lt;/span&gt;)&lt;br/&gt;   }&lt;br/&gt;  }&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;var&lt;/span&gt; index27 = [&lt;span&gt;6&lt;/span&gt;]&lt;span&gt;int32&lt;/span&gt;{&lt;span&gt;1&lt;/span&gt;, &lt;span&gt;27&lt;/span&gt;, &lt;span&gt;27&lt;/span&gt; * &lt;span&gt;27&lt;/span&gt;, &lt;span&gt;27&lt;/span&gt; * &lt;span&gt;27&lt;/span&gt; * &lt;span&gt;27&lt;/span&gt;, &lt;span&gt;27&lt;/span&gt; * &lt;span&gt;27&lt;/span&gt; * &lt;span&gt;27&lt;/span&gt; * &lt;span&gt;27&lt;/span&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;mapIndex&lt;/span&gt;&lt;span&gt;(x &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt; &lt;span&gt;int32&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; index &lt;span&gt;int32&lt;/span&gt;&lt;br/&gt; &lt;span&gt;for&lt;/span&gt; i := &lt;span&gt;len&lt;/span&gt;(x) - &lt;span&gt;1&lt;/span&gt;; i &amp;gt;= &lt;span&gt;0&lt;/span&gt;; i-- {&lt;br/&gt;  index = index + &lt;span&gt;int32&lt;/span&gt;(x[i]&lt;span&gt;-96&lt;/span&gt;)*index27[&lt;span&gt;len&lt;/span&gt;(x)&lt;span&gt;-1&lt;/span&gt;-i]&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; index&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.24594594594594596&quot; data-type=&quot;png&quot; data-w=&quot;740&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJqPibI3Irpp1ctKf9uCtsP8iaAnebX92b4L8bSVsqGTRouRicibtBseVVFg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果竟然报错了，我当时不理解，事后理解了，我们暂且不说，后面会说到原因。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;就是因为这个报错不明不白，明明能测试通过，到底哪里理解有偏差？亦或是内存超了？&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;优化内存占用&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面的代码用到了2个数组，一个存最大值，一个存值是否存在，一个数组是1513361KB，2个就是3026722KB，是最大内存限制的5.7倍&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;var&lt;/span&gt; scores [&lt;span&gt;387420488&lt;/span&gt;]&lt;span&gt;int32&lt;/span&gt;&lt;br/&gt;&lt;span&gt;var&lt;/span&gt; exist [&lt;span&gt;387420488&lt;/span&gt;]&lt;span&gt;int32&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;exist数组可以用boolean类型，分数最大值0&amp;lt;=0&amp;lt;=300，int16足矣&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;br/&gt;&lt;/th&gt;&lt;th&gt;大小&lt;/th&gt;&lt;th&gt;范围&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;int8&lt;/td&gt;&lt;td&gt;1字节&lt;/td&gt;&lt;td&gt;-128 ~ 127&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;int16&lt;/td&gt;&lt;td&gt;2字节&lt;/td&gt;&lt;td&gt;-32768 ~ 32767&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;int32&lt;/td&gt;&lt;td&gt;4字节&lt;/td&gt;&lt;td&gt;-2147483648 ~ 2147483647&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果是这个组合，将占用 &lt;strong&gt;1135020KB&lt;/strong&gt;，是上限的2倍多，还是有点超，先试试：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.24934036939313983&quot; data-type=&quot;png&quot; data-w=&quot;758&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJqLmnVbjKX0EiaQ2WfvibiacDmIhdlOAKBkC0OR77zvM2LveaBLuc1CcRg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;还是一样，难道是我算法有问题？没道理啊。到这里我实在是没招了，3小时也耗尽了，比赛结束。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;赛后思考&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;赛后，我拿着这道题去找了一位刚入职字节的朋友，想着刚去字节应该刷过不少题吧，果然大佬就是大佬，给出了一个有新意的思路，用前缀树做：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.814748201438849&quot; data-type=&quot;png&quot; data-w=&quot;1112&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJVKFsLBT86k3pvIJ1XgIYabVI1SEiazSSM8P3WsbK2hBYfkhvpIJAhUg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;每一个name都构造出一个前缀树，查找时最多只需要查找6次，内存使用应该也不会太多，算是时间与空间的一个平衡。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大佬还补充了一句：比赛还是比较特殊的，可能就是某一个case卡主了，而你要做的就是如何能把这个特殊的case也ac掉。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大佬的话似乎很有道理，于是我写了一个前缀树的版本：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt; main&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt; (&lt;br/&gt; &lt;span&gt;&quot;fmt&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt; treeNode &lt;span&gt;struct&lt;/span&gt; {&lt;br/&gt; max  &lt;span&gt;float32&lt;/span&gt;&lt;br/&gt; next [&lt;span&gt;26&lt;/span&gt;]*treeNode&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;main&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; n &lt;span&gt;int&lt;/span&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; name &lt;span&gt;string&lt;/span&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; x &lt;span&gt;float32&lt;/span&gt;&lt;br/&gt; fmt.Scan(&amp;amp;n)&lt;br/&gt;&lt;br/&gt; &lt;span&gt;var&lt;/span&gt; max &lt;span&gt;float32&lt;/span&gt;&lt;br/&gt; tree := &lt;span&gt;new&lt;/span&gt;(treeNode)&lt;br/&gt; &lt;span&gt;for&lt;/span&gt; i := &lt;span&gt;0&lt;/span&gt;; i &amp;lt; n; i++ {&lt;br/&gt;  fmt.Scan(&amp;amp;name, &amp;amp;x)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; x &amp;gt; max || i == &lt;span&gt;0&lt;/span&gt; {&lt;br/&gt;   fmt.Println(&lt;span&gt;&quot;perfect&quot;&lt;/span&gt;)&lt;br/&gt;   max = x&lt;br/&gt;   insert(tree, name, x)&lt;br/&gt;  } &lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;   &lt;span&gt;if&lt;/span&gt; tmp := searchAndStoreMax(tree, name, x); tmp != &lt;span&gt;-1&lt;/span&gt; {&lt;br/&gt;    &lt;span&gt;if&lt;/span&gt; x &amp;gt; tmp {&lt;br/&gt;     fmt.Println(&lt;span&gt;&quot;great&quot;&lt;/span&gt;)&lt;br/&gt;     insert(tree, name, x)&lt;br/&gt;    } &lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;     fmt.Println(&lt;span&gt;&quot;bad&quot;&lt;/span&gt;)&lt;br/&gt;    }&lt;br/&gt;   } &lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;    fmt.Println(&lt;span&gt;&quot;great&quot;&lt;/span&gt;)&lt;br/&gt;    insert(tree, name, x)&lt;br/&gt;   }&lt;br/&gt;  }&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;insert&lt;/span&gt;&lt;span&gt;(node *treeNode, name &lt;span&gt;string&lt;/span&gt;, x &lt;span&gt;float32&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;for&lt;/span&gt; i := &lt;span&gt;0&lt;/span&gt;; i &amp;lt; &lt;span&gt;len&lt;/span&gt;(name); i++ {&lt;br/&gt;  idx := &lt;span&gt;int32&lt;/span&gt;(name[i] - &lt;span&gt;&#x27;a&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; node.next[idx] == &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;   node.next[idx] = &lt;span&gt;new&lt;/span&gt;(treeNode)&lt;br/&gt;  }&lt;br/&gt;  node = node.next[idx]&lt;br/&gt; }&lt;br/&gt; node.max = x&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;searchAndStoreMax&lt;/span&gt;&lt;span&gt;(node *treeNode, name &lt;span&gt;string&lt;/span&gt;, x &lt;span&gt;float32&lt;/span&gt;)&lt;/span&gt; &lt;span&gt;float32&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt; &lt;span&gt;for&lt;/span&gt; i := &lt;span&gt;0&lt;/span&gt;; i &amp;lt; &lt;span&gt;len&lt;/span&gt;(name); i++ {&lt;br/&gt;  idx := &lt;span&gt;int32&lt;/span&gt;(name[i] - &lt;span&gt;&#x27;a&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; node.next[idx] == &lt;span&gt;nil&lt;/span&gt; {&lt;br/&gt;   &lt;span&gt;return&lt;/span&gt; &lt;span&gt;-1&lt;/span&gt;&lt;br/&gt;  }&lt;br/&gt;  node = node.next[idx]&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; x &amp;gt; node.max {&lt;br/&gt;  tmp := node.max&lt;br/&gt;  node.max = x&lt;br/&gt;  &lt;span&gt;return&lt;/span&gt; tmp&lt;br/&gt; }&lt;br/&gt; &lt;span&gt;return&lt;/span&gt; node.max&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果又又又是超时，我服了。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;终于发现问题&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;后来我又尝试了很多方法都不行，比如怀疑是不是Go的map性能不行，换成Java试试，结果还是不行。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最后我在网上搜索牛客网时发现了一个突破口（对，没错，这次比赛是在牛客网上举办的）。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.6274509803921569&quot; data-type=&quot;png&quot; data-w=&quot;1326&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJvbbnSxPfqDsBbGvicz7fvuPxANYQIHCsWmU6fP0icrF5RFj0iaPdfaJlA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;简单说，牛客网的ACM模式输入可能需要读入一行然后再自己处理成想要的数据。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;抱着怀疑的态度我试了下，果然，淦！用最开始的map就能ac掉！虽然我也不知道这两种输入有什么区别。关键我还是用的网站上提示的输入方式，确实太坑了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;正确的输入方式如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;package main&lt;br/&gt;&lt;br/&gt;import (&lt;br/&gt; &lt;span&gt;&quot;bufio&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;fmt&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;os&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;strconv&quot;&lt;/span&gt;&lt;br/&gt; &lt;span&gt;&quot;strings&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;func &lt;span&gt;&lt;span&gt;main&lt;/span&gt;&lt;/span&gt;() {&lt;br/&gt; var n int&lt;br/&gt; var name string&lt;br/&gt; var x float64&lt;br/&gt; input := bufio.NewScanner(os.Stdin)&lt;br/&gt; &lt;span&gt;if&lt;/span&gt; input.&lt;span&gt;&lt;span&gt;Scan&lt;/span&gt;&lt;/span&gt;() {&lt;br/&gt;  n, _ = strconv.Atoi(input.Text())&lt;br/&gt; }&lt;br/&gt;&lt;br/&gt; scores := make(map[string]float64, n)&lt;br/&gt; var max float64&lt;br/&gt; &lt;span&gt;for&lt;/span&gt; i := 0; i &amp;lt; n; i++ {&lt;br/&gt;  &lt;span&gt;if&lt;/span&gt; input.&lt;span&gt;&lt;span&gt;Scan&lt;/span&gt;&lt;/span&gt;() {&lt;br/&gt;   arr := strings.Split(input.Text(), &lt;span&gt;&quot; &quot;&lt;/span&gt;)&lt;br/&gt;   name = arr[0]&lt;br/&gt;   x, _ = strconv.ParseFloat(arr[1], 32)&lt;br/&gt;  }&lt;br/&gt;&lt;br/&gt;  ...&lt;br/&gt; }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.44346289752650175&quot; data-type=&quot;png&quot; data-w=&quot;1132&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJCfpCL3ZwnoxrtWAsC3O54oczROKw4fTjs1WzMD56gQyiaeickQsp8iamg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;之前的想法属于强行增加难度了~害！想了好几天的题竟然败在了输入上，真是一言难尽！&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;之前的方法能行吗&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我把几个版本的输入改了之后，看看通过后的耗时和内存&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;版本&lt;/th&gt;&lt;th&gt;是否通过&lt;/th&gt;&lt;th&gt;耗时&lt;/th&gt;&lt;th&gt;内存&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;map版&lt;/td&gt;&lt;td&gt;是&lt;/td&gt;&lt;td&gt;315ms&lt;/td&gt;&lt;td&gt;10096KB&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;27进制版&lt;/td&gt;&lt;td&gt;否&lt;/td&gt;&lt;td&gt;-&lt;/td&gt;&lt;td&gt;-&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;前缀树版&lt;/td&gt;&lt;td&gt;是&lt;/td&gt;&lt;td&gt;433ms&lt;/td&gt;&lt;td&gt;43720KB&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中27进制版本在改成正确的输入后，露出了庐山真面目：内存超了！&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.33111702127659576&quot; data-type=&quot;png&quot; data-w=&quot;752&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0QFptviaVgcSwQn6yKaH5TmJqAuib3P98P9gczziarzicLkKmSsbTsyia2FxbbibtdnJycwUh7QjMGpaDvg/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;最后&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;过程虽然曲折，但最终还是解决了这个入门题，而且还尝试着用几种方法来解，虽然不尽如人意，但终究还是有点收获。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然我们组的小伙伴也很给力，做出来3道题，我们最终的成绩是排名进了前10%，虽然我只贡献了一点点（没完全做出来也有得分，按通过的用例算，我这题大概拿到了90%的分），也算是可以了，而且还有一道题也可能是因为这个输入被卡了，所以如果这两道卡的题都做出来，估计排名能进前三。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;初赛算是过了，接下来准备复赛，如果复赛还有好玩的事情，我再来写一篇文章，哈哈。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这一言难尽的比赛，大家给个赞鼓励下吧。&lt;/p&gt;&lt;hr data-tool=&quot;mdnice编辑器&quot;/&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;搜索关注微信公众号&quot;捉虫大师&quot;，后端技术分享，架构设计、性能优化、源码阅读、问题排查、踩坑实践。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;想进技术交流群的小伙伴加我微信「MrRoshi」备注加群即可，群里大佬如云，带你起飞~&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;span/&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>65944d481b2e9fa98887d2be87bde12d</guid>
<title>C++最佳实践 | 4. 可维护性</title>
<link>https://toutiao.io/k/zkc86sq</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                       &quot; id=&quot;js_content&quot;&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;em&gt;本系列是开源书&lt;span&gt;C++ Best Practises&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;的中文版，全书从工具、代码风格、安全性、可维护性、可移植性、多线程、性能、正确性等角度全面介绍了现代C++项目的最佳实践。本文是该系列的第四篇。&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p&gt;C++最佳实践:&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU2MTgxODgwNA==&amp;amp;mid=2247485809&amp;amp;idx=1&amp;amp;sn=dad7bd7048a315ec76a41e8ab28dc880&amp;amp;chksm=fc73b4aacb043dbc09d7f891c124257cdfa76c55dc8711ba2235c345056cbba77f4894469e97&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;1. 工具&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;1. 工具&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU2MTgxODgwNA==&amp;amp;mid=2247485810&amp;amp;idx=1&amp;amp;sn=038ad9bffe583294e2acfd86c19bf409&amp;amp;chksm=fc73b4a9cb043dbf7b6d802ffa36a87cb38d5ba147601e7bc918c4125466b17314f7f5bbb054&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;2. 代码风格&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;2. 代码风格&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU2MTgxODgwNA==&amp;amp;mid=2247485811&amp;amp;idx=1&amp;amp;sn=826a810a843e02114381f20f6a4527b4&amp;amp;chksm=fc73b4a8cb043dbe20175ac72338233dae140b660cef9076f35cb5d2a89f570c42d02e8c457e&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;3. 安全性&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;3. 安全性&lt;/a&gt;&lt;/p&gt;&lt;p&gt;4. 可维护性（本文）&lt;/p&gt;&lt;p&gt;5. 可移植性及多线程&lt;/p&gt;&lt;p&gt;6. 性能&lt;/p&gt;&lt;p&gt;7. 正确性和脚本&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;可维护性&lt;span/&gt;&lt;br/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;避免使用编译宏&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;宏在编译之前被预处理器所替换，从而使得调试非常困难，因为调试器无法知道源代码来自哪里。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;// Bad Idea&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;define&lt;/span&gt; PI 3.14159;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;// Good Idea&lt;/span&gt;&lt;br/&gt;&lt;span&gt;namespace&lt;/span&gt; my_project {&lt;br/&gt;  &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;Constants&lt;/span&gt; {&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;public&lt;/span&gt;:&lt;br/&gt;    &lt;span&gt;// if the above macro would be expanded, then the following line would be:&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;//   static const double 3.14159 = 3.14159;&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;// which leads to a compile-time error. Sometimes such errors are hard to understand.&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;static&lt;/span&gt; &lt;span&gt;constexpr&lt;/span&gt; &lt;span&gt;double&lt;/span&gt; PI = &lt;span&gt;3.14159&lt;/span&gt;;&lt;br/&gt;  };&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;避免使用布尔值作为函数参数&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在阅读代码时，布尔值无法提供任何额外含义。可以创建一个名称更有意义的独立函数，或者传递含义更明确的枚举值。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;参考 http://mortoray.com/2015/06/15/get-rid-of-those-boolean-function-parameters 了解更多信息。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;避免使用裸循环&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;了解和理解现有C++标准算法，并付诸实践。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;参考&lt;span&gt;cppreference&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;观看&lt;span&gt;C++ Seasoning&lt;/span&gt;&lt;sup&gt;[3]&lt;/sup&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;将对&lt;code&gt;[]&lt;/code&gt;的调用看作是一种潜在的代码坏味道，表明没有在需要的地方使用合适的算法。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;永远不要使用有副作用的&lt;code&gt;assert&lt;/code&gt;&lt;span/&gt;&lt;/h4&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;// Bad Idea&lt;/span&gt;&lt;br/&gt;assert(set_value(something));&lt;br/&gt;&lt;br/&gt;&lt;span&gt;// Better Idea&lt;/span&gt;&lt;br/&gt;[[maybe_unused]] &lt;span&gt;const&lt;/span&gt; &lt;span&gt;auto&lt;/span&gt; success = set_value(something);&lt;br/&gt;assert(success);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在release版本中&lt;code&gt;assert()&lt;/code&gt;将会被删除，从而造成&lt;code&gt;set_value&lt;/code&gt;无法被调用。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;虽然第二个版本更丑，但总比第一个错误版本好一点。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;正确使用“override”和“final”&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这些关键字使其他开发人员可以清楚知道虚函数可以被如何使用，如果虚函数的签名发生了变化，就可以捕获潜在错误，并有可能向编译器提示可以执行哪些优化（参考: &lt;span&gt;How does the compiler benefit from C++&#x27;s new final keyword?&lt;/span&gt;&lt;sup&gt;[4]&lt;/sup&gt;）。&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;你好，我是俞凡，在Motorola做过研发，现在在Mavenir做技术工作，对通信、网络、后端架构、云原生、DevOps、CICD、区块链、AI等技术始终保持着浓厚的兴趣，平时喜欢阅读、思考，相信持续学习、终身成长，欢迎一起交流学习。&lt;br/&gt;微信公众号：DeepNoMind&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;参考资料&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;span&gt;[1]&lt;/span&gt;&lt;p&gt;C++ Best Practises: &lt;em&gt;https://lefticus.gitbooks.io/cpp-best-practices/content/&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2]&lt;/span&gt;&lt;p&gt;cppreference: &lt;em&gt;https://en.cppreference.com/w/cpp/algorithm&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[3]&lt;/span&gt;&lt;p&gt;C++ Seasoning: &lt;em&gt;https://www.youtube.com/watch?v=qH6sSOr-yk8&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[4]&lt;/span&gt;&lt;p&gt;How does the compiler benefit from C++&#x27;s new final keyword?: &lt;em&gt;https://stackoverflow.com/questions/7538820/how-does-the-compiler-benefit-from-cs-new-final-keyword&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;span&gt;- END -&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;

          

          
          &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>41c7e41b284424953284ef8d90578ff9</guid>
<title>AI数字绘画 stable-diffusion 保姆级教程</title>
<link>https://toutiao.io/k/2fzppgh</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;br/&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大家好，我是秋风，近段时间来，你可能在不少地方都看到了非常多这样的好看的画。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如这样的赛博朋克风&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;prompt:  Cyberpunk, 8k resolution, castle, the rose sea, dream&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6845582163501238&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKB4y1ib1icj29DaYUaSO15mnuM6hfCJmEQPWFrDCyXvqkZP3Qdh1oDON5Q/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1211&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;水墨画风格&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;prompt: a watercolor ink painting of a fallen angel with a broken halo wielding a jagged broken blade standing on top of a skyscraper in the style of anti - art trending on artstation deviantart pinterest detailed realistic hd 8 k high resolution&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.809&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBHW93TEoG4RaBFiaY4U5iayd5cRp2IxQ3hmA5hBRr1PrGVVt4Q1A7K4mg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1000&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;油画&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;prompt: portrait of bob barker playing twister with scarlett johansson, an oil painting by ross tran and thomas kincade&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.663&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKB32D86d8PP8abSWHPppAbViaglOsaKeG6PAB5jSKe2Zq9hia3LXlcrGmQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1000&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;水彩画&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;prompt: a girl with lavender hair and black skirt, fairy tale style background, a beautiful half body illustration, top lighting, perfect shadow, soft painting, reduce saturation, leaning towards watercolor, art by hidari and krenz cushart and wenjun lin and akihiko yoshida&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.2541322314049588&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBGDtuIlNGRl6icuGy0icS772Pk6XObFV0iaTNEXrhDuBtcScHmyojPpZjA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;968&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;并且在各种平台我们也是随处可见，以下分别为小红书、闲鱼、twitter&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7002997002997003&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKB5XCAyic0tIrMibSTzg5PTN56ibgFDHr2ruzjs5chuW6nMHJ8fh6GCYk1A/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2002&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这些图都很像是艺术家画的一样，但是他们却不是出自真正的的艺术家之手，而是 AI艺术家。AI 就像 16 年打败李世石进军 围棋行业一样，开始进军艺术届了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们来看看 AI绘画 发展的比较关键的时间线&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;Disco Diffusion 是发布于Google Colab 平台的一款利用人工智能深度学习进行数字艺术创作的工具，它是基于MIT 许可协议的开源工具，可以在Google Drive 直接运行，也可以部署到本地运行。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Disco Diffusion  有一个弊端，就是速度非常慢，动辄 半个小时起步。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;Midjourney是Disco Diffusion的原作者Somnai所加入的AI艺术项目实验室。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Midjourney 对  Disco Diffusion 进行了改进，平均1分钟能出图。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;OpenAI推出 DALL·E 2, DALL-E 2实现了更高分辨率和更低延迟，而且还包括了新的功能，如编辑现有图像。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前还没有按到 DALL·E 2 的体验资格。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;stability.ai 推出 Stable-Diffusion并且开源了&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一经推出就受到广大网友的喜爱，操作简单，出图快，平均10-20秒。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Stable-Diffusion 免费、生成速度又快，每一次生成的效果图就像是开盲盒一样，需要不断尝试打磨，所以大家都疯狂似的开始玩耍，甚至连特斯拉的前人工智能和自动驾驶视觉总监 Andrej Karpathy 都沉迷于此。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.339080459770115&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBAxCluVfICdb8g56RSrMpkLVp5IrxnBcOQsOMeloNF88w0ToMGRpgng/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1044&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;而  stability.ai 却是一个年轻的英国团队&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5440074906367042&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBeHKqCfRaA4C4N85PD8JhHYWXmQVDzIuc7CnkibdLT2KjV8y2hhWDA4g/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2136&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;他们的宗旨为  “&lt;strong&gt;&lt;strong&gt;AI by the people, for the people” ，&lt;/strong&gt;&lt;/strong&gt;中文翻译的大意为，人们创造AI，并且AI服务于人，除了 stable-diffusion  他们还参与了众多的 AI 项目&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6949860724233984&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBMFPZMfLoVsw2fx0Ws69QXPwtN9sVAkL0JNa10PecsF3zL86qqDyFyQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2872&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;今天主要介绍的就是 stable-diffusion 的玩法，官方利用 stable-diffusion 搭建的平台主要是 dreamstudio.ai 听这个名字就感觉很牛，梦幻编辑器（自己取得，勿喷，因为生成的图都很梦幻），你也可以自己使用 colab 来本地运行，下面就来详解介绍这两种方式&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;使用方式&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;1.官网注册账号&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;打开 https://beta.dreamstudio.ai/  选择一种注册方式，我这里使用了 Google 账号登录（后面也有相关的教程来教你如何来注册一个Google账号），你也可以选择自己的方式。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8014112903225806&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBcMMO8w2a8sMH7ALIflTibX7kjecaPK0BsdY5VCSTib049Voktg7B78Pw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1984&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;注册好后，就可以进入到这个界面。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6318339100346021&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBAYkHFoZ3Md0kictGtDL3AcBMpTLTgwnZBBGBHsYtbMgCHw9PkY6DZJQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2890&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;你可以直接在下方输入名词，也可以在打开右侧的设置按钮，里面会更详细的配置。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6572554169402495&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBQbegW48bHxUTv8Cl2WDB7TTelDuanFXx4xAdIf7DNQzjUPxWetbRoQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;3046&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;输入好关键词后，直接点 &lt;code&gt;Dream&lt;/code&gt; 按钮，等待10秒左右就可以生成图片。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6578773895847067&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBmFyvKHh8xeF0ZwzxibNWDsXBMjesT5HnIVEyib8YB770ua4AQmDOWRbw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;3034&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然这样的生成方式非常的方便，但是是有次数限制的。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;2.0902439024390245&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBuKMbTsVMhMjPiaGzcDaDvBRkiaKcurQ42ibVsTYDOm2vyVaUI6xMC3ia7Q/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;820&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以看到右上角的点数，默认你注册账号会有200点点数，每次生成一张默认设置的图片就会消耗一个点数，如果你要生成更多的方式就需要付费了， 10 英镑 1000 点数。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8327137546468402&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBB6W10bKwSl7Z3vVibz6cqtj25bgXtZ9LOoKXiaVGYWhxLGCHFic6FUXZQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;538&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果你想获得更高精细程度的图片，单次则需要消耗更多的点数。以下是官方给出的价格表：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.25375939849624063&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBAnPicMV2OZXX9ACBgatJJGVvKrzZzI6OSkOuoc2hibUuIMInMMSF92xQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2128&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;而且使用这种方式，你生成图片的版权是自动转为为 CC0 1.0，你可以商用或者非商用你生成的图片，但是也会默认成为公共领域的资源。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.12310606060606061&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKB8HUlOcjeDibJSGF5azMqOMdIurj4TRsVRIedc6W4MA0hoeYohxOicmmg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2112&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2.使用 Colab（推荐）&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这一种是我比较推荐的方式，因为这种方式你可以几乎无限地使用 Stable Diffusion，并且由于这种方式是你自己跑模型的方式生成的图片，版权归属于你自己。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Colab 是什么呢？&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;Colaboratory 简称“Colab”，是 Google Research 团队开发的一款产品。在 Colab 中，任何人都可以通过浏览器编写和执行任意 Python 代码。它尤其适合机器学习、数据分析和教育目的。从技术上来说，Colab 是一种托管式 Jupyter 笔记本服务。用户无需设置，就可以直接使用，同时还能获得 GPU 等计算资源的免费使用权限。—— https://research.google.com/colaboratory/faq.html?hl=zh-CN&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;由于 Colab 是Google 的产品，因此你使用前&lt;strong&gt;必须要拥有一个 Google 账户&lt;/strong&gt;，如果不知道怎么注册的划到最底下的 Google 账号注册教程。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;而我们目前默认使用的是 Hugging face 开源的 colab 示例。&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;Hugging face 是一家总部位于纽约的聊天机器人初创服务商，开发的应用在青少年中颇受欢迎，在上面存储了大量的模型，而 Stability.ai 的 Stable ****Diffusion 也是开源在上面。&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;打开链接：https://colab.research.google.com/github/huggingface/notebooks/blob/main/diffusers/stable_diffusion.ipynb&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;打开后，点击右上角的连接。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.596995427824951&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBdYsS7YfTxRku2uq57ib1buQJtiaBSEKWVACaMfzwNw2nanWFUxEzaia8Q/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;3062&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;点击确定&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3188097768331562&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKB0s6CTTVKLVjiamDMlxMiblwUAQJW7PMsbRqiaCUC2DzibQic7JjhyPRGWsw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1882&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;等连接上后我们运行第一段脚本，就是查看当前使用的机器。一般是从 K80、T4、P100、V100 中随机分配一个。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我拿到的是一个 Tesla T4 GPU 的机器，这里比较看人品。如果你拿到一个 V100 的一定要发一波炫耀一下。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4952107279693487&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBWich4GXBLLI4cnbzz2tSvgQ0jBAY8hxplr7K03BgJ7nFUkjuoKL98iaA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2088&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后继续跑下面的命令，安装必要的依赖，每次安装完成后，都会显示运行时间以及运行状态。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.20264900662251656&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBvaRX3SaOicPMTkRXx8cdrOky1CljA0cpdvaXtz3cqb8po38vKibW586w/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1510&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.1609322974472808&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBcFn0h0ia3nz8eJtcnQjkAUqek6pvOTTJE9CzKxIkHO8pxValiaqsSZEA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;运行到这一步，会要求你填写一个  huggingface_hub 的 token 链接&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5391414141414141&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBNibshrPonjW8L8KM8Peb3YrDId2jzdJ1W8A4kPkvIJwLibjBSmg1FMlw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1584&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;来到 https://huggingface.co/settings/tokens 这个页面，如果没有登录默认会调到登录页&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.1317494600431965&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBCQEUojSBsj61ZzU78Gic0jtGIxqM6uA6mStjCpdAwWlVSrJiaNUNQWLQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;926&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;注册一个账号后，复制这个 Token 到 Colab 页面&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7530224525043178&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBicmnks30bmyd0bUFyxHuiceibcZibglGq60KmMf7MPDBZq6wIgetmojg0Q/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1158&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后会提示你登录成功了，如果提示异常应该是你复制错了，这个时候你得点开秘钥，手动复制一下。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.39332365747460085&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBAZsicxAmZawLVfPanhZ7yg0ib0IANWHDGpqW7ypvxWuVYDuiavwX8XEPQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1378&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后接下来我们就开始拉取模型&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.33152594887683967&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBPfEhqNA8E8CfP2jCM9u09f5PM5aBwx8icI8voKZs4ymRCObnfNibrTfw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2582&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;注意，这里你直接先运行，是会报错了，会显示 403&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;{&lt;span&gt;&quot;error&quot;&lt;/span&gt;:&lt;span&gt;&quot;Access to model CompVis/stable-diffusion-v1-4 is restricted and you are not in the authorized list. Visit https://huggingface.co/CompVis/stable-diffusion-v1-4 to ask for access.&quot;&lt;/span&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这是因为你没有去 huggingface 授权访问。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;打开 https://huggingface.co/CompVis/stable-diffusion-v1-4&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7838150289017342&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBHzsDyZs3cWUNUpnwEZOw0PjTdwElLe4vzicFzwtEOCEvoxkNvEvAibxA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1730&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;点击 运行这个仓库，然后再回到 Colab 就可以正常拉取模型了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最后就到了激动人心的时候了，开始生成图片，运行以下两个步骤，prompt 就是描述，你可以输入任何你想输入的话语。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4117647058823529&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKB5dtgRBWa5HvkvzIN7zn7iaqUxPtww4f0sc8ZwnxmAy8ozNLkhsfjgvg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1972&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用官方默认的 prompt 点击运行就会生成一张宇航员骑马的照片（大约20秒左右）&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.0108892921960073&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBmlmH2mZ4PV94diaG9XgOhOLOa11B6WNSvsibPOJo5MiaD4yzbt3Ljh7lg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1102&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;nice，这个就是我生成的图片。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;以上基础的教程就完成了，后面还可以设置更多丰富的参数。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;设置随机种子（先快速生成低质量图片看看效果，然后再调高画质）&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.31596638655462184&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKB5k9NfwnIgG6R9JvgDD81hMQln6y8RwOTbC5mv1neicsDrVdPLBC6exw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1190&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;调整迭代次数&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.26640926640926643&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBibrHqA2xaONYQrEl0N1d1eLbtGzf45sq4Uj7LgGianJYmnYX9orQMHMw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1554&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;多列图片&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6874154262516915&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKByGh3wkHYwzSmo2hXTLJ0kANhJZXH2hT2J2cQXHDoQNEIchQU8icOZpA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1478&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;设置宽高&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7950530035335689&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBSsiazHMWrNHQvyLpobxXibIo6jKHtTQj7pshpNBWwJibSQUOAtKiaicXsZQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1698&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;总的来说我个人更加偏好这种方式，因为可以自己 diy，而且可以近乎无限地使用。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最后如果你想不好 prompt 的话，可以参考这个网站 https://lexica.art/ ，含有大量别人试验好的样子。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4415156507413509&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKB3VdmhOUC6r18uo7rKrGxpoVLyTGvVHdFIj2b0tKebrHwKWqeaOuFGg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2428&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;3.本地运行&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果你自己有高级显卡，可以自己尝试。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;关于版权&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;确实总的来说，stable-diffusion 并没有特别限制，但是使用图片必须要遵守以下规则：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5678832116788322&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBk2M74WYkl5iaZ0RGorTTBQyWFBYVx5HlPZqXXYsdpxdtw2ooEdWk0jA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2740&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1.如果你是使用第三方平台，需要遵守第三方平台的一些规定，例如官方的 dreamstudio.ai 你可以自己商业或者非商用，但是默认你得也遵循 CC0 1.0 条约。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2.如果你使用自己本地部署，那么版权归属你自己。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Google 账号注册&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;首先emmm，科学xx，懂得都懂&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;打开 https://accounts.google.com/v3/signin/identifier?dsh=S-989160527%3A1661836665075766&amp;amp;continue=https%3A%2F%2Fwww.google.com%2F&amp;amp;ec=GAZAmgQ&amp;amp;hl=zh-CN&amp;amp;passive=true&amp;amp;flowName=GlifWebSignIn&amp;amp;flowEntry=ServiceLogin&amp;amp;ifkv=AQN2RmWH2zA7GGOXiR2mIL7T6SGoXLDpEOZ3gEGnQQfuG7ZguLJmi39jsX2U4YORUfFpDKLqAYNy&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;点击创建账号 —— 个人用途&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.103734439834025&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBZiccaficzcXyAdbJEuE8iaY6k4OblRa9u9YySwKM7bWpernbYVt4saLbw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;964&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;填写基本的个人信息&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7890137328339576&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBTAy6ticMDOWibkCHuZGNLiaqKMibgLCmLNYpf48l6IVrcCyEXO0eibMfAcA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1602&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;填写手机号和年月信息&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9250317662007624&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBEIjDXFN1hmeh96E6hnZEtuAejDEY3Qk5QfmLk7ibSmeMF8zQ8FbaAiag/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1574&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后手机收到一个验证码，点击验证，打工搞成&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.710126582278481&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBLxTL4qjG7ncj0Hb8CWMdacxPuYFosQMGtrZW7FQQXmMedAPibIQ95ug/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1580&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后点击跳过&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8231552162849872&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBGvoSAw0hG2QXmj4sbNGSxnV7W9lJ5TR5ezxAPl8icQ1IYZLMNcgDIfA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1572&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;同意协议，大功告成！&lt;/p&gt;&lt;hr data-tool=&quot;mdnice编辑器&quot;/&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;放一波我最近生成的图，春夏秋冬的亭子&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.1086587436332767&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBouzlRGyHiaatibLHJZIgVc7sOfcCTJ9jPkBiaTIfLP9ibADYnc5uCNZVYw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1178&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果你有不明白或者是数字绘画爱好者欢迎交流呀。（严禁打广告、发不相关的内容！码过期的话加 qiufengblue）&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.311572700296736&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/gibGQibkduDnAibGzCW1jnC7hKibUKrp0vKBY50afUle9iaDLbldbsWX42bjicAfnNd2tT9K9fEX3Tc6FoMo3Z3ySFMw/640?wx_fmt=jpeg&quot; data-type=&quot;png&quot; data-w=&quot;1011&quot;/&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;br/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;参考文献&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;https://www.51cto.com/article/716817.html&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>75f8a87d49705827885b08c5e640e75e</guid>
<title>微服务网关Gateway实践总结</title>
<link>https://toutiao.io/k/f4nh7n3</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                       &quot; id=&quot;js_content&quot;&gt;&lt;blockquote&gt;&lt;p&gt;有多少请求，被网关截胡；&lt;/p&gt;&lt;/blockquote&gt;&lt;h1&gt;&lt;span&gt;一、Gateway简介&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;微服务架构中，网关服务通常提供动态路由，以及流量控制与请求识别等核心能力，在之前的篇幅中有说过Zuul组件的使用流程，但是当下Gateway组件是更常规的选择，下面就围绕Gateway的实践做详细分析；&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.58046875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvCu97J3Dg4hIl1VSQF5DhibFCCkbjQxS2doI4j9nOVYFAMFKSvpWtBDa8NSkGSoYCPkfaLxWQBbeTw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;从架构模式上看，网关不管采用什么技术组件，都是在客户端与业务服务中间提供一层拦截与校验的能力，但是相比较Zuul来说，Gateway提供了更强大的功能和卓越的性能；&lt;/p&gt;&lt;p&gt;基于实践的场景来看，在功能上网关更侧重请求方的合法校验，流量管控，以及IP级别的拦截，从架构层面看，通常需要提供灵活的路由机制，比如灰度，负载均衡的策略等，并基于消息机制，进行系统级的安全通知等；&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.1703125&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvCu97J3Dg4hIl1VSQF5DhibFSsKJYTDEuGVu0s7BfhyDjaKeJby6IjV8gEZORQhOQB8lEMwNKvQ7KA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;下面围绕客户端、网关层、门面服务的三个节点，分析Gateway的使用细节，即客户端向网关发出请求，经过网关路由到门面服务处理；&lt;/p&gt;&lt;h1&gt;&lt;span&gt;二、动态路由&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span&gt;1、基础概念&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;路由&lt;/strong&gt;：作为网关中最核心的能力，从源码结构上看，包括ID、请求URI、断言集合、过滤集合等组成；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RouteDefinition&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt; &lt;span&gt;private&lt;/span&gt; String id;&lt;br/&gt; &lt;span&gt;private&lt;/span&gt; URI uri;&lt;br/&gt; &lt;span&gt;private&lt;/span&gt; List&amp;lt;PredicateDefinition&amp;gt; predicates = &lt;span&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();&lt;br/&gt; &lt;span&gt;private&lt;/span&gt; List&amp;lt;FilterDefinition&amp;gt; filters = &lt;span&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;断言+过滤&lt;/strong&gt;：通常在断言中定义请求的匹配规则，在过滤中定义请求的处理动作，结构上看都是名称加参数集合，并且支持快捷的方式配置；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;PredicateDefinition&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt; &lt;span&gt;private&lt;/span&gt; String name;&lt;br/&gt; &lt;span&gt;private&lt;/span&gt; Map&amp;lt;String, String&amp;gt; args = &lt;span&gt;new&lt;/span&gt; LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;FilterDefinition&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt; &lt;span&gt;private&lt;/span&gt; String name;&lt;br/&gt; &lt;span&gt;private&lt;/span&gt; Map&amp;lt;String, String&amp;gt; args = &lt;span&gt;new&lt;/span&gt; LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;span&gt;2、配置路由&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;以配置的方式，添加&lt;code&gt;facade&lt;/code&gt;服务路由，以路径匹配的方式，如果请求路径错误则断言失败，StripPrefix设置为1，即在过滤中去掉第一个&lt;code&gt;/facade&lt;/code&gt;参数；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;spring:&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;application:&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;name:&lt;/span&gt; &lt;span&gt;gateway&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;cloud:&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;gateway:&lt;/span&gt;&lt;br/&gt;      &lt;span&gt;routes:&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;-&lt;/span&gt; &lt;span&gt;id:&lt;/span&gt; &lt;span&gt;facade&lt;/span&gt;&lt;br/&gt;          &lt;span&gt;uri:&lt;/span&gt; &lt;span&gt;http://127.0.0.1:8082&lt;/span&gt;&lt;br/&gt;          &lt;span&gt;predicates:&lt;/span&gt;&lt;br/&gt;            &lt;span&gt;-&lt;/span&gt; &lt;span&gt;Path=/facade/**&lt;/span&gt;&lt;br/&gt;          &lt;span&gt;filters:&lt;/span&gt;&lt;br/&gt;            &lt;span&gt;-&lt;/span&gt; &lt;span&gt;StripPrefix=1&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;执行原理如下：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.14140625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvCu97J3Dg4hIl1VSQF5DhibF4RM6WOdbtJVeoQHXhQe1ibgZl8iaeYibP4s69Z5kWJzgYCztd4F7xiaiaEw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;这里是以配置文件的方式，设置&lt;code&gt;facade&lt;/code&gt;服务的路由策略，其中指定了路径方式，在Gateway文档中提供了多种路由样例，比如：Header、Cookie、Method、Query、Host等断言方式；&lt;/p&gt;&lt;h2&gt;&lt;span&gt;3、编码方式&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;基于编码的方式管理路由策略，在Gateway文档同样提供了多种参考样例，如果路由服务少并且固定，配置的方式可以解决，如果路由服务很多，并且需要动态添加，那基于库表方式更适合；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Configuration&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;GateConfig&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;@Bean&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; RouteLocator &lt;span&gt;customRouteLocator&lt;/span&gt;&lt;span&gt;(RouteLocatorBuilder builder)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; builder.routes()&lt;br/&gt;                .route(&lt;span&gt;&quot;facade&quot;&lt;/span&gt;,r -&amp;gt; r.path(&lt;span&gt;&quot;/facade/**&quot;&lt;/span&gt;).filters(f -&amp;gt; f.stripPrefix(&lt;span&gt;1&lt;/span&gt;))&lt;br/&gt;                .uri(&lt;span&gt;&quot;http://127.0.0.1:8082&quot;&lt;/span&gt;)).build();&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;span&gt;4、库表加载&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;在常规的应用中，从库表中读取路由策略是比较常见的方式，定义路由工厂类并实现&lt;code&gt;RouteDefinitionRepository&lt;/code&gt;接口，涉及加载、添加、删除三个核心方法，然后基于服务类从库中读取数据转换为&lt;code&gt;RouteDefinition&lt;/code&gt;对象即可；&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.3484375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvCu97J3Dg4hIl1VSQF5DhibFB21SEY31t0kvBugKEs4n0MFnGWOklMmKibkfqFyicaZFChib0b82qJ6dw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Component&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;DefRouteFactory&lt;/span&gt; &lt;span&gt;implements&lt;/span&gt; &lt;span&gt;RouteDefinitionRepository&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;@Resource&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; ConfigRouteService routeService ;&lt;br/&gt;    &lt;span&gt;// 加载&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Flux&amp;lt;RouteDefinition&amp;gt; &lt;span&gt;getRouteDefinitions&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; Flux.fromIterable(routeService.getRouteDefinitions());&lt;br/&gt;    }&lt;br/&gt;    &lt;span&gt;// 添加&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Mono&amp;lt;Void&amp;gt; &lt;span&gt;save&lt;/span&gt;&lt;span&gt;(Mono&amp;lt;RouteDefinition&amp;gt; route)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; route.flatMap(routeDefinition -&amp;gt; { routeService.saveRouter(routeDefinition);&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; Mono.empty();&lt;br/&gt;        });&lt;br/&gt;    }&lt;br/&gt;    &lt;span&gt;// 删除&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Mono&amp;lt;Void&amp;gt; &lt;span&gt;delete&lt;/span&gt;&lt;span&gt;(Mono&amp;lt;String&amp;gt; idMono)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; idMono.flatMap(routeId -&amp;gt; { routeService.removeRouter(routeId);&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; Mono.empty();&lt;br/&gt;        });&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在源码仓库中采用的就是库表管理的方式，代码逻辑的更多细节可以移步Git参考，此处不再过多粘贴；&lt;/p&gt;&lt;h1&gt;&lt;span&gt;三、自定义路由策略&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;自定义断言&lt;/strong&gt;，继承&lt;code&gt;AbstractRoutePredicateFactory&lt;/code&gt;类，注意命名以&lt;code&gt;RoutePredicateFactory&lt;/code&gt;结尾，重写&lt;code&gt;apply&lt;/code&gt;方法，即可执行特定的匹配规则；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Component&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;DefCheckRoutePredicateFactory&lt;/span&gt; &lt;span&gt;extends&lt;/span&gt; &lt;span&gt;AbstractRoutePredicateFactory&lt;/span&gt;&amp;lt;&lt;span&gt;DefCheckRoutePredicateFactory&lt;/span&gt;.&lt;span&gt;Config&lt;/span&gt;&amp;gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;DefCheckRoutePredicateFactory&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;super&lt;/span&gt;(Config&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;)&lt;/span&gt;;&lt;br/&gt;    }&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Predicate&amp;lt;ServerWebExchange&amp;gt; &lt;span&gt;apply&lt;/span&gt;&lt;span&gt;(Config config)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; GatewayPredicate() {&lt;br/&gt;            &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;            &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; &lt;span&gt;test&lt;/span&gt;&lt;span&gt;(ServerWebExchange serverWebExchange)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;                log.info(&lt;span&gt;&quot;DefCheckRoutePredicateFactory：&quot;&lt;/span&gt; + config.getName());&lt;br/&gt;                &lt;span&gt;return&lt;/span&gt; StrUtil.equals(&lt;span&gt;&quot;butte&quot;&lt;/span&gt;,config.getName());&lt;br/&gt;            }&lt;br/&gt;        };&lt;br/&gt;    }&lt;br/&gt;    &lt;span&gt;@Data&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;Config&lt;/span&gt; &lt;/span&gt;{ &lt;span&gt;private&lt;/span&gt; String name; }&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; List&amp;lt;String&amp;gt; &lt;span&gt;shortcutFieldOrder&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{ &lt;span&gt;return&lt;/span&gt; Collections.singletonList(&lt;span&gt;&quot;name&quot;&lt;/span&gt;); }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;自定义过滤&lt;/strong&gt;，继承&lt;code&gt;AbstractNameValueGatewayFilterFactory&lt;/code&gt;类，注意命名以&lt;code&gt;GatewayFilterFactory&lt;/code&gt;结尾，重写&lt;code&gt;apply&lt;/code&gt;方法，即可执行特定的过滤规则；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Component&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;DefHeaderGatewayFilterFactory&lt;/span&gt; &lt;span&gt;extends&lt;/span&gt; &lt;span&gt;AbstractNameValueGatewayFilterFactory&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; GatewayFilter &lt;span&gt;apply&lt;/span&gt;&lt;span&gt;(AbstractNameValueGatewayFilterFactory.NameValueConfig config)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; (exchange, chain) -&amp;gt; {&lt;br/&gt;            log.info(&lt;span&gt;&quot;DefHeaderGatewayFilterFactory：&quot;&lt;/span&gt;+ config.getName() + &lt;span&gt;&quot;-&quot;&lt;/span&gt; + config.getValue());&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; chain.filter(exchange);&lt;br/&gt;        };&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;配置加载方式&lt;/strong&gt;，此处断言与过滤即快捷的配置方式，所以在命名上要遵守Gateway的约定；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code&gt;spring:&lt;br/&gt;  cloud:&lt;br/&gt;    gateway:&lt;br/&gt;      routes:&lt;br/&gt;        - id: facade&lt;br/&gt;          uri: http://127.0.0.1:8082&lt;br/&gt;          predicates:&lt;br/&gt;            - Path=/facade/**&lt;br/&gt;            - DefCheck=butte&lt;br/&gt;          filters:&lt;br/&gt;            - StripPrefix=1&lt;br/&gt;            - DefHeader=cicada,smile&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;通常来说，在应用级的系统中都需要进行断言和过滤的策略自定义，以提供业务或者架构层面的支撑，完成更加细致的规则校验，尤其在相同服务多版本并行时，可以更好的管理路由策略，从而避免分支之间的影响；&lt;/p&gt;&lt;h1&gt;&lt;span&gt;四、全局过滤器&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p&gt;在路由中采用的过滤是&lt;code&gt;GatewayFilter&lt;/code&gt;，实际Gateway中还提供了&lt;code&gt;GlobalFilter&lt;/code&gt;全局过滤器，虽然从结构上看十分相似，但是其职责是有本质区别的；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Component&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Order&lt;/span&gt;(&lt;span&gt;1&lt;/span&gt;)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;DefOneGlobalFilter&lt;/span&gt; &lt;span&gt;implements&lt;/span&gt; &lt;span&gt;GlobalFilter&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Mono&amp;lt;Void&amp;gt; &lt;span&gt;filter&lt;/span&gt;&lt;span&gt;(ServerWebExchange exchange, GatewayFilterChain chain)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        log.info(&lt;span&gt;&quot;request-id:{}&quot;&lt;/span&gt;,exchange.getRequest().getId()) ;&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; chain.filter(exchange);&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Component&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Order&lt;/span&gt;(&lt;span&gt;2&lt;/span&gt;)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;DefTwoGlobalFilter&lt;/span&gt; &lt;span&gt;implements&lt;/span&gt; &lt;span&gt;GlobalFilter&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Mono&amp;lt;Void&amp;gt; &lt;span&gt;filter&lt;/span&gt;&lt;span&gt;(ServerWebExchange exchange, GatewayFilterChain chain)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        log.info(&lt;span&gt;&quot;request-uri:{}&quot;&lt;/span&gt;,exchange.getRequest().getURI()) ;&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; chain.filter(exchange);&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Gateway网关作为微服务架构系统中最先接收请求的一层，可以定义许多策略来保护系统的安全，比如高并发接口的限流，第三方授权验证，遭到恶意攻击时的IP拦截等等，尽量将非法请求在网关中拦截掉，从而保证系统的安全与稳定。&lt;/p&gt;&lt;h1&gt;&lt;span&gt;五、参考源码&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;应用仓库：&lt;br/&gt;https://gitee.com/cicadasmile/butte-flyer-parent&lt;br/&gt;&lt;br/&gt;组件封装：&lt;br/&gt;https://gitee.com/cicadasmile/butte-frame-parent&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mp-common-profile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzU4Njg0MzYwNw==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvBj3abVSgCmvm7FIYw55ficInd2se9ia6KSic0ma25AUvrmUtXUwXibjhHmCc7DUawfXBI30QuHBjDnzw/0?wx_fmt=png&quot; data-nickname=&quot;知了一笑&quot; data-alias=&quot;cicada_smile&quot; data-signature=&quot;积累、总结、用心记录。&quot; data-from=&quot;0&quot; data-is_biz_ban=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;

          

          
          &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>9059540abd31910478d477d58347b560</guid>
<title>面试官：Spring中获取Bean有几种方式？</title>
<link>https://toutiao.io/k/x9gh2qw</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;你好，&lt;span&gt;我是田哥，主要从事&lt;/span&gt;&lt;strong&gt;Java面试辅导&lt;/strong&gt;&lt;span&gt;和技术分享。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;前两天，有位同学在面试中被问了：&lt;span&gt;&lt;strong&gt;&lt;span&gt;Spring中获取Bean有几种方式？&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了悲剧不在上演，今天给大家安排。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;一共七种方式&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1、使用&lt;code&gt;BeanFactory&lt;/code&gt;直接获取（不推荐）&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2、在初始化时保存&lt;code&gt;ApplicationContext&lt;/code&gt;对象&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;3、继承自抽象类&lt;code&gt;ApplicationObjectSupport&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;4、继承自抽象类&lt;code&gt;WebApplicationObjectSupport&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;5、使用Spring提供的工具类&lt;code&gt;WebApplicationContextUtils&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;6、实现&lt;code&gt;ApplicationContextAware&lt;/code&gt;接口&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;7、使用&lt;code&gt;ContextLoader&lt;/code&gt;提供的&lt;code&gt;getCurrentWebApplicationContext()&lt;/code&gt;方法&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;面试遇到了把这七种方式说完就行，其实只要你能记住三五种，面试官也是认可你的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可是，不好记呀，对么？怎么办？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面，田哥给你整理好了每个方式的对应案例。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;一.使用BeanFactory直接获取（不推荐）&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用&lt;code&gt;BeanFactory&lt;/code&gt;从工厂中直接获取Bean实例，但是&lt;code&gt;XmlBeanFactory&lt;/code&gt;类已经废弃，因此不建议使用，测试代码如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;/**&lt;br/&gt; * 方式一：XmlBeanFactory已经废弃不建议使用&lt;br/&gt; */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Test&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;getBeanTest1&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    BeanFactory beanFactory = &lt;span&gt;new&lt;/span&gt; XmlBeanFactory(&lt;span&gt;new&lt;/span&gt; ClassPathResource(&lt;span&gt;&quot;applicationContext.xml&quot;&lt;/span&gt;));&lt;br/&gt;    UserInfo userInfo = (UserInfo) beanFactory.getBean(&lt;span&gt;&quot;userInfo&quot;&lt;/span&gt;);&lt;br/&gt;    System.out.println(userInfo);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;二.在初始化时保存ApplicationContext对象&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以在初始化的时候保存&lt;code&gt;ApplicationContext&lt;/code&gt;对象，然后通过这个对象获取Bean，测试代码如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;/**&lt;br/&gt; * 方式二：使用ClassPathXmlApplicationContext获取ApplicationContext&lt;br/&gt; */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Test&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;getBeanTest2&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    ApplicationContext applicationContext = &lt;span&gt;new&lt;/span&gt; ClassPathXmlApplicationContext(&lt;span&gt;&quot;applicationContext.xml&quot;&lt;/span&gt;);&lt;br/&gt;    UserInfo userInfo = (UserInfo) applicationContext.getBean(&lt;span&gt;&quot;userInfo&quot;&lt;/span&gt;);&lt;br/&gt;    System.out.println(userInfo);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;三.继承自抽象类ApplicationObjectSupport&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以继承抽象类&lt;code&gt;ApplicationObjectSupport&lt;/code&gt;并将自己继承的类注入到Spring容器中，示例代码如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;/**&lt;br/&gt; * 方法三：继承ApplicationObjectSupport来获取ApplicationContext，&lt;br/&gt; * 注意：需要把自己继承的类注入到Spring&lt;br/&gt; */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Test&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;getBeanTest3&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    ApplicationContextUtil2 applicationContextUtil2 = (ApplicationContextUtil2) ApplicationContextUtil.getBean(&lt;span&gt;&quot;applicationContextUtil2&quot;&lt;/span&gt;);&lt;br/&gt;    UserInfo userInfo = (UserInfo) applicationContextUtil2.getBean(&lt;span&gt;&quot;userInfo&quot;&lt;/span&gt;);&lt;br/&gt;    System.out.println(userInfo);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中&lt;code&gt;ApplicationContextUtil2&lt;/code&gt;的代码如下所示：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;ApplicationContextUtil2&lt;/span&gt; &lt;span&gt;extends&lt;/span&gt; &lt;span&gt;ApplicationObjectSupport&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;/**&lt;br/&gt;     * 通过bean的id获取bean对象&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; beanName&lt;br/&gt;     * &lt;span&gt;@return&lt;/span&gt;&lt;br/&gt;     */&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Object &lt;span&gt;getBean&lt;/span&gt;&lt;span&gt;(String beanName)&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; &lt;span&gt;super&lt;/span&gt;.getApplicationContext().getBean(beanName);&lt;br/&gt;    }&lt;br/&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最后莫忘了将Bean注入到Spring容器中，通过注解，或者配置均可，本示例通过配置实现&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&amp;lt;!-- 测试获取bean的方式,继承ApplicationObjectSupport需要先注入这个类 --&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;bean&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;applicationContextUtil2&quot;&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;=&lt;span&gt;&quot;com.leo.util.ApplicationContextUtil2&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span&gt;&amp;lt;/&lt;span&gt;bean&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;四.继承自抽象类WebApplicationObjectSupport&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以继承抽象类&lt;code&gt;WebApplicationObjectSupport&lt;/code&gt;并将自己继承的类注入到Spring容器中，示例代码如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;/**&lt;br/&gt; * 方法四：继承WebApplicationObjectSupport来获取ApplicationContext，&lt;br/&gt; * 注意：需要把自己继承的类注入到Spring，同时需要添加&lt;span&gt;@WebAppConfiguration&lt;/span&gt;注解，否则会找不到web容器&lt;br/&gt; */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Test&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;getBeanTest4&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    ApplicationContextUtil3 applicationContextUtil3 = (ApplicationContextUtil3) ApplicationContextUtil.getBean(&lt;span&gt;&quot;applicationContextUtil3&quot;&lt;/span&gt;);&lt;br/&gt;    UserInfo userInfo = (UserInfo) applicationContextUtil3.getBean(&lt;span&gt;&quot;userInfo&quot;&lt;/span&gt;);&lt;br/&gt;    System.out.println(userInfo);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中&lt;code&gt;ApplicationContextUtil3&lt;/code&gt; 的示例代码如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;ApplicationContextUtil3&lt;/span&gt; &lt;span&gt;extends&lt;/span&gt; &lt;span&gt;WebApplicationObjectSupport&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;/**&lt;br/&gt;     * 通过bean的id获取bean对象&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; beanName&lt;br/&gt;     * &lt;span&gt;@return&lt;/span&gt;&lt;br/&gt;     */&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Object &lt;span&gt;getBean&lt;/span&gt;&lt;span&gt;(String beanName)&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; &lt;span&gt;super&lt;/span&gt;.getWebApplicationContext().getBean(beanName);&lt;br/&gt;    }&lt;br/&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最后莫忘了将Bean注入到Spring容器中，通过注解，或者配置均可，本示例通过配置实现&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&amp;lt;!-- 测试获取bean的方式,继承WebApplicationObjectSupport需要先注入这个类 --&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;bean&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;applicationContextUtil3&quot;&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;=&lt;span&gt;&quot;com.leo.util.ApplicationContextUtil3&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span&gt;&amp;lt;/&lt;span&gt;bean&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;五.使用Spring提供的工具类WebApplicationContextUtils&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用Spring提供的工具类&lt;code&gt;WebApplicationContextUtils&lt;/code&gt;来获取&lt;code&gt;WebApplicationContext&lt;/code&gt;对象，这个方法很常见于SpringMVC构建的web项目中，测试代码如下所示：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;/**&lt;br/&gt; * 方法五：使用WebApplicationContextUtils提供的方法获取ApplicationContext对象&lt;br/&gt; */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Test&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;getBeanTest5&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;//模拟ServletContext上下文，不然会出现空指针异常&lt;/span&gt;&lt;br/&gt;    MockServletContext sc = &lt;span&gt;new&lt;/span&gt; MockServletContext(&lt;span&gt;&quot;&quot;&lt;/span&gt;);&lt;br/&gt;    sc.addInitParameter(ContextLoader.CONFIG_LOCATION_PARAM, &lt;span&gt;&quot;/applicationContext.xml&quot;&lt;/span&gt;);&lt;br/&gt;    ServletContextListener listener = &lt;span&gt;new&lt;/span&gt; ContextLoaderListener();&lt;br/&gt;    ServletContextEvent event = &lt;span&gt;new&lt;/span&gt; ServletContextEvent(sc);&lt;br/&gt;    listener.contextInitialized(event);&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;//使用WebApplicationContextUtils的getRequiredWebApplicationContext方法&lt;/span&gt;&lt;br/&gt;    WebApplicationContext webApplicationContext = WebApplicationContextUtils.getRequiredWebApplicationContext(sc);&lt;br/&gt;    UserInfo userInfo = (UserInfo) webApplicationContext.getBean(&lt;span&gt;&quot;userInfo&quot;&lt;/span&gt;);&lt;br/&gt;    System.out.println(userInfo);&lt;br/&gt;    &lt;span&gt;//使用WebApplicationContextUtils的getWebApplicationContext方法&lt;/span&gt;&lt;br/&gt;    WebApplicationContext webApplicationContext2 = WebApplicationContextUtils.getWebApplicationContext(sc);&lt;br/&gt;    UserInfo userInfo2 = (UserInfo) webApplicationContext2.getBean(&lt;span&gt;&quot;userInfo&quot;&lt;/span&gt;);&lt;br/&gt;    System.out.println(userInfo2);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;六.实现ApplicationContextAware接口&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;通过实现&lt;code&gt;ApplicationContextAware&lt;/code&gt;接口，在Spring容器启动的时候将&lt;code&gt;ApplicationContext&lt;/code&gt;注入进去，从而获取&lt;code&gt;ApplicationContext&lt;/code&gt;对象，这种方法也是常见的获取Bean的一种方式，测试代码如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;/**&lt;br/&gt; *方法六：实现ApplicationContextAware接口获取ApplicationContext&lt;br/&gt; */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Test&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;getBeanTest6&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;    UserInfo userInfo2 = (UserInfo) ApplicationContextUtil.getBean(&lt;span&gt;&quot;userInfo&quot;&lt;/span&gt;);&lt;br/&gt;    System.out.println(userInfo2);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中&lt;code&gt;ApplicationContextUtil&lt;/code&gt;的实现如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;ApplicationContextUtil&lt;/span&gt; &lt;span&gt;implements&lt;/span&gt; &lt;span&gt;ApplicationContextAware&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; ApplicationContext applicationContext;&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;/**&lt;br/&gt;     * 通过bean的id获取bean对象&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; beanName&lt;br/&gt;     * &lt;span&gt;@return&lt;/span&gt;&lt;br/&gt;     */&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; Object &lt;span&gt;getBean&lt;/span&gt;&lt;span&gt;(String beanName)&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; applicationContext.getBean(beanName);&lt;br/&gt;    }&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;/**&lt;br/&gt;     * 根据bean的id和类型获取bean对象&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; beanName&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; clazz&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; &amp;lt;T&amp;gt;&lt;br/&gt;     * &lt;span&gt;@return&lt;/span&gt;&lt;br/&gt;     */&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span&gt;T &lt;span&gt;getBean&lt;/span&gt;&lt;span&gt;(String beanName,Class&amp;lt;T&amp;gt; clazz)&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; clazz.cast(getBean(beanName));&lt;br/&gt;    }&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;setApplicationContext&lt;/span&gt;&lt;span&gt;(ApplicationContext applicationContext)&lt;/span&gt; &lt;span&gt;throws&lt;/span&gt; BeansException &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;this&lt;/span&gt;.applicationContext = applicationContext;&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;七.使用ContextLoader提供的getCurrentWebApplicationContext方法&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用&lt;code&gt;ContextLoader&lt;/code&gt;提供的&lt;code&gt;getCurrentWebApplicationContext&lt;/code&gt;方法提供的方法也是常用的获取&lt;code&gt;WebApplicationContext&lt;/code&gt;的一种方法，这个方法常见于SpringMVC实现的web项目中。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;测试代码如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;/**&lt;br/&gt; * 方法七：使用ContextLoader的getCurrentWebApplicationContext方法获取WebApplicationContext&lt;br/&gt; */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Test&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;getBeanTest7&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    MockServletContext sc = &lt;span&gt;new&lt;/span&gt; MockServletContext(&lt;span&gt;&quot;&quot;&lt;/span&gt;);&lt;br/&gt;    sc.addInitParameter(ContextLoader.CONFIG_LOCATION_PARAM, &lt;span&gt;&quot;/applicationContext.xml&quot;&lt;/span&gt;);&lt;br/&gt;    ServletContextListener listener = &lt;span&gt;new&lt;/span&gt; ContextLoaderListener();&lt;br/&gt;    ServletContextEvent event = &lt;span&gt;new&lt;/span&gt; ServletContextEvent(sc);&lt;br/&gt;    listener.contextInitialized(event);&lt;br/&gt;    &lt;span&gt;//如果不加上面的模拟创建ServletContext对象，会报空指针异常&lt;/span&gt;&lt;br/&gt;    WebApplicationContext wac = ContextLoader.getCurrentWebApplicationContext();&lt;br/&gt;    UserInfo userInfo = (UserInfo) wac.getBean(&lt;span&gt;&quot;userInfo&quot;&lt;/span&gt;);&lt;br/&gt;    System.out.println(userInfo);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这么一顿操作下来，是不是印象更深了？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再回头想想，有几种方式？你记住几种？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;好了，今天就分享到这里。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;关于如何背面试题，很多人估计都很烦恼，所以，田哥给大家准备了一个&lt;code&gt;在线刷面试&lt;/code&gt;的小破网站，目前正在疯狂的更新中 ....&lt;span/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;感兴趣可以直&lt;/span&gt;&lt;span&gt;接访问地址（阅读原文也可以直接跳转过去）：&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;http://www.woaijava.cc/mianshi/index&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.8827586206896552&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/07BicZywOVtlVWtXeBKWXj7icia2B62sCbpSBREq0wiczyfSxLKwwPkKshI3tZyp0sb7aq5oAJ0D8ficTUThjx0TpxQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;435&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span/&gt;&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;好文推荐&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247512731&amp;amp;idx=1&amp;amp;sn=a7548c86bca8bf4a6ec411f7cc9b48e3&amp;amp;chksm=fd551a70ca22936653c0ddbf55d018e7647be9540aac0e47d1f917f6e0d5561ee9fe19b74bea&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;手写RPC框架，真不是为了装13！&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;手写RPC框架，真不是为了装13！&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247512754&amp;amp;idx=1&amp;amp;sn=0aeb4f8c0a6a7b9cc7457d8908207e1c&amp;amp;chksm=fd551a59ca22934f160ac32e62fd3b6f3648be00a2fc5c114ab2e084dc0b1875b041d5e90a35&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;面试中，如何介绍自己的项目经验？&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;面试中，如何介绍自己的项目经验？&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247511102&amp;amp;idx=1&amp;amp;sn=409beae53dd4775bfe920be433199017&amp;amp;chksm=fd5504d5ca228dc35d72bfe3bb5d798539ea862852d51046941435b516c4d16ffa707ca6ec76&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;50000多字，线程池源码详解！建议收藏&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;50000多字，线程池源码详解！建议收藏&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247512591&amp;amp;idx=1&amp;amp;sn=4c2dfb0eb51825f86586d7b6a4e511bd&amp;amp;chksm=fd551ae4ca2293f28526c34f0c0bbb09f8b704cb8919efb61c5c4266ac36220b8dfd920db133&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;坚持一年，成功进入前50名！&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;坚持一年，成功进入前50名！&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247510579&amp;amp;idx=1&amp;amp;sn=aa49460843a88e78cae9c8aafceb710c&amp;amp;chksm=fd5502d8ca228bce423ebca9ade425a8a469a653ca2239c1bcd1e7dcc1f3c8219dc5ff307c59&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;手把手教：如何准备面试！&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;手把手教：如何准备面试！&lt;/a&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>