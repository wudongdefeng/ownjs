<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>fb2ce8ea38b025188012704f36b27320</guid>
<title>集成GPT-4的编程神器来了，GitHub发布Copilot X：编程30年，突然就不需要手敲代码了？！</title>
<link>https://toutiao.io/k/muzf4uz</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content              autoTypeSetting24psection&amp;#10;            &quot; id=&quot;js_content&quot;&gt;&lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.612037037037037&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ZBjVrHIdkOnGxVp2VBkvTZFuQzHl5hNTMToH0diboqUURAESh7hh3n2j8KicvMCic70Fhsc6KHd4SdibxpI2GkuzHg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;section&gt;作者 ｜ 核子可乐、Tina&lt;/section&gt;&lt;section&gt;畅想十多年后，失去了“AI 助手”的年轻人无法编码了，那企业只能再高薪聘请真正会编程的白发老年人回来了.....&lt;/section&gt;&lt;p&gt;在 GPT-4 模型的支持下，微软打造的 AI“结对编程助手”已经能够标记 pull 请求、生成模仿文档和讨论代码内容。GitHub 还添加了 OpenAI 的聊天功能，这也就是说 Copilot X 将允许程序员以 ChatGPT 的风格，通过语音聊天来编写和调试代码。&lt;/p&gt;&lt;section&gt;&lt;span&gt;1&lt;/span&gt;GPT-4 驱动的新 Copilot 编码助手&lt;/section&gt;&lt;p&gt;经过新一轮训练，微软 GitHub 的 Copilot 编程模型再度升级，也让这位广受好评的 AI 助手在开发领域的地位又稳牢了一层。&lt;/p&gt;&lt;p&gt;为了纪念这一重大时刻，微软还给这位编程助手改了名：Copilot X。请注意，X 代表可能性、可不是“限制级”。&lt;/p&gt;&lt;p&gt;GitHub CEO Thomas Dohmke 在博文中写道，“我们的 GitHub Next 研发团队一直在努力超越传统编辑器，希望将 GitHub Copilot 开发成贯穿整个开发生命周期、而且易于使用的 AI 助手。最终成果就是 GitHub Copilot X，代表着我们对于未来 AI 软件开发愿景的希冀。”“它将从根本上影响开发人员的体验。”&lt;/p&gt;&lt;p&gt;但在随后的介绍中，Dohmke 自己仍然称这款软件为 Copilot，不禁让人怀疑是不是 X 这部分还要等待些时日才能真正名副其实。&lt;/p&gt;&lt;p&gt;展望未来，Copilot 将对接一系列不断发展的大语言模型，包括 OpenAI 的 GPT-3.5-turbo 和 GPT-4，而不再沿用 OpenAI Codex 的定制化版本。OpenAI 将于 2023 年 3 月 23 日关闭 Codex 的公共 API，但强调 Codex 的停用不会对客户造成影响。有声音怀疑此次 API 终止跟 Codex 和 Copilot 身陷版权和许可诉讼有关，但 OpenAI 并未立即做出置评。&lt;/p&gt;&lt;p&gt;在经过一年的技术试验之后，Copilot 于去年夏季正式推出，能够为使用 GitHub 及受支持文本编辑器 /IDE（例如 Visual Studio Code）的开发人员提供编码建议。尽管质量不够稳定，但仍开创了生成式 AI 服务编程领域的先河。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_img_placeholder&quot; data-ratio=&quot;0.5249266862170088&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VMGiaTKoSZVQqFf3wYV25ZpTHLuzVU4TOBKJNP3wH6MQY8JnVJWCxRlySwYjnibxSYH5g6JIrNkBgEA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1023&quot;/&gt;&lt;/p&gt;&lt;p&gt;根据 GitHub 的数据，截至上个月，Copilot 已参与到微软全体云代码仓库中的 46%，帮助开发人员将编程速度提高了 55%。&lt;/p&gt;&lt;section&gt;&lt;span&gt;2&lt;/span&gt;Copilot 升级版可以用来做什么&lt;/section&gt;&lt;p&gt;Copilot 升级之后，现在它能在 Visual Studio Code 和 Visual Studio 中以 ChatGPT 的风格与用户交流。提示和响应对话显示在 IDE 侧边栏的聊天窗口内，不再像之前那样在源文件中依靠评论查询提供自动补全建议。&lt;/p&gt;&lt;p&gt;Dohmke 表示，“Copilot Chat 不只是提供一个聊天窗口，它可以识别开发人员输入的代码、显示的错误消息，并深深嵌入至 IDE 当中。”&lt;/p&gt;&lt;p&gt;它集成了“嘿，GitHub”语音扩展功能（也就是现在的 GitHub Copilot Voice），使用自然语音提示，这位编程助手可以生成（或复制）代码并按需运行。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_img_placeholder&quot; data-ratio=&quot;0.5605187319884726&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VMGiaTKoSZVQqFf3wYV25ZpTM7gdV0L5EMqwVjrPlcSetWkU5MicAicmJwiaDUJGXcRlYyw3icUoKq5NMw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;694&quot;/&gt;&lt;/p&gt;&lt;p&gt;Dohmke 表示，“Copilot Chat 的技术基础，跟 OpenAI 和微软的 ChatGPT 与 New Bing 是完全相同的”。并且 Dohmke 还展示了通过聊天来编写 Python 版本的贪吃蛇游戏，并表示非常沉迷其中。&lt;/p&gt;&lt;p&gt;这种功能也震撼到了一些开发者：“ChatGPT 将永远改变编程。对我来说，作为一名开发人员最令人愉快的方面是处理逻辑和解决技术问题，而不是专注于生产力或满足需求。虽然这种改变让我沮丧，但我知道我需要习惯它。”“我也是。迄今为止，我手写代码已经 30 年了，我仍然热爱编程。但如果从此没有手写编码，我不确定世界会是什么样子。”......&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4295874822190612&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VMGiaTKoSZVQqFf3wYV25ZpTDqf74Xyenn4wGo4a1tNjlD1k7W00H2c3bwALq9qq6TJkqOmpdLQkLA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;png&quot; data-w=&quot;703&quot;/&gt;&lt;/p&gt;&lt;p&gt;另外，开发人员可以高亮显示源文件中的正则表达式，并邀请 Copilot 解释表达式中的迟钝模式。Copilot 还可根据要求生成测试、分析和调试，提出修复建议或尝试自定义任务。该模型甚至能够为源代码添加解释性注释，并像 linter 那样清理文件。&lt;/p&gt;&lt;p&gt;对于这部分功能，有网友表示他从测试版开始就一直在使用 Copilot，它在生成测试方面可以说是“大放异彩”，“感觉像是重复各种繁琐的事情，测试各种各样的输入，测试各种各样的错误案例，与手工相比，它花费的时间要少得多。”&lt;/p&gt;&lt;p&gt;另一位名为“roygbivasaur”的网友则表示，他现在的工作是编写 kubernetes 控制器并使用 envtest 和 ginkgo 为控制器编写测试。令人沮丧是他必须执行通常由默认 kubernetes 控制器完成的所有任务（例如为 sts 创建 pod）。但使用了 Copilot，编写了几个测试之后，“现在当我编写新测试时，它可以从上下文（测试用例、测试描述、CRD 类型、我显然正在测试的协调器等）中推断出什么我需要创建的对象，我需要监视的状态，甚至可能的特定故障状态。它完成了我大部分的测试，我只需要校对它。”&lt;/p&gt;&lt;p&gt;简而言之，使用 Copilot 来做一些测试用例还是非常能提高效率的。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_img_placeholder&quot; data-ratio=&quot;0.6227436823104693&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VMGiaTKoSZVQqFf3wYV25ZpTWXslqOBhokg5Bia1KhJo3X8yicGmg2GQaOOZbRDDGy2G2NBfsMbSYXpw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;png&quot; data-w=&quot;554&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Copilot 处理 pull 请求的截屏&lt;/span&gt;&lt;/p&gt;&lt;p&gt;无论如何，GitHub 已经在开放预览版中引入了 GPT-4 支持，现在 AI 已经能为所有 pull 请求（代码变更提交）生成描述。&lt;/p&gt;&lt;p&gt;在 AI 的监控下，开发人员在发出 pull 请求时将看到 GitHub 模型帮你填写标签，尝试描述接下来可能发生的情况。开发人员则可根据标签进行操作或修改。&lt;/p&gt;&lt;p&gt;更重要的是，Copilot 的应用范围还扩展到了文档层面。从 React、Azure Docs 和 MDN 文档开始，开发人员可以通过聊天界面提出问题并获取 AI 生成的答案。Dohmke 介绍称，通过聊天界面与文档交互的能力将很快被扩展至组织用户的内部代码仓库和文档当中。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6227436823104693&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VMGiaTKoSZVQqFf3wYV25ZpTwpqUUgzCGicPLqwLCKvicFRBEeYx4tB4Kw8utP1oFh0rA6FzEJdZUGyQ/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;png&quot; data-w=&quot;554&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Copilot CLI 截屏&lt;/span&gt;&lt;/p&gt;&lt;p&gt;因此，开发人员将可以提出不那么结构化的问题，并直接从 Copilot 那边获得合理建议甚至是非常准确的答案（但不提供来源属性）。这就取代了以往基于关键字的文档内容查询，也让我们更能理解为什么谷歌被这位突如其来的 AI 红人打得措手不及。&lt;/p&gt;&lt;p&gt;GitHub 甚至提供 Copilot CLI 以渗透命令行界面。如果大家突然忘记了某条晦涩的命令行咒语或者命令标志，Copilot 可以立刻提供帮助。&lt;/p&gt;&lt;section&gt;&lt;span&gt;3&lt;/span&gt;写在最后&lt;/section&gt;&lt;p&gt;至于这位强大编程助手的存在到底是不是好事，就看各位如何理解了。Dohmke 强调说 Copilot 可以在开发过程的每个阶段发挥重要作用，从项目规划到代码的最终部署，然而鉴于 Bing 在 GPT-4 支持下的表现“也就那样”，New Bing 似乎也不如 Dohmke 设想中的那么“New”，所以还需要时间来证明 Copilot 的能力。但在相对更简单的代码生成场景下，GPT-4 也许能够更轻松地提供有用输出。&lt;/p&gt;&lt;p&gt;Copilot 将马上提供给 waiting list 中的开发人员注册使用，Dohmke 说，在第一波产品准入之后，更多的开发人员将获得访问权限，具体取决于需求水平。&lt;/p&gt;&lt;p&gt;Copilot 的个人费用为每月 10 美元，企业费用为每位开发人员每月 19 美元。&lt;/p&gt;&lt;p&gt;鉴于有整整一代开发人员需要支付 1000-2000 美元或更多来订阅 MSDN 以开展业务，Copilot 这个定价也许不算太高。考虑以后很大可能“AI 编程助手”是开发人员不可或缺的编程工具，那集成了 GPT-4 的“Copilot X”对微软来说其战略重大，这场 AI 战争也许是继 Windows 操作系统、Azure 云服务之后的一大终局之战。&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;附申请网址：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Copilot X: &lt;/span&gt;&lt;span&gt;https://github.com/github-copilot/chat_waitlist_signup/&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Copilot Voice: &lt;/span&gt;&lt;span&gt;https://githubnext.com/projects/copilot-voice/&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Copilot Docs: &lt;/span&gt;&lt;span&gt;https://githubnext.com/projects/copilot-for-docs/&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Copilot for PRs: &lt;/span&gt;&lt;span&gt;https://githubnext.com/projects/copilot-for-pull-requests/&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Copilot CLI: &lt;/span&gt;&lt;span&gt;https://githubnext.com/projects/copilot-cli/&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;参考链接：&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;https://github.blog/2023-03-22-github-copilot-x-the-ai-powered-developer-experience/&lt;/span&gt;&lt;br/&gt;&lt;span&gt;https://www.theregister.com/2023/03/22/github_copilot_learns_new_tricks/&lt;/span&gt;&lt;br/&gt;&lt;span&gt;https://www.reddit.com/r/programming/comments/11ylui4/github_copilot_x_the_aipowered_developer/&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;h5 data-style=&quot;margin-top: 38px; outline: 0px; font-size: 18px; max-width: 100%; background-position: center center; background-size: 57px; background-image: url(&amp;quot;https://mmbiz.qpic.cn/mmbiz_png/ZBjVrHIdkOkM8cOgHxmx9gjQ8sLJgmkoGicicUDBmkOlhkr0UMhyNFyGh2a0CDfxfz3eNR8n6DyMbH4CcLhoM3WA/640?wx_fmt=png&amp;quot;); letter-spacing: 0.544px; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; flex-direction: row; height: 51px; line-height: 52px; display: flex; justify-content: center; color: rgb(60, 112, 198); box-sizing: border-box !important; overflow-wrap: break-word !important;&quot;&gt;今日荐文&lt;/h5&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;amp;mid=2247589764&amp;amp;idx=1&amp;amp;sn=f86dd5b9a4e47cd44f4aa05f0fcb0f0c&amp;amp;chksm=fbeb264bcc9caf5de4b20adb61f031daca833d781a376266476810b0ecedb4dc34597bffc9ee&amp;amp;token=769973666&amp;amp;lang=zh_CN&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;ChatGPT联网终极进化！插件系统正式开放、无需编码就能上手，网友：这是我见过最疯狂的系统&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;em&gt;&lt;span&gt;ChatGPT联网终极进化！插件系统正式开放、无需编码就能上手，网友：这是我见过最疯狂的系统&lt;/span&gt;&lt;/em&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;amp;mid=2247589493&amp;amp;idx=1&amp;amp;sn=c0eff63a90c670e3ef9cefa3ce2d981a&amp;amp;chksm=fbeb27bacc9caeac3bc2efa6654a182d380504572008f4bc88c36c79469eae4683e50d7d7abb&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;GPT-4&amp;quot;失控&amp;quot;行为大赏：创建行动计划欲接管推特并取代马斯克，还引诱教授帮其制定逃跑计划&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;&lt;em&gt;&lt;span&gt;GPT-4&quot;失控&quot;行为大赏：创建行动计划欲接管推特并取代马斯克，还引诱教授帮其制定逃跑计划&lt;/span&gt;&lt;/em&gt;&lt;span/&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;amp;mid=2247589429&amp;amp;idx=1&amp;amp;sn=03aded18b624f5589aa558473236a4f0&amp;amp;chksm=fbeb27facc9caeec17cf11ed7d511ca2205e47b02c50c28b294bd5ace19cf415d58b71a4ea6d&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;李开复下场抢人！宣布筹办新AI公司：目标不只是中文ChatGPT，资金算力已到位&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;&lt;span&gt;&lt;em&gt;李开复下场抢人！宣布筹办新AI公司：目标不只是中文ChatGPT，资金算力已到位&lt;/em&gt;&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;&lt;/p&gt;&lt;p data-style=&quot;margin-bottom: 14px; outline: 0px; max-width: 100%; font-size: 22px; letter-spacing: 0.544px; line-height: 1.4; color: rgb(34, 34, 34); font-family: system-ui, -apple-system, BlinkMacSystemFont, &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei UI&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; text-align: start; visibility: visible; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot;&gt;&lt;img class=&quot;rich_pages wxw-img __bg_gif&quot; data-backh=&quot;312&quot; data-backw=&quot;562&quot; data-ratio=&quot;0.5555555555555556&quot; data-type=&quot;gif&quot; data-w=&quot;900&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/ZBjVrHIdkOnuwJnWZEgj3C0zJnf1iaYSvWWIkchT1kR9m13cSrszq2icExufMBR3wanOGRM3glOY8Z5RribVVsMUA/640?wx_fmt=gif&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&quot;/&gt;&lt;/p&gt;&lt;/section&gt;&lt;p data-style=&quot;margin-bottom: 0px; padding-top: 23px; padding-right: 8px; padding-left: 8px; outline: 0px; max-width: 100%; box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 16px; letter-spacing: 0.544px; background-color: rgb(255, 255, 255); white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74); text-align: right; overflow-wrap: break-word !important;&quot;&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;span data-style=&quot;outline: 0px; max-width: 100%; letter-spacing: 0.544px; text-align: right; color: rgb(2, 30, 170); box-sizing: border-box !important; overflow-wrap: break-word !important;&quot;&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;你也「在看」吗？&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span data-style=&quot;outline: 0px; max-width: 100%; letter-spacing: 0.544px; text-align: right; color: rgb(0, 82, 255); box-sizing: border-box !important; overflow-wrap: break-word !important;&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt; 👇&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;mp-style-type data-value=&quot;3&quot;/&gt;&lt;/p&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>1eb80fe9a9a7a09f929290632f739204</guid>
<title>explain | 索引优化的这把绝世好剑，你真的会用吗？</title>
<link>https://toutiao.io/k/lciw0o2</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大家好，我是楼仔呀。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;欢迎大家到我的知识星球【&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=Mzg3OTU5NzQ1Mw==&amp;amp;mid=2247494334&amp;amp;idx=1&amp;amp;sn=a2f647ac0bf4ee1c342a2b1315e120f7&amp;amp;chksm=cf00a85cf877214a57def06ad1ca32bd85c297590bead3d6263bb78ee218a0c9af0fcf73cfc5&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;技术派&lt;/a&gt;】，一起学习，一起进步。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;对于互联网公司来说，随着用户量和数据量的不断增加，慢查询是无法避免的问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一般情况下如果出现慢查询，意味着接口响应慢、接口超时等问题，如果是高并发的场景，可能会出现数据库连接被占满的情况，直接导致服务不可用。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;1. 前言&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;慢查询的确会导致很多问题，我们要如何优化慢查询呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;主要解决办法有：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;监控sql执行情况，发邮件、短信报警，便于快速识别慢查询sql&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;打开数据库慢查询日志功能&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;简化业务逻辑&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;代码重构、优化&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;异步处理&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;sql优化&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;索引优化&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其他的办法先不说，后面有机会再单独介绍。今天我重点说说索引优化，因为它是解决慢查询sql问题最有效的手段。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如何查看某条sql的索引执行情况呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;没错，在sql前面加上&lt;code&gt;explain&lt;/code&gt;关键字，就能够看到它的执行计划，通过执行计划，我们可以清楚的看到表和索引执行的情况，索引有没有执行、索引执行顺序和索引的类型等。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;索引优化的步骤是：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;使用&lt;code&gt;explain&lt;/code&gt;查看sql执行计划&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;判断哪些索引使用不当&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;优化sql，sql可能需要多次优化才能达到索引使用的最优值&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;既然索引优化的第一步是使用&lt;code&gt;explain&lt;/code&gt;，我们先全面的了解一下它。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2. explain介绍&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;先看看mysql的官方文档是怎么描述explain的：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kpoicCelQNQZ2XD0xHavicjic8aKfSEib90ah7J43sW11HicuvuibD6M5oYyQ/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.41203703703703703&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;EXPLAIN可以使用于 SELECT， DELETE， INSERT， REPLACE，和 UPDATE语句。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;当EXPLAIN与可解释的语句一起使用时，MySQL将显示来自优化器的有关语句执行计划的信息。也就是说，MySQL解释了它将如何处理该语句，包括有关如何连接表以及以何种顺序连接表的信息。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;当EXPLAIN与非可解释的语句一起使用时，它将显示在命名连接中执行的语句的执行计划。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;对于SELECT语句， EXPLAIN可以显示的其他执行计划的警告信息。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;3. explain详解&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;explain的语法：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;{EXPLAIN | DESCRIBE | DESC}&lt;br/&gt;    tbl_name [col_name | wild]&lt;br/&gt;&lt;br/&gt;{EXPLAIN | DESCRIBE | DESC}&lt;br/&gt;    [explain_type]&lt;br/&gt;    {explainable_stmt | FOR CONNECTION connection_id}&lt;br/&gt;&lt;br/&gt;explain_type: {&lt;br/&gt;    EXTENDED&lt;br/&gt;  | PARTITIONS&lt;br/&gt;  | FORMAT = format_name&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;format_name: {&lt;br/&gt;    TRADITIONAL&lt;br/&gt;  | JSON&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;explainable_stmt: {&lt;br/&gt;    SELECT statement&lt;br/&gt;  | DELETE statement&lt;br/&gt;  | INSERT statement&lt;br/&gt;  | REPLACE statement&lt;br/&gt;  | UPDATE statement&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用一条简单的sql看看使用&lt;code&gt;explain&lt;/code&gt;关键字的效果：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain  select * from test1;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kO3VHAJaQXmU5kK3IxYUzTKpS53tfElDIrMbzzDY8W8Qt5a6DFnxIBw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.06388888888888888&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;从上图中看到执行结果中会显示12列信息，每列具体信息如下：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kqJNiarvwlZ02IDE0h7p4kXc387QNBAwpm0A06gnIcqwUEQ2BoiaKXlWw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;1.1130434782608696&quot; data-w=&quot;920&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;说白了，我们要搞懂这些列的具体含义才能正常判断索引的使用情况。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;话不多说，直接开始介绍吧。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.1 id 列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列的值是select查询中的序号，比如：1、2、3、4等，它决定了表的执行顺序。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;某条sql的执行计划中一般会出现三种情况：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;id相同&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;id不同&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;id相同和不同都有&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;那么这三种情况表的执行顺序是怎么样的呢？&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;id相同&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain  select * from test1 t1 inner  join test1 t2 on t1.id=t2.id&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kLervBHPDBZVjCIiaKic9p6easoiakia5mkkPplVib3JxJFSjiaJkHuf3iaJjQ/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.06111111111111111&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们看到执行结果中的两条数据id都是1，是相同的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这种情况表的执行顺序是怎么样的呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;答案：从上到下执行，先执行表t1，再执行表t2。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行的表要怎么看呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;答案：看table字段，这个字段后面会详细解释。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;id不同&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain  select * from test1 t1 &lt;span&gt;where&lt;/span&gt; t1.id = (select  id  from  test1 t2 &lt;span&gt;where&lt;/span&gt;  t2.id=2);&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kPdVpcPlhichucKLib6qyA76kT4nJ6nCO3pJ4MF07N7CI6vlgfqUKU89Q/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.08425925925925926&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们看到执行结果中两条数据的id不同，第一条数据是1，第二条数据是2。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这种情况表的执行顺序是怎么样的呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;答案：序号大的先执行，这里会从下到上执行，先执行表t2，再执行表t1。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;id相同和不同都有&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain &lt;br/&gt;select t1.* from test1 t1&lt;br/&gt;inner  join (select  max(id) mid  from test1 group  by  id) t2&lt;br/&gt;on t1.id=t2.mid&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kE7icz2DYpbhWF45AS2jvwFSWCP236icRT1zY6sfHqbmpS8sSyvs83RGw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.1&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们看到执行结果中三条数据，前面两条数据的的id相同，第三条数据的id跟前面的不同。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这种情况表的执行顺序又是怎么样的呢？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;答案：先执行序号大的，先从下而上执行。遇到序号相同时，再从上而下执行。所以这个列子中表的顺序顺序是：test1、t1、&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;也许你会在这里心生疑问：&lt;code&gt;&amp;lt;&lt;/code&gt; &lt;code&gt;derived2&amp;gt;&lt;/code&gt; 是什么鬼？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;它表示派生表，别急后面会讲的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;还有一个问题：id列的值允许为空吗？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;答案在后面揭晓。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.2 select_type列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列表示select的类型。具体包含了如下11种类型：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kcZ4hxd9ABD7h8qM8ahRiapIxFaB9Cf99U5Btp7Kg443VedI0GbhYYTg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.6962962962962963&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但是常用的其实就是下面几个：&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;类型&lt;/th&gt;&lt;th&gt;含义&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;SIMPLE&lt;/td&gt;&lt;td&gt;简单SELECT查询，不包含子查询和UNION&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PRIMARY&lt;/td&gt;&lt;td&gt;复杂查询中的最外层查询，表示主要的查询&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;SUBQUERY&lt;/td&gt;&lt;td&gt;SELECT或WHERE列表中包含了子查询&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;DERIVED&lt;/td&gt;&lt;td&gt;FROM列表中包含的子查询，即衍生&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;UNION&lt;/td&gt;&lt;td&gt;UNION关键字之后的查询&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;UNION RESULT&lt;/td&gt;&lt;td&gt;从UNION后的表获取结果集&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面看看这些SELECT类型具体是怎么出现的：&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;SIMPLE&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select * from test1;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kStLQBMmn9UvcJaSsr4Bo1EwFGiciaicI4W9KjbMnEbZBdY0sUUNL0Fpwg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.07592592592592592&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;它只在简单SELECT查询中出现，不包含子查询和UNION，这种类型比较直观就不多说了。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;PRIMARY 和 SUBQUERY&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select * from test1 t1 &lt;span&gt;where&lt;/span&gt; t1.id = (select id from  test1 t2 &lt;span&gt;where&lt;/span&gt;  t2.id=2);  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2ksJaZMTicUvI080lXhS7B6vFtXalUac61jmKibJHib1iadAB17WEbic6nS3A/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.08518518518518518&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们看到这条嵌套查询的sql中，最外层的t1表是PRIMARY类型，而最里面的子查询t2表是SUBQUERY类型。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;DERIVED&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain  &lt;br/&gt;select t1.* from test1 t1  &lt;br/&gt;inner join (select max(id) mid from test1 group by id) t2  &lt;br/&gt;on t1.id=t2.mid  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2khAQz5ImCj8UepNSwGOoibUV5tTrCP7ia8GjxvUThiaiaNy9mqciapwMjicicg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.11018518518518519&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最后一条记录就是衍生表，它一般是FROM列表中包含的子查询，这里是sql中的分组子查询。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;UNION 和 UNION RESULT&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain  &lt;br/&gt;select * from test1  &lt;br/&gt;union  &lt;br/&gt;select* from test2  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kHzicZyBlf52QApUmniccibksyTmr3icI70AJDcOpKicrOYphUiae1OG6YkHg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.10740740740740741&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;test2表是UNION关键字之后的查询，所以被标记为UNION，test1是最主要的表，被标记为PRIMARY。而&amp;lt;union1,2&amp;gt;表示id=1和id=2的表union，其结果被标记为UNION RESULT。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;UNION 和 UNION RESULT一般会成对出现。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;此外，回答上面的问题：&lt;/strong&gt; &lt;strong&gt;id列的值允许为空吗？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果仔细看上面那张图，会发现id列是可以允许为空的，并且是在SELECT类型为：UNION RESULT的时候。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.3 table列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列的值表示输出行所引用的表的名称，比如前面的：test1、test2等。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但也可以是以下值之一：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;&amp;lt;unionM,N&amp;gt;&lt;/code&gt;：具有和id值的行的M并集N。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;&amp;lt;derivedN&amp;gt;&lt;/code&gt;：用于与该行的派生表结果id的值N。派生表可能来自（例如）FROM子句中的子查询 。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;&amp;lt;subqueryN&amp;gt;&lt;/code&gt;：子查询的结果，其id值为N&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.4 partitions列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列的值表示查询将从中匹配记录的分区&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.5 type列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列的值表示连接类型，是查看索引执行情况的一个重要指标。包含如下类型：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kvnRImFPQQ1sfylafBkz0WOJ6Nr3Urspy33WibqpzldRGjnxsYj4eXtw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.7231481481481481&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行结果从最好到最坏的的顺序是从上到下。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们需要重点掌握的是下面几种类型：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;system &amp;gt; const &amp;gt; eq_ref &amp;gt; ref &amp;gt; range &amp;gt; index &amp;gt; ALL&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在演示之前，先说明一下test2表中只有一条数据：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kmqUEm4qwUe0Tkm8wM5um2ibs0Kho7P4wwJpo29y3nd3BZG7ruUia2YqA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.25287356321839083&quot; data-w=&quot;348&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;并且code字段上面建了一个普通索引：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2k2YznqwXKJqPQbRtD73kGb4qMUnlCRfChlibplJp4nHdb1ibZWwmbaRhw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.11481481481481481&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面逐一看看常见的几个连接类型是怎么出现的：&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;system&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这种类型要求数据库表中只有一条数据，是const类型的一个特例，一般情况下是不会出现的。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;const&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;通过一次索引就能找到数据，一般用于主键或唯一索引作为条件的查询sql中，执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select * from test2 &lt;span&gt;where&lt;/span&gt; id=1;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kd4fkG8goyGf3N4ej7WqxdaVAqqT4UrQGt2UIfu76BDic8WtOjU9VgDg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.06574074074074074&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;eq_ref&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;常用于主键或唯一索引扫描。执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select * from test2 t1 inner join test2 t2 on t1.id=t2.id;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kJulD2LQKicox3L3Db9jdSCTuhzuamUAjxmcNibVu85G53icaH2z31WlGw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.08518518518518518&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;此时，有人可能感到不解，const和eq_ref都是对主键或唯一索引的扫描，有什么区别？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;答：const只索引一次，而eq_ref主键和主键匹配，由于表中有多条数据，一般情况下要索引多次，才能全部匹配上。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;ref&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;常用于非主键和唯一索引扫描。执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select * from test2 &lt;span&gt;where&lt;/span&gt; code = &lt;span&gt;&#x27;001&#x27;&lt;/span&gt;;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2k7Svvs3JVvF7w3QxcmNRmJiarFibXwbmoI9dtU45U3II963jOscib5Bgwg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.06388888888888888&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;range&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;常用于范围查询，比如：between ... and 或 In 等操作，执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select * from test2 &lt;span&gt;where&lt;/span&gt; id between 1 and 2;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kefd80qqoRJsWUS1ibl3PR4Ptic0FzaAqKQXcDTHt8nVovCqNrwNJfzCA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.06481481481481481&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;index&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;全索引扫描。执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select code from test2;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kJe3ochfmFgTjsp2KZgbCSw2jKBU7LI2hMI53H65n6SC9qYdJsBaKUQ/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.07037037037037037&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;ALL&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;全表扫描。执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select *  from test2;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kW86NpiagvibUlUKMX3n5iawwIknNDfDib8EDfGeXIeLFhK03jsMemXR2dg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.06944444444444445&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.6 possible_keys列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列表示可能的索引选择。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;请注意，此列完全独立于表的顺序，这就意味着possible_keys在实践中，某些键可能无法与生成的表顺序一起使用。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kPMmV6cSjnLzibwUQjwDFXcIhBOQ6Via3QiaKSAicVUuLpuqlWl4gaT250w/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.08981481481481482&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果此列是NULL，则没有相关的索引。在这种情况下，您可以通过检查该WHERE 子句以检查它是否引用了某些适合索引的列，从而提高查询性能。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.7 key列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列表示实际用到的索引。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可能会出现possible_keys列为NULL，但是key不为NULL的情况。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;演示之前，先看看test1表结构：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2k6Q0iceKkzcGg7uIOhXnReWWYickj2wU6VAmSt2b55HwIZLosicibQIUOibg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.14537037037037037&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;test1表中数据：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kaJRZ2nmcjKtjW7DpOic0ZqUoiaztKj6ibMQXic3buDMVVdsC426QO5Ua9w/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.37777777777777777&quot; data-w=&quot;360&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用的索引：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2ksATCVUmgjMIhfn5PrXv9Piaw1Wq6fu6pKkSIH9FgjgvLGOkiajdc4PNw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.08560311284046693&quot; data-w=&quot;1028&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;code和name字段使用了联合索引。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select code  from test1;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kJt4v2gUAsJptgj5awVfZ7sHutGa0TAmuS8x2Qu35TBgSVyeC54WbTg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.06481481481481481&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这条sql预计没有使用索引，但是实际上使用了全索引扫描方式的索引。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.8 key_len列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列表示使用索引的长度。上面的key列可以看出有没有使用索引，key_len列则可以更进一步看出索引使用是否充分。不出意外的话，它是最重要的列。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2k5LXQ446IFVibcmRDX7tqsPYHGz6licAfMVeRfwTTyGwzuhceUdrNuVVA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.07037037037037037&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;有个关键的问题浮出水面：key_len是如何计算的？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;决定key_len值的三个因素：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1.字符集&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2.长度&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;3.是否为空&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;常用的字符编码占用字节数量如下：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kMx9Lf6icoxXGZgArGTNcCa7crHNibCicXTe32Y2yUIuUk1ayARAuqe3kA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;1.0817307692307692&quot; data-w=&quot;416&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;目前我的数据库字符编码格式用的：UTF8占3个字节。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;mysql常用字段占用字节数：&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;字段类型&lt;/th&gt;&lt;th&gt;占用字节数&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;char(n)&lt;/td&gt;&lt;td&gt;n&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;varchar(n)&lt;/td&gt;&lt;td&gt;n + 2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;tinyint&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;smallint&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;int&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;bigint&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;date&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;timestamp&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;datetime&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;此外，如果字段类型允许为空则加1个字节。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上图中的 184是怎么算的？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;184 = 30 * 3 + 2 + 30 * 3 + 2&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再把test1表的code字段类型改成char，并且改成允许为空：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2krhicVQcZwCbAFqvqyDJTiaCVCc3iah7K4yRjZKspnyXRrpHMMibIDicicWBw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.1648148148148148&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select code  from test1;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kLKIOibTXSTZCsUc7icmVqJrEVgKPeGhtmiaJibI5lm0tokO85wH8TmJK5w/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.06666666666666667&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;怎么算的？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;183 = 30 * 3 + 1 + 30 * 3 + 2&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;还有一个问题：为什么这列表示索引使用是否充分呢，还有使用不充分的情况？&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select code  from test1 &lt;span&gt;where&lt;/span&gt; code=&lt;span&gt;&#x27;001&#x27;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDHwNnQGoicHwEU2oHlmYdy6WfSJFOd96znUpLqsZ1cG2rucwcUKbUek3c4Cl4WwYH0uXZgaMnfUAibw/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.07222222222222222&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上图中使用了联合索引：idx_code_name，如果索引全匹配key_len应该是183，但实际上却是92，这就说明没有使用所有的索引，索引使用不充分。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.9 ref列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列表示索引命中的列或者常量。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select *  from test1 t1 inner join test1 t2 on t1.id=t2.id &lt;span&gt;where&lt;/span&gt; t1.code=&lt;span&gt;&#x27;001&#x27;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2k6dk1uYlt5mx1HgZzhsicYq1xFNAnib2q3nIP8q3RoCt0dsj5eZr0ibO7A/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.08611111111111111&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们看到表t1命中的索引是const(常量)，而t2命中的索引是列sue库的t1表的id字段。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.10 rows列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列表示MySQL认为执行查询必须检查的行数。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kxISHicEfkJlzPwrZq9kG2Lo0rfpYgegmZ55W8KILsy5wxDQuXrZMXEA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.07407407407407407&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;对于InnoDB表，此数字是估计值，可能并不总是准确的。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.11 filtered列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该列表示按表条件过滤的表行的估计百分比。最大值为100，这表示未过滤行。值从100减小表示过滤量增加。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2khZ2yibSIQqkMWVK5icKrziaZa1IMSlc98UicJfzBAVuY1Kq97JA9nYhakQ/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.075&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;rows显示了检查的估计行数，rows× filtered显示了与下表连接的行数。例如，如果 rows为1000且 filtered为50.00（50％），则与下表连接的行数为1000×50％= 500。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.12 Extra列&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该字段包含有关MySQL如何解析查询的其他信息，这列还是挺重要的，但是里面包含的值太多，就不一一介绍了，只列举几个常见的。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Impossible WHERE&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示WHERE后面的条件一直都是false，&lt;br/&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select code  from test1 &lt;span&gt;where&lt;/span&gt; &lt;span&gt;&#x27;a&#x27;&lt;/span&gt; = &lt;span&gt;&#x27;b&#x27;&lt;/span&gt;;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kv2XibVDv5fp0KYu2C7341cnBibTneZznktElC4Yvr2DjuN32RqPG2nBg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.07314814814814814&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Using filesort&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示按文件排序，一般是在指定的排序和索引排序不一致的情况才会出现。&lt;br/&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select code  from test1 order by name desc;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kZIib3XgpGIuibeRZLHLABdwibPJLmcNolgibq4gORic5VpK0OYNQURBK6wA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.07592592592592592&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里建立的是code和name的联合索引，顺序是code在前，name在后，这里直接按name降序，跟之前联合索引的顺序不一样。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Using index&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示是否用了覆盖索引，说白了它表示是否所有获取的列都走了索引。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kxR3W8rO5QH7l6m0ECePAeIlZ4r3VP9wPUz5TQDGTFAOZkwGbSZtWjA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.07314814814814814&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面那个例子中其实就用到了：Using index，因为只返回一列code，它字段走了索引。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Using temporary&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示是否使用了临时表，一般多见于order by 和 group by语句。&lt;br/&gt;执行sql如下：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;explain select name  from test1 group by name;  &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;结果：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEWFbxDB7L0jHzTqu6ust2kLFAtAYJu3vgT4WzZfHXQt04L30zykTONZF4aJRrP7D34fzMmrGd6MQ/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-ratio=&quot;0.06388888888888888&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Using where&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示使用了where条件过滤。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Using join buffer&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示是否使用连接缓冲。来自较早联接的表被部分读取到联接缓冲区中，然后从缓冲区中使用它们的行来与当前表执行联接。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;4. 索引优化的过程&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1.先用慢查询日志定位具体需要优化的sql&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2.使用explain执行计划查看索引使用情况&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;3.重点关注：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;key（查看有没有使用索引）&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;key_len（查看索引使用是否充分）&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;type（查看索引类型）&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Extra（查看附加信息：排序、临时表、where条件为false等）&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一般情况下根据这4列就能找到索引问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;4.根据上1步找出的索引问题优化sql&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;5.再回到第2步&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最后推荐一下我们的技术派星球，&lt;strong&gt;短短一个月，已经加入 160+ 球友&lt;/strong&gt;，好评如潮，详细介绍如下：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.6464646464646464&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sXFqMxQoVLHQc7eMibYaYjibIkeou5S62hqqCJjE3XevmLG8qN5hA2AX19wwRibUGcfhfdvNQJ67YZqB1N2q9Thibg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;594&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再给大家申请一波优惠券，预购从速！&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.2157407407407408&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/sXFqMxQoVLHQc7eMibYaYjibIkeou5S62hcQWftXST21ZuKBf9FqWQYM3tPncIKh1ZM2xcRC8SDnmzIP6RCM3JTw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;前方高能，你可能会错过！！先不要着急退出，你可以先扫码，&lt;strong&gt;进入到支付页面后，会看到星球内部的部分内容&lt;/strong&gt;，就能基本知道这个星球的质量，然后再决定是否购买哈~~&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>c98b0b22700a151650b68b21b94b87cd</guid>
<title>保姆级教程！玩转 ChunJun 详细指南</title>
<link>https://toutiao.io/k/oael7wa</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;mp-common-profile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-weui-theme=&quot;light&quot; data-id=&quot;MzkwMjM5NzM3Mw==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/I8XLOALcSYU0KicmGiaGcmw0OX5TWvrt9g7msJeDFdf6CR8GBwC4HypXgbEAcphUiaPibxPVmPiaOETfTAgB8Y6RsLQ/0?wx_fmt=png&quot; data-nickname=&quot;ChunJun&quot; data-alias=&quot;&quot; data-signature=&quot;稳定、高效、易用的批流一体的数据集成框架&quot; data-from=&quot;0&quot; data-is_biz_ban=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;\&lt;/span&gt; | &lt;span&gt;/&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;关注我们不迷路&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;作者 / 铁柱&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;编辑 / 阿晗&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;ChunJun 是一款稳定、易用、高效、批流一体的数据集成框架，⽀持海量数据的同步与计算。ChunJun 既可以采集静态的数据，比如 MySQL，HDFS 等，也可以采集实时变化的数据，比如 binlog，Kafka 等。同时 ChunJun 也是一个支持原生 FlinkSQL 所有语法和特性的计算框架。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;经过5年的迭代和开发，ChunJun 已经帮助很多公司快速进行数据整合，并解决数据开发人员需要过多进行繁琐的数据抽取工作的问题，可以专注在企业业务场景的构建。&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;之前的内容当中，我们已经介绍过 ChunJun 的技术力、优势，及如何提交 pr、Issue 的方法。作为「chunJun 新手入门」系列的第三篇，&lt;strong&gt;本文将为大家介绍如何配置一个 ChunJun 任务以及通过 ChunJun Client 端提交任务的流程等内容&lt;/strong&gt;，教会大家更好地玩转 ChunJun。&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;  &lt;span&gt;&lt;strong&gt;ChunJun 新手入门&lt;/strong&gt;&lt;/span&gt;  &lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzkwMjM5NzM3Mw==&amp;amp;mid=2247483987&amp;amp;idx=1&amp;amp;sn=5d22e1f7728200cee69d8d3018a7cf80&amp;amp;chksm=c0a76e81f7d0e7970dad95e7c6b259f6b1e1c55f6d524156e799a0f09f1ce18b2490bf72c3e9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;Hi，我是ChunJun，一个有趣好用的开源项目&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;• Hi，我是ChunJun，一个有趣好用的开源项目&lt;/a&gt;&lt;/p&gt;&lt;p&gt;• &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzkwMjM5NzM3Mw==&amp;amp;mid=2247484087&amp;amp;idx=1&amp;amp;sn=76b31c7f1ee04edefbf33ec5ef249965&amp;amp;chksm=c0a76e65f7d0e7734573d4178dce8c723a67d939172594c3c56743eb53731087ee2423ef9abd&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;Ding！您有一份ChunJun实用指南，请查收&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;Ding！您有一份ChunJun实用指南，请查收&lt;/a&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;  &lt;span&gt;&lt;strong&gt;ChunJun 地址&lt;/strong&gt;&lt;/span&gt;  &lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;官网：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong/&gt;&lt;span&gt;&lt;strong&gt;https://dtstack.github.io/chunjun/&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;GitHub：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong/&gt;&lt;span&gt;&lt;strong&gt;https://github.com/DTStack/chunjun&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Gitee：&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong/&gt;&lt;span&gt;&lt;strong&gt;https://gitee.com/dtstack_dev_0/chunjun&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;配置一个 ChunJun 任务&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;ChunJun 的任务脚本⽀持两种模式：Sync(Json) 和 SQL，前者配置更加丰富，底层使⽤的是 StreamAPI，在同步场景使⽤的较多；后者借助 Flink SQL 本身的能⼒，利⽤ SQL 实现对数据的聚合等计算操作，底层使⽤的是 TableAPI。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;Sync&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;同步任务使⽤的 Json 格式的配置⽂件，通过配置 Source/Sink 来完成数据的 EL 流程。⼀个同步任务的基本结构如下:&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;json&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;{&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;job&quot;&lt;/span&gt;: {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;content&quot;&lt;/span&gt;: [&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;{&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;nameMapping&quot;&lt;/span&gt;: {},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;reader&quot;&lt;/span&gt;: {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;parameter&quot;&lt;/span&gt;: {},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;reader&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;writer&quot;&lt;/span&gt;: {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;parameter&quot;&lt;/span&gt;: {},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;writer&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;restoration&quot;&lt;/span&gt;: {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;cache&quot;&lt;/span&gt;: {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;properties&quot;&lt;/span&gt;: {}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;},&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;workerMax&quot;&lt;/span&gt;: &lt;span class=&quot;code-snippet__number&quot;&gt;3&lt;/span&gt;,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;workerSize&quot;&lt;/span&gt;: &lt;span class=&quot;code-snippet__number&quot;&gt;3&lt;/span&gt;,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;workerNum&quot;&lt;/span&gt;: &lt;span class=&quot;code-snippet__number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;ddl&quot;&lt;/span&gt;: {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;properties&quot;&lt;/span&gt;: {}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;],&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;setting&quot;&lt;/span&gt;: {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attr&quot;&gt;&quot;restore&quot;&lt;/span&gt;: {},&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● Job 整个任务的参数配置&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;  //  &lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;1）同步任务的算⼦配置，如 Reader/Writer/Restoration 等。&lt;/p&gt;&lt;p&gt;• &lt;strong&gt;nameMapping：&lt;/strong&gt;表名映射配置，⽤在 CDC 场景&lt;/p&gt;&lt;p&gt;• &lt;strong&gt;reader：&lt;/strong&gt;同步任务 reader 的配置&lt;/p&gt;&lt;p&gt;• &lt;strong&gt;writer：&lt;/strong&gt;同步任务writer的配置&lt;/p&gt;&lt;p&gt;• &lt;strong&gt;restoration：&lt;/strong&gt;数据还原相关配置&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;2）setting 系统的⼀些参数配置，如增量同步(restore)、流控(speed)等。&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;SQL&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;ChunJun 的 SQL 任务直接沿⽤了 FlinkSQL 的引擎。详细⽂档请看：&lt;/p&gt;&lt;p&gt;&lt;strong&gt;https://nightlies.apache.org/flink/flink-docs-release-1.16/docs/dev/table/overview/&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● DDL&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;TABLE&lt;/span&gt; xx(xxx) &lt;span class=&quot;code-snippet__keyword&quot;&gt;WITH&lt;/span&gt;(xxx); &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;VIEW&lt;/span&gt; xxx&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● DML&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;INTO&lt;/span&gt; xxx;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;获取 ChunJun&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;前置准备&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;span&gt;&lt;strong&gt;·&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;Java(JDK8);&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;span&gt;&lt;strong&gt;·&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;Maven(3.6.3，版本太低会找不到对应的 jar，另外，⾼版本的 Maven 对仓库地址强制要求是 HTTPS，会存在仓库地址访问失败的情况)&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;ChunJun 下载&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● release 下载&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;ChunJun release 下载地址：&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;https://github.com/DTStack/chunjun/releases&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● 源码编译&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;源码下载：&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;https://github.com/DTStack/chunjun.git&lt;/strong&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ChunJun 是通过 Maven 来进⾏代码依赖管理，对应的打包命令是：&lt;/p&gt;&lt;/section&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;css&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__selector-tag&quot;&gt;mvn&lt;/span&gt; &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;clean&lt;/span&gt; &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;-Dmaven&lt;/span&gt;&lt;span class=&quot;code-snippet__selector-class&quot;&gt;.test&lt;/span&gt;&lt;span class=&quot;code-snippet__selector-class&quot;&gt;.skip&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ChunJun 使⽤的是 spotless 插件来进⾏代码⻛格管理，在修改源码之后打包，需要对源码先执⾏下 mvn spotless:apply 命令来进⾏代码格式化，否则会出现格式化不合规问题。&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● 目录结构&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;css&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__selector-tag&quot;&gt;chunjun-dist&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;├── &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;chunjun-core&lt;/span&gt;&lt;span class=&quot;code-snippet__selector-class&quot;&gt;.jar&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;├── &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;connector&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;├── &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;ddl&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;├── &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;dirty-data-collector&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;├── &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;docker-build&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;├── &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;metrics&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;└── &lt;span class=&quot;code-snippet__selector-tag&quot;&gt;restore-plugins&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;通过 ChunJun Client 端提交任务&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;通过 LocalTest、Standalone、Yarn Session、Yarn Perjob 四种模式为大家介绍如何通过ChunJun Client 端提交任务。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;LocalTest 模式（适⽤于本地调试）&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;Local Test 模式是针对开发者同学⽤来进行本地测试验证的模块，只需要修改 main() 中的 jobPath 路径即可，需要注意，同步任务的脚本请以 json ⽂件结尾，计算任务的脚本请以 sql ⽂件结尾。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;Standalone 模式&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● 环境准备&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;下载 Flink 并解压&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;wget &quot;http://archive.apache.org/dist/flink/flink-&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;flink.version&lt;/span&gt;&amp;gt;&lt;/span&gt;/flink-&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;flink.version&lt;/span&gt;&amp;gt;&lt;/span&gt;-bin-scala_&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;scala.version&lt;/span&gt;&amp;gt;&lt;/span&gt;.tgz&quot;      &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;tar -zxvf flink-&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;flink.version&lt;/span&gt;&amp;gt;&lt;/span&gt;-bin-scala_&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;scala.version&lt;/span&gt;&amp;gt;&lt;/span&gt;.tgz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● 配置 ChunJun&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;1）下载 ChunJun 并解压&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;nginx&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;wget&lt;/span&gt; &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;https://github.com/DTStack/chunjun/releases/download/&amp;lt;chunjun-tag&amp;gt;/chunjun-dist.tar.gz&quot;&lt;/span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;tar -zxvf chunjun-dist.tar.gz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;2）将 ChunJun-Dist 内容复制到 Flink Lib ⽬录下并启动 Flink Standalone 集群&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;nginx&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;cp&lt;/span&gt; -r chunjun-dist &lt;span class=&quot;code-snippet__variable&quot;&gt;$FLINK_HOME&lt;/span&gt;/lib&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;sh &lt;span class=&quot;code-snippet__variable&quot;&gt;$FLINK_HOME&lt;/span&gt;/bin/start-cluster.sh&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;3）在 Flink classpath 中可以看到 ChunJun 相关 jar，表示启动成功；&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● 提交任务&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;nginx&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;code-snippet__variable&quot;&gt;$CHUNJUN_DIST&lt;/span&gt;/bin/chunjun-standalone.sh &amp;lt;task-script path&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;命令执⾏成功之后，即可在 Flink WEB UI 中看到对应的任务。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;Yarn Session 模式&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● 环境准备&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;1）下载 ChunJun&lt;span&gt; 并解压&lt;/span&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;nginx&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;wget&lt;/span&gt; &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;https://github.com/DTStack/chunjun/releases/download/&amp;lt;chunjun-tag&amp;gt;/chunjun-dist.tar.gz&quot;&lt;/span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;tar -zxvf chunjun-dist.tar.gz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;2）下载 ChunJun 并提交到 Yarn Session 集群中&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;nginx&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;code-snippet__variable&quot;&gt;$FLINK_HOME&lt;/span&gt;/bin?yarn-session.sh -t &lt;span class=&quot;code-snippet__variable&quot;&gt;$CHUNJUN_DIST&lt;/span&gt; -d&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;span&gt;&lt;strong&gt;·&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;执⾏命令成功之后，即可在Yarn Session ⽇志，对应Classpath 部分中看到 ChunJun 相关的jar， 表示启动成功；&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;span&gt;&lt;strong&gt;·&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;记录当前 Yarn Session 的，并将任务提交到指定 Session中；&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;powershell&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;sh ./bin/chunjun-yarn-session.sh -job &amp;lt;task-script path&amp;gt; -confProp {\&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;yarn.application.id\&quot;&lt;/span&gt;:\&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;&amp;lt;ApplicationID&amp;gt;\&quot;&lt;/span&gt;} &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;之后就可以在 Yarn Session 中看到对应的任务，&lt;strong&gt;注意以下两点：&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;• 如果将 yarn.application.id 配置到 flink-conf.yaml，那么使⽤这份配置⽂件的任务都会提交到这个 id 的 session 中；&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;• 如果将 yarn.application.id 配置到 confProp，那么仅有当前任务会提交到这个 id 的 session 中。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;Yarn Perjob 模式&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;后续会废弃这种模式，改⽤ Application 模式。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● 环境准备&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;下载 Flink 并解压&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;wget &quot;http://archive.apache.org/dist/flink/flink-&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;flink.version&lt;/span&gt;&amp;gt;&lt;/span&gt;/flink-&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;flink.version&lt;/span&gt;&amp;gt;&lt;/span&gt;-bin-scala_&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;scala.version&lt;/span&gt;&amp;gt;&lt;/span&gt;.tgz&quot;      &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;tar -zxvf flink-&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;flink.version&lt;/span&gt;&amp;gt;&lt;/span&gt;-bin-scala_&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;scala.version&lt;/span&gt;&amp;gt;&lt;/span&gt;.tgz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● 配置 ChunJun&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;下载 ChunJun 并解压&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;nginx&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;wget&lt;/span&gt; &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;https://github.com/DTStack/chunjun/releases/download/&amp;lt;chunjun-tag&amp;gt;/chunjun-dist.tar.gz&quot;&lt;/span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__attribute&quot;&gt;tar&lt;/span&gt; -zxvf chunjun-dist.tar.gz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;strong&gt;&lt;span&gt;● 提交任务&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;sh ./bin/chunjun-yarn-perjob.sh -job &lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;task-script&lt;/span&gt; &lt;span class=&quot;code-snippet__attr&quot;&gt;path&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;执⾏成功之后，可以在 Yarn Web UI 中看到相关任务。&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;调试 ChunJun 代码&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;调试代码能够更好地定位问题，并解决问题。下⾯将为开发者介绍如何快速调试 ChunJun 代码：&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;本地调试&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;ChunJun 为开发者准备了⼀个 local-test 模块，替换 main ⽅法中的 jobPath 即可。需要提前将相关插件配置在 local-test 模块的 pom 中，部分插件相互存在依赖冲突，需要开发者关注下。&lt;/p&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;strong&gt;远程调试&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;在 flink-conf.yaml 中配置 debug 端⼝即可(端⼝号可以⾃⼰定义)。&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;env.java.opts.jobmanager: -agentlib:jdwp=transport=dt_socket,server=y,&lt;span class=&quot;code-snippet__built_in&quot;&gt;suspend&lt;/span&gt;=y,address=5005&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;env.java.opts.taskmanager: -agentlib:jdwp=transport=dt_socket,server=y,&lt;span class=&quot;code-snippet__built_in&quot;&gt;suspend&lt;/span&gt;=y,address=5006&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;＋&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;往期推荐&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.74&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/I8XLOALcSYWGOwuUJm9qTFxwEGXPfJ6EvYSP1SiatkicGItWvawOndnYzCZpVvb3Xr2Cg47qQggiaeQuTMgU43GUg/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;300&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;▫ &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzkwMjM5NzM3Mw==&amp;amp;mid=2247484842&amp;amp;idx=1&amp;amp;sn=3da655dc4f8074fe94b4848183c2bc08&amp;amp;chksm=c0a76978f7d0e06eb075597967cadbea5acc713eac0c14a0ba02807a550ea0239dee50fa4ce0&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;ChunJun 1.16 Release版本即将发布，bug 捉虫活动邀您参与！&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;ChunJun 1.16 Release版本即将发布，bug 捉虫活动邀您参与！&lt;/span&gt;&lt;/a&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;▫ &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzkwMjM5NzM3Mw==&amp;amp;mid=2247484768&amp;amp;idx=1&amp;amp;sn=a53f3e8f12b3917b3ffdcdd2a826a6a0&amp;amp;chksm=c0a769b2f7d0e0a46c6bf3f7fdd5465ac5f542a0b8f0eeb33ec30f1938904e2bdd23847edbb5&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;倒带ChunJun，同心前行｜2022年度回顾&amp;amp;2023年共建规划&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;倒带ChunJun，同心前行｜2022年度回顾&amp;amp;2023年共建规划&lt;/a&gt;&lt;/p&gt;&lt;p&gt;▫ &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzkwMjM5NzM3Mw==&amp;amp;mid=2247484718&amp;amp;idx=1&amp;amp;sn=22c56f5635f863508e75443367d4db9f&amp;amp;chksm=c0a769fcf7d0e0eaefad9e141872ab309cf4444f75c7dd2e6c5a7d0af8ba0d8d5837e99acad9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;地狱三头犬，Kerberos身份验证在ChunJun中的落地实践&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;地狱三头犬，Kerberos身份验证在ChunJun中的落地实践&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;▫ &lt;/span&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzkwMjM5NzM3Mw==&amp;amp;mid=2247484647&amp;amp;idx=1&amp;amp;sn=35cbc102bbb03b1f5d155013247966cc&amp;amp;chksm=c0a76835f7d0e123f70b248bc8d14bd8dddca919b82a87b9a5c96dbb7983a492f5d6b38feb07&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;开源共建 | TIS整合数据同步工具ChunJun，携手完善开源生态&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;开源共建 | TIS整合数据同步工具ChunJun，携手完善开源生态&lt;/span&gt;&lt;/a&gt;&lt;span/&gt;&lt;/p&gt;&lt;/section&gt;&lt;p powered-by=&quot;xiumi.us&quot;&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;社&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;群&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;交&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;流&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;https://github.com/DTStack/chunjun&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;https://gitee.com/dtstack_dev_0/chunjun&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/I8XLOALcSYWGOwuUJm9qTFxwEGXPfJ6Er9ROaVH4lRTtHUV1pe9NkcPmr2zurib21U6nJSt9vwekuuFUASpD74Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;400&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;svg viewbox=&quot;0 0 1 1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;袋鼠云开源技术框架交流群&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;p&gt;钉钉群｜&lt;strong&gt;30537511&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;img data-ratio=&quot;1.3333333333333333&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/I8XLOALcSYWGOwuUJm9qTFxwEGXPfJ6El9lICy2rAib9iaKWI4JX3hicCRkexmjsNE3W7Op4K3jk3EJHtRdQY1GQA/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;300&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;strong&gt;点击&lt;span&gt;“阅读原文”&lt;/span&gt;，直达开源社区！&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;1.04&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/I8XLOALcSYWGOwuUJm9qTFxwEGXPfJ6E799e6msf6KcMn0HP3LekJ0rTjBI4REsuQgc4BELq0DYW9PB1WjXLlQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;400&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>fe51dc9daa148eccae84f6154b30eef5</guid>
<title>图解 Redis 分布式锁，写得太好了！</title>
<link>https://toutiao.io/k/wx2mcbu</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;hr data-tool=&quot;mdnice编辑器&quot;/&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;分布式锁的演进&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们可以同时去一个地方“占坑”，如果占到，就执行逻辑。否则就必须等待，直到释放锁。“占坑”可以去redis，可以去数据库，可以去任何大家都能访问的地方。等待可以自旋的方式。&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;基于 Spring Boot + MyBatis Plus + Vue &amp;amp; Element 实现的后台管理系统 + 用户小程序，支持 RBAC 动态权限、多租户、数据权限、工作流、三方登录、支付、短信、商城等功能&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;项目地址：https://gitee.com/zhijiantianya/ruoyi-vue-pro&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;视频教程：https://doc.iocoder.cn/video/&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;amp;mid=2247487551&amp;amp;idx=1&amp;amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;你已选中了添加链接的内容&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7231481481481481&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdQt6oBqxqXxwhogDV8KfYHicz2D0CXvricDZ72eK0ViaxtVbwjsqvIFcT8LIwQoPmz7a3n8kC2ibaqSw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; getCatalogJsonDbWithRedisLock() {&lt;br/&gt;        &lt;span&gt;//阶段一&lt;/span&gt;&lt;br/&gt;        Boolean lock = stringRedisTemplate.opsForValue().setIfAbsent(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;, &lt;span&gt;&quot;111&quot;&lt;/span&gt;);&lt;br/&gt;        &lt;span&gt;//获取到锁，执行业务&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;if&lt;/span&gt; (lock) {&lt;br/&gt;            Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; categoriesDb = getCategoryMap();&lt;br/&gt;            &lt;span&gt;//删除锁，如果在此之前报错或宕机会造成死锁&lt;/span&gt;&lt;br/&gt;            stringRedisTemplate.delete(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;);&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; categoriesDb;&lt;br/&gt;        }&lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;            &lt;span&gt;//没获取到锁，等待100ms重试&lt;/span&gt;&lt;br/&gt;            &lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;                Thread.sleep(&lt;span&gt;100&lt;/span&gt;);&lt;br/&gt;            } &lt;span&gt;catch&lt;/span&gt; (InterruptedException e) {&lt;br/&gt;                e.printStackTrace();&lt;br/&gt;            }&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; getCatalogJsonDbWithRedisLock();&lt;br/&gt;        }&lt;br/&gt;    }&lt;br/&gt; &lt;br/&gt;&lt;span&gt;public&lt;/span&gt; Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; getCategoryMap() {&lt;br/&gt;        ValueOperations&amp;lt;String, String&amp;gt; ops = stringRedisTemplate.opsForValue();&lt;br/&gt;        String catalogJson = ops.get(&lt;span&gt;&quot;catalogJson&quot;&lt;/span&gt;);&lt;br/&gt;        &lt;span&gt;if&lt;/span&gt; (StringUtils.isEmpty(catalogJson)) {&lt;br/&gt;            System.out.println(&lt;span&gt;&quot;缓存不命中，准备查询数据库。。。&quot;&lt;/span&gt;);&lt;br/&gt;            Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; categoriesDb= getCategoriesDb();&lt;br/&gt;            String toJSONString = JSON.toJSONString(categoriesDb);&lt;br/&gt;            ops.set(&lt;span&gt;&quot;catalogJson&quot;&lt;/span&gt;, toJSONString);&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; categoriesDb;&lt;br/&gt;        }&lt;br/&gt;        System.out.println(&lt;span&gt;&quot;缓存命中。。。。&quot;&lt;/span&gt;);&lt;br/&gt;        Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; listMap = JSON.parseObject(catalogJson, &lt;span&gt;new&lt;/span&gt; TypeReference&amp;lt;Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt;&amp;gt;() {});&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; listMap;&lt;br/&gt;    }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;问题：&lt;/strong&gt; 　setnx占好了位，业务代码异常或者程序在页面过程中宕机。没有执行删除锁逻辑，这就造成了死锁&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;解决：&lt;/strong&gt; 设置锁的自动过期，即使没有删除，会自动删除。&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;基于 Spring Cloud Alibaba + Gateway + Nacos + RocketMQ + Vue &amp;amp; Element 实现的后台管理系统 + 用户小程序，支持 RBAC 动态权限、多租户、数据权限、工作流、三方登录、支付、短信、商城等功能&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;项目地址：https://gitee.com/zhijiantianya/yudao-cloud&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;视频教程：https://doc.iocoder.cn/video/&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;amp;mid=2247487551&amp;amp;idx=1&amp;amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;你已选中了添加链接的内容&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6324074074074074&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdQt6oBqxqXxwhogDV8KfYHenswGfmFIjEp7dicQvbuf3n2VOy1fbyksSDGNIKjY1g52m9ibriaibCPmw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt; &lt;span&gt;public&lt;/span&gt; Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; getCatalogJsonDbWithRedisLock() {&lt;br/&gt;        Boolean lock = stringRedisTemplate.opsForValue().setIfAbsent(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;, &lt;span&gt;&quot;111&quot;&lt;/span&gt;);&lt;br/&gt;        &lt;span&gt;if&lt;/span&gt; (lock) {&lt;br/&gt;            &lt;span&gt;//设置过期时间&lt;/span&gt;&lt;br/&gt;            stringRedisTemplate.expire(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt;, TimeUnit.SECONDS);&lt;br/&gt;            Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; categoriesDb = getCategoryMap();&lt;br/&gt;            stringRedisTemplate.delete(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;);&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; categoriesDb;&lt;br/&gt;        }&lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;            &lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;                Thread.sleep(&lt;span&gt;100&lt;/span&gt;);&lt;br/&gt;            } &lt;span&gt;catch&lt;/span&gt; (InterruptedException e) {&lt;br/&gt;                e.printStackTrace();&lt;br/&gt;            }&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; getCatalogJsonDbWithRedisLock();&lt;br/&gt;        }&lt;br/&gt;    }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;问题：&lt;/strong&gt; setnx设置好，正要去设置过期时间，宕机。又死锁了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;解决：&lt;/strong&gt; 设置过期时间和占位必须是原子的。redis支持使用setnx ex命令。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;amp;mid=2247487551&amp;amp;idx=1&amp;amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;你已选中了添加链接的内容&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8074074074074075&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdQt6oBqxqXxwhogDV8KfYHNDD9Cz0ZlmSGzVDnUNkpkWLnyjXWczE1nPgBgibK6zNs2BV9bicXUMbg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; getCatalogJsonDbWithRedisLock() {&lt;br/&gt;    &lt;span&gt;//加锁的同时设置过期时间，二者是原子性操作&lt;/span&gt;&lt;br/&gt;    Boolean lock = stringRedisTemplate.opsForValue().setIfAbsent(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;, &lt;span&gt;&quot;1111&quot;&lt;/span&gt;,&lt;span&gt;5&lt;/span&gt;, TimeUnit.SECONDS);&lt;br/&gt;    &lt;span&gt;if&lt;/span&gt; (lock) {&lt;br/&gt;        Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; categoriesDb = getCategoryMap();&lt;br/&gt;        &lt;span&gt;//模拟超长的业务执行时间&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;            Thread.sleep(&lt;span&gt;6000&lt;/span&gt;);&lt;br/&gt;        } &lt;span&gt;catch&lt;/span&gt; (InterruptedException e) {&lt;br/&gt;            e.printStackTrace();&lt;br/&gt;        }&lt;br/&gt;        stringRedisTemplate.delete(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;);&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; categoriesDb;&lt;br/&gt;    }&lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;        &lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;            Thread.sleep(&lt;span&gt;100&lt;/span&gt;);&lt;br/&gt;        } &lt;span&gt;catch&lt;/span&gt; (InterruptedException e) {&lt;br/&gt;            e.printStackTrace();&lt;br/&gt;        }&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; getCatalogJsonDbWithRedisLock();&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;问题：&lt;/strong&gt; 　删除锁直接删除？？？如果由于业务时间很长，锁自己过期了，我们直接删除，有可能把别人正在持有的锁删除了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;解决：&lt;/strong&gt; 占锁的时候，值指定为uuid，每个人匹配是自己的锁才删除。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;amp;mid=2247487551&amp;amp;idx=1&amp;amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;你已选中了添加链接的内容&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.700925925925926&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdQt6oBqxqXxwhogDV8KfYHcy34m6uloBMPr6ibAVNH9fVnibgafIQPxNPFG2QMgkEIGte86liaFCxQA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; getCatalogJsonDbWithRedisLock() {&lt;br/&gt;        String uuid = UUID.randomUUID().toString();&lt;br/&gt;        ValueOperations&amp;lt;String, String&amp;gt; ops = stringRedisTemplate.opsForValue();&lt;br/&gt;      &lt;span&gt;//为当前锁设置唯一的uuid，只有当uuid相同时才会进行删除锁的操作&lt;/span&gt;&lt;br/&gt;        Boolean lock = ops.setIfAbsent(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;, uuid,&lt;span&gt;5&lt;/span&gt;, TimeUnit.SECONDS);&lt;br/&gt;        &lt;span&gt;if&lt;/span&gt; (lock) {&lt;br/&gt;            Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; categoriesDb = getCategoryMap();&lt;br/&gt;            String lockValue = ops.get(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;);&lt;br/&gt;            &lt;span&gt;if&lt;/span&gt; (lockValue.equals(uuid)) {&lt;br/&gt;                &lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;                    Thread.sleep(&lt;span&gt;6000&lt;/span&gt;);&lt;br/&gt;                } &lt;span&gt;catch&lt;/span&gt; (InterruptedException e) {&lt;br/&gt;                    e.printStackTrace();&lt;br/&gt;                }&lt;br/&gt;                stringRedisTemplate.delete(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;);&lt;br/&gt;            }&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; categoriesDb;&lt;br/&gt;        }&lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;            &lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;                Thread.sleep(&lt;span&gt;100&lt;/span&gt;);&lt;br/&gt;            } &lt;span&gt;catch&lt;/span&gt; (InterruptedException e) {&lt;br/&gt;                e.printStackTrace();&lt;br/&gt;            }&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; getCatalogJsonDbWithRedisLock();&lt;br/&gt;        }&lt;br/&gt;    }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;问题：&lt;/strong&gt; 如果正好判断是当前值，正要删除锁的时候，锁已经过期，别人已经设置到了新的值。那么我们删除的是别人的锁&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;解决：&lt;/strong&gt; 删除锁必须保证原子性。使用redis+Lua脚本完成。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;amp;mid=2247487551&amp;amp;idx=1&amp;amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;你已选中了添加链接的内容&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;1&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.537962962962963&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZfdQt6oBqxqXxwhogDV8KfYHUMGqn26KcvYian7TqibXJWKYSmhsc2NnmkKCsHrBWeQ7RWVb5T6GeFpw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt; &lt;span&gt;public&lt;/span&gt; Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; getCatalogJsonDbWithRedisLock() {&lt;br/&gt;        String uuid = UUID.randomUUID().toString();&lt;br/&gt;        ValueOperations&amp;lt;String, String&amp;gt; ops = stringRedisTemplate.opsForValue();&lt;br/&gt;        Boolean lock = ops.setIfAbsent(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;, uuid,&lt;span&gt;5&lt;/span&gt;, TimeUnit.SECONDS);&lt;br/&gt;        &lt;span&gt;if&lt;/span&gt; (lock) {&lt;br/&gt;            Map&amp;lt;String, List&amp;lt;Catalog2Vo&amp;gt;&amp;gt; categoriesDb = getCategoryMap();&lt;br/&gt;            String lockValue = ops.get(&lt;span&gt;&quot;lock&quot;&lt;/span&gt;);&lt;br/&gt;            String script = &lt;span&gt;&quot;if redis.call(\&quot;get\&quot;,KEYS[1]) == ARGV[1] then\n&quot;&lt;/span&gt; +&lt;br/&gt;                    &lt;span&gt;&quot;    return redis.call(\&quot;del\&quot;,KEYS[1])\n&quot;&lt;/span&gt; +&lt;br/&gt;                    &lt;span&gt;&quot;else\n&quot;&lt;/span&gt; +&lt;br/&gt;                    &lt;span&gt;&quot;    return 0\n&quot;&lt;/span&gt; +&lt;br/&gt;                    &lt;span&gt;&quot;end&quot;&lt;/span&gt;;&lt;br/&gt;            stringRedisTemplate.execute(&lt;span&gt;new&lt;/span&gt; DefaultRedisScript&amp;lt;Long&amp;gt;(script, Long&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;), &lt;span&gt;Arrays&lt;/span&gt;.&lt;span&gt;asList&lt;/span&gt;(&quot;&lt;span&gt;lock&lt;/span&gt;&quot;), &lt;span&gt;lockValue&lt;/span&gt;)&lt;/span&gt;;&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; categoriesDb;&lt;br/&gt;        }&lt;span&gt;else&lt;/span&gt; {&lt;br/&gt;            &lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;                Thread.sleep(&lt;span&gt;100&lt;/span&gt;);&lt;br/&gt;            } &lt;span&gt;catch&lt;/span&gt; (InterruptedException e) {&lt;br/&gt;                e.printStackTrace();&lt;br/&gt;            }&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; getCatalogJsonDbWithRedisLock();&lt;br/&gt;        }&lt;br/&gt;    }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;保证加锁【占位+过期时间】和删除锁【判断+删除】的原子性。更难的事情，锁的自动续期。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Redisson是一个在Redis的基础上实现的Java驻内存数据网格（In-Memory Data Grid）。它不仅提供了一系列的分布式的Java常用对象，还提供了许多分布式服务。&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;其中包括(BitSet, Set, Multimap, SortedSet, Map, List, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, AtomicLong, CountDownLatch, Publish / Subscribe, Bloom filter, Remote service, Spring cache, Executor service, Live Object service, Scheduler service)&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Redisson提供了使用Redis的最简单和最便捷的方法。Redisson的宗旨是促进使用者对Redis的关注分离（Separation of Concern），从而让使用者能够将精力更集中地放在处理业务逻辑上。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;更多请参考官方文档：&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;https://github.com/redisson/redisson/wiki&lt;/p&gt;&lt;/blockquote&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>ee2bfe2b50c6e3efd58c45ebcd6ef076</guid>
<title>浅谈算法：关于智能爬虫的探索</title>
<link>https://toutiao.io/k/j2vc1u6</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content              autoTypeSetting24psection&amp;#10;            &quot; id=&quot;js_content&quot;&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;引子&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;❝&lt;/span&gt;&lt;p&gt;如果当初让我去问顾客他们想要什么，他们肯定会告诉我：“一匹更快的马。” -- 亨利·福特&lt;/p&gt;&lt;span&gt;❞&lt;/span&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如今是人工智能大红大紫的时代，不管是 ChatGPT 还是随之而来的各种智能应用，让许多人看到即将到来的在几年前几乎不可想象的科幻世界。不过，在爬虫领域，人工智能似乎还没有过多涉及。诚然，爬虫作为一项“古老”的技术，在过去 20 多年缔造了搜索引擎、新闻聚合、数据分析等多而又多的技术行业，不过在如今还暂时没有看到明显的技术突破：爬虫工程师还是主要依赖于 XPath、逆向等技术来自动获取网络数据。不过，随着人工智能和机器学习的发展，爬虫技术理论上也可以做到“自动驾驶”。本篇文章，将从多个维度介绍所谓&lt;strong&gt;「智能爬虫」&lt;/strong&gt;（智能化、自动化数据提取爬虫技术）的现状以及可能的未来发展方向。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;爬虫技术现状&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;爬虫程序是一种自动化的程序，用于从互联网或其他计算机网络上获取数据。它们通常使用自动化数据抓取技术来自动访问网站，并收集、解析和存储网站上的信息。这些信息可以是结构化或非结构化数据。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;传统意义上的爬虫技术主要包括以下模块或系统：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;「网络请求」&lt;/strong&gt;：对网站或网页发起 HTTP 请求，获取 HTML 等数据；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;「网页解析」&lt;/strong&gt;：对 HTML 进行解析，形成结构化的树形结构，并通过 XPath 或 CSS Selector 获取目标数据；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;「数据储存」&lt;/strong&gt;：将解析后的结构化数据进行存储，可以是数据库，也可以是文件形式；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;「URL 管理」&lt;/strong&gt;：负责管理待抓取的URL列表和已经抓取的URL列表，例如分页或列表页的 URL 解析和请求。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4041666666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vh4PtSfBxFMqm1fZzfmg09JrMmibtiafdoibc3OnKEytNb8P3LUpHhqNEyeKdssf0kSADHtt5KqArBicATEibib6XMyg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;960&quot;/&gt;&lt;figcaption&gt;&lt;span/&gt;爬虫系统 (3)&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;以上都是基础的爬虫技术模块，对于大型爬虫系统来说，还需要具备任务调度、错误管理、日志管理等生产环境必要模块。笔者的爬虫管理平台 &lt;span&gt;Crawlab&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt; 就是用于企业级生产环境爬虫管理平台。另外，针对一些反爬措施，例如验证码或 IP 封锁，通常还需要额外模块，例如验证码识别、IP 代理等。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然而，目前爬虫程序的开发主要集中在网页解析上，这也是非常消耗人力的地方。虽然 HTML 需要解析网页数据，但是不同网站的网页布局、排版、风格、内容各不相同，导致每个网站、网页都需要单独编写解析逻辑，从而大大增加了人工编写成本。虽然一些通用爬虫例如搜索引擎爬虫可以不用编写过多解析逻辑，但这样的爬虫通常都无法聚焦于某些特定的主题数据提取。因此，为了降低人工编写成本，最好是不需要编写或少量编写解析逻辑就可以自动提取网页数据，这也就是智能爬虫的主要目标。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;已知实现方式&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;要实现智能化网页提取并不容易，但目前已经有一些对于智能爬虫开发的尝试。其中，青南开发的 &lt;span&gt;GNE&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt; (GeneralNewsExtractor) 是网页正文提取的开源实现，基于&lt;span&gt;文本及标点符号密度提取算法&lt;/span&gt;&lt;sup&gt;[3]&lt;/sup&gt;。崔庆才开发的 &lt;span&gt;GerapyAutoExtractor&lt;/span&gt;&lt;sup&gt;[4]&lt;/sup&gt; 基于&lt;span&gt;列表簇及 SVM 算法&lt;/span&gt;&lt;sup&gt;[5]&lt;/sup&gt; 实现了网页列表页识别。&lt;span&gt;八爪鱼&lt;/span&gt;&lt;sup&gt;[6]&lt;/sup&gt; (Octoparse)，一个商业客户端软件，已经开发出自动列表识别模块。国外的 &lt;span&gt;Diffbot&lt;/span&gt;&lt;sup&gt;[7]&lt;/sup&gt; 是一个基于 API 的智能网页识别平台，识别准确率非常高，号称有 99%。对于已知的智能爬虫实现方式，目前主要基于网页 HTML 结构以及内容，例如 GNE 和 GerapyAutoExtractor。对于商用软件例如八爪鱼、Diffbot，我们无法得知具体实现方式。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;探索列表页识别&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;现在正文识别的准确率已经非常高了，具体也有很多技术实现和应用。在这里我们主要关注列表页的识别，这是很多爬虫程序的网页解析工作。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们可以从经验来推断如何自动识别想要的内容。人类是视觉动物。当我们看到一个文章列表的网页，不出意外会立马识别到这个文章的列表，如下图。但是，我们究竟是如何识别出来的呢？其实，我们自然将同一类的文章列表项归为一类了。因此，我们会很快意识到这其实是一个列表页。当然，为何这些列表项是相似的呢？我们可以看到这些列表中的子元素也相近，因此自然而然将其联系在一起。各个子元素加总在一起成为单独一个列表项，然后我们的大脑自动将其归为一类。这就是列表页识别的过程。&lt;/p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.011049723756906&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vh4PtSfBxFMqm1fZzfmg09JrMmibtiafdoaJAWENhtPhucwFLVKGBh1KFU6WnZGPnhe2h846XicdEPpicktQYPHd4Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1448&quot;/&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;基于这样的分析，其实非常容易联想到机器学习中的聚类算法，我们需要做的只是将网页各个节点特征提取出来，然后利用聚类算法筛选出同样类别的节点即可。当然，这里的特征选择需要重点考虑，我们不是单纯的将 HTML 的单个节点取出来看，而是需要将其与其他节点一起关联起来提取特征，这样的话就可以得到一些不同类别的节点。然后，我们可以根据节点簇的整体信息来筛选出想要的列表页。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然，要用代码实际实现这样的算法，并不是一件容易的事情，需要将 HTML 各个节点进行建模（Modelling）、向量化（Vectorization）、以及基于此构建树状图（Tree-like Graph）。这是非常繁琐的事情。不过所幸的是，笔者已经利用 sklearn、networkx  等库实现了一个基础的列表页识别系统 &lt;span&gt;Webspot&lt;/span&gt;&lt;sup&gt;[8]&lt;/sup&gt;，可以自动识别一个列表页上的列表元素，而且可以视觉化展示识别的结果，如下图。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vh4PtSfBxFMqm1fZzfmg09JrMmibtiafdoSibiaYrtXLNic211l87IsKOUPBvcXW83WxGrqr5SwlZTJEHKRXiaqRKVOA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2780&quot;/&gt;&lt;figcaption&gt;&lt;span/&gt;Webspot&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;对于大部分列表来说，Webspot 的识别能力还是不错的。虽然达不到 Diffbot 的准确度，但目前来说对于不是非常复杂的网页还是能够准确识别出来的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;那么，既然已经有 Diffbot 这样的列表页识别方案，为什么还要新造轮子呢？其中一个最重要的原因是，商用且准确率高的软件例如 Diffbot 不能直接给出 XPath、CSS Selector 这样的可以重复使用的提取规则，而我们自动识别其实只需要拿到需要的提取规则即可，然后通过集成到 Scrapy、Colly 这样的开源爬虫程序里，就可以大大节省数据抓取的成本。这也是 Webspot 目前能够带给用户的一个功能，不仅能识别到列表页元素以及相应字段，还能够给出提取规则，如下图。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6622950819672131&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vh4PtSfBxFMqm1fZzfmg09JrMmibtiafdoNiciaWDbXibdAAuJpiblH1uNQ8jRBLpgPibkyUbOLGK15qwA9AhmH6tNQOw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1830&quot;/&gt;&lt;figcaption&gt;&lt;span/&gt;Webspot Fields&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;有了这样的提取规则，只需要自动识别一次，就可以在相似的网页中自动提取数据了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当前，Webspot 还处于开发早期阶段，之后应该会有更多新功能以及算法的开发和优化。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;未来发展&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;智能爬虫相当于网页上的自动驾驶，不需要太多人工的操作就可以让爬虫按照要求获取想要的数据或信息，这是很多数据需求者、爬虫工程师的理想技术。但是，目前智能爬虫还不太成熟，已有的实现和技术相对较为简单，未来或许可以通过深度学习、强化学习等技术来提高智能爬虫的识别能力。另外，图论与人工智能的结合，配合视觉技术或许可以让智能爬虫在准确率方面有所突破。笔者会通过 Webspot 这个项目继续在智能爬虫上进行探索，解决数据提取的成本问题。对智能爬虫发展感兴趣的朋友可以加笔者创建的交流群。&lt;/p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.5548387096774194&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/vh4PtSfBxFMqm1fZzfmg09JrMmibtiafdoKJ6Z9ickC2MYicy2O3YAbAHqpsV1YCuuJtAxibjUtoRALJZhlZBqpuxMw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;930&quot;/&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;社区&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果您对笔者的文章感兴趣，可以加笔者微信 tikazyq1 并注明 &quot;码之道&quot;，笔者会将你拉入 &quot;码之道&quot; 交流群。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Reference&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;span&gt;[1] &lt;/span&gt;&lt;p&gt;Crawlab: &lt;span&gt;https://www.crawlab.cn&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2] &lt;/span&gt;&lt;p&gt;GNE: &lt;span&gt;https://github.com/GeneralNewsExtractor/GeneralNewsExtractor&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[3] &lt;/span&gt;&lt;p&gt;文本及标点符号密度提取算法: &lt;span&gt;https://kns.cnki.net/KCMS/detail/detail.aspx?dbcode=CJFQ&amp;amp;dbname=CJFDLAST2019&amp;amp;filename=GWDZ201908029&amp;amp;v=MDY4MTRxVHJXTTFGckNVUkxPZmJ1Wm5GQ2poVXJyQklqclBkTEc0SDlqTXA0OUhiWVI4ZVgxTHV4WVM3RGgxVDM=&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[4] &lt;/span&gt;&lt;p&gt;GerapyAutoExtractor: &lt;span&gt;https://github.com/Gerapy/GerapyAutoExtractor&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[5] &lt;/span&gt;&lt;p&gt;列表簇及 SVM 算法: &lt;span&gt;https://cuiqingcai.com/9531.html&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[6] &lt;/span&gt;&lt;p&gt;八爪鱼: &lt;span&gt;https://www.octoparse.com/&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[7] &lt;/span&gt;&lt;p&gt;Diffbot: &lt;span&gt;https://www.diffbot.com/&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[8] &lt;/span&gt;&lt;p&gt;Webspot: &lt;span&gt;https://github.com/crawlab-team/webspot&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;mp-style-type data-value=&quot;3&quot;/&gt;&lt;/p&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>