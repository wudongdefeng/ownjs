<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>4ac48de0b9c9963a279123cf15380dbe</guid>
<title>æˆ‘æŠŠè¿™ä¸ªè½¯ä»¶ï¼Œæ¨èç»™äº†æ€»ç›‘</title>
<link>https://toutiao.io/k/9yex08q</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½ å¥½ï¼Œæˆ‘æ˜¯ yesã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»Šå¤©è¦æ¥å®‰åˆ©ä¸€æ¬¾ç¥å™¨ï¼ã€Œ&lt;span&gt;uTools&lt;/span&gt;ã€ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯¹äºæˆ‘ä¸ªäººè€Œè¨€ï¼Œå®ƒçš„ç”¨å¤„åœ¨äºï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å¿«é€Ÿç¿»è¯‘&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¤‡å¿˜å½•å¿«è´´&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¿«é€ŸæŸ¥æ‰¾å’Œæ‰“å¼€æ–‡ä»¶&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Json è§£æ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ—¶é—´æˆ³è½¬æ¢&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;todoè®°å½•&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç­‰ç­‰ç­‰ç­‰ï¼Œè¿˜æœ‰å¤ªå¤šå¤ªå¤šäº†ï¼Œå®ƒæœ‰ 100 å¤šä¸ªæ’ä»¶ï¼&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…¶å®ï¼Œè¿™äº›åŠŸèƒ½åˆ«çš„è½¯ä»¶æˆ–è€…ç½‘ç«™ä¹Ÿèƒ½æä¾›ï¼Œä½†æ˜¯å®ƒä¸€ä¸ªå°±å…¨æœ‰äº†ï¼è€Œä¸”å®ƒç®€å•ã€é«˜æ•ˆã€è·¨å¹³å°ï¼&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.26713947990543735&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUoicIRQYBUQib245Ocmv2PX6VVbup3TAibNFmwnSnguYJK7CTibFa0LOScA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;846&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å®‰è£…äº†ä¹‹åï¼Œé€šè¿‡ ã€Œ&lt;span&gt;alt+ç©ºæ ¼&lt;/span&gt;ã€å°±å¯ä»¥å”¤å‡ºå®ƒï¼Œç„¶åå¯ä»¥å¾€è¾“å…¥æ¡†å†…ç²˜è´´æ–‡æœ¬ã€å›¾ç‰‡ã€æˆªå›¾ã€æ–‡ä»¶ã€æ–‡ä»¶å¤¹ç­‰ç­‰ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯”å¦‚æˆ‘æƒ³æ‰“å¼€ Chromeï¼Œç›´æ¥alt+ç©ºæ ¼å”¤å‡ºï¼Œå†è¾“å…¥ chrome å³å¯ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.13216957605985039&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUFBZriavxPJwxJOYOq8TdXuRbc0mdhO4icLnUf6UiaCiciaZqx54RoqBug7w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœæƒ³å¬æ­Œï¼Œé‚£å°±ç½‘æ˜“äº‘~&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.13216957605985039&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUZEKmfEfOpicPlu0qHKu4bHpupH4iaGorIqk9nuUhGMDVQe9FFoSnzO2g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯”å¦‚æˆ‘ç°åœ¨æˆªäº†ä¸ªå›¾ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶è¾“å…¥ï¼Œç„¶åå¯ä»¥æŸ¥çœ‹ base64ç¼–ç ã€å¦å­˜ä¸ºå›¾ç‰‡ã€ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå›¾è®°å½•ä¸‹æ¥ï¼&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.2518703241895262&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUfsRiaMSAYT0c13RiaOJNSzf84AqxBwcQfMGP1OTo4FaPFQiboc7ruhLew/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‡è®¾ä»Šå¤©çœ‹äº† yes çš„æŠ€æœ¯æ–‡ç« ï¼Œé‡Œé¢æœ‰ä¸€æ®µè¯è¯´çš„å¾ˆå¥½ï¼Œæˆ‘å°±æˆªå›¾ï¼Œç„¶åç‚¹å‡»æ·»åŠ åˆ°ã€Œå¤‡å¿˜å¿«è´´ã€ï¼Œå›¾ç‰‡è¿˜èƒ½å¤‡æ³¨ï¼ˆå›¾ä¸­çš„yes6666å°±æ˜¯å¤‡æ³¨ï¼‰ï¼Œè¿™æ ·å°±ä¸´æ—¶è®°å½•ä¸‹æ¥äº†ï¼&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.7506234413965087&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUCzGUoCibM97IibzUOMIQhPxgWXjShMLzr7HseQRWYWlGYb1aA66O2ZibA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç„¶åç­‰æ™šä¸Šå›å»å†æ•´ç†æˆç¬”è®°å°± OK äº†ï¼&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å†æ¯”å¦‚æˆ‘ç°åœ¨çœ‹è‹±æ–‡ pdfï¼Œæˆ‘æƒ³ç¿»è¯‘ä¸€ä¸‹ï¼Œé‚£éå¸¸ç®€å•ï¼Œæˆ‘&lt;span&gt;åˆ’è¯é•¿æŒ‰é¼ æ ‡å³é”®&lt;/span&gt;(é»˜è®¤æ˜¯é¼ æ ‡ä¸­é”®)å°±å¥½äº†ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.7343234323432343&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUDiamEwOFZPPxLtBzZMLN7HnoHViaMh1C6Fl60aZxeswoYLhJduBemYyg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;606&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿˜å¯ä»¥ç‚¹å‡ºä¸Šå›¾çš„&lt;span&gt;ç¿»è¯‘&lt;/span&gt;ï¼Œè¿™æ ·å¯ä»¥çœ‹å¤šä¸ªç½‘ç«™çš„ç¿»è¯‘ç»“æœï¼&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.5859375&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUkpoSuxgAtJm6GXTorVJShic0633DJTrgNfqsgSf3y3CkfDJq0PFz7XA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1024&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¤ªæ–¹ä¾¿äº†ï¼&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœè¦è®°å½• todo çš„äº‹æƒ…ï¼Œä¹Ÿå¾ˆç®€å•ï¼ç›´æ¥ &lt;code&gt;alt+ç©ºæ ¼&lt;/code&gt; å”¤å‡ºå†è¾“å…¥ &lt;code&gt;todo&lt;/code&gt; æ•²ä¸ªå›è½¦å³å¯ï¼&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.7506234413965087&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaURPvXKBabibPUq0mOukOMgO9Y6WILU42vPnTvkW4ZrDa7nnRDVib7GpXA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å†æ¯”å¦‚ç°åœ¨è¦å¯¹æ¥ä¸€ä¸ªæ¥å£ï¼Œæ¥å£è¿”å›äº†ä¸€ä¸ª Json å­—ç¬¦ä¸²ï¼Œé‚£ç›´æ¥å¤åˆ¶ç„¶å &lt;code&gt;alt+ç©ºæ ¼&lt;/code&gt; å”¤å‡ºï¼Œæ­¤æ—¶çš„ç•Œé¢å°±æ˜¯è¿™æ ·çš„ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.3117206982543641&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUxUUQmHCLk9oxCxMcsAecgShJ6gFyDQQHWPUz8MkBqdOiaH8tKUaNNibQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç„¶åæ•²ä¸ªå›è½¦ï¼Œå°±æå®šå•¦ï¼å°±æ˜¯è¿™ä¹ˆ easyï¼&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.7506234413965087&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUT3zqMbjj3gPasHc9p8gCnLx8iaGYYTt4ic31HhNibypnYCbSCickyFeFjw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å†æ¯”å¦‚ç°åœ¨ä»æ•°æ®åº“æ‹¿åˆ°äº†ä¸ªæ—¶é—´æˆ³ï¼Œæƒ³çœ‹çœ‹åˆ°åº•æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Œé‚£ä¹ˆç›´æ¥å¤åˆ¶ç„¶å &lt;code&gt;alt+ç©ºæ ¼&lt;/code&gt; å”¤å‡ºã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.371571072319202&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUviaKGydrEVgfKa7WyeXmWIfdUqCJzSNMibGy4M0FoKNIDXAeL7oh7bFg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å†æ•²ä¸ªå›è½¦ï¼&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.7506234413965087&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUVyfmCa5IGajqXguJp3LwBuWBPlFnCn1hRSCia758pg4efN7DmBeh6KA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœæƒ³ä»ç°åœ¨ä¸€ä¸ªæ—¶é—´å€’æ¨ä¸€ä¸‹æ—¶é—´æˆ³ï¼Œé‚£ä¹Ÿç®€å•ï¼Œ&lt;span&gt;ç›´æ¥è¾“å…¥æ—¶é—´&lt;/span&gt;å°±è¡Œï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.7506234413965087&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaU7lZrsBzIwdBgibNBkN4SeXe1dBXvdIMNPgpF1jUL8q0zxYPM6zskrvw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç„¶åå®ƒæœ‰å¾ˆå¤šæ’ä»¶ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥æ’ä»¶(æ‹¼éŸ³ä¹Ÿok)æ¥æœï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.19201995012468828&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUR5xpztrYCbB8UFw6HNQdiaTKtRkI5850gjMLPycPENCOkUZkZBibxbHQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.7506234413965087&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUVTzRjtGObtMfJPibwnztz8iaTvWqsXMWNghibWEWRydddHLuISKUpWJ8A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿˜æœ‰ä¸€äº›æ–‡æ¡£æ’ä»¶ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.3929712460063898&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUhFtkRUcJBhWibmAWu7M3O4IcWCuQ6IVoCdDrA0OtqOrZakLh0zVTTXA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;626&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯”å¦‚æˆ‘è¦æŸ¥ Linux çš„ ps å‘½ä»¤ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.7905236907730673&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUVA21wtUIG8U4ibfrJ3zyqzicJayxJUWe5ZesdjNqq3xubEb275OmUgxw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ€ä¹ˆè¯´ï¼Œè¿™æ³¢æ˜¯ä¸æ˜¯å¾ˆå®Œç¾ï¼&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿˜æœ‰&lt;span&gt;æ¸£ç”·è¯­å½•&lt;/span&gt;ï¼Œå•§å•§å¥½éªšå•Šï¼&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.6708229426433915&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUAPChPEtVzicnjyibEfCLlzcF3r4sHQr5QmgJIKtsiaejSziakHlc9yApPg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;æˆ‘è¿˜çœ‹åˆ°äº†å•¥&lt;/span&gt;ï¼Ÿï¼Ÿ&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.7506234413965087&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUd8X20ODD700icIULUIUW50UeDf01TNT2BAabsOL9OlPJrCacFO6ib3Xw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;802&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åƒæˆ‘è¿™ä¹ˆæ­£ç›´çš„äººï¼Œæˆ‘æ˜¯ä¸ä¼šä¸‹è½½çš„ï¼&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.9816849816849816&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/eSdk75TK4nF6UIhGEVSf14dXaoibPG4iaUwtibObnscf80AJYXibDN8zrSgnOzDazMObDP6dkz9vewBWvDE1x2mYNw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;273&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†æ˜¯æˆ‘æ€»ç›‘......&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ’ä»¶å¤ªå¤šäº†ï¼Œä½ ä»¬å°±è‡ªå·±çœ‹å§ï¼&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å®˜ç½‘ï¼šhttps://u.tools/&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä¹Ÿæ‰“åŒ…å¥½äº†ï¼Œwindowsã€macéƒ½æœ‰ï¼Œåå°ç›´æ¥å›å¤ã€Œ&lt;span&gt;uTools&lt;/span&gt;ã€å³å¯ä¸‹è½½ï¼&lt;/p&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;æˆ‘æ˜¯yesï¼Œæˆ‘ä»¬ä¸‹ç¯‡è§~&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>3ef3eb82d42795ef2acf59e8d3d7eb5c</guid>
<title>ç”¨ Go å®ç°é…ç½®ä¸­å¿ƒï¼ˆä¸€ï¼‰</title>
<link>https://toutiao.io/k/5ga4hr7</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;post-content&quot;&gt;
&lt;h1 id=&quot;å¼•è¨€&quot;&gt;å¼•è¨€&lt;/h1&gt;
&lt;p&gt;æºç è§ &lt;a href=&quot;https://github.com/GotaX/go-config-server/tree/v0.1.0&quot;&gt;https://github.com/GotaX/go-config-server/tree/v0.1.0&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åªè¦æ¥è§¦è¿‡å¾®æœåŠ¡çš„åŒå­¦éƒ½çŸ¥é“, é…ç½®ç®¡ç†ä¸å¥½, è¿ç»´çœŸçš„å‹åŠ›å±±å¤§. è¿‡å»å‘¢, æˆ‘ä¸€ç›´éƒ½é¦–é€‰ &lt;code&gt;spring-cloud-config-server&lt;/code&gt; åšé…ç½®æœåŠ¡å™¨, ä¸»è¦æ˜¯å› ä¸º:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é—ç•™äº†ä¸å°‘ Java æœåŠ¡, æ”¹é€ èµ·æ¥å¾ˆè´¹äº‹&lt;/li&gt;
&lt;li&gt;å®ƒæä¾›äº† HTTP API, ä¸éœ€è¦ SDK ä¹Ÿèƒ½æ¥å…¥å…¶ä»–æœåŠ¡&lt;/li&gt;
&lt;li&gt;è‡ªå¸¦å¤š Profile ç»„åˆçš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨ Git åšå­˜å‚¨, æ–¹ä¾¿ç‰ˆæœ¬ç®¡ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸è¿‡éšç€é…ç½®æ–‡ä»¶è¶Šå†™è¶Šå¤š, è¿˜æ˜¯é€æ¸æš´éœ²å‡ºä¸å°‘é—®é¢˜:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹ YAML æ–‡ä»¶çš„è§£ææœ‰ &lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-config/issues/935&quot;&gt;BUG&lt;/a&gt;, å†™ Kubernetes é…ç½®çš„æ—¶å€™å¾ˆå¤´ç–¼&lt;/li&gt;
&lt;li&gt;åŒ…å«ä¸å°‘ spring çº¦å®šä¿—æˆçš„ç”¨æ³•, æ¯”å¦‚ &lt;code&gt;application.yml&lt;/code&gt; ä¸‹çš„é…ç½®ä¼šè¢«å…¨éƒ¨å¯¼å…¥, æ— æ³•åªå¯¼å…¥éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;å†™ YAML æ—¶, å­—ç¬¦ä¸²å’Œæ•°å­—æœ‰æ—¶æ— æ³•å¾ˆå¥½åŒºåˆ†. å†™ JSON æ—¶åˆå¤ªå†—é•¿.&lt;/li&gt;
&lt;li&gt;Java æœåŠ¡çš„å¯åŠ¨æ—¶é—´å’Œå†…å­˜å ç”¨éƒ½åé«˜ (ç›¸è¾ƒäº Go).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹‹åä¹Ÿæœ‰æŒç»­å…³æ³¨è¿™æ–¹é¢, æœ‰å‡ ä¸ªäººæ°”è¾ƒé«˜çš„é¡¹ç›®:&lt;/p&gt;

&lt;p&gt;è¿™ä¸‰ä¸ªé…ç½®ä¸­å¿ƒéƒ½æ˜¯ç”±å¤§å‚å¼€å‘, è´¨é‡è‚¯å®šæœ‰ä¿è¯, åŠŸèƒ½ä¹Ÿå¾ˆå¼ºå¤§. ä¸è¿‡å¯¹äºå°å›¢é˜Ÿæ¥è¯´è¿˜æ˜¯å¤ªé‡é‡çº§äº†, ç”¨èµ·æ¥ä¼šæœ‰ä¸å°‘è¿ç»´å‹åŠ›.&lt;/p&gt;
&lt;p&gt;é•¿æœŸè§‚æœ›æ— æœ, æ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯å†³å®šè‡ªå·±å®ç°ä¸€ä¸ª. å…ˆæ€»ç»“ä¸€ä¸‹æœ€æ ¸å¿ƒçš„éœ€æ±‚ç‚¹:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é…ç½®ä¸€å®šè¦æœ‰ç‰ˆæœ¬ç®¡ç†, èƒ½è¿½æº¯å†å² (Git)&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼å­˜å‚¨, é¿å…å•ç‚¹æ•…éšœ (Git)&lt;/li&gt;
&lt;li&gt;èƒ½å¾ˆæ–¹ä¾¿åœ°å¤ç”¨å…¬å…±é…ç½® (æ¯”å¦‚æ•°æ®åº“ DataSource)&lt;/li&gt;
&lt;li&gt;ç®€æ´çš„é…ç½®è¯­æ³•, é€‚å½“çš„æ ¡éªŒ (JSON å¤ªå†—é•¿, YAML å®¹æ˜“å‡ºé”™)&lt;/li&gt;
&lt;li&gt;å¤šç¯å¢ƒæ”¯æŒ (ç”Ÿäº§/æµ‹è¯•ç¯å¢ƒ)&lt;/li&gt;
&lt;li&gt;è½»é‡çº§ (æœ€å°åŒ–è¿ç»´å‹åŠ›)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;1~2 æ¡ç”±äº Git æœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬ç®¡ç†å·¥å…·, æ‰€ä»¥å°±ä¸ç”¨è‡ªå·±å®ç°äº†.&lt;/p&gt;
&lt;p&gt;3~5 æ¡è‡ªå·±ä»å¤´ææœ‰ç‚¹éº»çƒ¦, ä¸è¿‡æˆ‘å¾ˆå¹¸è¿åœ°æ‰¾åˆ°ä¸€ä¸ªé…ç½®ä¸“ç”¨è¯­è¨€ &lt;a href=&quot;https://jsonnet.org/&quot;&gt;Jsonnet&lt;/a&gt;, æ‰€ä»¥å°±ç›´æ¥æ‹¿æ¥ç”¨å’¯.&lt;/p&gt;
&lt;p&gt;å¥½äº†, èƒŒæ™¯ä»‹ç»å®Œæ¯•, ä¸‹é¢æ­£å¼å¼€å§‹å§.&lt;/p&gt;
&lt;h1 id=&quot;æ¥å£å®šä¹‰&quot;&gt;æ¥å£å®šä¹‰&lt;/h1&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰ HTTP API, è¿™é‡Œé‡‡ç”¨å’Œ &lt;code&gt;spring-cloud-config-server&lt;/code&gt;å·®ä¸å¤šçš„æ ¼å¼.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;GET /:namespace/:filepath&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;namespace&lt;/td&gt;
&lt;td&gt;å‘½åç©ºé—´, Git ä¸­å°±æ˜¯åˆ†æ”¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;filepath&lt;/td&gt;
&lt;td&gt;é…ç½®æ–‡ä»¶è·¯å¾„, ç›¸å¯¹äº Git ä»“åº“æ ¹ç›®å½•. åç¼€ä»£è¡¨è¿”å›å†…å®¹æ ¼å¼, æ¯”å¦‚ (&lt;code&gt;.json&lt;/code&gt; å’Œ &lt;code&gt;.yaml&lt;/code&gt;).&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ¥ç€æˆ‘ä»¬æ¥æ¢³ç†ä¸‹æœ€å°å·¥ä½œæµç¨‹:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»åº•å±‚å­˜å‚¨è¯»å–è¯»å–é…ç½®æ–‡ä»¶æ¨¡æ¿&lt;/li&gt;
&lt;li&gt;å°†é…ç½®æ–‡ä»¶æ¨¡æ¿æ¸²æŸ“ä¸ºç›®æ ‡æ ¼å¼&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»ä¸Šé¢çš„æµç¨‹ä¸­æˆ‘ä»¬å¯ä»¥æŠ½è±¡å‡ºä¸¤ä¸ªæ¥å£:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/storage/storage.go
&lt;/span&gt;&lt;span&gt;// åº•å±‚å­˜å‚¨æ¥å£
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;type&lt;/span&gt; &lt;span&gt;Storage&lt;/span&gt; &lt;span&gt;interface&lt;/span&gt; {
    &lt;span&gt;// åˆ‡æ¢å‘½åç©ºé—´, ç±»ä¼¼äº MySQL ä¸­çš„ use
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;Use&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt; &lt;span&gt;context&lt;/span&gt;.&lt;span&gt;Context&lt;/span&gt;, &lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;)
    &lt;span&gt;// è¯»å–æ–‡ä»¶å†…å®¹
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;Read&lt;/span&gt;(&lt;span&gt;path&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;content&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;)
}

&lt;span&gt;// pkg/storage/render.go
&lt;/span&gt;&lt;span&gt;// æ¨¡æ¿æ¸²æŸ“æ¥å£
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;type&lt;/span&gt; &lt;span&gt;Renderer&lt;/span&gt; &lt;span&gt;interface&lt;/span&gt; {
    &lt;span&gt;// æ‰§è¡Œæ¸²æŸ“, entry ä¸ºå…¥å£æ–‡ä»¶, outputType ä¸ºç›®æ ‡æ ¼å¼
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;Render&lt;/span&gt;(&lt;span&gt;entry&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;outputType&lt;/span&gt; &lt;span&gt;ContentType&lt;/span&gt;) (&lt;span&gt;doc&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;)
}

&lt;span&gt;// ContentType çš„å®šä¹‰
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;type&lt;/span&gt; &lt;span&gt;ContentType&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;
&lt;span&gt;const&lt;/span&gt; (
&lt;span&gt;Unknown&lt;/span&gt; &lt;span&gt;ContentType&lt;/span&gt; = &lt;span&gt;iota&lt;/span&gt;
&lt;span&gt;JSON&lt;/span&gt;
&lt;span&gt;YAML&lt;/span&gt;
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸è¿‡ç¬¬ä¸€ç‰ˆæ˜¯æœ€å°å¯ç”¨ç‰ˆæœ¬, æˆ‘ä»¬å…ˆæŠŠå¤šæ ¼å¼è¾“å‡ºæ”¾ä¸€è¾¹, ä¸€å¾‹è¾“å‡ºä¸º JSON. ä¸‹é¢æ¥é€ä¸ªå®ç°è¿™ä¸¤ä¸ªæ¥å£å§.&lt;/p&gt;
&lt;h1 id=&quot;æ¥å£å®ç°&quot;&gt;æ¥å£å®ç°&lt;/h1&gt;
&lt;h2 id=&quot;jsonnet-æ¸²æŸ“å™¨&quot;&gt;Jsonnet æ¸²æŸ“å™¨&lt;/h2&gt;
&lt;p&gt;å…ˆç®€å•ä»‹ç»ä¸‹ Jsonnet. ä¸Šé¢ä¹‹æ‰€ä»¥ç§°å…¶ä¸ºé…ç½®è¯­è¨€, æ˜¯å› ä¸ºå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„é™æ€é…ç½®, è€Œæ˜¯ä¸€ä¸ªå®æ‰“å®çš„å‡½æ•°å¼è¯­è¨€. å¹¶ä¸”å®ƒæ˜¯ JSON çš„è¶…é›†, æ‰€ä»¥ä»»ä½•åˆæ³•çš„ JSON éƒ½æ˜¯åˆæ³•çš„ Jsonnet.&lt;/p&gt;
&lt;p/&gt;
&lt;p&gt;ä¸‹é¢æ‘˜å½•ä¸€æ®µ&lt;a href=&quot;https://jsonnet.org/ref/language.html&quot;&gt;å®˜ç½‘ä»‹ç»&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Jsonnet è¢«è®¾è®¡ç”¨äºå¤„ç†å¤æ‚ç³»ç»Ÿçš„é…ç½®. æ ‡å‡†ç”¨ä¾‹æ˜¯ç”¨äºé›†æˆå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„æœåŠ¡. ç‹¬ç«‹çš„ç¼–å†™æ¯ä¸ªé…ç½®å°†ä¼šå¯¼è‡´å¤§é‡çš„é‡å¤, å¹¶ä¸”ææœ‰å¯èƒ½å˜å¾—éš¾ä»¥ç»´æŠ¤. Jsonnet ä½¿æ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„æ¡ä»¶æŒ‡å®šé…ç½®, å¹¶ä»¥ç¼–ç¨‹çš„æ–¹å¼é…ç½®æ‰€æœ‰ç‹¬ç«‹çš„æœåŠ¡.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å†çœ‹ä¸€ä¸ªç¤ºä¾‹:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-jsonnet&quot; data-lang=&quot;jsonnet&quot;&gt;// Edit me!
{
  person1: {
    name: &quot;Alice&quot;,
    welcome: &quot;Hello &quot; + self.name + &quot;!&quot;,
  },
  person2: self.person1 { name: &quot;Bob&quot; },
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šé¢é…ç½®å¯ä»¥æ¸²æŸ“ä¸ºå¦‚ä¸‹ JSON:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;{
  &lt;span&gt;&quot;person1&quot;&lt;/span&gt;: {
    &lt;span&gt;&quot;name&quot;&lt;/span&gt;: &lt;span&gt;&quot;Alice&quot;&lt;/span&gt;,
    &lt;span&gt;&quot;welcome&quot;&lt;/span&gt;: &lt;span&gt;&quot;Hello Alice!&quot;&lt;/span&gt;
  },
  &lt;span&gt;&quot;person2&quot;&lt;/span&gt;: {
    &lt;span&gt;&quot;name&quot;&lt;/span&gt;: &lt;span&gt;&quot;Bob&quot;&lt;/span&gt;,
    &lt;span&gt;&quot;welcome&quot;&lt;/span&gt;: &lt;span&gt;&quot;Hello Bob!&quot;&lt;/span&gt;
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²ç»å¯¹ Jsonnet æœ‰äº†åŸºæœ¬çš„è®¤çŸ¥, å°±ä¸ç»§ç»­æ·±å…¥äº†. å¦‚æœæƒ³è¯¦ç»†äº†è§£, å¯ä»¥çœ‹å®˜ç½‘æ•™ç¨‹, æˆ–è€…ç­‰æˆ‘ä¹‹åå†å†™ä¸€äº›ä»‹ç»æ–‡ç« .&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å¼€å§‹åŠ¨æ‰‹å†™å®ç°, è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href=&quot;https://github.com/google/go-jsonnet&quot;&gt;go-jsonnet&lt;/a&gt; è¿™ä¸ªåº“æ¥è¿è¡Œ Jsonnet ä»£ç .&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/render/jsonnet.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;import&lt;/span&gt; (
. &lt;span&gt;&quot;github.com/google/go-jsonnet&quot;&lt;/span&gt;
)

&lt;span&gt;type&lt;/span&gt; &lt;span&gt;Jsonnet&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt; {
&lt;span&gt;Importer&lt;/span&gt; &lt;span&gt;Importer&lt;/span&gt;
}

&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;r&lt;/span&gt; &lt;span&gt;Jsonnet&lt;/span&gt;) &lt;span&gt;Render&lt;/span&gt;(&lt;span&gt;entry&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;outputType&lt;/span&gt; &lt;span&gt;ContentType&lt;/span&gt;) (&lt;span&gt;doc&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
&lt;span&gt;vm&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;MakeVM&lt;/span&gt;()          &lt;span&gt;// æ–°å»ºè™šæ‹Ÿæœº
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;vm&lt;/span&gt;.&lt;span&gt;Importer&lt;/span&gt;(&lt;span&gt;r&lt;/span&gt;.&lt;span&gt;Importer&lt;/span&gt;) &lt;span&gt;// æ›¿æ¢é»˜è®¤çš„æ–‡ä»¶å­˜å‚¨, ä¹‹åä¼šæŠŠ Git æŒ‚è½½è¿›æ¥
&lt;/span&gt;&lt;span/&gt;
&lt;span&gt;doc&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; = &lt;span&gt;vm&lt;/span&gt;.&lt;span&gt;EvaluateFile&lt;/span&gt;(&lt;span&gt;entry&lt;/span&gt;) &lt;span&gt;// æŒ‡å®šå…¥å£æ–‡ä»¶, æ‰§è¡Œæ¸²æŸ“
&lt;/span&gt;&lt;span/&gt;    
    &lt;span&gt;// TODO: ä¹‹ååœ¨è¿™é‡Œå®ç°å¤šæ ¼å¼è¾“å‡º
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;return&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¤§éƒ¨åˆ†çš„äº‹æƒ…éƒ½ç”± &lt;code&gt;go-jsonnet&lt;/code&gt; æ›¿æˆ‘ä»¬åšäº†, æ‰€ä»¥ä»£ç å¾ˆç®€æ´. åé¢æ”¯æŒå¤šæ ¼å¼è¾“å‡ºçš„æ—¶å€™ä¼šå†å¢åŠ ä¸€äº›ä»£ç .&lt;/p&gt;
&lt;p&gt;æ¥ç€å†™ä¸ªæµ‹è¯•æ¥éªŒè¯ä¸‹. å…ˆå®šä¹‰æµ‹è¯•ç”¨ä¾‹.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/render/render_test.go
&lt;/span&gt;&lt;span&gt;// ...
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;type&lt;/span&gt; &lt;span&gt;TestCase&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt; {
&lt;span&gt;Entry&lt;/span&gt;      &lt;span&gt;string&lt;/span&gt;
&lt;span&gt;Files&lt;/span&gt;      &lt;span&gt;map&lt;/span&gt;[&lt;span&gt;string&lt;/span&gt;]&lt;span&gt;string&lt;/span&gt;
&lt;span&gt;OutputType&lt;/span&gt; &lt;span&gt;ContentType&lt;/span&gt;
&lt;span&gt;OutputDoc&lt;/span&gt;  &lt;span&gt;string&lt;/span&gt;
}

&lt;span&gt;var&lt;/span&gt; &lt;span&gt;cases&lt;/span&gt; = []&lt;span&gt;TestCase&lt;/span&gt;{
{
&lt;span&gt;OutputType&lt;/span&gt;: &lt;span&gt;JSON&lt;/span&gt;,
&lt;span&gt;Entry&lt;/span&gt;:      &lt;span&gt;&quot;example1.jsonnet&quot;&lt;/span&gt;,
&lt;span&gt;OutputDoc&lt;/span&gt;:  &lt;span&gt;`{&quot;person1&quot;:{&quot;name&quot;:&quot;Alice&quot;,&quot;welcome&quot;:&quot;Hello Alice!&quot;},&quot;person2&quot;:{&quot;name&quot;:&quot;Bob&quot;,&quot;welcome&quot;:&quot;Hello Bob!&quot;}}`&lt;/span&gt;,
&lt;span&gt;Files&lt;/span&gt;:      &lt;span&gt;map&lt;/span&gt;[&lt;span&gt;string&lt;/span&gt;]&lt;span&gt;string&lt;/span&gt;{&lt;span&gt;&quot;example1.jsonnet&quot;&lt;/span&gt;: &lt;span&gt;`/* Edit me! */ {person1:{name:&quot;Alice&quot;,welcome:&quot;Hello &quot;+self.name+&quot;!&quot;,},person2:self.person1{name:&quot;Bob&quot;},}`&lt;/span&gt;},
},
}
&lt;span&gt;// ...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®šä¹‰ä¸¤ä¸ªå·¥å…·å‡½æ•°&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/render/render_test.go
&lt;/span&gt;&lt;span&gt;// ...
&lt;/span&gt;&lt;span/&gt;
&lt;span&gt;// ç”¨ map[string]string æ¨¡æ‹Ÿæ–‡ä»¶å­˜å‚¨, key ä¸ºæ–‡ä»¶å, value ä¸ºæ–‡ä»¶å†…å®¹
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;makeImporter&lt;/span&gt;(&lt;span&gt;files&lt;/span&gt; &lt;span&gt;map&lt;/span&gt;[&lt;span&gt;string&lt;/span&gt;]&lt;span&gt;string&lt;/span&gt;) &lt;span&gt;jsonnet&lt;/span&gt;.&lt;span&gt;Importer&lt;/span&gt; {
&lt;span&gt;data&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; make(&lt;span&gt;map&lt;/span&gt;[&lt;span&gt;string&lt;/span&gt;]&lt;span&gt;jsonnet&lt;/span&gt;.&lt;span&gt;Contents&lt;/span&gt;, len(&lt;span&gt;files&lt;/span&gt;))
&lt;span&gt;for&lt;/span&gt; &lt;span&gt;name&lt;/span&gt;, &lt;span&gt;content&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;range&lt;/span&gt; &lt;span&gt;files&lt;/span&gt; {
&lt;span&gt;data&lt;/span&gt;[&lt;span&gt;name&lt;/span&gt;] = &lt;span&gt;jsonnet&lt;/span&gt;.&lt;span&gt;MakeContents&lt;/span&gt;(&lt;span&gt;content&lt;/span&gt;)
}
&lt;span&gt;return&lt;/span&gt; &lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;jsonnet&lt;/span&gt;.&lt;span&gt;MemoryImporter&lt;/span&gt;{&lt;span&gt;Data&lt;/span&gt;: &lt;span&gt;data&lt;/span&gt;}
}

&lt;span&gt;// å°†é»˜è®¤è¾“å‡ºçš„å¤šè¡Œ JSON æ ¼å¼åŒ–ä¸ºå•è¡Œ JSON
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;compactJson&lt;/span&gt;(&lt;span&gt;input&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) &lt;span&gt;string&lt;/span&gt; {
&lt;span&gt;var&lt;/span&gt; &lt;span&gt;buf&lt;/span&gt; &lt;span&gt;bytes&lt;/span&gt;.&lt;span&gt;Buffer&lt;/span&gt;
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;err&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;json&lt;/span&gt;.&lt;span&gt;Compact&lt;/span&gt;(&lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;buf&lt;/span&gt;, []byte(&lt;span&gt;input&lt;/span&gt;)); &lt;span&gt;err&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
panic(&lt;span&gt;err&lt;/span&gt;)
}
&lt;span&gt;return&lt;/span&gt; &lt;span&gt;buf&lt;/span&gt;.&lt;span&gt;String&lt;/span&gt;()
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®šä¹‰æµ‹è¯•&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/render/render_test.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;package&lt;/span&gt; &lt;span&gt;render&lt;/span&gt;

&lt;span&gt;import&lt;/span&gt; (
&lt;span&gt;&quot;bytes&quot;&lt;/span&gt;
&lt;span&gt;&quot;encoding/json&quot;&lt;/span&gt;
&lt;span&gt;&quot;testing&quot;&lt;/span&gt;

&lt;span&gt;&quot;github.com/google/go-jsonnet&quot;&lt;/span&gt;
&lt;span&gt;&quot;github.com/stretchr/testify/assert&quot;&lt;/span&gt;
)

&lt;span&gt;func&lt;/span&gt; &lt;span&gt;TestJsonnet&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;testing&lt;/span&gt;.&lt;span&gt;T&lt;/span&gt;) {
&lt;span&gt;for&lt;/span&gt; &lt;span&gt;_&lt;/span&gt;, &lt;span&gt;c&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;range&lt;/span&gt; &lt;span&gt;cases&lt;/span&gt; {
&lt;span&gt;r&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;Jsonnet&lt;/span&gt;{&lt;span&gt;Importer&lt;/span&gt;: &lt;span&gt;makeImporter&lt;/span&gt;(&lt;span&gt;c&lt;/span&gt;.&lt;span&gt;Files&lt;/span&gt;)}
&lt;span&gt;doc&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;r&lt;/span&gt;.&lt;span&gt;Render&lt;/span&gt;(&lt;span&gt;c&lt;/span&gt;.&lt;span&gt;Entry&lt;/span&gt;, &lt;span&gt;c&lt;/span&gt;.&lt;span&gt;OutputType&lt;/span&gt;)
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;assert&lt;/span&gt;.&lt;span&gt;NoError&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt;) {
&lt;span&gt;assert&lt;/span&gt;.&lt;span&gt;Equal&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt;, &lt;span&gt;c&lt;/span&gt;.&lt;span&gt;OutputDoc&lt;/span&gt;, &lt;span&gt;compactJson&lt;/span&gt;(&lt;span&gt;doc&lt;/span&gt;))
}
}
}
&lt;span&gt;// ...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œä¸‹&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;$ go test github.com/GotaX/go-config-server/pkg/render
&lt;span&gt;# ok      github.com/GotaX/go-config-server/pkg/render    0.205s&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹èµ·æ¥æ²¡é—®é¢˜, æ¸²æŸ“å™¨å·²ç» OK äº†.&lt;/p&gt;
&lt;h2 id=&quot;git-å­˜å‚¨&quot;&gt;Git å­˜å‚¨&lt;/h2&gt;
&lt;p&gt;å› ä¸ºè¦æ“ä½œ Git ä»“åº“, è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href=&quot;https://github.com/go-git/go-git/&quot;&gt;go-git&lt;/a&gt; ä½œä¸º Git å®¢æˆ·ç«¯. é¦–å…ˆå®šä¹‰ç»“æ„ä½“.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/storage/git.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;type&lt;/span&gt; &lt;span&gt;Git&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt; {
&lt;span&gt;URL&lt;/span&gt;  &lt;span&gt;string&lt;/span&gt;                &lt;span&gt;// å­˜é…ç½®çš„æºç ä»“åº“åœ°å€, å…ˆæ”¯æŒ HTTPS ç«¯ç‚¹
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;Auth&lt;/span&gt; &lt;span&gt;transport&lt;/span&gt;.&lt;span&gt;AuthMethod&lt;/span&gt;  &lt;span&gt;// èº«ä»½è®¤è¯ä¿¡æ¯, å…¬å¼€ä»“åº“è¯¥å­—æ®µä¸º nil
&lt;/span&gt;&lt;span/&gt;
&lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;           &lt;span&gt;// è®°å½•å½“å‰çš„å‘½åç©ºé—´, ç¬¬ä¸€æ¬¡è®¿é—®å‰è¯¥å­—æ®µä¸ºç©º
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;repo&lt;/span&gt;      &lt;span&gt;*&lt;/span&gt;&lt;span&gt;Repository&lt;/span&gt;      &lt;span&gt;// è®°å½•å½“å‰çš„ä»“åº“å¯¹è±¡, ç¬¬ä¸€æ¬¡è®¿é—®å‰è¯¥å­—æ®µä¸ºç©º
&lt;/span&gt;&lt;span/&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€å®ç° Use å‡½æ•°, ç¬¬ä¸€ç‰ˆå…ˆä¸æ”¯æŒåˆ†æ”¯åˆ‡æ¢, åœ¨æ£€å‡ºæ—¶åªæ£€å‡ºå½“å‰å‘½åç©ºé—´çš„åˆ†æ”¯.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/storage/git.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;g&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;Git&lt;/span&gt;) &lt;span&gt;Use&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt; &lt;span&gt;context&lt;/span&gt;.&lt;span&gt;Context&lt;/span&gt;, &lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
    &lt;span&gt;// ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ clone å½“å‰å‘½åç©ºé—´å¯¹åº”çš„åˆ†æ”¯
&lt;/span&gt;&lt;span/&gt;    &lt;span&gt;if&lt;/span&gt; &lt;span&gt;g&lt;/span&gt;.&lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;==&lt;/span&gt; &lt;span&gt;&quot;&quot;&lt;/span&gt; {
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;g&lt;/span&gt;.&lt;span&gt;repo&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; = &lt;span&gt;g&lt;/span&gt;.&lt;span&gt;clone&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt;, &lt;span&gt;namespace&lt;/span&gt;); &lt;span&gt;err&lt;/span&gt; &lt;span&gt;==&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;g&lt;/span&gt;.&lt;span&gt;namespace&lt;/span&gt; = &lt;span&gt;namespace&lt;/span&gt;
}
&lt;span&gt;return&lt;/span&gt;
}
    
    &lt;span&gt;// TODO: ä¹‹ååœ¨è¿™é‡Œå®ç°åˆ†æ”¯åˆ‡æ¢, ä»è€Œæ”¯æŒå¤šå‘½åç©ºé—´
&lt;/span&gt;&lt;span/&gt;    &lt;span&gt;return&lt;/span&gt;
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿˜æœ‰ Read å‡½æ•°.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/storage/git.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;g&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;Git&lt;/span&gt;) &lt;span&gt;Read&lt;/span&gt;(&lt;span&gt;path&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;content&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
&lt;span&gt;var&lt;/span&gt; (
&lt;span&gt;wt&lt;/span&gt;   &lt;span&gt;*&lt;/span&gt;&lt;span&gt;Worktree&lt;/span&gt;
&lt;span&gt;fd&lt;/span&gt;   &lt;span&gt;billy&lt;/span&gt;.&lt;span&gt;File&lt;/span&gt;
&lt;span&gt;data&lt;/span&gt; []&lt;span&gt;byte&lt;/span&gt;
)
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;wt&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; = &lt;span&gt;g&lt;/span&gt;.&lt;span&gt;repo&lt;/span&gt;.&lt;span&gt;Worktree&lt;/span&gt;(); &lt;span&gt;err&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;return&lt;/span&gt;
}
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;fd&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; = &lt;span&gt;wt&lt;/span&gt;.&lt;span&gt;Filesystem&lt;/span&gt;.&lt;span&gt;Open&lt;/span&gt;(&lt;span&gt;path&lt;/span&gt;); &lt;span&gt;err&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;return&lt;/span&gt;
}
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;data&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; = &lt;span&gt;ioutil&lt;/span&gt;.&lt;span&gt;ReadAll&lt;/span&gt;(&lt;span&gt;fd&lt;/span&gt;); &lt;span&gt;err&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;return&lt;/span&gt;
}
&lt;span&gt;return&lt;/span&gt; string(&lt;span&gt;data&lt;/span&gt;), &lt;span&gt;nil&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢ç”¨åˆ°çš„ä¸¤ä¸ªå·¥å…·å‡½æ•°:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/storage/git.go
&lt;/span&gt;&lt;span&gt;// git clone å‡½æ•°, ä½¿ç”¨å†…å­˜æ–‡ä»¶ç³»ç»Ÿ, æ‰€ä»¥ä¸ä¼šåœ¨ç¡¬ç›˜ä¸Šç•™ä¸‹æ–‡ä»¶.
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;g&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;Git&lt;/span&gt;) &lt;span&gt;clone&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt; &lt;span&gt;context&lt;/span&gt;.&lt;span&gt;Context&lt;/span&gt;, &lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;repo&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;Repository&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
&lt;span&gt;opts&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;CloneOptions&lt;/span&gt;{
&lt;span&gt;URL&lt;/span&gt;:          &lt;span&gt;g&lt;/span&gt;.&lt;span&gt;URL&lt;/span&gt;,
&lt;span&gt;Auth&lt;/span&gt;:         &lt;span&gt;g&lt;/span&gt;.&lt;span&gt;Auth&lt;/span&gt;,
&lt;span&gt;SingleBranch&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,
&lt;span&gt;Depth&lt;/span&gt;:        &lt;span&gt;1&lt;/span&gt;,
&lt;span&gt;Progress&lt;/span&gt;:     &lt;span&gt;os&lt;/span&gt;.&lt;span&gt;Stdout&lt;/span&gt;,
}
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;opts&lt;/span&gt;.&lt;span&gt;ReferenceName&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; = &lt;span&gt;g&lt;/span&gt;.&lt;span&gt;branchRef&lt;/span&gt;(&lt;span&gt;namespace&lt;/span&gt;); &lt;span&gt;err&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;return&lt;/span&gt;
}

&lt;span&gt;return&lt;/span&gt; &lt;span&gt;CloneContext&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt;, &lt;span&gt;memory&lt;/span&gt;.&lt;span&gt;NewStorage&lt;/span&gt;(), &lt;span&gt;memfs&lt;/span&gt;.&lt;span&gt;New&lt;/span&gt;(), &lt;span&gt;opts&lt;/span&gt;)
}

&lt;span&gt;// æ ¹æ®ä¼ å…¥çš„å‘½åç©ºé—´è¿”å›å¯¹åº”çš„åˆ†æ”¯å¼•ç”¨åç§°, å¹¶ä¸”å‘½åç©ºé—´ä¸èƒ½ä¸ºç©º
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;g&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;Git&lt;/span&gt;) &lt;span&gt;branchRef&lt;/span&gt;(&lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;ref&lt;/span&gt; &lt;span&gt;plumbing&lt;/span&gt;.&lt;span&gt;ReferenceName&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;==&lt;/span&gt; &lt;span&gt;&quot;&quot;&lt;/span&gt; {
&lt;span&gt;err&lt;/span&gt; = &lt;span&gt;fmt&lt;/span&gt;.&lt;span&gt;Errorf&lt;/span&gt;(&lt;span&gt;&quot;namespace is required&quot;&lt;/span&gt;)
&lt;span&gt;return&lt;/span&gt;
}

&lt;span&gt;ref&lt;/span&gt; = &lt;span&gt;plumbing&lt;/span&gt;.&lt;span&gt;ReferenceName&lt;/span&gt;(&lt;span&gt;fmt&lt;/span&gt;.&lt;span&gt;Sprintf&lt;/span&gt;(&lt;span&gt;&quot;refs/heads/%s&quot;&lt;/span&gt;, &lt;span&gt;namespace&lt;/span&gt;))
&lt;span&gt;return&lt;/span&gt;
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åå†™ä¸ªæµ‹è¯•éªŒè¯ä¸€ä¸‹:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/storage/storage_test.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;package&lt;/span&gt; &lt;span&gt;storage&lt;/span&gt;

&lt;span&gt;import&lt;/span&gt; (
&lt;span&gt;&quot;context&quot;&lt;/span&gt;
&lt;span&gt;&quot;path/filepath&quot;&lt;/span&gt;
&lt;span&gt;&quot;runtime&quot;&lt;/span&gt;
&lt;span&gt;&quot;testing&quot;&lt;/span&gt;

&lt;span&gt;&quot;github.com/stretchr/testify/assert&quot;&lt;/span&gt;
)

&lt;span&gt;// å¦‚æœå¯ä»¥æ­£å¸¸è¯»å– go.mod å†…å®¹åˆ™å®ç°æœ‰æ•ˆ
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;TestGit&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;testing&lt;/span&gt;.&lt;span&gt;T&lt;/span&gt;) {
&lt;span&gt;g&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;Git&lt;/span&gt;{&lt;span&gt;URL&lt;/span&gt;: &lt;span&gt;localRepo&lt;/span&gt;()}

&lt;span&gt;if&lt;/span&gt; &lt;span&gt;err&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;g&lt;/span&gt;.&lt;span&gt;Use&lt;/span&gt;(&lt;span&gt;context&lt;/span&gt;.&lt;span&gt;TODO&lt;/span&gt;(), &lt;span&gt;&quot;master&quot;&lt;/span&gt;); !&lt;span&gt;assert&lt;/span&gt;.&lt;span&gt;NoError&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt;) {
&lt;span&gt;return&lt;/span&gt;
}

&lt;span&gt;if&lt;/span&gt; &lt;span&gt;content&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;g&lt;/span&gt;.&lt;span&gt;Read&lt;/span&gt;(&lt;span&gt;&quot;go.mod&quot;&lt;/span&gt;); &lt;span&gt;assert&lt;/span&gt;.&lt;span&gt;NoError&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt;) {
&lt;span&gt;assert&lt;/span&gt;.&lt;span&gt;NotEmpty&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt;, &lt;span&gt;content&lt;/span&gt;)
}
}

&lt;span&gt;// ç”¨å½“å‰çš„é¡¹ç›®ä½œä¸ºæµ‹è¯•åº“
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;localRepo&lt;/span&gt;() &lt;span&gt;string&lt;/span&gt; {
&lt;span&gt;_&lt;/span&gt;, &lt;span&gt;filename&lt;/span&gt;, &lt;span&gt;_&lt;/span&gt;, &lt;span&gt;_&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;runtime&lt;/span&gt;.&lt;span&gt;Caller&lt;/span&gt;(&lt;span&gt;0&lt;/span&gt;)
&lt;span&gt;return&lt;/span&gt; &lt;span&gt;filepath&lt;/span&gt;.&lt;span&gt;Join&lt;/span&gt;(&lt;span&gt;filename&lt;/span&gt;, &lt;span&gt;&quot;../../..&quot;&lt;/span&gt;)
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œâ€¦&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;$ go test github.com/GotaX/go-config-server/pkg/storage
&lt;span&gt;# ok      github.com/GotaX/go-config-server/pkg/storage   0.390s&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;OK å®Œå…¨æ²¡æœ‰é—®é¢˜.&lt;/p&gt;
&lt;h2 id=&quot;ç»„è£…-app&quot;&gt;ç»„è£… App&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥, æˆ‘ä»¬åœ¨ app ä¸­å°†ä¸Šé¢ä¸¤ä¸ªç»„ä»¶ç»„è£…èµ·æ¥.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/handler/app.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;package&lt;/span&gt; &lt;span&gt;handler&lt;/span&gt;

&lt;span&gt;import&lt;/span&gt; (
&lt;span&gt;&quot;context&quot;&lt;/span&gt;

&lt;span&gt;&quot;github.com/GotaX/go-config-server/pkg/render&quot;&lt;/span&gt;
&lt;span&gt;&quot;github.com/GotaX/go-config-server/pkg/storage&quot;&lt;/span&gt;
)

&lt;span&gt;type&lt;/span&gt; &lt;span&gt;App&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt; {
&lt;span&gt;Storage&lt;/span&gt;  &lt;span&gt;storage&lt;/span&gt;.&lt;span&gt;Storage&lt;/span&gt;
&lt;span&gt;Renderer&lt;/span&gt; &lt;span&gt;render&lt;/span&gt;.&lt;span&gt;Renderer&lt;/span&gt;
}

&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;a&lt;/span&gt; &lt;span&gt;App&lt;/span&gt;) &lt;span&gt;Handle&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt; &lt;span&gt;context&lt;/span&gt;.&lt;span&gt;Context&lt;/span&gt;, &lt;span&gt;namespace&lt;/span&gt;, &lt;span&gt;name&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;doc&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
    &lt;span&gt;// åˆ‡æ¢åˆ°æŒ‡å®šå‘½åç©ºé—´
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;err&lt;/span&gt; = &lt;span&gt;a&lt;/span&gt;.&lt;span&gt;Storage&lt;/span&gt;.&lt;span&gt;Use&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt;, &lt;span&gt;namespace&lt;/span&gt;); &lt;span&gt;err&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;return&lt;/span&gt;
}
    &lt;span&gt;// æ‰§è¡Œæ¸²æŸ“
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;a&lt;/span&gt;.&lt;span&gt;Renderer&lt;/span&gt;.&lt;span&gt;Render&lt;/span&gt;(&lt;span&gt;name&lt;/span&gt;, &lt;span&gt;render&lt;/span&gt;.&lt;span&gt;JSON&lt;/span&gt;)
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•å¯ä¸èƒ½å°‘.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/handler/handler_test.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;package&lt;/span&gt; &lt;span&gt;handler&lt;/span&gt;

&lt;span&gt;import&lt;/span&gt; (
&lt;span&gt;&quot;context&quot;&lt;/span&gt;
&lt;span&gt;&quot;testing&quot;&lt;/span&gt;

&lt;span&gt;&quot;github.com/GotaX/go-config-server/pkg/render&quot;&lt;/span&gt;
&lt;span&gt;&quot;github.com/stretchr/testify/assert&quot;&lt;/span&gt;
)

&lt;span&gt;func&lt;/span&gt; &lt;span&gt;TestApp&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;testing&lt;/span&gt;.&lt;span&gt;T&lt;/span&gt;) {
&lt;span&gt;s&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;MockStorage&lt;/span&gt;{}
&lt;span&gt;r&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;MockRender&lt;/span&gt;{}
&lt;span&gt;app&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;App&lt;/span&gt;{&lt;span&gt;Storage&lt;/span&gt;: &lt;span&gt;s&lt;/span&gt;, &lt;span&gt;Renderer&lt;/span&gt;: &lt;span&gt;r&lt;/span&gt;}

&lt;span&gt;_&lt;/span&gt;, &lt;span&gt;_&lt;/span&gt; = &lt;span&gt;app&lt;/span&gt;.&lt;span&gt;Handle&lt;/span&gt;(&lt;span&gt;context&lt;/span&gt;.&lt;span&gt;TODO&lt;/span&gt;(), &lt;span&gt;&quot;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&quot;&lt;/span&gt;)
    
    &lt;span&gt;// ç¡®ä¿ Storage.Use å’Œ Renderer.Render æœ‰è¢«è°ƒç”¨åˆ°
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;assert&lt;/span&gt;.&lt;span&gt;True&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt;, &lt;span&gt;s&lt;/span&gt;.&lt;span&gt;useInvoked&lt;/span&gt;)
&lt;span&gt;assert&lt;/span&gt;.&lt;span&gt;True&lt;/span&gt;(&lt;span&gt;t&lt;/span&gt;, &lt;span&gt;r&lt;/span&gt;.&lt;span&gt;renderInvoked&lt;/span&gt;)
}

&lt;span&gt;type&lt;/span&gt; &lt;span&gt;MockStorage&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt; { &lt;span&gt;useInvoked&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; }
&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;m&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;MockStorage&lt;/span&gt;) &lt;span&gt;Use&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt; &lt;span&gt;context&lt;/span&gt;.&lt;span&gt;Context&lt;/span&gt;, &lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) { &lt;span&gt;m&lt;/span&gt;.&lt;span&gt;useInvoked&lt;/span&gt; = &lt;span&gt;true&lt;/span&gt;;&lt;span&gt;return&lt;/span&gt; }
&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;m&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;MockStorage&lt;/span&gt;) &lt;span&gt;Read&lt;/span&gt;(&lt;span&gt;path&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;content&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) { &lt;span&gt;return&lt;/span&gt; }

&lt;span&gt;type&lt;/span&gt; &lt;span&gt;MockRender&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt; { &lt;span&gt;renderInvoked&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; }
&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;m&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;MockRender&lt;/span&gt;) &lt;span&gt;Render&lt;/span&gt;(&lt;span&gt;entry&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;outputType&lt;/span&gt; &lt;span&gt;render&lt;/span&gt;.&lt;span&gt;ContentType&lt;/span&gt;) (&lt;span&gt;doc&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) { &lt;span&gt;m&lt;/span&gt;.&lt;span&gt;renderInvoked&lt;/span&gt; = &lt;span&gt;true&lt;/span&gt;; &lt;span&gt;return&lt;/span&gt; }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œä¸€ä¸‹:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;$ go test github.com/GotaX/go-config-server/pkg/handler
&lt;span&gt;# ok      github.com/GotaX/go-config-server/pkg/handler   0.191s&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¥½, åˆ°ç›®å‰ä¸ºæ­¢æ‰€æœ‰çš„æ ¸å¿ƒç»„ä»¶å°±éƒ½å®ç°å®Œäº†. æ˜¯ä¸æ˜¯å¾ˆè½»æ¾å‘€? ä¸‹é¢å°±æ˜¯ä¸€äº›ä¸ API ç›¸å…³çš„å¤–å›´å·¥ä½œäº†.&lt;/p&gt;
&lt;h1 id=&quot;ç”¨æˆ·æ¥å£é€‚é…&quot;&gt;ç”¨æˆ·æ¥å£é€‚é…&lt;/h1&gt;
&lt;p&gt;ç¨å¾®å·ä¸‹æ‡’, å¤–å›´æ¥å£å°±ä¸å†™æµ‹è¯•äº† ğŸ˜.&lt;/p&gt;
&lt;h2 id=&quot;æœåŠ¡å™¨&quot;&gt;æœåŠ¡å™¨&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href=&quot;https://github.com/gofiber/fiber&quot;&gt;Fiber&lt;/a&gt; åšåº”ç”¨æœåŠ¡å™¨, å¦‚æœè¦è¿½æ±‚æè‡´æ€§èƒ½ä¹Ÿå¯ä»¥é€‰ç”¨ &lt;a href=&quot;https://github.com/valyala/fasthttp&quot;&gt;Fasthttp&lt;/a&gt;, ä¸è¿‡åŒºåˆ«å…¶å®å¾ˆå°å¾ˆå°, ä¸ºäº†è½»æ¾å®ç°åŠŸèƒ½, æˆ‘å°±ç”¨ Fiber äº†.&lt;/p&gt;
&lt;p&gt;å…ˆå®šä¹‰ä¸€ä¸‹å¯åŠ¨å‚æ•°.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/service/service.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;type&lt;/span&gt; &lt;span&gt;Options&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt; {
    &lt;span&gt;HttpAddr&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;  &lt;span&gt;// HTTP ç›‘å¬åœ°å€, é»˜è®¤ä¸º :8080
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;URL&lt;/span&gt;      &lt;span&gt;string&lt;/span&gt;  &lt;span&gt;// Git ä»“åº“åœ°å€, ç›®å‰ä»…æ”¯æŒ HTTPS
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;Username&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;  &lt;span&gt;// Git ç”¨æˆ·å, è®¿é—®å…¬å…±ä»“åº“ç•™ç©º, ä½¿ç”¨ AccessToken è®¿é—®éšä¾¿å¡«ä¸€ä¸ª
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;Password&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;  &lt;span&gt;// Git å¯†ç , è®¿é—®å…¬å…±ä»“åº“ç•™ç©º, ä½¿ç”¨ AccessToken è®¿é—®å¡« AccessToken
&lt;/span&gt;&lt;span/&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆå§‹åŒ– Service å¯¹è±¡&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/service/service.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;type&lt;/span&gt; &lt;span&gt;Service&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt; {
&lt;span&gt;httpAddr&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;
&lt;span&gt;app&lt;/span&gt;      &lt;span&gt;handler&lt;/span&gt;.&lt;span&gt;App&lt;/span&gt;
}

&lt;span&gt;func&lt;/span&gt; &lt;span&gt;New&lt;/span&gt;(&lt;span&gt;opts&lt;/span&gt; &lt;span&gt;Options&lt;/span&gt;) &lt;span&gt;*&lt;/span&gt;&lt;span&gt;Service&lt;/span&gt; {
&lt;span&gt;store&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;storage&lt;/span&gt;.&lt;span&gt;Git&lt;/span&gt;{
&lt;span&gt;URL&lt;/span&gt;: &lt;span&gt;opts&lt;/span&gt;.&lt;span&gt;URL&lt;/span&gt;,
}
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;opts&lt;/span&gt;.&lt;span&gt;Username&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;&quot;&quot;&lt;/span&gt; {
&lt;span&gt;store&lt;/span&gt;.&lt;span&gt;Auth&lt;/span&gt; = &lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;http&lt;/span&gt;.&lt;span&gt;BasicAuth&lt;/span&gt;{
&lt;span&gt;Username&lt;/span&gt;: &lt;span&gt;opts&lt;/span&gt;.&lt;span&gt;Username&lt;/span&gt;,
&lt;span&gt;Password&lt;/span&gt;: &lt;span&gt;opts&lt;/span&gt;.&lt;span&gt;Password&lt;/span&gt;,
}
}
&lt;span&gt;renderer&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;render&lt;/span&gt;.&lt;span&gt;Jsonnet&lt;/span&gt;{
         &lt;span&gt;// è§ä¸‹é¢è¯´æ˜
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;Importer&lt;/span&gt;: &lt;span&gt;render&lt;/span&gt;.&lt;span&gt;StorageImporter&lt;/span&gt;{
&lt;span&gt;Storage&lt;/span&gt;: &lt;span&gt;store&lt;/span&gt;,
},
}
&lt;span&gt;return&lt;/span&gt; &lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;Service&lt;/span&gt;{
&lt;span&gt;httpAddr&lt;/span&gt;: &lt;span&gt;opts&lt;/span&gt;.&lt;span&gt;HttpAddr&lt;/span&gt;,
&lt;span&gt;app&lt;/span&gt;: &lt;span&gt;handler&lt;/span&gt;.&lt;span&gt;App&lt;/span&gt;{
&lt;span&gt;Storage&lt;/span&gt;:  &lt;span&gt;store&lt;/span&gt;,
&lt;span&gt;Renderer&lt;/span&gt;: &lt;span&gt;renderer&lt;/span&gt;,
},
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œè§£é‡Šä¸‹ &lt;code&gt;render.StorageImporter &lt;/code&gt; , Importer æ˜¯ Jsonnet VM ä½¿ç”¨çš„æ¥å£, å’Œæˆ‘ä»¬çš„ Storage æ¥å£æœ‰ä¸€ç‚¹å·®å¼‚, æ‰€ä»¥å®šä¹‰äº†è¿™ä¸ªé€‚é…å™¨.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/render/jsonnet.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;type&lt;/span&gt; &lt;span&gt;StorageImporter&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt; {
&lt;span&gt;Storage&lt;/span&gt; &lt;span&gt;storage&lt;/span&gt;.&lt;span&gt;Storage&lt;/span&gt;
}

&lt;span&gt;// importFrom ä¸ºä½¿ç”¨ import çš„æºæ–‡ä»¶, ç»å¯¹è·¯å¾„
&lt;/span&gt;&lt;span&gt;// importedPath ä¸º import çš„ç›®æ ‡æ–‡ä»¶, ç›¸å¯¹è·¯å¾„, ç›¸å¯¹äºæºæ–‡ä»¶
&lt;/span&gt;&lt;span&gt;// contents ä¸ºæ–‡ä»¶å†…å®¹
&lt;/span&gt;&lt;span&gt;// foundAt ä¸º import ç›®æ ‡æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;s&lt;/span&gt; &lt;span&gt;StorageImporter&lt;/span&gt;) &lt;span&gt;Import&lt;/span&gt;(&lt;span&gt;importedFrom&lt;/span&gt;, &lt;span&gt;importedPath&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;) (&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;Contents&lt;/span&gt;, &lt;span&gt;foundAt&lt;/span&gt; &lt;span&gt;string&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
&lt;span&gt;dir&lt;/span&gt;, &lt;span&gt;_&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;filepath&lt;/span&gt;.&lt;span&gt;Split&lt;/span&gt;(&lt;span&gt;importedFrom&lt;/span&gt;)
&lt;span&gt;path&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;filepath&lt;/span&gt;.&lt;span&gt;Join&lt;/span&gt;(&lt;span&gt;dir&lt;/span&gt;, &lt;span&gt;importedPath&lt;/span&gt;)
&lt;span&gt;data&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;s&lt;/span&gt;.&lt;span&gt;Storage&lt;/span&gt;.&lt;span&gt;Read&lt;/span&gt;(&lt;span&gt;path&lt;/span&gt;)

&lt;span&gt;if&lt;/span&gt; &lt;span&gt;err&lt;/span&gt; &lt;span&gt;==&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;contents&lt;/span&gt; = &lt;span&gt;MakeContents&lt;/span&gt;(&lt;span&gt;data&lt;/span&gt;)
&lt;span&gt;foundAt&lt;/span&gt; = &lt;span&gt;path&lt;/span&gt;
}
&lt;span&gt;return&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€ç»§ç»­å®šä¹‰è·¯ç”±çš„ Handler:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/service/service.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;srv&lt;/span&gt; &lt;span&gt;Service&lt;/span&gt;) &lt;span&gt;Handle&lt;/span&gt;(&lt;span&gt;c&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;fiber&lt;/span&gt;.&lt;span&gt;Ctx&lt;/span&gt;) (&lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
&lt;span&gt;var&lt;/span&gt; (
&lt;span&gt;ctx&lt;/span&gt;       = &lt;span&gt;c&lt;/span&gt;.&lt;span&gt;Context&lt;/span&gt;()
&lt;span&gt;name&lt;/span&gt;      = &lt;span&gt;c&lt;/span&gt;.&lt;span&gt;Params&lt;/span&gt;(&lt;span&gt;&quot;+&quot;&lt;/span&gt;)          &lt;span&gt;// fiber çš„ wildcard è¯­æ³•, ç­‰ä¸‹è§£é‡Š
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;namespace&lt;/span&gt; = &lt;span&gt;c&lt;/span&gt;.&lt;span&gt;Params&lt;/span&gt;(&lt;span&gt;&quot;namespace&quot;&lt;/span&gt;)
)
&lt;span&gt;doc&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;srv&lt;/span&gt;.&lt;span&gt;app&lt;/span&gt;.&lt;span&gt;Handle&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt;, &lt;span&gt;namespace&lt;/span&gt;, &lt;span&gt;name&lt;/span&gt;)
&lt;span&gt;if&lt;/span&gt; &lt;span&gt;err&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;return&lt;/span&gt;
}

&lt;span&gt;c&lt;/span&gt;.&lt;span&gt;Set&lt;/span&gt;(&lt;span&gt;&quot;Content-Type&quot;&lt;/span&gt;, &lt;span&gt;&quot;application/json&quot;&lt;/span&gt;)
&lt;span&gt;return&lt;/span&gt; &lt;span&gt;c&lt;/span&gt;.&lt;span&gt;SendString&lt;/span&gt;(&lt;span&gt;doc&lt;/span&gt;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»§ç»­å®šä¹‰è·¯ç”±:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/service/service.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;const&lt;/span&gt; (
&lt;span&gt;readTimeout&lt;/span&gt;    = &lt;span&gt;10&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;time&lt;/span&gt;.&lt;span&gt;Second&lt;/span&gt;  &lt;span&gt;// è¯»è¯·æ±‚è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;writeTimeout&lt;/span&gt;   = &lt;span&gt;10&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;time&lt;/span&gt;.&lt;span&gt;Second&lt;/span&gt;  &lt;span&gt;// å†™å“åº”è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;endpointHealth&lt;/span&gt; = &lt;span&gt;&quot;/healthz&quot;&lt;/span&gt;        &lt;span&gt;// å¥åº·æ£€æŸ¥ç«¯ç‚¹
&lt;/span&gt;&lt;span/&gt;)

&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;srv&lt;/span&gt; &lt;span&gt;Service&lt;/span&gt;) &lt;span&gt;Run&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt; &lt;span&gt;context&lt;/span&gt;.&lt;span&gt;Context&lt;/span&gt;) (&lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
&lt;span&gt;server&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;fiber&lt;/span&gt;.&lt;span&gt;New&lt;/span&gt;(&lt;span&gt;fiber&lt;/span&gt;.&lt;span&gt;Config&lt;/span&gt;{
&lt;span&gt;ReadTimeout&lt;/span&gt;:  &lt;span&gt;readTimeout&lt;/span&gt;,
&lt;span&gt;WriteTimeout&lt;/span&gt;: &lt;span&gt;writeTimeout&lt;/span&gt;,
})

&lt;span&gt;registerAccessLogger&lt;/span&gt;(&lt;span&gt;server&lt;/span&gt;)    &lt;span&gt;// è®¿é—®æ—¥å¿—ä¸­é—´ä»¶
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;registerHealthHandler&lt;/span&gt;(&lt;span&gt;server&lt;/span&gt;)   &lt;span&gt;// å¥åº·æ£€æŸ¥ä¸­é—´ä»¶
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;srv&lt;/span&gt;.&lt;span&gt;registerAppHandler&lt;/span&gt;(&lt;span&gt;server&lt;/span&gt;)  &lt;span&gt;// æ³¨å†Œè·¯ç”±
&lt;/span&gt;&lt;span/&gt;
&lt;span&gt;chErr&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; make(&lt;span&gt;chan&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;)

&lt;span&gt;go&lt;/span&gt; &lt;span&gt;func&lt;/span&gt;() {
        &lt;span&gt;// å¼€å§‹ç›‘å¬ç«¯å£
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;err&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;server&lt;/span&gt;.&lt;span&gt;Listen&lt;/span&gt;(&lt;span&gt;srv&lt;/span&gt;.&lt;span&gt;httpAddr&lt;/span&gt;); &lt;span&gt;err&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;chErr&lt;/span&gt; &lt;span&gt;&amp;lt;-&lt;/span&gt; &lt;span&gt;err&lt;/span&gt;
}
}()

    &lt;span&gt;// å®ç° Graceful shutdown, è¿›ç¨‹ç»“æŸå‰ä¼šå…ˆå–æ¶ˆæ‰ Context
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;select&lt;/span&gt; {
&lt;span&gt;case&lt;/span&gt; &lt;span&gt;err&lt;/span&gt; = &lt;span&gt;&amp;lt;-&lt;/span&gt;&lt;span&gt;chErr&lt;/span&gt;:
&lt;span&gt;case&lt;/span&gt; &lt;span&gt;&amp;lt;-&lt;/span&gt;&lt;span&gt;ctx&lt;/span&gt;.&lt;span&gt;Done&lt;/span&gt;():
&lt;span&gt;err&lt;/span&gt; = &lt;span&gt;server&lt;/span&gt;.&lt;span&gt;Shutdown&lt;/span&gt;()
}
&lt;span&gt;return&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢ç”¨åˆ°çš„å‡ ä¸ªå·¥å…·å‡½æ•°:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// pkg/service/service.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; (&lt;span&gt;srv&lt;/span&gt; &lt;span&gt;Service&lt;/span&gt;) &lt;span&gt;registerAppHandler&lt;/span&gt;(&lt;span&gt;server&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;fiber&lt;/span&gt;.&lt;span&gt;App&lt;/span&gt;) {
    &lt;span&gt;// å®šä¹‰ path params, namespace ä¸ºç¬¬ä¸€ä¸ªå‚æ•°, åé¢æ‰€æœ‰å­—ç¬¦åŒ…æ‹¬ &#x27;/&#x27; ä¸ºç¬¬äºŒä¸ªå‚æ•°
&lt;/span&gt;&lt;span/&gt;    &lt;span&gt;// ä¾‹å¦‚: /master/example/arith.jsonnet
&lt;/span&gt;&lt;span/&gt;    &lt;span&gt;// å‚æ•°ä¸€: namespace = master
&lt;/span&gt;&lt;span/&gt;    &lt;span&gt;// å‚æ•°äºŒ: + = example/arith.jsonnet
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;server&lt;/span&gt;.&lt;span&gt;Get&lt;/span&gt;(&lt;span&gt;&quot;/:namespace/+&quot;&lt;/span&gt;, &lt;span&gt;srv&lt;/span&gt;.&lt;span&gt;Handle&lt;/span&gt;)
}

&lt;span&gt;// è®¿é—®æ—¥å¿—
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;registerAccessLogger&lt;/span&gt;(&lt;span&gt;server&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;fiber&lt;/span&gt;.&lt;span&gt;App&lt;/span&gt;) {
&lt;span&gt;server&lt;/span&gt;.&lt;span&gt;Use&lt;/span&gt;(&lt;span&gt;logger&lt;/span&gt;.&lt;span&gt;New&lt;/span&gt;(&lt;span&gt;logger&lt;/span&gt;.&lt;span&gt;Config&lt;/span&gt;{
&lt;span&gt;Next&lt;/span&gt;: &lt;span&gt;func&lt;/span&gt;(&lt;span&gt;c&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;fiber&lt;/span&gt;.&lt;span&gt;Ctx&lt;/span&gt;) &lt;span&gt;bool&lt;/span&gt; { &lt;span&gt;return&lt;/span&gt; &lt;span&gt;c&lt;/span&gt;.&lt;span&gt;Path&lt;/span&gt;() &lt;span&gt;==&lt;/span&gt; &lt;span&gt;endpointHealth&lt;/span&gt; },
}))
}

&lt;span&gt;// å¥åº·æ£€æŸ¥
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;registerHealthHandler&lt;/span&gt;(&lt;span&gt;server&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;fiber&lt;/span&gt;.&lt;span&gt;App&lt;/span&gt;) {
&lt;span&gt;server&lt;/span&gt;.&lt;span&gt;All&lt;/span&gt;(&lt;span&gt;endpointHealth&lt;/span&gt;, &lt;span&gt;func&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;fiber&lt;/span&gt;.&lt;span&gt;Ctx&lt;/span&gt;) &lt;span&gt;error&lt;/span&gt; {
&lt;span&gt;return&lt;/span&gt; &lt;span&gt;ctx&lt;/span&gt;.&lt;span&gt;SendStatus&lt;/span&gt;(&lt;span&gt;fiber&lt;/span&gt;.&lt;span&gt;StatusOK&lt;/span&gt;)
})
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&quot;å‘½ä»¤è¡Œ&quot;&gt;å‘½ä»¤è¡Œ&lt;/h2&gt;
&lt;p&gt;æœ€åæˆ‘ä»¬æ¥åšå¯åŠ¨ç¨‹åºçš„å‘½ä»¤è¡Œç•Œé¢, é¡ºä¾¿è§£é‡Šä¸€ä¸‹ä¼˜é›…é€€å‡ºæ€ä¹ˆå®ç°.&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href=&quot;urfave/cli&quot;&gt;urfave/cli&lt;/a&gt; è¿™ä¸ªåº“. é¦–å…ˆ, å®šä¹‰ä¸€äº›å‘½ä»¤è¡Œå‚æ•°, ç¯å¢ƒå˜é‡ç­‰ä¹‹ååš Docker é•œåƒçš„æ—¶å€™å†æ”¯æŒ.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// internal/web.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;package&lt;/span&gt; &lt;span&gt;internal&lt;/span&gt;

&lt;span&gt;import&lt;/span&gt; (
&lt;span&gt;&quot;github.com/GotaX/go-config-server/pkg/service&quot;&lt;/span&gt;
. &lt;span&gt;&quot;github.com/urfave/cli/v2&quot;&lt;/span&gt;
)

&lt;span&gt;const&lt;/span&gt; (
&lt;span&gt;flagHttp&lt;/span&gt;       = &lt;span&gt;&quot;http&quot;&lt;/span&gt;        &lt;span&gt;// HTTP ç›‘å¬åœ°å€, é»˜è®¤ä¸º :8080
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;flagRepository&lt;/span&gt; = &lt;span&gt;&quot;repository&quot;&lt;/span&gt;  &lt;span&gt;// Git ä»“åº“åœ°å€, ç›®å‰ä»…æ”¯æŒ HTTPS
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;flagUsername&lt;/span&gt;   = &lt;span&gt;&quot;username&quot;&lt;/span&gt;    &lt;span&gt;// Git ç”¨æˆ·å, è®¿é—®å…¬å…±ä»“åº“ç•™ç©º, ä½¿ç”¨ AccessToken è®¿é—®éšä¾¿å¡«ä¸€ä¸ª
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;flagPassword&lt;/span&gt;   = &lt;span&gt;&quot;password&quot;&lt;/span&gt;    &lt;span&gt;// Git å¯†ç , è®¿é—®å…¬å…±ä»“åº“ç•™ç©º, ä½¿ç”¨ AccessToken è®¿é—®å¡« AccessToken
&lt;/span&gt;&lt;span/&gt;)

&lt;span&gt;var&lt;/span&gt; &lt;span&gt;CmdWeb&lt;/span&gt; = &lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;Command&lt;/span&gt;{
&lt;span&gt;Name&lt;/span&gt;:   &lt;span&gt;&quot;web&quot;&lt;/span&gt;,
&lt;span&gt;Usage&lt;/span&gt;:  &lt;span&gt;&quot;Start config server&quot;&lt;/span&gt;,
&lt;span&gt;Action&lt;/span&gt;: &lt;span&gt;runWeb&lt;/span&gt;,
&lt;span&gt;Flags&lt;/span&gt;: []&lt;span&gt;Flag&lt;/span&gt;{
&lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;StringFlag&lt;/span&gt;{
&lt;span&gt;Name&lt;/span&gt;:  &lt;span&gt;flagHttp&lt;/span&gt;,
&lt;span&gt;Value&lt;/span&gt;: &lt;span&gt;&quot;:8080&quot;&lt;/span&gt;,
},
&lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;StringFlag&lt;/span&gt;{
&lt;span&gt;Name&lt;/span&gt;:     &lt;span&gt;flagRepository&lt;/span&gt;,
&lt;span&gt;Required&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;,
&lt;span&gt;Aliases&lt;/span&gt;:  []&lt;span&gt;string&lt;/span&gt;{&lt;span&gt;&quot;repo&quot;&lt;/span&gt;},
},
&lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;StringFlag&lt;/span&gt;{
&lt;span&gt;Name&lt;/span&gt;:    &lt;span&gt;flagUsername&lt;/span&gt;,
&lt;span&gt;Aliases&lt;/span&gt;: []&lt;span&gt;string&lt;/span&gt;{&lt;span&gt;&quot;user&quot;&lt;/span&gt;},
},
&lt;span&gt;&amp;amp;&lt;/span&gt;&lt;span&gt;StringFlag&lt;/span&gt;{
&lt;span&gt;Name&lt;/span&gt;:    &lt;span&gt;flagPassword&lt;/span&gt;,
&lt;span&gt;Aliases&lt;/span&gt;: []&lt;span&gt;string&lt;/span&gt;{&lt;span&gt;&quot;pass&quot;&lt;/span&gt;},
},
},
}

&lt;span&gt;func&lt;/span&gt; &lt;span&gt;runWeb&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt; &lt;span&gt;*&lt;/span&gt;&lt;span&gt;Context&lt;/span&gt;) (&lt;span&gt;err&lt;/span&gt; &lt;span&gt;error&lt;/span&gt;) {
&lt;span&gt;srv&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;service&lt;/span&gt;.&lt;span&gt;New&lt;/span&gt;(&lt;span&gt;service&lt;/span&gt;.&lt;span&gt;Options&lt;/span&gt;{
&lt;span&gt;HttpAddr&lt;/span&gt;: &lt;span&gt;ctx&lt;/span&gt;.&lt;span&gt;String&lt;/span&gt;(&lt;span&gt;flagHttp&lt;/span&gt;),
&lt;span&gt;URL&lt;/span&gt;:      &lt;span&gt;ctx&lt;/span&gt;.&lt;span&gt;String&lt;/span&gt;(&lt;span&gt;flagRepository&lt;/span&gt;),
&lt;span&gt;Username&lt;/span&gt;: &lt;span&gt;ctx&lt;/span&gt;.&lt;span&gt;String&lt;/span&gt;(&lt;span&gt;flagUsername&lt;/span&gt;),
&lt;span&gt;Password&lt;/span&gt;: &lt;span&gt;ctx&lt;/span&gt;.&lt;span&gt;String&lt;/span&gt;(&lt;span&gt;flagPassword&lt;/span&gt;),
})
&lt;span&gt;return&lt;/span&gt; &lt;span&gt;srv&lt;/span&gt;.&lt;span&gt;Run&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt;.&lt;span&gt;Context&lt;/span&gt;)
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®šä¹‰ç”¨äºä¼˜é›…é€€å‡ºçš„ Context:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// internal/context.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;package&lt;/span&gt; &lt;span&gt;internal&lt;/span&gt;

&lt;span&gt;import&lt;/span&gt; (
&lt;span&gt;&quot;context&quot;&lt;/span&gt;
&lt;span&gt;&quot;fmt&quot;&lt;/span&gt;
&lt;span&gt;&quot;os&quot;&lt;/span&gt;
&lt;span&gt;&quot;os/signal&quot;&lt;/span&gt;
&lt;span&gt;&quot;syscall&quot;&lt;/span&gt;
)

&lt;span&gt;// è¯¥å‡½æ•°è¿”å›çš„ context ä¼šåœ¨ç¬¬ä¸€æ¬¡æ”¶åˆ° SIGINT æˆ–è€… SIGTERM ä¿¡å·æ—¶å–æ¶ˆ,
&lt;/span&gt;&lt;span&gt;// å¦‚æœåœ¨å…³é—­è¿‡ç¨‹ä¸­å†æ¬¡æ”¶åˆ°ä¿¡å·, åˆ™ä¼šå¼ºåˆ¶ç»“æŸè¿›ç¨‹
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;func&lt;/span&gt; &lt;span&gt;NewAppContext&lt;/span&gt;() (&lt;span&gt;ctx&lt;/span&gt; &lt;span&gt;context&lt;/span&gt;.&lt;span&gt;Context&lt;/span&gt;, &lt;span&gt;cancel&lt;/span&gt; &lt;span&gt;func&lt;/span&gt;()) {
&lt;span&gt;ctx&lt;/span&gt;, &lt;span&gt;cancel&lt;/span&gt; = &lt;span&gt;context&lt;/span&gt;.&lt;span&gt;WithCancel&lt;/span&gt;(&lt;span&gt;context&lt;/span&gt;.&lt;span&gt;Background&lt;/span&gt;())

&lt;span&gt;c&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; make(&lt;span&gt;chan&lt;/span&gt; &lt;span&gt;os&lt;/span&gt;.&lt;span&gt;Signal&lt;/span&gt;, &lt;span&gt;2&lt;/span&gt;)
&lt;span&gt;signal&lt;/span&gt;.&lt;span&gt;Notify&lt;/span&gt;(&lt;span&gt;c&lt;/span&gt;, &lt;span&gt;syscall&lt;/span&gt;.&lt;span&gt;SIGINT&lt;/span&gt;, &lt;span&gt;syscall&lt;/span&gt;.&lt;span&gt;SIGTERM&lt;/span&gt;)
&lt;span&gt;go&lt;/span&gt; &lt;span&gt;func&lt;/span&gt;() {
&lt;span&gt;&amp;lt;-&lt;/span&gt;&lt;span&gt;c&lt;/span&gt;
&lt;span&gt;fmt&lt;/span&gt;.&lt;span&gt;Println&lt;/span&gt;(&lt;span&gt;&quot;Try exit...&quot;&lt;/span&gt;)
&lt;span&gt;cancel&lt;/span&gt;()

&lt;span&gt;&amp;lt;-&lt;/span&gt;&lt;span&gt;c&lt;/span&gt;
&lt;span&gt;fmt&lt;/span&gt;.&lt;span&gt;Println&lt;/span&gt;(&lt;span&gt;&quot;Force exit&quot;&lt;/span&gt;)
&lt;span&gt;os&lt;/span&gt;.&lt;span&gt;Exit&lt;/span&gt;(&lt;span&gt;0&lt;/span&gt;)
}()
&lt;span&gt;return&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&quot;main&quot;&gt;Main&lt;/h2&gt;
&lt;p&gt;ç»ˆäºåˆ°äº†æœ€å, å†™ main å‡½æ•°çš„æ—¶å€™å°½é‡ä¿æŒç®€æ´å°±è¡Œäº†:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;// main.go
&lt;/span&gt;&lt;span/&gt;&lt;span&gt;package&lt;/span&gt; &lt;span&gt;main&lt;/span&gt;

&lt;span&gt;import&lt;/span&gt; (
&lt;span&gt;&quot;log&quot;&lt;/span&gt;
&lt;span&gt;&quot;os&quot;&lt;/span&gt;

&lt;span&gt;&quot;github.com/GotaX/go-config-server/internal&quot;&lt;/span&gt;
&lt;span&gt;&quot;github.com/urfave/cli/v2&quot;&lt;/span&gt;
)

&lt;span&gt;func&lt;/span&gt; &lt;span&gt;main&lt;/span&gt;() {
&lt;span&gt;ctx&lt;/span&gt;, &lt;span&gt;cancel&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;internal&lt;/span&gt;.&lt;span&gt;NewAppContext&lt;/span&gt;()
&lt;span&gt;defer&lt;/span&gt; &lt;span&gt;cancel&lt;/span&gt;()

&lt;span&gt;app&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;cli&lt;/span&gt;.&lt;span&gt;App&lt;/span&gt;{
&lt;span&gt;Name&lt;/span&gt;:     &lt;span&gt;&quot;config-server&quot;&lt;/span&gt;,
&lt;span&gt;Commands&lt;/span&gt;: []&lt;span&gt;*&lt;/span&gt;&lt;span&gt;cli&lt;/span&gt;.&lt;span&gt;Command&lt;/span&gt;{&lt;span&gt;internal&lt;/span&gt;.&lt;span&gt;CmdWeb&lt;/span&gt;},
}

&lt;span&gt;if&lt;/span&gt; &lt;span&gt;err&lt;/span&gt; &lt;span&gt;:=&lt;/span&gt; &lt;span&gt;app&lt;/span&gt;.&lt;span&gt;RunContext&lt;/span&gt;(&lt;span&gt;ctx&lt;/span&gt;, &lt;span&gt;os&lt;/span&gt;.&lt;span&gt;Args&lt;/span&gt;); &lt;span&gt;err&lt;/span&gt; &lt;span&gt;!=&lt;/span&gt; &lt;span&gt;nil&lt;/span&gt; {
&lt;span&gt;log&lt;/span&gt;.&lt;span&gt;Fatal&lt;/span&gt;(&lt;span&gt;&quot;Error: &quot;&lt;/span&gt;, &lt;span&gt;err&lt;/span&gt;.&lt;span&gt;Error&lt;/span&gt;())
}
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&quot;å®é™…è¿è¡Œ&quot;&gt;å®é™…è¿è¡Œ&lt;/h1&gt;
&lt;p&gt;æœ€å°å¯ç”¨çš„å®ç°å®Œæˆå•¦! æ¥å®é™…è¿è¡Œä¸‹å§. å°±ç”¨ Jsonnet åº“ä¸­çš„ä¾‹å­æ¥çœ‹çœ‹æ•ˆæœ.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;# åœ¨ç¬¬ä¸€ä¸ªå‘½ä»¤è¡Œä¸­å¯åŠ¨æœåŠ¡å™¨&lt;/span&gt;
$ go build main.go &lt;span&gt;&amp;amp;&amp;amp;&lt;/span&gt; main web -repo&lt;span&gt;=&lt;/span&gt;https://github.com/google/jsonnet.git 

&lt;span&gt;# åœ¨ç¬¬äºŒä¸ªå‘½ä»¤è¡Œä¸­æŸ¥é…ç½®, ç”±äºè¦è®¿é—® GitHub ç¬¬ä¸€æ¬¡å¯èƒ½å¾ˆæ…¢&lt;/span&gt;
$ curl http://localhost:8080/master/examples/arith.jsonnet

&lt;span&gt;# æŸ¥è¯¢åˆ°çš„ç»“æœ&lt;/span&gt;
&lt;span&gt;{&lt;/span&gt;
   &lt;span&gt;&quot;concat_array&quot;&lt;/span&gt;: &lt;span&gt;[&lt;/span&gt;
      1,
      2,
      3,
      &lt;span&gt;4&lt;/span&gt;
   &lt;span&gt;]&lt;/span&gt;,
   &lt;span&gt;&quot;concat_string&quot;&lt;/span&gt;: &lt;span&gt;&quot;1234&quot;&lt;/span&gt;,
   &lt;span&gt;&quot;equality1&quot;&lt;/span&gt;: false,
   &lt;span&gt;&quot;equality2&quot;&lt;/span&gt;: true,
   &lt;span&gt;&quot;ex1&quot;&lt;/span&gt;: 1.6666666666666665,
   &lt;span&gt;&quot;ex2&quot;&lt;/span&gt;: 3,
   &lt;span&gt;&quot;ex3&quot;&lt;/span&gt;: 1.6666666666666665,
   &lt;span&gt;&quot;ex4&quot;&lt;/span&gt;: true,
   &lt;span&gt;&quot;obj&quot;&lt;/span&gt;: &lt;span&gt;{&lt;/span&gt;
      &lt;span&gt;&quot;a&quot;&lt;/span&gt;: 1,
      &lt;span&gt;&quot;b&quot;&lt;/span&gt;: 3,
      &lt;span&gt;&quot;c&quot;&lt;/span&gt;: &lt;span&gt;4&lt;/span&gt;
   &lt;span&gt;}&lt;/span&gt;,
   &lt;span&gt;&quot;obj_member&quot;&lt;/span&gt;: true,
   &lt;span&gt;&quot;str1&quot;&lt;/span&gt;: &lt;span&gt;&quot;The value of self.ex2 is 3.&quot;&lt;/span&gt;,
   &lt;span&gt;&quot;str2&quot;&lt;/span&gt;: &lt;span&gt;&quot;The value of self.ex2 is 3.&quot;&lt;/span&gt;,
   &lt;span&gt;&quot;str3&quot;&lt;/span&gt;: &lt;span&gt;&quot;ex1=1.67, ex2=3.00&quot;&lt;/span&gt;,
   &lt;span&gt;&quot;str4&quot;&lt;/span&gt;: &lt;span&gt;&quot;ex1=1.67, ex2=3.00&quot;&lt;/span&gt;,
   &lt;span&gt;&quot;str5&quot;&lt;/span&gt;: &lt;span&gt;&quot;ex1=1.67\nex2=3.00\n&quot;&lt;/span&gt;
&lt;span&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&quot;æ¥ä¸‹æ¥&quot;&gt;æ¥ä¸‹æ¥&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ç¬¬ä¸€éƒ¨åˆ†çš„å†…å®¹äº†.&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªæœ€å°å¯ç”¨çš„é…ç½®ä¸­å¿ƒ, æ²¡æœ‰ä»»ä½•å¤–éƒ¨ä¾èµ–, åªè¦ä¸€ä¸ªå‘½ä»¤å°±èƒ½å¯åŠ¨, çœ‹èµ·æ¥è¿˜æ˜¯ä¸é”™çš„.&lt;/p&gt;
&lt;p&gt;ä¸è¿‡è¿™ä¸ªå®ç°å…¶å®æ¯”è¾ƒç²—ç³™, è¿˜è¦ä¸å°‘æ”¹å–„æ‰èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒ. ç®€å•åˆ—ä¸¾ä¸€ä¸‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå¤šåˆ†æ”¯åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;æ”¯æŒå¤šæ ¼å¼è¾“å‡º&lt;/li&gt;
&lt;li&gt;å¹¶å‘è®¿é—®å®‰å…¨&lt;/li&gt;
&lt;li&gt;æ‰“åŒ… Docker é•œåƒ&lt;/li&gt;
&lt;li&gt;ç¯å¢ƒå˜é‡æ”¯æŒ&lt;/li&gt;
&lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›å°±ç­‰åé¢çš„æ–‡ç« é‡Œå®ç°å’¯, æ¯•ç«Ÿç¯‡å¹…å·²ç»å¾ˆé•¿äº†.&lt;/p&gt;
&lt;p&gt;æœ€å, è°¢è°¢é˜…è¯»! è§‰å¾—æœ‰æ”¶è·æ¬¢è¿ç‚¹èµ!&lt;/p&gt;
&lt;p&gt;æºç ä»“åº“åœ°å€å†™åœ¨å¼€å¤´äº†, è§‰å¾—æœ‰ç–‘é—®å¯ä»¥åœ¨æ–‡ç« ä¸‹é¢ç•™è¨€.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>d5dc4fbe0fa321befd9176351ab06242</guid>
<title>nocode å’Œ lowcode</title>
<link>https://toutiao.io/k/38r8iaa</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;ä»Šå¹´ä¸å°‘ä¸šåŠ¡å¼€å‘åƒçªç„¶è¢«å¼€äº†å…‰ä¸€æ ·å¼€å§‹è®² nocode å’Œ lowcodeï¼Œå¯ä»¥çœ‹å‡ºç°ä»Šçš„äº’è”ç½‘å¯èƒ½çœŸçš„æ˜¯ç¼–ä¸å‡ºä»€ä¹ˆå¥½æ•…äº‹äº†ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œï¼Œæˆ‘ä»¬å·²ç»è®²è¿‡è‡ªåŠ¨åŒ–ã€å¹³å°åŒ–å’Œä¸­å°åŒ–äº†ï¼Œä¸ç®¡ä¸šåŠ¡æ¨¡å¼æ€ä¹ˆå˜ï¼Œä¼ä¸šå†…æ€»è¿˜æ˜¯æœ‰ä¸€äº›å±€éƒ¨ç³»ç»Ÿæœ€ç»ˆèƒ½å¤ŸæŠŠå¼€å‘æ¨¡å¼æ²‰æ·€ä¸‹æ¥ï¼Œå˜æˆæ‹–æ‹–æ‹½æ‹½å°±å¯ä»¥è¿›è¡Œå˜æ›´çš„â€œç½‘é¡µåˆ¶ä½œå¤§å¸ˆâ€ç³»ç»Ÿã€‚&lt;/p&gt;&lt;p&gt;åƒé˜¿é‡Œè¿™æ ·çš„å…¬å¸ï¼Œä¸­å°è½åœ°å¹¶è¿­ä»£å¤šå¹´ä»¥åï¼Œæ ¸å¿ƒä¸šåŠ¡çš„æµç¨‹å˜åŒ–  å¹¶ä¸ä¼šæœ‰å¤ªå¤šçš„ç¼–ç ä»»åŠ¡ï¼Œä»å†…éƒ¨èµ„æ–™æ¥çœ‹ï¼Œå¥—ç”¨ä»¥å¾€çš„ä¸šåŠ¡æ¨¡å¼ï¼Œæ”¹æ”¹é…ç½®æˆ–è€…ä¸Šä¸Šæ´»åŠ¨ï¼ŒåŸºæœ¬ä¸éœ€è¦ç¨‹åºå‘˜å»åšå¼€å‘äº†ã€‚&lt;/p&gt;&lt;p&gt;ä¸ç®¡æˆ‘ä»¬åœ¨å“ªä¸ªå…¬å¸ï¼Œåªè¦æˆ‘ä»¬æŒ‰ç…§ã€Šåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­å¯»æ‰¾æŠ€æœ¯å«é‡ã€‹è¿™ç¯‡æ–‡ç« çš„æ€è·¯å»åšç³»ç»Ÿï¼Œæœ€ç»ˆä¸€å®šèƒ½å¤Ÿå°†å¤§éƒ¨åˆ†ç¹ççš„é‡å¤åŠ³åŠ¨åšåˆ°è‡ªåŠ¨åŒ–ã€‚äºŒå…«å®šå¾‹ï¼Œå°±æ˜¯å¯ä»¥å°†é‚£ 80% çš„é‡å¤åŠ³åŠ¨ç”¨ç•Œé¢åŒ–ã€ç³»ç»ŸåŒ–ã€æµç¨‹åŒ–çš„æ‰‹æ®µå®Œå…¨æ¶ˆç­æ‰ã€‚å‰©ä¸‹çš„ 20% éœ€æ±‚æ‰‹åŠ¨å¼€å‘ï¼Œç„¶åå†é€æ¸å°†é€šç”¨çš„é€»è¾‘å’ŒåŠŸèƒ½æ²‰æ·€è¿›æ¥ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœä½ åœ¨ä¼ä¸šå†…ç»å†è¿‡å®Œæ•´çš„ä¸­å°è¿­ä»£æµç¨‹ï¼Œä¹Ÿåº”è¯¥çŸ¥é“ä¸­å°æœ¬èº«ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œä¹‹å‰æˆ‘åœ¨ã€Šä¸­å°çš„æœ«è·¯ã€‹é‡Œå·²ç»å†™è¿‡ä¸€äº›ï¼Œlowcode å’Œ nocode æ‰€é¢ä¸´çš„é—®é¢˜å¾ˆå¤šå’Œä¸­å°ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥ç®€å•åœ°æŠŠæŠ½è±¡å’Œå°è£…åˆ†ä¸ºå¤šä¸ªå±‚æ¬¡ï¼š&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.5493333333333333&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Lq0XA1b7xbfercxH0RhlKVhC02TZWkbQgEXB4A935tkL1iaoumoYla2o0EcrMRwtBWALPUicEKXmQyahF6qCN1RA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;750&quot;/&gt;&lt;figcaption&gt;lowcode_level_dilemma&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å¯¹äºå£°ç§° nocode çš„ç³»ç»Ÿï¼ŒåŸºæœ¬ä¸Šä¸€å®šæ˜¯ä½äºæœ€ä¸Šå±‚çš„ï¼Œéœ€è¦å·²ç»é’ˆå¯¹é¢†åŸŸåšäº†å¾ˆå¤šç§¯ç´¯å’Œå»ºæ¨¡ï¼Œè¿™æ ·æ‰èƒ½å¥—ç”¨ä»¥å¾€çš„å•†ä¸šèƒ½åŠ›(åˆ«æƒ³å¤ªå¤æ‚ï¼Œå®é™…ä¸Šå¯èƒ½å°±æ˜¯ä¸€ä¸ªæ”¯ä»˜æ¥å£ï¼Œåªä¸è¿‡é‡Œé¢ä¸€å †ä»£ç )ã€‚è€Œå¯¹äº lowcodeï¼Œé™¤äº†è¦è€ƒè™‘èƒ½ç”¨ç•Œé¢åŒ–çš„æ–¹å¼æ­å»ºæµç¨‹ï¼Œè¿˜è¦è€ƒè™‘åœ¨éœ€è¦æ‰©å±•çš„æ—¶å€™ï¼ŒæŠŠä¸‹é¢é‚£å±‚ä¹Ÿæš´éœ²å‡ºæ¥ï¼Œèƒ½è®©ç¨‹åºå‘˜å»å†™ä»£ç ç»™ç³»ç»ŸåŠŸèƒ½æ‰“è¡¥ä¸ã€‚åŒæ—¶ä½ è¿˜å¾—èƒ½è®©è¿™éƒ¨åˆ†ä»£ç æœ€ç»ˆè½¬æˆå¯ä»¥çœ‹çš„ç•Œé¢å…ƒç´ ï¼Œå“ªæ€•åªæ˜¾ç¤ºæˆä¸ºä¸€ä¸ªâ€œå®šåˆ¶æµç¨‹â€ã€‚&lt;/p&gt;&lt;p&gt;ä»”ç»†çœ‹çœ‹ï¼Œè¿™äº›ä¹Ÿå¹¶ä¸æ˜¯ä»€ä¹ˆæ–°ä¸œè¥¿ï¼Œå¾ˆå¤š lowcode/nocode çš„å®ç°æ— éæ˜¯ dreamweaver + serverless çš„åç«¯æè¿° + bpm çš„æ‚ç³…ç³»ç»Ÿï¼Œäº’è”ç½‘å…¬å¸çš„ç¨‹åºå‘˜æœ‰å•¥å¯éª„å‚²çš„å‘¢ï¼Ÿ&lt;/p&gt;&lt;p&gt;äººå®¶æ¸¸æˆåœˆæ—©å°±æœ‰è¿™äº›ä¸œè¥¿äº†ï¼Œæˆ‘ç»™ä½ ä»¬ä¸¾å‡ ä¸ªä¾‹å­ï¼š&lt;/p&gt;&lt;h2&gt;super mario maker&lt;/h2&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.5629017447199265&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Lq0XA1b7xbfercxH0RhlKVhC02TZWkbQ4Q3zUJ4A6t3gIFEvqCibps4Jv14Mjmv1S4fMOjPAdU8ODeFawYX0pBQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1089&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;è¶…çº§é©¬é‡Œå¥¥åˆ¶é€ 2&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œè¶…çº§é©¬é‡Œå¥¥åˆ¶é€ å°±æ˜¯ä¸€ä¸ªéå¸¸éå¸¸ç®€å•çš„æ¸¸æˆå¼•æ“ï¼Œæ“ä½œæ–¹å¼å’Œç‰©ç†æ•ˆæœå·²ç»å†…ç½®å¥½äº†ï¼Œç”¨æˆ·è‡ªå·±ç®€å•æ‹–æ‹–æ‹½æ‹½å°±å¯ä»¥è®¾è®¡è‡ªå·±çš„å…³å¡ã€‚åœ¨ super mario maker 2 é‡Œï¼Œæœ‰å¾ˆå¤šå®˜æ–¹å…³å¡æ˜¯å®Œå…¨å¯ä»¥å¤åˆ¶å‡ºæ¥çš„ï¼Œæ¯”å¦‚&lt;span&gt;è¿™ä¸ªä¾‹å­&lt;/span&gt;&lt;span&gt;[1]&lt;/span&gt;ã€‚&lt;/p&gt;&lt;p&gt;å½“ç„¶ç”¨ç›´è§‰ä¹Ÿå¯ä»¥æ¨æµ‹å‡ºæ¥ï¼Œè¿™ä¸ªå·¥å…·è‚¯å®šä¸èƒ½æŠŠæ‰€æœ‰ä»£ç èƒ½å¹²çš„äº‹æƒ…éƒ½å¹²äº†ï¼Œæ¯•ç«Ÿç›´æ¥ä¸Šæ‰‹å†™ä»£ç å‡ ä¹æ˜¯ä¸‡èƒ½çš„ã€‚ä½†è¿™ä¸å¦¨ç¢ç©å®¶åœ¨è¿™ä¸ªæ¸¸æˆé‡Œå‘æŒ¥è‡ªå·±çš„åˆ›æ„ï¼Œåšå‡ºé‚£äº›è¿å®˜æ–¹åˆ¶ä½œè€…éƒ½æ‹æ¡ˆå«ç»çš„åˆ›æ„ã€‚&lt;/p&gt;&lt;h2&gt;é™„å¸¦å¯¼èˆª&lt;/h2&gt;&lt;p&gt;&lt;span&gt;é™„å¸¦å¯¼èˆª&lt;/span&gt;&lt;span&gt;[2]&lt;/span&gt;Â æ˜¯ä»»å¤©å ‚æœ€è¿‘è¦å‘å”®çš„ä¸€ä¸ªæ¸¸æˆ(è¯¯)ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªæ¸¸æˆå¼•æ“ï¼Œåªä¸è¿‡è¿™æ¬¡ä½ èƒ½ç”¨ä»–æ¥åˆ¶ä½œæ›´å¤šç±»å‹æ¸¸æˆäº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.56171875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Lq0XA1b7xbfercxH0RhlKVhC02TZWkbQYP3OXkEnW09dfbH8c1KKkJeVInApYB8gwia21CEibGdoiaTC0xibDgnquQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;figure&gt;&lt;figcaption&gt;é™„å¸¦å¯¼èˆª&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;è¿™ä¹Ÿæ˜¯å°†æ¸¸æˆå¼•æ“æœ¬èº«å¤§å¹…ç®€åŒ–ï¼Œé™ä½é—¨æ§›ï¼Œè®©æ²¡æœ‰ç¼–ç¨‹åŸºç¡€çš„äººèƒ½å»åšè½¯ä»¶é¡¹ç›®çš„ä¸€ç§å°è¯•ï¼Œå˜¿ï¼Œä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç§æ—¢è§†æ„Ÿï¼Ÿ&lt;/p&gt;&lt;h2&gt;RPG Maker MV&lt;/h2&gt;&lt;p&gt;&lt;span&gt;rpg maker mv&lt;/span&gt;&lt;span&gt;[3]&lt;/span&gt;Â æ˜¯ä¸“é—¨ç»™ rpg ç±»æ¸¸æˆå‡†å¤‡çš„è½¯ä»¶ã€‚ä¹Ÿä¸éœ€è¦ç”¨æˆ·æœ‰ç¼–ç¨‹åŸºç¡€ï¼Œå°±å¯ä»¥åˆ¶ä½œè‡ªå·±çš„ rpg æ¸¸æˆï¼Œä¹‹å‰åœ¨è¿™å¥—ç³»ç»Ÿä¸Šä¹Ÿè¡ç”Ÿå‡ºäº†ä¸å°‘ä¼˜ç§€ä½œå“ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.296875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/Lq0XA1b7xbfercxH0RhlKVhC02TZWkbQTO4ib1npumtHAWicPB9iaXicb3XZTG7SnrL14jzboUXwT5KFJ2DCGzMMWg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;ç†å¿µä¸€ç›´éƒ½æœ‰ï¼Œåªä¸è¿‡äººå®¶æ¸¸æˆåœˆçš„äººä¹Ÿæ²¡æ€ä¹ˆå®£ä¼ ï¼Œä¸çŸ¥é“äº’è”ç½‘åœˆçš„äººæ¿€åŠ¨ä¸ªä»€ä¹ˆåŠ²ã€‚å¯èƒ½çœŸçš„æ˜¯æŠ•èµ„äººçš„é’±æ²¡å¤„èŠ±äº†å§ã€‚&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;[1]&lt;/span&gt;&lt;p&gt;è¿™ä¸ªä¾‹å­:Â &lt;em&gt;https://www.youtube.com/watch?v=sZguQ9zxqJg&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2]&lt;/span&gt;&lt;p&gt;é™„å¸¦å¯¼èˆª:Â &lt;em&gt;https://b23.tv/T2xqtA&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[3]&lt;/span&gt;&lt;p&gt;rpg maker mv:Â &lt;em&gt;https://www.bilibili.com/video/BV18T4y1L7V9&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>75a79b43b7df26ef193c2a40341238e1</guid>
<title>å®ç°æ— é™ç¼“å­˜çš„ channel</title>
<link>https://toutiao.io/k/jggpayh</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;article-entry&quot; itemprop=&quot;articleBody&quot;&gt;
      
      
      
      &lt;p&gt;Goè¯­è¨€çš„channelåˆä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯æ— ç¼“å­˜çš„channelï¼Œä¸€ç§æ˜¯æœ‰ç¼“å­˜çš„bufferï¼Œè¿™ä¸¤ç§ç±»å‹çš„channelå¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œä½†æ˜¯å¯¹äºæœ‰ç¼“å­˜çš„channel,å®ƒçš„ç¼“å­˜é•¿åº¦åœ¨åˆ›å»ºchannelçš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ï¼Œä¸­é—´ä¸èƒ½æ‰©ç¼©å®¹ï¼Œè¿™å¯¼è‡´åœ¨ä¸€äº›åœºæ™¯ä¸‹ä½¿ç”¨æœ‰é—®é¢˜ï¼Œæˆ–è€…è¯´ä¸å¤ªé€‚åˆç‰¹å®šçš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;a id=&quot;more&quot;/&gt;
&lt;p&gt;æˆ‘ä¸ºä»€ä¹ˆçªç„¶è°ˆèµ·è¿™ä¸ªæ— é™ç¼“å­˜çš„channelå‘¢ï¼Ÿç¬¬ä¸€ï¼Œå®ƒæ˜¯å¯¹æˆ‘çš„æå®¢ä¸“æ &lt;a href=&quot;https://time.geekbang.org/column/intro/355&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Goå¹¶å‘ç¼–ç¨‹å®æˆ˜è¯¾&lt;/a&gt;çš„è¡¥å……ï¼Œå¦å¤–ä¸»è¦æ˜¯æˆ‘æœ€è¿‘åœ¨reviewå…¬å¸ä¸€ä½åŒäº‹çš„ä»£ç æ—¶ï¼Œæˆ‘çš„æŸç§è®¾è®¡æ€è·¯å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä½¿ç”¨æ— é™ç¼“å­˜çš„channelçš„è¯ï¼Œè¿™ä¸ªé—®é¢˜å°±ä¼šè¿åˆƒè€Œè§£äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä½åŒäº‹çš„è®¾è®¡å¤§æ¦‚æ˜¯è¿™æ ·å­çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€ä¸ªdispatcheråŒ…å«ä¸€ä¸ªchannel, é‡Œé¢å­˜æ”¾å¾…å¤„ç†çš„url&lt;/li&gt;
&lt;li&gt;ä¸€å †workerä»channelä¸­è¯»å–ä»»åŠ¡ï¼Œä¸‹è½½è§£æç½‘é¡µï¼Œå¹¶æå–å…¶ä¸­é“¾æ¥ï¼Œå†æŠŠé“¾æ¥æ”¾å…¥åˆ°dispatcher.channelä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä½åŒæ—¶ä½¿ç”¨äº†æ¯”è¾ƒå¤æ‚çš„sync.Mutexå’Œsync.Condï¼Œå¹¶ä¸”å®šä¹‰äº†ä¸€å †å¹¶å‘çš„æ–¹æ³•å¤„ç†é€»è¾‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸è°ˆè®ºè¿™ä½åŒäº‹çš„è®¾è®¡ï¼Œåªè°ˆè°ˆæˆ‘çš„é”™è¯¯æƒ³æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘reviewè¿™æ®µä»£ç çš„æ—¶å€™æƒ³ï¼Œå¦‚æœæ¯ä¸ª workerå¯åŠ¨ä¸€ä¸ªgoroutine,å¤„ç†urlï¼Œç„¶åæŠŠé“¾æ¥å†æ”¾å…¥åˆ°channelä¸­å³å¯ï¼Œä¸ç”¨å¤æ‚çš„ Mutex+Condç­‰ï¼Œä½†æ˜¯æˆ‘çŠ¯äº†ä¸€ä¸ªé”™è¯¯ï¼Œé‚£å°±æ˜¯å¦‚æœå½“å‰channelå·²ç»æ»¡äº†ï¼Œé‚£ä¹ˆè¿™äº›workeréƒ½ä¸èƒ½æŠŠè§£æçš„ç»“æœæ”¾å…¥åˆ°channelä¸­ï¼Œéƒ½è¢«&quot;é˜»å¡&quot;ä½äº†ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å¯ç”¨çš„workerä»channelä¸­æ¶ˆè´¹urlã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œä½ å¯ä»¥è¯´å¯ä»¥åˆ›å»ºä¸€ä¸ªbufferéå¸¸å¤§çš„channelï¼Œé¿å…è¢«å¡æ»¡ï¼Œä½†æ˜¯,ç¬¬ä¸€,bufferéå¸¸å¤§çš„channelå ç”¨çš„å†…å­˜ä¹Ÿéå¸¸å¤§ï¼Œç¬¬äºŒï¼Œå¤šå¤§åˆé€‚ï¼Ÿå…³é”®ä½ ä¸èƒ½ä¿è¯channelä¸ä¼šæ»¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰ä¸€ä¸ªæ— é™ç¼“å­˜é•¿åº¦çš„bufferå°±å¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;2017å¹´ï¼Œæœ‰åŒå­¦åƒGoå®˜æ–¹æå‡ºè¿™ä¹ˆä¸€ä¸ªéœ€æ±‚(&lt;a href=&quot;https://github.com/golang/go/issues/20352&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;#20352&lt;/a&gt;),å¸Œæœ›èƒ½å¤Ÿæä¾›ä¸€ä¸ªæ— é™å®¹é‡çš„bufferï¼Œç»è¿‡å†—é•¿çš„è®¨è®ºï¼ŒGoä¸ä¼šä¸ºè¿™ä¸ª&quot;ç¨€æœ‰&quot;çš„åœºæ™¯æä¾›ä¸€ç§å®ç°ï¼Œå¹¶ä¸”å»ºè®®å¤§å®¶å®ç°è¿™æ ·çš„ä¸€ä¸ªåº“ï¼Œé€šè¿‡ç¬¬ä¸‰åº“çš„æ–¹å¼å¤„ç†è¿™ç§åœºæ™¯ï¼Œè€Œä¸”Griesemeræä¾›äº†ä¸€ä¸ªæ€è·¯ï¼Œé€šè¿‡ringbufferå®ç°ç¼“å­˜æ¥å®ç°è¿™æ ·çš„channelã€‚&lt;/p&gt;
&lt;p&gt;å¾€ç½‘ä¸Šæœ‰ä¸¤ç§å®ç°&lt;a href=&quot;https://stackoverflow.com/questions/41906146/why-go-channels-limit-the-buffer-size&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Why Go channels limit the buffer size&lt;/a&gt;å’Œ&lt;a href=&quot;https://medium.com/capital-one-tech/building-an-unbounded-channel-in-go-789e175cd2cd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Building an Unbounded Channel in Go&lt;/a&gt;,è¿™ä¸¤ç§å®ç°ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼Œæˆ‘åœ¨ç¬¬ä¸€ç§å®ç°çš„åŸºç¡€ä¸Šï¼Œå°è£…äº†ä¸€ä¸ªåº“: &lt;a href=&quot;https://github.com/smallnest/chanx&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;chanx&lt;/a&gt;,æ¥æä¾›é€šç”¨çš„æ— é™ç¼“å­˜çš„channelã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/smallnest/chanx&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;chanx&lt;/a&gt;, ä½ å¯ä»¥starè¿™ä¸ªåº“ï¼Œæ”¾å…¥åˆ°ä½ çš„ä»£ç åº“ä¸­ï¼Œè¯´ä¸å®šå“ªä¸€å¤©å®ƒå°±å¯èƒ½å¸®ä½ è§£ç‡ƒçœ‰ä¹‹æ€¥ã€‚å¹¶ä¸”æˆ‘å·²ç»å‡†å¤‡å¥½äº†æ³›å‹çš„è®¾è®¡ï¼Œä¸€æ—¦Goæ³›å‹å¯ç”¨ï¼Œæˆ‘å°±ä¼šæŠŠå®ƒæ”¹æˆæ³›å‹çš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ç¼“å­˜æ— é™çš„channelæ‹¥æœ‰ä¸‹é¢çš„ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸ä¼šé˜»å¡write&lt;/strong&gt;ã€‚ å®ƒæ€»æ˜¯èƒ½å¤„ç†writeçš„æ•°æ®ï¼Œæˆ–è€…æ”¾å…¥åˆ°å¾…è¯»å–çš„channelä¸­ï¼Œæˆ–è€…æ”¾å…¥åˆ°ç¼“å­˜ä¸­&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ— æ•°æ®æ—¶readä¼šè¢«é˜»å¡&lt;/strong&gt;ã€‚å½“æ²¡æœ‰å¯è¯»çš„æ•°æ®æ—¶ï¼Œä»channelä¸­è¯»å–çš„goroutineä¼šè¢«é˜»å¡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯»å†™éƒ½æ˜¯é€šè¿‡channelæ“ä½œ&lt;/strong&gt;ã€‚ å†…éƒ¨çš„ç¼“å­˜ä¸ä¼šæš´éœ²å‡ºæ¥&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èƒ½å¤ŸæŸ¥è¯¢å½“å‰å¾…è¯»å–çš„æ•°æ®æ•°é‡&lt;/strong&gt;ã€‚å› ä¸ºç¼“å­˜ä¸­å¯èƒ½ä¹Ÿæœ‰å¾…å¤„ç†çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦è¿”å›len(buffer)+len(chan)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³é—­channelåï¼Œè¿˜æœªè¯»å–çš„channelè¿˜æ˜¯èƒ½å¤Ÿè¢«è¯»å–ï¼Œè¯»å–å®Œä¹‹åæ‰èƒ½å‘ç°channelå·²ç»å®Œæ¯•&lt;/strong&gt;ã€‚è¿™å’Œæ­£å¸¸çš„channelçš„é€»è¾‘æ˜¯ä¸€æ ·çš„ï¼Œè¿™ç§æƒ…å†µå«&quot;drain&quot;æœªè¯»çš„æ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬ä¸èƒ½ä¿®æ”¹å†…éƒ¨çš„channelç»“æ„ï¼Œä¹Ÿä¸èƒ½é‡è½½ chan &amp;lt;- å’Œ &amp;lt;- chan æ“ä½œç¬¦,æ‰€ä»¥æˆ‘ä»¬åªèƒ½é€šè¿‡ä¸¤ä¸ªchannelçš„æ–¹å¼å°è£…ä¸€ä¸ªæ•°æ®ç»“æ„,æ¥æä¾›è¯»å†™ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ•°æ®ç»“æ„ä¸º:&lt;/p&gt;
&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;p class=&quot;line&quot;&gt;1&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;2&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;3&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;4&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;5&lt;/p&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;type&lt;/span&gt; UnboundedChan &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;In     &lt;span class=&quot;keyword&quot;&gt;chan&lt;/span&gt;&amp;lt;- T &lt;span class=&quot;comment&quot;&gt;// channel for write&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;Out    &amp;lt;-&lt;span class=&quot;keyword&quot;&gt;chan&lt;/span&gt; T &lt;span class=&quot;comment&quot;&gt;// channel for read&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;buffer []T      &lt;span class=&quot;comment&quot;&gt;// buffer&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;å…¶ä¸­&lt;code&gt;In&lt;/code&gt;è¿™ä¸ªchannelç”¨æ¥å†™å…¥æ•°æ®ï¼Œè€Œ&lt;code&gt;Out&lt;/code&gt;è¿™ä¸ªchannelç”¨æ¥è¯»å–æ•°æ®ã€‚ä½ å¯ä»¥close Inè¿™ä¸ªchannel,ç­‰æ‰€æœ‰çš„æ•°æ®éƒ½è¯»å–å®Œåï¼ŒOut channelä¹Ÿä¼šè¢«è‡ªåŠ¨å…³é—­ã€‚ ç”¨æˆ·æ˜¯ä¸èƒ½è‡ªå·±å…³é—­&lt;code&gt;Out&lt;/code&gt;è¿™ä¸ªchannelçš„ï¼Œä½ ä¹Ÿå…³é—­ä¸äº†ï¼Œå› ä¸ºå®ƒæ˜¯&lt;code&gt;&amp;lt;-chan&lt;/code&gt;ç±»å‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥é€šè¿‡&lt;code&gt;Len&lt;/code&gt;æ–¹æ³•å¾—åˆ°æ‰€æœ‰å¾…è¯»å–çš„æ•°æ®çš„é•¿åº¦ï¼Œä¹Ÿå¯ä»¥é€šè¿‡&lt;code&gt;BufLen&lt;/code&gt;åªè·å–ç¼“å­˜ä¸­çš„æ•°æ®çš„é•¿åº¦ï¼Œä¸åŒ…å«å¤–å‘&lt;code&gt;Out&lt;/code&gt; channelä¸­æ•°æ®çš„é•¿åº¦ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;p class=&quot;line&quot;&gt;1&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;2&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;3&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;4&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;5&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;6&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;7&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;8&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;9&lt;/p&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Len returns len of Out plus len of buffer.&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; (c UnboundedChan) Len() &lt;span class=&quot;typename&quot;&gt;int&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;len&lt;/span&gt;(c.buffer) + &lt;span class=&quot;built_in&quot;&gt;len&lt;/span&gt;(c.Out)&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// BufLen returns len of the buffer.&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; (c UnboundedChan) BufLen() &lt;span class=&quot;typename&quot;&gt;int&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;len&lt;/span&gt;(c.buffer)&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;é‚£ä¹ˆé‡ç‚¹æ¥äº†ï¼Œä¸»è¦çš„é€»è¾‘çš„å®ç°å¦‚ä¸‹ï¼Œæˆ‘åœ¨ä»£ç ä¸­åŠ äº†æ³¨é‡Šï¼Œé€šè¿‡æ³¨é‡Šå’Œä»£ç ä½ å°±å¯ä»¥å¾ˆå¥½çš„ç†è§£æ•´ä¸ªçš„å®ç°é€»è¾‘:&lt;/p&gt;
&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;p class=&quot;line&quot;&gt;1&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;2&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;3&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;4&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;5&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;6&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;7&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;8&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;9&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;10&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;11&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;12&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;13&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;14&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;15&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;16&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;17&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;18&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;19&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;20&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;21&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;22&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;23&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;24&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;25&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;26&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;27&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;28&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;29&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;30&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;31&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;32&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;33&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;34&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;35&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;36&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;37&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;38&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;39&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;40&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;41&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;42&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;43&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;44&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;45&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;46&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;47&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;48&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;49&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;50&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;51&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;52&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;53&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;54&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;55&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;56&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;57&lt;/p&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; NewUnboundedChan(initCapacity &lt;span class=&quot;typename&quot;&gt;int&lt;/span&gt;) UnboundedChan {&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// åˆ›å»ºä¸‰ä¸ªå­—æ®µå’Œæ— é™ç¼“å­˜çš„chanç±»å‹&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;in := &lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;chan&lt;/span&gt; T, initCapacity)&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;out := &lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;chan&lt;/span&gt; T, initCapacity)&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch := UnboundedChan{In: in, Out: out, buffer: &lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt;([]T,&lt;span class=&quot;number&quot;&gt; 0&lt;/span&gt;, initCapacity)}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// é€šè¿‡ä¸€ä¸ªgoroutine,ä¸æ–­åœ°ä»inä¸­è¯»å–å‡ºæ¥æ•°æ®ï¼Œæ”¾å…¥åˆ°outæˆ–è€…bufferä¸­&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt;() {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;close&lt;/span&gt;(out) &lt;span class=&quot;comment&quot;&gt;// inå…³é—­ï¼Œæ•°æ®è¯»å–å®Œåä¹ŸæŠŠoutå…³é—­&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;loop:&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;val, ok := &amp;lt;-in &lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !ok { &lt;span class=&quot;comment&quot;&gt;// å¦‚æœinå·²ç»è¢«closed, é€€å‡ºloop&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt; loop&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¦åˆ™å°è¯•æŠŠä»inä¸­è¯»å–å‡ºæ¥çš„æ•°æ®æ”¾å…¥åˆ°outä¸­&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; out &amp;lt;- val: &lt;span class=&quot;comment&quot;&gt;//æ”¾å…¥æˆåŠŸï¼Œè¯´æ˜outåˆšæ‰è¿˜æ²¡æœ‰æ»¡ï¼Œbufferä¸­ä¹Ÿæ²¡æœ‰é¢å¤–çš„æ•°æ®å¾…å¤„ç†ï¼Œæ‰€ä»¥å›åˆ°loopå¼€å§‹&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;:&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¦‚æœoutå·²ç»æ»¡äº†ï¼Œéœ€è¦æŠŠæ•°æ®æ”¾å…¥åˆ°ç¼“å­˜ä¸­&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer = &lt;span class=&quot;built_in&quot;&gt;append&lt;/span&gt;(ch.buffer, val)&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// å¤„ç†ç¼“å­˜ï¼Œä¸€ç›´å°è¯•æŠŠç¼“å­˜ä¸­çš„æ•°æ®æ”¾å…¥åˆ°out,ç›´åˆ°ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®äº†,&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// ä¸ºäº†é¿å…é˜»å¡ä½in channel,è¿˜è¦å°è¯•ä»inä¸­è¯»å–æ•°æ®ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™outæ˜¯æ»¡çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥æŠŠæ•°æ®æ”¾å…¥åˆ°ç¼“å­˜ä¸­&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;len&lt;/span&gt;(ch.buffer) &amp;gt;&lt;span class=&quot;number&quot;&gt; 0&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; val, ok := &amp;lt;-in: &lt;span class=&quot;comment&quot;&gt;// ä»inè¯»å–æ•°æ®ï¼Œæ”¾å…¥åˆ°ç¼“å­˜ä¸­ï¼Œå¦‚æœinè¢«closed, é€€å‡ºloop&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !ok { &lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt; loop&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer = &lt;span class=&quot;built_in&quot;&gt;append&lt;/span&gt;(ch.buffer, val)&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; out &amp;lt;- ch.buffer&lt;span class=&quot;number&quot;&gt;[0&lt;/span&gt;]: &lt;span class=&quot;comment&quot;&gt;// æŠŠç¼“å­˜ä¸­æœ€è€çš„æ•°æ®æ”¾å…¥åˆ°outä¸­ï¼Œå¹¶ç§»å‡ºç¬¬ä¸€ä¸ªå…ƒç´ &lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer = ch.buffer&lt;span class=&quot;number&quot;&gt;[1&lt;/span&gt;:]&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;len&lt;/span&gt;(ch.buffer) ==&lt;span class=&quot;number&quot;&gt; 0&lt;/span&gt; { &lt;span class=&quot;comment&quot;&gt;// é¿å…å†…å­˜æ³„éœ². å¦‚æœç¼“å­˜å¤„ç†å®Œäº†ï¼Œæ¢å¤æˆåŸå§‹çš„çŠ¶æ€&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer = &lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt;([]T,&lt;span class=&quot;number&quot;&gt; 0&lt;/span&gt;, initCapacity)&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// inè¢«å…³é—­ï¼Œé€€å‡ºloopåï¼Œbufferä¸­å¯èƒ½è¿˜æœ‰æœªå¤„ç†çš„æ•°æ®ï¼Œéœ€è¦æŠŠå®ƒä»¬å¡å…¥åˆ°outä¸­&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// è¿™ä¸ªé€»è¾‘å«åš&quot;drain&quot;ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// è¿™ä¸€æ®µé€»è¾‘å¤„ç†å®Œåï¼Œå°±å¯ä»¥æŠŠoutå…³é—­æ‰äº†&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;len&lt;/span&gt;(ch.buffer) &amp;gt;&lt;span class=&quot;number&quot;&gt; 0&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;out &amp;lt;- ch.buffer&lt;span class=&quot;number&quot;&gt;[0&lt;/span&gt;]&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer = ch.buffer&lt;span class=&quot;number&quot;&gt;[1&lt;/span&gt;:]&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}()&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ch&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;è¿™ä¸€æ®µçš„é€»è¾‘è¿˜æ˜¯å¾ˆæ¸…æ™°çš„ï¼Œå°±æ˜¯ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œå®ƒä¹Ÿæ˜¯å­¦ä¹ channelä½¿ç”¨çš„ä¸€ä¸ªå¾ˆå¥½çš„ç´ æã€‚&lt;/p&gt;
&lt;h2 id=&quot;5æœˆ13æ—¥æ›´æ–°&quot;&gt;5æœˆ13æ—¥æ›´æ–°&lt;/h2&gt;
&lt;p&gt;ä»Šå¤©æ­£å¥½å‡ºå·®ï¼Œåœ¨é«˜é“ä¸Šæ¼«é•¿çš„5ä¸ªå¤šå°æ—¶æ²¡æœ‰äº‹æƒ…åšï¼Œæ‰€ä»¥æˆ‘æ‹¿èµ·ç¬”è®°æœ¬å¹²äº†ä¸¤ä»¶äº‹æƒ…ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯å¯¹è¿™ä¸ªæ— é™ç¼“å­˜çš„channelåšäº†ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬èº«è¿™ä¸ªæ— é™ç¼“å­˜çš„channelçš„è®¾è®¡éå¸¸ç®€æ´ï¼Œå”¯ä¸€æœ‰ä¸€ç‚¹æˆ‘ä¸å¤ªæ»¡æ„çš„æ˜¯å®ƒçš„bufferä¸èƒ½é‡ç”¨, è¿™å’Œ&lt;code&gt;ch.buffer = ch.buffer[1:]&lt;/code&gt;çš„å¤„ç†æœ‰å…³ç³»,æœ‰æ—¶å€™æ˜æ˜åº•å±‚çš„æ•°ç»„å¾ˆå¤§ï¼Œä½†æ˜¯è¿˜ä¸å¾—ä¸é‡æ–°ç”Ÿæˆæ–°çš„æ•°æ®ï¼Œå¯¼è‡´å †åˆ†é…é¢‘æ¬¡æ¯”è¾ƒå¤šã€‚&lt;/p&gt;
&lt;p&gt;ä¾ç…§Goä¸‰å·¨å¤´ä¹‹ä¸€çš„è®¾è®¡ï¼Œåº•å±‚bufferæœ€å¥½é‡‡ç”¨ringbufferçš„å®ç°æ–¹å¼ï¼Œå¦‚æœbufferæ»¡äº†åº”è¯¥èƒ½&lt;a href=&quot;https://github.com/golang/go/issues/20352#issuecomment-365494616&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;è‡ªåŠ¨æ‰©å®¹&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Such a library should do well in cases of very fast, &quot;bursty&quot; messages. A large enough buffered channel should be able to absorb bursts while a fast dedicated goroutine drains the channel into a ring buffer from which the messages are delivered at a slower pace to the final consumer of the messages. That ring buffer will need to be efficiently implemented, and will need to be able to grow efficiently (irrespective of size) and that will require some careful engineering. Better to leave that code to a library that can be tuned as needed than baking it into the runtime (and then possibly being at the mercy of release cycles).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘åˆå®ç°äº†ä¸€ä¸ª&lt;a href=&quot;https://github.com/smallnest/chanx/blob/main/ringbuffer.go&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ringbuffer&lt;/a&gt;,è¿™ä¸ªringbufferæ¯”è¾ƒç®€å•ï¼ŒåŸå› åœ¨è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦è€ƒè™‘å¹¶å‘çš„é—®é¢˜ï¼Œè¿™ä¸ªringbufferåªä¼šåœ¨ä¸€ä¸ªgoroutineä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒçš„å®ç°å°±éå¸¸çš„ç®€å•äº†ï¼Œéœ€è¦æ³¨æ„&quot;è¯»è¿½ä¸Šå†™&quot;ï¼Œä»¥åŠ&quot;å†™æ»¡&quot;è¿™ä¸¤ä¸ªè¾¹ç•Œé—®é¢˜å°±å¥½äº†ã€‚é€šè¿‡ä½¿ç”¨ringbufferï¼Œä¸Šé¢çš„å®ç°å°±å¯ä»¥æ›´æ”¹ä¸ºä¸‹é¢çš„ä»£ç ï¼Œå¯ä»¥è¿›ä¸€æ­¥å‡å°‘å†™çˆ†å‘(burst)çš„æ—¶å€™åˆ†é…è¿‡å¤šçš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;p class=&quot;line&quot;&gt;1&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;2&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;3&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;4&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;5&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;6&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;7&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;8&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;9&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;10&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;11&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;12&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;13&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;14&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;15&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;16&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;17&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;18&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;19&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;20&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;21&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;22&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;23&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;24&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;25&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;26&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;27&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;28&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;29&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;30&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;31&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;32&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;33&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;34&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;35&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;36&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;37&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;38&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;39&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;40&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;41&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;42&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;43&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;44&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;45&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;46&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;47&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;48&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;49&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;50&lt;/p&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; NewUnboundedChan(initCapacity &lt;span class=&quot;typename&quot;&gt;int&lt;/span&gt;) UnboundedChan {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;in := &lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;chan&lt;/span&gt; T, initCapacity)&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;out := &lt;span class=&quot;built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;chan&lt;/span&gt; T, initCapacity)&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch := UnboundedChan{In: in, Out: out, buffer: NewRingBuffer(initCapacity)}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt;() {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;close&lt;/span&gt;(out)&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;loop:&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;val, ok := &amp;lt;-in&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !ok { &lt;span class=&quot;comment&quot;&gt;// in is closed&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt; loop&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// out is not full&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; out &amp;lt;- val:&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;:&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// out is full&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer.Write(val)&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; !ch.buffer.IsEmpty() {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; val, ok := &amp;lt;-in:&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !ok { &lt;span class=&quot;comment&quot;&gt;// in is closed&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt; loop&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer.Write(val)&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; out &amp;lt;- ch.buffer.Peek():&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer.Pop()&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ch.buffer.IsEmpty() &amp;amp;&amp;amp; ch.buffer.size &amp;gt; ch.buffer.initialSize { &lt;span class=&quot;comment&quot;&gt;// after burst&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer.Reset()&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// drain&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; !ch.buffer.IsEmpty() {&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;out &amp;lt;- ch.buffer.Pop()&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;ch.buffer.Reset()&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}()&lt;/p&gt;&lt;p class=&quot;line&quot;/&gt;&lt;p class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; ch&lt;/p&gt;&lt;p class=&quot;line&quot;&gt;}&lt;/p&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


      
    &lt;/div&gt;
    &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>373d1803e2963ed7e961c262964b06ba</guid>
<title>åœ¨ RecyclerView ä¸­ä½¿ç”¨ ListAdapter</title>
<link>https://toutiao.io/k/22qf866</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;RichText ztext Post-RichText&quot;&gt;&lt;p&gt;æœ¬æ–‡æ˜¯ä»‹ç» RecyclerView å…¥é—¨ &lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/mp/appmsgalbum%3F__biz%3DMzk0NDIwMTExNw%3D%3D%26action%3Dgetalbum%26album_id%3D1866978093609893891%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ç³»åˆ—æ–‡ç« &lt;/a&gt;&lt;/b&gt; çš„ç¬¬äºŒç¯‡ã€‚å¦‚æœæ‚¨å·²ç»å¯¹åˆ›å»º RecyclerView æœ‰äº†ä¸€å®šçš„è®¤è¯†ï¼Œè¯·ç»§ç»­é˜…è¯»æœ¬æ–‡ã€‚å¦‚æœå°šæœªç†Ÿæ‚‰ï¼Œå»ºè®®æ‚¨é¦–å…ˆé˜…è¯»æœ¬ç³»åˆ—ä¸­çš„ &lt;b&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/363343211&quot; class=&quot;internal&quot;&gt;ç¬¬ä¸€ç¯‡æ–‡ç« &lt;/a&gt;&lt;/b&gt;ã€‚&lt;/p&gt;&lt;p&gt;RecyclerView å¯ä»¥å¾ˆé«˜æ•ˆåœ°æ˜¾ç¤ºåˆ—è¡¨æ•°æ®ã€‚å¯¹äºé™æ€çš„åˆ—è¡¨æ•°æ®ï¼Œé»˜è®¤çš„ adapter è¶³çŸ£ã€‚ç„¶è€Œï¼Œåœ¨å¤šæ•°æƒ…å†µä¸‹ï¼ŒRecyclerView çš„æ•°æ®æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚æ‹¿&lt;b&gt;å¤‡å¿˜å·¥ä½œ&lt;/b&gt;çš„åº”ç”¨ä¸¾ä¾‹: ä¸»è¦æ“ä½œæ˜¯æ·»åŠ æ–°çš„å·¥ä½œäº‹é¡¹ï¼Œåˆ é™¤å·²ç»å®Œæˆçš„å·¥ä½œäº‹é¡¹ã€‚notifyItemInserted() å¯ä»¥å°†æ–°ä»»åŠ¡æ·»åŠ åˆ°æŒ‡å®šä½ç½®ï¼Œä½†æ˜¯éœ€è¦åˆ é™¤å…ƒç´ çš„æ—¶å€™é—®é¢˜å°±æ¥äº†ï¼ŒnotifyItemRemoved() åªæœ‰åœ¨æ‚¨å·²çŸ¥å¾…åˆ ä»»åŠ¡çš„ä½ç½®æ—¶æ‰æœ‰æ•ˆæœã€‚è™½ç„¶å¯ä»¥å†™ä»£ç æ¥ç¡®å®šå¾…åˆ ä»»åŠ¡çš„ä½ç½®ï¼Œç„¶åè°ƒç”¨ notifyItemRemoved()ï¼Œä½†æ˜¯ä»£ç ä¼šå˜å¾—éå¸¸ç¹æ‚ã€‚è°ƒç”¨ notifyDataSetChanged() ä¹Ÿæ˜¯ä¸€ä¸ªåŠæ³•ï¼Œä½†æ˜¯å®ƒä¼šé‡ç»˜æ•´ä¸ªè§†å›¾ï¼ŒåŒ…æ‹¬æ•°æ®æœªå‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†ï¼Œä½¿å¾—è¯¥æ“ä½œçš„ä»£ä»·å˜å¤§ã€‚è€Œ ListAdapter å¯ä»¥å¤„ç†å…ƒç´ çš„æ·»åŠ å’Œåˆ é™¤è€Œæ— éœ€é‡ç»˜è§†å›¾ï¼Œç”šè‡³å¯ä»¥ä¸ºå˜åŒ–æ·»åŠ åŠ¨ç”»æ•ˆæœã€‚&lt;/p&gt;&lt;p&gt;ä½¿ç”¨ ListAdapter çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯: å½“æ·»åŠ æˆ–åˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥æ·»åŠ åŠ¨ç”»ã€‚è¿™æ ·ç”¨æˆ·å¯ä»¥å¾ˆç›´è§‚åœ°çœ‹åˆ°åˆ—è¡¨æ•°æ®çš„å˜åŒ–ã€‚è™½ç„¶æ²¡æœ‰ ListAdapter ä¹Ÿå¯ä»¥å®ç°åŠ¨ç”»æ•ˆæœï¼Œä½†æ˜¯è¿™å°±éœ€è¦å¼€å‘è€…è‡ªè¡Œå®ç°ï¼Œå¹¶ä¸”ç”±äºå¸¦æœ‰åŠ¨ç”»çš„è§†å›¾éœ€è¦é‡ç»˜ï¼Œæ‰€ä»¥æ— æ³•è¾¾åˆ°åŒæ ·çš„æ€§èƒ½è¡¨ç°ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-571c26aeec909985e2efa56f3f93d491_b.gif&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;318&quot; data-rawheight=&quot;712&quot; data-thumbnail=&quot;https://pic2.zhimg.com/v2-571c26aeec909985e2efa56f3f93d491_b.jpg&quot; class=&quot;content_image&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;318&quot; data-rawheight=&quot;712&quot; data-thumbnail=&quot;https://pic2.zhimg.com/v2-571c26aeec909985e2efa56f3f93d491_b.jpg&quot; class=&quot;content_image lazy&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-571c26aeec909985e2efa56f3f93d491_b.gif&quot;/&gt;&lt;figcaption&gt;æ·»åŠ å…ƒç´ çš„åŠ¨ç”»æ•ˆæœ&lt;/figcaption&gt;&lt;/figure&gt;&lt;h2&gt;&lt;b&gt;å¤„ç†å·®å¼‚æ¯”è¾ƒ&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;DiffUtil æ˜¯ ListAdapter èƒ½å¤Ÿé«˜æ•ˆæ”¹å˜å…ƒç´ çš„å¥¥ç§˜æ‰€åœ¨ã€‚DiffUtil ä¼šæ¯”è¾ƒæ–°æ—§åˆ—è¡¨ä¸­å¢åŠ ã€ç§»åŠ¨ã€åˆ é™¤äº†å“ªäº›å…ƒç´ ï¼Œç„¶åè¾“å‡ºæ›´æ–°æ“ä½œçš„åˆ—è¡¨å°†åŸåˆ—è¡¨ä¸­çš„å…ƒç´ é«˜æ•ˆåœ°è½¬æ¢ä¸ºæ–°çš„å…ƒç´ ã€‚&lt;/p&gt;&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿè¯†åˆ«æ–°çš„æ•°æ®ï¼ŒDiffUtil éœ€è¦æ‚¨é‡å†™ areItemsTheSame() å’Œ areContentsTheSame()ã€‚areItemsTheSame() æ£€æŸ¥ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ä¸ºåŒä¸€å…ƒç´ ã€‚areContentsTheSame() æ£€æŸ¥ä¸¤ä¸ªå…ƒç´ æ˜¯å¦åŒ…å«ç›¸åŒçš„æ•°æ®ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-94f7d618987d2f8fce6ed40d1a607a77_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1400&quot; data-rawheight=&quot;531&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic4.zhimg.com/v2-94f7d618987d2f8fce6ed40d1a607a77_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1400&quot; data-rawheight=&quot;531&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic4.zhimg.com/v2-94f7d618987d2f8fce6ed40d1a607a77_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-94f7d618987d2f8fce6ed40d1a607a77_b.jpg&quot;/&gt;&lt;figcaption&gt;areItemsTheSame() æ¯”è¾ƒå…ƒç´ çš„ç¤ºæ„å›¾&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-40a0e529be7f234c6145bc5dad3d0685_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1386&quot; data-rawheight=&quot;512&quot; class=&quot;origin_image zh-lightbox-thumb&quot; data-original=&quot;https://pic2.zhimg.com/v2-40a0e529be7f234c6145bc5dad3d0685_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1386&quot; data-rawheight=&quot;512&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; data-original=&quot;https://pic2.zhimg.com/v2-40a0e529be7f234c6145bc5dad3d0685_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-40a0e529be7f234c6145bc5dad3d0685_b.jpg&quot;/&gt;&lt;figcaption&gt;areContentsTheSame() æ¯”è¾ƒå…ƒç´ çš„ç¤ºæ„å›¾&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;åœ¨ &lt;code&gt;Adapter&lt;/code&gt; ç±»ä¸­æ·»åŠ  &lt;code&gt;DiffUtil&lt;/code&gt; å¯¹è±¡ï¼Œå¹¶ä¸”å¤å†™ &lt;code&gt;areItemsTheSame()&lt;/code&gt; å’Œ &lt;code&gt;areContentsTheSame()&lt;/code&gt;ã€‚&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Copyright&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2019&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Google&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LLC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; 
   &lt;span class=&quot;n&quot;&gt;SPDX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;License&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Apache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2.0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&amp;gt;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FlowerDiffCallback&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DiffUtil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ItemCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Flower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;areItemsTheSame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oldItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Flower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Flower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Boolean&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oldItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

   &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;areContentsTheSame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oldItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Flower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Flower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Boolean&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oldItem&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newItem&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°† &lt;code&gt;Adapter&lt;/code&gt; çš„çˆ¶ç±»ç”± &lt;code&gt;RecyclerView.Adapter&lt;/code&gt; æ”¹ä¸º &lt;code&gt;ListAdapter&lt;/code&gt;ï¼Œå¹¶ä¼ å…¥ &lt;code&gt;DiffCallback&lt;/code&gt;ã€‚&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Copyright&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2019&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Google&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LLC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; 
   &lt;span class=&quot;n&quot;&gt;SPDX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;License&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Apache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2.0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&amp;gt;&lt;/span&gt;
   
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FlowerAdapter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ListAdapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FlowerAdapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FlowerViewHolder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FlowerDiffCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;æ›´æ–°åˆ—è¡¨&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//developer.android.google.cn/reference/androidx/recyclerview/widget/ListAdapter&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ListAdapter&lt;/a&gt;&lt;/b&gt; é€šè¿‡ &lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//developer.android.google.cn/reference/androidx/recyclerview/widget/ListAdapter%23submitList%28java.util.List%253CT%253E%29&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;submitList()&lt;/a&gt;&lt;/b&gt; æ–¹æ³•è·å–æ•°æ®ï¼Œè¯¥æ–¹æ³•æäº¤äº†ä¸€ä¸ªåˆ—è¡¨æ¥ä¸å½“å‰åˆ—è¡¨è¿›è¡Œå¯¹æ¯”å¹¶æ˜¾ç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´æ‚¨æ— éœ€å†é‡å†™ &lt;code&gt;getItemCount()&lt;/code&gt;ï¼Œå› ä¸º &lt;code&gt;ListAdapter&lt;/code&gt; ä¼šè´Ÿè´£ç®¡ç†åˆ—è¡¨ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ &lt;code&gt;Activity&lt;/code&gt; ç±»ä¸­ï¼Œè°ƒç”¨ &lt;code&gt;Adapter&lt;/code&gt; çš„ &lt;code&gt;submitList()&lt;/code&gt; æ–¹æ³•å¹¶ä¼ å…¥æ•°æ®åˆ—è¡¨ã€‚&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Copyright&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2019&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Google&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LLC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; 
   &lt;span class=&quot;n&quot;&gt;SPDX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;License&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Apache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2.0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&amp;gt;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;flowerList&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getStringArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flower_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;toMutableList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;flowerAdapter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FlowerAdapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;flowerAdapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;submitList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flowerList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ &lt;code&gt;Adapter&lt;/code&gt; ç±»ä¸­ï¼Œ&lt;code&gt;onBindViewHolder()&lt;/code&gt; ç°åœ¨å¯ä»¥ä½¿ç”¨ &lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//developer.android.google.cn/reference/androidx/recyclerview/widget/ListAdapter%23getItem%28int%29&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;getItem()&lt;/a&gt;&lt;/b&gt; ä»æ•°æ®åˆ—è¡¨ä¸­è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ äº†ã€‚&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;!--&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Copyright&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2019&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Google&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LLC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; 
   &lt;span class=&quot;n&quot;&gt;SPDX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;License&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Apache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2.0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&amp;gt;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onBindViewHolder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;holder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FlowerViewHolder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;holder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±è¿™ä¹ˆç®€å•ã€‚ä»…éœ€å‡ æ­¥ç®€å•æ“ä½œå°±å¯ä»¥åœ¨æ‚¨çš„ &lt;code&gt;RecyclerView&lt;/code&gt; ä¸­ä½¿ç”¨ &lt;code&gt;ListAdapter&lt;/code&gt;ã€‚ç°åœ¨æ‚¨çš„åº”ç”¨å¯ä»¥é€šè¿‡ä½¿ç”¨ &lt;code&gt;ListAdapter&lt;/code&gt; æ¥æ›´æ–°é‚£äº›å‘ç”Ÿå˜åŒ–çš„å…ƒç´ ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒäº†ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸‹ä¸€æ­¥&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å…³äº &lt;code&gt;ListAdapter&lt;/code&gt; çš„ &lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/android/views-widgets-samples/tree/main/RecyclerViewKotlin&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å®Œæ•´ç¤ºä¾‹ä»£ç &lt;/a&gt;&lt;/b&gt; éƒ½åœ¨è¿™é‡Œã€‚&lt;/p&gt;&lt;p&gt;æ„Ÿè°¢é˜…è¯» &lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/mp/appmsgalbum%3F__biz%3DMzk0NDIwMTExNw%3D%3D%26action%3Dgetalbum%26album_id%3D1866978093609893891%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;RecyclerView ç³»åˆ—&lt;/a&gt;&lt;/b&gt; çš„ç¬¬äºŒç¯‡æ–‡ç« ã€‚è¯·ç»§ç»­å…³æ³¨æœªæ¥æ›´å¤šå…³äº &lt;code&gt;RecyclerView&lt;/code&gt; çš„å†…å®¹ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äº &lt;code&gt;ListAdapter&lt;/code&gt; çš„å†…å®¹ï¼Œè¯·å‚è€ƒ &lt;b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//developer.android.google.cn/reference/androidx/recyclerview/widget/ListAdapter&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/b&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>