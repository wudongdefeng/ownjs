<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>b830a8d762140c0cb944a559eabc9825</guid>
<title>ç¼“å­˜åŸç†ä¸å¾®æœåŠ¡ç¼“å­˜è‡ªåŠ¨ç®¡ç†</title>
<link>https://toutiao.io/k/t2bvzew</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;preview&quot;&gt;&lt;h2&gt;ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;å…ˆä»ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜å¼€å§‹è°ˆèµ·ï¼šæˆ‘ä»¬çš„ç¨‹åºæ˜¯å¦‚ä½•è¿è¡Œèµ·æ¥çš„ï¼Ÿ&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;ç¨‹åºå­˜å‚¨åœ¨ &lt;code&gt;disk&lt;/code&gt; ä¸­&lt;/li&gt;
&lt;li&gt;ç¨‹åºæ˜¯è¿è¡Œåœ¨ &lt;code&gt;RAM&lt;/code&gt; ä¹‹ä¸­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ &lt;code&gt;main memory&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç¨‹åºçš„è®¡ç®—é€»è¾‘åœ¨ &lt;code&gt;CPU&lt;/code&gt; ä¸­æ‰§è¡Œ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æ¥çœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š&lt;code&gt;a = a + 1&lt;/code&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;load x:&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x0 = x0 + 1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;load x0 -&amp;gt; RAM&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3dd026f6502435fb3c704e7e9512d27%7Etplv-k3u1fbpfcp-watermark.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šé¢æåˆ°äº†3ç§å­˜å‚¨ä»‹è´¨ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œä¸‰ç±»çš„è¯»å†™é€Ÿåº¦å’Œæˆæœ¬æˆåæ¯”ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å…‹æœé€Ÿåº¦é—®é¢˜ä¸Šéœ€è¦å¼•å…¥ä¸€ä¸ª &lt;strong&gt;ä¸­é—´å±‚&lt;/strong&gt;ã€‚è¿™ä¸ªä¸­é—´å±‚ï¼Œéœ€è¦é«˜é€Ÿå­˜å–çš„é€Ÿåº¦ï¼Œä½†æ˜¯æˆæœ¬å¯æ¥å—ã€‚äºæ˜¯ä¹ï¼Œ&lt;code&gt;Cache&lt;/code&gt; è¢«å¼•å…¥&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd6ad665a200454191b9691fa495399d%7Etplv-k3u1fbpfcp-watermark.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;è€Œåœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œæœ‰ä¸¤ç§é»˜è®¤ç¼“å­˜ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;CPU é‡Œé¢çš„æœ«çº§ç¼“å­˜ï¼Œå³ &lt;code&gt;LLC&lt;/code&gt;ã€‚ç¼“å­˜å†…å­˜ä¸­çš„æ•°æ®&lt;/li&gt;
&lt;li&gt;å†…å­˜ä¸­çš„é«˜é€Ÿé¡µç¼“å­˜ï¼Œå³ &lt;code&gt;page cache&lt;/code&gt;ã€‚ç¼“å­˜ç£ç›˜ä¸­çš„æ•°æ®&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;ç¼“å­˜è¯»å†™ç­–ç•¥&lt;/h2&gt;

&lt;p&gt;å¼•å…¥ &lt;code&gt;Cache&lt;/code&gt; ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹çœ‹æ“ä½œç¼“å­˜ä¼šå‘ç”Ÿä»€ä¹ˆã€‚å› ä¸ºå­˜åœ¨å­˜å–é€Ÿåº¦çš„å·®å¼‚ã€Œè€Œä¸”å·®å¼‚å¾ˆå¤§ã€ï¼Œä»è€Œåœ¨æ“ä½œæ•°æ®æ—¶ï¼Œå»¶è¿Ÿæˆ–ç¨‹åºå¤±è´¥ç­‰éƒ½ä¼šå¯¼è‡´ç¼“å­˜å’Œå®é™…å­˜å‚¨å±‚æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å°±ä»¥æ ‡å‡†çš„ &lt;code&gt;Cache+DB&lt;/code&gt; æ¥çœ‹çœ‹ç»å…¸è¯»å†™ç­–ç•¥å’Œåº”ç”¨åœºæ™¯ã€‚&lt;/p&gt;

&lt;h3&gt;Cache Aside&lt;/h3&gt;

&lt;p&gt;å…ˆæ¥è€ƒè™‘ä¸€ç§æœ€ç®€å•çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·è¡¨ï¼š&lt;code&gt;userId:ç”¨æˆ·id, phone:ç”¨æˆ·ç”µè¯tokenï¼Œavtoar:ç”¨æˆ·å¤´åƒurl&lt;/code&gt;ï¼Œç¼“å­˜ä¸­æˆ‘ä»¬ç”¨ &lt;code&gt;phone&lt;/code&gt; ä½œä¸ºkeyå­˜å‚¨ç”¨æˆ·å¤´åƒã€‚å½“ç”¨æˆ·ä¿®æ”¹å¤´åƒurlè¯¥å¦‚ä½•åšï¼Ÿ&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ›´æ–°&lt;code&gt;DB&lt;/code&gt;æ•°æ®ï¼Œå†æ›´æ–°&lt;code&gt;Cache&lt;/code&gt; æ•°æ®&lt;/li&gt;
&lt;li&gt;æ›´æ–° &lt;code&gt;DB&lt;/code&gt; æ•°æ®ï¼Œå†åˆ é™¤ &lt;code&gt;Cache&lt;/code&gt; æ•°æ®&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é¦–å…ˆ &lt;strong&gt;å˜æ›´æ•°æ®åº“&lt;/strong&gt; å’Œ &lt;strong&gt;å˜æ›´ç¼“å­˜&lt;/strong&gt; æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œï¼Œè€Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹æ“ä½œåšä»»ä½•çš„å¹¶å‘æ§åˆ¶ã€‚é‚£ä¹ˆå½“ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ›´æ–°å®ƒä»¬çš„æ—¶å€™ï¼Œå°±ä¼šå› ä¸ºå†™å…¥é¡ºåºçš„ä¸åŒé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æ›´å¥½çš„æ–¹æ¡ˆæ˜¯ &lt;code&gt;2&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ›´æ–°æ•°æ®æ—¶ä¸æ›´æ–°ç¼“å­˜ï¼Œè€Œæ˜¯ç›´æ¥åˆ é™¤ç¼“å­˜&lt;/li&gt;
&lt;li&gt;åç»­çš„è¯·æ±‚å‘ç°ç¼“å­˜ç¼ºå¤±ï¼Œå›å»æŸ¥è¯¢ &lt;code&gt;DB&lt;/code&gt; ï¼Œå¹¶å°†ç»“æœ &lt;code&gt;load cache&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e581e968b4174e519714bddfab927e1d%7Etplv-k3u1fbpfcp-watermark.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªç­–ç•¥å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ç¼“å­˜æœ€å¸¸è§çš„ç­–ç•¥ï¼š&lt;code&gt;Cache Aside&lt;/code&gt;ã€‚è¿™ä¸ªç­–ç•¥æ•°æ®ä»¥æ•°æ®åº“ä¸­çš„æ•°æ®ä¸ºå‡†ï¼Œç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æŒ‰éœ€åŠ è½½çš„ï¼Œåˆ†ä¸ºè¯»ç­–ç•¥å’Œå†™ç­–ç•¥ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯å¯è§çš„é—®é¢˜ä¹Ÿå°±å‡ºç°äº†ï¼šé¢‘ç¹çš„è¯»å†™æ“ä½œä¼šå¯¼è‡´ &lt;code&gt;Cache&lt;/code&gt; åå¤åœ°æ›¿æ¢ï¼Œç¼“å­˜å‘½ä¸­ç‡é™ä½ã€‚å½“ç„¶å¦‚æœåœ¨ä¸šåŠ¡ä¸­å¯¹å‘½ä¸­ç‡æœ‰ç›‘æ§æŠ¥è­¦æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ›´æ–°æ•°æ®æ—¶åŒæ—¶æ›´æ–°ç¼“å­˜ï¼Œä½†æ˜¯åœ¨æ›´æ–°ç¼“å­˜å‰åŠ ä¸€ä¸ª &lt;strong&gt;åˆ†å¸ƒå¼é”&lt;/strong&gt;ã€‚è¿™æ ·åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œç¼“å­˜ï¼Œè§£å†³äº†å¹¶å‘é—®é¢˜ã€‚åŒæ—¶åœ¨åç»­è¯»è¯·æ±‚ä¸­æ—¶è¯»åˆ°æœ€æ–°çš„ç¼“å­˜ï¼Œè§£å†³äº†ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;æ›´æ–°æ•°æ®æ—¶åŒæ—¶æ›´æ–°ç¼“å­˜ï¼Œä½†æ˜¯ç»™ç¼“å­˜ä¸€ä¸ªè¾ƒçŸ­çš„ &lt;code&gt;TTL&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å½“ç„¶é™¤äº†è¿™ä¸ªç­–ç•¥ï¼Œåœ¨è®¡ç®—æœºä½“ç³»è¿˜æœ‰å…¶ä»–å‡ ç§ç»å…¸çš„ç¼“å­˜ç­–ç•¥ï¼Œå®ƒä»¬ä¹Ÿæœ‰å„è‡ªé€‚ç”¨çš„ä½¿ç”¨åœºæ™¯ã€‚&lt;/p&gt;

&lt;h3&gt;Write Through&lt;/h3&gt;

&lt;p&gt;å…ˆæŸ¥è¯¢å†™å…¥æ•°æ®keyæ˜¯å¦å‡»ä¸­ç¼“å­˜ï¼Œå¦‚æœåœ¨ -&amp;gt; æ›´æ–°ç¼“å­˜ï¼ŒåŒæ—¶ç¼“å­˜ç»„ä»¶åŒæ­¥æ•°æ®è‡³DBï¼›ä¸å­˜åœ¨ï¼Œåˆ™è§¦å‘ &lt;code&gt;Write Miss&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è€Œä¸€èˆ¬ &lt;code&gt;Write Miss&lt;/code&gt; æœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Write Allocate&lt;/code&gt;ï¼šå†™æ—¶ç›´æ¥åˆ†é… &lt;code&gt;Cache line&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;No-write allocate&lt;/code&gt;ï¼šå†™æ—¶ä¸å†™å…¥ç¼“å­˜ï¼Œç›´æ¥å†™å…¥DBï¼Œreturn&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ &lt;code&gt;Write Through&lt;/code&gt; ä¸­ï¼Œä¸€èˆ¬é‡‡å– &lt;code&gt;No-write allocate&lt;/code&gt; ã€‚å› ä¸ºå…¶å®æ— è®ºå“ªç§ï¼Œæœ€ç»ˆæ•°æ®éƒ½ä¼šæŒä¹…åŒ–åˆ°DBä¸­ï¼Œçœå»ä¸€æ­¥ç¼“å­˜çš„å†™å…¥ï¼Œæå‡å†™æ€§èƒ½ã€‚è€Œç¼“å­˜ç”± &lt;code&gt;Read Through&lt;/code&gt; å†™å…¥ç¼“å­˜ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51d5e77a1929411992f16fbf3153965e%7Etplv-k3u1fbpfcp-watermark.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªç­–ç•¥çš„æ ¸å¿ƒåŸåˆ™ï¼š&lt;strong&gt;ç”¨æˆ·åªä¸ç¼“å­˜æ‰“äº¤é“ï¼Œç”±ç¼“å­˜ç»„ä»¶å’ŒDBé€šä¿¡ï¼Œå†™å…¥æˆ–è€…è¯»å–æ•°æ®&lt;/strong&gt;ã€‚åœ¨ä¸€äº›æœ¬åœ°è¿›ç¨‹ç¼“å­˜ç»„ä»¶å¯ä»¥è€ƒè™‘è¿™ç§ç­–ç•¥ã€‚&lt;/p&gt;

&lt;h3&gt;Write Back&lt;/h3&gt;

&lt;p&gt;ç›¸ä¿¡ä½ ä¹Ÿçœ‹å‡ºä¸Šè¿°æ–¹æ¡ˆçš„ç¼ºé™·ï¼šå†™æ•°æ®æ—¶ç¼“å­˜å’Œæ•°æ®åº“åŒæ­¥ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“è¿™ä¸¤å—å­˜å‚¨ä»‹è´¨çš„é€Ÿåº¦å·®å‡ ä¸ªæ•°é‡çº§ï¼Œå¯¹å†™å…¥æ€§èƒ½æ˜¯æœ‰å¾ˆå¤§å½±å“ã€‚é‚£æˆ‘ä»¬æ˜¯å¦å¼‚æ­¥æ›´æ–°æ•°æ®åº“ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Write back&lt;/code&gt; å°±æ˜¯åœ¨å†™æ•°æ®æ—¶åªæ›´æ–°è¯¥ &lt;code&gt;Cache Line&lt;/code&gt; å¯¹åº”çš„æ•°æ®ï¼Œå¹¶æŠŠè¯¥è¡Œæ ‡è®°ä¸º &lt;code&gt;Dirty&lt;/code&gt;ã€‚åœ¨è¯»æ•°æ®æ—¶æˆ–æ˜¯åœ¨ç¼“å­˜æ»¡æ—¶æ¢å‡ºã€Œç¼“å­˜æ›¿æ¢ç­–ç•¥ã€æ—¶ï¼Œå°† &lt;code&gt;Dirty&lt;/code&gt; å†™å…¥å­˜å‚¨ã€‚&lt;/p&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨ &lt;code&gt;Write Miss&lt;/code&gt; æƒ…å†µä¸‹ï¼Œé‡‡å–çš„æ˜¯ &lt;code&gt;Write Allocate&lt;/code&gt;ï¼Œå³å†™å…¥å­˜å‚¨åŒæ—¶å†™å…¥ç¼“å­˜ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä¹‹åçš„å†™è¯·æ±‚åªéœ€è¦æ›´æ–°ç¼“å­˜ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/597824bcd15a4e9f853c8cb96bb326b2%7Etplv-k3u1fbpfcp-watermark.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;async purge&lt;/code&gt; æ­¤ç±»æ¦‚å¿µå…¶å®å­˜åœ¨è®¡ç®—æœºä½“ç³»ä¸­ã€‚&lt;code&gt;Mysql&lt;/code&gt; ä¸­åˆ·è„é¡µï¼Œæœ¬è´¨éƒ½æ˜¯å°½å¯èƒ½é˜²æ­¢éšæœºå†™ï¼Œç»Ÿä¸€å†™ç£ç›˜æ—¶æœºã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2&gt;Redis&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;Redis&lt;/code&gt;æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿè½¯ä»¶ï¼Œå’Œæˆ‘ä»¬å†™çš„ä¸šåŠ¡ç¨‹åºæ˜¯ä¸¤ä¸ªè½¯ä»¶ã€‚å½“æˆ‘ä»¬éƒ¨ç½²äº†&lt;code&gt;Redis&lt;/code&gt; å®ä¾‹åï¼Œå®ƒåªä¼šè¢«åŠ¨åœ°ç­‰å¾…å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œç„¶åå†è¿›è¡Œå¤„ç†ã€‚æ‰€ä»¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæƒ³è¦ä½¿ç”¨ &lt;code&gt;Redis&lt;/code&gt; ç¼“å­˜ï¼Œæˆ‘ä»¬å°±è¦åœ¨ç¨‹åºä¸­å¢åŠ ç›¸åº”çš„ç¼“å­˜æ“ä½œä»£ç ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹ŸæŠŠ &lt;code&gt;Redis&lt;/code&gt; ç§°ä¸º &lt;strong&gt;æ—è·¯ç¼“å­˜&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šè¯»å–ç¼“å­˜ã€è¯»å–æ•°æ®åº“å’Œæ›´æ–°ç¼“å­˜çš„æ“ä½œéƒ½éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­æ¥å®Œæˆã€‚&lt;/p&gt;

&lt;p&gt;è€Œä½œä¸ºç¼“å­˜çš„ &lt;code&gt;Redis&lt;/code&gt;ï¼ŒåŒæ ·éœ€è¦é¢ä¸´å¸¸è§çš„é—®é¢˜ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç¼“å­˜çš„å®¹é‡ç»ˆç©¶æœ‰é™&lt;/li&gt;
&lt;li&gt;ä¸Šæ¸¸å¹¶å‘è¯·æ±‚å†²å‡»&lt;/li&gt;
&lt;li&gt;ç¼“å­˜ä¸åç«¯å­˜å‚¨æ•°æ®ä¸€è‡´æ€§&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;æ›¿æ¢ç­–ç•¥&lt;/h3&gt;

&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜å¯¹äºé€‰å®šçš„è¢«æ·˜æ±°æ•°æ®ï¼Œä¼šæ ¹æ®å…¶æ˜¯å¹²å‡€æ•°æ®è¿˜æ˜¯è„æ•°æ®ï¼Œé€‰æ‹©ç›´æ¥åˆ é™¤è¿˜æ˜¯å†™å›æ•°æ®åº“ã€‚ä½†æ˜¯ï¼Œåœ¨ Redis ä¸­ï¼Œè¢«æ·˜æ±°æ•°æ®æ— è®ºå¹²å‡€ä¸å¦éƒ½ä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨ Redis ç¼“å­˜æ—¶è¦ç‰¹åˆ«æ³¨æ„çš„ï¼šå½“æ•°æ®ä¿®æ”¹æˆä¸ºè„æ•°æ®æ—¶ï¼Œéœ€è¦åœ¨æ•°æ®åº“ä¸­ä¹ŸæŠŠæ•°æ®ä¿®æ”¹è¿‡æ¥ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ä¸ç®¡æ›¿æ¢ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Œè„æ•°æ®æœ‰å¯èƒ½åœ¨æ¢å…¥æ¢å‡ºä¸­ä¸¢å¤±ã€‚é‚£æˆ‘ä»¬åœ¨äº§ç”Ÿè„æ•°æ®å°±åº”è¯¥åˆ é™¤ç¼“å­˜ï¼Œè€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Œä¸€åˆ‡æ•°æ®åº”è¯¥ä»¥æ•°æ®åº“ä¸ºå‡†ã€‚è¿™ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œç¼“å­˜å†™å…¥åº”è¯¥äº¤ç»™è¯»è¯·æ±‚æ¥å®Œæˆï¼›å†™è¯·æ±‚å°½å¯èƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;

&lt;p&gt;è‡³äºæ›¿æ¢ç­–ç•¥æœ‰å“ªäº›ï¼Œç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šæ–‡ç« å½’çº³ä¹‹é—´çš„ä¼˜åŠ£ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;

&lt;h3&gt;ShardCalls&lt;/h3&gt;

&lt;p&gt;å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹ï¼ˆåç¨‹ï¼‰åŒæ—¶è¯·æ±‚åŒä¸€ä»½èµ„æºï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚éƒ½è¦èµ°ä¸€éèµ„æºçš„è¯·æ±‚è¿‡ç¨‹ï¼Œé™¤äº†æ¯”è¾ƒä½æ•ˆä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹èµ„æºæœåŠ¡é€ æˆå¹¶å‘çš„å‹åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;go-zero&lt;/code&gt; ä¸­çš„ &lt;code&gt;ShardCalls&lt;/code&gt; å¯ä»¥ä½¿å¾—åŒæ—¶å¤šä¸ªè¯·æ±‚åªéœ€è¦å‘èµ·ä¸€æ¬¡æ‹¿ç»“æœçš„è°ƒç”¨ï¼Œå…¶ä»–è¯·æ±‚&quot;åäº«å…¶æˆ&quot;ï¼Œè¿™ç§è®¾è®¡æœ‰æ•ˆå‡å°‘äº†èµ„æºæœåŠ¡çš„å¹¶å‘å‹åŠ›ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢ç¼“å­˜å‡»ç©¿ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºé˜²æ­¢æš´å¢çš„æ¥å£è¯·æ±‚å¯¹ä¸‹æ¸¸æœåŠ¡é€ æˆç¬æ—¶é«˜è´Ÿè½½ï¼Œå¯ä»¥åœ¨ä½ çš„å‡½æ•°åŒ…è£¹ï¼š&lt;/p&gt;

&lt;pre lang=&quot;go&quot;&gt;&lt;code&gt;fn = func() (interface{}, error) {
  // ä¸šåŠ¡æŸ¥è¯¢
}
data, err = g.Do(apiKey, fn)
// å°±è·å¾—åˆ°dataï¼Œä¹‹åçš„æ–¹æ³•æˆ–è€…é€»è¾‘å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªdata
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…¶å®åŸç†ä¹Ÿå¾ˆç®€å•ï¼š&lt;/p&gt;

&lt;pre lang=&quot;go&quot;&gt;&lt;code&gt;func (g *sharedGroup) Do(key string, fn func() (interface{}, error)) (interface{}, error) {
  // done: falseï¼Œæ‰ä¼šå»æ‰§è¡Œä¸‹é¢çš„ä¸šåŠ¡é€»è¾‘ï¼›ä¸º trueï¼Œç›´æ¥è¿”å›ä¹‹å‰è·å–çš„data
  c, done := g.createCall(key)
  if done {
    return c.val, c.err
  }

  // æ‰§è¡Œè°ƒç”¨è€…ä¼ å…¥çš„ä¸šåŠ¡é€»è¾‘
  g.makeCall(c, key, fn)
  return c.val, c.err
}

func (g *sharedGroup) createCall(key string) (c *call, done bool) {
  // åªè®©ä¸€ä¸ªè¯·æ±‚è¿›æ¥è¿›è¡Œæ“ä½œ
  g.lock.Lock()
  // å¦‚æœæºå¸¦æ ‡ç¤ºä¸€ç³»åˆ—è¯·æ±‚çš„keyåœ¨ calls è¿™ä¸ªmapä¸­å·²ç»å­˜åœ¨ï¼Œ
  // åˆ™è§£é”å¹¶åŒæ—¶ç­‰å¾…ä¹‹å‰è¯·æ±‚è·å–æ•°æ®ï¼Œè¿”å›
  if c, ok := g.calls[key]; ok {
    g.lock.Unlock()
    c.wg.Wait()
    return c, true
  }

  // è¯´æ˜æœ¬æ¬¡è¯·æ±‚æ˜¯é¦–æ¬¡è¯·æ±‚
  c = new(call)
  c.wg.Add(1)
  // æ ‡æ³¨è¯·æ±‚ï¼Œå› ä¸ºæŒæœ‰é”ï¼Œä¸ç”¨æ‹…å¿ƒå¹¶å‘é—®é¢˜
  g.calls[key] = c
  g.lock.Unlock()

  return c, false
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ç§ &lt;code&gt;map+lock&lt;/code&gt; å­˜å‚¨å¹¶é™åˆ¶è¯·æ±‚æ“ä½œï¼Œå’Œ&lt;a href=&quot;https://github.com/golang/groupcache/tree/master/singleflight&quot;&gt;groupcache&lt;/a&gt;ä¸­çš„ &lt;code&gt;singleflight&lt;/code&gt; ç±»ä¼¼ï¼Œéƒ½æ˜¯é˜²æ­¢ç¼“å­˜å‡»ç©¿çš„åˆ©å™¨&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æºç åœ°å€ï¼š&lt;a href=&quot;https://github.com/tal-tech/go-zero/blob/master/core/syncx/sharedcalls.go#L45&quot;&gt;sharedcalls.go&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3&gt;ç¼“å­˜å’Œå­˜å‚¨æ›´æ–°é¡ºåº&lt;/h3&gt;

&lt;p&gt;è¿™æ˜¯å¼€å‘ä¸­å¸¸è§çº ç»“é—®é¢˜ï¼š&lt;strong&gt;åˆ°åº•æ˜¯å…ˆåˆ é™¤ç¼“å­˜è¿˜æ˜¯å…ˆæ›´æ–°å­˜å‚¨ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æƒ…å†µä¸€ï¼šå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°å­˜å‚¨ï¼›&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;A&lt;/code&gt; åˆ é™¤ç¼“å­˜ï¼Œæ›´æ–°å­˜å‚¨æ—¶ç½‘ç»œå»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;B&lt;/code&gt; è¯»è¯·æ±‚ï¼Œå‘ç°ç¼“å­˜ç¼ºå¤±ï¼Œè¯»å­˜å‚¨ -&amp;gt; æ­¤æ—¶è¯»åˆ°æ—§æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;è¿™æ ·ä¼šäº§ç”Ÿä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;B&lt;/code&gt; è¯»å–æ—§å€¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;B&lt;/code&gt; åŒæ—¶è¯»è¯·æ±‚ä¼šæŠŠæ—§å€¼å†™å…¥ç¼“å­˜ï¼Œå¯¼è‡´åç»­è¯»è¯·æ±‚è¯»åˆ°æ—§å€¼&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ—¢ç„¶æ˜¯ç¼“å­˜å¯èƒ½æ˜¯æ—§å€¼ï¼Œé‚£å°±ä¸ç®¡åˆ é™¤ã€‚æœ‰ä¸€ä¸ªå¹¶ä¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼š&lt;strong&gt;åœ¨å†™è¯·æ±‚æ›´æ–°å®Œå­˜å‚¨å€¼ä»¥åï¼Œ&lt;code&gt;sleep()&lt;/code&gt; ä¸€å°æ®µæ—¶é—´ï¼Œå†è¿›è¡Œä¸€æ¬¡ç¼“å­˜åˆ é™¤æ“ä½œ&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;sleep&lt;/code&gt; æ˜¯ä¸ºäº†ç¡®ä¿è¯»è¯·æ±‚ç»“æŸï¼Œå†™è¯·æ±‚å¯ä»¥åˆ é™¤è¯»è¯·æ±‚é€ æˆçš„ç¼“å­˜è„æ•°æ®ï¼Œå½“ç„¶ä¹Ÿè¦è€ƒè™‘åˆ° redis ä¸»ä»åŒæ­¥çš„è€—æ—¶ã€‚ä¸è¿‡è¿˜æ˜¯è¦æ ¹æ®å®é™…ä¸šåŠ¡è€Œå®šã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæ–¹æ¡ˆä¼šåœ¨ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜å€¼åï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´å†æ¬¡è¿›è¡Œåˆ é™¤ï¼Œè¢«ç§°ä¸ºï¼š&lt;strong&gt;å»¶è¿ŸåŒåˆ &lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æƒ…å†µäºŒï¼šå…ˆæ›´æ–°æ•°æ®åº“å€¼ï¼Œå†åˆ é™¤ç¼“å­˜å€¼ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;A&lt;/code&gt; åˆ é™¤å­˜å‚¨å€¼ï¼Œä½†æ˜¯åˆ é™¤ç¼“å­˜ç½‘ç»œå»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;B&lt;/code&gt; è¯»è¯·æ±‚æ—¶ï¼Œç¼“å­˜å‡»ä¸­ï¼Œå°±ç›´æ¥è¿”å›æ—§å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;è¿™ç§æƒ…å†µå¯¹ä¸šåŠ¡çš„å½±å“è¾ƒå°ï¼Œè€Œç»å¤§å¤šæ•°ç¼“å­˜ç»„ä»¶éƒ½æ˜¯é‡‡å–æ­¤ç§æ›´æ–°é¡ºåºï¼Œæ»¡è¶³æœ€ç»ˆä¸€è‡´æ€§è¦æ±‚ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æƒ…å†µä¸‰ï¼šæ–°ç”¨æˆ·æ³¨å†Œï¼Œç›´æ¥å†™å…¥æ•°æ®åº“ï¼ŒåŒæ—¶ç¼“å­˜ä¸­è‚¯å®šæ²¡æœ‰ã€‚å¦‚æœç¨‹åºæ­¤æ—¶è¯»ä»åº“ï¼Œç”±äºä¸»ä»å»¶è¿Ÿï¼Œå¯¼è‡´è¯»å–ä¸åˆ°ç”¨æˆ·æ•°æ®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è¿™ç§æƒ…å†µå°±éœ€è¦é’ˆå¯¹ &lt;code&gt;Insert&lt;/code&gt; è¿™ç§æ“ä½œï¼šæ’å…¥æ–°æ•°æ®å…¥æ•°æ®åº“åŒæ—¶å†™ç¼“å­˜ã€‚ä½¿å¾—åç»­è¯»è¯·æ±‚å¯ä»¥ç›´æ¥è¯»ç¼“å­˜ï¼ŒåŒæ—¶å› ä¸ºæ˜¯åˆšæ’å…¥çš„æ–°æ•°æ®ï¼Œåœ¨ä¸€æ®µæ—¶é—´ä¿®æ”¹çš„å¯èƒ½æ€§ä¸å¤§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä»¥ä¸Šæ–¹æ¡ˆåœ¨å¤æ‚çš„æƒ…å†µæˆ–å¤šæˆ–å°‘éƒ½æœ‰æ½œåœ¨é—®é¢˜ï¼Œéœ€è¦è´´åˆä¸šåŠ¡åšå…·ä½“çš„ä¿®æ”¹&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2&gt;å¦‚ä½•è®¾è®¡å¥½ç”¨çš„ç¼“å­˜æ“ä½œå±‚ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;ä¸Šé¢è¯´äº†è¿™ä¹ˆå¤šï¼Œå›åˆ°æˆ‘ä»¬å¼€å‘è§’åº¦ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è€ƒè™‘è¿™ä¹ˆå¤šé—®é¢˜ï¼Œæ˜¾ç„¶å¤ªéº»çƒ¦äº†ã€‚æ‰€ä»¥å¦‚ä½•æŠŠè¿™äº›ç¼“å­˜ç­–ç•¥å’Œæ›¿æ¢ç­–ç•¥å°è£…èµ·æ¥ï¼Œç®€åŒ–å¼€å‘è¿‡ç¨‹ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æ˜ç¡®å‡ ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å°†ä¸šåŠ¡é€»è¾‘å’Œç¼“å­˜æ“ä½œåˆ†ç¦»ï¼Œç•™ç»™å¼€å‘è¿™ä¸€ä¸ªå†™å…¥é€»è¾‘çš„ç‚¹&lt;/li&gt;
&lt;li&gt;ç¼“å­˜æ“ä½œéœ€è¦è€ƒè™‘æµé‡å†²å‡»ï¼Œç¼“å­˜ç­–ç•¥ç­‰é—®é¢˜ã€‚ã€‚ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬ä»è¯»å’Œå†™ä¸¤ä¸ªè§’åº¦å»èŠèŠ &lt;code&gt;go-zero&lt;/code&gt;æ˜¯å¦‚ä½•å°è£…ã€‚&lt;/p&gt;

&lt;h3&gt;QueryRow&lt;/h3&gt;

&lt;pre lang=&quot;go&quot;&gt;&lt;code&gt;// res: query result
// cacheKey: redis key
err := m.QueryRow(&amp;amp;res, cacheKey, func(conn sqlx.SqlConn, v interface{}) error {
  querySQL := `select * from your_table where campus_id = ? and student_id = ?`
  return conn.QueryRow(v, querySQL, campusId, studentId)
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬å°†å¼€å‘æŸ¥è¯¢ä¸šåŠ¡é€»è¾‘ç”¨ &lt;code&gt;func(conn sqlx.SqlConn, v interface{})&lt;/code&gt; å°è£…ã€‚ç”¨æˆ·æ— éœ€è€ƒè™‘ç¼“å­˜å†™å…¥ï¼Œåªéœ€è¦ä¼ å…¥éœ€è¦å†™å…¥çš„ &lt;code&gt;cacheKey&lt;/code&gt;ã€‚åŒæ—¶æŠŠæŸ¥è¯¢ç»“æœ &lt;code&gt;res&lt;/code&gt; è¿”å›ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ç¼“å­˜æ“ä½œæ˜¯å¦‚ä½•è¢«å°è£…åœ¨å†…éƒ¨å‘¢ï¼Ÿæ¥çœ‹çœ‹å‡½æ•°å†…éƒ¨ï¼š&lt;/p&gt;

&lt;pre lang=&quot;go&quot;&gt;&lt;code&gt;func (c cacheNode) QueryRow(v interface{}, key string, query func(conn sqlx.SqlConn, v interface{}) error) error {
 cacheVal := func(v interface{}) error {
  return c.SetCache(key, v)
 }
 // 1. cache hit -&amp;gt; return
  // 2. cache miss -&amp;gt; err
 if err := c.doGetCache(key, v); err != nil {
    // 2.1 err defalut val {*}
  if err == errPlaceholder {
   return c.errNotFound
  } else if err != c.errNotFound {
   return err
  }
  // 2.2 cache miss -&amp;gt; query db
    // 2.2.1 query db return err {NotFound} -&amp;gt; return err defalut valã€Œsee 2.1ã€
  if err = query(c.db, v); err == c.errNotFound {
   if err = c.setCacheWithNotFound(key); err != nil {
    logx.Error(err)
   }

   return c.errNotFound
  } else if err != nil {
   c.stat.IncrementDbFails()
   return err
  }
  // 2.3 query db success -&amp;gt; set val to cache
  if err = cacheVal(v); err != nil {
   logx.Error(err)
   return err
  }
 }
 // 1.1 cache hit -&amp;gt; IncrementHit
 c.stat.IncrementHit()

 return nil
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17ff7f8597754cfdb4256aa4bb983810%7Etplv-k3u1fbpfcp-watermark.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;ä»æµç¨‹ä¸Šæ°å¥½å¯¹åº”ç¼“å­˜ç­–ç•¥ä¸­çš„ï¼š&lt;code&gt;Read Through&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æºç åœ°å€ï¼š&lt;a href=&quot;https://github.com/tal-tech/go-zero/blob/master/core/stores/sqlc/cachedsql.go#L75&quot;&gt;cachedsql.go&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3&gt;Exec&lt;/h3&gt;

&lt;p&gt;è€Œå†™è¯·æ±‚ï¼Œä½¿ç”¨çš„å°±æ˜¯ä¹‹å‰ç¼“å­˜ç­–ç•¥ä¸­çš„ &lt;code&gt;Cache Aside&lt;/code&gt;  -&amp;gt; å…ˆå†™æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚&lt;/p&gt;

&lt;pre lang=&quot;go&quot;&gt;&lt;code&gt;_, err := m.Exec(func(conn sqlx.SqlConn) (result sql.Result, err error) {
  execSQL := fmt.Sprintf(&quot;update your_table set %s where 1=1&quot;, m.table, AuthRows)
  return conn.Exec(execSQL, data.RangeId, data.AuthContentId)
}, keys...)

func (cc CachedConn) Exec(exec ExecFn, keys ...string) (sql.Result, error) {
 res, err := exec(cc.db)
 if err != nil {
  return nil, err
 }

 if err := cc.DelCache(keys...); err != nil {
  return nil, err
 }

 return res, nil
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å’Œ &lt;code&gt;QueryRow&lt;/code&gt; ä¸€æ ·ï¼Œè°ƒç”¨è€…åªéœ€è¦è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œç¼“å­˜å†™å…¥å’Œåˆ é™¤å¯¹è°ƒç”¨é€æ˜ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æºç åœ°å€ï¼š&lt;a href=&quot;https://github.com/tal-tech/go-zero/blob/master/core/stores/sqlc/cachedsql.go#L58&quot;&gt;cachedsql.go&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2&gt;çº¿ä¸Šçš„ç¼“å­˜&lt;/h2&gt;

&lt;p&gt;å¼€ç¯‡ç¬¬ä¸€å¥è¯ï¼šè„±ç¦»ä¸šåŠ¡å°†æŠ€æœ¯éƒ½æ˜¯è€æµæ°“ã€‚ä»¥ä¸Šéƒ½æ˜¯åœ¨å¯¹ç¼“å­˜æ¨¡å¼åˆ†æï¼Œä½†æ˜¯å®é™…ä¸šåŠ¡ä¸­ç¼“å­˜æ˜¯å¦èµ·åˆ°åº”æœ‰çš„åŠ é€Ÿä½œç”¨ï¼Ÿæœ€ç›´è§‚å°±æ˜¯ç¼“å­˜å‡»ä¸­ç‡ï¼Œè€Œå¦‚ä½•è§‚æµ‹åˆ°æœåŠ¡çš„ç¼“å­˜å‡»ä¸­ï¼Ÿè¿™å°±æ¶‰åŠåˆ°ç›‘æ§ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾æ˜¯æˆ‘ä»¬çº¿ä¸Šç¯å¢ƒçš„æŸä¸ªæœåŠ¡çš„ç¼“å­˜è®°å½•æƒ…å†µï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85f2198e53074252a38e25c5cc5a2489%7Etplv-k3u1fbpfcp-watermark.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;è¿˜è®°å¾—ä¸Šé¢ &lt;code&gt;QueryRow&lt;/code&gt; ä¸­ï¼šæŸ¥è¯¢ç¼“å­˜å‡»ä¸­ï¼Œä¼šè°ƒç”¨ &lt;code&gt;c.stat.IncrementHit()&lt;/code&gt;ã€‚å…¶ä¸­çš„ &lt;code&gt;stat&lt;/code&gt; å°±æ˜¯ä½œä¸ºç›‘æ§æŒ‡æ ‡ï¼Œä¸æ–­åœ¨è®¡ç®—å‡»ä¸­ç‡å’Œå¤±è´¥ç‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0fa22049a75b4eba9eee94ad02dc3dc1%7Etplv-k3u1fbpfcp-watermark.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æºç åœ°å€ï¼š&lt;a href=&quot;https://github.com/tal-tech/go-zero/blob/master/core/stores/cache/cachestat.go#L47&quot;&gt;cachestat.go&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åœ¨å…¶ä»–çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼šæ¯”å¦‚é¦–é¡µä¿¡æ¯æµè§ˆä¸šåŠ¡ä¸­ï¼Œå¤§é‡è¯·æ±‚ä¸å¯é¿å…ã€‚æ‰€ä»¥ç¼“å­˜é¦–é¡µçš„ä¿¡æ¯åœ¨ç”¨æˆ·ä½“éªŒä¸Šå°¤å…¶é‡è¦ã€‚ä½†æ˜¯åˆä¸åƒä¹‹å‰æåˆ°çš„ä¸€äº›å•ä¸€çš„keyï¼Œè¿™é‡Œå¯èƒ½æ¶‰åŠå¤§é‡æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å…¶ä»–ç¼“å­˜ç±»å‹åŠ å…¥ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ‹†åˆ†ç¼“å­˜ï¼šå¯ä»¥åˆ† &lt;code&gt;æ¶ˆæ¯id&lt;/code&gt; -&amp;gt; ç”± &lt;code&gt;æ¶ˆæ¯id&lt;/code&gt; æŸ¥è¯¢æ¶ˆæ¯ï¼Œå¹¶ç¼“å­˜æ’å…¥&lt;code&gt;æ¶ˆæ¯list&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯è¿‡æœŸï¼šè®¾ç½®æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼Œåšåˆ°ä¸å ç”¨è¿‡é•¿æ—¶é—´ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è¿™é‡Œä¹Ÿå°±æ˜¯æ¶‰åŠç¼“å­˜çš„æœ€ä½³å®è·µï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä¸å…è®¸ä¸è¿‡æœŸçš„ç¼“å­˜ã€Œå°¤ä¸ºé‡è¦ã€&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ˜“ä¼¸ç¼©&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨ç”Ÿæˆï¼Œè‡ªå¸¦ç»Ÿè®¡&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;æœ¬æ–‡ä»ç¼“å­˜çš„å¼•å…¥ï¼Œå¸¸è§ç¼“å­˜è¯»å†™ç­–ç•¥ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¦‚ä½•å°è£…ä¸€ä¸ªå¥½ç”¨çš„ç¼“å­˜æ“ä½œå±‚ï¼Œä¹Ÿå±•ç¤ºäº†çº¿ä¸Šç¼“å­˜çš„æƒ…å†µä»¥åŠç›‘æ§ã€‚æ‰€æœ‰ä¸Šé¢è°ˆåˆ°çš„è¿™äº›ç¼“å­˜ç»†èŠ‚éƒ½å¯ä»¥å‚è€ƒ &lt;code&gt;go-zero&lt;/code&gt; æºç å®ç°ï¼Œè§ &lt;code&gt;go-zero&lt;/code&gt; æºç çš„ &lt;code&gt;core/stores&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h2&gt;é¡¹ç›®åœ°å€&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/tal-tech/go-zero&quot;&gt;https://github.com/tal-tech/go-zero&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ¬¢è¿ä½¿ç”¨ go-zero å¹¶ &lt;strong&gt;star&lt;/strong&gt; é¼“åŠ±æˆ‘ä»¬ï¼ğŸ‘ğŸ»&lt;/p&gt;
&lt;/div&gt;
  &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>69e3dde804b78157e58c8f23a1623570</guid>
<title>åœ¨ MySQL ä¸­æŸ¥è¯¢æ—¶é—´å’Œæ—¥æœŸ</title>
<link>https://toutiao.io/k/i71sj4o</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;container app-preview post-body&quot;&gt;
  &lt;div class=&quot;preview&quot;&gt;&lt;p&gt;MySQL å…·æœ‰ä»¥ä¸‹å‡½æ•°æ¥è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´ï¼š&lt;/p&gt;

&lt;pre lang=&quot;sql&quot;&gt;&lt;code&gt;SELECT now();  -- datetime
SELECT curdate(); --date
SELECT curtime(); --time in 24-hour format
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¦æŸ¥æ‰¾ä¸¤ä¸ªæ—¥æœŸæˆ–æ—¶é—´æˆ³ä¹‹é—´çš„æ•°æ®:&lt;/p&gt;

&lt;pre lang=&quot;sql&quot;&gt;&lt;code&gt;SELECT *
FROM task_instance
where execution_date between &#x27;2021-01-01&#x27; and &#x27;2021-01-31&#x27;;

-- ä¹Ÿå¯ä»¥å†™æˆæ—¶é—´æˆ³æ ¼å¼
SELECT *
FROM task_instance
WHERE execution_date BETWEEN &#x27;2021-01-01 00:00:00&#x27; AND &#x27;2021-01-31 23:59:59&#x27;;

SELECT *
FROM task_instance
WHERE execution_date &amp;gt;= &#x27;2021-01-01&#x27; AND  execution_date &amp;lt; &#x27;2021-02-01&#x27;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŸ¥è¯¢æœ€è¿‘ä¸€å‘¨çš„æ•°æ®:&lt;/p&gt;

&lt;pre lang=&quot;sql&quot;&gt;&lt;code&gt;SELECT *
FROM task_instance
WHERE execution_date &amp;gt; (now() + interval 1 week);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¹Ÿå¯ä»¥é€šè¿‡å‡½æ•°&lt;code&gt;DATE_ADD&lt;/code&gt; å’Œã€€&lt;code&gt;DATE_SUB&lt;/code&gt; æ¥è®¡ç®—æ—¶é—´&lt;/p&gt;

&lt;pre lang=&quot;sql&quot;&gt;&lt;code&gt;SELECT *
FROM task_instance
WHERE execution_date BETWEEN DATE_SUB(now(), interval 1 week) AND DATE_ADD(now(), interval 1 day);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»æ—¶é—´æˆ³é‡Œé¢æå–å¹´æœˆæ—¥æ—¶åˆ†ç§’å’Œæ˜ŸæœŸå‡ ç­‰ï¼š&lt;/p&gt;

&lt;pre lang=&quot;sql&quot;&gt;&lt;code&gt;SELECT year(now());
SELECT month(now());
SELECT day(now());
SELECT hour(now());
SELECT minute(now());
SELECT second(now());

SELECT dayofweek(now()); -- ä»å‘¨æ—¥å¼€å§‹å‘¨å…­ç»“æŸï¼Œæ‰€ä»¥ 1 æ˜¯å‘¨æ—¥
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ—¶é—´æˆ³è½¬æˆUNIXæ—¶é—´æˆ³&lt;/p&gt;

&lt;pre lang=&quot;sql&quot;&gt;&lt;code&gt;SELECT unix_timestamp(&#x27;2021-02-01&#x27;);
SELECT unix_timestamp(&#x27;2021-02-01 18:50:00&#x27;);
SELECT unix_timestamp(); -- ç­‰åŒäº SELECT unix_timestamp(now());
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è®¡ç®—ä¸¤ä¸ªæ—¶é—´å­—æ®µä¹‹é—´çš„é—´éš”&lt;/p&gt;

&lt;pre lang=&quot;sql&quot;&gt;&lt;code&gt;SELECT unix_timestamp(end_date) - unix_timestamp(start_date)
FROM task_instance;

-- ç”¨ sec_to_time å‡½æ•°è½¬æ¢æˆæ—¶åˆ†ç§’æ ¼å¼

SELECT sec_to_time(unix_timestamp(end_date) - unix_timestamp(start_date))
FROM task_instance;

-- TIMEDIFF è½¬æ¢æˆæ—¶åˆ†ç§’æ ¼å¼
SELECT TIMEDIFF(end_date, start_date)
FROM task_instance;

-- è®¡ç®—é—´éš”å¤©æ•°
SELECT DATEDIFF(&quot;2021-02-01&quot;, &quot;2020-06-30&quot;);
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
  &lt;/div&gt;
  &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>fd34722ed22c0c6cadb4bcd8ea9766ea</guid>
<title>ç¡¬ä¸ç¡¬ä½ è¯´äº†ç®—ï¼è¿‘ 40 å¼ å›¾è§£è¢«é—®åƒç™¾éçš„ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜</title>
<link>https://toutiao.io/k/3a36mkk</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;h1 cid=&quot;n0&quot; mdtype=&quot;heading&quot;&gt;&lt;span&gt;&lt;em&gt;&lt;strong&gt;æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€&lt;/strong&gt;&lt;span&gt;&lt;strong&gt;CcwwæŠ€æœ¯åšå®¢&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;ã€‘ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨å‡º&lt;/strong&gt;&lt;/em&gt;&lt;/span&gt;&lt;/h1&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span data-shimo-docs=&quot;[[20,&amp;quot;æœ¬æ–‡ç›®å½•&amp;quot;,&amp;quot;8:1&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;init\&amp;quot;&amp;quot;],[20,&amp;quot;èƒŒæ™¯&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;9crj\&amp;quot;|list-start:\&amp;quot;1\&amp;quot;|ordered:\&amp;quot;decimal\&amp;quot;&amp;quot;],[20,&amp;quot;ç®€å•å¹‚ç­‰å®ç°&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;JpMI\&amp;quot;|list-start:\&amp;quot;2\&amp;quot;|ordered:\&amp;quot;decimal\&amp;quot;&amp;quot;],[20,&amp;quot;    2.1 æ•°æ®åº“è®°å½•åˆ¤æ–­&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;No07\&amp;quot;&amp;quot;],[20,&amp;quot;    2.2 å¹¶å‘é—®é¢˜è§£å†³&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;XEao\&amp;quot;&amp;quot;],[20,&amp;quot;é€šç”¨å¹‚ç­‰å®ç°&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;57em\&amp;quot;|list-start:\&amp;quot;3\&amp;quot;|ordered:\&amp;quot;decimal\&amp;quot;&amp;quot;],[20,&amp;quot;    3.1 è®¾è®¡æ–¹æ¡ˆ&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;Djsy\&amp;quot;&amp;quot;],[20,&amp;quot;        3.1.1 é€šç”¨å­˜å‚¨&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;XVDa\&amp;quot;&amp;quot;],[20,&amp;quot;        3.1.2 ä½¿ç”¨ç®€å•&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;lAmZ\&amp;quot;&amp;quot;],[20,&amp;quot;        3.1.3 æ”¯æŒæ³¨è§£&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;FuKa\&amp;quot;&amp;quot;],[20,&amp;quot;        3.1.4 å¤šçº§å­˜å‚¨&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;gehy\&amp;quot;&amp;quot;],[20,&amp;quot;        3.1.5 å¹¶å‘è¯»å†™&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;f9PN\&amp;quot;&amp;quot;],[20,&amp;quot;        3.1.6 æ‰§è¡Œæµç¨‹&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;9IHk\&amp;quot;&amp;quot;],[20,&amp;quot;    3.2 å¹‚ç­‰æ¥å£&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;PGMT\&amp;quot;&amp;quot;],[20,&amp;quot;    3.3 å¹‚ç­‰æ³¨è§£&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;LreR\&amp;quot;&amp;quot;],[20,&amp;quot;    3.4 è‡ªåŠ¨åŒºåˆ†é‡å¤è¯·æ±‚&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;6TLO\&amp;quot;&amp;quot;],[20,&amp;quot;    3.5 å­˜å‚¨ç»“æ„&amp;quot;],[20,&amp;quot;\n&amp;quot;,&amp;quot;24:\&amp;quot;ImhL\&amp;quot;&amp;quot;],[20,&amp;quot;    3.6 æºç åœ°å€&amp;quot;]]&quot;&gt;&lt;hr/&gt;&lt;blockquote cid=&quot;n234&quot; mdtype=&quot;blockquote&quot;&gt;&lt;p cid=&quot;n238&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;è¶ŠåŠªåŠ›ï¼Œè¶Šå¹¸è¿ï¼Œ&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n239&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;æœ¬æ–‡å·²æ”¶è—åœ¨GitHubä¸­JavaCommunity, é‡Œé¢æœ‰é¢è¯•åˆ†äº«ã€æºç åˆ†æç³»åˆ—æ–‡ç« ï¼Œæ¬¢è¿æ”¶è—ï¼Œç‚¹èµ&lt;/span&gt;&lt;/p&gt;&lt;p cid=&quot;n241&quot; mdtype=&quot;paragraph&quot;&gt;&lt;span&gt;https://github.com/Ccww-lx/JavaCommunity&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;/span&gt;&lt;/h2&gt;&lt;h6&gt;&lt;span&gt;æ¯æ—¥ä¸€å¥è‹±è¯­å­¦ä¹ ï¼Œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼š&lt;/span&gt;&lt;br/&gt;&lt;/h6&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.6628664495114006&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843LuRdDiaPGWPhME1eaaeOETfz78Md5sNNzI7bHbGnhdkKiaytJZHYdNDQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;614&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;hr/&gt;&lt;h2&gt;&lt;span&gt;å‰è¨€&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;ä¸ç®¡é¢è¯• Java ã€C/C++ã€Python ç­‰å¼€å‘å²—ä½ï¼Œ &lt;code&gt;TCP&lt;/code&gt; çš„çŸ¥è¯†ç‚¹å¯ä»¥è¯´æ˜¯çš„å¿…é—®çš„äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;ä»» TCP è™æˆ‘åƒç™¾éï¼Œæˆ‘ä»å¾… TCP å¦‚åˆæ‹ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;é¥æƒ³å°æ—å½“å¹´æ ¡æ‹›æ—¶å¸¸å›  &lt;code&gt;TCP&lt;/code&gt; é¢è¯•é¢˜è¢«åˆ·ï¼ŒçœŸæ˜¯åˆçˆ±åˆç‹ â€¦.&lt;/p&gt;&lt;p&gt;è¿‡å»ä¸ä¼šæ²¡å…³ç³»ï¼Œä»Šå¤©å°±è®©æˆ‘ä»¬æ¥æ¶ˆé™¤è¿™ä»½ææƒ§ï¼Œå¾®ç¬‘ç€å‹‡æ•¢çš„é¢å¯¹å®ƒå§ï¼&lt;/p&gt;&lt;p&gt;æ‰€ä»¥å°æ—æ•´ç†äº†å…³äº &lt;strong&gt;TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„é¢è¯•é¢˜å‹&lt;/strong&gt;ï¼Œè·Ÿå¤§å®¶ä¸€èµ·æ¢è®¨æ¢è®¨ã€‚&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;TCP åŸºæœ¬è®¤è¯†&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.7391975308641975&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843PvjUjeM1AEqsdRCeZCODPM3k8fNbTe2BHlme1VmNNKlz3L0wyWcQxw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;648&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;figure&gt;&lt;br/&gt;&lt;/figure&gt;&lt;ol start=&quot;2&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;TCP è¿æ¥å»ºç«‹&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.5197568389057751&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS8439Tu5oialB8LLgGRSjD36eicoafXOgndoBLicQa4JPEQB6Ud8DZrGhvq5Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;658&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;figure&gt;&lt;br/&gt;&lt;/figure&gt;&lt;ol start=&quot;3&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;TCP è¿æ¥æ–­å¼€&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.4977168949771689&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843WyTcnaErCIbRDmRYIWoo4ug9FkN86eDcnJSkibqQ6TSMv8qIO75Xd4g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;657&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;figure&gt;&lt;br/&gt;&lt;/figure&gt;&lt;ol start=&quot;4&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Socket ç¼–ç¨‹&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.300314465408805&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843iaiaB8VOItwTI3Vibxl1Xd1bQ1CF6ymhgQEZoYtVsViaePhIc09ib93LAag/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;636&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;figure&gt;&lt;br/&gt;&lt;/figure&gt;&lt;blockquote&gt;&lt;p&gt;PSï¼šæœ¬æ¬¡æ–‡ç« ä¸æ¶‰åŠ TCP æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ã€å¯é æ€§ä¼ è¾“ç­‰æ–¹é¢çŸ¥è¯†ï¼Œè¿™äº›ç•™åœ¨ä¸‹ç¯‡å“ˆï¼&lt;/p&gt;&lt;/blockquote&gt;&lt;hr/&gt;&lt;h2&gt;&lt;span&gt;æ­£æ–‡&lt;/span&gt;&lt;/h2&gt;&lt;h3&gt;&lt;span&gt;01 TCP åŸºæœ¬è®¤è¯†&lt;/span&gt;&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;ç§ç§ TCP å¤´æ ¼å¼&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ TCP å¤´çš„æ ¼å¼ï¼Œæ ‡æ³¨é¢œè‰²çš„è¡¨ç¤ºä¸æœ¬æ–‡å…³è”æ¯”è¾ƒå¤§çš„å­—æ®µï¼Œå…¶ä»–å­—æ®µä¸åšè¯¦ç»†é˜è¿°ã€‚&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.7863247863247863&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843ZPb6tFLvCVuXEn98khfs7y2KRvOV0ia5icVByzIK3aAKRURuVZKagsKw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1053&quot; title=&quot;TCP å¤´æ ¼å¼&quot;/&gt;&lt;figcaption&gt;TCP å¤´æ ¼å¼&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;åºåˆ—å·&lt;/strong&gt;ï¼šåœ¨å»ºç«‹è¿æ¥æ—¶ç”±è®¡ç®—æœºç”Ÿæˆçš„éšæœºæ•°ä½œä¸ºå…¶åˆå§‹å€¼ï¼Œé€šè¿‡ SYN åŒ…ä¼ ç»™æ¥æ”¶ç«¯ä¸»æœºï¼Œæ¯å‘é€ä¸€æ¬¡æ•°æ®ï¼Œå°±ã€Œç´¯åŠ ã€ä¸€æ¬¡è¯¥ã€Œæ•°æ®å­—èŠ‚æ•°ã€çš„å¤§å°ã€‚&lt;strong&gt;ç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºé—®é¢˜ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;ç¡®è®¤åº”ç­”å·&lt;/strong&gt;ï¼šæŒ‡ä¸‹ä¸€æ¬¡ã€ŒæœŸæœ›ã€æ”¶åˆ°çš„æ•°æ®çš„åºåˆ—å·ï¼Œå‘é€ç«¯æ”¶åˆ°è¿™ä¸ªç¡®è®¤åº”ç­”ä»¥åå¯ä»¥è®¤ä¸ºåœ¨è¿™ä¸ªåºå·ä»¥å‰çš„æ•°æ®éƒ½å·²ç»è¢«æ­£å¸¸æ¥æ”¶ã€‚&lt;strong&gt;ç”¨æ¥è§£å†³ä¸ä¸¢åŒ…çš„é—®é¢˜ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;æ§åˆ¶ä½ï¼š&lt;/strong&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;em&gt;ACK&lt;/em&gt;ï¼šè¯¥ä½ä¸º &lt;code&gt;1&lt;/code&gt; æ—¶ï¼Œã€Œç¡®è®¤åº”ç­”ã€çš„å­—æ®µå˜ä¸ºæœ‰æ•ˆï¼ŒTCP è§„å®šé™¤äº†æœ€åˆå»ºç«‹è¿æ¥æ—¶çš„ &lt;code&gt;SYN&lt;/code&gt; åŒ…ä¹‹å¤–è¯¥ä½å¿…é¡»è®¾ç½®ä¸º &lt;code&gt;1&lt;/code&gt; ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;em&gt;RST&lt;/em&gt;ï¼šè¯¥ä½ä¸º &lt;code&gt;1&lt;/code&gt; æ—¶ï¼Œè¡¨ç¤º TCP è¿æ¥ä¸­å‡ºç°å¼‚å¸¸å¿…é¡»å¼ºåˆ¶æ–­å¼€è¿æ¥ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;em&gt;SYC&lt;/em&gt;ï¼šè¯¥ä½ä¸º &lt;code&gt;1&lt;/code&gt; æ—¶ï¼Œè¡¨ç¤ºå¸Œæœ›å»ºç«‹è¿ï¼Œå¹¶åœ¨å…¶ã€Œåºåˆ—å·ã€çš„å­—æ®µè¿›è¡Œåºåˆ—å·åˆå§‹å€¼çš„è®¾å®šã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;em&gt;FIN&lt;/em&gt;ï¼šè¯¥ä½ä¸º &lt;code&gt;1&lt;/code&gt; æ—¶ï¼Œè¡¨ç¤ºä»Šåä¸ä¼šå†æœ‰æ•°æ®å‘é€ï¼Œå¸Œæœ›æ–­å¼€è¿æ¥ã€‚å½“é€šä¿¡ç»“æŸå¸Œæœ›æ–­å¼€è¿æ¥æ—¶ï¼Œé€šä¿¡åŒæ–¹çš„ä¸»æœºä¹‹é—´å°±å¯ä»¥ç›¸äº’äº¤æ¢ &lt;code&gt;FIN&lt;/code&gt; ä½ç½®ä¸º 1 çš„ TCP æ®µã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä¸ºä»€ä¹ˆéœ€è¦ TCP åè®®ï¼ŸTCP å·¥ä½œåœ¨å“ªä¸€å±‚ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;code&gt;IP&lt;/code&gt; å±‚æ˜¯ã€Œä¸å¯é ã€çš„ï¼Œå®ƒä¸ä¿è¯ç½‘ç»œåŒ…çš„äº¤ä»˜ã€ä¸ä¿è¯ç½‘ç»œåŒ…çš„æŒ‰åºäº¤ä»˜ã€ä¹Ÿä¸ä¿è¯ç½‘ç»œåŒ…ä¸­çš„æ•°æ®çš„å®Œæ•´æ€§ã€‚&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;1.0847457627118644&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843tzTAWL4l6rZB0pulNqkLno7buMqnh5Hlphn7aibB798ga1t3a0Dqmzg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;472&quot; title=&quot;OSI å‚è€ƒæ¨¡å‹ä¸ TCP/IP çš„å…³ç³»&quot;/&gt;&lt;figcaption&gt;OSI å‚è€ƒæ¨¡å‹ä¸ TCP/IP çš„å…³ç³»&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å¦‚æœéœ€è¦ä¿éšœç½‘ç»œæ•°æ®åŒ…çš„å¯é æ€§ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”±ä¸Šå±‚ï¼ˆä¼ è¾“å±‚ï¼‰çš„ &lt;code&gt;TCP&lt;/code&gt; åè®®æ¥è´Ÿè´£ã€‚&lt;/p&gt;&lt;p&gt;å› ä¸º TCP æ˜¯ä¸€ä¸ªå·¥ä½œåœ¨&lt;strong&gt;ä¼ è¾“å±‚&lt;/strong&gt;çš„&lt;strong&gt;å¯é &lt;/strong&gt;æ•°æ®ä¼ è¾“çš„æœåŠ¡ï¼Œå®ƒèƒ½ç¡®ä¿æ¥æ”¶ç«¯æ¥æ”¶çš„ç½‘ç»œåŒ…æ˜¯&lt;strong&gt;æ— æŸåã€æ— é—´éš”ã€éå†—ä½™å’ŒæŒ‰åºçš„ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä»€ä¹ˆæ˜¯ TCP ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;TCP æ˜¯&lt;strong&gt;é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµ&lt;/strong&gt;çš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.3112244897959184&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS8438HibyWCtJ5Tn9VN7YuzgAibg46Ocdf7swUxgeKMQ9ge8Nic3WOibTSxPXA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;392&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;é¢å‘è¿æ¥&lt;/strong&gt;ï¼šä¸€å®šæ˜¯ã€Œä¸€å¯¹ä¸€ã€æ‰èƒ½è¿æ¥ï¼Œä¸èƒ½åƒ UDP åè®® å¯ä»¥ä¸€ä¸ªä¸»æœºåŒæ—¶å‘å¤šä¸ªä¸»æœºå‘é€æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯ä¸€å¯¹å¤šæ˜¯æ— æ³•åšåˆ°çš„ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;å¯é çš„&lt;/strong&gt;ï¼šæ— è®ºçš„ç½‘ç»œé“¾è·¯ä¸­å‡ºç°äº†æ€æ ·çš„é“¾è·¯å˜åŒ–ï¼ŒTCP éƒ½å¯ä»¥ä¿è¯ä¸€ä¸ªæŠ¥æ–‡ä¸€å®šèƒ½å¤Ÿåˆ°è¾¾æ¥æ”¶ç«¯ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;å­—èŠ‚æµ&lt;/strong&gt;ï¼šæ¶ˆæ¯æ˜¯ã€Œæ²¡æœ‰è¾¹ç•Œã€çš„ï¼Œæ‰€ä»¥æ— è®ºæˆ‘ä»¬æ¶ˆæ¯æœ‰å¤šå¤§éƒ½å¯ä»¥è¿›è¡Œä¼ è¾“ã€‚å¹¶ä¸”æ¶ˆæ¯æ˜¯ã€Œæœ‰åºçš„ã€ï¼Œå½“ã€Œå‰ä¸€ä¸ªã€æ¶ˆæ¯æ²¡æœ‰æ”¶åˆ°çš„æ—¶å€™ï¼Œå³ä½¿å®ƒå…ˆæ”¶åˆ°äº†åé¢çš„å­—èŠ‚å·²ç»æ”¶åˆ°ï¼Œé‚£ä¹ˆä¹Ÿä¸èƒ½æ‰”ç»™åº”ç”¨å±‚å»å¤„ç†ï¼ŒåŒæ—¶å¯¹ã€Œé‡å¤ã€çš„æŠ¥æ–‡ä¼šè‡ªåŠ¨ä¸¢å¼ƒã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;blockquote&gt;&lt;p&gt;ä»€ä¹ˆæ˜¯ TCP è¿æ¥ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹ RFC 793 æ˜¯å¦‚ä½•å®šä¹‰ã€Œè¿æ¥ã€çš„ï¼š&lt;/p&gt;&lt;p&gt;&lt;em&gt;Connections:Â &lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;The reliability and flow control mechanisms described above require
that TCPs initialize and maintain certain status information for
each data stream. Â &lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;The combination of this information, including
sockets, sequence numbers, and window sizes, is called a connection.&lt;/em&gt;&lt;/p&gt;&lt;p&gt;ç®€å•æ¥è¯´å°±æ˜¯ï¼Œ&lt;strong&gt;ç”¨äºä¿è¯å¯é æ€§å’Œæµé‡æ§åˆ¶ç»´æŠ¤çš„æŸäº›çŠ¶æ€ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯çš„ç»„åˆï¼ŒåŒ…æ‹¬Socketã€åºåˆ—å·å’Œçª—å£å¤§å°ç§°ä¸ºè¿æ¥ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.9479166666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843wVoVXxKKTibcN9sLAuSgibkDfV2X8LH8eicpV1yAJ1uffibGqAuWShXibYg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;288&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå»ºç«‹ä¸€ä¸ª TCP è¿æ¥æ˜¯éœ€è¦å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯è¾¾æˆä¸Šè¿°ä¸‰ä¸ªä¿¡æ¯çš„å…±è¯†ã€‚&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Socket&lt;/strong&gt;ï¼šç”± IP åœ°å€å’Œç«¯å£å·ç»„æˆ&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;åºåˆ—å·&lt;/strong&gt;ï¼šç”¨æ¥è§£å†³ä¹±åºé—®é¢˜ç­‰&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;çª—å£å¤§å°&lt;/strong&gt;ï¼šç”¨æ¥åšæµé‡æ§åˆ¶&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;å¦‚ä½•å”¯ä¸€ç¡®å®šä¸€ä¸ª TCP è¿æ¥å‘¢ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;TCP å››å…ƒç»„å¯ä»¥å”¯ä¸€çš„ç¡®å®šä¸€ä¸ªè¿æ¥ï¼Œå››å…ƒç»„åŒ…æ‹¬å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.2777101096224117&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843m0iaYviaJWmRyichZmR3x1gptwEsnJ6yAObqicnLkO0uNBwbYrxCoic27cA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;821&quot; title=&quot;TCP å››å…ƒç»„&quot;/&gt;&lt;figcaption&gt;TCP å››å…ƒç»„&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;æºåœ°å€å’Œç›®çš„åœ°å€çš„å­—æ®µï¼ˆ32ä½ï¼‰æ˜¯åœ¨ IP å¤´éƒ¨ä¸­ï¼Œä½œç”¨æ˜¯é€šè¿‡ IP åè®®å‘é€æŠ¥æ–‡ç»™å¯¹æ–¹ä¸»æœºã€‚&lt;/p&gt;&lt;p&gt;æºç«¯å£å’Œç›®çš„ç«¯å£çš„å­—æ®µï¼ˆ16ä½ï¼‰æ˜¯åœ¨ TCP å¤´éƒ¨ä¸­ï¼Œä½œç”¨æ˜¯å‘Šè¯‰ TCP åè®®åº”è¯¥æŠŠæŠ¥æ–‡å‘ç»™å“ªä¸ªè¿›ç¨‹ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;æœ‰ä¸€ä¸ª IP çš„æœåŠ¡å™¨ç›‘å¬äº†ä¸€ä¸ªç«¯å£ï¼Œå®ƒçš„ TCP çš„æœ€å¤§è¿æ¥æ•°æ˜¯å¤šå°‘ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;æœåŠ¡å™¨é€šå¸¸å›ºå®šåœ¨æŸä¸ªæœ¬åœ°ç«¯å£ä¸Šç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚&lt;/p&gt;&lt;p&gt;å› æ­¤ï¼Œå®¢æˆ·ç«¯ IP å’Œ ç«¯å£æ˜¯å¯å˜çš„ï¼Œå…¶ç†è®ºå€¼è®¡ç®—å…¬å¼å¦‚ä¸‹:&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.06821963394342762&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843wBh1Ca3jpEqO0Xia0YzlicCgFdhLw8N4f0TCfglTwtxzecpECvmhBtEQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;601&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;p&gt;å¯¹ IPv4ï¼Œå®¢æˆ·ç«¯çš„ IP æ•°æœ€å¤šä¸º &lt;code&gt;2&lt;/code&gt; çš„ &lt;code&gt;32&lt;/code&gt; æ¬¡æ–¹ï¼Œå®¢æˆ·ç«¯çš„ç«¯å£æ•°æœ€å¤šä¸º &lt;code&gt;2&lt;/code&gt; çš„ &lt;code&gt;16&lt;/code&gt; æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å•æœºæœ€å¤§ TCP è¿æ¥æ•°ï¼Œçº¦ä¸º &lt;code&gt;2&lt;/code&gt; çš„ &lt;code&gt;48&lt;/code&gt; æ¬¡æ–¹ã€‚&lt;/p&gt;&lt;p&gt;å½“ç„¶ï¼ŒæœåŠ¡ç«¯æœ€å¤§å¹¶å‘ TCP è¿æ¥æ•°è¿œä¸èƒ½è¾¾åˆ°ç†è®ºä¸Šé™ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;UDP å’Œ TCP æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿåˆ†åˆ«çš„åº”ç”¨åœºæ™¯æ˜¯ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;UDP ä¸æä¾›å¤æ‚çš„æ§åˆ¶æœºåˆ¶ï¼Œåˆ©ç”¨ IP æä¾›é¢å‘ã€Œæ— è¿æ¥ã€çš„é€šä¿¡æœåŠ¡ã€‚&lt;/p&gt;&lt;p&gt;UDP åè®®çœŸçš„éå¸¸ç®€ï¼Œå¤´éƒ¨åªæœ‰ &lt;code&gt;8&lt;/code&gt; ä¸ªå­—èŠ‚ï¼ˆ 64 ä½ï¼‰ï¼ŒUDP çš„å¤´éƒ¨æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.5977011494252874&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS8431Mymq2yPGjMPGodSEg8b31eoyQbibzGjDEHiaQUUDlbvCEwcXN3aicOTw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;783&quot; title=&quot;UDP å¤´éƒ¨æ ¼å¼&quot;/&gt;&lt;figcaption&gt;UDP å¤´éƒ¨æ ¼å¼&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ç›®æ ‡å’Œæºç«¯å£ï¼šä¸»è¦æ˜¯å‘Šè¯‰ UDP åè®®åº”è¯¥æŠŠæŠ¥æ–‡å‘ç»™å“ªä¸ªè¿›ç¨‹ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;åŒ…é•¿åº¦ï¼šè¯¥å­—æ®µä¿å­˜äº† UDP é¦–éƒ¨çš„é•¿åº¦è·Ÿæ•°æ®çš„é•¿åº¦ä¹‹å’Œã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æ ¡éªŒå’Œï¼šæ ¡éªŒå’Œæ˜¯ä¸ºäº†æä¾›å¯é çš„ UDP é¦–éƒ¨å’Œæ•°æ®è€Œè®¾è®¡ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;TCP å’Œ UDP åŒºåˆ«ï¼š&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;1. è¿æ¥&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;2. æœåŠ¡å¯¹è±¡&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;3. å¯é æ€§&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;4. æ‹¥å¡æ§åˆ¶ã€æµé‡æ§åˆ¶&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;5. é¦–éƒ¨å¼€é”€&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;TCP å’Œ UDP åº”ç”¨åœºæ™¯ï¼š&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;ç”±äº TCP æ˜¯é¢å‘è¿æ¥ï¼Œèƒ½ä¿è¯æ•°æ®çš„å¯é æ€§äº¤ä»˜ï¼Œå› æ­¤ç»å¸¸ç”¨äºï¼š&lt;/p&gt;&lt;p&gt;ç”±äº UDP é¢å‘æ— è¿æ¥ï¼Œå®ƒå¯ä»¥éšæ—¶å‘é€æ•°æ®ï¼Œå†åŠ ä¸ŠUDPæœ¬èº«çš„å¤„ç†æ—¢ç®€å•åˆé«˜æ•ˆï¼Œå› æ­¤ç»å¸¸ç”¨äºï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;åŒ…æ€»é‡è¾ƒå°‘çš„é€šä¿¡ï¼Œå¦‚ &lt;code&gt;DNS&lt;/code&gt; ã€&lt;code&gt;SNMP&lt;/code&gt; ç­‰&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šåª’ä½“é€šä¿¡&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å¹¿æ’­é€šä¿¡&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä¸ºä»€ä¹ˆ UDP å¤´éƒ¨æ²¡æœ‰ã€Œé¦–éƒ¨é•¿åº¦ã€å­—æ®µï¼Œè€Œ TCP å¤´éƒ¨æœ‰ã€Œé¦–éƒ¨é•¿åº¦ã€å­—æ®µå‘¢ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;åŸå› æ˜¯ TCP æœ‰&lt;strong&gt;å¯å˜é•¿&lt;/strong&gt;çš„ã€Œé€‰é¡¹ã€å­—æ®µï¼Œè€Œ UDP å¤´éƒ¨é•¿åº¦åˆ™æ˜¯&lt;strong&gt;ä¸ä¼šå˜åŒ–&lt;/strong&gt;çš„ï¼Œæ— éœ€å¤šä¸€ä¸ªå­—æ®µå»è®°å½• UDP çš„é¦–éƒ¨é•¿åº¦ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä¸ºä»€ä¹ˆ UDP å¤´éƒ¨æœ‰ã€ŒåŒ…é•¿åº¦ã€å­—æ®µï¼Œè€Œ TCP å¤´éƒ¨åˆ™æ²¡æœ‰ã€ŒåŒ…é•¿åº¦ã€å­—æ®µå‘¢ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;å…ˆè¯´è¯´ TCP æ˜¯å¦‚ä½•è®¡ç®—è´Ÿè½½æ•°æ®é•¿åº¦ï¼š&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.06156901688182721&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843bzI6JAcXCXOvBbURJoFAsBWnFrSCc8xibRxNEWerFaY8dWFJDlbYibaA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1007&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;p&gt;å…¶ä¸­ IP æ€»é•¿åº¦ å’Œ IP é¦–éƒ¨é•¿åº¦ï¼Œåœ¨ IP é¦–éƒ¨æ ¼å¼æ˜¯å·²çŸ¥çš„ã€‚TCP é¦–éƒ¨é•¿åº¦ï¼Œåˆ™æ˜¯åœ¨ TCP é¦–éƒ¨æ ¼å¼å·²çŸ¥çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥æ±‚å¾— TCP æ•°æ®çš„é•¿åº¦ã€‚&lt;/p&gt;&lt;p&gt;å¤§å®¶è¿™æ—¶å°±å¥‡æ€ªäº†é—®ï¼šâ€œ UDP ä¹Ÿæ˜¯åŸºäº IP å±‚çš„å‘€ï¼Œé‚£ UDP çš„æ•°æ®é•¿åº¦ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªå…¬å¼è®¡ç®—å‘€ï¼Ÿä¸ºä½•è¿˜è¦æœ‰ã€ŒåŒ…é•¿åº¦ã€å‘¢ï¼Ÿâ€&lt;/p&gt;&lt;p&gt;è¿™ä¹ˆä¸€é—®ï¼Œç¡®å®æ„Ÿè§‰ UDP ã€ŒåŒ…é•¿åº¦ã€æ˜¯å†—ä½™çš„ã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;å› ä¸ºä¸ºäº†ç½‘ç»œè®¾å¤‡ç¡¬ä»¶è®¾è®¡å’Œå¤„ç†æ–¹ä¾¿ï¼Œé¦–éƒ¨é•¿åº¦éœ€è¦æ˜¯ &lt;code&gt;4&lt;/code&gt;å­—èŠ‚çš„æ•´æ•°å€ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;å¦‚æœå»æ‰ UDP ã€ŒåŒ…é•¿åº¦ã€å­—æ®µï¼Œé‚£ UDP é¦–éƒ¨é•¿åº¦å°±ä¸æ˜¯ &lt;code&gt;4&lt;/code&gt; å­—èŠ‚çš„æ•´æ•°å€äº†ï¼Œæ‰€ä»¥å°æ—è§‰å¾—è¿™å¯èƒ½æ˜¯ä¸ºäº†è¡¥å…¨ UDP é¦–éƒ¨é•¿åº¦æ˜¯ &lt;code&gt;4&lt;/code&gt; å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ‰è¡¥å……äº†ã€ŒåŒ…é•¿åº¦ã€å­—æ®µã€‚&lt;/p&gt;&lt;h3&gt;&lt;span&gt;02 TCP è¿æ¥å»ºç«‹&lt;/span&gt;&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;TCP ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹å’ŒçŠ¶æ€å˜è¿&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;TCP æ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œæ‰€ä»¥ä½¿ç”¨ TCP å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œè€Œ&lt;strong&gt;å»ºç«‹è¿æ¥æ˜¯é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹è€Œè¿›è¡Œçš„ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.8339483394833949&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843fFol7gd3035Kibg3gPMSAZQLVibf9nwEblOUaX80hoOaRLVpaYCAI44w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;813&quot; title=&quot;TCP ä¸‰æ¬¡æ¡æ‰‹&quot;/&gt;&lt;figcaption&gt;TCP ä¸‰æ¬¡æ¡æ‰‹&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.6035805626598465&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843V0vbLBibXMvJbdiaqbfw4CictHX1Uc3OpOFWvZwxeI8B5Pv7y3beeAN9A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1173&quot; title=&quot;ç¬¬ä¸€ä¸ªæŠ¥æ–‡â€”â€” SYN æŠ¥æ–‡&quot;/&gt;&lt;figcaption&gt;ç¬¬ä¸€ä¸ªæŠ¥æ–‡â€”â€” SYN æŠ¥æ–‡&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.5959595959595959&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS84320oABn0E6jjsYHLicn6L5mlunbCDWGImCCHs41AWjZMnV8P1qdM99fQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1188&quot; title=&quot;ç¬¬äºŒä¸ªæŠ¥æ–‡ â€”â€” SYN + ACK æŠ¥æ–‡&quot;/&gt;&lt;figcaption&gt;ç¬¬äºŒä¸ªæŠ¥æ–‡ â€”â€” SYN + ACK æŠ¥æ–‡&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.5959595959595959&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843OM01fA1X8oZ3wpr2AV8ngpjSJcyhoTQEAFKo8UdYMr456Fb5dv0alQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1188&quot; title=&quot;ç¬¬ä¸‰ä¸ªæŠ¥æ–‡ â€”â€” ACK æŠ¥æ–‡&quot;/&gt;&lt;figcaption&gt;ç¬¬ä¸‰ä¸ªæŠ¥æ–‡ â€”â€” ACK æŠ¥æ–‡&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ä»ä¸Šé¢çš„è¿‡ç¨‹å¯ä»¥å‘ç°&lt;strong&gt;ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯å¯ä»¥æºå¸¦æ•°æ®çš„ï¼Œå‰ä¸¤æ¬¡æ¡æ‰‹æ˜¯ä¸å¯ä»¥æºå¸¦æ•°æ®çš„&lt;/strong&gt;ï¼Œè¿™ä¹Ÿæ˜¯é¢è¯•å¸¸é—®çš„é¢˜ã€‚&lt;/p&gt;&lt;p&gt;ä¸€æ—¦å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŒæ–¹éƒ½å¤„äº &lt;code&gt;ESTABLISHED&lt;/code&gt; çŠ¶æ€ï¼Œæ­¤è‡´è¿æ¥å°±å·²å»ºç«‹å®Œæˆï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±å¯ä»¥ç›¸äº’å‘é€æ•°æ®äº†ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;å¦‚ä½•åœ¨ Linux ç³»ç»Ÿä¸­æŸ¥çœ‹ TCP çŠ¶æ€ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;TCP çš„è¿æ¥çŠ¶æ€æŸ¥çœ‹ï¼Œåœ¨ Linux å¯ä»¥é€šè¿‡ &lt;code&gt;netstat -napt&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹ã€‚&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.2092130518234165&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843TdYaGI3f27nYYR47ibmH0iaV6zODCZhwpVoX7t7iasTTplcibpXXMib2DJA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1563&quot; title=&quot;TCP è¿æ¥çŠ¶æ€æŸ¥çœ‹&quot;/&gt;&lt;figcaption&gt;TCP è¿æ¥çŠ¶æ€æŸ¥çœ‹&lt;/figcaption&gt;&lt;/figure&gt;&lt;blockquote&gt;&lt;p&gt;ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸æ˜¯ä¸¤æ¬¡ã€å››æ¬¡ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;ç›¸ä¿¡å¤§å®¶æ¯”è¾ƒå¸¸å›ç­”çš„æ˜¯ï¼šâ€œå› ä¸ºä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½ä¿è¯åŒæ–¹å…·æœ‰æ¥æ”¶å’Œå‘é€çš„èƒ½åŠ›ã€‚â€&lt;/p&gt;&lt;p&gt;è¿™å›ç­”æ˜¯æ²¡é—®é¢˜ï¼Œä½†è¿™å›ç­”æ˜¯ç‰‡é¢çš„ï¼Œå¹¶æ²¡æœ‰è¯´å‡ºä¸»è¦çš„åŸå› ã€‚&lt;/p&gt;&lt;p&gt;åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯ &lt;strong&gt;TCP è¿æ¥&lt;/strong&gt;ï¼š&lt;/p&gt;&lt;p&gt;æ‰€ä»¥ï¼Œé‡è¦çš„æ˜¯&lt;strong&gt;ä¸ºä»€ä¹ˆä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åˆå§‹åŒ–Socketã€åºåˆ—å·å’Œçª—å£å¤§å°å¹¶å»ºç«‹ TCP è¿æ¥ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥ä»¥ä¸‰ä¸ªæ–¹é¢åˆ†æä¸‰æ¬¡æ¡æ‰‹çš„åŸå› ï¼š&lt;/p&gt;&lt;p&gt;&lt;em&gt;åŸå› ä¸€ï¼šé¿å…å†å²è¿æ¥&lt;/em&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹ RFC 793 æŒ‡å‡ºçš„ TCP è¿æ¥ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„&lt;strong&gt;é¦–è¦åŸå› &lt;/strong&gt;ï¼š&lt;/p&gt;&lt;p&gt;&lt;em&gt;The principle reason for the three-way handshake is to prevent old duplicate connection initiations from causing confusion.&lt;/em&gt;&lt;/p&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œä¸‰æ¬¡æ¡æ‰‹çš„&lt;strong&gt;é¦–è¦åŸå› æ˜¯ä¸ºäº†é˜²æ­¢æ—§çš„é‡å¤è¿æ¥åˆå§‹åŒ–é€ æˆæ··ä¹±ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;ç½‘ç»œç¯å¢ƒæ˜¯é”™ç»¼å¤æ‚çš„ï¼Œå¾€å¾€å¹¶ä¸æ˜¯å¦‚æˆ‘ä»¬æœŸæœ›çš„ä¸€æ ·ï¼Œå…ˆå‘é€çš„æ•°æ®åŒ…ï¼Œå°±å…ˆåˆ°è¾¾ç›®æ ‡ä¸»æœºï¼Œåè€Œå®ƒå¾ˆéªšï¼Œå¯èƒ½ä¼šç”±äºç½‘ç»œæ‹¥å µç­‰ä¹±ä¸ƒå…«ç³Ÿçš„åŸå› ï¼Œä¼šä½¿å¾—æ—§çš„æ•°æ®åŒ…ï¼Œå…ˆåˆ°è¾¾ç›®æ ‡ä¸»æœºï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ TCP ä¸‰æ¬¡æ¡æ‰‹æ˜¯å¦‚ä½•é¿å…çš„å‘¢ï¼Ÿ&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;1.3507604562737643&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS8436nKau10lAsztRqbyhjC1C1GRcsEz04icZmomMjwcxgeGn97BnKUoxibw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1052&quot; title=&quot;ä¸‰æ¬¡æ¡æ‰‹é¿å…å†å²è¿æ¥&quot;/&gt;&lt;figcaption&gt;ä¸‰æ¬¡æ¡æ‰‹é¿å…å†å²è¿æ¥&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å®¢æˆ·ç«¯è¿ç»­å‘é€å¤šæ¬¡ SYN å»ºç«‹è¿æ¥çš„æŠ¥æ–‡ï¼Œåœ¨ç½‘ç»œæ‹¥å µç­‰æƒ…å†µä¸‹ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ä¸€ä¸ªã€Œæ—§ SYN æŠ¥æ–‡ã€æ¯”ã€Œæœ€æ–°çš„ SYN ã€ æŠ¥æ–‡æ—©åˆ°è¾¾äº†æœåŠ¡ç«¯ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;é‚£ä¹ˆæ­¤æ—¶æœåŠ¡ç«¯å°±ä¼šå›ä¸€ä¸ª &lt;code&gt;SYN + ACK&lt;/code&gt; æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯æ”¶åˆ°åå¯ä»¥æ ¹æ®è‡ªèº«çš„ä¸Šä¸‹æ–‡ï¼Œåˆ¤æ–­è¿™æ˜¯ä¸€ä¸ªå†å²è¿æ¥ï¼ˆåºåˆ—å·è¿‡æœŸæˆ–è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼šå‘é€ &lt;code&gt;RST&lt;/code&gt; æŠ¥æ–‡ç»™æœåŠ¡ç«¯ï¼Œè¡¨ç¤ºä¸­æ­¢è¿™ä¸€æ¬¡è¿æ¥ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¦‚æœæ˜¯ä¸¤æ¬¡æ¡æ‰‹è¿æ¥ï¼Œå°±ä¸èƒ½åˆ¤æ–­å½“å‰è¿æ¥æ˜¯å¦æ˜¯å†å²è¿æ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹åˆ™å¯ä»¥åœ¨å®¢æˆ·ç«¯ï¼ˆå‘é€æ–¹ï¼‰å‡†å¤‡å‘é€ç¬¬ä¸‰æ¬¡æŠ¥æ–‡æ—¶ï¼Œå®¢æˆ·ç«¯å› æœ‰è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡æ¥åˆ¤æ–­å½“å‰è¿æ¥æ˜¯å¦æ˜¯å†å²è¿æ¥ï¼š&lt;/p&gt;&lt;p&gt;æ‰€ä»¥ï¼Œ TCP ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„æœ€ä¸»è¦åŸå› æ˜¯&lt;strong&gt;é˜²æ­¢å†å²è¿æ¥åˆå§‹åŒ–äº†è¿æ¥ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;åŸå› äºŒï¼šåŒæ­¥åŒæ–¹åˆå§‹åºåˆ—å·&lt;/em&gt;&lt;/p&gt;&lt;p&gt;TCP åè®®çš„é€šä¿¡åŒæ–¹ï¼Œ éƒ½å¿…é¡»ç»´æŠ¤ä¸€ä¸ªã€Œåºåˆ—å·ã€ï¼Œ åºåˆ—å·æ˜¯å¯é ä¼ è¾“çš„ä¸€ä¸ªå…³é”®å› ç´ ï¼Œå®ƒçš„ä½œç”¨ï¼š&lt;/p&gt;&lt;p&gt;å¯è§ï¼Œåºåˆ—å·åœ¨ TCP è¿æ¥ä¸­å æ®ç€éå¸¸é‡è¦çš„ä½œç”¨ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯å‘é€æºå¸¦ã€Œåˆå§‹åºåˆ—å·ã€çš„ &lt;code&gt;SYN&lt;/code&gt; æŠ¥æ–‡çš„æ—¶å€™ï¼Œéœ€è¦æœåŠ¡ç«¯å›ä¸€ä¸ª &lt;code&gt;ACK&lt;/code&gt; åº”ç­”æŠ¥æ–‡ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡å·²è¢«æœåŠ¡ç«¯æˆåŠŸæ¥æ”¶ï¼Œé‚£å½“æœåŠ¡ç«¯å‘é€ã€Œåˆå§‹åºåˆ—å·ã€ç»™å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œä¾ç„¶ä¹Ÿè¦å¾—åˆ°å®¢æˆ·ç«¯çš„åº”ç­”å›åº”ï¼Œ&lt;strong&gt;è¿™æ ·ä¸€æ¥ä¸€å›ï¼Œæ‰èƒ½ç¡®ä¿åŒæ–¹çš„åˆå§‹åºåˆ—å·èƒ½è¢«å¯é çš„åŒæ­¥ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.6567267683772539&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843HWajXhQQfx6CH4EUxLqib0AAOXolZfIvuoEDkDoXaQ3RIceibo8ia9MQQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1442&quot; title=&quot;å››æ¬¡æ¡æ‰‹ä¸ä¸‰æ¬¡æ¡æ‰‹&quot;/&gt;&lt;figcaption&gt;å››æ¬¡æ¡æ‰‹ä¸ä¸‰æ¬¡æ¡æ‰‹&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å››æ¬¡æ¡æ‰‹å…¶å®ä¹Ÿèƒ½å¤Ÿå¯é çš„åŒæ­¥åŒæ–¹çš„åˆå§‹åŒ–åºå·ï¼Œä½†ç”±äº&lt;strong&gt;ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥å¯ä»¥ä¼˜åŒ–æˆä¸€æ­¥&lt;/strong&gt;ï¼Œæ‰€ä»¥å°±æˆäº†ã€Œä¸‰æ¬¡æ¡æ‰‹ã€ã€‚&lt;/p&gt;&lt;p&gt;è€Œä¸¤æ¬¡æ¡æ‰‹åªä¿è¯äº†ä¸€æ–¹çš„åˆå§‹åºåˆ—å·èƒ½è¢«å¯¹æ–¹æˆåŠŸæ¥æ”¶ï¼Œæ²¡åŠæ³•ä¿è¯åŒæ–¹çš„åˆå§‹åºåˆ—å·éƒ½èƒ½è¢«ç¡®è®¤æ¥æ”¶ã€‚&lt;/p&gt;&lt;p&gt;&lt;em&gt;åŸå› ä¸‰ï¼šé¿å…èµ„æºæµªè´¹&lt;/em&gt;&lt;/p&gt;&lt;p&gt;å¦‚æœåªæœ‰ã€Œä¸¤æ¬¡æ¡æ‰‹ã€ï¼Œå½“å®¢æˆ·ç«¯çš„ &lt;code&gt;SYN&lt;/code&gt; è¯·æ±‚è¿æ¥åœ¨ç½‘ç»œä¸­é˜»å¡ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰æ¥æ”¶åˆ° &lt;code&gt;ACK&lt;/code&gt; æŠ¥æ–‡ï¼Œå°±ä¼šé‡æ–°å‘é€ &lt;code&gt;SYN&lt;/code&gt; ï¼Œç”±äºæ²¡æœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡å™¨ä¸æ¸…æ¥šå®¢æˆ·ç«¯æ˜¯å¦æ”¶åˆ°äº†è‡ªå·±å‘é€çš„å»ºç«‹è¿æ¥çš„ &lt;code&gt;ACK&lt;/code&gt; ç¡®è®¤ä¿¡å·ï¼Œæ‰€ä»¥æ¯æ”¶åˆ°ä¸€ä¸ª &lt;code&gt;SYN&lt;/code&gt; å°±åªèƒ½å…ˆä¸»åŠ¨å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œè¿™ä¼šé€ æˆä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ&lt;/p&gt;&lt;p&gt;å¦‚æœå®¢æˆ·ç«¯çš„ &lt;code&gt;SYN&lt;/code&gt; é˜»å¡äº†ï¼Œé‡å¤å‘é€å¤šæ¬¡ &lt;code&gt;SYN&lt;/code&gt; æŠ¥æ–‡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚åå°±ä¼š&lt;strong&gt;å»ºç«‹å¤šä¸ªå†—ä½™çš„æ— æ•ˆé“¾æ¥ï¼Œé€ æˆä¸å¿…è¦çš„èµ„æºæµªè´¹ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;1.7228195937873356&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843CaTeGEvR5jg3iaHbUTEroayMBUoK3yfy9zGwlIia8pJu8x4RDkDGFLicg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;837&quot; title=&quot;ä¸¤æ¬¡æ¡æ‰‹ä¼šé€ æˆèµ„æºæµªè´¹&quot;/&gt;&lt;figcaption&gt;ä¸¤æ¬¡æ¡æ‰‹ä¼šé€ æˆèµ„æºæµªè´¹&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å³ä¸¤æ¬¡æ¡æ‰‹ä¼šé€ æˆæ¶ˆæ¯æ»ç•™æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨é‡å¤æ¥å—æ— ç”¨çš„è¿æ¥è¯·æ±‚ &lt;code&gt;SYN&lt;/code&gt; æŠ¥æ–‡ï¼Œè€Œé€ æˆé‡å¤åˆ†é…èµ„æºã€‚&lt;/p&gt;&lt;p&gt;&lt;em&gt;å°ç»“&lt;/em&gt;&lt;/p&gt;&lt;p&gt;TCP å»ºç«‹è¿æ¥æ—¶ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹&lt;strong&gt;èƒ½é˜²æ­¢å†å²è¿æ¥çš„å»ºç«‹ï¼Œèƒ½å‡å°‘åŒæ–¹ä¸å¿…è¦çš„èµ„æºå¼€é”€ï¼Œèƒ½å¸®åŠ©åŒæ–¹åŒæ­¥åˆå§‹åŒ–åºåˆ—å·&lt;/strong&gt;ã€‚åºåˆ—å·èƒ½å¤Ÿä¿è¯æ•°æ®åŒ…ä¸é‡å¤ã€ä¸ä¸¢å¼ƒå’ŒæŒ‰åºä¼ è¾“ã€‚&lt;/p&gt;&lt;p&gt;ä¸ä½¿ç”¨ã€Œä¸¤æ¬¡æ¡æ‰‹ã€å’Œã€Œå››æ¬¡æ¡æ‰‹ã€çš„åŸå› ï¼š&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åˆå§‹åºåˆ—å· ISN æ˜¯ä¸ç›¸åŒçš„ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;å› ä¸ºç½‘ç»œä¸­çš„æŠ¥æ–‡&lt;strong&gt;ä¼šå»¶è¿Ÿã€ä¼šå¤åˆ¶é‡å‘ã€ä¹Ÿæœ‰å¯èƒ½ä¸¢å¤±&lt;/strong&gt;ï¼Œè¿™æ ·ä¼šé€ æˆçš„ä¸åŒè¿æ¥ä¹‹é—´äº§ç”Ÿäº’ç›¸å½±å“ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…äº’ç›¸å½±å“ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åˆå§‹åºåˆ—å·æ˜¯éšæœºä¸”ä¸åŒçš„ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;åˆå§‹åºåˆ—å· ISN æ˜¯å¦‚ä½•éšæœºäº§ç”Ÿçš„ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;èµ·å§‹ &lt;code&gt;ISN&lt;/code&gt; æ˜¯åŸºäºæ—¶é’Ÿçš„ï¼Œæ¯ 4 æ¯«ç§’ + 1ï¼Œè½¬ä¸€åœˆè¦ 4.55 ä¸ªå°æ—¶ã€‚&lt;/p&gt;&lt;p&gt;RFC1948 ä¸­æå‡ºäº†ä¸€ä¸ªè¾ƒå¥½çš„åˆå§‹åŒ–åºåˆ—å· ISN éšæœºç”Ÿæˆç®—æ³•ã€‚&lt;/p&gt;&lt;p&gt;&lt;em&gt;ISN = M + F (localhost, localport, remotehost, remoteport)&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;æ—¢ç„¶ IP å±‚ä¼šåˆ†ç‰‡ï¼Œä¸ºä»€ä¹ˆ TCP å±‚è¿˜éœ€è¦ MSS å‘¢ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;æˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸‹ MTU å’Œ MSS&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.39550140581068416&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS84378ic06fUySbbZgdeQ0uo6q0ulThJWexy6Bic6sJGCLVzkvXmvgjk7B2A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1067&quot; title=&quot;MTU ä¸ MSS&quot;/&gt;&lt;figcaption&gt;MTU ä¸ MSS&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å¦‚æœTCP çš„æ•´ä¸ªæŠ¥æ–‡ï¼ˆå¤´éƒ¨ + æ•°æ®ï¼‰äº¤ç»™ IP å±‚è¿›è¡Œåˆ†ç‰‡ï¼Œä¼šæœ‰ä»€ä¹ˆå¼‚å¸¸å‘¢ï¼Ÿ&lt;/p&gt;&lt;p&gt;å½“ IP å±‚æœ‰ä¸€ä¸ªè¶…è¿‡ &lt;code&gt;MTU&lt;/code&gt; å¤§å°çš„æ•°æ®ï¼ˆTCP å¤´éƒ¨ + TCP æ•°æ®ï¼‰è¦å‘é€ï¼Œé‚£ä¹ˆ IP å±‚å°±è¦è¿›è¡Œåˆ†ç‰‡ï¼ŒæŠŠæ•°æ®åˆ†ç‰‡æˆè‹¥å¹²ç‰‡ï¼Œä¿è¯æ¯ä¸€ä¸ªåˆ†ç‰‡éƒ½å°äº MTUã€‚æŠŠä¸€ä»½ IP æ•°æ®æŠ¥è¿›è¡Œåˆ†ç‰‡ä»¥åï¼Œç”±ç›®æ ‡ä¸»æœºçš„ IP å±‚æ¥è¿›è¡Œé‡æ–°ç»„è£…åï¼Œåœ¨äº¤ç»™ä¸Šä¸€å±‚ TCP ä¼ è¾“å±‚ã€‚&lt;/p&gt;&lt;p&gt;è¿™çœ‹èµ·æ¥äº•ç„¶æœ‰åºï¼Œä½†è¿™å­˜åœ¨éšæ‚£çš„ï¼Œ&lt;strong&gt;é‚£ä¹ˆå½“å¦‚æœä¸€ä¸ª IP åˆ†ç‰‡ä¸¢å¤±ï¼Œæ•´ä¸ª IP æŠ¥æ–‡çš„æ‰€æœ‰åˆ†ç‰‡éƒ½å¾—é‡ä¼ &lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;å› ä¸º IP å±‚æœ¬èº«æ²¡æœ‰è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œå®ƒç”±ä¼ è¾“å±‚çš„ TCP æ¥è´Ÿè´£è¶…æ—¶å’Œé‡ä¼ ã€‚&lt;/p&gt;&lt;p&gt;å½“æ¥æ”¶æ–¹å‘ç° TCP æŠ¥æ–‡ï¼ˆå¤´éƒ¨ + æ•°æ®ï¼‰çš„æŸä¸€ç‰‡ä¸¢å¤±åï¼Œåˆ™ä¸ä¼šå“åº” ACK ç»™å¯¹æ–¹ï¼Œé‚£ä¹ˆå‘é€æ–¹çš„ TCP åœ¨è¶…æ—¶åï¼Œå°±ä¼šé‡å‘ã€Œæ•´ä¸ª TCP æŠ¥æ–‡ï¼ˆå¤´éƒ¨ + æ•°æ®ï¼‰ã€ã€‚&lt;/p&gt;&lt;p&gt;å› æ­¤ï¼Œå¯ä»¥å¾—çŸ¥ç”± IP å±‚è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ï¼Œæ˜¯éå¸¸æ²¡æœ‰æ•ˆç‡çš„ã€‚&lt;/p&gt;&lt;p&gt;æ‰€ä»¥ï¼Œä¸ºäº†è¾¾åˆ°æœ€ä½³çš„ä¼ è¾“æ•ˆèƒ½ TCP åè®®åœ¨&lt;strong&gt;å»ºç«‹è¿æ¥çš„æ—¶å€™é€šå¸¸è¦åå•†åŒæ–¹çš„ MSS å€¼&lt;/strong&gt;ï¼Œå½“ TCP å±‚å‘ç°æ•°æ®è¶…è¿‡ MSS æ—¶ï¼Œåˆ™å°±å…ˆä¼šè¿›è¡Œåˆ†ç‰‡ï¼Œå½“ç„¶ç”±å®ƒå½¢æˆçš„ IP åŒ…çš„é•¿åº¦ä¹Ÿå°±ä¸ä¼šå¤§äº MTU ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ç”¨ IP åˆ†ç‰‡äº†ã€‚&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.12588652482269502&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843rY0QQwfo48NIMIACvuLSobQMva9xicjtGtGmcDtpPyrulyYXZLibYJjQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;564&quot; title=&quot;æ¡æ‰‹é˜¶æ®µåå•† MSS&quot;/&gt;&lt;figcaption&gt;æ¡æ‰‹é˜¶æ®µåå•† MSS&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ç»è¿‡ TCP å±‚åˆ†ç‰‡åï¼Œå¦‚æœä¸€ä¸ª TCP åˆ†ç‰‡ä¸¢å¤±åï¼Œ&lt;strong&gt;è¿›è¡Œé‡å‘æ—¶ä¹Ÿæ˜¯ä»¥ MSS ä¸ºå•ä½&lt;/strong&gt;ï¼Œè€Œä¸ç”¨é‡ä¼ æ‰€æœ‰çš„åˆ†ç‰‡ï¼Œå¤§å¤§å¢åŠ äº†é‡ä¼ çš„æ•ˆç‡ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä»€ä¹ˆæ˜¯ SYN æ”»å‡»ï¼Ÿå¦‚ä½•é¿å… SYN æ”»å‡»ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;em&gt;SYN æ”»å‡»&lt;/em&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ TCP è¿æ¥å»ºç«‹æ˜¯éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå‡è®¾æ”»å‡»è€…çŸ­æ—¶é—´ä¼ªé€ ä¸åŒ IP åœ°å€çš„ &lt;code&gt;SYN&lt;/code&gt; æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯æ¯æ¥æ”¶åˆ°ä¸€ä¸ª &lt;code&gt;SYN&lt;/code&gt; æŠ¥æ–‡ï¼Œå°±è¿›å…¥&lt;code&gt;SYN_RCVD&lt;/code&gt; çŠ¶æ€ï¼Œä½†æœåŠ¡ç«¯å‘é€å‡ºå»çš„ &lt;code&gt;ACK + SYN&lt;/code&gt; æŠ¥æ–‡ï¼Œæ— æ³•å¾—åˆ°æœªçŸ¥ IP ä¸»æœºçš„ &lt;code&gt;ACK&lt;/code&gt; åº”ç­”ï¼Œä¹…è€Œä¹…ä¹‹å°±ä¼š&lt;strong&gt;å æ»¡æœåŠ¡ç«¯çš„ SYN æ¥æ”¶é˜Ÿåˆ—ï¼ˆæœªè¿æ¥é˜Ÿåˆ—ï¼‰&lt;/strong&gt;ï¼Œä½¿å¾—æœåŠ¡å™¨ä¸èƒ½ä¸ºæ­£å¸¸ç”¨æˆ·æœåŠ¡ã€‚&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.696&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843T2LZtpQAej3iasyuMyvrDvCiazkEndRXrsk2zvcjItPFl6QNvaov3DFw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;500&quot; title=&quot;SYN æ”»å‡»&quot;/&gt;&lt;figcaption&gt;SYN æ”»å‡»&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;em&gt;é¿å… SYN æ”»å‡»æ–¹å¼ä¸€&lt;/em&gt;&lt;/p&gt;&lt;p&gt;å…¶ä¸­ä¸€ç§è§£å†³æ–¹å¼æ˜¯é€šè¿‡ä¿®æ”¹ Linux å†…æ ¸å‚æ•°ï¼Œæ§åˆ¶é˜Ÿåˆ—å¤§å°å’Œå½“é˜Ÿåˆ—æ»¡æ—¶åº”åšä»€ä¹ˆå¤„ç†ã€‚&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;net&lt;/span&gt;&lt;span&gt;.core.netdev_max_backlog&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;net&lt;/span&gt;&lt;span&gt;.ipv4.tcp_max_syn_backlog&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;net&lt;/span&gt;&lt;span&gt;.ipv4.tcp_abort_on_overflow&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;é¿å… SYN æ”»å‡»æ–¹å¼äºŒ&lt;/em&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹Linux å†…æ ¸çš„ &lt;code&gt;SYN&lt;/code&gt; ï¼ˆæœªå®Œæˆè¿æ¥å»ºç«‹ï¼‰é˜Ÿåˆ—ä¸ &lt;code&gt;Accpet&lt;/code&gt; ï¼ˆå·²å®Œæˆè¿æ¥å»ºç«‹ï¼‰é˜Ÿåˆ—æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.7042062415196744&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843ACpyQCkuFKfWROystv5qxMPs71O9FCx9GiaGmeOjCSticOKcX2ZB9p4g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;737&quot; title=&quot;æ­£å¸¸æµç¨‹&quot;/&gt;&lt;figcaption&gt;æ­£å¸¸æµç¨‹&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;æ­£å¸¸æµç¨‹ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å½“æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡æ—¶ï¼Œä¼šå°†å…¶åŠ å…¥åˆ°å†…æ ¸çš„ã€Œ SYN é˜Ÿåˆ—ã€ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æ¥ç€å‘é€ SYN + ACK ç»™å®¢æˆ·ç«¯ï¼Œç­‰å¾…å®¢æˆ·ç«¯å›åº” ACK æŠ¥æ–‡ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æœåŠ¡ç«¯æ¥æ”¶åˆ° ACK æŠ¥æ–‡åï¼Œä»ã€Œ SYN é˜Ÿåˆ—ã€ç§»é™¤æ”¾å…¥åˆ°ã€Œ Accept é˜Ÿåˆ—ã€ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;åº”ç”¨é€šè¿‡è°ƒç”¨ &lt;code&gt;accpet()&lt;/code&gt; socket æ¥å£ï¼Œä»ã€Œ Accept é˜Ÿåˆ—ã€å–å‡ºçš„è¿æ¥ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.6766623207301173&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843AthUXYfJCiakrHFc22ibjA7wmEDrkqwYEsicASXSLfAfSicmFfKicuMLBwQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;767&quot; title=&quot;åº”ç”¨ç¨‹åºè¿‡æ…¢&quot;/&gt;&lt;figcaption&gt;åº”ç”¨ç¨‹åºè¿‡æ…¢&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;åº”ç”¨ç¨‹åºè¿‡æ…¢ï¼š&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.7659846547314578&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS8432qlbW7sdxgh2Y9E2PtEibl5ORa1Dxt3JhGJTsGpzUtwMxFfuxwnNzPQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;782&quot; title=&quot;å—åˆ° SVN æ”»å‡»&quot;/&gt;&lt;figcaption&gt;å—åˆ° SYN æ”»å‡»&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å—åˆ° SYN æ”»å‡»ï¼š&lt;/p&gt;&lt;p&gt;&lt;code&gt;tcp_syncookies&lt;/code&gt; çš„æ–¹å¼å¯ä»¥åº”å¯¹ SYN æ”»å‡»çš„æ–¹æ³•ï¼š&lt;/p&gt;&lt;pre&gt;&lt;code&gt;net.ipv4.tcp_syncookiesÂ =Â 1&lt;/code&gt;&lt;/pre&gt;&lt;figure&gt;&lt;br/&gt;&lt;/figure&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.7401574803149606&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843J4ygolhCqYoh52C8EFia9QUGsEY52oGTNicruORWBg0MD7TTeIiajh0rg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;762&quot; title=&quot;tcp_syncookies åº”å¯¹ SYN æ”»å‡»&quot;/&gt;&lt;figcaption&gt;tcp_syncookies åº”å¯¹ SYN æ”»å‡»&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å½“ ã€Œ SYN é˜Ÿåˆ—ã€æ»¡ä¹‹åï¼Œåç»­æœåŠ¡å™¨æ”¶åˆ° SYN åŒ…ï¼Œä¸è¿›å…¥ã€Œ SYN é˜Ÿåˆ—ã€ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;è®¡ç®—å‡ºä¸€ä¸ª &lt;code&gt;cookie&lt;/code&gt; å€¼ï¼Œå†ä»¥ SYN + ACK ä¸­çš„ã€Œåºåˆ—å·ã€è¿”å›å®¢æˆ·ç«¯ï¼Œ&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„åº”ç­”æŠ¥æ–‡æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥è¿™ä¸ª ACK åŒ…çš„åˆæ³•æ€§ã€‚å¦‚æœåˆæ³•ï¼Œç›´æ¥æ”¾å…¥åˆ°ã€Œ Accept é˜Ÿåˆ—ã€ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æœ€ååº”ç”¨é€šè¿‡è°ƒç”¨ &lt;code&gt;accpet()&lt;/code&gt; socket æ¥å£ï¼Œä»ã€Œ Accept é˜Ÿåˆ—ã€å–å‡ºçš„è¿æ¥ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;hr/&gt;&lt;h3&gt;&lt;span&gt;03 TCP è¿æ¥æ–­å¼€&lt;/span&gt;&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;TCP å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹å’ŒçŠ¶æ€å˜è¿&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;å¤©ä¸‹æ²¡æœ‰ä¸æ•£çš„å®´å¸­ï¼Œå¯¹äº TCP è¿æ¥ä¹Ÿæ˜¯è¿™æ ·ï¼Œ TCP æ–­å¼€è¿æ¥æ˜¯é€šè¿‡&lt;strong&gt;å››æ¬¡æŒ¥æ‰‹&lt;/strong&gt;æ–¹å¼ã€‚&lt;/p&gt;&lt;p&gt;åŒæ–¹éƒ½å¯ä»¥ä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œæ–­å¼€è¿æ¥åä¸»æœºä¸­çš„ã€Œèµ„æºã€å°†è¢«é‡Šæ”¾ã€‚&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;1.0544488711819389&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843KaMMu2mHfFLZNgiaREDZ5JicRYrlaiciayQjh9HDsacxIbMT0emGUpAX5w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;753&quot; title=&quot;å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­è¿æ¥ â€”â€” TCP å››æ¬¡æŒ¥æ‰‹&quot;/&gt;&lt;figcaption&gt;å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­è¿æ¥ â€”â€” TCP å››æ¬¡æŒ¥æ‰‹&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯æ‰“ç®—å…³é—­è¿æ¥ï¼Œæ­¤æ—¶ä¼šå‘é€ä¸€ä¸ª TCP é¦–éƒ¨ &lt;code&gt;FIN&lt;/code&gt; æ ‡å¿—ä½è¢«ç½®ä¸º &lt;code&gt;1&lt;/code&gt; çš„æŠ¥æ–‡ï¼Œä¹Ÿå³ &lt;code&gt;FIN&lt;/code&gt; æŠ¥æ–‡ï¼Œä¹‹åå®¢æˆ·ç«¯è¿›å…¥ &lt;code&gt;FIN_WAIT_1&lt;/code&gt; çŠ¶æ€ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æœåŠ¡ç«¯æ”¶åˆ°è¯¥æŠ¥æ–‡åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€ &lt;code&gt;ACK&lt;/code&gt; åº”ç­”æŠ¥æ–‡ï¼Œæ¥ç€æœåŠ¡ç«¯è¿›å…¥ &lt;code&gt;CLOSED_WAIT&lt;/code&gt; çŠ¶æ€ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ &lt;code&gt;ACK&lt;/code&gt; åº”ç­”æŠ¥æ–‡åï¼Œä¹‹åè¿›å…¥ &lt;code&gt;FIN_WAIT_2&lt;/code&gt; çŠ¶æ€ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;ç­‰å¾…æœåŠ¡ç«¯å¤„ç†å®Œæ•°æ®åï¼Œä¹Ÿå‘å®¢æˆ·ç«¯å‘é€ &lt;code&gt;FIN&lt;/code&gt; æŠ¥æ–‡ï¼Œä¹‹åæœåŠ¡ç«¯è¿›å…¥ &lt;code&gt;LAST_ACK&lt;/code&gt; çŠ¶æ€ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ &lt;code&gt;FIN&lt;/code&gt; æŠ¥æ–‡åï¼Œå›ä¸€ä¸ª &lt;code&gt;ACK&lt;/code&gt; åº”ç­”æŠ¥æ–‡ï¼Œä¹‹åè¿›å…¥ &lt;code&gt;TIME_WAIT&lt;/code&gt; çŠ¶æ€&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æœåŠ¡å™¨æ”¶åˆ°äº† &lt;code&gt;ACK&lt;/code&gt; åº”ç­”æŠ¥æ–‡åï¼Œå°±è¿›å…¥äº† &lt;code&gt;CLOSE&lt;/code&gt; çŠ¶æ€ï¼Œè‡³æ­¤æœåŠ¡ç«¯å·²ç»å®Œæˆè¿æ¥çš„å…³é—­ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯åœ¨ç»è¿‡ &lt;code&gt;2MSL&lt;/code&gt; ä¸€æ®µæ—¶é—´åï¼Œè‡ªåŠ¨è¿›å…¥ &lt;code&gt;CLOSE&lt;/code&gt; çŠ¶æ€ï¼Œè‡³æ­¤å®¢æˆ·ç«¯ä¹Ÿå®Œæˆè¿æ¥çš„å…³é—­ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä½ å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªæ–¹å‘éƒ½éœ€è¦&lt;strong&gt;ä¸€ä¸ª FIN å’Œä¸€ä¸ª ACK&lt;/strong&gt;ï¼Œå› æ­¤é€šå¸¸è¢«ç§°ä¸º&lt;strong&gt;å››æ¬¡æŒ¥æ‰‹&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;è¿™é‡Œä¸€ç‚¹éœ€è¦æ³¨æ„æ˜¯ï¼š&lt;strong&gt;ä¸»åŠ¨å…³é—­è¿æ¥çš„ï¼Œæ‰æœ‰ TIME_WAIT çŠ¶æ€ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä¸ºä»€ä¹ˆæŒ¥æ‰‹éœ€è¦å››æ¬¡ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;å†æ¥å›é¡¾ä¸‹å››æ¬¡æŒ¥æ‰‹åŒæ–¹å‘ &lt;code&gt;FIN&lt;/code&gt; åŒ…çš„è¿‡ç¨‹ï¼Œå°±èƒ½ç†è§£ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡äº†ã€‚&lt;/p&gt;&lt;p&gt;ä»ä¸Šé¢è¿‡ç¨‹å¯çŸ¥ï¼ŒæœåŠ¡ç«¯é€šå¸¸éœ€è¦ç­‰å¾…å®Œæˆæ•°æ®çš„å‘é€å’Œå¤„ç†ï¼Œæ‰€ä»¥æœåŠ¡ç«¯çš„ &lt;code&gt;ACK&lt;/code&gt; å’Œ &lt;code&gt;FIN&lt;/code&gt; ä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»è€Œæ¯”ä¸‰æ¬¡æ¡æ‰‹å¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä¸ºä»€ä¹ˆ TIME_WAIT ç­‰å¾…çš„æ—¶é—´æ˜¯ 2MSLï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;code&gt;MSL&lt;/code&gt; æ˜¯ Maximum Segment Lifetimeï¼Œ&lt;strong&gt;æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´&lt;/strong&gt;ï¼Œå®ƒæ˜¯ä»»ä½•æŠ¥æ–‡åœ¨ç½‘ç»œä¸Šå­˜åœ¨çš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æŠ¥æ–‡å°†è¢«ä¸¢å¼ƒã€‚å› ä¸º TCP æŠ¥æ–‡åŸºäºæ˜¯ IP åè®®çš„ï¼Œè€Œ IP å¤´ä¸­æœ‰ä¸€ä¸ª &lt;code&gt;TTL&lt;/code&gt; å­—æ®µï¼Œæ˜¯ IP æ•°æ®æŠ¥å¯ä»¥ç»è¿‡çš„æœ€å¤§è·¯ç”±æ•°ï¼Œæ¯ç»è¿‡ä¸€ä¸ªå¤„ç†ä»–çš„è·¯ç”±å™¨æ­¤å€¼å°±å‡ 1ï¼Œå½“æ­¤å€¼ä¸º 0 åˆ™æ•°æ®æŠ¥å°†è¢«ä¸¢å¼ƒï¼ŒåŒæ—¶å‘é€ ICMP æŠ¥æ–‡é€šçŸ¥æºä¸»æœºã€‚&lt;/p&gt;&lt;p&gt;MSL ä¸ TTL çš„åŒºåˆ«ï¼šMSL çš„å•ä½æ˜¯æ—¶é—´ï¼Œè€Œ TTL æ˜¯ç»è¿‡è·¯ç”±è·³æ•°ã€‚æ‰€ä»¥ &lt;strong&gt;MSL åº”è¯¥è¦å¤§äºç­‰äº TTL æ¶ˆè€—ä¸º 0 çš„æ—¶é—´&lt;/strong&gt;ï¼Œä»¥ç¡®ä¿æŠ¥æ–‡å·²è¢«è‡ªç„¶æ¶ˆäº¡ã€‚&lt;/p&gt;&lt;p&gt;TIME_WAIT ç­‰å¾… 2 å€çš„ MSLï¼Œæ¯”è¾ƒåˆç†çš„è§£é‡Šæ˜¯ï¼šç½‘ç»œä¸­å¯èƒ½å­˜åœ¨æ¥è‡ªå‘é€æ–¹çš„æ•°æ®åŒ…ï¼Œå½“è¿™äº›å‘é€æ–¹çš„æ•°æ®åŒ…è¢«æ¥æ”¶æ–¹å¤„ç†ååˆä¼šå‘å¯¹æ–¹å‘é€å“åº”ï¼Œæ‰€ä»¥&lt;strong&gt;ä¸€æ¥ä¸€å›éœ€è¦ç­‰å¾… 2 å€çš„æ—¶é—´&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;æ¯”å¦‚ï¼Œå¦‚æœè¢«åŠ¨å…³é—­æ–¹æ²¡æœ‰æ”¶åˆ°æ–­å¼€è¿æ¥çš„æœ€åçš„ ACK æŠ¥æ–‡ï¼Œå°±ä¼šè§¦å‘è¶…æ—¶é‡å‘ Fin æŠ¥æ–‡ï¼Œå¦ä¸€æ–¹æ¥æ”¶åˆ° FIN åï¼Œä¼šé‡å‘ ACK ç»™è¢«åŠ¨å…³é—­æ–¹ï¼Œ ä¸€æ¥ä¸€å»æ­£å¥½ 2 ä¸ª MSLã€‚&lt;/p&gt;&lt;p&gt;&lt;code&gt;2MSL&lt;/code&gt; çš„æ—¶é—´æ˜¯ä»&lt;strong&gt;å®¢æˆ·ç«¯æ¥æ”¶åˆ° FIN åå‘é€ ACK å¼€å§‹è®¡æ—¶çš„&lt;/strong&gt;ã€‚å¦‚æœåœ¨ TIME-WAIT æ—¶é—´å†…ï¼Œå› ä¸ºå®¢æˆ·ç«¯çš„ ACK æ²¡æœ‰ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯åˆæ¥æ”¶åˆ°äº†æœåŠ¡ç«¯é‡å‘çš„ FIN æŠ¥æ–‡ï¼Œé‚£ä¹ˆ &lt;strong&gt;2MSL æ—¶é—´å°†é‡æ–°è®¡æ—¶&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ Linux ç³»ç»Ÿé‡Œ &lt;code&gt;2MSL&lt;/code&gt; é»˜è®¤æ˜¯ &lt;code&gt;60&lt;/code&gt; ç§’ï¼Œé‚£ä¹ˆä¸€ä¸ª &lt;code&gt;MSL&lt;/code&gt; ä¹Ÿå°±æ˜¯ &lt;code&gt;30&lt;/code&gt; ç§’ã€‚&lt;strong&gt;Linux ç³»ç»Ÿåœç•™åœ¨ TIME_WAIT çš„æ—¶é—´ä¸ºå›ºå®šçš„ 60 ç§’&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;å…¶å®šä¹‰åœ¨ Linux å†…æ ¸ä»£ç é‡Œçš„åç§°ä¸º TCP_TIMEWAIT_LENï¼š&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;#&lt;span&gt;define&lt;/span&gt;Â TCP_TIMEWAIT_LENÂ (60*HZ)Â &lt;span&gt;/*Â howÂ longÂ toÂ waitÂ toÂ destroyÂ TIME-WAITÂ &lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â state,Â aboutÂ 60Â secondsÂ Â */&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœè¦ä¿®æ”¹ TIME_WAIT çš„æ—¶é—´é•¿åº¦ï¼Œåªèƒ½ä¿®æ”¹ Linux å†…æ ¸ä»£ç é‡Œ TCP_TIMEWAIT_LEN çš„å€¼ï¼Œå¹¶é‡æ–°ç¼–è¯‘ Linux å†…æ ¸ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä¸ºä»€ä¹ˆéœ€è¦ TIME_WAIT çŠ¶æ€ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;ä¸»åŠ¨å‘èµ·å…³é—­è¿æ¥çš„ä¸€æ–¹ï¼Œæ‰ä¼šæœ‰ &lt;code&gt;TIME-WAIT&lt;/code&gt; çŠ¶æ€ã€‚&lt;/p&gt;&lt;p&gt;éœ€è¦ TIME-WAIT çŠ¶æ€ï¼Œä¸»è¦æ˜¯ä¸¤ä¸ªåŸå› ï¼š&lt;/p&gt;&lt;p&gt;&lt;em&gt;åŸå› ä¸€ï¼šé˜²æ­¢æ—§è¿æ¥çš„æ•°æ®åŒ…&lt;/em&gt;&lt;/p&gt;&lt;p&gt;å‡è®¾ TIME-WAIT æ²¡æœ‰ç­‰å¾…æ—¶é—´æˆ–æ—¶é—´è¿‡çŸ­ï¼Œè¢«å»¶è¿Ÿçš„æ•°æ®åŒ…æŠµè¾¾åä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;1.0360576923076923&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843VW5hMOGfQzFhXk6su4eND82ocOI6fKTB7dwUcuLCLIiciaTLSbjICYfw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1248&quot; title=&quot;æ¥æ”¶åˆ°å†å²æ•°æ®çš„å¼‚å¸¸&quot;/&gt;&lt;figcaption&gt;æ¥æ”¶åˆ°å†å²æ•°æ®çš„å¼‚å¸¸&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;æ‰€ä»¥ï¼ŒTCP å°±è®¾è®¡å‡ºäº†è¿™ä¹ˆä¸€ä¸ªæœºåˆ¶ï¼Œç»è¿‡ &lt;code&gt;2MSL&lt;/code&gt; è¿™ä¸ªæ—¶é—´ï¼Œ&lt;strong&gt;è¶³ä»¥è®©ä¸¤ä¸ªæ–¹å‘ä¸Šçš„æ•°æ®åŒ…éƒ½è¢«ä¸¢å¼ƒï¼Œä½¿å¾—åŸæ¥è¿æ¥çš„æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­éƒ½è‡ªç„¶æ¶ˆå¤±ï¼Œå†å‡ºç°çš„æ•°æ®åŒ…ä¸€å®šéƒ½æ˜¯æ–°å»ºç«‹è¿æ¥æ‰€äº§ç”Ÿçš„ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;åŸå› äºŒï¼šä¿è¯è¿æ¥æ­£ç¡®å…³é—­&lt;/em&gt;&lt;/p&gt;&lt;p&gt;åœ¨ RFC 793 æŒ‡å‡º TIME-WAIT å¦ä¸€ä¸ªé‡è¦çš„ä½œç”¨æ˜¯ï¼š&lt;/p&gt;&lt;p&gt;&lt;em&gt;TIME-WAIT - represents waiting for enough time to pass to be sure the remote TCP received the acknowledgment of its connection termination request.&lt;/em&gt;&lt;/p&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼ŒTIME-WAIT ä½œç”¨æ˜¯&lt;strong&gt;ç­‰å¾…è¶³å¤Ÿçš„æ—¶é—´ä»¥ç¡®ä¿æœ€åçš„ ACK èƒ½è®©è¢«åŠ¨å…³é—­æ–¹æ¥æ”¶ï¼Œä»è€Œå¸®åŠ©å…¶æ­£å¸¸å…³é—­ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;å‡è®¾ TIME-WAIT æ²¡æœ‰ç­‰å¾…æ—¶é—´æˆ–æ—¶é—´è¿‡çŸ­ï¼Œæ–­å¼€è¿æ¥ä¼šé€ æˆä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.7939093484419264&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843qohxKiaI9HTRicKXwNWLDoap0OabBhnaNeuibYrrtLvFAFWwoSgum6N2Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1412&quot; title=&quot;æ²¡æœ‰ç¡®ä¿æ­£å¸¸æ–­å¼€çš„å¼‚å¸¸&quot;/&gt;&lt;figcaption&gt;æ²¡æœ‰ç¡®ä¿æ­£å¸¸æ–­å¼€çš„å¼‚å¸¸&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å¦‚æœ TIME-WAIT ç­‰å¾…è¶³å¤Ÿé•¿çš„æƒ…å†µå°±ä¼šé‡åˆ°ä¸¤ç§æƒ…å†µï¼š&lt;/p&gt;&lt;p&gt;æ‰€ä»¥å®¢æˆ·ç«¯åœ¨ &lt;code&gt;TIME-WAIT&lt;/code&gt; çŠ¶æ€ç­‰å¾… &lt;code&gt;2MSL&lt;/code&gt; æ—¶é—´åï¼Œå°±å¯ä»¥&lt;strong&gt;ä¿è¯åŒæ–¹çš„è¿æ¥éƒ½å¯ä»¥æ­£å¸¸çš„å…³é—­ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;TIME_WAIT è¿‡å¤šæœ‰ä»€ä¹ˆå±å®³ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;å¦‚æœæœåŠ¡å™¨æœ‰å¤„äº TIME-WAIT çŠ¶æ€çš„ TCPï¼Œåˆ™è¯´æ˜æ˜¯ç”±æœåŠ¡å™¨æ–¹ä¸»åŠ¨å‘èµ·çš„æ–­å¼€è¯·æ±‚ã€‚&lt;/p&gt;&lt;p&gt;è¿‡å¤šçš„ TIME-WAIT çŠ¶æ€ä¸»è¦çš„å±å®³æœ‰ä¸¤ç§ï¼š&lt;/p&gt;&lt;p&gt;ç¬¬äºŒä¸ªå±å®³æ˜¯ä¼šé€ æˆä¸¥é‡çš„åæœçš„ï¼Œè¦çŸ¥é“ï¼Œç«¯å£èµ„æºä¹Ÿæ˜¯æœ‰é™çš„ï¼Œä¸€èˆ¬å¯ä»¥å¼€å¯çš„ç«¯å£ä¸º &lt;code&gt;32768ï½61000&lt;/code&gt;ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‚æ•°è®¾ç½®æŒ‡å®š&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;net&lt;/span&gt;&lt;span&gt;.ipv4.ip_local_port_range&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å¦‚æœæœåŠ¡ç«¯ TIME_WAIT çŠ¶æ€è¿‡å¤šï¼Œå æ»¡äº†æ‰€æœ‰ç«¯å£èµ„æºï¼Œåˆ™ä¼šå¯¼è‡´æ— æ³•åˆ›å»ºæ–°è¿æ¥ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;å¦‚ä½•ä¼˜åŒ– TIME_WAITï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;è¿™é‡Œç»™å‡ºä¼˜åŒ– TIME-WAIT çš„å‡ ä¸ªæ–¹å¼ï¼Œéƒ½æ˜¯æœ‰åˆ©æœ‰å¼Šï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æ‰“å¼€ net.ipv4.tcp_tw_reuse å’Œ net.ipv4.tcp_timestamps é€‰é¡¹ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;net.ipv4.tcp_max_tw_buckets&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ç¨‹åºä¸­ä½¿ç”¨ SO_LINGER ï¼Œåº”ç”¨å¼ºåˆ¶ä½¿ç”¨ RST å…³é—­ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;em&gt;æ–¹å¼ä¸€ï¼šnet.ipv4.tcp_tw_reuse å’Œ tcp_timestamps&lt;/em&gt;&lt;/p&gt;&lt;p&gt;å¦‚ä¸‹çš„ Linux å†…æ ¸å‚æ•°å¼€å¯åï¼Œåˆ™å¯ä»¥&lt;strong&gt;å¤ç”¨å¤„äº TIME_WAIT çš„ socket ä¸ºæ–°çš„è¿æ¥æ‰€ç”¨&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;pre&gt;&lt;code&gt;net.ipv4.tcp_tw_reuseÂ =Â 1&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œè¿˜æœ‰ä¸€ä¸ªå‰æï¼Œéœ€è¦æ‰“å¼€å¯¹ TCP æ—¶é—´æˆ³çš„æ”¯æŒï¼Œå³&lt;/p&gt;&lt;pre&gt;&lt;code&gt;net.ipv4.tcp_timestamps=1ï¼ˆé»˜è®¤å³ä¸ºÂ 1ï¼‰&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™ä¸ªæ—¶é—´æˆ³çš„å­—æ®µæ˜¯åœ¨ TCP å¤´éƒ¨çš„ã€Œé€‰é¡¹ã€é‡Œï¼Œç”¨äºè®°å½• TCP å‘é€æ–¹çš„å½“å‰æ—¶é—´æˆ³å’Œä»å¯¹ç«¯æ¥æ”¶åˆ°çš„æœ€æ–°æ—¶é—´æˆ³ã€‚&lt;/p&gt;&lt;p&gt;ç”±äºå¼•å…¥äº†æ—¶é—´æˆ³ï¼Œæˆ‘ä»¬åœ¨å‰é¢æåˆ°çš„ &lt;code&gt;2MSL&lt;/code&gt; é—®é¢˜å°±ä¸å¤å­˜åœ¨äº†ï¼Œå› ä¸ºé‡å¤çš„æ•°æ®åŒ…ä¼šå› ä¸ºæ—¶é—´æˆ³è¿‡æœŸè¢«è‡ªç„¶ä¸¢å¼ƒã€‚&lt;/p&gt;&lt;p&gt;æ¸©é¦¨æé†’ï¼š&lt;code&gt;net.ipv4.tcp_tw_reuse&lt;/code&gt;è¦æ…ç”¨ï¼Œå› ä¸ºä½¿ç”¨äº†å®ƒå°±å¿…ç„¶è¦æ‰“å¼€æ—¶é—´æˆ³çš„æ”¯æŒ &lt;code&gt;net.ipv4.tcp_timestamps&lt;/code&gt;ï¼Œ&lt;strong&gt;å½“å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¸»æœºæ—¶é—´ä¸åŒæ­¥æ—¶ï¼Œå®¢æˆ·ç«¯çš„å‘é€çš„æ¶ˆæ¯ä¼šè¢«ç›´æ¥æ‹’ç»æ‰&lt;/strong&gt;ã€‚å°æ—åœ¨å·¥ä½œä¸­å°±é‡åˆ°è¿‡ã€‚ã€‚ã€‚æ’æŸ¥äº†éå¸¸çš„ä¹…&lt;/p&gt;&lt;p&gt;&lt;em&gt;æ–¹å¼äºŒï¼šnet.ipv4.tcp_max_tw_buckets&lt;/em&gt;&lt;/p&gt;&lt;p&gt;è¿™ä¸ªå€¼é»˜è®¤ä¸º 18000ï¼Œå½“ç³»ç»Ÿä¸­å¤„äº TIME_WAIT çš„è¿æ¥&lt;strong&gt;ä¸€æ—¦è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œç³»ç»Ÿå°±ä¼šå°†æ‰€æœ‰çš„ TIME_WAIT è¿æ¥çŠ¶æ€é‡ç½®ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;è¿™ä¸ªæ–¹æ³•è¿‡äºæš´åŠ›ï¼Œè€Œä¸”æ²»æ ‡ä¸æ²»æœ¬ï¼Œå¸¦æ¥çš„é—®é¢˜è¿œæ¯”è§£å†³çš„é—®é¢˜å¤šï¼Œä¸æ¨èä½¿ç”¨ã€‚&lt;/p&gt;&lt;p&gt;&lt;em&gt;æ–¹å¼ä¸‰ï¼šç¨‹åºä¸­ä½¿ç”¨ SO_LINGER&lt;/em&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® socket é€‰é¡¹ï¼Œæ¥è®¾ç½®è°ƒç”¨ close å…³é—­è¿æ¥è¡Œä¸ºã€‚&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;struct&lt;/span&gt;Â &lt;span&gt;linger&lt;/span&gt;Â &lt;span&gt;so_linger&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;so_linger.l_onoffÂ =Â &lt;span&gt;1&lt;/span&gt;;&lt;br/&gt;so_linger.l_lingerÂ =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;setsockopt(s,Â SOL_SOCKET,Â SO_LINGER,Â &amp;amp;so_linger,&lt;span&gt;sizeof&lt;/span&gt;(so_linger));&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœ&lt;code&gt;l_onoff&lt;/code&gt;ä¸ºé 0ï¼Œ ä¸”&lt;code&gt;l_linger&lt;/code&gt;å€¼ä¸º 0ï¼Œé‚£ä¹ˆè°ƒç”¨&lt;code&gt;close&lt;/code&gt;åï¼Œä¼šç«‹è¯¥å‘é€ä¸€ä¸ª&lt;code&gt;RST&lt;/code&gt;æ ‡å¿—ç»™å¯¹ç«¯ï¼Œè¯¥ TCP è¿æ¥å°†è·³è¿‡å››æ¬¡æŒ¥æ‰‹ï¼Œä¹Ÿå°±è·³è¿‡äº†&lt;code&gt;TIME_WAIT&lt;/code&gt;çŠ¶æ€ï¼Œç›´æ¥å…³é—­ã€‚&lt;/p&gt;&lt;p&gt;ä½†è¿™ä¸ºè·¨è¶Š&lt;code&gt;TIME_WAIT&lt;/code&gt;çŠ¶æ€æä¾›äº†ä¸€ä¸ªå¯èƒ½ï¼Œä¸è¿‡æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„è¡Œä¸ºï¼Œä¸å€¼å¾—æå€¡ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;TCP æœ‰ä¸€ä¸ªæœºåˆ¶æ˜¯&lt;strong&gt;ä¿æ´»æœºåˆ¶&lt;/strong&gt;ã€‚è¿™ä¸ªæœºåˆ¶çš„åŸç†æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;&lt;p&gt;å®šä¹‰ä¸€ä¸ªæ—¶é—´æ®µï¼Œåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•è¿æ¥ç›¸å…³çš„æ´»åŠ¨ï¼ŒTCP ä¿æ´»æœºåˆ¶ä¼šå¼€å§‹ä½œç”¨ï¼Œæ¯éš”ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡ï¼Œè¯¥æ¢æµ‹æŠ¥æ–‡åŒ…å«çš„æ•°æ®éå¸¸å°‘ï¼Œå¦‚æœè¿ç»­å‡ ä¸ªæ¢æµ‹æŠ¥æ–‡éƒ½æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œåˆ™è®¤ä¸ºå½“å‰çš„ TCP è¿æ¥å·²ç»æ­»äº¡ï¼Œç³»ç»Ÿå†…æ ¸å°†é”™è¯¯ä¿¡æ¯é€šçŸ¥ç»™ä¸Šå±‚åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;&lt;p&gt;åœ¨ Linux å†…æ ¸å¯ä»¥æœ‰å¯¹åº”çš„å‚æ•°å¯ä»¥è®¾ç½®ä¿æ´»æ—¶é—´ã€ä¿æ´»æ¢æµ‹çš„æ¬¡æ•°ã€ä¿æ´»æ¢æµ‹çš„æ—¶é—´é—´éš”ï¼Œä»¥ä¸‹éƒ½ä¸ºé»˜è®¤å€¼ï¼š&lt;/p&gt;&lt;pre&gt;&lt;code&gt;net.ipv4.tcp_keepalive_time=7200&lt;br/&gt;net.ipv4.tcp_keepalive_intvl=75Â Â &lt;br/&gt;net.ipv4.tcp_keepalive_probes=9&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;tcp_keepalive_time=7200ï¼šè¡¨ç¤ºä¿æ´»æ—¶é—´æ˜¯ 7200 ç§’ï¼ˆ2å°æ—¶ï¼‰ï¼Œä¹Ÿå°± 2 å°æ—¶å†…å¦‚æœæ²¡æœ‰ä»»ä½•è¿æ¥ç›¸å…³çš„æ´»åŠ¨ï¼Œåˆ™ä¼šå¯åŠ¨ä¿æ´»æœºåˆ¶&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;tcp_keepalive_intvl=75ï¼šè¡¨ç¤ºæ¯æ¬¡æ£€æµ‹é—´éš” 75 ç§’ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;tcp_keepalive_probes=9ï¼šè¡¨ç¤ºæ£€æµ‹ 9 æ¬¡æ— å“åº”ï¼Œè®¤ä¸ºå¯¹æ–¹æ˜¯ä¸å¯è¾¾çš„ï¼Œä»è€Œä¸­æ–­æœ¬æ¬¡çš„è¿æ¥ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæœ€å°‘éœ€è¦ç»è¿‡ 2 å°æ—¶ 11 åˆ† 15 ç§’æ‰å¯ä»¥å‘ç°ä¸€ä¸ªã€Œæ­»äº¡ã€è¿æ¥ã€‚&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.3377926421404682&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843ibOkA76vK9uapCGP4jU5Kw7RBK03IhXDGAkpjT80XEMDm4uicEwNLN7g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;897&quot; title=&quot;&quot;/&gt;&lt;/figure&gt;&lt;p&gt;è¿™ä¸ªæ—¶é—´æ˜¯æœ‰ç‚¹é•¿çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å®é™…çš„éœ€æ±‚ï¼Œå¯¹ä»¥ä¸Šçš„ä¿æ´»ç›¸å…³çš„å‚æ•°è¿›è¡Œè®¾ç½®ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœå¼€å¯äº† TCP ä¿æ´»ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š&lt;/p&gt;&lt;p&gt;ç¬¬ä¸€ç§ï¼Œå¯¹ç«¯ç¨‹åºæ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯, å¯¹ç«¯ä¼šæ­£å¸¸å“åº”ï¼Œè¿™æ · &lt;strong&gt;TCP ä¿æ´»æ—¶é—´ä¼šè¢«é‡ç½®&lt;/strong&gt;ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ª TCP ä¿æ´»æ—¶é—´çš„åˆ°æ¥ã€‚&lt;/p&gt;&lt;p&gt;ç¬¬äºŒç§ï¼Œå¯¹ç«¯ç¨‹åºå´©æºƒå¹¶é‡å¯ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯åï¼Œå¯¹ç«¯æ˜¯å¯ä»¥å“åº”çš„ï¼Œä½†ç”±äºæ²¡æœ‰è¯¥è¿æ¥çš„æœ‰æ•ˆä¿¡æ¯ï¼Œ&lt;strong&gt;ä¼šäº§ç”Ÿä¸€ä¸ª RST æŠ¥æ–‡&lt;/strong&gt;ï¼Œè¿™æ ·å¾ˆå¿«å°±ä¼šå‘ç° TCP è¿æ¥å·²ç»è¢«é‡ç½®ã€‚&lt;/p&gt;&lt;p&gt;ç¬¬ä¸‰ç§ï¼Œæ˜¯å¯¹ç«¯ç¨‹åºå´©æºƒï¼Œæˆ–å¯¹ç«¯ç”±äºå…¶ä»–åŸå› å¯¼è‡´æŠ¥æ–‡ä¸å¯è¾¾ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯åï¼ŒçŸ³æ²‰å¤§æµ·ï¼Œæ²¡æœ‰å“åº”ï¼Œè¿ç»­å‡ æ¬¡ï¼Œè¾¾åˆ°ä¿æ´»æ¢æµ‹æ¬¡æ•°åï¼Œ&lt;strong&gt;TCP ä¼šæŠ¥å‘Šè¯¥ TCP è¿æ¥å·²ç»æ­»äº¡&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;hr/&gt;&lt;h3&gt;&lt;span&gt;03 Socket ç¼–ç¨‹&lt;/span&gt;&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;é’ˆå¯¹ TCP åº”è¯¥å¦‚ä½• Socket ç¼–ç¨‹ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.8476430976430976&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS8436ACEChhUgLWdrnLISt2gyF5LrC5D3yrnQHtgGQHj4iaTwUBqz4VEW5w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1188&quot; title=&quot;åŸºäº TCP åè®®çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å·¥ä½œ&quot;/&gt;&lt;figcaption&gt;åŸºäº TCP åè®®çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å·¥ä½œ&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆå§‹åŒ– &lt;code&gt;socket&lt;/code&gt;ï¼Œå¾—åˆ°æ–‡ä»¶æè¿°ç¬¦ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æœåŠ¡ç«¯è°ƒç”¨ &lt;code&gt;bind&lt;/code&gt;ï¼Œå°†ç»‘å®šåœ¨ IP åœ°å€å’Œç«¯å£;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æœåŠ¡ç«¯è°ƒç”¨ &lt;code&gt;listen&lt;/code&gt;ï¼Œè¿›è¡Œç›‘å¬ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æœåŠ¡ç«¯è°ƒç”¨ &lt;code&gt;accept&lt;/code&gt;ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯è°ƒç”¨ &lt;code&gt;connect&lt;/code&gt;ï¼Œå‘æœåŠ¡å™¨ç«¯çš„åœ°å€å’Œç«¯å£å‘èµ·è¿æ¥è¯·æ±‚ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æœåŠ¡ç«¯ &lt;code&gt;accept&lt;/code&gt; è¿”å›ç”¨äºä¼ è¾“çš„ &lt;code&gt;socket&lt;/code&gt; çš„æ–‡ä»¶æè¿°ç¬¦ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯è°ƒç”¨ &lt;code&gt;write&lt;/code&gt; å†™å…¥æ•°æ®ï¼›æœåŠ¡ç«¯è°ƒç”¨ &lt;code&gt;read&lt;/code&gt; è¯»å–æ•°æ®ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œä¼šè°ƒç”¨ &lt;code&gt;close&lt;/code&gt;ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ &lt;code&gt;read&lt;/code&gt; è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šè¯»å–åˆ°äº† &lt;code&gt;EOF&lt;/code&gt;ï¼Œå¾…å¤„ç†å®Œæ•°æ®åï¼ŒæœåŠ¡ç«¯è°ƒç”¨ &lt;code&gt;close&lt;/code&gt;ï¼Œè¡¨ç¤ºè¿æ¥å…³é—­ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡ç«¯è°ƒç”¨ &lt;code&gt;accept&lt;/code&gt; æ—¶ï¼Œè¿æ¥æˆåŠŸäº†ä¼šè¿”å›ä¸€ä¸ªå·²å®Œæˆè¿æ¥çš„ socketï¼Œåç»­ç”¨æ¥ä¼ è¾“æ•°æ®ã€‚&lt;/p&gt;&lt;p&gt;æ‰€ä»¥ï¼Œç›‘å¬çš„ socket å’ŒçœŸæ­£ç”¨æ¥ä¼ é€æ•°æ®çš„ socketï¼Œæ˜¯ã€Œä¸¤ä¸ªã€ socketï¼Œä¸€ä¸ªå«ä½œ&lt;strong&gt;ç›‘å¬ socket&lt;/strong&gt;ï¼Œä¸€ä¸ªå«ä½œ&lt;strong&gt;å·²å®Œæˆè¿æ¥ socket&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;æˆåŠŸè¿æ¥å»ºç«‹ä¹‹åï¼ŒåŒæ–¹å¼€å§‹é€šè¿‡ read å’Œ write å‡½æ•°æ¥è¯»å†™æ•°æ®ï¼Œå°±åƒå¾€ä¸€ä¸ªæ–‡ä»¶æµé‡Œé¢å†™ä¸œè¥¿ä¸€æ ·ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;listen æ—¶å€™å‚æ•° backlog çš„æ„ä¹‰ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Linuxå†…æ ¸ä¸­ä¼šç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—ï¼š&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.9334811529933481&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS8430Kt5CTsvVQ1mDUje71yzWXvib7sORcicJ97E3aDTtZoNKN41yBTGG0Qg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;902&quot; title=&quot;SYN é˜Ÿåˆ— ä¸ Accpet é˜Ÿåˆ—&quot;/&gt;&lt;figcaption&gt;SYN é˜Ÿåˆ— ä¸ Accpet é˜Ÿåˆ—&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;listen&lt;/span&gt;Â &lt;span&gt;(&lt;span&gt;int&lt;/span&gt;Â socketfd,Â &lt;span&gt;int&lt;/span&gt;Â backlog)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨æ—©æœŸ Linux å†…æ ¸ backlog æ˜¯ SYN é˜Ÿåˆ—å¤§å°ï¼Œä¹Ÿå°±æ˜¯æœªå®Œæˆçš„é˜Ÿåˆ—å¤§å°ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ Linux å†…æ ¸ 2.2 ä¹‹åï¼Œbacklog å˜æˆ accept é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯å·²å®Œæˆè¿æ¥å»ºç«‹çš„é˜Ÿåˆ—é•¿åº¦ï¼Œ&lt;strong&gt;æ‰€ä»¥ç°åœ¨é€šå¸¸è®¤ä¸º backlog æ˜¯ accept é˜Ÿåˆ—ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;accept å‘é€åœ¨ä¸‰æ¬¡æ¡æ‰‹çš„å“ªä¸€æ­¥ï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;æˆ‘ä»¬å…ˆçœ‹çœ‹å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼Œå‘é€äº†ä»€ä¹ˆï¼Ÿ&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;0.7643742953776775&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843DNG7QkUgx7nngibHCicOCGsJuxwKHodNPFRUFufaygVEyPKfRxLXyib0w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;887&quot; title=&quot;å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯&quot;/&gt;&lt;figcaption&gt;å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å®¢æˆ·ç«¯çš„åè®®æ ˆå‘æœåŠ¡å™¨ç«¯å‘é€äº† SYN åŒ…ï¼Œå¹¶å‘Šè¯‰æœåŠ¡å™¨ç«¯å½“å‰å‘é€åºåˆ—å· client_isnï¼Œå®¢æˆ·ç«¯è¿›å…¥ SYNC_SENT çŠ¶æ€ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æœåŠ¡å™¨ç«¯çš„åè®®æ ˆæ”¶åˆ°è¿™ä¸ªåŒ…ä¹‹åï¼Œå’Œå®¢æˆ·ç«¯è¿›è¡Œ ACK åº”ç­”ï¼Œåº”ç­”çš„å€¼ä¸º client_isn+1ï¼Œè¡¨ç¤ºå¯¹ SYN åŒ… client_isn çš„ç¡®è®¤ï¼ŒåŒæ—¶æœåŠ¡å™¨ä¹Ÿå‘é€ä¸€ä¸ª SYN åŒ…ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å½“å‰æˆ‘çš„å‘é€åºåˆ—å·ä¸º server_isnï¼ŒæœåŠ¡å™¨ç«¯è¿›å…¥ SYNC_RCVD çŠ¶æ€ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯åè®®æ ˆæ”¶åˆ° ACK ä¹‹åï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä» &lt;code&gt;connect&lt;/code&gt; è°ƒç”¨è¿”å›ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯çš„å•å‘è¿æ¥å»ºç«‹æˆåŠŸï¼Œå®¢æˆ·ç«¯çš„çŠ¶æ€ä¸º ESTABLISHEDï¼ŒåŒæ—¶å®¢æˆ·ç«¯åè®®æ ˆä¹Ÿä¼šå¯¹æœåŠ¡å™¨ç«¯çš„ SYN åŒ…è¿›è¡Œåº”ç­”ï¼Œåº”ç­”æ•°æ®ä¸º server_isn+1ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;åº”ç­”åŒ…åˆ°è¾¾æœåŠ¡å™¨ç«¯åï¼ŒæœåŠ¡å™¨ç«¯åè®®æ ˆä½¿å¾— &lt;code&gt;accept&lt;/code&gt; é˜»å¡è°ƒç”¨è¿”å›ï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡å™¨ç«¯åˆ°å®¢æˆ·ç«¯çš„å•å‘è¿æ¥ä¹Ÿå»ºç«‹æˆåŠŸï¼ŒæœåŠ¡å™¨ç«¯ä¹Ÿè¿›å…¥ ESTABLISHED çŠ¶æ€ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä»ä¸Šé¢çš„æè¿°è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥&lt;strong&gt;å®¢æˆ·ç«¯ connect æˆåŠŸè¿”å›æ˜¯åœ¨ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯ accept æˆåŠŸè¿”å›æ˜¯åœ¨ä¸‰æ¬¡æ¡æ‰‹æˆåŠŸä¹‹åã€‚&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;å®¢æˆ·ç«¯è°ƒç”¨ close äº†ï¼Œè¿æ¥æ˜¯æ–­å¼€çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;æˆ‘ä»¬çœ‹çœ‹å®¢æˆ·ç«¯ä¸»åŠ¨è°ƒç”¨äº† &lt;code&gt;close&lt;/code&gt;ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ&lt;/p&gt;&lt;figure&gt;&lt;img data-ratio=&quot;1.0544488711819389&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZeo9xBVAyPJ8iaWCC6sYS843MWlg2EawibAicfiaFrloAWoZRUwKrsuqZJKabqbVAvg1s92N2DHd9Msfg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;753&quot; title=&quot;å®¢æˆ·ç«¯è°ƒç”¨ close è¿‡ç¨‹&quot;/&gt;&lt;figcaption&gt;å®¢æˆ·ç«¯è°ƒç”¨ close è¿‡ç¨‹&lt;/figcaption&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯è°ƒç”¨ &lt;code&gt;close&lt;/code&gt;ï¼Œè¡¨æ˜å®¢æˆ·ç«¯æ²¡æœ‰æ•°æ®éœ€è¦å‘é€äº†ï¼Œåˆ™æ­¤æ—¶ä¼šå‘æœåŠ¡ç«¯å‘é€ FIN æŠ¥æ–‡ï¼Œè¿›å…¥ FIN_WAIT_1 çŠ¶æ€ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æœåŠ¡ç«¯æ¥æ”¶åˆ°äº† FIN æŠ¥æ–‡ï¼ŒTCP åè®®æ ˆä¼šä¸º FIN åŒ…æ’å…¥ä¸€ä¸ªæ–‡ä»¶ç»“æŸç¬¦ &lt;code&gt;EOF&lt;/code&gt; åˆ°æ¥æ”¶ç¼“å†²åŒºä¸­ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ &lt;code&gt;read&lt;/code&gt; è°ƒç”¨æ¥æ„ŸçŸ¥è¿™ä¸ª FIN åŒ…ã€‚è¿™ä¸ª &lt;code&gt;EOF&lt;/code&gt; ä¼šè¢«&lt;strong&gt;æ”¾åœ¨å·²æ’é˜Ÿç­‰å€™çš„å…¶ä»–å·²æ¥æ”¶çš„æ•°æ®ä¹‹å&lt;/strong&gt;ï¼Œè¿™å°±æ„å‘³ç€æœåŠ¡ç«¯éœ€è¦å¤„ç†è¿™ç§å¼‚å¸¸æƒ…å†µï¼Œå› ä¸º EOF è¡¨ç¤ºåœ¨è¯¥è¿æ¥ä¸Šå†æ— é¢å¤–æ•°æ®åˆ°è¾¾ã€‚æ­¤æ—¶ï¼ŒæœåŠ¡ç«¯è¿›å…¥ CLOSE_WAIT çŠ¶æ€ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ¥ç€ï¼Œå½“å¤„ç†å®Œæ•°æ®åï¼Œè‡ªç„¶å°±ä¼šè¯»åˆ° &lt;code&gt;EOF&lt;/code&gt;ï¼Œäºæ˜¯ä¹Ÿè°ƒç”¨ &lt;code&gt;close&lt;/code&gt; å…³é—­å®ƒçš„å¥—æ¥å­—ï¼Œè¿™ä¼šä½¿å¾—ä¼šå‘å‡ºä¸€ä¸ª FIN åŒ…ï¼Œä¹‹åå¤„äº LAST_ACK çŠ¶æ€ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„ FIN åŒ…ï¼Œå¹¶å‘é€ ACK ç¡®è®¤åŒ…ç»™æœåŠ¡ç«¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å°†è¿›å…¥ TIME_WAIT çŠ¶æ€ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æœåŠ¡ç«¯æ”¶åˆ° ACK ç¡®è®¤åŒ…åï¼Œå°±è¿›å…¥äº†æœ€åçš„ CLOSE çŠ¶æ€ï¼›&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯è¿›è¿‡ &lt;code&gt;2MSL&lt;/code&gt; æ—¶é—´ä¹‹åï¼Œä¹Ÿè¿›å…¥ CLOSED çŠ¶æ€ï¼›&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;hr/&gt;&lt;h6&gt;&lt;span&gt;å·¨äººçš„è‚©è†€&lt;/span&gt;&lt;/h6&gt;&lt;p&gt;&lt;span&gt;[1] è¶£è°ˆç½‘ç»œåè®®ä¸“æ .åˆ˜è¶….æå®¢æ—¶é—´.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[2] ç½‘ç»œç¼–ç¨‹å®æˆ˜ä¸“æ .ç››å»¶æ•.æå®¢æ—¶é—´.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[3] è®¡ç®—æœºç½‘ç»œ-è‡ªé¡¶å‘ä¸‹æ–¹æ³•.é™ˆé¸£ è¯‘.æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[4] TCP/IPè¯¦è§£ å·1ï¼šåè®®.èŒƒå»ºå è¯‘.æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[5] å›¾è§£TCP/IP.ç«¹ä¸‹éš†å².äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[6] https://www.rfc-editor.org/rfc/rfc793.html&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[7] https://draveness.me/whys-the-design-tcp-three-way-handshake&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[9] https://draveness.me/whys-the-design-tcp-time-wait&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>6e34c02296cd253309bd154134d4dad1</guid>
<title>æ¡åˆ†ç¼•æ Raft ç®—æ³•</title>
<link>https://toutiao.io/k/pa5a9hf</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p&gt;&lt;em&gt;&lt;strong data-darkmode-bgcolor-16068282692859=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16068282692859=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16068282692859=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16068282692859=&quot;rgb(0, 0, 0)&quot; data-style=&quot;max-width: 100%; font-size: medium; letter-spacing: 0.544px; text-align: start; white-space: normal; caret-color: rgb(52, 73, 94); background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: -apple-system-font, system-ui, &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei UI&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; visibility: visible; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__1&quot; data-darkmode-color-16094149065186=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16094149065186=&quot;rgb(0, 0, 0)&quot; data-darkmode-color-16107273892940=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16107273892940=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)&quot; data-darkmode-color-16121907968588=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16121907968588=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)&quot; data-darkmode-bgcolor-16121907968588=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16121907968588=&quot;#fff|rgb(255, 255, 255)&quot;&gt;&lt;span data-darkmode-bgcolor-16068282692859=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16068282692859=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16068282692859=&quot;rgb(136, 136, 136)&quot; data-darkmode-original-color-16068282692859=&quot;rgb(136, 136, 136)&quot; data-darkmode-color-16094149065186=&quot;rgb(136, 136, 136)&quot; data-darkmode-original-color-16094149065186=&quot;rgb(136, 136, 136)&quot; data-darkmode-color-16107273892940=&quot;rgb(136, 136, 136)&quot; data-darkmode-original-color-16107273892940=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)|rgb(136, 136, 136)&quot; data-darkmode-color-16121907968588=&quot;rgb(136, 136, 136)&quot; data-darkmode-original-color-16121907968588=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)|rgb(136, 136, 136)&quot; data-darkmode-bgcolor-16121907968588=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16121907968588=&quot;#fff|rgb(255, 255, 255)&quot;&gt;&lt;span data-darkmode-bgcolor-16068282692859=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16068282692859=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16068282692859=&quot;rgb(217, 33, 66)&quot; data-darkmode-original-color-16068282692859=&quot;rgb(217, 33, 66)&quot; data-darkmode-color-16094149065186=&quot;rgb(217, 33, 66)&quot; data-darkmode-original-color-16094149065186=&quot;rgb(217, 33, 66)&quot; data-darkmode-color-16107273892940=&quot;rgb(217, 33, 66)&quot; data-darkmode-original-color-16107273892940=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)|rgb(136, 136, 136)|rgb(217, 33, 66)&quot; data-darkmode-color-16121907968588=&quot;rgb(217, 33, 66)&quot; data-darkmode-original-color-16121907968588=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)|rgb(136, 136, 136)|rgb(217, 33, 66)&quot; data-darkmode-bgcolor-16121907968588=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16121907968588=&quot;#fff|rgb(255, 255, 255)&quot;&gt;â–²Â &lt;/span&gt;&lt;span data-darkmode-bgcolor-16068282692859=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16068282692859=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16068282692859=&quot;rgb(39, 84, 255)&quot; data-darkmode-original-color-16068282692859=&quot;rgb(2, 30, 170)&quot; data-style=&quot;max-width: 100%; color: rgb(2, 30, 170); text-align: center; font-size: 11px; letter-spacing: 1px; visibility: visible; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__2&quot; data-darkmode-color-16094149065186=&quot;rgb(39, 84, 255)&quot; data-darkmode-original-color-16094149065186=&quot;rgb(2, 30, 170)&quot; data-darkmode-color-16107273892940=&quot;rgb(39, 84, 255)&quot; data-darkmode-original-color-16107273892940=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)|rgb(136, 136, 136)|rgb(2, 30, 170)&quot; data-darkmode-color-16121907968588=&quot;rgb(39, 84, 255)&quot; data-darkmode-original-color-16121907968588=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)|rgb(136, 136, 136)|rgb(2, 30, 170)&quot; data-darkmode-bgcolor-16121907968588=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16121907968588=&quot;#fff|rgb(255, 255, 255)&quot;&gt;ç‚¹å‡»ä¸Šæ–¹&quot;å¤šé¢—ç³–&quot;&lt;/span&gt;&lt;span data-darkmode-bgcolor-16068282692859=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16068282692859=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16068282692859=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16068282692859=&quot;rgb(62, 62, 62)&quot; data-style=&quot;max-width: 100%; color: rgb(62, 62, 62); text-align: center; font-size: 11px; letter-spacing: 1px; visibility: visible; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__3&quot; data-darkmode-color-16094149065186=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16094149065186=&quot;rgb(62, 62, 62)&quot; data-darkmode-color-16107273892940=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16107273892940=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)|rgb(136, 136, 136)|rgb(62, 62, 62)&quot; data-darkmode-color-16121907968588=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16121907968588=&quot;#fff|rgb(52, 73, 94)|rgb(0, 0, 0)|rgb(136, 136, 136)|rgb(62, 62, 62)&quot; data-darkmode-bgcolor-16121907968588=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16121907968588=&quot;#fff|rgb(255, 255, 255)&quot;&gt;å…³æ³¨å…¬ä¼—å·&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;æœ¬æ–‡æ•´ç†è‡ª Ongaro åœ¨ Youtube ä¸Šçš„è§†é¢‘ã€‚&lt;/em&gt;&lt;/p&gt;&lt;h2&gt;ç›®æ ‡&lt;/h2&gt;&lt;p&gt;Raft çš„ç›®æ ‡ï¼ˆæˆ–è€…è¯´æ˜¯åˆ†å¸ƒå¼å…±è¯†ç®—æ³•çš„ç›®æ ‡ï¼‰æ˜¯ï¼š&lt;strong&gt;ä¿è¯ log å®Œå…¨ç›¸åŒåœ°å¤åˆ¶åˆ°å¤šå°æœåŠ¡å™¨ä¸Š&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.35764235764235763&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic3906cUlV5niaAMrHFXiaoZph1eCmsAibK2JKOx42wWoB4KpFH3XMmvPkRDag/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2002&quot;/&gt;&lt;/p&gt;&lt;p&gt;åªè¦æ¯å°æœåŠ¡å™¨çš„æ—¥å¿—ç›¸åŒï¼Œé‚£ä¹ˆï¼Œåœ¨ä¸åŒæœåŠ¡å™¨ä¸Šçš„çŠ¶æ€æœºä»¥ç›¸åŒé¡ºåºä»æ—¥å¿—ä¸­æ‰§è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œå°†ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚&lt;/p&gt;&lt;p&gt;å…±è¯†ç®—æ³•çš„å·¥ä½œå°±æ˜¯ç®¡ç†è¿™äº›æ—¥å¿—ã€‚&lt;/p&gt;&lt;h2&gt;ç³»ç»Ÿæ¨¡å‹&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬å‡è®¾ï¼š&lt;/p&gt;&lt;p&gt;Raft æ˜¯åŸºäº Leader çš„å…±è¯†ç®—æ³•ï¼Œæ•…ä¸»è¦è€ƒè™‘ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;Leader æ­£å¸¸è¿è¡Œ&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Leader æ•…éšœï¼Œå¿…é¡»é€‰å‡ºæ–°çš„ Leader&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä¼˜ç‚¹ï¼šåªæœ‰ä¸€ä¸ª Leaderï¼Œç®€å•ã€‚&lt;/p&gt;&lt;p&gt;éš¾ç‚¹ï¼š&lt;strong&gt;Leader å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå¯èƒ½ä¼šä½¿ç³»ç»Ÿå¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œå› æ­¤ï¼Œä¸‹ä¸€ä»» Leader å¿…é¡»è¿›è¡Œæ¸…ç†ï¼›&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬å°†ä» 6 ä¸ªéƒ¨åˆ†è§£é‡Š Raftï¼š&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;Leader é€‰ä¸¾ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ­£å¸¸è¿è¡Œï¼šæ—¥å¿—å¤åˆ¶ï¼ˆæœ€ç®€å•çš„éƒ¨åˆ†ï¼‰ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Leader å˜æ›´æ—¶çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ï¼ˆæœ€æ£˜æ‰‹ã€æœ€å…³é”®çš„éƒ¨åˆ†ï¼‰ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å¤„ç†æ—§ Leaderï¼šæ—§çš„ Leader å¹¶æ²¡æœ‰çœŸçš„ä¸‹çº¿æ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯äº¤äº’ï¼šå®ç°çº¿æ€§åŒ–è¯­ä¹‰(linearizable semantics)ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;é…ç½®å˜æ›´ï¼šå¦‚ä½•åœ¨é›†ç¾¤ä¸­å¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹ï¼›&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;å¼€å§‹ä¹‹å‰&lt;/h2&gt;&lt;p&gt;å¼€å§‹ä¹‹å‰éœ€è¦äº†è§£ Raft çš„ä¸€äº›æœ¯è¯­ã€‚&lt;/p&gt;&lt;h3&gt;æœåŠ¡å™¨çŠ¶æ€&lt;/h3&gt;&lt;p&gt;æœåŠ¡å™¨åœ¨ä»»æ„æ—¶é—´åªèƒ½å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;Leaderï¼šå¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ã€æ—¥å¿—å¤åˆ¶ã€‚åŒä¸€æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå¯è¡Œçš„ Leaderï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Followerï¼šå®Œå…¨è¢«åŠ¨çš„ï¼ˆä¸å‘é€ RPCï¼Œåªå“åº”æ”¶åˆ°çš„ RPCï¼‰â€”â€”å¤§å¤šæ•°æœåŠ¡å™¨åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¤„äºæ­¤çŠ¶æ€ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Candidateï¼šç”¨æ¥é€‰ä¸¾æ–°çš„ Leaderï¼Œå¤„äº Leader å’Œ Follower ä¹‹é—´çš„æš‚æ—¶çŠ¶æ€ï¼›&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶ï¼Œåªæœ‰ä¸€ä¸ª Leaderï¼Œå…¶ä½™éƒ½æ˜¯ Followers.&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;çŠ¶æ€è½¬æ¢å›¾ï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.35294117647058826&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390aEUv3yVxXicGYHqKxO1T39O352iaWyduWTO35Id0FuBia9zo4k0jMRbfQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1870&quot;/&gt;&lt;/p&gt;&lt;h3&gt;ä»»æœŸ&lt;/h3&gt;&lt;p&gt;æ—¶é—´è¢«åˆ’åˆ†æˆä¸€ä¸ªä¸ªçš„&lt;strong&gt;ä»»æœŸ(Term)&lt;/strong&gt;ï¼Œæ¯ä¸ªä»»æœŸéƒ½ç”±ä¸€ä¸ªæ•°å­—æ¥è¡¨ç¤ºä»»æœŸå·ï¼Œä»»æœŸå·å•è°ƒé€’å¢å¹¶ä¸”æ°¸è¿œä¸ä¼šé‡å¤ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.2598639455782313&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390uhbZCcaTLmEoQSMpAXoUQGkiaDxByGt0wpiaK51hPZ42icoIONzIdnMOg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1470&quot;/&gt;&lt;/p&gt;&lt;p&gt;ä¸€ä¸ªæ­£å¸¸çš„ä»»æœŸè‡³å°‘æœ‰ä¸€ä¸ª Leaderï¼Œé€šå¸¸åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š&lt;/p&gt;&lt;p&gt;æœ‰äº›ä»»æœŸå¯èƒ½æ²¡æœ‰é€‰å‡º Leaderï¼ˆå¦‚å›¾ Term 3ï¼‰ï¼Œè¿™æ—¶å€™ä¼šç«‹å³è¿›å…¥ä¸‹ä¸€ä¸ªä»»æœŸï¼Œå†æ¬¡å°è¯•é€‰å‡ºä¸€ä¸ª Leaderã€‚&lt;/p&gt;&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªÂ &lt;code&gt;currentTerm&lt;/code&gt;Â å˜é‡ï¼Œè¡¨ç¤ºç³»ç»Ÿä¸­å½“å‰ä»»æœŸã€‚&lt;code&gt;currentTerm&lt;/code&gt;Â &lt;strong&gt;å¿…é¡»æŒä¹…åŒ–å­˜å‚¨&lt;/strong&gt;ï¼Œä»¥ä¾¿åœ¨æœåŠ¡å™¨å®•æœºé‡å¯æ—¶å°†å…¶æ¢å¤ã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;ä»»æœŸéå¸¸é‡è¦ï¼ä»»æœŸèƒ½å¤Ÿå¸®åŠ© Raft è¯†åˆ«è¿‡æœŸçš„ä¿¡æ¯ã€‚&lt;/strong&gt;ä¾‹å¦‚ï¼šå¦‚æœÂ &lt;code&gt;currentTerm = 2&lt;/code&gt;Â çš„èŠ‚ç‚¹ä¸Â &lt;code&gt;currentTerm = 3&lt;/code&gt;Â çš„èŠ‚ç‚¹é€šä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„ä¿¡æ¯æ˜¯è¿‡æ—¶çš„ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬åªä½¿ç”¨æœ€æ–°ä»»æœŸçš„ä¿¡æ¯ã€‚åé¢æˆ‘ä»¬ä¼šé‡åˆ°å„ç§æƒ…å†µï¼Œå»æ£€æµ‹å’Œæ¶ˆé™¤ä¸æ˜¯æœ€æ–°ä»»æœŸçš„ä¿¡æ¯ã€‚&lt;/p&gt;&lt;h3&gt;ä¸¤ä¸ª RPC&lt;/h3&gt;&lt;p&gt;Raft ä¸­æœåŠ¡å™¨ä¹‹é—´æ‰€æœ‰ç±»å‹çš„é€šä¿¡é€šè¿‡ä¸¤ä¸ª RPC è°ƒç”¨ï¼š&lt;/p&gt;&lt;h2&gt;1. Leader é€‰ä¸¾&lt;/h2&gt;&lt;h3&gt;å¯åŠ¨&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.46091954022988507&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390rbmR4QTiaecDNuhI7ibM57cDRA9sTmicGhIVicCQgTf7P5mZGD4DAjnO6A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1740&quot;/&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;èŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œéƒ½æ˜¯ Follower çŠ¶æ€ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Follower è¢«åŠ¨åœ°æ¥å— Leader æˆ– Candidate çš„ RPCï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ‰€ä»¥ï¼Œå¦‚æœ Leader æƒ³è¦ä¿æŒæƒå¨ï¼Œå¿…é¡»å‘é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹å‘é€å¿ƒè·³åŒ…ï¼ˆç©ºçš„Â &lt;code&gt;AppendEntries RPC&lt;/code&gt;ï¼‰ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;ç­‰å¾…é€‰ä¸¾è¶…æ—¶(&lt;code&gt;electionTimeout&lt;/code&gt;ï¼Œä¸€èˆ¬åœ¨ 100~500ms)åï¼ŒFollower æ²¡æœ‰æ”¶åˆ°ä»»ä½• RPCï¼š&lt;/p&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;Follower è®¤ä¸ºé›†ç¾¤ä¸­æ²¡æœ‰ Leader&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å¼€å§‹æ–°çš„ä¸€è½®é€‰ä¸¾&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h3&gt;é€‰ä¸¾&lt;/h3&gt;&lt;p&gt;å½“ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹ç«é€‰ï¼š&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;è·å¾—è¶…è¿‡åŠæ•°çš„é€‰ç¥¨ï¼šæˆä¸º Leaderï¼Œå¹¶å‘å…¶å®ƒèŠ‚ç‚¹å‘é€Â &lt;code&gt;AppendEntries&lt;/code&gt;Â å¿ƒè·³ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ”¶åˆ°æ¥è‡ª Leader çš„ RPCï¼šè½¬ä¸º Followerï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å…¶å®ƒä¸¤ç§æƒ…å†µéƒ½æ²¡å‘ç”Ÿï¼Œæ²¡äººèƒ½å¤Ÿè·èƒœ(&lt;code&gt;electionTimeout&lt;/code&gt;Â å·²è¿‡)ï¼šå¢åŠ Â &lt;code&gt;currentTerm&lt;/code&gt;ï¼Œå¼€å§‹æ–°ä¸€è½®é€‰ä¸¾ï¼›&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;æµç¨‹å›¾å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.6734317343173432&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390u9eAcpaF6WrF5bZibUibrISnFXeAR6CG9qsiatTyLpApAxXpyCh2H54Jg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1084&quot;/&gt;&lt;/p&gt;&lt;h3&gt;é€‰ä¸¾å®‰å…¨æ€§&lt;/h3&gt;&lt;p&gt;é€‰ä¸¾è¿‡ç¨‹éœ€è¦ä¿è¯ä¸¤ä¸ªç‰¹æ€§ï¼š&lt;strong&gt;å®‰å…¨æ€§(safety)&lt;/strong&gt;å’Œ&lt;strong&gt;æ´»æ€§(liveness)&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;å®‰å…¨æ€§(safety)ï¼šä¸€ä¸ªä»»æœŸå†…åªä¼šæœ‰ä¸€ä¸ª Leader è¢«é€‰ä¸¾å‡ºæ¥ã€‚éœ€è¦ä¿è¯ï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.14987405541561713&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390ibL530UicXPKyYtOfmakUbHbL4PL3E7uYrHapxxfw5bT0iaaNjib26icbhw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1588&quot;/&gt;&lt;/p&gt;&lt;p&gt;æ´»æ€§(liveness)ï¼šç¡®ä¿æœ€ç»ˆèƒ½é€‰å‡ºä¸€ä¸ª Leaderã€‚&lt;/p&gt;&lt;p&gt;é—®é¢˜æ˜¯ï¼šåŸåˆ™ä¸Šæˆ‘ä»¬å¯ä»¥æ— é™é‡å¤åˆ†å‰²é€‰ç¥¨ï¼Œå‡å¦‚é€‰ä¸¾åŒä¸€æ—¶é—´å¼€å§‹ï¼ŒåŒä¸€æ—¶é—´è¶…æ—¶ï¼ŒåŒä¸€æ—¶é—´å†æ¬¡é€‰ä¸¾ï¼Œå¦‚æ­¤å¾ªç¯ã€‚&lt;/p&gt;&lt;p&gt;è§£å†³åŠæ³•å¾ˆç®€å•ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;èŠ‚ç‚¹éšæœºé€‰æ‹©è¶…æ—¶æ—¶é—´ï¼Œé€šå¸¸åœ¨ [T, 2T] ä¹‹é—´ï¼ˆT =Â &lt;code&gt;electionTimeout&lt;/code&gt;ï¼‰&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;è¿™æ ·ï¼ŒèŠ‚ç‚¹ä¸å¤ªå¯èƒ½å†åŒæ—¶å¼€å§‹ç«é€‰ï¼Œå…ˆç«é€‰çš„èŠ‚ç‚¹æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥ç´¢è¦å…¶ä»–èŠ‚ç‚¹çš„é€‰ç¥¨&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;T &amp;gt;&amp;gt; broadcast time(T è¿œå¤§äºå¹¿æ’­æ—¶é—´)æ—¶æ•ˆæœæ›´ä½³&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;2. æ—¥å¿—å¤åˆ¶&lt;/h2&gt;&lt;h3&gt;æ—¥å¿—ç»“æ„&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.42492639842983315&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390VOTs4VxN2O2SnQFFmHSoBnyZdYl3FIURs9Lc9icodlnKEMib9nQGbAibw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2038&quot;/&gt;&lt;/p&gt;&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨è‡ªå·±çš„æ—¥å¿—å‰¯æœ¬(&lt;code&gt;log[]&lt;/code&gt;)ï¼Œæ¯æ¡æ—¥å¿—è®°å½•åŒ…å«ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;ç´¢å¼•ï¼šè¯¥è®°å½•åœ¨æ—¥å¿—ä¸­çš„ä½ç½®&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;ä»»æœŸå·ï¼šè¯¥è®°å½•é¦–æ¬¡è¢«åˆ›å»ºæ—¶çš„ä»»æœŸå·&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å‘½ä»¤&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;æ—¥å¿—å¿…é¡»æŒä¹…åŒ–å­˜å‚¨ã€‚&lt;/strong&gt;ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»å…ˆå°†è®°å½•å®‰å…¨å†™åˆ°ç£ç›˜ï¼Œæ‰èƒ½å‘ç³»ç»Ÿä¸­å…¶ä»–èŠ‚ç‚¹è¿”å›å“åº”ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœä¸€æ¡æ—¥å¿—è®°å½•è¢«å­˜å‚¨åœ¨è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹ä¸Šï¼Œæˆ‘ä»¬è®¤ä¸ºè¯¥è®°å½•&lt;strong&gt;å·²æäº¤&lt;/strong&gt;(&lt;code&gt;committed&lt;/code&gt;)â€”â€”è¿™æ˜¯ Raft éå¸¸é‡è¦çš„ç‰¹æ€§ï¼å¦‚æœä¸€æ¡è®°å½•å·²æäº¤ï¼Œæ„å‘³ç€çŠ¶æ€æœºå¯ä»¥å®‰å…¨åœ°æ‰§è¡Œè¯¥è®°å½•ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ä¸Šå›¾ä¸­ï¼Œç¬¬ 1-7 æ¡è®°å½•è¢«æäº¤ï¼Œç¬¬ 8 æ¡å°šæœªæäº¤ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;æé†’ï¼šå¤šæ•°æ´¾å¤åˆ¶äº†æ—¥å¿—å³å·²æäº¤ï¼Œè¿™ä¸ªå®šä¹‰å¹¶ä¸ç²¾ç¡®ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢ç¨ä½œä¿®æ”¹ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h3&gt;æ­£å¸¸è¿è¡Œ&lt;/h3&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;å®¢æˆ·ç«¯å‘ Leader å‘é€å‘½ä»¤ï¼Œå¸Œæœ›è¯¥å‘½ä»¤è¢«æ‰€æœ‰çŠ¶æ€æœºæ‰§è¡Œï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Leader å…ˆå°†è¯¥å‘½ä»¤è¿½åŠ åˆ°è‡ªå·±çš„æ—¥å¿—ä¸­ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Leader å¹¶è¡Œåœ°å‘å…¶å®ƒèŠ‚ç‚¹å‘é€Â &lt;code&gt;AppendEntries RPC&lt;/code&gt;ï¼Œç­‰å¾…å“åº”ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ”¶åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„å“åº”ï¼Œåˆ™è®¤ä¸ºæ–°çš„æ—¥å¿—è®°å½•æ˜¯è¢«æäº¤çš„ï¼š&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å¦‚æœ Follower å®•æœº/è¶…æ—¶ï¼šLeader å°†åå¤å°è¯•å‘é€ RPCï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ€§èƒ½ä¼˜åŒ–ï¼šLeader ä¸å¿…ç­‰å¾…æ¯ä¸ª Follower åšå‡ºå“åº”ï¼Œåªéœ€è¦è¶…è¿‡åŠæ•°çš„æˆåŠŸå“åº”ï¼ˆç¡®ä¿æ—¥å¿—è®°å½•å·²ç»å­˜å‚¨åœ¨è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹ä¸Šï¼‰â€”â€”ä¸€ä¸ªå¾ˆæ…¢çš„èŠ‚ç‚¹ä¸ä¼šä½¿ç³»ç»Ÿå˜æ…¢ï¼Œå› ä¸º Leader ä¸å¿…ç­‰ä»–ï¼›&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;æ—¥å¿—ä¸€è‡´æ€§&lt;/h3&gt;&lt;p&gt;Raft å°è¯•åœ¨é›†ç¾¤ä¸­ä¿æŒæ—¥å¿—è¾ƒé«˜çš„ä¸€è‡´æ€§ã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Raft æ—¥å¿—çš„ index å’Œ term å”¯ä¸€æ ‡ç¤ºä¸€æ¡æ—¥å¿—è®°å½•ã€‚&lt;/strong&gt;ï¼ˆè¿™éå¸¸é‡è¦ï¼ï¼ï¼ï¼‰&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹çš„æ—¥å¿—åœ¨ç›¸åŒçš„ç´¢å¼•ä½ç½®ä¸Šçš„ä»»æœŸå·ç›¸åŒï¼Œåˆ™è®¤ä¸ºä»–ä»¬å…·æœ‰ä¸€æ ·çš„å‘½ä»¤ï¼›&lt;strong&gt;ä»å¤´åˆ°è¿™ä¸ªç´¢å¼•ä½ç½®ä¹‹é—´çš„æ—¥å¿—å®Œå…¨ç›¸åŒ&lt;/strong&gt;ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;å¦‚æœç»™å®šçš„è®°å½•å·²æäº¤ï¼Œé‚£ä¹ˆæ‰€æœ‰å‰é¢çš„è®°å½•ä¹Ÿå·²æäº¤&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3&gt;&lt;code&gt;AppendEntries&lt;/code&gt;Â ä¸€è‡´æ€§æ£€æŸ¥&lt;/h3&gt;&lt;p&gt;Raft é€šè¿‡Â &lt;code&gt;AppendEntries RPC&lt;/code&gt;Â æ¥æ£€æµ‹è¿™ä¸¤ä¸ªå±æ€§ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.3379174852652259&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390Gkk4qrtHQqbVQQljlFwwmoTJf13B2XYLdFQkFh66T8Jo4v0z5xAeKQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2036&quot;/&gt;&lt;/p&gt;&lt;h2&gt;3. Leader æ›´æ›¿&lt;/h2&gt;&lt;p&gt;å½“æ–°çš„ Leader ä¸Šä»»åï¼Œæ—¥å¿—å¯èƒ½ä¸ä¼šéå¸¸å¹²å‡€ï¼Œå› ä¸ºå‰ä¸€ä»»é¢†å¯¼å¯èƒ½åœ¨å®Œæˆæ—¥å¿—å¤åˆ¶ä¹‹å‰å°±å®•æœºäº†ã€‚&lt;strong&gt;Raft å¯¹æ­¤çš„å¤„ç†æ–¹å¼æ˜¯ï¼šæ— éœ€é‡‡å–ä»»ä½•ç‰¹æ®Šå¤„ç†ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;å½“æ–° Leader ä¸Šä»»åï¼Œä»–ä¸ä¼šç«‹å³è¿›è¡Œä»»ä½•æ¸…ç†æ“ä½œï¼Œä»–å°†ä¼šåœ¨æ­£å¸¸è¿è¡ŒæœŸé—´è¿›è¡Œæ¸…ç†ã€‚&lt;/p&gt;&lt;p&gt;åŸå› æ˜¯å½“ä¸€ä¸ªæ–°çš„ Leader ä¸Šä»»æ—¶ï¼Œå¾€å¾€æ„å‘³ç€æœ‰æœºå™¨æ•…éšœäº†ï¼Œé‚£äº›æœºå™¨å¯èƒ½å®•æœºæˆ–ç½‘ç»œä¸é€šï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•ç«‹å³æ¸…ç†ä»–ä»¬çš„æ—¥å¿—ã€‚åœ¨æœºå™¨æ¢å¤è¿è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;å¤§å‰ææ˜¯ Raft å‡è®¾äº† Leader çš„æ—¥å¿—å§‹ç»ˆæ˜¯å¯¹çš„ã€‚&lt;/strong&gt;æ‰€ä»¥ Leader è¦åšçš„æ˜¯ï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œè®©æ‰€æœ‰ Follower çš„æ—¥å¿—æœ€ç»ˆéƒ½ä¸å…¶åŒ¹é…ã€‚&lt;/p&gt;&lt;p&gt;ä½†ä¸æ­¤åŒæ—¶ï¼ŒLeader ä¹Ÿå¯èƒ½åœ¨å®Œæˆè¿™é¡¹å·¥ä½œä¹‹å‰æ•…éšœï¼Œæ—¥å¿—ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…å †ç§¯èµ·æ¥ï¼Œä»è€Œé€ æˆçœ‹èµ·æ¥ç›¸å½“æ··ä¹±çš„æƒ…å†µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.5842696629213483&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390rprMk8iaPA4RA2viatXUmc7MHq98zyuLhia2J1OlQK9sKEsicKg7wBVsQw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1068&quot;/&gt;&lt;/p&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬å·²ç»çŸ¥é“ index å’Œ term æ˜¯æ—¥å¿—è®°å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè¿™é‡Œä¸å†æ˜¾ç¤ºæ—¥å¿—åŒ…å«çš„å‘½ä»¤ï¼Œä¸‹åŒã€‚&lt;/p&gt;&lt;p&gt;å¦‚å›¾ï¼Œè¿™ç§æƒ…å†µå¯èƒ½å‡ºç°åœ¨ S4 å’Œ S5 æ˜¯ä»»æœŸ 2ã€3ã€4 çš„ Leaderï¼Œä½†ä¸çŸ¥ä½•æ•…ï¼Œä»–ä»¬æ²¡æœ‰å¤åˆ¶è‡ªå·±çš„æ—¥å¿—è®°å½•å°±å´©æºƒäº†ï¼Œç³»ç»Ÿåˆ†åŒºäº†ä¸€æ®µæ—¶é—´ï¼ŒS1ã€S2ã€S3 è½®æµæˆä¸ºäº†ä»»æœŸ 5ã€6ã€7 çš„ Leaderï¼Œä½†æ— æ³•ä¸ S4ã€S5 é€šä¿¡ä»¥è¿›è¡Œæ—¥å¿—æ¸…ç†â€”â€”æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°çš„æ—¥å¿—éå¸¸æ··ä¹±ã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;å”¯ä¸€é‡è¦çš„æ˜¯ï¼Œç´¢å¼• 1-3 ä¹‹é—´çš„è®°å½•æ˜¯å·²æäº¤çš„(å·²å­˜åœ¨å¤šæ•°æ´¾èŠ‚ç‚¹)ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ç¡®ä¿ç•™ä¸‹å®ƒä»¬&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;å…¶å®ƒæ—¥å¿—éƒ½æ˜¯æœªæäº¤çš„ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å°†è¿™äº›å‘½ä»¤ä¼ é€’ç»™çŠ¶æ€æœºï¼Œä¹Ÿæ²¡æœ‰å®¢æˆ·ç«¯ä¼šæ”¶åˆ°è¿™äº›æ‰§è¡Œçš„ç»“æœï¼Œæ‰€ä»¥ä¸ç®¡æ˜¯ä¿ç•™è¿˜æ˜¯ä¸¢å¼ƒå®ƒä»¬éƒ½æ— å…³ç´§è¦ã€‚&lt;/p&gt;&lt;h3&gt;å®‰å…¨æ€§&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;ä¸€æ—¦çŠ¶æ€æœºæ‰§è¡Œäº†ä¸€æ¡æ—¥å¿—é‡Œçš„å‘½ä»¤ï¼Œå¿…é¡»ç¡®ä¿å…¶å®ƒçŠ¶æ€æœºåœ¨åŒæ ·ç´¢å¼•çš„ä½ç½®ä¸ä¼šæ‰§è¡Œä¸åŒçš„å‘½ä»¤ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;Raft å®‰å…¨æ€§(Safety)ï¼šå¦‚æœæŸæ¡æ—¥å¿—è®°å½•åœ¨æŸä¸ªä»»æœŸå·å·²æäº¤ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•å¿…ç„¶å‡ºç°åœ¨æ›´å¤§ä»»æœŸå·çš„æœªæ¥ Leader çš„æ—¥å¿—ä¸­ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.14336917562724014&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390ydKy37vuR7yj4TFodBP2sYs2W7jchGSibJQ1X9rv7IBanW8OTlhNAdw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1674&quot;/&gt;&lt;/p&gt;&lt;p&gt;è¿™ä¿è¯äº†å®‰å…¨æ€§è¦æ±‚ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;Leader ä¸ä¼šè¦†ç›–æ—¥å¿—ä¸­çš„è®°å½•ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;åªæœ‰ Leader çš„æ—¥å¿—ä¸­çš„è®°å½•æ‰èƒ½è¢«æäº¤ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;åœ¨åº”ç”¨åˆ°çŠ¶æ€æœºä¹‹å‰ï¼Œæ—¥å¿—å¿…é¡»å…ˆè¢«æäº¤ï¼›&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;è¿™å†³å®šæˆ‘ä»¬è¦ä¿®æ”¹é€‰ä¸¾ç¨‹åºï¼š&lt;/p&gt;&lt;h3&gt;å»¶è¿Ÿæäº¤ï¼Œé€‰å‡ºæœ€ä½³ Leader&lt;/h3&gt;&lt;p&gt;é—®é¢˜æ¥äº†ï¼šæˆ‘ä»¬å¦‚ä½•ç¡®ä¿é€‰å‡ºäº†ä¸€ä¸ªå¾ˆå¥½åœ°ä¿å­˜äº†æ‰€æœ‰å·²æäº¤æ—¥å¿—çš„ Leader ï¼Ÿ&lt;/p&gt;&lt;p&gt;è¿™æœ‰ç‚¹æ£˜æ‰‹ï¼Œä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æˆ‘ä»¬è¦åœ¨ä¸‹é¢çš„é›†ç¾¤ä¸­é€‰å‡ºä¸€ä¸ªæ–° Leaderï¼Œä½†æ­¤æ—¶ç¬¬ä¸‰å°æœåŠ¡å™¨ä¸å¯ç”¨ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.4043261231281198&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390hXbf7lr7UFux0RE1ROT96jka8SDZzMwCH9jkE4MMQUkkxadfWUQ6Mw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1202&quot;/&gt;&lt;/p&gt;&lt;p&gt;è¿™ç§æƒ…å†µä¸‹ï¼Œä»…çœ‹å‰ä¸¤ä¸ªèŠ‚ç‚¹çš„æ—¥å¿—æˆ‘ä»¬æ— æ³•ç¡®è®¤æ˜¯å¦è¾¾æˆå¤šæ•°æ´¾ï¼Œæ•…æ— æ³•ç¡®è®¤ç¬¬äº”æ¡æ—¥å¿—æ˜¯å¦å·²æäº¤ã€‚&lt;/p&gt;&lt;p&gt;é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p&gt;&lt;p&gt;é€šè¿‡æ¯”è¾ƒæ—¥å¿—ï¼Œåœ¨é€‰ä¸¾æœŸé—´ï¼Œé€‰æ‹©æœ€æœ‰å¯èƒ½åŒ…å«æ‰€æœ‰å·²æäº¤çš„æ—¥å¿—ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;Candidate åœ¨Â &lt;code&gt;RequestVote RPCs&lt;/code&gt;Â ä¸­åŒ…å«æ—¥å¿—ä¿¡æ¯ï¼ˆæœ€åä¸€æ¡è®°å½•çš„ index å’Œ termï¼Œè®°ä¸ºÂ &lt;code&gt;lastIndex&lt;/code&gt;Â å’ŒÂ &lt;code&gt;lastTerm&lt;/code&gt;ï¼‰ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ”¶åˆ°æ­¤æŠ•ç¥¨è¯·æ±‚çš„æœåŠ¡å™¨ V å°†æ¯”è¾ƒè°çš„æ—¥å¿—æ›´å®Œæ•´ï¼š&lt;code&gt;(lastTermV &amp;gt; lastTermC) ||&lt;br/&gt;(lastTermV == lastTermC) &amp;amp;&amp;amp; (lastIndexV &amp;gt; lastIndexC)&lt;/code&gt;Â å°†æ‹’ç»æŠ•ç¥¨ï¼›ï¼ˆå³ï¼šV çš„ä»»æœŸæ¯” C çš„ä»»æœŸæ–°ï¼Œæˆ–ä»»æœŸç›¸åŒä½† V çš„æ—¥å¿—æ¯” C çš„æ—¥å¿—æ›´å®Œæ•´ï¼‰ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ— è®ºè°èµ¢å¾—é€‰ä¸¾ï¼Œå¯ä»¥ç¡®ä¿ Leader å’Œè¶…è¿‡åŠæ•°æŠ•ç¥¨ç»™å®ƒçš„èŠ‚ç‚¹ä¸­æ‹¥æœ‰æœ€å®Œæ•´çš„æ—¥å¿—â€”â€”&lt;strong&gt;æœ€å®Œæ•´çš„æ„æ€å°±æ˜¯ index å’Œ term è¿™å¯¹å”¯ä¸€æ ‡è¯†æ˜¯æœ€å¤§çš„&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;ä¸¾ä¸ªä¾‹å­&lt;/h3&gt;&lt;h4&gt;Case 1: Leader å†³å®šæäº¤æ—¥å¿—&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.6196943972835314&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390zTR12Pjz6YtHHI2hNVA39ARuHU48ToVIJaCfict6qKJOIky6A9fpWRg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1178&quot;/&gt;&lt;/p&gt;&lt;p&gt;ä»»æœŸ 2 çš„ Leader S1 çš„ index = 4 æ—¥å¿—åˆšåˆšè¢«å¤åˆ¶åˆ° S3ï¼Œå¹¶ä¸” Leader å¯ä»¥çœ‹åˆ° index = 4 å·²å¤åˆ¶åˆ°è¶…è¿‡åŠæ•°çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¯¥æ—¥å¿—å¯ä»¥æäº¤ï¼Œå¹¶ä¸”å®‰å…¨åœ°åº”ç”¨åˆ°çŠ¶æ€æœºã€‚&lt;/p&gt;&lt;p&gt;ç°åœ¨ï¼Œè¿™æ¡è®°å½•æ˜¯å®‰å…¨çš„ï¼Œä¸‹ä¸€ä»»æœŸçš„ Leader å¿…é¡»åŒ…å«æ­¤è®°å½•ï¼Œå› æ­¤ S4 å’Œ S5 éƒ½ä¸å¯èƒ½ä»å…¶å®ƒèŠ‚ç‚¹é‚£é‡Œè·å¾—é€‰ç¥¨ï¼šS5 ä»»æœŸå¤ªæ—§ï¼ŒS4 æ—¥å¿—å¤ªçŸ­ã€‚&lt;/p&gt;&lt;p&gt;åªæœ‰å‰ä¸‰å°ä¸­çš„ä¸€å°å¯ä»¥æˆä¸ºæ–°çš„ Leaderâ€”â€”S1 å½“ç„¶å¯ä»¥ï¼ŒS2ã€S3 ä¹Ÿå¯ä»¥é€šè¿‡è·å– S4 å’Œ S5 çš„é€‰ç¥¨æˆä¸º Leaderã€‚&lt;/p&gt;&lt;h4&gt;Case 2: Leader è¯•å›¾æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—&lt;/h4&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.5952380952380952&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390N8aXyiag3T2M2TjamDA1IRmw2Z0k6j44bspZWQDH6dQ5aUd0lzvkn2w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1176&quot;/&gt;&lt;/p&gt;&lt;p&gt;å¦‚å›¾æ‰€ç¤ºçš„æƒ…å†µï¼Œåœ¨ä»»æœŸ 2 æ—¶è®°å½•ä»…å†™åœ¨ S1 å’Œ S2 ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”±äºæŸç§åŸå› ï¼Œä»»æœŸ 3 çš„ Leader S5 å¹¶ä¸çŸ¥é“è¿™äº›è®°å½•ï¼ŒS5 åˆ›å»ºäº†è‡ªå·±çš„ä¸‰æ¡è®°å½•ç„¶åå®•æœºäº†ï¼Œç„¶åä»»æœŸ 4 çš„ Leader S1 è¢«é€‰å‡ºï¼ŒS1 è¯•å›¾ä¸å…¶å®ƒæœåŠ¡å™¨çš„æ—¥å¿—è¿›è¡ŒåŒ¹é…ã€‚å› æ­¤å®ƒå¤åˆ¶äº†ä»»æœŸ 2 çš„æ—¥å¿—åˆ° S3ã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;æ­¤æ—¶ index=3 çš„è®°å½•æ—¶æ˜¯ä¸å®‰å…¨çš„&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p&gt;å› ä¸º S1 å¯èƒ½åœ¨æ­¤æ—¶å®•æœºï¼Œç„¶å S5 å¯èƒ½ä» S2ã€S3ã€S4 è·å¾—é€‰ç¥¨æˆä¸ºä»»æœŸ 5 çš„ Leaderã€‚ä¸€æ—¦ S5 æˆä¸ºæ–° Leaderï¼Œå®ƒå°†è¦†ç›– index=3-5 çš„æ—¥å¿—ï¼ŒS1-S3 çš„è¿™äº›è®°å½•éƒ½å°†æ¶ˆå¤±ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬è¿˜è¦éœ€è¦ä¸€æ¡æ–°çš„è§„åˆ™ï¼Œæ¥å¤„ç†è¿™ç§æƒ…å†µã€‚&lt;/p&gt;&lt;h3&gt;æ–°çš„ Commit è§„åˆ™&lt;/h3&gt;&lt;p&gt;æ–°çš„é€‰ä¸¾ä¸è¶³ä»¥ä¿è¯æ—¥å¿—å®‰å…¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­ä¿®æ”¹ commit è§„åˆ™ã€‚&lt;/p&gt;&lt;p&gt;Leader è¦æäº¤ä¸€æ¡æ—¥å¿—ï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.7598343685300207&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390nAD5JEdKKyic0DFz45jJR0uvYXaqsTV2oykJWvlRTGQtfxvjtia4la8w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;966&quot;/&gt;&lt;/p&gt;&lt;p&gt;å¦‚å›¾ï¼Œå›åˆ°ä¸Šé¢çš„ Case 2: å½“ index = 3 &amp;amp; term = 2 è¢«å¤åˆ¶åˆ° S3 æ—¶ï¼Œå®ƒè¿˜ä¸èƒ½æäº¤è¯¥è®°å½•ï¼Œå¿…é¡»ç­‰åˆ° term = 4 çš„è®°å½•å­˜å‚¨åœ¨è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¶ index = 3 å’Œ index = 4 å¯ä»¥è®¤ä¸ºæ˜¯å·²æäº¤ã€‚&lt;/p&gt;&lt;p&gt;æ­¤æ—¶ S5 æ— æ³•èµ¢å¾—é€‰ä¸¾äº†ï¼Œå®ƒæ— æ³•ä» S1-S3 è·å¾—é€‰ç¥¨ã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;ç»“åˆæ–°çš„é€‰ä¸¾è§„åˆ™å’Œ commit è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯ Raft çš„å®‰å…¨æ€§ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;h3&gt;æ—¥å¿—ä¸ä¸€è‡´&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.5146484375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390J0eqAwNldWxIE5VexDMhDxElNuRk9tsJzWwHrksOmickHvRt88FlZnQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2048&quot;/&gt;&lt;/p&gt;&lt;p&gt;Leader å˜æ›´å¯èƒ½å¯¼è‡´æ—¥å¿—çš„ä¸ä¸€è‡´ï¼Œè¿™é‡Œå±•ç¤ºä¸€ç§å¯èƒ½çš„æƒ…å†µã€‚&lt;/p&gt;&lt;p&gt;å¯ä»¥ä»å›¾ä¸­çœ‹å‡ºï¼ŒRaft é›†ç¾¤ä¸­é€šå¸¸æœ‰ä¸¤ç§ä¸ä¸€è‡´çš„æ—¥å¿—ï¼š&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ¸…ç†è¿™ä¸¤ç§æ—¥å¿—ã€‚&lt;/p&gt;&lt;h3&gt;ä¿®å¤ Follower æ—¥å¿—&lt;/h3&gt;&lt;p&gt;æ–°çš„ Leader å¿…é¡»ä½¿ Follower çš„æ—¥å¿—ä¸è‡ªå·±çš„æ—¥å¿—ä¿æŒä¸€è‡´ï¼Œé€šè¿‡ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;åˆ é™¤ Extraneous Entriesï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;è¡¥é½ Missing Entriesï¼›&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Leader ä¸ºæ¯ä¸ª Follower ä¿å­˜Â &lt;code&gt;nextIndex&lt;/code&gt;ï¼š&lt;/p&gt;&lt;p&gt;Leader é€šè¿‡Â &lt;code&gt;nextIndex&lt;/code&gt;Â æ¥ä¿®å¤æ—¥å¿—ã€‚å½“Â &lt;code&gt;AppendEntries RPC&lt;/code&gt;Â ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥ï¼Œé€’å‡Â &lt;code&gt;nextIndex&lt;/code&gt;Â å¹¶é‡è¯•ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.41146496815286626&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390yTRkJmlribtPTfjWSYvNjpgmSx3omU9ZurZAGcE7b8GcKqPBkQma3BQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1570&quot;/&gt;&lt;/p&gt;&lt;p&gt;å¯¹äº aï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;ä¸€å¼€å§‹Â &lt;code&gt;nextIndex&lt;/code&gt;Â = 11ï¼Œå¸¦ä¸Šæ—¥å¿— index = 10 &amp;amp; term = 6ï¼Œæ£€æŸ¥å¤±è´¥ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;code&gt;nextIndex&lt;/code&gt;Â = 10ï¼Œå¸¦ä¸Šæ—¥å¿— index = 9 &amp;amp; term = 6ï¼Œæ£€æŸ¥å¤±è´¥ï¼›&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å¦‚æ­¤åå¤ï¼Œç›´åˆ°Â &lt;code&gt;nextIndex&lt;/code&gt;Â = 5ï¼Œå¸¦ä¸Šæ—¥å¿— index = 4 &amp;amp; term = 4ï¼Œè¯¥æ—¥å¿—ç°åœ¨åŒ¹é…ï¼Œä¼šåœ¨ a ä¸­è¡¥é½ Leader çš„æ—¥å¿—ã€‚å¦‚æ­¤å¾€ä¸‹è¡¥é½ã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¯¹äº bï¼š&lt;br/&gt;ä¼šä¸€ç›´æ£€æŸ¥åˆ°Â &lt;code&gt;nextIndex&lt;/code&gt;Â = 4 æ‰åŒ¹é…ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº b è¿™ç§æƒ…å†µï¼Œå½“ Follower è¦†ç›–ä¸ä¸€è‡´çš„æ—¥å¿—æ—¶ï¼Œå®ƒå°†åˆ é™¤æ‰€æœ‰åç»­çš„æ—¥å¿—è®°å½•ï¼ˆä»»ä½•æ— å…³ç´§è¦çš„è®°å½•ä¹‹åçš„è®°å½•ä¹Ÿéƒ½æ˜¯æ— å…³ç´§è¦çš„ï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.43691899070385126&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390NdmiclRY8CCYulIy59NoygwprHicAu1UyIIqy88QXvibLTcJhCbA4PNDg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1506&quot;/&gt;&lt;/p&gt;&lt;h2&gt;4. å¤„ç†æ—§ Leader&lt;/h2&gt;&lt;p&gt;å®é™…ä¸Šï¼Œè€çš„ Leader å¯èƒ½ä¸ä¼šé©¬ä¸Šæ¶ˆå¤±ï¼Œä¾‹å¦‚ï¼šç½‘ç»œåˆ†åŒºå°† Leader ä¸é›†ç¾¤çš„å…¶ä½™éƒ¨åˆ†åˆ†éš”ï¼Œå…¶ä½™éƒ¨åˆ†é€‰ä¸¾å‡ºäº†ä¸€ä¸ªæ–°çš„ Leaderã€‚é—®é¢˜åœ¨äºï¼Œå¦‚æœè€çš„ Leader é‡æ–°è¿æ¥ï¼Œä¹Ÿä¸çŸ¥é“æ–°çš„ Leader å·²ç»è¢«é€‰å‡ºæ¥ï¼Œå®ƒä¼šå°è¯•ä½œä¸º Leader ç»§ç»­æäº¤æ—¥å¿—ã€‚æ­¤æ—¶å¦‚æœæœ‰å®¢æˆ·ç«¯å‘è€ Leader å‘é€è¯·æ±‚ï¼Œè€çš„ Leader ä¼šå°è¯•å­˜å‚¨è¯¥å‘½ä»¤å¹¶å‘å…¶å®ƒèŠ‚ç‚¹å¤åˆ¶æ—¥å¿—â€”â€”æˆ‘ä»¬å¿…é¡»é˜»æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;ä»»æœŸå°±æ˜¯ç”¨æ¥å‘ç°è¿‡æ—¶çš„ Leader&lt;/strong&gt;(å’Œ Candidates)ï¼š&lt;/p&gt;&lt;p&gt;ç”±äºæ–° Leader çš„é€‰ä¸¾ä¼šæ›´æ–°è¶…è¿‡åŠæ•°æœåŠ¡å™¨çš„ä»»æœŸï¼Œæ—§çš„ Leader ä¸èƒ½æäº¤æ–°çš„æ—¥å¿—ï¼Œå› ä¸ºå®ƒä¼šè”ç³»è‡³å°‘ä¸€å°å¤šæ•°æ´¾é›†ç¾¤çš„èŠ‚ç‚¹ï¼Œç„¶åå‘ç°è‡ªå·±ä»»æœŸå¤ªè€ï¼Œä¼šè½¬ä¸º Follower ç»§ç»­å·¥ä½œã€‚&lt;/p&gt;&lt;p&gt;è¿™é‡Œä¸æ‰“ç®—ç»§ç»­è®¨è®ºåˆ«çš„æç«¯æƒ…å†µã€‚&lt;/p&gt;&lt;h2&gt;5. å®¢æˆ·ç«¯åè®®&lt;/h2&gt;&lt;p&gt;å®¢æˆ·ç«¯åªå°†å‘½ä»¤å‘é€åˆ° Leaderï¼š&lt;/p&gt;&lt;p&gt;Leader ç›´åˆ°å°†å‘½ä»¤è®°å½•ã€æäº¤å’Œæ‰§è¡Œåˆ°çŠ¶æ€æœºä¹‹å‰ï¼Œä¸ä¼šåšå‡ºå“åº”ã€‚&lt;/p&gt;&lt;p&gt;è¿™é‡Œçš„é—®é¢˜æ˜¯å¦‚æœ Leader å®•æœºä¼šå¯¼è‡´è¯·æ±‚è¶…æ—¶ï¼š&lt;/p&gt;&lt;p&gt;è¿™ç•™ä¸‹äº†ä¸€ä¸ªå‘½ä»¤å¯èƒ½è¢«æ‰§è¡Œä¸¤æ¬¡çš„é£é™©â€”â€”Leader å¯èƒ½åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹åä½†å“åº”å®¢æˆ·ç«¯ä¹‹å‰å®•æœºï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å†å»å¯»æ‰¾ä¸‹ä¸€ä¸ª Leaderï¼ŒåŒä¸€ä¸ªå‘½ä»¤å°±ä¼šè¢«æ‰§è¡Œä¸¤æ¬¡â€”â€”è¿™æ˜¯ä¸å¯æ¥å—çš„ï¼&lt;/p&gt;&lt;p&gt;è§£å†³åŠæ³•æ˜¯ï¼šå®¢æˆ·ç«¯å‘é€ç»™ Leader çš„æ¯ä¸ªå‘½ä»¤éƒ½å¸¦ä¸Šä¸€ä¸ªå”¯ä¸€ id&lt;/p&gt;&lt;p&gt;&lt;strong&gt;æ¯ä¸ªå‘½ä»¤åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„çº¿æ€§åŒ–çš„å…³é”®è¦ç´ &lt;/strong&gt;ã€‚&lt;/p&gt;&lt;h2&gt;6. é…ç½®å˜æ›´&lt;/h2&gt;&lt;p&gt;éšç€æ—¶é—´æ¨ç§»ï¼Œä¼šæœ‰æœºå™¨æ•…éšœéœ€è¦æˆ‘ä»¬å»æ›¿æ¢å®ƒï¼Œæˆ–è€…ä¿®æ”¹èŠ‚ç‚¹æ•°é‡ï¼Œéœ€è¦æœ‰ä¸€äº›æœºåˆ¶æ¥å˜æ›´ç³»ç»Ÿé…ç½®ï¼Œå¹¶ä¸”æ˜¯å®‰å…¨ã€è‡ªåŠ¨çš„æ–¹å¼ï¼Œæ— éœ€åœæ­¢ç³»ç»Ÿã€‚&lt;/p&gt;&lt;p&gt;ç³»ç»Ÿé…ç½®æ˜¯æŒ‡ï¼š&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;æ¯å°æœåŠ¡å™¨çš„ id å’Œåœ°å€&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;ç³»ç»Ÿé…ç½®ä¿¡æ¯æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå†³å®šäº†å¤šæ•°æ´¾çš„ç»„æˆ&lt;/strong&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;é¦–å…ˆè¦æ„è¯†åˆ°ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä»æ—§é…ç½®åˆ‡æ¢åˆ°æ–°é…ç½®ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´çŸ›ç›¾çš„å¤šæ•°æ´¾ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.34083930399181167&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390UfhWDZiaAGIm3n4LOPXfSfKicd1zHDjwEnvJ92HEcGGicsjlsBluc9M7A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1954&quot;/&gt;&lt;/p&gt;&lt;p&gt;å¦‚å›¾ï¼Œç³»ç»Ÿä»¥ä¸‰å°æœåŠ¡å™¨çš„é…ç½®è¿è¡Œç€ï¼Œæ­¤æ—¶æˆ‘ä»¬è¦æ·»åŠ ä¸¤å°æœåŠ¡å™¨ã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥ä¿®æ”¹é…ç½®ï¼Œä»–ä»¬å¯èƒ½æ— æ³•å®Œå…¨åœ¨åŒä¸€æ—¶é—´åšåˆ°é…ç½®åˆ‡æ¢ï¼Œè¿™ä¼šå¯¼è‡´ S1 å’Œ S2 å½¢æˆæ—§é›†ç¾¤çš„å¤šæ•°æ´¾ï¼Œè€ŒåŒä¸€æ—¶é—´ S3-S5 å·²ç»åˆ‡æ¢åˆ°æ–°é…ç½®ï¼Œè¿™ä¼šäº§ç”Ÿä¸¤ä¸ªé›†ç¾¤ã€‚&lt;/p&gt;&lt;p&gt;è¿™è¯´æ˜æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€ä¸ªä¸¤é˜¶æ®µ(two-phase)åè®®ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;å¦‚æœæœ‰äººå‘Šè¯‰ä½ ï¼Œä»–å¯ä»¥åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸€ä¸ªé˜¶æ®µå°±åšå‡ºå†³ç­–ï¼Œä½ åº”è¯¥éå¸¸è®¤çœŸåœ°è¯¢é—®ä»–ï¼Œå› ä¸ºä»–è¦ä¹ˆé”™äº†ï¼Œè¦ä¹ˆå‘ç°äº†ä¸–ç•Œä¸Šæ‰€æœ‰äººéƒ½ä¸çŸ¥é“çš„ä¸œè¥¿ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h3&gt;å…±åŒä¸€è‡´(Joint Consensus)&lt;/h3&gt;&lt;p&gt;Raft é€šè¿‡å…±åŒä¸€è‡´(Joint Consensus)æ¥å®Œæˆä¸¤é˜¶æ®µåè®®ï¼Œå³ï¼šæ–°ã€æ—§ä¸¤ç§é…ç½®ä¸Šéƒ½è·å¾—å¤šæ•°æ´¾é€‰ç¥¨ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.4156769596199525&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390r8ImFlyAicXKvqueRgD9ZTCia8EpBu4WJicIQuAkibfekf82y4Xicn4oicXg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1684&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ç¬¬ä¸€é˜¶æ®µï¼š&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;span&gt;&lt;mjx-container jax=&quot;SVG&quot; role=&quot;presentation&quot; tabindex=&quot;0&quot; ctxtmenu_counter=&quot;10&quot; data-formula=&quot;C_{old+new}&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -705 3496.6 913&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;43&quot; d=&quot;M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(715, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6F&quot; d=&quot;M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(485, 0)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(783, 0)&quot;&gt;&lt;path data-c=&quot;64&quot; d=&quot;M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1303, 0)&quot;&gt;&lt;path data-c=&quot;2B&quot; d=&quot;M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2081, 0)&quot;&gt;&lt;path data-c=&quot;6E&quot; d=&quot;M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2681, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(3147, 0)&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/mjx-container&gt;&lt;/span&gt;&lt;span&gt;Â &lt;/span&gt;æ—¥å¿—å·²æäº¤ä¿è¯äº†åç»­ä»»ä½• Leader ä¸€å®šæœ‰&lt;/span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;span&gt;&lt;mjx-container jax=&quot;SVG&quot; role=&quot;presentation&quot; tabindex=&quot;0&quot; ctxtmenu_counter=&quot;10&quot; data-formula=&quot;C_{old+new}&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -705 3496.6 913&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;43&quot; d=&quot;M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(715, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6F&quot; d=&quot;M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(485, 0)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(783, 0)&quot;&gt;&lt;path data-c=&quot;64&quot; d=&quot;M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1303, 0)&quot;&gt;&lt;path data-c=&quot;2B&quot; d=&quot;M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2081, 0)&quot;&gt;&lt;path data-c=&quot;6E&quot; d=&quot;M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2681, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(3147, 0)&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/mjx-container&gt;&lt;/span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;span&gt;æ—¥å¿—ï¼ŒLeader é€‰ä¸¾è¿‡ç¨‹å¿…é¡»è·å¾—æ—§é…ç½®ä¸­çš„å¤šæ•°æ´¾å’Œæ–°é…ç½®ä¸­çš„å¤šæ•°æ´¾åŒæ—¶æŠ•ç¥¨ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ç¬¬äºŒé˜¶æ®µï¼š&lt;/p&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.3947078280044101&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA0Nb7z15Y0QdBGSyIPVic390ARW5pYWGgkseaNEEqD2PuZmWMPqU3ibibfUAjgj75xlQibIkfK5vz89Lw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1814&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;Joint Consensus è¿˜æœ‰ä¸€äº›ç»†èŠ‚ï¼š&lt;/p&gt;&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼Œæ—§ Leader ä¸å†æ˜¯æ–°é…ç½®çš„æˆå‘˜ä¹‹åï¼Œè¿˜æœ‰å¯èƒ½ç»§ç»­æœåŠ¡ä¸€å°æ®µæ—¶é—´ï¼›å³æ—§ Leader å¯èƒ½åœ¨&lt;span&gt;Â &lt;/span&gt;&lt;span&gt;&lt;mjx-container jax=&quot;SVG&quot; role=&quot;presentation&quot; tabindex=&quot;0&quot; ctxtmenu_counter=&quot;8&quot; data-formula=&quot;C_{new}&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -705 2025.1 862.8&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;43&quot; d=&quot;M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(715, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6E&quot; d=&quot;M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(600, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1066, 0)&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/mjx-container&gt;&lt;/span&gt;&lt;span&gt;Â &lt;/span&gt;é…ç½®ä¸‹ç»§ç»­å½“ Leaderï¼ˆè™½ç„¶å®è´¨ä¸Šå¹¶ä¸æ˜¯Leaderï¼‰ï¼Œç›´åˆ°&lt;span&gt;Â &lt;/span&gt;&lt;span&gt;&lt;mjx-container jax=&quot;SVG&quot; role=&quot;presentation&quot; tabindex=&quot;0&quot; ctxtmenu_counter=&quot;8&quot; data-formula=&quot;C_{new}&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -705 2025.1 862.8&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;43&quot; d=&quot;M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(715, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6E&quot; d=&quot;M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(600, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1066, 0)&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/mjx-container&gt;&lt;/span&gt;&lt;span&gt;Â &lt;/span&gt;çš„æ—¥å¿—å¤åˆ¶åˆ°å¤šæ•°æ´¾ä¸Šè€Œ committedï¼›&lt;/p&gt;&lt;h2&gt;ç›¸å…³é˜…è¯»&lt;/h2&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;&lt;strong&gt;æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼š&lt;/strong&gt;&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.36484375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hBL5R2neMA2qgPwzomIicebbmoOGzU1IsUWQMb3xr4nLcjtfIy5Zwyia3HTKnIJ8xc9NFkkPBkL8MEAfh3YdNuaQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>0967da03b1d72ed84084f9ef3433d04f</guid>
<title>Goï¼šå®ç°é¡¹ç›®å†…é“¾è·¯è¿½è¸ª</title>
<link>https://toutiao.io/k/ic65md7</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ºä»€ä¹ˆé¡¹ç›®å†…éœ€è¦é“¾è·¯è¿½è¸ªï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œè¯·æ±‚äº†å¤šä¸ªæœåŠ¡å•å…ƒï¼Œå¦‚æœè¯·æ±‚å‡ºç°äº†é”™è¯¯æˆ–å¼‚å¸¸ï¼Œå¾ˆéš¾å»å®šä½æ˜¯å“ªä¸ªæœåŠ¡å‡ºäº†é—®é¢˜ï¼Œè¿™æ—¶å°±éœ€è¦é“¾è·¯è¿½è¸ªã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;1.1858407079646018&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/go9jpG3BuhTZqG9aQ0doMjaVkoFiaYfSmESqm8MgOxQ4BESXT1rfAUpfn55XiaIvHGaqygNWicTb78ESfSCYD7r9A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;339&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ªå›¾ç”»çš„æ¯”è¾ƒç®€å•ï¼Œä»å›¾ä¸­å¯ä»¥æ¸…æ™°çš„çœ‹å‡ºä»–ä»¬ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼Œé€šè¿‡ä¸€ä¸ªä¾‹å­è¯´æ˜ä¸‹é“¾è·¯çš„é‡è¦æ€§ï¼Œæ¯”å¦‚å¯¹æ–¹è°ƒæˆ‘ä»¬ä¸€ä¸ªæ¥å£ï¼Œåé¦ˆåœ¨æŸä¸ªæ—¶é—´æ®µè¿™æ¥å£å¤ªæ…¢äº†ï¼Œåœ¨æ’æŸ¥ä»£ç å‘ç°é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œä¸å…‰è°ƒç”¨äº†å¤šä¸ªä¸‰æ–¹æ¥å£ã€æ“ä½œäº†æ•°æ®åº“ï¼Œè¿˜æ“ä½œäº†ç¼“å­˜ï¼Œæ€ä¹ˆå¿«é€Ÿå®šä½æ˜¯å“ªå—æ‰§è¡Œæ—¶é—´å¾ˆé•¿ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸å–å…³å­ï¼Œå…ˆè¯´ä¸‹æœ¬ç¯‡æ–‡ç« æœ€ç»ˆå®ç°äº†ä»€ä¹ˆï¼Œå¦‚æœæ„Ÿå…´è¶£å†ç»§ç»­å¾€ä¸‹çœ‹ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å®ç°äº†é€šè¿‡è®°å½•å¦‚ä¸‹å‚æ•°ï¼Œæ¥è¿›è¡Œé—®é¢˜å®šä½ï¼Œå…³äºæ¯ä¸ªå‚æ•°çš„ç»“æ„åœ¨ä¸‹é¢éƒ½æœ‰ä»‹ç»ã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;//Â TraceÂ è®°å½•çš„å‚æ•°&lt;br/&gt;&lt;span&gt;type&lt;/span&gt;Â TraceÂ structÂ {&lt;br/&gt;Â Â Â Â muxÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sync.Mutex&lt;br/&gt;Â Â Â Â IdentifierÂ Â Â Â Â Â Â Â Â stringÂ Â Â Â `json:&lt;span&gt;&quot;trace_id&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â //Â é“¾è·¯Â ID&lt;br/&gt;Â Â Â Â RequestÂ Â Â Â Â Â Â Â Â Â Â Â *RequestÂ Â `json:&lt;span&gt;&quot;request&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â è¯·æ±‚ä¿¡æ¯&lt;br/&gt;Â Â Â Â ResponseÂ Â Â Â Â Â Â Â Â Â Â *ResponseÂ `json:&lt;span&gt;&quot;response&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â //Â å“åº”ä¿¡æ¯&lt;br/&gt;Â Â Â Â ThirdPartyRequestsÂ []*DialogÂ `json:&lt;span&gt;&quot;third_party_requests&quot;&lt;/span&gt;`Â //Â è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£çš„ä¿¡æ¯&lt;br/&gt;Â Â Â Â DebugsÂ Â Â Â Â Â Â Â Â Â Â Â Â []*DebugÂ Â `json:&lt;span&gt;&quot;debugs&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â è°ƒè¯•ä¿¡æ¯&lt;br/&gt;Â Â Â Â SQLsÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â []*SQLÂ Â Â Â `json:&lt;span&gt;&quot;sqls&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â æ‰§è¡Œçš„Â SQLÂ ä¿¡æ¯&lt;br/&gt;Â Â Â Â RedisÂ Â Â Â Â Â Â Â Â Â Â Â Â Â []*RedisÂ Â `json:&lt;span&gt;&quot;redis&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â æ‰§è¡Œçš„Â RedisÂ ä¿¡æ¯&lt;br/&gt;Â Â Â Â SuccessÂ Â Â Â Â Â Â Â Â Â Â Â boolÂ Â Â Â Â Â `json:&lt;span&gt;&quot;success&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â è¯·æ±‚ç»“æœÂ &lt;span&gt;true&lt;/span&gt;Â orÂ &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â Â Â Â CostSecondsÂ Â Â Â Â Â Â Â float64Â Â Â `json:&lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â //Â æ‰§è¡Œæ—¶é•¿(å•ä½ç§’)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å‚æ•°ç»“æ„&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;é“¾è·¯ ID&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;String&lt;/code&gt; ä¾‹å¦‚ï¼š4b4f81f015a4f2a01b00ã€‚å¦‚æœè¯·æ±‚ Header ä¸­å­˜åœ¨ &lt;code&gt;TRACE-ID&lt;/code&gt;ï¼Œå°±ä½¿ç”¨å®ƒï¼Œåä¹‹ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªã€‚å°† &lt;code&gt;TRACE_ID&lt;/code&gt; æ”¾åˆ°æ¥å£è¿”å›å€¼ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡ç¤ºæŸ¥åˆ°è¿™ä¸€ä¸²çš„ä¿¡æ¯ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;è¯·æ±‚ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;Object&lt;/code&gt;ï¼Œç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â RequestÂ structÂ {&lt;br/&gt;Â TTLÂ Â Â Â Â Â Â Â stringÂ Â Â Â Â Â `json:&lt;span&gt;&quot;ttl&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â //Â è¯·æ±‚è¶…æ—¶æ—¶é—´&lt;br/&gt;Â MethodÂ Â Â Â Â stringÂ Â Â Â Â Â `json:&lt;span&gt;&quot;method&quot;&lt;/span&gt;`Â Â Â Â Â Â //Â è¯·æ±‚æ–¹å¼&lt;br/&gt;Â DecodedURLÂ stringÂ Â Â Â Â Â `json:&lt;span&gt;&quot;decoded_url&quot;&lt;/span&gt;`Â //Â è¯·æ±‚åœ°å€&lt;br/&gt;Â HeaderÂ Â Â Â Â interface{}Â `json:&lt;span&gt;&quot;header&quot;&lt;/span&gt;`Â Â Â Â Â Â //Â è¯·æ±‚Â HeaderÂ ä¿¡æ¯&lt;br/&gt;Â BodyÂ Â Â Â Â Â Â interface{}Â `json:&lt;span&gt;&quot;body&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â //Â è¯·æ±‚Â BodyÂ ä¿¡æ¯&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;å“åº”ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;Object&lt;/code&gt;ï¼Œç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â ResponseÂ structÂ {&lt;br/&gt;Â HeaderÂ Â Â Â Â Â Â Â Â Â interface{}Â `json:&lt;span&gt;&quot;header&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â HeaderÂ ä¿¡æ¯&lt;br/&gt;Â BodyÂ Â Â Â Â Â Â Â Â Â Â Â interface{}Â `json:&lt;span&gt;&quot;body&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â BodyÂ ä¿¡æ¯&lt;br/&gt;Â BusinessCodeÂ Â Â Â intÂ Â Â Â Â Â Â Â Â `json:&lt;span&gt;&quot;business_code,omitempty&quot;&lt;/span&gt;`Â Â Â Â Â //Â ä¸šåŠ¡ç &lt;br/&gt;Â BusinessCodeMsgÂ stringÂ Â Â Â Â Â `json:&lt;span&gt;&quot;business_code_msg,omitempty&quot;&lt;/span&gt;`Â //Â æç¤ºä¿¡æ¯&lt;br/&gt;Â HttpCodeÂ Â Â Â Â Â Â Â intÂ Â Â Â Â Â Â Â Â `json:&lt;span&gt;&quot;http_code&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â HTTPÂ çŠ¶æ€ç &lt;br/&gt;Â HttpCodeMsgÂ Â Â Â Â stringÂ Â Â Â Â Â `json:&lt;span&gt;&quot;http_code_msg&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â HTTPÂ çŠ¶æ€ç ä¿¡æ¯&lt;br/&gt;Â CostSecondsÂ Â Â Â Â float64Â Â Â Â Â `json:&lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â æ‰§è¡Œæ—¶é—´(å•ä½ç§’)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;è°ƒç”¨ä¸‰æ–¹æ¥å£ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;Object&lt;/code&gt;ï¼Œç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â DialogÂ structÂ {&lt;br/&gt;Â muxÂ Â Â Â Â Â Â Â Â sync.Mutex&lt;br/&gt;Â RequestÂ Â Â Â Â *RequestÂ Â Â Â `json:&lt;span&gt;&quot;request&quot;&lt;/span&gt;`Â Â Â Â Â Â //Â è¯·æ±‚ä¿¡æ¯&lt;br/&gt;Â ResponsesÂ Â Â []*ResponseÂ `json:&lt;span&gt;&quot;responses&quot;&lt;/span&gt;`Â Â Â Â //Â è¿”å›ä¿¡æ¯&lt;br/&gt;Â SuccessÂ Â Â Â Â boolÂ Â Â Â Â Â Â Â `json:&lt;span&gt;&quot;success&quot;&lt;/span&gt;`Â Â Â Â Â Â //Â æ˜¯å¦æˆåŠŸï¼Œ&lt;span&gt;true&lt;/span&gt;Â æˆ–Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â CostSecondsÂ float64Â Â Â Â Â `json:&lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;`Â //Â æ‰§è¡Œæ—¶é•¿(å•ä½ç§’)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™é‡Œé¢çš„ &lt;code&gt;Request&lt;/code&gt; å’Œ &lt;code&gt;Response&lt;/code&gt; ç»“æ„ä¸ä¸Šé¢ä¿æŒä¸€è‡´ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç»†èŠ‚æ¥äº†ï¼Œä¸ºä»€ä¹ˆ &lt;code&gt;Responses&lt;/code&gt; ç»“æ„æ˜¯ &lt;code&gt;[]*Response&lt;/code&gt; ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ˜¯å› ä¸º HTTP å¯ä»¥è¿›è¡Œé‡è¯•è¯·æ±‚ï¼Œæ¯”å¦‚å½“è¯·æ±‚å¯¹æ–¹æ¥å£çš„æ—¶å€™ï¼ŒHTTP çŠ¶æ€ç ä¸º 503 &lt;code&gt;http.StatusServiceUnavailable&lt;/code&gt;ï¼Œè¿™æ—¶éœ€è¦é‡è¯•ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æŠŠé‡è¯•çš„å“åº”ä¿¡æ¯è®°å½•ä¸‹æ¥ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;è°ƒè¯•ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;Object&lt;/code&gt; ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â DebugÂ structÂ {&lt;br/&gt;Â KeyÂ Â Â Â Â Â Â Â Â stringÂ Â Â Â Â Â `json:&lt;span&gt;&quot;key&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â //Â æ ‡ç¤º&lt;br/&gt;Â ValueÂ Â Â Â Â Â Â interface{}Â `json:&lt;span&gt;&quot;value&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â //Â å€¼&lt;br/&gt;Â CostSecondsÂ float64Â Â Â Â Â `json:&lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;`Â //Â æ‰§è¡Œæ—¶é—´(å•ä½ç§’)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;SQL ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;Object&lt;/code&gt;ï¼Œç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â SQLÂ structÂ {&lt;br/&gt;Â TimestampÂ Â Â stringÂ Â `json:&lt;span&gt;&quot;timestamp&quot;&lt;/span&gt;`Â Â Â Â Â //Â æ—¶é—´ï¼Œæ ¼å¼ï¼š2006-01-02 15:04:05&lt;br/&gt;Â StackÂ Â Â Â Â Â Â stringÂ Â `json:&lt;span&gt;&quot;stack&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â //Â æ–‡ä»¶åœ°å€å’Œè¡Œå·&lt;br/&gt;Â SQLÂ Â Â Â Â Â Â Â Â stringÂ Â `json:&lt;span&gt;&quot;sql&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â //Â SQLÂ è¯­å¥&lt;br/&gt;Â RowsÂ Â Â Â Â Â Â Â int64Â Â Â `json:&lt;span&gt;&quot;rows_affected&quot;&lt;/span&gt;`Â //Â å½±å“è¡Œæ•°&lt;br/&gt;Â CostSecondsÂ float64Â `json:&lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;`Â Â //Â æ‰§è¡Œæ—¶é•¿(å•ä½ç§’)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;Redis ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;Object&lt;/code&gt;ï¼Œç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â RedisÂ structÂ {&lt;br/&gt;Â TimestampÂ Â Â stringÂ Â `json:&lt;span&gt;&quot;timestamp&quot;&lt;/span&gt;`Â Â Â Â Â Â Â //Â æ—¶é—´ï¼Œæ ¼å¼ï¼š2006-01-02 15:04:05&lt;br/&gt;Â HandleÂ Â Â Â Â Â stringÂ Â `json:&lt;span&gt;&quot;handle&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â //Â æ“ä½œï¼ŒSET/GETÂ ç­‰&lt;br/&gt;Â KeyÂ Â Â Â Â Â Â Â Â stringÂ Â `json:&lt;span&gt;&quot;key&quot;&lt;/span&gt;`Â Â Â Â Â Â Â Â Â Â Â Â Â //Â Key&lt;br/&gt;Â ValueÂ Â Â Â Â Â Â stringÂ Â `json:&lt;span&gt;&quot;value,omitempty&quot;&lt;/span&gt;`Â //Â Value&lt;br/&gt;Â TTLÂ Â Â Â Â Â Â Â Â float64Â `json:&lt;span&gt;&quot;ttl,omitempty&quot;&lt;/span&gt;`Â Â Â //Â è¶…æ—¶æ—¶é•¿(å•ä½åˆ†)&lt;br/&gt;Â CostSecondsÂ float64Â `json:&lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;`Â Â Â Â //Â æ‰§è¡Œæ—¶é—´(å•ä½ç§’)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;è¯·æ±‚ç»“æœ&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;Bool&lt;/code&gt;ï¼Œè¿™ä¸ªå’Œç»Ÿä¸€å®šä¹‰è¿”å›å€¼æœ‰ç‚¹å…³ç³»ï¼Œçœ‹ä¸‹ä»£ç ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;//Â é”™è¯¯è¿”å›&lt;br/&gt;c.AbortWithError(code.ErrParamBind.WithErr(err))&lt;br/&gt;&lt;br/&gt;//Â æ­£ç¡®è¿”å›&lt;br/&gt;c.Payload(code.OK.WithData(data))&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“é”™è¯¯è¿”å›æ—¶ ä¸” &lt;code&gt;ctx.Writer.Status() != http.StatusOK&lt;/code&gt; æ—¶ï¼Œä¸º &lt;code&gt;false&lt;/code&gt;ï¼Œåä¹‹ä¸º &lt;code&gt;true&lt;/code&gt;ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;æ‰§è¡Œæ—¶é•¿&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;Float64&lt;/code&gt;ï¼Œä¾‹å¦‚ï¼š0.041746869ï¼Œè®°å½•çš„æ˜¯ä»è¯·æ±‚å¼€å§‹åˆ°è¯·æ±‚ç»“æŸæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å¦‚ä½•æ”¶é›†å‚æ•°ï¼Ÿ&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™æ—¶æœ‰è€é“ä¼šè¯´äº†ï¼šâ€œè§„åˆ’çš„ç¨å¾®è¿˜è¡Œï¼Œä½¿ç”¨çš„æ—¶å€™ä¼šä¸ä¼šå¾ˆéº»çƒ¦ï¼Ÿâ€&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;â€œNoï¼ŒNoï¼Œä½¿ç”¨èµ·æ¥ä¸€ä¸¢ä¸¢éƒ½ä¸éº»çƒ¦â€ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;æ— éœ€å…³å¿ƒçš„å‚æ•°&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é“¾è·¯ IDã€è¯·æ±‚ä¿¡æ¯ã€å“åº”ä¿¡æ¯ã€è¯·æ±‚ç»“æœã€æ‰§è¡Œæ—¶é•¿ï¼Œè¿™ 5 ä¸ªå‚æ•°ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒï¼Œè¿™äº›éƒ½åœ¨ä¸­é—´ä»¶å°è£…å¥½äº†ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£çš„ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åªéœ€å¤šä¼ é€’ä¸€ä¸ªå‚æ•°å³å¯ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨è¿™é‡Œåšè„¸çš®è‡ªèä¸‹ &lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MjM5NDM4MDIwNw==&amp;amp;mid=2448835805&amp;amp;idx=1&amp;amp;sn=22b604de89071040430bacba78223197&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;httpclient åŒ…&lt;/a&gt; ã€‚&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;æ”¯æŒè®¾ç½®å¤±è´¥æ—¶é‡è¯•ï¼Œå¯ä»¥è‡ªå®šä¹‰é‡è¯•æ¬¡æ•°ã€é‡è¯•å‰å»¶è¿Ÿç­‰å¾…æ—¶é—´ã€é‡è¯•çš„æ»¡è¶³æ¡ä»¶ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ”¯æŒè®¾ç½®å¤±è´¥æ—¶å‘Šè­¦ï¼Œå¯ä»¥è‡ªå®šä¹‰å‘Šè­¦æ¸ é“ï¼ˆé‚®ä»¶/å¾®ä¿¡ï¼‰ã€å‘Šè­¦çš„æ»¡è¶³æ¡ä»¶ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ”¯æŒè®¾ç½®è°ƒç”¨é“¾è·¯ï¼›&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è°ƒç”¨ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;//Â httpclientÂ æ˜¯é¡¹ç›®ä¸­å°è£…çš„åŒ…&lt;br/&gt;apiÂ :=Â &lt;span&gt;&quot;http://127.0.0.1:9999/demo/post&quot;&lt;/span&gt;&lt;br/&gt;paramsÂ :=Â url.Values{}&lt;br/&gt;params.Set(&lt;span&gt;&quot;name&quot;&lt;/span&gt;,Â name)&lt;br/&gt;body,Â errÂ :=Â httpclient.PostForm(api,Â params,&lt;br/&gt;Â Â Â Â httpclient.WithTrace(ctx.Trace()),Â Â //Â ä¼ é€’ä¸Šä¸‹æ–‡&lt;br/&gt;)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;è°ƒè¯•ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åªéœ€å¤šä¼ é€’ä¸€ä¸ªå‚æ•°å³å¯ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è°ƒç”¨ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;// p æ˜¯é¡¹ç›®ä¸­å°è£…çš„åŒ…&lt;br/&gt;p.Println(&lt;span&gt;&quot;key&quot;&lt;/span&gt;,Â &lt;span&gt;&quot;value&quot;&lt;/span&gt;,&lt;br/&gt;Â p.WithTrace(ctx.Trace()),Â //Â ä¼ é€’ä¸Šä¸‹æ–‡&lt;br/&gt;)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;SQL ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¨å¾®å¤æ‚ä¸€ä¸¢ä¸¢ï¼Œéœ€è¦å¤šä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œç„¶åå†å†™ä¸€ä¸ª &lt;code&gt;GORM&lt;/code&gt; æ’ä»¶ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½¿ç”¨çš„ &lt;code&gt;GORM V2&lt;/code&gt; è‡ªå¸¦çš„ &lt;code&gt;Callbacks&lt;/code&gt; å’Œ &lt;code&gt;Context&lt;/code&gt; çŸ¥è¯†ç‚¹ï¼Œç»†èŠ‚ä¸å¤šè¯´ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MjM5NDM4MDIwNw==&amp;amp;mid=2448835781&amp;amp;idx=1&amp;amp;sn=8cd67bbc3118241e09ce41ede2a07ac9&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;åŸºäº GORM è·å–å½“å‰è¯·æ±‚æ‰€æ‰§è¡Œçš„ SQL ä¿¡æ¯&lt;/a&gt;ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è°ƒç”¨ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;//Â åŸæ¥æŸ¥è¯¢è¿™æ ·å†™&lt;br/&gt;errÂ :=Â u.db.GetDbR().&lt;br/&gt;Â Â Â Â First(data,Â id).&lt;br/&gt;Â Â Â Â Where(&lt;span&gt;&quot;is_deletedÂ =Â ?&quot;&lt;/span&gt;,Â -1).&lt;br/&gt;Â Â Â Â Error&lt;br/&gt;&lt;br/&gt;//Â ç°åœ¨åªéœ€è¿™æ ·å†™&lt;br/&gt;errÂ :=Â u.db.GetDbR().&lt;br/&gt;Â Â Â Â WithContext(ctx.RequestContext()).&lt;br/&gt;Â Â Â Â First(data,Â id).&lt;br/&gt;Â Â Â Â Where(&lt;span&gt;&quot;is_deletedÂ =Â ?&quot;&lt;/span&gt;,Â -1).&lt;br/&gt;Â Â Â Â Error&lt;br/&gt;Â Â Â Â &lt;br/&gt;// .WithContext æ˜¯ GORM V2 è‡ªå¸¦çš„ã€‚Â Â Â Â &lt;br/&gt;//Â æ’ä»¶çš„ä»£ç å°±ä¸è´´äº†ï¼Œå»ä¸Šé¢çš„æ–‡ç« æŸ¥çœ‹å³å¯ã€‚&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;Redis ä¿¡æ¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åªéœ€å¤šä¼ é€’ä¸€ä¸ªå‚æ•°å³å¯ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è°ƒç”¨ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;//Â cacheÂ æ˜¯åŸºäºÂ go-redisÂ å°è£…çš„åŒ…&lt;br/&gt;d.cache.Get(&lt;span&gt;&quot;name&quot;&lt;/span&gt;,Â &lt;br/&gt;Â Â Â Â cache.WithTrace(c.Trace()),&lt;br/&gt;)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;æ ¸å¿ƒåŸç†æ˜¯å•¥ï¼Ÿ&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨è¿™æ²¡å…³å­å¯å–ï¼Œçœ‹åˆ°è¿™ç›¸ä¿¡è€é“ä»¬éƒ½çŸ¥é“äº†ï¼Œå°±ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯ æ‹¦æˆªå™¨ï¼Œå¦ä¸€ä¸ªæ˜¯ &lt;code&gt;Context&lt;/code&gt;ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.9370629370629371&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/go9jpG3BuhTZqG9aQ0doMjaVkoFiaYfSmgH1HBLmojYnZm2ESiaia0uUwglTOqrjoG9I6ribDZxqtF3aqmOhkjiaUrw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;429&quot;/&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å¦‚ä½•è®°å½•å‚æ•°ï¼Ÿ&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å°†ä»¥ä¸Šæ•°æ®è½¬ä¸º &lt;code&gt;JSON&lt;/code&gt; ç»“æ„è®°å½•åˆ°æ—¥å¿—ä¸­ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;JSON ç¤ºä¾‹&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;level&quot;&lt;/span&gt;:&lt;span&gt;&quot;info&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;time&quot;&lt;/span&gt;:&lt;span&gt;&quot;2021-01-30Â 22:32:48&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;caller&quot;&lt;/span&gt;:&lt;span&gt;&quot;core/core.go:444&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;msg&quot;&lt;/span&gt;:&lt;span&gt;&quot;core-interceptor&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;domain&quot;&lt;/span&gt;:&lt;span&gt;&quot;go-gin-api[fat]&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;method&quot;&lt;/span&gt;:&lt;span&gt;&quot;GET&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;path&quot;&lt;/span&gt;:&lt;span&gt;&quot;/demo/trace&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;http_code&quot;&lt;/span&gt;:200,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;business_code&quot;&lt;/span&gt;:1,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;success&quot;&lt;/span&gt;:&lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.054025302,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;trace_id&quot;&lt;/span&gt;:&lt;span&gt;&quot;2cdb2f96934f573af391&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;trace_info&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&quot;trace_id&quot;&lt;/span&gt;:&lt;span&gt;&quot;2cdb2f96934f573af391&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&quot;request&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;ttl&quot;&lt;/span&gt;:&lt;span&gt;&quot;un-limit&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;method&quot;&lt;/span&gt;:&lt;span&gt;&quot;GET&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;decoded_url&quot;&lt;/span&gt;:&lt;span&gt;&quot;/demo/trace&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;header&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Accept&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;application/json&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Accept-Encoding&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;gzip,Â deflate,Â br&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Accept-Language&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;zh-CN,zh;q=0.9,en;q=0.8&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Authorization&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjEsIlVzZXJOYW1lIjoieGlubGlhbmdub3RlIiwiZXhwIjoxNjEyMTAzNTQwLCJpYXQiOjE2MTIwMTcxNDAsIm5iZiI6MTYxMjAxNzE0MH0.2yHDdP7cNT5uL5xA0-j_NgTK4GrW-HGn0KUxcbZfpKg&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Connection&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;keep-alive&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Referer&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;http://127.0.0.1:9999/swagger/index.html&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Sec-Fetch-Dest&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;empty&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Sec-Fetch-Mode&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cors&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Sec-Fetch-Site&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;same-origin&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;User-Agent&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Mozilla/5.0Â (Macintosh;Â IntelÂ MacÂ OSÂ XÂ 10_15_6)Â AppleWebKit/537.36Â (KHTML,Â likeÂ Gecko)Â Chrome/88.0.4324.96Â Safari/537.36&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ]&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;body&quot;&lt;/span&gt;:&lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&quot;response&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;header&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Content-Type&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;application/json;Â charset=utf-8&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Trace-Id&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;2cdb2f96934f573af391&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Vary&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Origin&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ]&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;body&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;code&quot;&lt;/span&gt;:1,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;msg&quot;&lt;/span&gt;:&lt;span&gt;&quot;OK&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;data&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;name&quot;&lt;/span&gt;:&lt;span&gt;&quot;Tom&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;job&quot;&lt;/span&gt;:&lt;span&gt;&quot;Student&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;name&quot;&lt;/span&gt;:&lt;span&gt;&quot;Jack&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;job&quot;&lt;/span&gt;:&lt;span&gt;&quot;Teacher&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;id&quot;&lt;/span&gt;:&lt;span&gt;&quot;2cdb2f96934f573af391&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;business_code&quot;&lt;/span&gt;:1,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;business_code_msg&quot;&lt;/span&gt;:&lt;span&gt;&quot;OK&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;http_code&quot;&lt;/span&gt;:200,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;http_code_msg&quot;&lt;/span&gt;:&lt;span&gt;&quot;OK&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.054024874&lt;br/&gt;Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&quot;third_party_requests&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;request&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;ttl&quot;&lt;/span&gt;:&lt;span&gt;&quot;5s&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;method&quot;&lt;/span&gt;:&lt;span&gt;&quot;GET&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;decoded_url&quot;&lt;/span&gt;:&lt;span&gt;&quot;http://127.0.0.1:9999/demo/get/Tom&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;header&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Authorization&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjEsIlVzZXJOYW1lIjoieGlubGlhbmdub3RlIiwiZXhwIjoxNjEyMTAzNTQwLCJpYXQiOjE2MTIwMTcxNDAsIm5iZiI6MTYxMjAxNzE0MH0.2yHDdP7cNT5uL5xA0-j_NgTK4GrW-HGn0KUxcbZfpKg&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Content-Type&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;application/x-www-form-urlencoded;Â charset=utf-8&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;TRACE-ID&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;2cdb2f96934f573af391&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ]&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;body&quot;&lt;/span&gt;:null&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;responses&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;header&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Content-Length&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;87&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Content-Type&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;application/json;Â charset=utf-8&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Date&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Sat,Â 30Â JanÂ 2021Â 14:32:48Â GMT&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Trace-Id&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;2cdb2f96934f573af391&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Vary&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Origin&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ]&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;body&quot;&lt;/span&gt;:&lt;span&gt;&quot;{&quot;&lt;/span&gt;code&lt;span&gt;&quot;:1,&quot;&lt;/span&gt;msg&lt;span&gt;&quot;:&quot;&lt;/span&gt;OK&lt;span&gt;&quot;,&quot;&lt;/span&gt;data&lt;span&gt;&quot;:{&quot;&lt;/span&gt;name&lt;span&gt;&quot;:&quot;&lt;/span&gt;Tom&lt;span&gt;&quot;,&quot;&lt;/span&gt;job&lt;span&gt;&quot;:&quot;&lt;/span&gt;Student&lt;span&gt;&quot;},&quot;&lt;/span&gt;id&lt;span&gt;&quot;:&quot;&lt;/span&gt;2cdb2f96934f573af391&lt;span&gt;&quot;}&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;http_code&quot;&lt;/span&gt;:200,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;http_code_msg&quot;&lt;/span&gt;:&lt;span&gt;&quot;200Â OK&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.000555089&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;success&quot;&lt;/span&gt;:&lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.000580202&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;request&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;ttl&quot;&lt;/span&gt;:&lt;span&gt;&quot;5s&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;method&quot;&lt;/span&gt;:&lt;span&gt;&quot;POST&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;decoded_url&quot;&lt;/span&gt;:&lt;span&gt;&quot;http://127.0.0.1:9999/demo/post&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;header&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Authorization&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjEsIlVzZXJOYW1lIjoieGlubGlhbmdub3RlIiwiZXhwIjoxNjEyMTAzNTQwLCJpYXQiOjE2MTIwMTcxNDAsIm5iZiI6MTYxMjAxNzE0MH0.2yHDdP7cNT5uL5xA0-j_NgTK4GrW-HGn0KUxcbZfpKg&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Content-Type&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;application/x-www-form-urlencoded;Â charset=utf-8&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;TRACE-ID&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;2cdb2f96934f573af391&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ]&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;body&quot;&lt;/span&gt;:&lt;span&gt;&quot;name=Jack&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;responses&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;header&quot;&lt;/span&gt;:{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Content-Length&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;88&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Content-Type&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;application/json;Â charset=utf-8&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Date&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Sat,Â 30Â JanÂ 2021Â 14:32:48Â GMT&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Trace-Id&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;2cdb2f96934f573af391&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Vary&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;Origin&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ]&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;body&quot;&lt;/span&gt;:&lt;span&gt;&quot;{&quot;&lt;/span&gt;code&lt;span&gt;&quot;:1,&quot;&lt;/span&gt;msg&lt;span&gt;&quot;:&quot;&lt;/span&gt;OK&lt;span&gt;&quot;,&quot;&lt;/span&gt;data&lt;span&gt;&quot;:{&quot;&lt;/span&gt;name&lt;span&gt;&quot;:&quot;&lt;/span&gt;Jack&lt;span&gt;&quot;,&quot;&lt;/span&gt;job&lt;span&gt;&quot;:&quot;&lt;/span&gt;Teacher&lt;span&gt;&quot;},&quot;&lt;/span&gt;id&lt;span&gt;&quot;:&quot;&lt;/span&gt;2cdb2f96934f573af391&lt;span&gt;&quot;}&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;http_code&quot;&lt;/span&gt;:200,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;http_code_msg&quot;&lt;/span&gt;:&lt;span&gt;&quot;200Â OK&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.000450153&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;success&quot;&lt;/span&gt;:&lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.000468387&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&quot;debugs&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;key&quot;&lt;/span&gt;:&lt;span&gt;&quot;res1.Data.Name&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;value&quot;&lt;/span&gt;:&lt;span&gt;&quot;Tom&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.000005193&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;key&quot;&lt;/span&gt;:&lt;span&gt;&quot;res2.Data.Name&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;value&quot;&lt;/span&gt;:&lt;span&gt;&quot;Jack&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.000003907&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;key&quot;&lt;/span&gt;:&lt;span&gt;&quot;redis-name&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;value&quot;&lt;/span&gt;:&lt;span&gt;&quot;tom&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.000009816&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&quot;sqls&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span&gt;&quot;2021-01-30Â 22:32:48&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;stack&quot;&lt;/span&gt;:&lt;span&gt;&quot;/Users/xinliang/github/go-gin-api/internal/api/repository/db_repo/user_demo_repo/user_demo.go:76&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;sql&quot;&lt;/span&gt;:&lt;span&gt;&quot;SELECTÂ `id`,`user_name`,`nick_name`,`mobile`Â FROMÂ `user_demo`Â WHEREÂ user_nameÂ =Â &#x27;test_user&#x27;Â andÂ is_deletedÂ =Â -1Â ORDERÂ BYÂ `user_demo`.`id`Â LIMITÂ 1&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;rows_affected&quot;&lt;/span&gt;:1,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.031969072&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&quot;redis&quot;&lt;/span&gt;:[&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span&gt;&quot;2021-01-30Â 22:32:48&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;handle&quot;&lt;/span&gt;:&lt;span&gt;&quot;set&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;key&quot;&lt;/span&gt;:&lt;span&gt;&quot;name&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;value&quot;&lt;/span&gt;:&lt;span&gt;&quot;tom&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;ttl&quot;&lt;/span&gt;:10,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.009982091&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â },&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span&gt;&quot;2021-01-30Â 22:32:48&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;handle&quot;&lt;/span&gt;:&lt;span&gt;&quot;get&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;key&quot;&lt;/span&gt;:&lt;span&gt;&quot;name&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.010681579&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â ],&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&quot;success&quot;&lt;/span&gt;:&lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&quot;cost_seconds&quot;&lt;/span&gt;:0.054025302&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;zap æ—¥å¿—ç»„ä»¶&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰å¯¹æ—¥å¿—æ”¶é›†æ„Ÿå…´è¶£çš„è€é“ä»¬å¯ä»¥å¾€ä¸‹çœ‹ï¼Œ&lt;code&gt;trace_info&lt;/code&gt; åªæ˜¯æ—¥å¿—çš„ä¸€ä¸ªå‚æ•°ï¼Œå…·ä½“æ—¥å¿—å‚æ•°åŒ…æ‹¬ï¼š&lt;/p&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;å‚æ•°&lt;/th&gt;&lt;th&gt;æ•°æ®ç±»å‹&lt;/th&gt;&lt;th&gt;è¯´æ˜&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;level&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;æ—¥å¿—çº§åˆ«ï¼Œä¾‹å¦‚ï¼šinfo,warn,error,debug&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;time&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;æ—¶é—´ï¼Œä¾‹å¦‚ï¼š2021-01-30 16:05:44&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;caller&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;è°ƒç”¨ä½ç½®ï¼Œæ–‡ä»¶+è¡Œå·ï¼Œä¾‹å¦‚ï¼šcore/core.go:443&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;msg&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;æ—¥å¿—ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šxx é”™è¯¯&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;domain&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;åŸŸåæˆ–æœåŠ¡åï¼Œä¾‹å¦‚ï¼šgo-gin-api[fat]&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;method&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;è¯·æ±‚æ–¹å¼ï¼Œä¾‹å¦‚ï¼šPOST&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;path&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;è¯·æ±‚è·¯å¾„ï¼Œä¾‹å¦‚ï¼š/user/create&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;http_code&lt;/td&gt;&lt;td&gt;Int&lt;/td&gt;&lt;td&gt;HTTP çŠ¶æ€ç ï¼Œä¾‹å¦‚ï¼š200&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;business_code&lt;/td&gt;&lt;td&gt;Int&lt;/td&gt;&lt;td&gt;ä¸šåŠ¡çŠ¶æ€ç ï¼Œä¾‹å¦‚ï¼š10101&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;success&lt;/td&gt;&lt;td&gt;Bool&lt;/td&gt;&lt;td&gt;çŠ¶æ€ï¼Œtrue or false&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;cost_seconds&lt;/td&gt;&lt;td&gt;Float64&lt;/td&gt;&lt;td&gt;èŠ±è´¹æ—¶é—´ï¼Œå•ä½ï¼šç§’ï¼Œä¾‹å¦‚ï¼š0.01&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;trace_id&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;é“¾è·¯IDï¼Œä¾‹å¦‚ï¼šec3c868c8dcccfe515ab&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;trace_info&lt;/td&gt;&lt;td&gt;Object&lt;/td&gt;&lt;td&gt;é“¾è·¯ä¿¡æ¯ï¼Œç»“æ„åŒ–æ•°æ®ã€‚&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;error&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;é”™è¯¯ä¿¡æ¯ï¼Œå½“å‡ºç°é”™è¯¯æ—¶æ‰æœ‰è¿™å­—æ®µã€‚&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;errorVerbose&lt;/td&gt;&lt;td&gt;String&lt;/td&gt;&lt;td&gt;è¯¦ç»†çš„é”™è¯¯å †æ ˆä¿¡æ¯ï¼Œå½“å‡ºç°é”™è¯¯æ—¶æ‰æœ‰è¿™å­—æ®µã€‚&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ—¥å¿—è®°å½•å¯ä»¥ä½¿ç”¨ &lt;code&gt;zap&lt;/code&gt;ï¼Œ&lt;code&gt;logrus&lt;/code&gt; ï¼Œè¿™æ¬¡æˆ‘ä½¿ç”¨çš„ &lt;code&gt;zap&lt;/code&gt;ï¼Œç®€å•å°è£…ä¸€ä¸‹å³å¯ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;æ”¯æŒè®¾ç½®æ—¥å¿—çº§åˆ«ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ”¯æŒè®¾ç½®æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ”¯æŒè®¾ç½®æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ”¯æŒè®¾ç½®æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶(å¯è‡ªåŠ¨åˆ†å‰²)ï¼›&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;æ€»ç»“&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒå¸¸ç”¨ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆçˆ½ï¼Œæ¯”å¦‚è°ƒç”¨æ–¹å‘ç°æ¥å£å‡ºé—®é¢˜æ—¶ï¼Œåªéœ€è¦æä¾› &lt;code&gt;TRACE-ID&lt;/code&gt; å³å¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŸ¥åˆ°å…³äºå®ƒæ•´ä¸ªé“¾è·¯çš„æ‰€æœ‰ä¿¡æ¯ã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ä»¥ä¸Šä»£ç éƒ½åœ¨ go-gin-api é¡¹ç›®ä¸­ï¼Œåœ°å€ï¼šhttps://github.com/xinliangnote/go-gin-api&lt;/p&gt;&lt;/blockquote&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>