<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>160c47043726f50edad816c798621dc5</guid>
<title>深入了解 SSH</title>
<link>https://toutiao.io/k/8y463n2</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p&gt;SSH 是每一台电脑的标准配置，Linux 就不必说了，连 &lt;span&gt;windows&lt;sup&gt;[1]&lt;/sup&gt;&lt;/span&gt; 也从 2018 年开始自带 OpenSSH 了。它主要的用途是登陆到远程电脑中执行命令，在云开发的时代，它是每个程序每天都要用到的工具。本文将简单介绍一下它的原理， 基本用法以及端口转发和动态转发等高阶用法。&lt;/p&gt;&lt;h2&gt;介绍&lt;/h2&gt;&lt;p&gt;&lt;span&gt;SSH&lt;sup&gt;[2]&lt;/sup&gt;&lt;/span&gt; 叫安全外壳协议（&lt;strong&gt;S&lt;/strong&gt;ecure &lt;strong&gt;Sh&lt;/strong&gt;ell），是一种加密的网络传输协议，可在不安全的网络中网络服务提供安全的传输环境。它通过在网络中创建安全隧道来实现 SSH 客户端和服务器之间的连接。最早的时候，互联网通信都是明文通信，一旦被截获，内容就会被暴露。1995年，芬兰学者 Tatu Ylonen 设计了 SSH 协议，将登录信息全部加密，成为互联网安全的一个基本解决方案，迅速在全世界获得推广，目前已经成为所有操作系统的标准配置。&lt;/p&gt;&lt;p&gt;SSH 是一种协议， 存在多种实现，既有商业实现，也有开源实现（OSSH，OpenSSH）。本文使用的自有软件 OpenSSH， 毕竟它是目前最流行的 SSH 实现，而且是所有操作系统的默认组件。&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;TIPS: OpenSSH发展史&lt;br/&gt;1995 年 7 月， Tatu Ylonen 以免费软件的形式将一套保护信息传输的程序（也就是 SSH ）发布出去。程序很快流行，到年底已经有两万用户，遍布五十国家。所以在年底时，他创立了 SSH 通信安全公司来继续开发和销售 SSH, 所以它变成了专有软件。在 1999 年，瑞典程序员基于 SSH 最后一个开源的版本 1.2.12 开发了 OSSH，之后 OpenBSD 开发者在 OSSH 的基础上进行大量修改，形成了 OpenSSH。它是目前唯一一种最流行的 SSH 实现，成为了所有操作系统的默认组件。&lt;/p&gt;&lt;/blockquote&gt;&lt;h2&gt;原理介绍&lt;/h2&gt;&lt;p&gt;SSH 之所以一经提出，就得到了快速发展，是因为数据的安全性对任何人都非常重要。这里我们对其保护数据安全的原理进行探究。&lt;/p&gt;&lt;p&gt;在聊加密前先介绍一下几个密码学的基本概念：&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;明文&lt;code&gt;plaintext&lt;/code&gt; 指传送方（一般指客户端）想要接受方（一般指服务端）获得的&lt;strong&gt;可读信息&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;密文&lt;code&gt;ciphertext&lt;/code&gt; 指明文经过加密后所产生的信息&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;秘钥&lt;code&gt;key&lt;/code&gt; 指用来完成加密、解密、完整性验证等密码学应用的密码信息，是明文转换为密文或密文转换为明文的算法需要的参数&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;私钥 指私有的秘钥&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;公钥 指公开的秘钥&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;对称加密&lt;/h3&gt;&lt;p&gt;对称加密就是加密或解密使用的是同一个秘钥。比较常用的对称加密算法有 AES，DES等。其具体的时序图如下：&lt;img data-ratio=&quot;0.918848167539267&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/bDCibGAYVPCyvWRy5tG2SM6maAtlm1FjpibMOB06JFetKGMq1I1XojEPDIp1licW6WoVibm9TSkiblria2H16T5qxNPA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;764&quot; title=&quot;null&quot;/&gt;&lt;/p&gt;&lt;p&gt;对称加密的优点是加解密效率高，速度快。对于服务端而言，它和每个客户端都要有一个秘钥，庞大的客户端数目导致秘钥数目多，而且一旦机器被登录，所有的秘钥都泄露，所以缺点是秘钥的管理和分发比较困难，不安全。&lt;/p&gt;&lt;h3&gt;非对称加密&lt;/h3&gt;&lt;p&gt;非对称加密需要一对秘钥来进行加密和解密，公开的秘钥叫公钥，私有的秘钥叫私钥。注意公钥加密的信息&lt;strong&gt;只有&lt;/strong&gt;私钥才能解开（加密过程），私钥加密的信息&lt;strong&gt;只有&lt;/strong&gt;公钥才能解开（验签过程）。比较常用的非对称加密算法有 RSA。其具体的时序图如下：&lt;img data-ratio=&quot;1.1146408839779005&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/bDCibGAYVPCyvWRy5tG2SM6maAtlm1Fjp76vAYbT0E5mJCXkjRA55uFVeUrkWSSnUWPnB4ByH34SJlkCUKOKicnQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;724&quot; title=&quot;null&quot;/&gt;&lt;/p&gt;&lt;p&gt;非对称加密的优点是安全性更高，秘钥管理比较方便，每个服务器只要维护一对公私钥即可。缺点是加解密耗时长，速度慢。不过对于现在的计算机而言，这点成本可以忽略不计。&lt;/p&gt;&lt;h3&gt;中间人攻击&lt;/h3&gt;&lt;p&gt;中间人攻击的英文全称是 Man-in-the-middle attack，缩写为 MITM。在密码学和计算机安全领域中是指攻击者与通讯的两端分别创建独立的联系，并交换其所收到的数据，使通讯的两端认为他们正在通过一个私密的连接与对方直接对话，但事实上整个会话都被攻击者完全控制。在中间人攻击中，攻击者可以拦截通讯双方的通话并插入新的内容。在许多情况下这是很简单的（例如，在一个未加密的 Wi-Fi 无线接入点的接受范围内的中间人攻击者，可以将自己作为一个中间人插入这个网络）。其具体的时序图如下：&lt;img data-ratio=&quot;0.7526978417266187&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/bDCibGAYVPCyvWRy5tG2SM6maAtlm1FjplsMcj8k2k3xONWRLybe9dXRsD9Lz1AKbnYF0v2WoM0yhMOHlDnIqXA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1112&quot; title=&quot;null&quot;/&gt;&lt;/p&gt;&lt;p&gt;受到中间人攻击的关键原因是客户端不知道服务端的公钥真假，服务端也不知道客户端的公钥真假。所以破解这个问题的关键是如何相互认证，也就是要像黄宏《开锁》小品里一样证明我就是我，你就是你。&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;code&quot;&gt;&lt;code&gt;@&lt;span&gt;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&lt;/span&gt;&lt;br/&gt;@  WARNING: REMOTE HOST IDENTIFI&lt;span&gt;CATION&lt;/span&gt; HAS CHANGED!   @&lt;br/&gt;@&lt;span&gt;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&lt;/span&gt;&lt;br/&gt;&lt;span&gt;IT&lt;/span&gt; IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!&lt;br/&gt;Someone could be eavesdropping &lt;span&gt;on&lt;/span&gt; you right now (man-&lt;span&gt;in&lt;/span&gt;-the-middle attack)!&lt;br/&gt;It &lt;span&gt;is&lt;/span&gt; also possible that a host key has just been changed.&lt;br/&gt;The fingerprint &lt;span&gt;for&lt;/span&gt; the ECDSA key sent &lt;span&gt;by&lt;/span&gt; the remote host &lt;span&gt;is&lt;/span&gt;&lt;br/&gt;&lt;span&gt;SHA256&lt;/span&gt;&lt;span&gt;:sYNNR1L6T5cSAG4BndqtdDhJEI0eB9LamBTkuIue3+0.&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Please&lt;/span&gt; contact your system administrator.&lt;br/&gt;Add correct host key &lt;span&gt;in&lt;/span&gt; &lt;span&gt;/Users/xx/&lt;/span&gt;.ssh/known_hosts to get rid &lt;span&gt;of&lt;/span&gt; &lt;span&gt;this&lt;/span&gt; message.&lt;br/&gt;Offending ECDSA key &lt;span&gt;in&lt;/span&gt; &lt;span&gt;/Users/xx/&lt;/span&gt;.ssh/known_hosts:&lt;span&gt;40&lt;/span&gt;&lt;br/&gt;ECDSA host key &lt;span&gt;for&lt;/span&gt; [xx.com] has changed &lt;span&gt;and&lt;/span&gt; you have requested strict checking.&lt;br/&gt;&lt;span&gt;Host&lt;/span&gt; key verification failed.&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h2&gt;基本用法&lt;/h2&gt;&lt;h3&gt;生成公钥&lt;/h3&gt;&lt;p&gt;ssh-keygen 是安全外壳（ SSH ）协议套件的标准组件，用于生成，管理和转换身份验证密钥。&lt;/p&gt;&lt;h3&gt;参数说明&lt;/h3&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-b bits 指定要创建的秘钥中的位数，默认 2048 位。值越大，密码越复杂&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-C comment 注释，在 id_rsa.pub 中末尾&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-t rsa/dsa等 指定要创建的秘钥类型，默认为 RSA&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-f filename 指定公私钥的名称，会在 &lt;code&gt;$HOME/.ssh&lt;/code&gt; 目录下生产私钥 filename 和公钥 filename.pub&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-N password 指定使用秘钥的密码，使得多人使用同一台机器时更安全&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;常用命令&lt;/h3&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# 生成公私钥，默认文件为 ~/.ssh/id_rsa&lt;/span&gt;&lt;br/&gt;ssh-keygen -t rsa -b &lt;span&gt;4096&lt;/span&gt; -C &lt;span&gt;&quot;your_email@example.com&quot;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;&lt;span&gt;管理秘钥&lt;sup&gt;[3]&lt;/sup&gt;&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;ssh-agent 和 ssh-add 是安全外壳（SSH）协议套件的标准组件，用于管理私钥。一般情况下我们使用不带密码的 id_rsa 作为我们的默认私钥，此时是没必要启动 ssh-agent 的。当我们碰到以下两种情况则需要它：&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;1.&lt;/span&gt;使用不同的秘钥连接到不同的主机时，需要手动指定对应的秘钥。（ssh-agent 帮我们选择对应的秘钥进行认证）&lt;/span&gt;&lt;span&gt;&lt;span&gt;2.&lt;/span&gt;当私钥设置了密码，而我们又需要频繁的使用私钥进行认证。（ssh-agent 帮我们免去重复输入密码）&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;代理常用命令&lt;/h3&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# 启动代理&lt;/span&gt;&lt;br/&gt;&lt;span&gt;eval&lt;/span&gt; &lt;span&gt;`ssh-agent`&lt;/span&gt;&lt;br/&gt;&lt;span&gt;# 关闭代理&lt;/span&gt;&lt;br/&gt;ssh-agent -k&lt;br/&gt;&lt;span&gt;# 在 ~/.bashrc 中加入以下来实现登陆自动启动 ssh-agent，退出自动 kill 掉程序&lt;/span&gt;&lt;br/&gt;&lt;span&gt;eval&lt;/span&gt; $(ssh-agent -s) &amp;amp;gt; &lt;span&gt;/dev/&lt;/span&gt;&lt;span&gt;null&lt;/span&gt;&lt;br/&gt;&lt;span&gt;trap&lt;/span&gt; &lt;span&gt;&#x27;test -n &quot;&lt;span&gt;$SSH_AGENT_PID&lt;/span&gt;&quot; &amp;amp;&amp;amp; eval `/usr/bin/ssh-agent -k` &amp;amp;gt; /dev/null&#x27;&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;# 查看代理中的私钥&lt;/span&gt;&lt;br/&gt;ssh-add &lt;span&gt;-l&lt;/span&gt;&lt;br/&gt;&lt;span&gt;# 查看代理中私钥对应的公钥&lt;/span&gt;&lt;br/&gt;ssh-add -L&lt;br/&gt;&lt;span&gt;# 移除指定的私钥&lt;/span&gt;&lt;br/&gt;ssh-add &lt;span&gt;-d&lt;/span&gt; /path/of/key/key_name&lt;br/&gt;&lt;span&gt;# 移除所有的私钥&lt;/span&gt;&lt;br/&gt;ssh-add -D&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;发送公钥&lt;/h3&gt;&lt;p&gt;ssh-copy-id 是一个用来将公钥放到服务器上的脚本。它通过 SSH 密码登陆远程服务器，并将指定的公钥放到远程服务器 &lt;code&gt;$HOME/.ssh/authorized_keys&lt;/code&gt; 中。这个操作也可以先登陆到服务器中，然后通过 vi 等文本编辑命令向 &lt;code&gt;$HOME/.ssh/authorized_keys&lt;/code&gt; 中加入允许登陆的公钥。不过对于云服务器可以在启动服务器时在页面上操作绑定公钥，这样更安全些（阿里云和腾讯云默认关闭秘钥登陆 &lt;code&gt;PasswordAuthentication no&lt;/code&gt; ）。特别注意的是，千万别在公共的网络中通过密码登陆远程服务器，而秘钥登陆没有问题。&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# 发送公钥的两种方式（等价）&lt;/span&gt;&lt;br/&gt;ssh-&lt;span&gt;copy&lt;/span&gt;-&lt;span&gt;id&lt;/span&gt; -i ~/.ssh/id_rsa.pub user@host&lt;br/&gt;ssh user@host &lt;span&gt;&#x27;mkdir -p .ssh &amp;amp;&amp;amp; cat &amp;amp;gt;&amp;amp;gt; .ssh/authorized_keys&#x27;&lt;/span&gt; &amp;amp;&lt;span&gt;lt&lt;/span&gt;; ~&lt;span&gt;/.ssh/id&lt;/span&gt;_rsa.pub&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;登录&lt;/h3&gt;&lt;h3&gt;登录配置&lt;/h3&gt;&lt;p&gt;SSH 登陆服务器需要知道服务器的主机地址（主机名或主机 IP 地址），用户名和密码，有时还要指定端口号（默认 22 ）。主机名还好，但是主机IP 地址就比较难记的，特别是当你可能要登录十几台服务器时。一般我们使用的登陆命令如下：&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;# 登陆目标服务器( 172&lt;span&gt;.17&lt;/span&gt;&lt;span&gt;.132&lt;/span&gt;&lt;span&gt;.120&lt;/span&gt; )&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; -p &lt;span&gt;58422&lt;/span&gt; user@&lt;span&gt;172.17.132.120&lt;/span&gt;&lt;br/&gt;# 通过跳板机登陆目标服务器( 172&lt;span&gt;.17&lt;/span&gt;&lt;span&gt;.132&lt;/span&gt;&lt;span&gt;.120&lt;/span&gt; )&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; -p &lt;span&gt;58422&lt;/span&gt; user&lt;span&gt;@jumper&lt;/span&gt;.example.com ssh user@&lt;span&gt;172.17.132.120&lt;/span&gt;&lt;br/&gt;&lt;span&gt;# 端口映射&lt;/span&gt;&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; -p &lt;span&gt;58422&lt;/span&gt; user&lt;span&gt;@jumper&lt;/span&gt;.example.com -fNL &lt;span&gt;5433&lt;/span&gt;:&lt;span&gt;172.17.132.120:5432&lt;/span&gt; -N&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;通过配置 &lt;code&gt;$HOME/.ssh/config&lt;/code&gt; 可以使用以下命令来登录。&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;# 登陆目标服务器( 172&lt;span&gt;.17&lt;/span&gt;&lt;span&gt;.132&lt;/span&gt;&lt;span&gt;.120&lt;/span&gt; )&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; target&lt;br/&gt;# 通过跳板机登陆目标服务器( 172&lt;span&gt;.17&lt;/span&gt;&lt;span&gt;.132&lt;/span&gt;&lt;span&gt;.120&lt;/span&gt; )&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; jump_target&lt;br/&gt;&lt;span&gt;# 端口映射&lt;/span&gt;&lt;br/&gt;&lt;span&gt;## 登陆时通过 LocalForward 配置&lt;/span&gt;&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; jump_target&lt;br/&gt;&lt;span&gt;## 使用-L来实现本地端口映射&lt;/span&gt;&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; &lt;span&gt;-C&lt;/span&gt; &lt;span&gt;-N&lt;/span&gt; &lt;span&gt;-g&lt;/span&gt; &lt;span&gt;-L&lt;/span&gt; 5433&lt;span&gt;:127.0.0.1&lt;/span&gt;&lt;span&gt;:5432&lt;/span&gt; &lt;span&gt;jump_target&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;code&quot;&gt;&lt;code&gt;&lt;span&gt;# 通用配置，所有配置都使用&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Host&lt;/span&gt; *&lt;br/&gt;    &lt;span&gt;AddKeysToAgent&lt;/span&gt; &lt;span&gt;yes&lt;/span&gt;      &lt;span&gt;# 将私钥添加到ssh-agent中&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;UseKeychain&lt;/span&gt; &lt;span&gt;yes&lt;/span&gt;         &lt;span&gt;# 保存密码到agent中&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;ServerAliveInterval&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;  &lt;span&gt;# 连接心跳间隔10s&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;ServerAliveCountMax&lt;/span&gt; &lt;span&gt;3&lt;/span&gt;   &lt;span&gt;# 重连次数为3&lt;/span&gt;&lt;br/&gt;&lt;span&gt;# target配置&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Host&lt;/span&gt; target&lt;br/&gt;    &lt;span&gt;HostName&lt;/span&gt; 172&lt;span&gt;.17&lt;/span&gt;&lt;span&gt;.132&lt;/span&gt;&lt;span&gt;.120&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;User&lt;/span&gt; user&lt;br/&gt;    &lt;span&gt;Port&lt;/span&gt; &lt;span&gt;58422&lt;/span&gt;&lt;br/&gt;    IdentityFile ~&lt;span&gt;/.ssh/i&lt;/span&gt;d_rsa&lt;br/&gt;&lt;span&gt;# 跳板机配置&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Host&lt;/span&gt; jumper&lt;br/&gt;    &lt;span&gt;HostName&lt;/span&gt; &lt;span&gt;jumper&lt;/span&gt;&lt;span&gt;.example&lt;/span&gt;&lt;span&gt;.com&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;User&lt;/span&gt; user&lt;br/&gt;    &lt;span&gt;Port&lt;/span&gt; &lt;span&gt;58422&lt;/span&gt;&lt;br/&gt;    IdentityFile ~&lt;span&gt;/.ssh/i&lt;/span&gt;d_rsa&lt;br/&gt;&lt;span&gt;Host&lt;/span&gt; jump_target&lt;br/&gt;    &lt;span&gt;HostName&lt;/span&gt; 172&lt;span&gt;.17&lt;/span&gt;&lt;span&gt;.132&lt;/span&gt;&lt;span&gt;.120&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;User&lt;/span&gt; user&lt;br/&gt;    &lt;span&gt;Port&lt;/span&gt; &lt;span&gt;22&lt;/span&gt;&lt;br/&gt;    IdentityFile ~&lt;span&gt;/.ssh/i&lt;/span&gt;d_rsa&lt;br/&gt;    ProxyCommand ssh user@jumper -W %h:%p &lt;span&gt;2&lt;/span&gt;&amp;amp;&lt;span&gt;gt&lt;/span&gt;;&lt;span&gt;/dev/null&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;LocalForward&lt;/span&gt; &lt;span&gt;5433&lt;/span&gt; localhost:&lt;span&gt;5432&lt;/span&gt;    &lt;span&gt;# 本地5433映射到jump_target的5432&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;TIPS:&lt;/strong&gt;&lt;br/&gt;VS Code 的 Remote 插件会读取本地的配置文件 &lt;code&gt;$HOME/.ssh/config&lt;/code&gt;，以便像本地一样进行远程开发。&lt;/p&gt;&lt;/blockquote&gt;&lt;h3&gt;首次登陆&lt;/h3&gt;&lt;p&gt;一般在 &lt;code&gt;$HOME/.ssh&lt;/code&gt; 目录下除了公私钥文件，config 配置文件，authorized_keys 认证文件外，还有一个 known_hosts 文件。这个文件记录了远程主机 ip 和远程主机对应的公钥指纹。我们在第一次登陆（密码或秘钥登陆）服务器时，会有如下的提示界面：&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;### SSH 首次登陆的提示&lt;/span&gt;&lt;br/&gt;The authenticity &lt;span&gt;of&lt;/span&gt; host &lt;span&gt;&#x27;127.0.0.1 (127.0.0.1)&#x27;&lt;/span&gt; can&lt;span&gt;&#x27;t be established.&lt;/span&gt;&lt;br/&gt;ECDSA key fingerprint &lt;span&gt;is&lt;/span&gt; SHA256:HosOqhcUmbB7QG81yCuDPkvxTgot+vpple+czXPrEug.&lt;br/&gt;&lt;span&gt;ECDSA&lt;/span&gt; &lt;span&gt;key&lt;/span&gt; &lt;span&gt;fingerprint&lt;/span&gt; &lt;span&gt;is&lt;/span&gt; &lt;span&gt;MD5&lt;/span&gt;&lt;span&gt;:fd&lt;/span&gt;&lt;span&gt;:d7&lt;/span&gt;&lt;span&gt;:e1&lt;/span&gt;&lt;span&gt;:2c&lt;/span&gt;&lt;span&gt;:42&lt;/span&gt;&lt;span&gt;:4e&lt;/span&gt;&lt;span&gt;:b4&lt;/span&gt;&lt;span&gt;:2d&lt;/span&gt;&lt;span&gt;:a3&lt;/span&gt;&lt;span&gt;:21&lt;/span&gt;&lt;span&gt;:4d&lt;/span&gt;&lt;span&gt;:d1&lt;/span&gt;&lt;span&gt;:c4&lt;/span&gt;&lt;span&gt;:74&lt;/span&gt;&lt;span&gt;:64&lt;/span&gt;&lt;span&gt;:2d.&lt;/span&gt;&lt;br/&gt;Are you sure you want to &lt;span&gt;continue&lt;/span&gt; connecting (&lt;span&gt;yes&lt;/span&gt;/&lt;span&gt;no&lt;/span&gt;)?&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;此时 known_hosts 并没有 127.0.0.1 这台机器的指纹信息，所以显示这个提示来让我们确认这个指纹是否是目标机器的 ECDSA 算法的指纹。当我们输入 yes 确认后，在下次登录的时候，远程主机发送过来的公钥指纹，直接和 known_hosts 文件中对应 ip 的公钥指纹比较即可。&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# 本机查看服务器 172.17.132.120 的所有公钥（要与服务器上 /etc/ssh 下面的公钥 *.pub 一致）&lt;/span&gt;&lt;br/&gt;&lt;span&gt;ssh-keyscan&lt;/span&gt; &lt;span&gt;-p&lt;/span&gt; 22 172&lt;span&gt;.17&lt;/span&gt;&lt;span&gt;.132&lt;/span&gt;&lt;span&gt;.120&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;# 查看服务器公钥 ecdsa 的指纹 -E md5/sha256 指纹 hash 算法&lt;/span&gt;&lt;br/&gt;ssh-keygen -E md5 -lf /etc/ssh/ssh_host_ecdsa_key.pub&lt;br/&gt;## 256 &lt;span&gt;MD5&lt;/span&gt;&lt;span&gt;:84&lt;/span&gt;&lt;span&gt;:3d&lt;/span&gt;&lt;span&gt;:9c&lt;/span&gt;&lt;span&gt;:6e&lt;/span&gt;&lt;span&gt;:75&lt;/span&gt;&lt;span&gt;:f2&lt;/span&gt;&lt;span&gt;:6b&lt;/span&gt;&lt;span&gt;:b2&lt;/span&gt;&lt;span&gt;:0b&lt;/span&gt;&lt;span&gt;:40&lt;/span&gt;&lt;span&gt;:aa&lt;/span&gt;&lt;span&gt;:d6&lt;/span&gt;&lt;span&gt;:29&lt;/span&gt;&lt;span&gt;:2f&lt;/span&gt;&lt;span&gt;:b4&lt;/span&gt;&lt;span&gt;:40&lt;/span&gt; &lt;span&gt;no&lt;/span&gt; &lt;span&gt;comment&lt;/span&gt; (&lt;span&gt;ECDSA&lt;/span&gt;)&lt;br/&gt;&lt;span&gt;## 256 SHA256:ZoGnph63gnKLC9wQYrHYVU8ROTf6+K9LKAjn+jrXB2o no comment (ECDSA)&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;# 从客户端查看服务器公钥 ecdsa 的指纹（初次登陆时要验证的指纹）&lt;/span&gt;&lt;br/&gt;ssh-keyscan -t ecdsa -p 22 172.17.132.120 |ssh-keygen -lf -&lt;br/&gt;&lt;br/&gt;&lt;span&gt;# 公钥转换成特定指纹 hash 算法的指纹&lt;/span&gt;&lt;br/&gt;&lt;span&gt;awk&lt;/span&gt; &lt;span&gt;&#x27;{print &lt;span&gt;$2&lt;/span&gt;}&#x27;&lt;/span&gt; /etc/ssh/ssh_host_ecdsa_key.pub | base64 -d|openssl sha256 -binary |base64&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;TIPS: known_hosts的重要性&lt;/strong&gt;&lt;br/&gt;known_hosts 这个文件是客户端验证服务端身份的重要依据。每次客户端向服务端发起连接请求时，不仅服务端要验证客户端的合法性，客户端也需要验证服务端的身份。客户端就是通过 known_hosts 中的公钥指纹来验证服务器是否发生了变化。它在一定程度上能避免中间人攻击，除了第一次登陆，因为那时 known_hosts 中还没有服务器的身份信息，所以对于首次提示的登陆指纹信息还是需要和服务器比对的。最安全保险的做法是第一次登陆就使用秘钥登陆。&lt;/p&gt;&lt;/blockquote&gt;&lt;h3&gt;登陆流程&lt;/h3&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;1.&lt;/span&gt;版本号协商阶段&lt;/span&gt;&lt;span&gt;&lt;span&gt;2.&lt;/span&gt;密钥和算法协商阶段&lt;br/&gt;服务端和客户端分别发送算法协商报文给对方，报文中包含自己支持的公钥算法列表、加密算法列表、消息验证码算法列表、压缩算法列表等。服务端和客户端根据对方和自己支持的算法得出最终使用的算法。服务端和客户端利用 DH 交换算法、主机密钥对等参数，生成会话密钥和会话 ID。&lt;/span&gt;&lt;span&gt;&lt;span&gt;3.&lt;/span&gt;认证阶段( publickey &amp;gt; gssapi-keyex &amp;gt; gssapi-with-mic &amp;gt; password )&lt;/span&gt;&lt;span&gt;&lt;span&gt;4.&lt;/span&gt;会话请求阶段&lt;/span&gt;&lt;span&gt;&lt;span&gt;5.&lt;/span&gt;会话交互阶段&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;密码登陆&lt;/h3&gt;&lt;p&gt;密码登陆的认证流程如下：&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;1.&lt;/span&gt;客户端使用密钥和算法协商阶段生成的会话密钥加密账号、认证方法、口令，将结果发送给服务器。&lt;/span&gt;&lt;span&gt;&lt;span&gt;2.&lt;/span&gt;服务端使用获得的会话密钥解密报文，得到账号和口令。&lt;/span&gt;&lt;span&gt;&lt;span&gt;3.&lt;/span&gt;服务端对这个账号和口令进行判断，如果失败，向客户端发送认证失败报文，其中包含了可以再次认证的方法列表。&lt;/span&gt;&lt;span&gt;&lt;span&gt;4.&lt;/span&gt;客户端从认证方法列表中选择一种方法进行再次认证。&lt;/span&gt;&lt;span&gt;&lt;span&gt;5.&lt;/span&gt;这个过程反复进行，直到认证成功或者认证次数达到上限，服务端关闭本次TCP连接。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-ratio=&quot;0.779467680608365&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/bDCibGAYVPCyvWRy5tG2SM6maAtlm1FjppibRgEHsRBrs3OXeIH4vY1mBUibeNp7OlVmbfFeaZf8PFvicrDqVyjNKw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1315&quot; title=&quot;null&quot;/&gt;&lt;/p&gt;&lt;h3&gt;秘钥登陆&lt;/h3&gt;&lt;p&gt;秘钥登陆的认证流程如下：&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;1.&lt;/span&gt;客户端使用密钥和算法协商阶段生成的会话密钥加密账号、认证方法、id_rsa.pub，将结果发送给服务端。&lt;/span&gt;&lt;span&gt;&lt;span&gt;2.&lt;/span&gt;服务端使用会话密钥解密报文，得到账号、id_rsa.pub。服务端在 &lt;code&gt;$HOME/.ssh/authorized_keys&lt;/code&gt; 中找对应的公钥，如果没有找到，发送失败消息给客户端，如果找到，比较客户发送过来的这个公钥和找到的公钥，如果内容相同，服务端生成一个随机的字符串，简称“质询”，然后使用找到的公钥加密这个质询，然后使用会话密钥再次加密。&lt;/span&gt;&lt;span&gt;&lt;span&gt;3.&lt;/span&gt;服务端把这个双重加密的数据发送给客户端&lt;/span&gt;&lt;span&gt;&lt;span&gt;4.&lt;/span&gt;客户端使用会话密钥解密报文，然后使用 id_rsa 再次解密数据，得到质询。&lt;/span&gt;&lt;span&gt;&lt;span&gt;5.&lt;/span&gt;客户端使用会话密钥加密质询，发送给服务端。&lt;/span&gt;&lt;span&gt;&lt;span&gt;6.&lt;/span&gt;服务端使用会话密钥解密报文，得到质询，判断是不是自己生成的那个质询，如果不相同，发送失败消息给客户端，如果相同，认证通过。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-ratio=&quot;0.7725024727992087&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/bDCibGAYVPCyvWRy5tG2SM6maAtlm1FjpppoNTQXdESAj2WewibQ7VN5yb2FQ1WfLTUu1CIEgD1m5nicrLQ4oTPxQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1011&quot; title=&quot;null&quot;/&gt;&lt;/p&gt;&lt;h3&gt;二者区别&lt;/h3&gt;&lt;p&gt;我们常说使用秘钥登陆比密码登陆更方便更安全，为什么这么说呢？方便是因为不用记密码，安全是一方面敏感关键的密码没有在传输，另一方面是因为质询的存在使得在一次对话中同时验证了客户端和服务端。&lt;/p&gt;&lt;h2&gt;高阶用法&lt;/h2&gt;&lt;h3&gt;免密安全传输&lt;/h3&gt;&lt;p&gt;scp/rsync/sftp 都可以基于 SSH 来进行免密安全传输，常见命令如下：&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# 从本地同步 src.tar.gz 文件到远程服务器 jump_target 的目录 /path/to/des/&lt;/span&gt;&lt;br/&gt;scp src.tar.gz jump_target:&lt;span&gt;/path/to/des/&lt;/span&gt;&lt;br/&gt;rsync -avz src.tar.gz jump_target:&lt;span&gt;/path/to/des/&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;# 从远程服务器 jump_target 的文件 /path/to/src.tar.gz 到本地&lt;/span&gt;&lt;br/&gt;&lt;span&gt;scp&lt;/span&gt; jump_target:/path/to/src.tar.gz .&lt;br/&gt;&lt;span&gt;rsync&lt;/span&gt; -avz jump_target:/path/to/src.tar.gz .&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;端口转发&lt;/h3&gt;&lt;p&gt;SSH 不仅仅能够自动加密和解密 SSH 客户端与服务端之间的网络数据，同时，SSH 还能够提供了一个非常有用的功能，那就是端口转发，即将 TCP 端口的网络数据，转发到指定的主机某个端口上，在转发的同时会对数据进行相应的加密及解密。如果工作环境中的防火墙限制了一些网络端口的使用，但是允许 SSH 的连接，那么也是能够通过使用 SSH 转发后的端口进行通信。转发主要分为本地转发与远程转发两种类型。&lt;/p&gt;&lt;h3&gt;转发常用参数&lt;/h3&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-C: 压缩传输，提高传输速度。&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-f: 将 SSH 传输转入后台执行，不占用当前 SHELL, 常与 -N 一起使用&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-N: 建立静默连接（建立了连接但看不到具体会话）&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-g: 在 -L/-R/-D 参数中，允许远程主机连接到建立的转发的端口，如果不加这个参数，只允许本地主机建立连接。&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-L: 本地端口转发&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-R: 远程端口转发&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-D：动态转发（ SOCKS 代理）&lt;/span&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;-P: 指定 SSH 端口&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;本地端口转发&lt;/h3&gt;&lt;p&gt;由本地网络服务器的端口 A，转发到远程服务器端口 B。说白了就是，将发送到本地端口 A 的请求，转发到目标端口 B。格式如下&lt;/p&gt;&lt;p&gt;&lt;code&gt;ssh -L 本地网卡地址:本地端口:目标地址:目标端口 用户@目标地址&lt;/code&gt; 常见的应用场景见下图：&lt;img data-ratio=&quot;1.6966067864271457&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/bDCibGAYVPCyvWRy5tG2SM6maAtlm1FjpPx5YjUWd5uUgsiagYNq0TpN2CnCiakkhOtYvp4uick5F1DKvuxSQcYF5Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;501&quot; title=&quot;null&quot;/&gt;&lt;/p&gt;&lt;p&gt;对应的命令如下：&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# jump_target 服务器上的 3306 端口服务映射到本地 33306 `mysql -u root -p root -H localhost -P 33306`&lt;/span&gt;&lt;br/&gt;&lt;span&gt;## 1 是 2，3，5 路线中的加密通道，将本地 33306 的网络数据转发到 jump_target 的 3306 端口&lt;/span&gt;&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; &lt;span&gt;-C&lt;/span&gt; &lt;span&gt;-N&lt;/span&gt; &lt;span&gt;-g&lt;/span&gt; &lt;span&gt;-L&lt;/span&gt; 33306&lt;span&gt;:localhost&lt;/span&gt;&lt;span&gt;:3306&lt;/span&gt; &lt;span&gt;jump_target&lt;/span&gt;&lt;br/&gt;## 在 2，3 中搞了个加密通道，然后在跳板机上将本地 33306 的网络数据转发到 172&lt;span&gt;.17&lt;/span&gt;&lt;span&gt;.132&lt;/span&gt;&lt;span&gt;.120&lt;/span&gt; 的 3306 端口&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; &lt;span&gt;-C&lt;/span&gt; &lt;span&gt;-N&lt;/span&gt; &lt;span&gt;-g&lt;/span&gt; &lt;span&gt;-L&lt;/span&gt; 33306&lt;span&gt;:172.17.132.120&lt;/span&gt;&lt;span&gt;:3306&lt;/span&gt; &lt;span&gt;jumper&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;远程端口转发&lt;/h3&gt;&lt;p&gt;由远程服务器的某个端口，转发到本地网络的服务器某个端口。说白了，就是将发送到远程端口的请求，转发到目标端口。格式如下：&lt;/p&gt;&lt;p&gt;&lt;code&gt;ssh -R 远程网卡地址:远程端口:目标地址:目标端口 用户@目标地址&lt;/code&gt; 常见的应用场景有个专用术语叫内网穿透，结构如下图:&lt;img data-ratio=&quot;1.2255747126436782&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/bDCibGAYVPCyvWRy5tG2SM6maAtlm1FjpoY0xVAYU4ZArKO2kfEFznOJiaYlwpNcabPCLKwKX3dpaVdXmgib7mDJw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;696&quot; title=&quot;null&quot;/&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# 将公网上的服务器 jump_target 的端口 33333 映射到本地的 22，这样就可以通过在 jump_target 上通过 SSH 来访问本地机器&lt;/span&gt;&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; &lt;span&gt;-f&lt;/span&gt; &lt;span&gt;-N&lt;/span&gt; &lt;span&gt;-g&lt;/span&gt; &lt;span&gt;-R&lt;/span&gt; 33333&lt;span&gt;:127.0.0.1&lt;/span&gt;&lt;span&gt;:22&lt;/span&gt; &lt;span&gt;jump_target&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;TIPS:&lt;/strong&gt;&lt;br/&gt;公网上的服务器 jump_target 要设置 &lt;code&gt;GatewayPorts yes&lt;/code&gt;，默认为 no。此外要映射的端口 33333 要可以访问。&lt;/p&gt;&lt;/blockquote&gt;&lt;h3&gt;动态转发&lt;/h3&gt;&lt;p&gt;动态转发就是建立一个SSH加密的SOCKS 4/5代理通道。任何支持 SOCKS 4/5 协议的程序都可以使用这个加密的通道进行访问。格式如下： &lt;code&gt;ssh -D [本地地址:]本地端口号 远程用户@远程地址&lt;/code&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# 将访问本地 55558 端口的请求都转发给 jump_target ，并让它去执行&lt;/span&gt;&lt;br/&gt;&lt;span&gt;ssh&lt;/span&gt; &lt;span&gt;-C&lt;/span&gt; &lt;span&gt;-N&lt;/span&gt; &lt;span&gt;-g&lt;/span&gt; &lt;span&gt;-T&lt;/span&gt; &lt;span&gt;-D&lt;/span&gt; 127&lt;span&gt;.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;span&gt;.1&lt;/span&gt;&lt;span&gt;:55558&lt;/span&gt; &lt;span&gt;jump_target&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h2&gt;日常使用问题&lt;/h2&gt;&lt;h3&gt;跳板机的配置&lt;/h3&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# 跳板机的配置&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Host&lt;/span&gt; jump&lt;br/&gt;  &lt;span&gt;HostName&lt;/span&gt;  &lt;span&gt;jumper&lt;/span&gt;&lt;span&gt;.example&lt;/span&gt;&lt;span&gt;.com&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Port&lt;/span&gt;      &lt;span&gt;58422&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;User&lt;/span&gt;      haojunyu&lt;br/&gt;  IdentityFile ~&lt;span&gt;/.ssh/&lt;/span&gt;dg_rsa&lt;br/&gt;  &lt;span&gt;AddKeysToAgent&lt;/span&gt; &lt;span&gt;yes&lt;/span&gt;    &lt;span&gt;# 将私钥添加到 agent 中&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;UseKeychain&lt;/span&gt; &lt;span&gt;yes&lt;/span&gt;       &lt;span&gt;# 保存密码到 agent 中&lt;/span&gt;&lt;br/&gt;&lt;span&gt;# 目标机的配置&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Host&lt;/span&gt; ws&lt;br/&gt;  &lt;span&gt;HostName&lt;/span&gt;  172&lt;span&gt;.17&lt;/span&gt;&lt;span&gt;.132&lt;/span&gt;&lt;span&gt;.120&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;Port&lt;/span&gt;      &lt;span&gt;22&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;User&lt;/span&gt;      haojunyu&lt;br/&gt;  IdentityFile ~&lt;span&gt;/.ssh/&lt;/span&gt;dg_rsa&lt;br/&gt;  ProxyCommand ssh haojunyu@jump -W %h:%p &lt;span&gt;2&lt;/span&gt;&amp;amp;&lt;span&gt;gt&lt;/span&gt;;&lt;span&gt;/dev/null&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;ServerAliveInterval&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;ServerAliveCountMax&lt;/span&gt; &lt;span&gt;3&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;h3&gt;内网任意服务访问&lt;/h3&gt;&lt;p&gt;日常工作中经常会启很多服务在内网机器上，然后通过打洞（本地端口转发）来将本地的端口映射到内网机器上服务端口。这样有个问题就是一个服务就得维持一个打洞命令 &lt;code&gt;ssh -C -N -g -L 33306:172.17.132.120:3306 jumper&lt;/code&gt;。对应这样的问题，最好的解决方案是使用动态转发 &lt;code&gt;ssh -C -N -g -T -D 127.0.0.1:55557 hb_jumper&lt;/code&gt;， 本地通过 SwitchyOmega 或 proxifier 工具来将内网 IP 段 172.17.* 的请求转发到本地的 55557 端口。&lt;/p&gt;&lt;h3&gt;git push 报权限不允许（公钥）&lt;/h3&gt;&lt;p&gt;通常在服务器上执行 &lt;code&gt;git push&lt;/code&gt; 时会报如下错误&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;具体报错信息：&lt;br/&gt;Permission denied (publickey). fatal: Could not read from remote repository.&lt;/p&gt;&lt;p&gt;Please make sure you have the correct access rights and the repository exists.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;报错的原因是当前机器上没有服务告诉 git 要使用哪个私钥来进行 git 的操作。对应的解决方法也比较多，推荐解法一和二：&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;解法一：通过 &lt;code&gt;~/.ssh/config&lt;/code&gt; 指定(适用个人机器)&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt; &lt;span&gt;Host&lt;/span&gt; &lt;span&gt;github&lt;/span&gt;&lt;span&gt;.com&lt;/span&gt;&lt;br/&gt;     &lt;span&gt;HostName&lt;/span&gt;  &lt;span&gt;github&lt;/span&gt;&lt;span&gt;.com&lt;/span&gt;&lt;br/&gt;     &lt;span&gt;User&lt;/span&gt;      haojunyu&lt;br/&gt;     IdentityFile ~&lt;span&gt;/.ssh/i&lt;/span&gt;d_rsa&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;解法二：配置仓库或全局的 core.sshCommand（指定仓库适用共享机器，全局适用个人机器.&lt;strong&gt;git版本高于2.3.0&lt;/strong&gt;）&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;git&lt;/span&gt; config core.sshCommand &lt;span&gt;&quot;ssh -i ~/.ssh/id_rsa -F /dev/null&quot;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;解法三：ssh-agent 临时授权（适用共享机器）&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;eval&lt;/span&gt; &lt;span&gt;`ssh-agent`&lt;/span&gt;&lt;br/&gt;ssh-add ~&lt;span&gt;/.ssh/i&lt;/span&gt;d_rsa&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h3&gt;端口转发命令服务化&lt;/h3&gt;&lt;p&gt;这个情况是希望开机时就把端口转发开通，并且一直保持着。这就得介绍 linux 中常用的两种服务化的工具：Supervisor 和 Systemd。前者是需要安装 Supervisor， 但工具比较轻量，使用也比较简单，后者虽然比较重，但是基本所有系统都自带。下面提供两者的配置方法：&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;Supervisor 的配置&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;[program:ssh-wifi_ol]&lt;br/&gt;&lt;span&gt;command&lt;/span&gt;=ssh -C -N -g -L &lt;span&gt;9789&lt;/span&gt;:&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;9789&lt;/span&gt; jump&lt;br/&gt;&lt;span&gt;stdout_logfile&lt;/span&gt;=/Users/haojunyu/.supervisord_log/ssh-wifi_ol.log&lt;br/&gt;&lt;span&gt;autostart&lt;/span&gt;=&lt;span&gt;true&lt;/span&gt;&lt;br/&gt;&lt;span&gt;autorestart&lt;/span&gt;=&lt;span&gt;true&lt;/span&gt;&lt;br/&gt;&lt;span&gt;startsecs&lt;/span&gt;=&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span&gt;priority&lt;/span&gt;=&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;stopasgroup&lt;/span&gt;=&lt;span&gt;true&lt;/span&gt;&lt;br/&gt;&lt;span&gt;killasgroup&lt;/span&gt;=&lt;span&gt;true&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;•&lt;/span&gt;Systemd 的配置&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre data-lang=&quot;bash&quot;&gt;&lt;code&gt;&lt;span&gt;# gfw service&lt;/span&gt;&lt;br/&gt;[Unit]&lt;br/&gt;&lt;span&gt;Description&lt;/span&gt;=gfw&lt;br/&gt;&lt;span&gt;After&lt;/span&gt;=network.target&lt;br/&gt;[Service]&lt;br/&gt;&lt;span&gt;Type&lt;/span&gt;=simple&lt;br/&gt;&lt;span&gt;User&lt;/span&gt;=hjy&lt;br/&gt;&lt;span&gt;ExecStart&lt;/span&gt;=ssh -C -N -g -T -D &lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;55558&lt;/span&gt; gfw&lt;br/&gt;&lt;span&gt;Restart&lt;/span&gt;=&lt;span&gt;on&lt;/span&gt;-failure&lt;br/&gt;[Install]&lt;br/&gt;&lt;span&gt;WantedBy&lt;/span&gt;=multi-user.target&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;TIPS:&lt;/strong&gt;&lt;br/&gt;把一些经常用的服务通过端口转发服务化，而一些临时性的服务通过命令来进行端口转发，也可以使用同事编写的端口转发的 Python 程序来进行。&lt;/p&gt;&lt;/blockquote&gt;&lt;h2&gt;参考文献&lt;/h2&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;1.&lt;/span&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzA5NzgzODI5NA==&amp;amp;mid=2454046571&amp;amp;idx=3&amp;amp;sn=938e3b2ac2edc241c83118ee67fd89b5&amp;amp;scene=21#wechat_redirect&quot; title=&quot;什么是SSH？你应该用过吧&quot; data-linktype=&quot;2&quot;&gt;什么是SSH？你应该用过吧&lt;/a&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;2.&lt;/span&gt;&lt;span&gt;维基百科-SSH&lt;sup&gt;[4]&lt;/sup&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;3.&lt;/span&gt;&lt;span&gt;windows支持openssh&lt;sup&gt;[5]&lt;/sup&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;4.&lt;/span&gt;&lt;span&gt;图解SSH原理&lt;sup&gt;[6]&lt;/sup&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;5.&lt;/span&gt;&lt;span&gt;SSH官方文档&lt;sup&gt;[7]&lt;/sup&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;6.&lt;/span&gt;&lt;span&gt;所有配图&lt;sup&gt;[8]&lt;/sup&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;7.&lt;/span&gt;&lt;span&gt;中间人攻击&lt;sup&gt;[9]&lt;/sup&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;8.&lt;/span&gt;&lt;span&gt;了解ssh代理&lt;sup&gt;[10]&lt;/sup&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;9.&lt;/span&gt;&lt;span&gt;ssh远程登陆中的钥匙指纹是什么以及如何比对&lt;sup&gt;[11]&lt;/sup&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;10.&lt;/span&gt;&lt;span&gt;ssh登陆认证过程详解&lt;sup&gt;[12]&lt;/sup&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;References&lt;/h3&gt;&lt;p&gt;&lt;code&gt;[1]&lt;/code&gt; windows: &lt;em&gt;https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_overview&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[2]&lt;/code&gt; SSH: &lt;em&gt;https://zh.wikipedia.org/wiki/Secure_Shell&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[3]&lt;/code&gt; 管理秘钥: &lt;em&gt;https://www.zsythink.net/archives/2407&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[4]&lt;/code&gt; 维基百科-SSH: &lt;em&gt;https://zh.wikipedia.org/wiki/Secure_Shell&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[5]&lt;/code&gt; windows支持openssh: &lt;em&gt;https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_overview&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[6]&lt;/code&gt; 图解SSH原理: &lt;em&gt;https://www.jianshu.com/p/33461b619d53&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[7]&lt;/code&gt; SSH官方文档: &lt;em&gt;https://www.ietf.org/rfc/rfc4252.txt&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[8]&lt;/code&gt; 所有配图: &lt;em&gt;https://www.processon.com/diagraming/5f4d21f07d9c082a6bac4586&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[9]&lt;/code&gt; 中间人攻击: &lt;em&gt;https://zh.wikipedia.org/wiki/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[10]&lt;/code&gt; 了解ssh代理: &lt;em&gt;https://www.zsythink.net/archives/2407&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[11]&lt;/code&gt; ssh远程登陆中的钥匙指纹是什么以及如何比对: &lt;em&gt;https://blog.xavierskip.com/2019-11-09-ssh-fingerprint/&lt;/em&gt;&lt;br/&gt;&lt;code&gt;[12]&lt;/code&gt; ssh登陆认证过程详解: &lt;em&gt;https://blog.csdn.net/lihang656/article/details/69467162&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>892999b945152020f5caf9bf420f45e6</guid>
<title>Go 工程化（一）：架构整洁之道阅读笔记</title>
<link>https://toutiao.io/k/tvbyx7f</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;markdown-body&quot;&gt;&lt;blockquote&gt;&lt;p&gt;本系列为极客时间 Go 进阶训练营笔记，同步直播更新，预计一周更新 1 ~ 2 篇文章，到 202103 月更新完成&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;其实这一篇文章不应该算在这里面，（PS: 毛老师课程上没讲这本书）但是恰好最近把这本书读完了，并且部门内推荐大家读这本书，毛老师在课上也推荐这本书，也和我们这次的主题有一些关系，一切都是最好的安排，那就放这系列吧。&lt;/p&gt;&lt;p&gt;阅读建议: 全文接近 2W 字，篇幅较长，采用书中重点摘录+不成熟的个人小结组成，桌面端可以点击右侧目录快速定位到你感兴趣的章节&lt;/p&gt;&lt;h2 id=&quot;读书笔记&quot;&gt;&lt;a href=&quot;#读书笔记&quot; class=&quot;headerlink&quot; title=&quot;读书笔记&quot;/&gt;读书笔记&lt;/h2&gt;&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;/&gt;前言&lt;/h3&gt;&lt;h3 id=&quot;第一部分-概述&quot;&gt;&lt;a href=&quot;#第一部分-概述&quot; class=&quot;headerlink&quot; title=&quot;第一部分 概述&quot;/&gt;第一部分 概述&lt;/h3&gt;&lt;h4 id=&quot;第-1-章-设计与架构究竟是什么&quot;&gt;&lt;a href=&quot;#第-1-章-设计与架构究竟是什么&quot; class=&quot;headerlink&quot; title=&quot;第 1 章 设计与架构究竟是什么&quot;/&gt;第 1 章 设计与架构究竟是什么&lt;/h4&gt;&lt;h4 id=&quot;第-2-章-两个价值纬度&quot;&gt;&lt;a href=&quot;#第-2-章-两个价值纬度&quot; class=&quot;headerlink&quot; title=&quot;第 2 章 两个价值纬度&quot;/&gt;第 2 章 两个价值纬度&lt;/h4&gt;&lt;h3 id=&quot;第二部分-从基础构件开始：编程范式&quot;&gt;&lt;a href=&quot;#第二部分-从基础构件开始：编程范式&quot; class=&quot;headerlink&quot; title=&quot;第二部分 从基础构件开始：编程范式&quot;/&gt;第二部分 从基础构件开始：编程范式&lt;/h3&gt;&lt;p&gt;编程范式指的是程序的编写模式，与具体的编程语言关系相对较小。这些范式会告诉你应该在什么时候采用什么样的代码结构&lt;br/&gt;当前的三种编程范式，结构化编程，面向对象，函数式编程&lt;/p&gt;&lt;h4 id=&quot;第-3-章-编程范式总览&quot;&gt;&lt;a href=&quot;#第-3-章-编程范式总览&quot; class=&quot;headerlink&quot; title=&quot;第 3 章 编程范式总览&quot;/&gt;第 3 章 编程范式总览&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;结构化编程（面向过程）&lt;ul&gt;&lt;li&gt;结构化编程对程序控制权的直接转移进行了限制和规范。&lt;/li&gt;&lt;li&gt;限制了 goto 语句的使用&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;面向对象&lt;ul&gt;&lt;li&gt;面向对象编程对程序控制权的间接转移进行了限制和规范。&lt;/li&gt;&lt;li&gt;限制了函数指针的使用&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;函数式编程&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-4-章-结构化编程&quot;&gt;&lt;a href=&quot;#第-4-章-结构化编程&quot; class=&quot;headerlink&quot; title=&quot;第 4 章 结构化编程&quot;/&gt;第 4 章 结构化编程&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;Bohm 和 Jocopini 刚刚证明了人们可以用顺序结构、分支结构、循环结构这三种结构构造出任何程序。&lt;/li&gt;&lt;li&gt;证明了我们构建可推导模块所需要的控制结构集与构建所有程序所需的控制结构集的最小集是等同的。&lt;/li&gt;&lt;li&gt;结构化编程范式可将模块递归降解拆分为可推导的单元，这就意味着模块也可以按功能进行降解拆分。&lt;/li&gt;&lt;li&gt;测试只能展示 Bug 的存在，并不能证明不存在 Bug。&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-5-章-面向对象编程&quot;&gt;&lt;a href=&quot;#第-5-章-面向对象编程&quot; class=&quot;headerlink&quot; title=&quot;第 5 章 面向对象编程&quot;/&gt;第 5 章 面向对象编程&lt;/h4&gt;&lt;h4 id=&quot;第-6-章-函数式编程&quot;&gt;&lt;a href=&quot;#第-6-章-函数式编程&quot; class=&quot;headerlink&quot; title=&quot;第 6 章 函数式编程&quot;/&gt;第 6 章 函数式编程&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;函数式编程语言中的变量（Variable）是不可变（Vary）的。&lt;/li&gt;&lt;li&gt;为什么软件架构师要操心变量的可变性呢？答案显而易见：所有的竞争问题、死锁问题、并发更新问题都是由可变变量导致的。&lt;/li&gt;&lt;li&gt;一个架构设计良好的应用程序应该将状态修改的部分和不需要修改状态的部分隔离成单独的组件，然后用合适的机制来保护可变量。&lt;/li&gt;&lt;li&gt;事件溯源体系下，我们只存储事务记录，不存储具体状态。当需要具体状态时，我们只要从头开始计算所有的事务即可。&lt;/li&gt;&lt;li&gt;这种数据存储模式中不存在删除和更新的情况，我们的应用程序不是 CRUD，而是 CR。因为更新和删除这两种操作都不存在了，自然也就不存在并发问题。&lt;div&gt;&lt;p&gt;在我们刚刚结束的上一个系列，&lt;/p&gt;&lt;a href=&quot;https://lailin.xyz/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/Go%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/&quot;&gt;Go并发编程&lt;/a&gt;&lt;p&gt;中，我们讲到的大量手段来避免数据竞争，这些都是由于在并发时写入导致的，而函数式编程最重要的一个特性就是变量不可变，由于变量无法被修改所以自然而然就不存在数据竞争，也就不需要加锁，这样可以获得很高的性能。&lt;/p&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;第三部分-设计原则&quot;&gt;&lt;a href=&quot;#第三部分-设计原则&quot; class=&quot;headerlink&quot; title=&quot;第三部分 设计原则&quot;/&gt;第三部分 设计原则&lt;/h3&gt;&lt;p&gt;软件构建中层结构的主要目标:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;使软件可容忍被改动。&lt;/li&gt;&lt;li&gt;使软件更容易被理解。&lt;/li&gt;&lt;li&gt;构建可在多个软件系统中复用的组件。&lt;div&gt;&lt;p&gt;在之前的&lt;/p&gt;&lt;a href=&quot;https://lailin.xyz/post/go-design-pattern.html&quot;&gt;《Go设计模式》&lt;/a&gt;&lt;p&gt;系列文章当中也有提到 SOLID 原则，换个角度可以发现这些其实都是殊途同归的一些东西，SOLID 原则的历史已经非常悠久了，但是直到现在它仍然非常具有指导意义。&lt;/p&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-7-章-SRP：单一职责原则&quot;&gt;&lt;a href=&quot;#第-7-章-SRP：单一职责原则&quot; class=&quot;headerlink&quot; title=&quot;第 7 章 SRP：单一职责原则&quot;/&gt;第 7 章 SRP：单一职责原则&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;任何一个软件模块都应该有且仅有一个被修改的原因。&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;任何一个软件模块都应该只对一个用户（User）或系统利益相关者（Stakeholder）负责。&lt;/li&gt;&lt;li&gt;&lt;strong&gt;任何一个软件模块都应该只对某一类行为者负责。&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;&lt;strong&gt;反例: 代码合并冲突&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-8-章-OCP：开闭原则&quot;&gt;&lt;a href=&quot;#第-8-章-OCP：开闭原则&quot; class=&quot;headerlink&quot; title=&quot;第 8 章 OCP：开闭原则&quot;/&gt;第 8 章 OCP：开闭原则&lt;/h4&gt;&lt;h4 id=&quot;第-9-章-LSP：里氏替换原则&quot;&gt;&lt;a href=&quot;#第-9-章-LSP：里氏替换原则&quot; class=&quot;headerlink&quot; title=&quot;第 9 章 LSP：里氏替换原则&quot;/&gt;第 9 章 LSP：里氏替换原则&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;如果对于每个类型是 S 的对象 o1 都存在一个类型为 T 的对象 o2，能使操作 T 类型的程序 P 在用 o2 替换 o1 时行为保持不变，我们就可以将 S 称为 T 的子类型。&lt;/li&gt;&lt;li&gt;比较常见的一个违反 LSP 原则的例子，长方形与正方形&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-10-章-ISP：接口隔离原则&quot;&gt;&lt;a href=&quot;#第-10-章-ISP：接口隔离原则&quot; class=&quot;headerlink&quot; title=&quot;第 10 章 ISP：接口隔离原则&quot;/&gt;第 10 章 ISP：接口隔离原则&lt;/h4&gt;&lt;h4 id=&quot;第-11-章-DIP：依赖反转原则&quot;&gt;&lt;a href=&quot;#第-11-章-DIP：依赖反转原则&quot; class=&quot;headerlink&quot; title=&quot;第 11 章 DIP：依赖反转原则&quot;/&gt;第 11 章 DIP：依赖反转原则&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;如果想要设计一个灵活的系统，在源代码层次的依赖关系中就应该多引用抽象类型，而非具体实现。&lt;/li&gt;&lt;li&gt;在应用 DIP 时，我们也不必考虑稳定的操作系统或者平台设施，因为这些系统接口很少会有变动。&lt;/li&gt;&lt;li&gt;主要应该关注的是软件系统内部那些会经常变动的（volatile）具体实现模块，这些模块是不停开发的，也就会经常出现变更。&lt;/li&gt;&lt;li&gt;编码规范&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;第四部分-组件构建原则&quot;&gt;&lt;a href=&quot;#第四部分-组件构建原则&quot; class=&quot;headerlink&quot; title=&quot;第四部分 组件构建原则&quot;/&gt;第四部分 组件构建原则&lt;/h3&gt;&lt;h4 id=&quot;第-12-章-组件&quot;&gt;&lt;a href=&quot;#第-12-章-组件&quot; class=&quot;headerlink&quot; title=&quot;第 12 章 组件&quot;/&gt;第 12 章 组件&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;组件是软件的部署单元，是整个软件系统在部署过程中可以独立完成部署的最小实体&lt;/li&gt;&lt;li&gt;链接加载器让程序员们可以将程序切分成多个可被分别编译、加载的程序段&lt;/li&gt;&lt;li&gt;组件化的插件式架构已经成为我们习以为常的软件构建形式了。&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-13-章-组件聚合&quot;&gt;&lt;a href=&quot;#第-13-章-组件聚合&quot; class=&quot;headerlink&quot; title=&quot;第 13 章 组件聚合&quot;/&gt;第 13 章 组件聚合&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;构建组件相关的基本原则&lt;ul&gt;&lt;li&gt;REP：复用/发布等同原则&lt;/li&gt;&lt;li&gt;CCP：共同闭包原则&lt;/li&gt;&lt;li&gt;CRP：共同复用原则&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;REP：复用/发布等同原则&lt;ul&gt;&lt;li&gt;软件复用的最小粒度应等同于其发布的最小粒度。&lt;/li&gt;&lt;li&gt;REP 原则就是指组件中的类与模块必须是彼此紧密相关的&lt;/li&gt;&lt;li&gt;一个组件不能由一组毫无关联的类和模块组成，它们之间应该有一个共同的主题或者大方向。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;CCP：共同闭包原则&lt;ul&gt;&lt;li&gt;我们应该将那些会同时修改，并且为相同目的而修改的类放到同一个组件中，而将不会同时修改，并且不会为了相同目的而修改的那些类放到不同的组件中。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;CRP：共同复用原则&lt;ul&gt;&lt;li&gt;不要强迫一个组件的用户依赖他们不需要的东西。&lt;/li&gt;&lt;li&gt;不要依赖不需要用到的东西。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;组件张力图&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://lailin.xyz/images/1611759265457-d9a543c3-8c0c-45e2-9f4f-071352f100a1.png&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;image.png&quot;/&gt;&lt;/p&gt;&lt;p&gt;看到这三个原则会感到有点熟悉，像共同闭包原则就和 SOLID 中的单一职责原则类似，共同复用原则和接口隔离原则看上去也有那么几分相似，这些知识从不同的角度看待总结问题的不同术语。&lt;br/&gt;最后这个组件张力图很有意思，这说明我们在进行架构设计的时候是不可能做到每一项都很完美的，这当中会有一个取舍的过程，书中讲到，一般而言会项目初期会从三角右侧开始，进行一段时间后会滑动到左边，是因为在初期为了效率我们可以牺牲一定的复用性，但是随着依赖关系越来越复杂，那么我们就要考虑复用和扩展了。&lt;/p&gt;&lt;h4 id=&quot;第-14-章-组件耦合&quot;&gt;&lt;a href=&quot;#第-14-章-组件耦合&quot; class=&quot;headerlink&quot; title=&quot;第 14 章 组件耦合&quot;/&gt;第 14 章 组件耦合&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;组件依赖关系图中不应该出现环。&lt;/li&gt;&lt;li&gt;当组件结构依赖图中存在循环依赖时，想要按正确的顺序构建组件几乎是不可能的。&lt;/li&gt;&lt;li&gt;打破循环依赖&lt;ul&gt;&lt;li&gt;应用依赖反转原则（DIP）&lt;/li&gt;&lt;li&gt;创建一个新的组件，并让 Entities 与 Authorize 这两个组件都依赖于它。将现有的这两个组件中互相依赖的类全部放入新组件&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;组件结构图是不可能自上而下被设计出来的。它必须随着软件系统的变化而变化和扩张，而不可能在系统构建的最初就被完美设计出来。&lt;/li&gt;&lt;li&gt;组件依赖结构图并不是用来描述应用程序功能的，它更像是应用程序在构建性与维护性方面的一张地图&lt;/li&gt;&lt;li&gt;组件结构图中的一个重要目标是指导如何隔离频繁的变更&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果我们在设计具体类之前就来设计组件依赖关系，那么几乎是必然要失败的。因为在当下，我们对项目中的共同闭包一无所知，也不可能知道哪些组件可以复用，这样几乎一定会创造出循环依赖的组件。&lt;/p&gt;&lt;p&gt;在 Go 中在编译器上就限制了我们不能出现循环依赖，所以我们大量的使用了 DIP 的方式，但是讲层次拔高一点，从微服务的角度来讲仍然不应该出现循环依赖，如果出现那么在版本发布的时候可能会导致灾难性的后果，架构的原则都是想通的，我们要时刻警惕循环依赖的出现，对于微服务来说可以在 api 网关进行判定是否成环&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;稳定依赖原则&lt;/p&gt;&lt;ul&gt;&lt;li&gt;依赖关系必须要指向更稳定的方向&lt;/li&gt;&lt;li&gt;任何一个我们预期会经常变更的组件都不应该被一个难于修改的组件所依赖，否则这个多变的组件也将会变得非常难以被修改&lt;/li&gt;&lt;li&gt;让软件组件难于修改的一个最直接的办法就是让很多其他组件依赖于它。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;稳定性指标&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;稳定抽象原则&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;第五部分-软件架构&quot;&gt;&lt;a href=&quot;#第五部分-软件架构&quot; class=&quot;headerlink&quot; title=&quot;第五部分 软件架构&quot;/&gt;第五部分 软件架构&lt;/h3&gt;&lt;h4 id=&quot;第-15-章-什么是软件架构&quot;&gt;&lt;a href=&quot;#第-15-章-什么是软件架构&quot; class=&quot;headerlink&quot; title=&quot;第 15 章 什么是软件架构&quot;/&gt;第 15 章 什么是软件架构&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;软件架构师自身需要是程序员，并且必须一直坚持做一线程序员，绝对不要听从那些说应该让软件架构师从代码中解放出来以专心解决高阶问题的伪建议&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果不亲身承受因系统设计而带来的麻烦，就体会不到设计不佳所带来的痛苦，接着就会逐渐迷失正确的设计方向。&lt;/p&gt;&lt;p&gt;这个也是常常会遇到的问题，就现在我能观察到的为例，架构师级别的基本上没有看到过再做一线的程序开发工作，仅仅是平时的各种管理，规划上的事务就已经忙的不可开交，这其实不仅仅导致了架构师本身会脱节，同时也会导致下面的同学很少有机会学习到架构师们过往的经验。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;软件架构这项工作的实质就是规划如何将系统切分成组件，并安排好组件之间的排列关系，以及组件之间互相通信的方式。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;设计软件架构的目的，就是为了在工作中更好地对这些组件进行研发、部署、运行以及维护。&lt;/li&gt;&lt;li&gt;如果想设计一个便于推进各项工作的系统，其策略就是要在设计中尽可能长时间地保留尽可能多的可选项。&lt;/li&gt;&lt;li&gt;设计良好的架构可以让系统便于理解、易于修改、方便维护，并且能轻松部署。&lt;strong&gt;软件架构的终极目标就是最大化程序员的生产力，同时最小化系统的总运营成本。&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;开发&lt;ul&gt;&lt;li&gt;实现一键式的轻松部署应该是我们设计软件架构的一个目标&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;运行&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;维护&lt;/p&gt;&lt;/li&gt;&lt;li&gt;保持可选项&lt;ul&gt;&lt;li&gt;软件有行为价值与架构价值两种价值。这其中的第二种价值又比第一种更重要&lt;/li&gt;&lt;li&gt;软件的灵活性则取决于系统的整体状况、组件的布置以及组件之间的连接方式。&lt;ul&gt;&lt;li&gt;软件的高层策略不应该关心其底层到底使用哪一种数据库&lt;/li&gt;&lt;li&gt;开发的早期阶段也不应该选定使用的 Web 服务&lt;/li&gt;&lt;li&gt;软件的高层策略压根不应该跟这些有关。&lt;/li&gt;&lt;li&gt;在开发的早期阶段不应过早地采用依赖注入框架&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;如果在开发高层策略时有意地让自己摆脱具体细节的纠缠，我们就可以将与具体实现相关的细节决策推迟或延后，因为越到项目的后期，我们就拥有越多的信息来做出合理的决策。&lt;/li&gt;&lt;li&gt;一个优秀的软件架构师应该致力于最大化可选项数量&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;strong&gt;优秀的架构师会小心地将软件的高层策略与其底层实现隔离开，让高层策略与实现细节脱钩，使其策略部分完全不需要关心底层细节，当然也不会对这些细节有任何形式的依赖。&lt;/strong&gt;另外，&lt;strong&gt;优秀的架构师所设计的策略应该允许系统尽可能地推迟与实现细节相关的决策，越晚做决策越好&lt;/strong&gt;&lt;p&gt;这一点其实很容易被忽略掉，因为我们经常做的工作就是细节性的工作，在进行设计的时候很容易就不自觉的假定 Web UI，MySQL 数据库这些技术选型，在这本书的最后一个章节还会讲到，这些细节。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-16-章-独立性&quot;&gt;&lt;a href=&quot;#第-16-章-独立性&quot; class=&quot;headerlink&quot; title=&quot;第 16 章 独立性&quot;/&gt;第 16 章 独立性&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;用例&lt;/li&gt;&lt;li&gt;任何一个组织在设计系统时，往往都会复制出一个与该组织内沟通结构相同的系统。&lt;/li&gt;&lt;li&gt;一个设计良好的架构通常不会依赖于成堆的脚本与配置文件，也不需要用户手动创建一堆“有严格要求”的目录与文件&lt;/li&gt;&lt;li&gt;如果我们按照变更原因的不同对系统进行解耦，就可以持续地向系统内添加新的用例，而不会影响旧有的用例。如果我们同时对支持这些用例的 UI 和数据库也进行了分组，那么每个用例使用的就是不同面向的 UI 与数据库，因此增加新用例就更不太可能会影响旧有的用例了。&lt;/li&gt;&lt;li&gt;如果有两段看起来重复的代码，它们走的是不同的演进路径，也就是说它们有着不同的变更速率和变更缘由，那么这两段代码就不是真正的重复&lt;/li&gt;&lt;li&gt;解耦模式&lt;ul&gt;&lt;li&gt;源码层次：我们可以控制源代码模块之间的依赖关系，以此来实现一个模块的变更不会导致其他模块也需要变更或重新编译&lt;/li&gt;&lt;li&gt;部署层次：我们可以控制部署单元（譬如 jar 文件、DLL、共享库等）之间的依赖关系，以此来实现一个模块的变更不会导致其他模块的重新构建和部署。&lt;/li&gt;&lt;li&gt;服务层次：我们可以将组件间的依赖关系降低到数据结构级别，然后仅通过网络数据包来进行通信。&lt;/li&gt;&lt;li&gt;一个设计良好的架构应该能允许一个系统从单体结构开始，以单一文件的形式部署，然后逐渐成长为一组相互独立的可部署单元，甚至是独立的服务或者微服务。最后还能随着情况的变化，允许系统逐渐回退到单体结构&lt;div&gt;&lt;p&gt;“如果两段看似重复的代码，如果有不同的变更速率和原因，那么这两段代码就不算是真正的重复”这有个非常典型的例子就是 API 接口的参数和最后我们模型数据虽然很多时候大部分字段是相同的，但是它们的变更速率和原因其实都是不一样的，如果把他们耦合在一起虽然前期可能可以减少一些代码的编写，但是到最后需要扩展时会发现变更会很困难。之前我还写了一篇文章 《&lt;/p&gt;&lt;a href=&quot;https://lailin.xyz/post/11996.html#2-%E7%94%A8-model-%E5%B1%82%E7%9A%84-struct-%E7%BB%91%E5%AE%9A%E5%8F%82%E6%95%B0&quot;&gt;Go Web 小技巧（三）Gin 参数绑定 &lt;/a&gt;&lt;p&gt;》总结这种埋坑的技巧 😂&lt;/p&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-17-章-划分边界&quot;&gt;&lt;a href=&quot;#第-17-章-划分边界&quot; class=&quot;headerlink&quot; title=&quot;第 17 章 划分边界&quot;/&gt;第 17 章 划分边界&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;软件架构设计本身就是一门划分边界的艺术。&lt;/li&gt;&lt;li&gt;通过划清边界，我们可以推迟和延后一些细节性的决策，这最终会为我们节省大量的时间、避免大量的问题。&lt;/li&gt;&lt;li&gt;I/O 是无关紧要的&lt;/li&gt;&lt;li&gt;GUI 和 BusinessRules 这两个组件之间也应该有一条边界线&lt;/li&gt;&lt;li&gt;插件式架构的好处&lt;ul&gt;&lt;li&gt;&lt;img src=&quot;https://lailin.xyz/images/1611763160147-6a16b0e6-d3de-43d2-8bf3-b1bf597dd0ed.png&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;image.png&quot;/&gt;&lt;/li&gt;&lt;li&gt;将系统设计为插件式架构，就等于构建起了一面变更无法逾越的防火墙。换句话说，只要 GUI 是以插件形式插入系统的业务逻辑中的，那么 GUI 这边所发生的变更就不会影响系统的业务逻辑。&lt;/li&gt;&lt;li&gt;边界线也应该沿着系统的变更轴来画。也就是说，位于边界线两侧的组件应该以不同原因、不同速率变化着。&lt;p&gt;真正核心的是我们业务逻辑，而输入输出是细节&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-18-章-边界剖析&quot;&gt;&lt;a href=&quot;#第-18-章-边界剖析&quot; class=&quot;headerlink&quot; title=&quot;第 18 章 边界剖析&quot;/&gt;第 18 章 边界剖析&lt;/h4&gt;&lt;h4 id=&quot;第-19-章-策略与层次&quot;&gt;&lt;a href=&quot;#第-19-章-策略与层次&quot; class=&quot;headerlink&quot; title=&quot;第 19 章 策略与层次&quot;/&gt;第 19 章 策略与层次&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;策略&lt;ul&gt;&lt;li&gt;本质上，所有的软件系统都是一组策略语句的集合&lt;/li&gt;&lt;li&gt;变更原因、时间和层次相同的策略应该被分到同一个组件中。反之，变更原因、时间和层次不同的策略则应该分属于不同的组件&lt;/li&gt;&lt;li&gt;依赖关系的方向通常取决于它们所关联的组件层次。一般来说，低层组件被设计为依赖于高层组件&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;层次&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-20-章-业务逻辑&quot;&gt;&lt;a href=&quot;#第-20-章-业务逻辑&quot; class=&quot;headerlink&quot; title=&quot;第 20 章 业务逻辑&quot;/&gt;第 20 章 业务逻辑&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;业务逻辑就是程序中那些真正用于赚钱或省钱的业务逻辑与过程&lt;/li&gt;&lt;li&gt;“关键业务逻辑”是一项业务的关键部分，不管有没有自动化系统来执行这项业务，这一点是不会改变的。&lt;/li&gt;&lt;li&gt;业务实体&lt;ul&gt;&lt;li&gt;业务实体这个概念中应该只有业务逻辑，没有别的。&lt;/li&gt;&lt;li&gt;业务实体这个概念只要求我们将关键业务数据和关键业务逻辑绑定在一个独立的软件模块内。&lt;/li&gt;&lt;li&gt;业务实体不一定是类&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;用例（usecase）&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;选择直接在数据结构中使用对业务实体对象的引用。毕竟，业务实体与请求/响应模型之间有很多相同的数据。但请一定不要这样做！这两个对象存在的意义是非常、非常不一样的。随着时间的推移，这两个对象会以不同的原因、不同的速率发生变更。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;这些业务逻辑应该保持纯净，不要掺杂用户界面或者所使用的数据库相关的东西。在理想情况下，这部分代表业务逻辑的代码应该是整个系统的核心，其他低层概念的实现应该以插件形式接入系统中。业务逻辑应该是系统中最独立、复用性最高的代码。&lt;p&gt;再次强调了不要偷懒，今天刚好看到之前写的一个反面例子的代码，代码里面有一个 GetA 函数，从数据库当中获取A对象数据和一些统计数据，这个函数中的统计数据部分其实只有在一个 Web 页面的接口中使用到，但是为了偷懒，在其他地方查询的时候也调用了这个函数，导致最后很多地方的接口性能都由于这个没用的统计数据多耗费了将近 1s 的时间。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-21-章-尖叫的软件架构&quot;&gt;&lt;a href=&quot;#第-21-章-尖叫的软件架构&quot; class=&quot;headerlink&quot; title=&quot;第 21 章 尖叫的软件架构&quot;/&gt;第 21 章 尖叫的软件架构&lt;/h4&gt;&lt;h4 id=&quot;第-22-章-整洁架构&quot;&gt;&lt;a href=&quot;#第-22-章-整洁架构&quot; class=&quot;headerlink&quot; title=&quot;第 22 章 整洁架构&quot;/&gt;第 22 章 整洁架构&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;按照不同关注点对软件进行切割。也就是说，这些架构都会将软件切割成不同的层，至少有一层是只包含该软件的业务逻辑的，而用户接口、系统接口则属于其他层。&lt;/li&gt;&lt;li&gt;特点&lt;ul&gt;&lt;li&gt;独立于框架：这些系统的架构并不依赖某个功能丰富的框架之中的某个函数。&lt;/li&gt;&lt;li&gt;可被测试：这些系统的业务逻辑可以脱离 UI、数据库、Web 服务以及其他的外部元素来进行测试。&lt;/li&gt;&lt;li&gt;独立于 UI：这些系统的 UI 变更起来很容易，不需要修改其他的系统部分。&lt;/li&gt;&lt;li&gt;独立于数据库：我们可以轻易将这些系统使用的&lt;/li&gt;&lt;li&gt;独立于任何外部机构：这些系统的业务逻辑并不需要知道任何其他外部接口的存在。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://lailin.xyz/images/1611803924995-df9764d2-32c6-407b-b1e3-224c0feef3b1.png&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;image.png&quot;/&gt;&lt;/p&gt;&lt;h4 id=&quot;第-23-章-展示器和谦卑对象&quot;&gt;&lt;a href=&quot;#第-23-章-展示器和谦卑对象&quot; class=&quot;headerlink&quot; title=&quot;第 23 章 展示器和谦卑对象&quot;/&gt;第 23 章 展示器和谦卑对象&lt;/h4&gt;&lt;h4 id=&quot;第-24-章-不完全边界&quot;&gt;&lt;a href=&quot;#第-24-章-不完全边界&quot; class=&quot;headerlink&quot; title=&quot;第 24 章 不完全边界&quot;/&gt;第 24 章 不完全边界&lt;/h4&gt;&lt;h4 id=&quot;第-25-章-层次与边界&quot;&gt;&lt;a href=&quot;#第-25-章-层次与边界&quot; class=&quot;headerlink&quot; title=&quot;第 25 章 层次与边界&quot;/&gt;第 25 章 层次与边界&lt;/h4&gt;&lt;h4 id=&quot;第-26-章-Main-组件&quot;&gt;&lt;a href=&quot;#第-26-章-Main-组件&quot; class=&quot;headerlink&quot; title=&quot;第 26 章 Main 组件&quot;/&gt;第 26 章 Main 组件&lt;/h4&gt;&lt;h4 id=&quot;第-27-章-服务：宏观与微观&quot;&gt;&lt;a href=&quot;#第-27-章-服务：宏观与微观&quot; class=&quot;headerlink&quot; title=&quot;第 27 章 服务：宏观与微观&quot;/&gt;第 27 章 服务：宏观与微观&lt;/h4&gt;&lt;h4 id=&quot;第-28-章-测试边界&quot;&gt;&lt;a href=&quot;#第-28-章-测试边界&quot; class=&quot;headerlink&quot; title=&quot;第 28 章 测试边界&quot;/&gt;第 28 章 测试边界&lt;/h4&gt;&lt;h4 id=&quot;第-29-章-整洁的嵌入式架构&quot;&gt;&lt;a href=&quot;#第-29-章-整洁的嵌入式架构&quot; class=&quot;headerlink&quot; title=&quot;第 29 章 整洁的嵌入式架构&quot;/&gt;第 29 章 整洁的嵌入式架构&lt;/h4&gt;&lt;h3 id=&quot;第六部门-实现细节&quot;&gt;&lt;a href=&quot;#第六部门-实现细节&quot; class=&quot;headerlink&quot; title=&quot;第六部门 实现细节&quot;/&gt;第六部门 实现细节&lt;/h3&gt;&lt;h4 id=&quot;第-30-章-数据库只是实现细节&quot;&gt;&lt;a href=&quot;#第-30-章-数据库只是实现细节&quot; class=&quot;headerlink&quot; title=&quot;第 30 章 数据库只是实现细节&quot;/&gt;第 30 章 数据库只是实现细节&lt;/h4&gt;&lt;h4 id=&quot;第-31-章-Web-是实现细节&quot;&gt;&lt;a href=&quot;#第-31-章-Web-是实现细节&quot; class=&quot;headerlink&quot; title=&quot;第 31 章 Web 是实现细节&quot;/&gt;第 31 章 Web 是实现细节&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;GUI 只是一个实现细节。而 Web 则是 GUI 的一种，所以也是一个实现细节。作为一名软件架构师，我们需要将这类细节与核心业务逻辑隔离开来。&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-32-章-应用程序框架是实现细节&quot;&gt;&lt;a href=&quot;#第-32-章-应用程序框架是实现细节&quot; class=&quot;headerlink&quot; title=&quot;第 32 章 应用程序框架是实现细节&quot;/&gt;第 32 章 应用程序框架是实现细节&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;我们可以使用框架——但要时刻警惕，别被它拖住&lt;/li&gt;&lt;li&gt;毕竟 Main 组件作为系统架构中最低层、依赖最多的组件，它依赖于 Spring 并不是问题。&lt;p&gt;框架的选择要慎重，我们业务逻辑本身不能依赖框架&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-33-章-案例分析：视频销售网站&quot;&gt;&lt;a href=&quot;#第-33-章-案例分析：视频销售网站&quot; class=&quot;headerlink&quot; title=&quot;第 33 章 案例分析：视频销售网站&quot;/&gt;第 33 章 案例分析：视频销售网站&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;系统架构设计中的第一步，是识别系统中的各种角色和用例&lt;p&gt;这一步看起来简单，但是非常考验一个人的功力&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;第-34-章-拾遗&quot;&gt;&lt;a href=&quot;#第-34-章-拾遗&quot; class=&quot;headerlink&quot; title=&quot;第 34 章 拾遗&quot;/&gt;第 34 章 拾遗&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;分层架构无法展现具体的业务领域信息。把两个不同业务领域的、但是都采用了分层架构的代码进行对比，你会发现它们的相似程度极高&lt;/li&gt;&lt;li&gt;宽松的分层架构，允许某些层跳过直接相邻的邻居。&lt;/li&gt;&lt;li&gt;一个架构设计原则——内容是“Web 控制器永远不应该直接访问数据层”。&lt;/li&gt;&lt;li&gt;系统由一个或者多个容器组成（例如 Web 应用、移动 App、独立应用、数据库、文件系统），每个容器包含一个或多个组件，每个组件由一个或多个类组成。&lt;/li&gt;&lt;li&gt;如果不考虑具体实现细节，再好的设计也无法长久。必须要将设计映射到对应的代码结构上，考虑如何组织代码树，以及在编译期和运行期采用哪种解耦合的模式。&lt;/li&gt;&lt;li&gt;最好能利用编译器来维护所选的系统架构设计风格，小心防范来自其他地方的耦合模式，例如数据结构&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://lailin.xyz/images/1611842328934-ca4190d2-94c9-415a-befe-bcaebcd1aa4f.png&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;image.png&quot;/&gt;&lt;/p&gt;&lt;p&gt;这一章对比了四种架构风格，同时提出了，架构设计是需要考虑实现细节的，设计需要映射到代码结构和代码树上，这个其实和最开始的“软件架构师自身需要是程序员，并且必须一直坚持做一线程序员”交相呼应。&lt;br/&gt;如果可以在编译时解决的问题，就不要放到运行时，编译的问题往往要比运行时的问题好解决，这也是为什么 Go 的依赖注入框架我更加推荐 wire 的原因，同理作者提出了 如果要防止直接中 web控制器调用数据层，那么我们就不应该将数据层（repo）暴露出来，只需要暴露 usecase 就好了。&lt;/p&gt;&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;/&gt;总结&lt;/h2&gt;&lt;p&gt;之前其实也大概了解过整洁架构，从最开始觉得它又臭又长，到现在工作两三年后觉得“不听老人言，吃亏在眼前”，当我们在对一个架构或者是事务进行批判的时候一定要了解它面对的场景以及它的理念，这是最重要的。当然软件领域是没有银弹的，我们需要做的是吸收每一种思想，在不同的场景下做不同的取舍，接下来会有几篇文章结合毛老师课上讲的 Go 工程化相关的内容，以及我在工作当中进行的一些总结最后提出一种当下我觉得的 Go 项目的组织方式，这种方式不是最好的，但是我觉得是现阶段最适合的。&lt;br/&gt;推荐大家在仔细的阅读一下本书，期望你能有更多的收获。&lt;/p&gt;&lt;h2 id=&quot;参考文献&quot;&gt;&lt;a href=&quot;#参考文献&quot; class=&quot;headerlink&quot; title=&quot;参考文献&quot;/&gt;参考文献&lt;/h2&gt;&lt;ol&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://weread.qq.com/web/reader/480322f072021a3248038c8kc81322c012c81e728d9d180&quot;&gt;架构整洁之道-罗伯特·C·马丁-微信读书&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h2 id=&quot;关注我获取更新&quot;&gt;&lt;a href=&quot;#关注我获取更新&quot; class=&quot;headerlink&quot; title=&quot;关注我获取更新&quot;/&gt;关注我获取更新&lt;/h2&gt;&lt;p&gt;看到这里了还不关注点赞走一波&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz&quot;&gt;博客&lt;/a&gt; 可以订阅 RSS，也可以点击首页通过 webpush 订阅浏览器消息&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/mohuishou&quot;&gt;Github&lt;/a&gt; Follow me&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://www.zhihu.com/people/mo-hui-shou-76&quot;&gt;知乎&lt;/a&gt; 关注账号，顺便点个 👍&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://toutiao.io/subjects/387401?f=new&quot;&gt;开发者头条&lt;/a&gt; 订阅订阅号，顺便点个 👍&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>d7b9d7bea2c9796c0913bba54591c918</guid>
<title>结合论文看 Youtube 推荐系统中召回和排序的演进之路（中）：深度召回排序</title>
<link>https://toutiao.io/k/bojhsa2</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上一篇主要介绍的是Youtube发表的三篇论文，但主要集中在机器学习方向，接下来会用几篇论文说明一下Youtube在深度学习推荐系统方向做的工作。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在介绍Youtube的DNN之前，先介绍一篇Google的非常经典的深度学习推荐算法Wide &amp;amp; Deep，虽然Youtube 也属于Google，这里之所以先介绍Wide &amp;amp; Deep，因为我个人觉得这应该是深度学习应用在推荐系统排序上的「&lt;strong&gt;基石&lt;/strong&gt;」之作，而且其提出的框架也是非常的经典。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2016年-Google Wide &amp;amp; Deep&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Wide &amp;amp; Deep的论文全称为：《Wide &amp;amp; Deep Learning for Recommender Systems》，其首次发表应该是在2015年末，然后2016年的时候中了ACM的Deep Learning for Recommender Systems Workshop。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;背景&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该论文提出了一种深度学习排序模型的框架，主要是联合线性模型和深度学习模型一起训练的新的框架下的模型。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Wide 部分是一个广义线性模型，因为具有非线性特征变换功能，而广泛应用在分类和回归上。通过特征之间的组合来对用户的兴趣进行排序是十分有效和可解释的，然后依赖大量的特征工程。相对于线性模型而言，DNN不强依赖人工特征，但可能由于高维稀疏的特征而产生过拟合。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;推荐系统的一个挑战是同时满足对历史行为的总结和扩展，即Memorizaton 和 Generalization，其具体含义如下：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Memorization：近似的被定义为学习物品或特征的共性，探索用户历史行为数据中的相关性。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Generalization：基于相关性的传递，探索在历史行为中很少或者没有出现过的新特征组合情况。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这篇论文的主要贡献分为以下三点：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Wide &amp;amp; Deep联合训练具有嵌入的前馈神经网络和具有特征变换的线性模型，用于具有稀疏输入的通用推荐系统&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;WD在google应用商店上进行了线上测试和评估&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;在TensorFlow API中贡献了源码，方便调用&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;算法&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Wide &amp;amp; Deep算法的原理可以使用下面的一张图表示：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;143&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.2569444444444444&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRmuaFOMPzBXFVc9RJpF5NrwD2zFdgXlyibPiaiclwcjyibXJvpXmd2CjWqw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1008&quot;/&gt;&lt;figcaption&gt;在这里插入图片描述&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）Wide部分&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;wide部分对应上图中的左侧部分，通常是一个广义线性模型：&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;y=w*x + b&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 5707.4 899&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(767.8, 0)&quot;&gt;&lt;path data-c=&quot;3D&quot; d=&quot;M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1823.6, 0)&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(2761.8, 0)&quot;&gt;&lt;path data-c=&quot;2217&quot; d=&quot;M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(3484, 0)&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(4278.2, 0)&quot;&gt;&lt;path data-c=&quot;2B&quot; d=&quot;M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(5278.4, 0)&quot;&gt;&lt;path data-c=&quot;62&quot; d=&quot;M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;y&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 490 647&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：是要预测的结果&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;x&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 572 453&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：是一组特征向量&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;w&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -443 716 454&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：模型的参数&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;b&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 429 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;62&quot; d=&quot;M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：偏置量&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;特征集合包含的是原始输入和他们对应的特征转换，其中一个比较重要的转换是：cross-product transformation，其对应的公式如下：&lt;/p&gt;&lt;span data-tool=&quot;mdnice编辑器&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;\phi k(x)=\prod_{i=1}^{d} x_i^{c_{ki}}&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -1740.7 6641.8 2986.6&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;3D5&quot; d=&quot;M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(596, 0)&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1117, 0)&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1506, 0)&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(2078, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(2744.8, 0)&quot;&gt;&lt;path data-c=&quot;3D&quot; d=&quot;M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;munderover&quot; transform=&quot;translate(3800.6, 0)&quot;&gt;&lt;g data-mml-node=&quot;mo&quot;&gt;&lt;path data-c=&quot;220F&quot; d=&quot;M220 812Q220 813 218 819T214 829T208 840T199 853T185 866T166 878T140 887T107 893T66 896H56V950H1221V896H1211Q1080 896 1058 812V-311Q1076 -396 1211 -396H1221V-450H725V-396H735Q864 -396 888 -314Q889 -312 889 -311V896H388V292L389 -311Q405 -396 542 -396H552V-450H56V-396H66Q195 -396 219 -314Q220 -312 220 -311V812Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(65.2, -1087.9) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(345, 0)&quot;&gt;&lt;path data-c=&quot;3D&quot; d=&quot;M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(1123, 0)&quot;&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(455.2, 1150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;64&quot; d=&quot;M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;msubsup&quot; transform=&quot;translate(5245.2, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(572, 465.2) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;63&quot; d=&quot;M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(433, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(521, 0)&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(572, -293.8) scale(0.707)&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;c_{ki}&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 1095.4 599.8&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;63&quot; d=&quot;M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(433, -150) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(521, 0)&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 属于&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;{0,1}&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -666 1444.7 860&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mn&quot;&gt;&lt;path data-c=&quot;30&quot; d=&quot;M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(500, 0)&quot;&gt;&lt;path data-c=&quot;2C&quot; d=&quot;M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(944.7, 0)&quot;&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上边的公式实现的其实就是one-hot编码，比如当gender=female，language=en时为1，其他为0。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）Deep部分&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;deep部分对应上图中的右侧部分，是一个前馈神经网络。对于分类特征，原始输入是字符串（比如language=en）。这些稀疏、高维的分类特征第一步是转化为低维、密集的向量。这些向量通常在10-100维之间，一般采用随机的方法进行初始化，在训练过过程中通过最小化损失函数来优化模型。这些低维的向量传到神经网络的隐层中去。每个隐层的计算方式如下：&lt;/p&gt;&lt;span data-tool=&quot;mdnice编辑器&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;a^{(l+1)} = f(W^la^l + b^l)&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -943.3 8986.5 1193.3&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;61&quot; d=&quot;M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(529, 413) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mo&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(389, 0)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(687, 0)&quot;&gt;&lt;path data-c=&quot;2B&quot; d=&quot;M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(1465, 0)&quot;&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1965, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(2521.3, 0)&quot;&gt;&lt;path data-c=&quot;3D&quot; d=&quot;M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(3577.1, 0)&quot;&gt;&lt;path data-c=&quot;66&quot; d=&quot;M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(4127.1, 0)&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;msup&quot; transform=&quot;translate(4516.1, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;57&quot; d=&quot;M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1118.8, 413) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;msup&quot; transform=&quot;translate(5895.6, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;61&quot; d=&quot;M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(529, 413) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(6907.5, 0)&quot;&gt;&lt;path data-c=&quot;2B&quot; d=&quot;M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;msup&quot; transform=&quot;translate(7907.8, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;62&quot; d=&quot;M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(429, 413) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(8597.5, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;l&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 298 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：神经网络的层数&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;f&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -705 550 910&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;66&quot; d=&quot;M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：激活函数（通常是relus）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;a^l&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -853.7 789.7 863.7&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;61&quot; d=&quot;M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(529, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：第l层的输出值&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;b^l&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -853.7 689.7 864.7&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;62&quot; d=&quot;M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(429, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：第l层的偏置&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;W^l&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -853.7 1379.5 875.7&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;57&quot; d=&quot;M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1118.8, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：第l层的权重&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;c）联合训练&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;wide部分和deep部分使用输出结果的对数几率加权和作为预测值，然后将其输入到一个逻辑回归函数用来联合训练。论文中强调了联合训练（Join training）和整体训练（ensemble）的区别。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Ensemble：两个模型分别独立训练，只在最终预测的时候才将两个模型结合计算；单个模型需要更大（比如进行特征转换）来保证结合后的准确率&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Join trainging：在训练时，同时考虑wide部分和deep部分以及两个模型拼接起来的权重来同时优化所有的参数；wide部分可以通过少量的特征交叉来弥补deep部分的弱势&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;wide &amp;amp; deep的join training采用的是下批量梯度下降算法（min-batch stochastic optimization）进行优化的。在实验中，wide部分采用的是FTRL+L1，deep部分采用的是Adag。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;对于LR，模型的预测结果如下：&lt;/p&gt;&lt;span data-tool=&quot;mdnice编辑器&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;P(Y=1|x)=\sigma (w^T_{wide}[x,\phi x] + W^T_{deep}a^{(l_f)}+b)&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/O1dAhMERUwVszWEXH1neplZJQtzvoJoPV2JKQjUxFlUzc5xDwffmM1ibYVVGTuYgvbNyE8z1XnC3IyDYIJfuCyzyHaS6SS9icx/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;Y&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -683 763 683&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;59&quot; d=&quot;M66 637Q54 637 49 637T39 638T32 641T30 647T33 664T42 682Q44 683 56 683Q104 680 165 680Q288 680 306 683H316Q322 677 322 674T320 656Q316 643 310 637H298Q242 637 242 624Q242 619 292 477T343 333L346 336Q350 340 358 349T379 373T411 410T454 461Q546 568 561 587T577 618Q577 634 545 637Q528 637 528 647Q528 649 530 661Q533 676 535 679T549 683Q551 683 578 682T657 680Q684 680 713 681T746 682Q763 682 763 673Q763 669 760 657T755 643Q753 637 734 637Q662 632 617 587Q608 578 477 424L348 273L322 169Q295 62 295 57Q295 46 363 46Q379 46 384 45T390 35Q390 33 388 23Q384 6 382 4T366 1Q361 1 324 1T232 2Q170 2 138 2T102 1Q84 1 84 9Q84 14 87 24Q88 27 89 30T90 35T91 39T93 42T96 44T101 45T107 45T116 46T129 46Q168 47 180 50T198 63Q201 68 227 171L252 274L129 623Q128 624 127 625T125 627T122 629T118 631T113 633T105 634T96 635T83 636T66 637Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：label&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;\sigma (.)&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -750 1793.7 1000&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;3C3&quot; d=&quot;M184 -11Q116 -11 74 34T31 147Q31 247 104 333T274 430Q275 431 414 431H552Q553 430 555 429T559 427T562 425T565 422T567 420T569 416T570 412T571 407T572 401Q572 357 507 357Q500 357 490 357T476 358H416L421 348Q439 310 439 263Q439 153 359 71T184 -11ZM361 278Q361 358 276 358Q152 358 115 184Q114 180 114 178Q106 141 106 117Q106 67 131 47T188 26Q242 26 287 73Q316 103 334 153T356 233T361 278Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(571, 0)&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(960, 0)&quot;&gt;&lt;path data-c=&quot;2E&quot; d=&quot;M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1404.7, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：表示sigmoid函数&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;\phi (x)&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -750 1946 1000&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;3D5&quot; d=&quot;M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(596, 0)&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(985, 0)&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1557, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：原始特征x的交叉转换&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;b&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 429 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;62&quot; d=&quot;M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：偏置&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;w_wide&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 2603.3 851.8&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(716, -150) scale(0.707)&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1272.3, 0)&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1617.3, 0)&quot;&gt;&lt;path data-c=&quot;64&quot; d=&quot;M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2137.3, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：wide模型的权重&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;w_deep&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -443 2568.7 637&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(716, -150) scale(0.707)&quot;&gt;&lt;path data-c=&quot;64&quot; d=&quot;M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1133.7, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1599.7, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2065.7, 0)&quot;&gt;&lt;path data-c=&quot;70&quot; d=&quot;M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;：&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;a^{(l_f)}&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -893.3 1650.2 903.3&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;61&quot; d=&quot;M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(529, 363) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mo&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;msub&quot; transform=&quot;translate(389, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(298, -150) scale(0.707)&quot;&gt;&lt;path data-c=&quot;66&quot; d=&quot;M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1125.9, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;的权重&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;系统实现&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Google的团队主要是再APP商店上进行了算法的实验，并取得了不粗的效果，APP商店的架构图如下：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;302&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.5409153952843273&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkR46KwOeLeFiaus70quG8Aic8WTgxLGpJfB5uQZLpo8wDb9ibgdovCSib0pA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;721&quot;/&gt;&lt;figcaption&gt;在这里插入图片描述&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上图主要包含了两部分，一部分是检索系统，一部分是排序系统。当用户进入app store时，被视作是一次query查询，伴随着的是用户维度和上下文维度的特征，检索系统会根据这些信息通过模型或者人工制定的规则匹配到一些用可能点击或者购买的APP。同时，这一次的请求行为会记录在日志中作为训练数据使用。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;数据库中包含了百万级别的app，每次查询推荐系统不可能对所有的app进行排序，因此第一步是挑选候选集，然后在使用排序系统对候选集中的每个APP进行打分，计算出来的分数为P(y|x)，即通过特征x计算出来的用户行为y的可能性。这些特征包括：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;用户维度的特征（城市，年龄，人口统计学特征等）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;上下文特征（设备，几点请求，周几请求）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;APP维度特征（app上线时长，app的历史统计信息）&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;app推荐系统实现如下图所示，主要包含：数据准备，模型训练，模型服务。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;258&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.4618585298196949&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRhFrme2eGpCvE1uiabU53qWWuP0zpFIDDDySwbo1TJiaGickyFpFqhYfHw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;721&quot;/&gt;&lt;figcaption&gt;APP推荐系统架构&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）数据准备&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;258&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.4618585298196949&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRhFrme2eGpCvE1uiabU53qWWuP0zpFIDDDySwbo1TJiaGickyFpFqhYfHw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;721&quot;/&gt;&lt;figcaption&gt;模型训练&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用户和app的展示数据用来生成训练数据，每次展示对应一条样本，label是用户是否安装推荐的app，安装的话为1，否则为0。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;分类特征映射成ID编码类数据，连续型特征先映射到CDF（累积分布函数），再离散化到0-1，其离散化的方式如下：&lt;/p&gt;&lt;span data-tool=&quot;mdnice编辑器&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;x = \frac{i-1}{n-1}&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -1342 4668 2110&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(849.8, 0)&quot;&gt;&lt;path data-c=&quot;3D&quot; d=&quot;M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mfrac&quot; transform=&quot;translate(1905.6, 0)&quot;&gt;&lt;g data-mml-node=&quot;mrow&quot; transform=&quot;translate(347.5, 676)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(567.2, 0)&quot;&gt;&lt;path data-c=&quot;2212&quot; d=&quot;M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(1567.4, 0)&quot;&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mrow&quot; transform=&quot;translate(220, -686)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6E&quot; d=&quot;M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(822.2, 0)&quot;&gt;&lt;path data-c=&quot;2212&quot; d=&quot;M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(1822.4, 0)&quot;&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;rect x=&quot;120&quot; y=&quot;220&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;含义：首先将数据分为n份，落入第i份的数据离散化后为&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;x&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 572 453&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）模型训练&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;324&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.5798403193612774&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkROyhpWDYPtG3RElPzkdm9YcEvg3ecRf4rgamteqL9vHNs0FEpa9ofWA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1002&quot;/&gt;&lt;figcaption&gt;模型训练&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;训练的模型结构图如上所示，wide部分的包含了用户安装app和展示app的交叉特征，deep部分每个分类特征生成32维的特征向量，连接所有的特征向量作为低维密集的特征，大约1200维。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文中提到了一个注意点：如果每一次都重新训练的话，将会花费大量的时间和精力，为了解决这个问题，采取的方案时热启动，即每次新产生训练数据的时候，从之前的模型中读取embedding和线性模型的权重来初始化新模型，在接入实时流之前使用之前的模型进行校验，保证不出问题。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;c）模型服务&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了保证每个请求都可以在 10 ms 内返回结果，我们通过多线程并行运行来优化性能，而不是单个 batch 内对所有候选集的 score 进行计算。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;总结&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Memorization（记忆） and generalization（泛化）对于推荐系统而言很重，线性模型能够有效的记录特征之间的交互，神经网络模型能够低维的嵌入特征泛化到可能的特征交叉组合。目前wide &amp;amp; deep一般是企业进行深度学习推荐系统尝试的首选，而且在企业应用也十分广泛。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;同时由于Wide &amp;amp; Deep算法的左右部分很容易被替换，因此也开辟了很多尝试和实验的可能性。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2016年-Youtube 深度学习推荐系统&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这篇论文是Youtube2016年发表在RecSys上的，16年之前Youtube关于推荐系统的优化主要集中在机器学习方向（一般会再往前推1到2年，一般方案成熟时才会公布出来），自此开启了深度学习与推荐系统的主要工作，下面我们来看看这一篇论文介绍的内容。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文详细介绍了Youtube是如何基于深度学习构建推荐系统的，包括召回部分和排序部分，下面的内容将会分为三部分进行介绍：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Youtube 深度推荐系统概述&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;基于深度学习做召回&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;基于深度学习做排序&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;实践经验和见解&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Youtube 深度推荐系统概述&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;整个推荐系统的架构如下图所示，其中candidate generation为生成候选池的神经网络，主要负责从大量的内容中产出少量的用户感兴趣的候选集合，ranking为排序的神经网络，最终推荐少量用户感兴趣的内容给用户。&lt;img data-backh=&quot;434&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.7779220779220779&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRDFUSQ321zSJeVUGSViaduyEibbglImOpDbEOloya9dND9XJxfpCgyZIg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1540&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;两阶段推荐方法允许我们从大量视频中进行推荐，同时确保设备上出现的少量视频是个性化的，并且适合用户。此外，这种设计允许混合由其他来源生成的候选源。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文中在验证推荐系统的好坏时，离线主要参考：精确率（precision，准确率是Accuracy）、召回率、loss值，线上主要通过ABTest来进行相关指标的验证，比如点击率、观看时长等。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;基于深度学习的召回&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）网络结构&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;深度学习召回模型的网络结构如下图所示：&lt;img data-backh=&quot;479&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.8584269662921349&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRz5xdn2HdSqybp7N4w96fia5QH8pXdxQJRia8tLTia88vdia7lIVqSJzATA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1780&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用到的特征包括：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;观看序列视频的平均embedding、搜索关键词的平均embedding、其他序列embedding&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;用户的地理位置信息、设备信息（embedding编码之后的）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;人口统计学特征（年龄、性别、登录状态等，并将其进行归一化到[0,1]）&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后将所有特征进行拼接，得到网络的原始输入特征。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里需要注意的是，论文中将推荐问题看成了多分类问题来进行模型的训练，如下面公式所示：&lt;/p&gt;&lt;span data-tool=&quot;mdnice编辑器&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;P(w_t = i| U,C) = \frac {e^{v_i u}} {\sum_{j \in V} e^{v_j u}}&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/O1dAhMERUwVszWEXH1neplZJQtzvoJoPnH0nT6oxTPf98F6GxGE3jO2uF1RQ3uPBkejsKz3zDs01ZWyIibnESB19R3x8lQtKQ/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;U&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -683 767 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;55&quot; d=&quot;M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 表示&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;user&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 1958 453&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;75&quot; d=&quot;M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(572, 0)&quot;&gt;&lt;path data-c=&quot;73&quot; d=&quot;M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1041, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1507, 0)&quot;&gt;&lt;path data-c=&quot;72&quot; d=&quot;M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;C&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -705 760 727&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;43&quot; d=&quot;M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 表示上下文&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;w_t&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -443 1021.3 600.8&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;77&quot; d=&quot;M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(716, -150) scale(0.707)&quot;&gt;&lt;path data-c=&quot;74&quot; d=&quot;M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 表示&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;t&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -626 361 637&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;74&quot; d=&quot;M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;时刻看到的视频&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;u&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 572 453&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;75&quot; d=&quot;M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 表示 &lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;user&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 1958 453&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;75&quot; d=&quot;M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(572, 0)&quot;&gt;&lt;path data-c=&quot;73&quot; d=&quot;M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1041, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1507, 0)&quot;&gt;&lt;path data-c=&quot;72&quot; d=&quot;M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;的embedding编码&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;v&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -443 485 454&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;76&quot; d=&quot;M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 表示 &lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;video&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 2301 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;76&quot; d=&quot;M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(485, 0)&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(830, 0)&quot;&gt;&lt;path data-c=&quot;64&quot; d=&quot;M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1350, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1816, 0)&quot;&gt;&lt;path data-c=&quot;6F&quot; d=&quot;M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;的embedding编码&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）召回模型中注意的点&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文中提到使用深度学习构建模型的好处是可以很轻松的添加连续、类别特征，&lt;strong&gt;在构建模型的过程中有几个需要注意的点&lt;/strong&gt;：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;1、虽然Youtube平台上包括显式反馈数据，但是构建数据集的时候采用的是隐式反馈，即用户观看了一个视频，则视为一条正样本&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;2、因为作为分类来进行模型的训练，负样本规模巨大，所以采用随机负采样的方法构建负样本&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;3、使用word2vec等方法产出基础的video embedding，并随着模型的训练和其他参数一起更新&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;4、论文中特意提到了一个特征：&lt;strong&gt;Age&lt;/strong&gt;，视频的年龄特征，因为用户上传的视频随着时间的变化，其流行度是极其不平稳的，如果忽略了这个特征，会引起一定的偏差，因此定义了视频年龄这个特征，对于新上传的视频是0。论文中还特意提到引入时间特征和不引入时间特征的对比图，如下所示，蓝色的线为基本模型，红色的线为增加了age特征，可以看出增加该特征后，模型预估的分布十分接近经验分布。&lt;img data-backh=&quot;541&quot; data-backw=&quot;532&quot; data-ratio=&quot;1.0163398692810457&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkR8miacvNtKpSO5a7wdCngj2uicabUM1DV9aYfWrHj2aVnomL1hwBXnOrw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;612&quot;/&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;5、构建用户序列数据时，应该是基于全平台的数据进行构建的，而不仅仅是推荐结果，这样有利于新内容的建模&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;6、&lt;strong&gt;构建序列时每个用户采用相同长度的序列，目的是降低活跃用户的影响&lt;/strong&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;7、打乱搜索序列数据，避免时序带来影响&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;8、选取序列时，只使用label前的序列数据，避免引起&lt;strong&gt;数据穿越&lt;/strong&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;9、视频和搜索关键词被编码成256长度的embedding，序列长度为50&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;10、用户的最终表示向量和视频的最终表示向量维度要一致，然后才能做内积计算，如结构图的右上角所示&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;c）在线召回&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在线服务阶段，通过视频向量&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;v&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -443 485 454&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;76&quot; d=&quot;M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;和用户向量&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;u&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 572 453&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;75&quot; d=&quot;M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 进行相似度计算，为了满足时延要求，在进行实际的召回计算时采用的是最近邻查询的方式。对于每个用户向量&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;u&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 572 453&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;75&quot; d=&quot;M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;，对视频库中的所有视频根据向量&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;v&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -443 485 454&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;76&quot; d=&quot;M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;做最近邻算法，得到top-N的视频作为召回结果。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;基于深度学习的排序&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）网络结构&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;排序模型的网络结构图如下所示：&lt;img data-backh=&quot;368&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.6591523895401262&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkREibEog4yKzXQDICcxmic2xibXicnAGmMHvWhpujBuRNLLq31ewB8eicFZXg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2218&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;整个结构分为：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;特征输入拼接层&lt;/strong&gt;：序列embedding特征，类别特征的embedding，连续特征的处理之后进行拼接&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;三层的神经网络&lt;/strong&gt;：每层神经网络激活函数使用的是ReLU，最优得结构为：&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;1024 -&amp;gt;512 -&amp;gt;256&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -677 9223.1 759&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mn&quot;&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot;/&gt;&lt;path data-c=&quot;30&quot; d=&quot;M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z&quot; transform=&quot;translate(500, 0)&quot;/&gt;&lt;path data-c=&quot;32&quot; d=&quot;M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z&quot; transform=&quot;translate(1000, 0)&quot;/&gt;&lt;path data-c=&quot;34&quot; d=&quot;M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z&quot; transform=&quot;translate(1500, 0)&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(2000, 0)&quot;&gt;&lt;path data-c=&quot;2212&quot; d=&quot;M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(3055.8, 0)&quot;&gt;&lt;path data-c=&quot;3E&quot; d=&quot;M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(4111.6, 0)&quot;&gt;&lt;path data-c=&quot;35&quot; d=&quot;M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z&quot;/&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot; transform=&quot;translate(500, 0)&quot;/&gt;&lt;path data-c=&quot;32&quot; d=&quot;M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z&quot; transform=&quot;translate(1000, 0)&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(5611.6, 0)&quot;&gt;&lt;path data-c=&quot;2212&quot; d=&quot;M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(6667.3, 0)&quot;&gt;&lt;path data-c=&quot;3E&quot; d=&quot;M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(7723.1, 0)&quot;&gt;&lt;path data-c=&quot;32&quot; d=&quot;M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z&quot;/&gt;&lt;path data-c=&quot;35&quot; d=&quot;M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z&quot; transform=&quot;translate(500, 0)&quot;/&gt;&lt;path data-c=&quot;36&quot; d=&quot;M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z&quot; transform=&quot;translate(1000, 0)&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;输出层&lt;/strong&gt;：在训练时，采用得时加权得逻辑回归，在线预测时，采用的是&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;e^{Wx + b}&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -853.7 2515 864.7&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(466, 363) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;57&quot; d=&quot;M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1048, 0)&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1620, 0)&quot;&gt;&lt;path data-c=&quot;2B&quot; d=&quot;M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2398, 0)&quot;&gt;&lt;path data-c=&quot;62&quot; d=&quot;M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）特征表示&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;模型使用到的特征是非常丰富的，首先将特征分为：离散特征和连续特征（每类特征的处理方式不同），离散特征又可以划分为二值的（比如登录状态，即是否登录）和多值的（用户搜索关键词），连续特征主要是一些统计类特征，比如观看时长，年龄等。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文中提到一些独特的特征构造和一些通用的特征处理方式。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;1、特征构造&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;用户会上传视频到指定的频道，那么用户在其上传频道下的观看视频次数是一个很重要的特征（也可以扩展到，用户在需要排序的item所属频道下的观看次数等统计指标）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;用户距离上一次观看item所属频道下的视频的时间&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;用户的实时交互特征也特别重要，比如第一刷的时候，用户对视频产生了行为（正向的或者负向的），那么在第二刷的时候应该被体现到（但是这个比较依赖数据实时处理技术，对数据延迟不太友好）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;其他的就是一些正常的特征构造技巧，但一些独特的特征还是需要深入业务进行了解和挖掘&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;2、类别特征的embedding编码&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;类别特征的embedding编码可以采用基础的word2vec技术进行向量生成，然后通过look-up的技术进行使用&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;但是如果类别特征基数特别大时，加载全量的embedding特征也很困难，因此论文中提到了一种方法：根据item的点击次数，只生成top N的item embeding向量，剩余的采用0向量进行填充&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;同一ID空间中的分类特征也共享底层的embedding，尽管embedding进行了共享，但每个特征都被单独的输入到网络中，这样上面的层就可以学习到每个特征的表示&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;共享embedding对于模型的泛化性、训练速度和减少内存都是至关重要的&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;3、连续特征的归一化和其他处理&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;首先论文提到神经网络对于输入特征的缩放和分布是非常敏感的，而其他的例如树模型对这些则不受影响，这在平时使用树模型做排序和dnn模型做排序时也可以深深的体会到&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;特征的正则化处理对于特征的融合十分重要&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;这里提到了几种对连续特征的处理方式，假设原始的连续特征为&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;x&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 572 453&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;累计分位点（标准化操作）：&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;\tilde{x} = \int_{- \infty}^{x} df&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -845.1 4921.5 1243.9&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(63.8, 287)&quot;&gt;&lt;path data-c=&quot;7E&quot; d=&quot;M179 251Q164 251 151 245T131 234T111 215L97 227L83 238Q83 239 95 253T121 283T142 304Q165 318 187 318T253 300T320 282Q335 282 348 288T368 299T388 318L402 306L416 295Q375 236 344 222Q330 215 313 215Q292 215 248 233T179 251Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(849.8, 0)&quot;&gt;&lt;path data-c=&quot;3D&quot; d=&quot;M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;msubsup&quot; transform=&quot;translate(1905.6, 0)&quot;&gt;&lt;g data-mml-node=&quot;mo&quot;&gt;&lt;path data-c=&quot;222B&quot; d=&quot;M113 -244Q113 -246 119 -251T139 -263T167 -269Q186 -269 199 -260Q220 -247 232 -218T251 -133T262 -15T276 155T297 367Q300 390 305 438T314 512T325 580T340 647T361 703T390 751T428 784T479 804Q481 804 488 804T501 805Q552 802 581 769T610 695Q610 669 594 657T561 645Q542 645 527 658T512 694Q512 705 516 714T526 729T538 737T548 742L552 743Q552 745 545 751T525 762T498 768Q475 768 460 756T434 716T418 652T407 559T398 444T387 300T369 133Q349 -38 337 -102T303 -207Q256 -306 169 -306Q119 -306 87 -272T55 -196Q55 -170 71 -158T104 -146Q123 -146 138 -159T153 -195Q153 -206 149 -215T139 -230T127 -238T117 -242L113 -244Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(687.6, 532.6) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(472, -340.9) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mo&quot;&gt;&lt;path data-c=&quot;2212&quot; d=&quot;M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(778, 0)&quot;&gt;&lt;path data-c=&quot;221E&quot; d=&quot;M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(3851.5, 0)&quot;&gt;&lt;path data-c=&quot;64&quot; d=&quot;M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(4371.5, 0)&quot;&gt;&lt;path data-c=&quot;66&quot; d=&quot;M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;累计分位点求根号（&lt;strong&gt;获得特征次线性 sub-linear&lt;/strong&gt;）：&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;\sqrt{\tilde{x}}&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -974.5 1425 1060&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msqrt&quot;&gt;&lt;g transform=&quot;translate(853, 0)&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(63.8, 287)&quot;&gt;&lt;path data-c=&quot;7E&quot; d=&quot;M179 251Q164 251 151 245T131 234T111 215L97 227L83 238Q83 239 95 253T121 283T142 304Q165 318 187 318T253 300T320 282Q335 282 348 288T368 299T388 318L402 306L416 295Q375 236 344 222Q330 215 313 215Q292 215 248 233T179 251Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(0, 114.5)&quot;&gt;&lt;path data-c=&quot;221A&quot; d=&quot;M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z&quot;/&gt;&lt;/g&gt;&lt;rect x=&quot;853&quot; y=&quot;854.5&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;累计分位点求平方（&lt;strong&gt;获得特征超线性 super-linear&lt;/strong&gt;）：&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;\tilde{x} ^2&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -903 975.6 914&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;mover&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(63.8, 287)&quot;&gt;&lt;path data-c=&quot;7E&quot; d=&quot;M179 251Q164 251 151 245T131 234T111 215L97 227L83 238Q83 239 95 253T121 283T142 304Q165 318 187 318T253 300T320 282Q335 282 348 288T368 299T388 318L402 306L416 295Q375 236 344 222Q330 215 313 215Q292 215 248 233T179 251Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(572, 432.1) scale(0.707)&quot;&gt;&lt;path data-c=&quot;32&quot; d=&quot;M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;c）用户观看时长建模&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;模型的目标是预测用户观看时长，有点击行为的为正样本，有曝光但是无点击的为负样本，正样本需要根据观看时长进行加权，因此，训练阶段网络最后一层用的是&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;weight logistic regression&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/O1dAhMERUwVszWEXH1neplZJQtzvoJoPrMdGvbWkTybDP5WgVsTT4q8StVyZAIeib5Xr1X0It2ibCYROrKAIDAdTaSh8q1HR4p/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;span data-tool=&quot;mdnice编辑器&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;\frac{\sum T_i} {N -k}&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -1460 3071.4 2228&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mfrac&quot;&gt;&lt;g data-mml-node=&quot;mrow&quot; transform=&quot;translate(485.4, 710)&quot;&gt;&lt;g data-mml-node=&quot;mo&quot;&gt;&lt;path data-c=&quot;2211&quot; d=&quot;M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;msub&quot; transform=&quot;translate(1222.7, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;54&quot; d=&quot;M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(584, -150) scale(0.707)&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mrow&quot; transform=&quot;translate(220, -686)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;4E&quot; d=&quot;M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1110.2, 0)&quot;&gt;&lt;path data-c=&quot;2212&quot; d=&quot;M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2110.4, 0)&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;rect x=&quot;120&quot; y=&quot;220&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;N&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -683 888 683&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;4E&quot; d=&quot;M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 表示总的样本数量&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;k&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 521 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 表示正样本的数量&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;T_i&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -677 878 834.8&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;54&quot; d=&quot;M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(584, -150) scale(0.707)&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 表示第&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;i&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -661 345 672&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;个样本的观看时长&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一般来讲，&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;k&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 521 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 相对 &lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;N&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -683 888 683&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;4E&quot; d=&quot;M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 较小，因此上述公式的期望可以转换成:&lt;/p&gt;&lt;span data-tool=&quot;mdnice编辑器&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;E[T] (1+P)&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -750 5275.4 1000&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;45&quot; d=&quot;M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(764, 0)&quot;&gt;&lt;path data-c=&quot;5B&quot; d=&quot;M118 -250V750H255V710H158V-210H255V-250H118Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1042, 0)&quot;&gt;&lt;path data-c=&quot;54&quot; d=&quot;M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1746, 0)&quot;&gt;&lt;path data-c=&quot;5D&quot; d=&quot;M22 710V750H159V-250H22V-210H119V710H22Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(2024, 0)&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(2413, 0)&quot;&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(3135.2, 0)&quot;&gt;&lt;path data-c=&quot;2B&quot; d=&quot;M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(4135.4, 0)&quot;&gt;&lt;path data-c=&quot;50&quot; d=&quot;M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(4886.4, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;由于&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;P&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -683 751 683&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;50&quot; d=&quot;M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 较小，这样目标期望接近于&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;E[T]&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -750 2024 1000&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;45&quot; d=&quot;M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(764, 0)&quot;&gt;&lt;path data-c=&quot;5B&quot; d=&quot;M118 -250V750H255V710H158V-210H255V-250H118Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1042, 0)&quot;&gt;&lt;path data-c=&quot;54&quot; d=&quot;M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1746, 0)&quot;&gt;&lt;path data-c=&quot;5D&quot; d=&quot;M22 710V750H159V-250H22V-210H119V710H22Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;，因此线上预测阶段，采用的时&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;e^x&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -675.5 920.5 686.5&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(466, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;作为激励函数，就是近似的估计期望观看时长。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;d）隐层网络的选择&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;325&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.5826645264847512&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRCwyXlhPL1ulYjzyehgz7nkHBGO8iby75meFNnhtM204FNRXucAtOj1A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;623&quot;/&gt;&lt;figcaption&gt;隐层网络的选择&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上图展示了不同隐藏层网络选择下的数据指标，从中可以看出采用三层的神经网络（&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;1024 -&amp;gt; 512 -&amp;gt; 256&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -677 9223.1 759&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mn&quot;&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot;/&gt;&lt;path data-c=&quot;30&quot; d=&quot;M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z&quot; transform=&quot;translate(500, 0)&quot;/&gt;&lt;path data-c=&quot;32&quot; d=&quot;M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z&quot; transform=&quot;translate(1000, 0)&quot;/&gt;&lt;path data-c=&quot;34&quot; d=&quot;M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z&quot; transform=&quot;translate(1500, 0)&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(2000, 0)&quot;&gt;&lt;path data-c=&quot;2212&quot; d=&quot;M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(3055.8, 0)&quot;&gt;&lt;path data-c=&quot;3E&quot; d=&quot;M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(4111.6, 0)&quot;&gt;&lt;path data-c=&quot;35&quot; d=&quot;M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z&quot;/&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot; transform=&quot;translate(500, 0)&quot;/&gt;&lt;path data-c=&quot;32&quot; d=&quot;M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z&quot; transform=&quot;translate(1000, 0)&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(5611.6, 0)&quot;&gt;&lt;path data-c=&quot;2212&quot; d=&quot;M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(6667.3, 0)&quot;&gt;&lt;path data-c=&quot;3E&quot; d=&quot;M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(7723.1, 0)&quot;&gt;&lt;path data-c=&quot;32&quot; d=&quot;M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z&quot;/&gt;&lt;path data-c=&quot;35&quot; d=&quot;M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z&quot; transform=&quot;translate(500, 0)&quot;/&gt;&lt;path data-c=&quot;36&quot; d=&quot;M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z&quot; transform=&quot;translate(1000, 0)&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;）效果是最好的（当然由于这里没有列出更多的隐藏层选择，可能是因为效果不好，或者线上预测时的延迟太高）。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在选定网络结构之后，论文作者也尝试了对连续特征归一化后不进行超线性和次线性的特征扩展，loss增加0.2%；把weighted lr 换成lr，效果下降了4.1%。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;实践经验和见解&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文中提出的召回和排序模型结构相比较矩阵分解类召回、树模型排序等取得了不错的效果，这也说明深度学习推荐系统是工业界的主流趋势，我们应该拥抱深度学习推荐系统。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文中很值得借鉴和思考的点其实在上面的内容中已经介绍到了，主要包括：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;经典的三层的网络结构&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;序列特征的处理方式&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;连续特征的处理方式&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;离线模型的评估和模型的优化扩展对比&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;在线实验ABTest&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;CTR类模型中label的选取&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;... ...&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里推荐王喆老师的一篇文章，也是介绍youtube dnn的，思考点也很多：https://zhuanlan.zhihu.com/p/52169807&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;2019年-Youtube 基于多任务学习的排序&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这篇论文是Youtube2019年发表在RecSys上的，这篇论文主要是针对推荐系统排序阶段的多任务深度学习模型，下面我们来看看这一篇论文介绍的内容。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文名称：&lt;strong&gt;Recommending What Video to Watch Next: A Multitask Ranking System&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;strong&gt;下面的内容后半部分来自公众号：「数据与智能」&lt;/strong&gt;，老哥总结的很全面，所有迁移过来了，点赞！&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;背景&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文提出了一个在Youtube视频分享平台上基于当前观看视频预测用户下一部要观看的视频的大型多目标视频排序系统（其业务形态如下图所示），论文聚焦于推荐排序阶段，其面临的真实业务场景中的挑战主要体现在：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;1、面临多个不同甚至相互冲突的的排序目标；比如，我们希望用户观看某个视频，并且还希望他能够给视频高评分并分享给他的好友&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;2、用户对推荐结果隐式反馈产生的选择偏差；比如用户可能会观看一个评分比较高(因此排在推荐列表的前面)的视频但是用户本身不是特别喜欢这个视频&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了解决如上两个现实问题，论文通过软参数共享技术（soft-parameter sharing techniques，比如Multi-gate Mixture-of-Experts，简称MMoE）来优化多个排序目标。另外通过引入Wide &amp;amp; Deep框架，该模型增加一个整合了偏差信息的浅层塔结构来解决选择偏差问题，最终在Youtube上做在线AB测试验证，可以显著提高多种排序目标的推荐质量。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;412&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.7388137356919875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRnGSJGp4DVCOFZHcQJpAtWtXfaia3RJvFHxs3TIwdcLuaC6yiaA74Bib3A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;961&quot;/&gt;&lt;figcaption&gt;Youtube多目标业务排序业务场景&lt;/figcaption&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;相关工作&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本部分作者主要探讨三方面的内容：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;1、工业推荐系统概况&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;2、多目标推荐系统&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;3、理解训练数据中的偏差&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）工业推荐系统概况&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大多数推荐系统包含两部分：候选集的生成，排序。对于候选集的生成，可以使用多种算法，比如基于共现的算法、协同、基于图的embedding表示法、矩阵分解等，排序侧的算法使用更是丰富，比如线性模型（pair-wise）、树模型（point-wise）等LTR方法、基于point-wise的DNN算法等。&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;更多关于LTR框架的知识可以参考：&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzI2MDU3OTgyOQ==&amp;amp;mid=2247486930&amp;amp;idx=1&amp;amp;sn=fa50361c5ca54ae4290a7760bc7e79aa&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;怎么理解基于机器学习“四大支柱”划分的学习排序方法&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文中，首次明确了工业排序系统中的一个关键问题：用户隐式反馈和用户在推荐项上的真实反馈不一致问题。随后，我们提出了一个深度神经网络排序模型，该模型使用多任务学习技术来支持多个排名目标，每个目标对应一种类型的用户反馈。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）多目标推荐系统&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;从训练数据中学习和预测用户的行为偏好是极具挑战的，因为用户的行为是丰富多样的，比如点击、评分、评论等，然后每种行为并不能真实的表现用户的兴趣，比如用户点击了一个item，但是用户并不喜欢它，用户可以仅仅对点击的或者参与的其他item提供一个评分但是并不是真的喜欢它。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们的排序系统需要有能力的、去学习和捕获用户的多种行为，然后结合这些估计去计算用户最终的排序分数。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;例如我们可以根据用户的多种行为构建user-item的矩阵，但是这种方式在离线运行比较方便，线上实时排序时则失去了很好的扩展性。另一方面，许多存在的多目标排序系统是专为特定类型的功能和应用程序而设计，如文本和视觉，这些系统对于支持多目标任务的特征空间来讲是具有很大的挑战的，而其他考虑多种输入特征的多目标排序系统由于其在有效共享多目标模型参数方面的局限性而无法扩展。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;基于多任务学习的DNN已经广泛应用于传统的机器学习任务，比如表示学习、NLP、计算机视觉等，因此我们也可以将这些思路和做法移植和拓展到推荐系统上。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;c）理解训练数据中的偏差&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用户和推荐出的item之间的行为交互会产生选择偏差，比如用户点击了一个排序系统推出的item，但是在整个语料库中它可能并不是最有用的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;因此基于排序系统产出的训练数据训练的模型会向排序系统产生偏差，从而产生反馈回路效应。如何有效的学习研究排序系统中这样的偏差情况是一个开放的问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Joachims等在论文《Evaluating the accuracy of implicit feedback from clicks and query reformulations in web search》首次分析了隐式反馈数据中的位置偏差和呈现偏差，以此训练排序模型。通过比较点击数据和显式反馈的相关性，他们发现点击数据中存在位置偏差，并且在估计查询和文档之间的相关性时可以显著影响排序模型的学习。&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;选择偏差指得是信息流类的场景中，由于item的位置不同，用户在进行点击时会受到影响，这种一种选择偏差，但一般去讲选择偏差时主要谈的是位置偏差，因为分析表示，排在前边的item点击率是要比后边的高。所以在文章中，会交替出现选择偏差和位置偏差，我们可以理解是同一种意思。&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一种常见的消除位置偏差的方法是将位置作为输入模型的特征，在CTR模型中位置特征用来学习位置与目标的相关性概率：&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;p(relevance|pos)&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -750 7210 1000&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;70&quot; d=&quot;M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(503, 0)&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(892, 0)&quot;&gt;&lt;path data-c=&quot;72&quot; d=&quot;M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1343, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1809, 0)&quot;&gt;&lt;path data-c=&quot;6C&quot; d=&quot;M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2107, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(2573, 0)&quot;&gt;&lt;path data-c=&quot;76&quot; d=&quot;M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(3058, 0)&quot;&gt;&lt;path data-c=&quot;61&quot; d=&quot;M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(3587, 0)&quot;&gt;&lt;path data-c=&quot;6E&quot; d=&quot;M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(4187, 0)&quot;&gt;&lt;path data-c=&quot;63&quot; d=&quot;M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(4620, 0)&quot;&gt;&lt;path data-c=&quot;65&quot; d=&quot;M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(5086, 0)&quot;&gt;&lt;path data-c=&quot;7C&quot; d=&quot;M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(5364, 0)&quot;&gt;&lt;path data-c=&quot;70&quot; d=&quot;M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(5867, 0)&quot;&gt;&lt;path data-c=&quot;6F&quot; d=&quot;M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(6352, 0)&quot;&gt;&lt;path data-c=&quot;73&quot; d=&quot;M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(6821, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;，当在线预测时，另&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;pos=1&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -666 3290.6 860&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;70&quot; d=&quot;M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(503, 0)&quot;&gt;&lt;path data-c=&quot;6F&quot; d=&quot;M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(988, 0)&quot;&gt;&lt;path data-c=&quot;73&quot; d=&quot;M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1734.8, 0)&quot;&gt;&lt;path data-c=&quot;3D&quot; d=&quot;M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mn&quot; transform=&quot;translate(2790.6, 0)&quot;&gt;&lt;path data-c=&quot;31&quot; d=&quot;M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;，更加详细的内容可以参考论文：《A dynamic bayesian network click model for web search ranking. In Proceedings of the 18th international conference on World wide web》&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;另外一种从位置中学习偏差的方法是将其作为一个正则化或标准化。通常要学习偏差项，需要使用失血随机数据来推断偏差项（称为“全局偏差”，“倾向”）而不考虑相关性，在论文《Unbiased learning-to-rank with biased feedback》中，倾向得分（inverse propensity score，IPS）是通过反事实模型学习得到的，不需要随机数据。在Rank-SVM模型中，位置特征被用作正则项。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在真实的推荐系统中，尤其是社会媒体平台，比如说Twitter、Youtube，用户的行为和item的流行趋势变化的很快，IPS方法并不能很好的适用，因此在训练排序模型时需要一种更加有效的方法去消除位置偏差。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;问题描述&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在真实的、稀疏的视频推荐系统中，基于隐式反馈训练排序模型需要考虑两个重要的因素：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;1、多模态特征空间，在一个上下文感知的个性化推荐系统中，我们需要利用多模式生成的特征空间来学习候选视频的用户效果，例如视频内容、缩略图、音频、标题和描述、用户统计信息。与其他的机器学习系统相比，从多模态特征空间中进行推荐的学习表示具有独特的挑战性。它涉及两个难题：&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;1、弥补低维内容特征的语义鸿沟，以此来实现内容的协同&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;2、从稀疏的项目空间中进行协作学习&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;2、可扩展性，主要指的是推荐系统的高效性和可扩展性&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了解决多模态特征空间问题：对于每个视频，我们提取诸如视频元数据和视频内容信号之类的特征作为其表示，对于上下文，我们使用诸如用户人口统计，设备，时间和位置等特征。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了解决系统的扩展性，采用了两段式的推荐系统架构，即生成候选池、排序。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）生成候选池&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Youtube视频推荐系统中依旧采用了多路召回的思路，比如：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;匹配用户搜索视频的主题来进行召回&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;基于视频的共现频率进行的召回&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;基于序列模型的召回&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;基于上下文的召回&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最后将所有的召回形成一个集合，构建出候选池&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）排序&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;不同于候选池的生成，排序模型的主要目标是提供一个排序列表，用户高概率会交互的视频排列在前边。因此，这里采用的是神经网络架构，以具有足够的模型表达能力来学习特征的关联及其与目标的关系。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;模型架构&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）基本框架&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;350&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.6265286923800565&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRzfyMEKR52ks9vRgAaKoJqRb9LicEsDbYdiaXBibj2yfIvia7qMgJSaAFIA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1063&quot;/&gt;&lt;figcaption&gt;模型基本框架&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;模型的基本框架如上图所示，最终的优化目标分为两大类：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;1、用户参与度（engagement objectives）指标，比如点击率、为用户推荐视频的用户满意度等&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;2、用户满意度（satisfaction objectives）指标，比如用户点赞视频、用户给推荐视频的评分等&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了学习和估计多样的用户行为，该模型基于wide &amp;amp; deep模型架构做了拓展，采用MMoE技术来自动学习多个可能存在冲突的目标的共享模型参数。上图中间偏右的Mixture-of-Experts模块从多种输入数据源中学习数据不同维度的特征，每个维度可以类比为某个方面的“专家”(Experts)，再通过使用多个门控网络(Gating Networks)模块(见上图中间部分)，不同的学习目标可以选择不同的或者共享的”专家“来最终优化多目标任务。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了减少从有偏差的训练数据中产生的模型偏差(比如位置偏差)，该模型加入了一个浅层塔(shallow tower)模块(见上图左边蓝色的shollow tower模块)，这个模块可以类比wide &amp;amp; deep模型中的wide部分。该模块通过整合推荐的视频的位置信息等可能产生偏差的信息，最终作为主模型的偏差项(浅塔模型输出是一个具体的数值)整合进主模型进行学习，而在推断时，可以将位置参数设置为pos=1来消除位置产生的影响。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文的主要贡献点：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;引入一个端到端的推荐排序模型&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;将排序模型抽象为一个多任务学习问题，并且利用MMoE技术优化多目标学习&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;通过采用wide &amp;amp; deep架构，引入浅层塔结构避免位置偏差&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;通过在Youtube上进行AB测试，证明可以大幅度提升模型的效果&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）系统概述&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文中的排序系统学习两类用户反馈：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;用户参与行为(如点击、播放等)&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;用户满意度行为(喜欢、不喜欢等)。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;对每个待排序的候选视频，排序模型利用候选视频的特征、query(如用户播放历史或者用户人口统计学特征等)、上下文(如观看时的时间等)作为输入来预测多种用户行为&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;采用LTR（learning to rank）框架，将预测问题建模为分类或者回归问题。具体是利用point-wise方法，而不是pair-wise或者list-wise LTR方法，主要是因为point-wise更简单，可以有效地拓展到大规模的候选集排序中，尽管pair-wise和list-wise方法可以增加预测结果的多样性。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;c）排序目标的定义&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;排序模型利用用户的行为作为训练的label。在「&lt;strong&gt;b）系统概述&lt;/strong&gt;」中提到排序模型预测参与性目标与满意性目标。对于参与度目标(如点击与播放)，将预测行为建模为二分类任务(如点击) 和回归任务(如用户播放时长)两大类。类似地，对于满意度目标，也可以建模为二分类任务和回归任务两大类，比如，喜欢某个视频可以看成是二分类任务，对视频进行评分可以看成是回归任务。对于二分类任务，可以采用交叉熵(cross entropy)损失函数，而对于回归任务，可以采用平方损失函数。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一旦多任务排序的目标和建模问题类型确定了，我们可以训练多任务排序模型来进行最终的排序。对任意一个候选视频，我们通过多个目标预测模型的输入获得一个综合得分(通过多个预测模型得分的加权乘积，权重通过手动调整，需要权衡用户参与度和满意度目标)。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;d）利用MMoE来对任务的相关性和冲突性建模&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;204&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.3654080389768575&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRJUjdCew8OTNue6zS7APoM4RiaNCHVU0QCcpn8pPSWaQAGXWRwMGibYSA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;821&quot;/&gt;&lt;figcaption&gt;共用底层网络&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;多目标排序系统的学习一般使用一个共用的底层模型(如上图左边的网络结构)，但是硬编码的参数共享往往对学习多目标是有副作用的，特别是当这些不同学习任务相关性很低时。为了避免这种情况，这篇论文采用了MMoE技术，MMoE采用软参数共享结构，可以消除多任务目标中的存在冲突的目标。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;MMoE采用Mixture-of-Experts(MoE)结构应对多任务学习，让多个任务共享这些“专家”，同时，每个任务配备一个训练好的门控网络(gating network)来协调不同“专家“所起的作用。相比于共享的底层模型结构，MMoE需要更少的参数。MMoE的核心思想是对每个学习任务将共享的ReLU层替换为MoE层并加上门控网络。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;推荐排序系统通过在共享的隐含层之上增加”专家“层(如上图右边网络结构)，让最终的模型可以从输入中学习模块化的信息。在输入层或者隐含层之上增加”专家“层，最终可以更好地对多模态的特征空间进行建模。但是直接加在输入层之上会增加模型训练和推断的时间开销(因为输入层维度相比隐含层包含更多的参数，参数越多，训练效率往往越低)，因此该论文采用”专家“层直接加在隐含层之上的方法。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该模型的”专家“网络是利用ReLU作为激活函数的多层感知机。对于任务 &lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;k&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 521 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 和预测值&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;y_k&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 908.4 647&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;79&quot; d=&quot;M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(490, -150) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;及最后一个隐含层&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;h^k&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -853.7 994.4 864.7&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;68&quot; d=&quot;M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(576, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;。包含&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;n&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -442 600 453&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6E&quot; d=&quot;M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;个&quot;专家&quot;的MMoE层在任务&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;k&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 521 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;上的输出为：&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;f^k(x)&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -853.7 2380.4 1103.7&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;66&quot; d=&quot;M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(612, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1030.4, 0)&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1419.4, 0)&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1991.4, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;,可以用如下方程来表示：&lt;/p&gt;&lt;span data-tool=&quot;mdnice编辑器&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;y_k = h^k (f^k(x))&amp;#10;\\&amp;#10;where f^k(x) = \sum_{i=1}^{n} g_{(i)}^k (x) f_i(x)&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/O1dAhMERUwVszWEXH1neplZJQtzvoJoP4F3MKE4x5Rz5wI5l4A5EqP6DwfzmV8PC1fj2LyeucqAAlCKVDVyIVibTBErGBlgM3/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;x \in R^d&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -853.7 2971.3 893.7&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(849.8, 0)&quot;&gt;&lt;path data-c=&quot;2208&quot; d=&quot;M84 250Q84 372 166 450T360 539Q361 539 377 539T419 540T469 540H568Q583 532 583 520Q583 511 570 501L466 500Q355 499 329 494Q280 482 242 458T183 409T147 354T129 306T124 272V270H568Q583 262 583 250T568 230H124V228Q124 207 134 177T167 112T231 48T328 7Q355 1 466 0H570Q583 -10 583 -20Q583 -32 568 -40H471Q464 -40 446 -40T417 -41Q262 -41 172 45Q84 127 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;msup&quot; transform=&quot;translate(1794.6, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;52&quot; d=&quot;M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(759, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;64&quot; d=&quot;M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 是共享隐含层的低维嵌入向量，&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;g^k&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -853.7 895.4 1058.7&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;67&quot; d=&quot;M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(477, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;是任务&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;k&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -694 521 705&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;的门控网络，&lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;g^k(x) \in R^n&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -853.7 4701.2 1103.7&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;67&quot; d=&quot;M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(477, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(895.4, 0)&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1284.4, 0)&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1856.4, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(2523.2, 0)&quot;&gt;&lt;path data-c=&quot;2208&quot; d=&quot;M84 250Q84 372 166 450T360 539Q361 539 377 539T419 540T469 540H568Q583 532 583 520Q583 511 570 501L466 500Q355 499 329 494Q280 482 242 458T183 409T147 354T129 306T124 272V270H568Q583 262 583 250T568 230H124V228Q124 207 134 177T167 112T231 48T328 7Q355 1 466 0H570Q583 -10 583 -20Q583 -32 568 -40H471Q464 -40 446 -40T417 -41Q262 -41 172 45Q84 127 84 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;msup&quot; transform=&quot;translate(3468, 0)&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;52&quot; d=&quot;M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(759, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6E&quot; d=&quot;M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 是第 &lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;i&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -661 345 672&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 个分量，而 &lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;f_i(x)&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -750 2134 1000&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;66&quot; d=&quot;M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(490, -150) scale(0.707)&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(784, 0)&quot;&gt;&lt;path data-c=&quot;28&quot; d=&quot;M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(1173, 0)&quot;&gt;&lt;path data-c=&quot;78&quot; d=&quot;M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mo&quot; transform=&quot;translate(1745, 0)&quot;&gt;&lt;path data-c=&quot;29&quot; d=&quot;M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 是第 &lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;i&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -661 345 672&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;69&quot; d=&quot;M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt; 个&quot;专家&quot;。门控网络是输入通过简单线性变换后再经过softmax变换，即:&lt;/p&gt;&lt;span data-tool=&quot;mdnice编辑器&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;g^k(x) = softmax(W_{g^k}x)&amp;#10;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;embed src=&quot;https://mmbiz.qlogo.cn/mmbiz_svg/O1dAhMERUwVszWEXH1neplZJQtzvoJoPPhiaIx7bICGtBibMglPiaa5vRMTUJq1McBI4Ggn1X7PkibBB2IX6KnwWmC8Jic0wCJgL8/0?wx_fmt=svg&quot; data-type=&quot;svg+xml&quot;/&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里， &lt;span&gt;&lt;span role=&quot;presentation&quot; data-formula=&quot;W_{g^k}&quot; data-formula-type=&quot;inline-equation&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 -683 1627.1 1078&quot; aria-hidden=&quot;true&quot;&gt;&lt;g stroke=&quot;currentColor&quot; fill=&quot;currentColor&quot; stroke-width=&quot;0&quot; transform=&quot;matrix(1 0 0 -1 0 0)&quot;&gt;&lt;g data-mml-node=&quot;math&quot;&gt;&lt;g data-mml-node=&quot;msub&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;57&quot; d=&quot;M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;TeXAtom&quot; transform=&quot;translate(944, -250.1) scale(0.707)&quot; data-mjx-texclass=&quot;ORD&quot;&gt;&lt;g data-mml-node=&quot;msup&quot;&gt;&lt;g data-mml-node=&quot;mi&quot;&gt;&lt;path data-c=&quot;67&quot; d=&quot;M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z&quot;/&gt;&lt;/g&gt;&lt;g data-mml-node=&quot;mi&quot; transform=&quot;translate(477, 363) scale(0.707)&quot;&gt;&lt;path data-c=&quot;6B&quot; d=&quot;M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z&quot;/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/span&gt;&lt;/span&gt;是线性变换的自由参数。&quot;专家&quot;的数量可以设置为很多个，但是论文构建的模型中只用少量的&quot;专家&quot;，期望&quot;专家&quot;可以被更多的任务共享，这样做主要是期望提升模型的训练效率(&quot;专家&quot;数越多参数越大)。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;e）通过整合浅层塔结构提出位置等带来的偏差&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;隐式反馈数据被广泛用于排序学习模型的训练中。从用户行为日志中可以获得大量的隐式反馈信息，因此可以利用复杂的神经网络模型来学习排序特征。但是，很多隐式反馈是从推荐排序系统的产品交互中产生的(我们通过给用户推荐视频，用户点击推荐的视频产生隐式反馈行为)，因此是带有偏差的。位置偏差(推荐的视频在推荐列表中所排的次序)及其他类型的偏差被大量研究者在排序学习模型中所证实。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在我们的排序系统中，这里的查询请求是当前用户正在观看的视频(如果将推荐问题看成一个搜素问题，那么当前在看的视频可以等价于搜素的查询关键词)，候选视频是相关的视频，用户通常倾向于点击并观看显示在列表顶部的视频，而不管这些视频的真实用户效用(与观看视频的相关性、用户的偏好)如何(这是一种先入为主的效应，因此会产生位置偏差)。我们的目标是从排序模型中消除这种位置偏差。在我们的训练数据中或在模型训练过程中通过建模减少选择偏差可以提升模型质量。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们的模型采用跟wide &amp;amp; deep类似的结构，将模型预测分解为两个部分：来自主塔的用户效用(user-utility)部分和来自浅层塔的偏差部分。具体地说，我们训练一个包含选择偏差(如位置偏差)特征的浅塔模型，然后将其输出添加到主模型的Logit中，如下图5所示。在训练中，使用所有视频的位置信息，采用drop-out的思路，随机丢弃10%的位置信息，以防止我们的模型过度依赖位置特征。在模型推断期间，将位置特征设置为缺失值(这样所以视频的位置信息都不考虑了，从而剔除了位置偏差)。同时我们将位置特征与设备特征交叉(是因为在不同类型的设备上观察到不同的位置偏差)。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-backh=&quot;371&quot; data-backw=&quot;558&quot; data-ratio=&quot;0.6647314949201741&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/02kicEWsInicgiaUBzWiclnPia5u2lszVrjkRkhuHLjJRWcTJYHRfkbmx5xzp7yERYAR2nyLpJXwBmnhp44HSZ8328A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;689&quot;/&gt;&lt;figcaption&gt;增加浅塔层便于学习模型的偏差(如位置偏差)&lt;/figcaption&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;排序模型核心亮点解读&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;通过上面的详细讲解，我们介绍完了这篇非常有工程参考价值的推荐排序学习模型。在这一节我们来梳理一下该模型的核心亮点，这些点都是值得我们参考借鉴的。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）通过多任务学习来进行排序&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该模型通过将用户的行为分为参与度行为与满意度行为两大类，作为独立的任务，通过机器学习中的多任务学习框架来建模。参与度行为更多的是隐式反馈，而满意度行为更多的用户的主动反馈，在同一个模型中整合这两类反馈可以充分利用已知信息，提升模型的精准度。使用多种类型的隐式反馈信号和多个排序目标，我们获得了更多调控手段，更好地平衡模型预测结果和用户真实兴趣之间的关系。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）通过MMoE技术来平衡多目标&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;有了多任务框架，那么怎么来学习和平衡这两类任务呢？MMoE框架通过在不同任务之间共享“专家”的方式来更好地平衡多任务之间的冲突和相关关系，可以更好地学习多任务模型。这个思想是非常朴素的，不同的”专家“有不同的优点和特长，不同任务通过在不同“专家”上学习到不同的权重参数分布(可以简单理解为选择适合自己的“专家”)，最终达到更好地刻画每个任务的目的，最终提升整体模型的效果。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;分布式训练一般可能会导致模型发散。在MMoE模型中，采用softmax激活函数的门控网络会导致“专家”分布不平衡的问题，最终导致很多“专家”的效用为0，该论文作者在实验中发现大概20%的概率会出现这种情况，作者采用drop-out的方式来解决了该问题，具体就是采用10%的概率随机设置”专家“的效用为0，并且重新归一化softmax的输出。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;c）通过整合位置信息来消除偏差&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;采用wide &amp;amp; deep的双塔结构，在浅层塔中通过整合位置信息，让模型学到位置偏差，最终在模型推断时剔除掉位置偏差，从而让模型有更好的表现。位置偏差等选择偏差是推荐算法工程师在构建推荐模型中很少会考虑的(但是一般是会意识到这个问题的)的一类影响因子。该模型提供了一种消除位置偏差的解决方案和思路。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;d）按照时间序将数据灌入模型训练&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;作者按照样本产生的时间顺序依次训练模型。先训练之前的数据，当有新的样本产生时再将新样本加入训练中。通过这样做，模型可以适应最新的数据。这对于许多实际的推荐应用来说是非常关键的，在这些实际应用中，数据分布和用户模式会随着时间的推移而动态变化。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;建模过程中面临的挑战&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在构建YouTube排序推荐模型过程中会面临很多问题与挑战，这里我们简要整理一下，本篇论文对这些问题与挑战给出了相应的解决方案，在前面都有所讲解。这些问题及经验教训值得我们多思考。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）构建基于神经网络的推荐排序算法面临的问题&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;许多推荐系统研究扩展了最初为传统机器学习应用设计的模型体系结构，如自然语言处理的multi-headed attention和计算机视觉的cnn算法。然而，许多适合于特定领域的表示学习的模型体系结构并不直接适用于YouTube的推荐需求。这是由于：&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;多模态特征空间&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;YouTube排序模型依赖多种数据源的特征，这些特征包括类别特征、文本、图像等等，从混合特征中进行学习是非常有挑战的。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;可拓展性及多目标排序&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;很多模型结构被设计来建模某种信息，它们在提升某个目标的同时可能损害另外一个目标，通过构建复杂的模型结构来处理多目标又往往无法拓展到大规模数据场景。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;包含噪音及局部稀疏的数据&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;排序系统需要训练视频和查询的嵌入向量。然而，大多数稀疏特性遵循幂律分布，并且在用户反馈上有较大的差异。比如，在同一条件下，用户可能会播放或者不播放一个视频仅仅由于推荐视频的视频海报图清晰度上的一点点差异，而这些差异又很难被算法捕捉到，因此，对于长尾内容训练出好的嵌入表示是非常困难的。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;利用mini-batch随机梯度下降法来分布式训练&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当数据量大，模型表达能力强(模型复杂，参数多)时，必须要用分布式技术进行训练，这本身在工程上就是一件非常有挑战的事情(需要搭建分布式计算平台来支持模型训练，还要实现分布式算法)。论文作者基于TensorFlow利用TPU来训练模型，利用TFX(见参考文献7)来提供生产服务。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;效果与效率的平衡&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在工业级推荐系统中，效率除了影响请求时间外，也会影响用户体验。过于复杂的模型会显著增加生成视频推荐结果的延迟，从而降低用户满意度和在线指标。因此，我们通常更热衷于使用更简单、更直接的模型。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）训练数据中的偏差&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;除了位置偏差外，模型可能还存在其他种类的偏差，这些偏差可能是未知的。自动化地学习和捕获这些偏差本身就是一个非常复杂的问题。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;c）模型评估面临的挑战&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;由于排序模型使用隐式反馈，线下评估好的模型上线后不一定真实的线上指标就好，甚至有时真实线上指标效果会更差。一般来说，可以选择一个简单的模型，这样可以更好地推广到线上，产生相对较好的结果，也就是说，简单的模型能更好地保证线下和线上指标的一致性。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;优化方向&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;论文作者在文章最后总结了几个对该模型进行优化的方向，具体包含如下3点：&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;a）探索新模型架构，在稳定性、可训练性、强表达能力等三方面达到平衡&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;MMoE技术通过灵活选择哪些“专家”可以共享来提升多任务排序模型的性能，参考文献5提供了另一种架构，除了可以保证模型性能外，还能提升模型稳定性，是值得研究的一个方向。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;b）理解和识别偏差&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了对已知和未知的偏差进行建模，探索从训练数据中自动识别潜在偏差并学习如何减少这些偏差的模型架构和目标函数是一个值得研究的方向。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;c）模型压缩&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了降低请求延迟，可以使用不同类型的模型压缩技术(见参考文献6)，减少模型大小，从而提升处理效率。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;总结&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该论文通过构建多任务学习模型，利用MMoE技术来平衡多个任务之间的相关或者冲突关系从而更好地平衡多个目标。同时将位置偏差信息整合进模型，消除偏差影响，最终达到非常好的线上效果。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;从这篇文章出发，我们可以进行更深入的思考。比如视频一般是包含贴片广告的，增加贴片广告(从而为公司创造广告收益)和用户体验之间也是一对冲突的目标，是否可以采用多任务学习的方式来寻求广告收益和用户体验的平衡呢？除了位置偏差外，视频海报的颜色、清晰度是否会产生偏差呢？怎么通过将这些因素引入模型解决相关的偏差呢？这些都是值得探索的问题，相信本文给我提供了很好的思路，为我们指明了探索的方向。&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f870946ce479b8c7e69c61c70223e4c3</guid>
<title>面向初学者的实用教程合集，欢迎 PR</title>
<link>https://toutiao.io/k/tee3go6</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;body class=&quot;logged-out env-production page-responsive&quot; id=&quot;readabilityBody&quot;&gt;
    

    

  &lt;p id=&quot;start-of-content&quot; class=&quot;show-on-focus&quot;/&gt;





    


    

  &lt;include-fragment class=&quot;js-notification-shelf-include-fragment&quot; data-base-src=&quot;https://github.com/notifications/beta/shelf&quot;/&gt;




  &lt;div class=&quot;application-main &quot; data-commit-hovercards-enabled=&quot;&quot; data-discussion-hovercards-enabled=&quot;&quot; data-issue-and-pr-hovercards-enabled=&quot;&quot;&gt;
        &lt;div itemscope=&quot;&quot; itemtype=&quot;http://schema.org/SoftwareSourceCode&quot; class=&quot;&quot;&gt;
    &lt;main id=&quot;js-repo-pjax-container&quot; data-pjax-container=&quot;&quot;&gt;
      

    


    






  


  &lt;div class=&quot;bg-gray-light pt-3 hide-full-screen mb-5&quot;&gt;

      
          &lt;div class=&quot;d-block d-md-none mb-2 px-3 px-md-4 px-lg-5&quot;&gt;
      &lt;p class=&quot;f4 mb-3&quot;&gt;
        How-To Recipes, 碎片化教程, 开发技巧 
      &lt;/p&gt;
    
    
  &lt;/div&gt;

        
&lt;nav aria-label=&quot;Repository&quot; data-pjax=&quot;#js-repo-pjax-container&quot; class=&quot;js-repo-nav js-sidenav-container-pjax js-responsive-underlinenav overflow-hidden UnderlineNav px-3 px-md-4 px-lg-5 bg-gray-light&quot;&gt;
          

&lt;/nav&gt;
  &lt;/div&gt;


&lt;div class=&quot;container-xl clearfix new-discussion-timeline px-3 px-md-4 px-lg-5&quot;&gt;
  &lt;div id=&quot;repo-content-pjax-container&quot; class=&quot;repository-content &quot;&gt;

    
      

  &lt;p class=&quot;d-none d-lg-block mt-6 mr-3 Popover top-0 right-0 box-shadow-medium col-3&quot;&gt;
    
  &lt;/p&gt;


  &lt;div class=&quot;gutter-condensed gutter-lg flex-column flex-md-row d-flex&quot;&gt;

  &lt;div class=&quot;flex-shrink-0 col-12 col-md-9 mb-4 mb-md-0&quot;&gt;
          





      &lt;div class=&quot;file-navigation mb-3 d-flex flex-items-start&quot;&gt;
  



  

  &lt;p class=&quot;flex-auto&quot;/&gt;

  &lt;a class=&quot;btn ml-2&quot; data-hydro-click=&quot;{&amp;quot;event_type&amp;quot;:&amp;quot;repository.click&amp;quot;,&amp;quot;payload&amp;quot;:{&amp;quot;target&amp;quot;:&amp;quot;FIND_FILE_BUTTON&amp;quot;,&amp;quot;repository_id&amp;quot;:334011383,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/toutiaoio/HowTos?hmsr=toutiao.io&amp;amp;utm_medium=toutiao.io&amp;amp;utm_source=toutiao.io&amp;quot;,&amp;quot;user_id&amp;quot;:null}}&quot; data-hydro-click-hmac=&quot;16732c85efc46cbb65b89821a7482d4de3392b8cab2f998d4d50a9cfbbb835b5&quot; data-ga-click=&quot;Repository, find file, location:repo overview&quot; data-hotkey=&quot;t&quot; data-pjax=&quot;true&quot; href=&quot;/toutiaoio/HowTos/find/main&quot;&gt;
    Go to file
&lt;/a&gt;



    &lt;span class=&quot;d-none d-md-flex ml-2&quot;&gt;
        
&lt;get-repo&gt;
  &lt;details class=&quot;position-relative details-overlay details-reset&quot; data-action=&quot;toggle:get-repo#onDetailsToggle&quot;&gt;
    &lt;summary class=&quot;btn btn-primary&quot; data-hydro-click=&quot;{&amp;quot;event_type&amp;quot;:&amp;quot;repository.click&amp;quot;,&amp;quot;payload&amp;quot;:{&amp;quot;repository_id&amp;quot;:334011383,&amp;quot;target&amp;quot;:&amp;quot;CLONE_OR_DOWNLOAD_BUTTON&amp;quot;,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/toutiaoio/HowTos?hmsr=toutiao.io&amp;amp;utm_medium=toutiao.io&amp;amp;utm_source=toutiao.io&amp;quot;,&amp;quot;user_id&amp;quot;:null}}&quot; data-hydro-click-hmac=&quot;b69a6d174ee5c881169525f0c5d0e306e72fd1dd07389c2557ce853d2ae2172b&quot;&gt;
      &lt;svg class=&quot;octicon octicon-download mr-1&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.47 10.78a.75.75 0 001.06 0l3.75-3.75a.75.75 0 00-1.06-1.06L8.75 8.44V1.75a.75.75 0 00-1.5 0v6.69L4.78 5.97a.75.75 0 00-1.06 1.06l3.75 3.75zM3.75 13a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5z&quot;/&gt;&lt;/svg&gt;
      Code
      &lt;span class=&quot;dropdown-caret&quot;/&gt;
&lt;/summary&gt;    &lt;div class=&quot;position-relative&quot;&gt;
      &lt;div class=&quot;dropdown-menu dropdown-menu-sw p-0&quot;&gt;
        &lt;div data-target=&quot;get-repo.modal&quot;&gt;
          &lt;div class=&quot;border-bottom p-3&quot;&gt;
            &lt;a class=&quot;muted-link float-right tooltipped tooltipped-s&quot; href=&quot;https://docs.github.com/articles/which-remote-url-should-i-use&quot; target=&quot;_blank&quot; aria-label=&quot;Which remote URL should I use?&quot;&gt;
  &lt;svg class=&quot;octicon octicon-question&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm9 3a1 1 0 11-2 0 1 1 0 012 0zM6.92 6.085c.081-.16.19-.299.34-.398.145-.097.371-.187.74-.187.28 0 .553.087.738.225A.613.613 0 019 6.25c0 .177-.04.264-.077.318a.956.956 0 01-.277.245c-.076.051-.158.1-.258.161l-.007.004a7.728 7.728 0 00-.313.195 2.416 2.416 0 00-.692.661.75.75 0 001.248.832.956.956 0 01.276-.245 6.3 6.3 0 01.26-.16l.006-.004c.093-.057.204-.123.313-.195.222-.149.487-.355.692-.662.214-.32.329-.702.329-1.15 0-.76-.36-1.348-.863-1.725A2.76 2.76 0 008 4c-.631 0-1.155.16-1.572.438-.413.276-.68.638-.849.977a.75.75 0 101.342.67z&quot;/&gt;&lt;/svg&gt;
&lt;/a&gt;



&lt;tab-container&gt;

  

  &lt;div role=&quot;tabpanel&quot;&gt;
    

    &lt;p class=&quot;mt-2 mb-0 f6 text-gray&quot;&gt;
        Use Git or checkout with SVN using the web URL.
    &lt;/p&gt;
  &lt;/div&gt;


  
&lt;/tab-container&gt;

          &lt;/div&gt;
          
        &lt;/div&gt;

        

        

        &lt;div class=&quot;p-3&quot; data-targets=&quot;get-repo.platforms&quot; data-platform=&quot;xcode&quot; hidden=&quot;&quot;&gt;
          &lt;h4 class=&quot;lh-condensed mb-3&quot;&gt;Launching Xcode&lt;span class=&quot;AnimatedEllipsis&quot;/&gt;&lt;/h4&gt;
          &lt;p class=&quot;text-gray&quot;&gt;If nothing happens, &lt;a href=&quot;https://developer.apple.com/xcode/&quot;&gt;download Xcode&lt;/a&gt; and try again.&lt;/p&gt;
          &lt;button type=&quot;button&quot; class=&quot;btn-link&quot; data-action=&quot;click:get-repo#onDetailsToggle&quot;&gt;Go back&lt;/button&gt;
        &lt;/div&gt;

        

      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/details&gt;
&lt;/get-repo&gt;


      
    &lt;/span&gt;
&lt;/div&gt;


      

&lt;div class=&quot;Box mb-3&quot;&gt;
  
  &lt;h2 id=&quot;files&quot; class=&quot;sr-only&quot;&gt;Files&lt;/h2&gt;
  


    &lt;a class=&quot;d-none js-permalink-shortcut&quot; data-hotkey=&quot;y&quot; href=&quot;/toutiaoio/HowTos/tree/80330c161dc062d01b9733a3832819973a69cefd&quot;&gt;Permalink&lt;/a&gt;

  &lt;div class=&quot;include-fragment-error flash flash-error flash-full py-2&quot;&gt;
  &lt;svg class=&quot;octicon octicon-alert&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z&quot;/&gt;&lt;/svg&gt;&lt;p&gt;
  
    Failed to load latest commit information.

&lt;/p&gt;&lt;/div&gt;  &lt;div class=&quot;js-details-container Details&quot;&gt;
    &lt;div role=&quot;grid&quot; aria-labelledby=&quot;files&quot; class=&quot;Details-content--hidden-not-important js-navigation-container js-active-navigation-container d-md-block&quot; data-pjax=&quot;&quot;&gt;
      &lt;div class=&quot;sr-only&quot; role=&quot;row&quot;&gt;
        &lt;p role=&quot;columnheader&quot;&gt;Type&lt;/p&gt;
        &lt;p role=&quot;columnheader&quot;&gt;Name&lt;/p&gt;
        &lt;p role=&quot;columnheader&quot; class=&quot;d-none d-md-block&quot;&gt;Latest commit message&lt;/p&gt;
        &lt;p role=&quot;columnheader&quot;&gt;Commit time&lt;/p&gt;
      &lt;/div&gt;

        
        
        
        
        
        
    &lt;/div&gt;
    &lt;p class=&quot;Details-content--shown Box-footer d-md-none p-0&quot;&gt;
      &lt;button type=&quot;button&quot; class=&quot;d-block btn-link js-details-target width-full px-3 py-2&quot; aria-expanded=&quot;false&quot;&gt;
        View code
      &lt;/button&gt;
    &lt;/p&gt;
  &lt;/div&gt;




&lt;/div&gt;

  &lt;div id=&quot;readme&quot; class=&quot;Box md js-code-block-container Box--responsive&quot;&gt;
    &lt;p class=&quot;Box-header d-flex flex-items-center flex-justify-between bg-white border-bottom-0&quot;&gt;
      &lt;h2 class=&quot;Box-title pr-3&quot;&gt;
        README.md
      &lt;/h2&gt;
    &lt;/p&gt;
      &lt;div class=&quot;Box-body px-5 pb-5&quot;&gt;
        &lt;article class=&quot;markdown-body entry-content container-lg&quot; itemprop=&quot;text&quot;&gt;&lt;h1&gt;&lt;a id=&quot;user-content-how-to-recipes&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#how-to-recipes&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;How-To Recipes&lt;/h1&gt;
&lt;p&gt;面向初学者的实用教程合集，欢迎PR.&lt;/p&gt;
&lt;p&gt;内容通过Github Actions 同步到开发者头条网站的&lt;a href=&quot;https://toutiao.io/subjects/455423&quot; rel=&quot;nofollow&quot;&gt;《HowTos》&lt;/a&gt;独家号&lt;/p&gt;
&lt;h2&gt;&lt;a id=&quot;user-content-links&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#links&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Links&lt;/h2&gt;

&lt;/article&gt;
      &lt;/div&gt;
  &lt;/div&gt;


&lt;/div&gt;
    &lt;div class=&quot;flex-shrink-0 col-12 col-md-3&quot;&gt;
            

      &lt;div class=&quot;BorderGrid BorderGrid--spacious&quot; data-pjax=&quot;&quot;&gt;
        &lt;div class=&quot;BorderGrid-row hide-sm hide-md&quot;&gt;
          &lt;div class=&quot;BorderGrid-cell&quot;&gt;
            &lt;h2 class=&quot;mb-3 h4&quot;&gt;About&lt;/h2&gt;

    &lt;p class=&quot;f4 mt-3&quot;&gt;
      How-To Recipes, 碎片化教程, 开发技巧 
    &lt;/p&gt;

  &lt;h3 class=&quot;sr-only&quot;&gt;Topics&lt;/h3&gt;
  

  &lt;h3 class=&quot;sr-only&quot;&gt;Resources&lt;/h3&gt;
  


          &lt;/div&gt;
        &lt;/div&gt;
          
          
          
      &lt;/div&gt;

&lt;/div&gt;&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

    &lt;/main&gt;
  &lt;/div&gt;

  &lt;/div&gt;

          




  &lt;div id=&quot;ajax-error-message&quot; class=&quot;ajax-error-message flash flash-error&quot; hidden=&quot;&quot;&gt;
    &lt;svg class=&quot;octicon octicon-alert&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z&quot;/&gt;&lt;/svg&gt;
    &lt;button type=&quot;button&quot; class=&quot;flash-close js-ajax-error-dismiss&quot; aria-label=&quot;Dismiss error&quot;&gt;
      &lt;svg class=&quot;octicon octicon-x&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z&quot;/&gt;&lt;/svg&gt;
    &lt;/button&gt;&lt;p&gt;
    You can’t perform that action at this time.
  &lt;/p&gt;&lt;/div&gt;


  &lt;div class=&quot;js-stale-session-flash flash flash-warn flash-banner&quot; hidden=&quot;&quot;&gt;
    &lt;svg class=&quot;octicon octicon-alert&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z&quot;/&gt;&lt;/svg&gt;
    &lt;span class=&quot;js-stale-session-flash-signed-in&quot; hidden=&quot;&quot;&gt;You signed in with another tab or window. &lt;a href=&quot;&quot;&gt;Reload&lt;/a&gt; to refresh your session.&lt;/span&gt;
    &lt;span class=&quot;js-stale-session-flash-signed-out&quot; hidden=&quot;&quot;&gt;You signed out in another tab or window. &lt;a href=&quot;&quot;&gt;Reload&lt;/a&gt; to refresh your session.&lt;/span&gt;
  &lt;/div&gt;
    &lt;template id=&quot;site-details-dialog&quot;&gt;
  &lt;details class=&quot;details-reset details-overlay details-overlay-dark lh-default text-gray-dark hx_rsm&quot; open=&quot;&quot;&gt;
    &lt;summary role=&quot;button&quot; aria-label=&quot;Close dialog&quot;/&gt;
    &lt;details-dialog class=&quot;Box Box--overlay d-flex flex-column anim-fade-in fast hx_rsm-dialog hx_rsm-modal&quot;&gt;
      &lt;button class=&quot;Box-btn-octicon m-0 btn-octicon position-absolute right-0 top-0&quot; type=&quot;button&quot; aria-label=&quot;Close dialog&quot; data-close-dialog=&quot;&quot;&gt;
        &lt;svg class=&quot;octicon octicon-x&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z&quot;/&gt;&lt;/svg&gt;
      &lt;/button&gt;
      &lt;p class=&quot;octocat-spinner my-6 js-details-dialog-spinner&quot;/&gt;
    &lt;/details-dialog&gt;
  &lt;/details&gt;
&lt;/template&gt;

    


  &lt;/body&gt;
&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>a745d25dd21eb02e33e5c5ff35cab60a</guid>
<title>演进式数据架构</title>
<link>https://toutiao.io/k/ck7f43n</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;entry-content&quot; itemprop=&quot;articleBody&quot;&gt;&amp;#13;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/tag/evolutionary-architecture/&quot; title=&quot;演进式架构&quot;&gt;演进式架构&lt;/a&gt;支持跨多个维度的引导性增量变更。 ——《演进式架构》&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这是《演进式架构》这本书第一章第一节对“演进式架构”的作用做出的简洁定义，也就是说演进式架构便是持续架构，因为在架构这件事上没有最终状态，它会随着软件开发体系的不断变化而演进，我们只能将时间和变化作为维度来定义、引导架构的走向。&lt;/p&gt;
&lt;p&gt;《演进式架构》一书对于软件系统架构如何演进给出了相对明确的方向，但是对于数据领域来说，不但目前的基础设施相对落后，连数据系统构建相关的知识体系也异常匮乏，当我们尝试将业务型的软件系统（此处特指事务形的业务系统）架构中的最佳实践硬套到数据领域后，便会发现非常不兼容。&lt;/p&gt;
&lt;p&gt;例如微服务和数据服务天生冲突，&lt;a href=&quot;https://insights.thoughtworks.cn/tag/microservices/&quot; title=&quot;微服务&quot;&gt;微服务&lt;/a&gt;通过多个无状态的服务进行快速切换，以确保业务侧对于系统发生的宕机无感知，而数据服务天生具备的则是分布式多节点计算，并且需要持续较长时间，要求任务具备高可用。DDD与数据建模也同样天生冲突，DDD基于聚合根将多个动作圈定在同一个上下文中，结合云原生可以进行更好的弹性扩展，结合微服务的实现，各个服务独享自有的存储，然而数据建模天生不是为某一个业务服务，而是为某一类或者多类业务服务，因此天生就不具备上下文的概念。&lt;/p&gt;
&lt;p&gt;即便如此，我们依旧在不断探索，在这个领域有哪些更好的方向值得我们去尝试，有哪些更好的经验值得我们去借鉴。本文便是借助于《演进式架构》这本书中关于演进式架构体系的描述，探索我们如何在数据这个领域，设计出演进式数据架构。&lt;/p&gt;
&lt;h3&gt;数据架构的类型&lt;/h3&gt;
&lt;p&gt;大部分场景之下，我们所看到的数据架构，更多是按照企业所处阶段或者业务性质来定义的，例如数据仓库、大数据平台、大数据仓库甚至智能平台。这样的架构定义之间的跨度非常大，甚至不存在“演进”的可能性，几乎就是替换和重做，因此这种数据架构的定义太过于狭义，不太适用于我们去探讨数据架构如何演进。&lt;/p&gt;
&lt;p&gt;让我们重新审视和定义一下数据架构的类型，那么从大的方向来说我们可以将数据架构划分为一体化架构、分布式架构和领域分布式架构，仔细拆开来看是这样的形态：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;单体架构（数据仓库）:&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;复用业务架构: 和业务系统高度耦合，数据架构建立在业务系统之上，和业务系统共用同一个DB。&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;大泥球架构:&lt;/em&gt; 整体没有分层，耦合的架构。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Layered Data Architecture:&lt;/em&gt; 采用了Kimball, Inmon, 星形模型,雪花模型等分层模型的数据架构，更加容易进行改变了创造适应度函数。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Data Vault:&lt;/em&gt; 整体架构进行了模块化的拆封，更加容易解耦，也更加容易进行模块替换。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;分布式数据架构（基于数据湖的架构）:&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;基于存储系统（S3，HDFS）:&lt;/em&gt; 采用分布式存储系统对数据进行存储的数据存储解决方案，数据难以修改。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;基于NoSQL 数据库 (HBase, etc.):&lt;/em&gt; 将数据存储在NoSQL的存储介质中，同时承担存储和分析的职责，高度耦合。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;SQL on Hadoop:&lt;/em&gt; 基于Hadoop的 SQL解决方案，更加容易演进和分层设计。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;实时数据处理架构:&lt;/em&gt; Lambda, Kappa等架构，很容易修改和演进，但是整体复杂度会很高。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;面向域的分布式数据架构（&lt;a href=&quot;https://insights.thoughtworks.cn/distributed-data-platform-data-mesh/&quot; title=&quot;Data Mesh&quot;&gt;Data Mesh&lt;/a&gt;）:&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;数据即服务:&lt;/em&gt; 提供数据端到端开发所需要的工具和服务，架构既承担着工具提供的职责，也负责维护工具产生的数据服务，更像是一个数据的SAAS平台。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;数据平台即服务:&lt;/em&gt; 提供数据PAAS的能力，架构提供更加灵活的能力，允许租户使用自己的工具，也可以使用平台的工具，架构仅仅是基础设施。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;即便是数据仓库，也是有不同的实现，最简单的便是嵌套在业务系统中，没有所谓的物理上的数据仓库的概念，业务系统在生产数据的同时也承担着数据仓库的职责，这种系统相对来说很容易就能抽象演变成独立的数据仓库系统。&lt;/p&gt;
&lt;p&gt;除了内嵌到业务系统之外，也有不少企业选择以构建数仓的形式，为业务系统开启一个备库，然后基于备库进行BI+DB的架构进行分析，也有选择使用ETL，将业务系统拉到自己的DB进行BI+DB进行分析的架构，本质上来讲这种架构都是我们常说的“大泥球”架构，由内嵌系统演进成大泥球架构相对是比较容易的。&lt;/p&gt;
&lt;p&gt;即便是数仓，也是可以进行分层设计的，像在星形模型/雪花模型上建立Cube，基于Cube再提供MDX查询接口，来构建上层的分析呈现系统。这种结构虽然也是在一个端到端的看起来像是大泥球的架构，但是内部实际是进行了分层的架构设计，层次明确，基于不同的模型进行不同业务的抽象设计。&lt;/p&gt;
&lt;p&gt;除了数仓之外，我们可以看到还有基于数据湖的数据架构，而在数据湖架构下，我们也有提供SQL接口，NOSQL接口的数据架构，SQL On Hadoop也是常见的数据湖架构。&lt;/p&gt;
&lt;p&gt;Data Mesh是新型的架构设计，在Data Mesh下我们将数据域化，一种域化形式是闭环服务形式，也就是一个平台提供工具的同时还提供结果管理服务，并且只能在平台内部完成全生命周期的管理，即Data as a Service。另一种形态则是平台提供数据和工具能力，但是工具能力为可选项，业务可以使用自己的工具，也可以使用平台的工具，这个时候便是Data Platform as a Service。&lt;/p&gt;
&lt;h3&gt;增量变更&lt;/h3&gt;
&lt;p&gt;提到增量变更，可能大部分人会想到持续部署、小步提交这种敏捷软件研发的特征，从大的方向来讲我们如果做好了这些，那边整体模型便已经展现出了增量变更的特点。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/1-2.png&quot;&gt;&lt;img src=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/1-2-768x365.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;持续交付的流程图&lt;/p&gt;
&lt;p&gt;但是增量变更并不只是持续部署、小步提交这些操作。持续部署、小步提交、TDD测试覆盖等维度体现的是持续交付，侧重点在于迭代式的交付，核心还是交付，但是增量变更的点是在于变更，并且可以基于小步修改的变更。&lt;/p&gt;
&lt;p&gt;增量变更对于数据领域的架构来说，相对于支撑业务流程的业务系统会稍有不同，虽然大体维度相差无几，但是各自关注的侧重点不同，因此对于数据架构来说，这个维度的变更可以分为：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;开发级别变更：根据业务需求实现一个数据流水线，或者根据业务需要，开发一个数据服务，是否可以快速增加，是否给予了开发者足够的基础服务，尽可能少的减少非业务需求之外的开发。&lt;/li&gt;
&lt;li&gt;部署级别变更：对于某一类业务，需要新增一个组件，或者新增一个数据构建空间，系统是否可以快速对此项快速进行上限部署发布，新实现的流水线是否可以在既定的时间内部署到线上。&lt;/li&gt;
&lt;li&gt;架构级别变更：当业务发生切换或者演进的时候，架构是否足够解耦可以随着业务的需要，不断的进行调整用来快速相应业务的变化。&lt;/li&gt;
&lt;li&gt;流程级别变更：除了业务本身的内容发生变更之外，有时会存在流程与审计所带来的额外的影响，于是系统不得不针对这种非功能性的合规进行快速的整顿以符合流程要求的上下文切换。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;而所有变更所依赖的基准条件都是可测试，例如在开发层面有了测试，才可以通过测试来保障每次提交，构建出的代码在不破坏架构特征（规范）的前提下，对系统进行增量修改， 在程序的构建上采用持续交付/部署流水线，可以很好的在系统执行变更时自动化的执行测试。&lt;/p&gt;
&lt;h3&gt;引导性变更&lt;/h3&gt;
&lt;p&gt;引导性变更，本质也是变更，但是重点是在于引导，也就是说我们得先有对应的引导维度和度量方式，才有变更的基础，和增量变更所不同的是，增量变更指的是可以很容易在现有的系统架构上进行变更，而这个变更不一定具有引导性，例如我们用最小的成本快速变更修改了一个Bug，确实这个变更是增量变更，同时也具备业务价值，因为它实实在在的解决了问题，但是它可能不具备引导性。&lt;/p&gt;
&lt;p&gt;那么我们如何去定义这个引导性呢？关于数据架构应该有哪些度量维度，这个我们放在后面的适应度函数这个环节去讲解，引导性就是在有了度量维度和引导方向后，进行对应方向的变更，引导性变更可以引导相关的变更更加适应业务和技术环境的变化。&lt;/p&gt;
&lt;h3&gt;适应度函数&lt;/h3&gt;
&lt;p&gt;适应度函数这个概念来自于遗传学，如果是站在软件开发这个领域来看，具体的呈现形式就是一个个的度量维度和验证方式，其实现力度有大有小，例如可以是小到单元、E2E测试，甚至是控制代码风格的checkstyle，也可以是大到度量架构的抽象维度，也就是说凡是可以验证架构特征的“功能”都可以称为适应度函数。&lt;/p&gt;
&lt;p&gt;回到我们要解决的领域来看，数据这个领域的特点在于量变引起的质变导致整体端到端的解决方案需要被重新设计，这不得不谈大数据的5V特征：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/2-2.png&quot;&gt;&lt;img src=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/2-2-768x690.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;大数据的5V特点（图片来源网络）&lt;/p&gt;
&lt;p&gt;这里我们不具体展开5V特征以及其代表的方向，但是可以看出在数据领域从业务需求的产生到基础设施的建设都与一般的软件架构设计有着较大的差异。5V代表着我们对大数据业务诉求的定义，同时也代表着需要满足这样要求的系统，应该恪守的维度。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/3-2.png&quot;&gt;&lt;img src=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/3-2-768x315.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;数据架构的适应度函数&lt;/p&gt;
&lt;p&gt;站在可引导和度量架构的视角来看，我们认为数据架构的适应度函数可以由如上图呈现的Data和Data Ops两个维度来构成，每个维度又有不同的权衡指标。&lt;/p&gt;
&lt;p&gt;我们在定义适应度函数的时候，会考虑到以下几个维度：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;数据流水线平均恢复时间&lt;/li&gt;
&lt;li&gt;变更失败比例&lt;/li&gt;
&lt;li&gt;数据质量监控&lt;/li&gt;
&lt;li&gt;部署失败比例&lt;/li&gt;
&lt;li&gt;数据流水线部署频率&lt;/li&gt;
&lt;li&gt;数据血缘&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;每一个维度下，我们需要详细设计具体的测试函数，其中部分可能能够以自动化测试的形式体现，然后固化在平台开发工程之内，部分或许无法自动化，需要使用类似监控报表这种手段进行监控。&lt;/p&gt;
&lt;h3&gt;架构解耦与演进&lt;/h3&gt;
&lt;p&gt;既然数据架构可以分为不同的类型，并且数据架构有着对应的适应度函数进行评估，那么我们可以基于此来探讨数据架构如何进行演进。对于架构来说，既然叫演进，我们自然是希望用最小的变化、最低的成本、最短的时间达到我们预期的效果，要达到这一要求，架构之间的模块做到足够好的解耦对于结果来说是很重要的。&lt;/p&gt;
&lt;p&gt;好在大数据目前来说，还没有一个单一的组件就能够涵盖一切场景，通常是众多组件进行组合，然后利用组件现有的能力以服务化的形式进行集成，而不是像常规软件开发以库的形式进行集成。这样的生态环境天然的带来了解耦架构的便利条件，但是这还远远不够，这最多只算组件之间的解耦。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/4-2.png&quot;&gt;&lt;img src=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/4-2-768x296.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;耦合表到两层架构的演进&lt;/p&gt;
&lt;p&gt;对于将数据分析所需要的数据耦合在业务系统之内，没有区分业务和数据分析这一类系统，我们能很容易的将其演进到两层数据架构，从改造来讲甚至不需要进行代码级别的修改，仅仅通过部署层面就能达到目的。例如直接创建主备的两类数据库，分别部署两套系统支撑不同场景，在后续重构的过程中，再逐步的阉割不需要的功能。&lt;/p&gt;
&lt;p&gt;这种手法的思想和我们在做遗留系统改造的时候如出一辙，那么对于这种系统来说，我们可能用来使用的适应度函数会有：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;数据依赖：数据是否存在交叉引用，是否存在业务和数据之间没有进行分离。&lt;/li&gt;
&lt;li&gt;查询性能：每一次数据的处理请求，是否能够满足业务侧的需要。&lt;/li&gt;
&lt;li&gt;开发周期：新增数据需求的时候，从任务产生到看板到完成之间的时间周期。&lt;/li&gt;
&lt;li&gt;修改频率：在固定的时间内可以支持多少次的变更调整。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这种系统架构之间的演进，通常是一个数据系统最原始的起步的形态，大部分在业务系统不是很复杂，同时数据需求不是很旺盛的时候，这种实现是最为直接和有效的。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/5-1.png&quot;&gt;&lt;img src=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/5-1-768x302.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;两层架构到三层架构的演进&lt;/p&gt;
&lt;p&gt;那么对于已经是两层架构的系统来说，这类系统通常是底层有一个大而全的数据库，此数据库里面存储了业务所需的所有表，但是表并没有经过仔细的设计，表逻辑和业务直接的支撑关系通常被固化在了上层分析的逻辑里面，可能是程序员开发的代码，例如Java，PHP等，也可能是SQL借助于某些BI工具直接实现的。&lt;/p&gt;
&lt;p&gt;这种系统架构即便是今天在新构建系统的时候，依旧会有很多人会做这样的选择，例如直接使用Hive或者Presto作为底层的存储，然后上层提供JDBC的接口做数据分析。对于这类系统来说，也可以稍微做一些改动，就可以让整个架构看起来相比之前，更加的美好了。&lt;/p&gt;
&lt;p&gt;所以我们在两层架构中，新增一个对应的数据模型层，用来将原始数据和业务需要的数据进行解耦，虽然他们最终的实现可能依旧存储在一个组件，甚至可能就是存储在一个数据库中，但是从设计层面我们已经通过约定和协议将他们进行了分离，在未来仅仅是将他们换一个位置而已，这样的改变就会变得很容易。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/6-.png&quot;&gt;&lt;img src=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/6--768x314.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;三层架构到SQL On Hadoop&lt;/p&gt;
&lt;p&gt;对于三层的数据架构来说，我们依旧可以做一些小的调整，例如在当下所支撑的业务场景不发生任何的变化之下，我们将底层的基础设施进行替换，这样的话我们既保留了原来的业务不受影响，同时也获得了更好的额外能力，那么牵引我们做这样改变的适应度函数，除了前面提到的之外，还有新增加的：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;存储成本：之前的存储都是基于事务型的存储介质，拥有较高的存储成本，我们可以使用成本更低的文件系统进行替换。&lt;/li&gt;
&lt;li&gt;数据类型：除了常见的关系型的数据结构外，还能支持更多的类型，例如文本，图片。&lt;/li&gt;
&lt;li&gt;非架构化数据的比例：之前的架构不是不能处理非结构化，而是成本相对较高，因此非结构化数据的比例不能太大，如今我们可以处理更大比例的非结构化数据。&lt;/li&gt;
&lt;li&gt;ETL的成本：更加快速的支持更多的ETL程序进行运行。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;也就是说在良好的三层架构之下，我们仅仅是进行一个基础设施的调整，就能够获得非常好的效果，而这些效果来自于我们设计的适应度函数的牵引。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/7-1.png&quot;&gt;&lt;img src=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/7-1-768x290.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;数据湖到数据服务架构的演进&lt;/p&gt;
&lt;p&gt;让我们继续往下看，三层架构所支撑的本质上还是一个分析型的数据平台，并没有提供直接的业务服务，那么如果在“提供简单的数据服务给业务侧进行消费”这样的适应度函数的牵引下，我们就需要思考对系统进行怎样的改造，可以满足这样的诉求。&lt;/p&gt;
&lt;p&gt;于是我们发现在原始的数据存储架构知识之外，我们需要新实现一个数据服务，用来提供支撑业务运作需要的实体，这个实体是直接发送到业务侧，并不是提供给分析所需，甚至需要构建一套用来支撑数据发布的服务。&lt;/p&gt;
&lt;p&gt;但是这样的改进并不会对原始的架构产生较大的影响，而是在原来的体系下很快的扩展了新的能力，并且复用了之前的架构已经存在的基本的数据底层的能力。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/8-1.png&quot;&gt;&lt;img src=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/8-1-768x364.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;数据服务架构到多租户的演进&lt;/p&gt;
&lt;p&gt;业务总会进行发展，既然存在业务侧的数据消费者，那么总会变成这样：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;我们需要支撑更多的数据消费者。&lt;/li&gt;
&lt;li&gt;我们需要支撑更多的领域数据产品。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;也就是是这个时候，数据以产品，或者产品服务的形式提供给外部进行消费，在这个平台里面：Data As A Service，平台除了提供数据外还需要提供对应的数据分析能力，这样就成了一个类似于数据的SAAS平台，更好的称呼叫DAAS。&lt;/p&gt;
&lt;p&gt;从架构来说，我们需要提供多类工具，也是之前的扩展，同时需要新构建支撑不同业务的统一数据入口门户，用来整合数据平台下的多种能力，这就是数据服务层的扩展，目前类似数据中台的思想，便是这样的一套解决方案。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/9-1.png&quot;&gt;&lt;img src=&quot;https://insights.thoughtworks.cn/wp-content/uploads/2021/01/9-1-768x311.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;数据多租户服务到数据网格架构的演进&lt;/p&gt;
&lt;p&gt;光有SaaS还不足以满足业务的需求，在快速相应和足够的灵活度的牵引下，我们总需要给予数据使用者足够大的想象空间，于是系统便会成为提供一个数据开发环境，或者提供一个数据工作空间的基础设施。&lt;/p&gt;
&lt;p&gt;对于这样的演进来讲，牵引我们的不外乎是“多租户”、“多工具支撑”、“业务快速定制自己的数据服务”。因此我们需要将数据平台底层更基础的组件以服务的形式暴露出去，同时需要给每一个数据消费者初始化一个用来支撑对方进行数据消费的环境，于是前面的整个平台就成了一个租户的工作空间，我们需要不断copy多个类似这样的平台服务，也就是平台是PaaS。&lt;/p&gt;
&lt;p&gt;而不同的租户直接的数据，有一个合理的流通机制可以进行共享和消费，每一个业务方有自己的工作空间和消费组件，目前大家提到的类似于Data Mesh的数据开发和协作形式就是这样的工作思想。&lt;/p&gt;
&lt;p&gt;在这样的设计下，每一个业务线，或者一个业务域，可以独立拥有自己的工作空间和工具，也就是可以使用平台提供的工具，也可以自行使用自己的工具，和平台之间是非常解耦的结构，仅仅存在数据之间的交互和传输即可。&lt;/p&gt;
&lt;h3&gt;结尾&lt;/h3&gt;
&lt;p&gt;经过前面的总结和梳理可以发现，我们在做演进式架构的时候，并不是需要启动一项庞大的改造工程，对现有的系统进行大面积的重构或者重写。而是要围绕这个系统呈现出的一些特征，和我们整理出的对业务有价值的适应度函数，进行小步的修改，这个小步可能都不需要修改代码，仅仅是流程和部署的改变，但是我们总是在做调整和改变，每一天整体的架构都相比之前更好，这样这个系统就会逐步的处于一个可以快速演进的状态，记住演进式数据架构的中心点：外部引导变得更好，内部优化，不要更差。&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;&lt;strong&gt;更多精彩洞见，请关注微信公众号：ThoughtWorks洞见&lt;/strong&gt;&lt;/p&gt;
&amp;#13;
&lt;/div&gt;&amp;#13;
&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>