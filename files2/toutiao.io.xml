<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>492648e91b5b0f73105be2abc7dbcc42</guid>
<title>2022 å¹´å‡èŒåŠ è–ªå°±é å®ƒäº†ï¼æŠ“ç´§æ—¶é—´ï¼</title>
<link>https://toutiao.io/k/fitvcz1</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;profile_inner&quot;&gt;
                              &lt;strong class=&quot;profile_nickname&quot;&gt;å¼€å‘è€…å¤´æ¡&lt;/strong&gt;
                              &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;/&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;Weixin ID&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;kaifazhetoutiao&lt;/span&gt;
                              &lt;/p&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;About Feature&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;ç¨‹åºå‘˜åˆ†äº«å¹³å° | å®˜æ–¹åº”ç”¨ä¸‹è½½åœ°å€ï¼šhttp://toutiao.io/download&lt;/span&gt;
                              &lt;/p&gt;
                              
                          &lt;/div&gt;
                          &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>bc30ec71cff02337f98b8aaaa1011dc0</guid>
<title>æ·±åº¦åˆ†é¡µï¼Œæˆ‘éƒ½æ˜¯è¿™ä¹ˆç©çš„</title>
<link>https://toutiao.io/k/p61u81q</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;weui-dialog&quot;&gt;
      &lt;p class=&quot;weui-dialog__hd&quot;&gt;&lt;strong class=&quot;weui-dialog__title&quot;&gt;&quot;Top Stories&quot; is disabled&lt;/strong&gt;&lt;/p&gt;
      &lt;p class=&quot;weui-dialog__bd&quot;&gt;
        Enable &quot;Top Stories&quot; in &quot;Settings&quot; &amp;gt; &quot;General&quot; &amp;gt; &quot;Manage Discover&quot;      &lt;/p&gt;
      
    &lt;/div&gt;
  &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>d265d35077231d4586b6820fd4ef7611</guid>
<title>2022 å¹´è¦è€ƒè™‘çš„ 7 ç§ Docker æ›¿ä»£æ–¹æ¡ˆ</title>
<link>https://toutiao.io/k/ywk73n5</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.15625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/YriaiaJPb26VN5koUu22VNrAnuXDfGLRs8w4tRT63wErRVia5ic9J4ZyzWLDwcKT1Ldrzibn8lWIAnCQmkMCAVEtuIg/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;640&quot;/&gt;&lt;/p&gt;&lt;section&gt;ä½œè€… | Sudip Sengupta&lt;/section&gt;&lt;section&gt;
è¯‘è€… | è¾›æ™“äº®&lt;/section&gt;&lt;p&gt;è®¸å¤šä¼ä¸šéƒ½é‡‡ç”¨å®¹å™¨æ¥è¿›è¡Œå¼€å‘å’Œç®¡ç†ç¨³å®šçš„åº”ç”¨ç¨‹åºï¼ŒDocker æ˜¯è¯¥é¢†åŸŸåŠŸèƒ½æœ€ä¸°å¯Œä¸”ä½¿ç”¨æœ€å¹¿æ³›çš„å·¥å…·ä¹‹ä¸€ï¼Œå·²æœ‰æ•°ç™¾ä¸‡åº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨å®ƒã€‚Docker æœ¬èº«æœ‰ç€å¼ºå¤§çš„ç‹¬ç«‹ç”Ÿæ€ç³»ç»Ÿï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå¹¿æ³›çš„å·¥å…·åŒ…æ¥ç®¡ç†å®¹å™¨åŒ–è¿‡ç¨‹ï¼Œä½† Docker è¿˜æœ‰å…¶ä»–æ›¿ä»£å“ï¼Œå®ƒä»¬æä¾›äº†ç‹¬ç‰¹çš„ç”¨ä¾‹å’ŒåŠŸèƒ½ã€‚æœ¬æ–‡æ·±å…¥æ¢è®¨äº† Docker ä¸ƒä¸ªæ›¿ä»£å“ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ç³»åˆ—ç»¼åˆå¹³å°ï¼Œå¦‚ Docker ä»¥åŠå¯ä»¥ä½œä¸º Docker ç”Ÿæ€ç³»ç»Ÿç»„ä»¶æ›¿ä»£å“çš„å·¥å…·ç­‰ã€‚&lt;/p&gt;&lt;section&gt;
&lt;span&gt;Podman&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2852852852852853&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VPdOhe0afO6YmFOckTwrr17v7vcib7WiaCFZA3GyyNEGfb7vuNsDSIqF2GeqZKovvBRsCDRibyomDqQw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1332&quot;/&gt;&lt;/p&gt;&lt;p&gt;Podman æ˜¯ RedHat å¼€å‘çš„ä¸€ä¸ªæ— å®ˆæŠ¤ç¨‹åºçš„å¼€æº Linux åŸç”Ÿå®¹å™¨å¼•æ“ï¼Œç”¨äºæ„å»ºã€è¿è¡Œå’Œç®¡ç† Linux OCI å®¹å™¨ä¸å®¹å™¨é•œåƒã€‚å°½ç®¡ Podman æä¾›äº†ä¸€ä¸ªç±»ä¼¼äº Docker çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œä½†å®ƒçš„æ“ä½œæ–¹å¼å¹¶ä¸ç›¸åŒã€‚&lt;/p&gt;&lt;p&gt;Docker å’Œ Podman ä¹‹é—´çš„ä¸€ä¸ªæ˜¾è‘—åŒºåˆ«æ˜¯ï¼ŒDocker è¿è¡Œä¸€ä¸ªæŒä¹…çš„ã€è‡ªç»™è‡ªè¶³çš„è¿è¡Œæ—¶æ¥ç®¡ç†å…¶å¯¹è±¡æˆ–ç§°ä¸º dockerd çš„å®ˆæŠ¤è¿›ç¨‹ï¼›è€Œ Podman å¹¶ä¸ä¾èµ–å®ˆæŠ¤è¿›ç¨‹æ¥å·¥ä½œï¼Œç›¸åï¼ŒPodman å°†å®¹å™¨ä½œä¸ºå­è¿›ç¨‹å¯åŠ¨ï¼Œå®ƒè¿˜ç›´æ¥ä¸æ³¨å†Œè¡¨å’Œä½¿ç”¨è¿è¡Œæ—¶è¿›ç¨‹çš„ Linux å†…æ ¸è¿›è¡Œäº¤äº’ï¼Œä¹Ÿæ­£å› å¦‚æ­¤ï¼ŒPodman è¢«ç§°ä¸ºæ— å®ˆæŠ¤è¿›ç¨‹çš„å®¹å™¨æŠ€æœ¯ã€‚&lt;/p&gt;&lt;p&gt;æ²¡æœ‰å®ˆæŠ¤è¿›ç¨‹æé«˜äº† Podman ä½œä¸ºå®¹å™¨å¼•æ“çš„çµæ´»æ€§ï¼Œæ¶ˆé™¤äº†å¯¹å•ä¸ªè¿›ç¨‹çš„ä¾èµ–ã€‚Podman ä¸ Docker çš„å¦ä¸€å¤§ä¸åŒå°±æ˜¯å®ƒä¸éœ€è¦ root æƒé™ã€‚è¿™ä¸€ç‰¹ç‚¹æä¾›äº†ä¸€ä¸ªé¢å¤–çš„å®‰å…¨ç¼“å†²åŒºï¼Œé™åˆ¶äº†æŸäº›å¯èƒ½æ“çºµå…³é”®ç³»ç»Ÿè®¾ç½®å¹¶ä½¿å®¹å™¨å’ŒåŒ…å«çš„åº”ç”¨ç¨‹åºæ˜“å—æ”»å‡»çš„æ½œåœ¨å±é™©è¿›ç¨‹ã€‚&lt;/p&gt;&lt;p&gt;æ­¤å¤–ï¼ŒPodman å¯ä»¥è¿è¡Œ pod-- åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„é›†åˆï¼Œä½œä¸ºä¸€ä¸ªå•ä¸€å®ä½“ç®¡ç†ï¼Œå¹¶åˆ©ç”¨å…±äº«çš„èµ„æºæ± ã€‚é€šè¿‡è¿™é¡¹èƒ½åŠ›ï¼ŒPodman ç”¨æˆ·å¯ä»¥å°†ä»–ä»¬çš„å·¥ä½œè´Ÿè½½è½¬ç§»åˆ° Kubernetesã€‚&lt;/p&gt;&lt;section&gt;
&lt;span&gt;LÂ  XÂ  D&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.34294385432473445&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VPdOhe0afO6YmFOckTwrr17ygsk3jCfFca9MTzgDHXTCIU5dGx6KwPNz0GwGEzm4wFF5uALsjxIrg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1318&quot;/&gt;&lt;/p&gt;&lt;p&gt;LXD ä¸€ä¸ªä¸“ä¸º LXC Linux å®¹å™¨è®¾è®¡çš„å¼€æºå®¹å™¨å¼•æ“ã€‚LXC ä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨éš”ç¦»çš„å®¹å™¨æˆ–ç±»ä¼¼äºè™šæ‹Ÿæœºçš„è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€æ‰¿æ‹…ç®¡ç†å•ä¸ªå†…æ ¸çš„æŠ€æœ¯è´Ÿæ‹…ã€‚LXD æä¾›äº†ä¸€ä¸ªç”¨äºè¿æ¥ LXC è½¯ä»¶åº“çš„æ¥å£ï¼ŒåŒæ—¶åˆ›å»ºäº†ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£å¤„ç†ç½‘ç»œã€æ•°æ®å­˜å‚¨å’Œç®¡ç†å¤šä¸ª LXC å®¹å™¨ã€‚å°½ç®¡ LXC å¯ä»¥ä½œä¸ºç‹¬ç«‹å·¥å…·è¿è¡Œï¼Œä½†å®ƒæ‹¥æœ‰æœ‰é™çš„åŠŸèƒ½å­é›†ã€‚LXD æä¾›äº†è¿™äº›é™„åŠ åŠŸèƒ½ï¼Œå› æ­¤ä¾èµ–äº LXC å·¥ä½œã€‚&lt;/p&gt;&lt;p&gt;LXD ä¸ Docker çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ã€‚ä¸ Docker å»ºè®®æ¯ä¸ªå®¹å™¨åªæœ‰å•ä¸ªè¿›ç¨‹çš„è®¾è®¡æ¨¡å¼ä¸åŒï¼ŒLXC/LXD ä¸­çš„å®¹å™¨å¯ä»¥è¿è¡Œå¤šä¸ªè¿›ç¨‹ã€‚æ­¤å¤–ï¼ŒDocker å®¹å™¨å¯ç§»æ¤æ€§æ›´å¼ºï¼Œä¸ºä¸ LXD ç›¸æ¯”ï¼ŒDocker æœ‰æ•ˆåœ°æŠ½è±¡äº†èµ„æºã€‚æœ€åï¼ŒDocker æ”¯æŒåœ¨ Windows å’Œ macOS ç¯å¢ƒä¸Šè¿è¡Œï¼Œä½† LXD åªæ”¯æŒ Linuxã€‚&lt;/p&gt;&lt;section&gt;
&lt;span&gt;containerd&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3249444855662472&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VPdOhe0afO6YmFOckTwrr17TiaFWSIfjhzEYEW6Pk4M4etCCh8I9B3sEcL0mLo8x5AniayEAMtVmbOQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1351&quot;/&gt;&lt;/p&gt;&lt;p&gt;containerd æ˜¯ä¸€ä¸ªé«˜çº§å®¹å™¨è¿è¡Œæ—¶ï¼Œå®ƒé€šè¿‡åœ¨åº•å±‚è¿è¡Œ runc ä»¥æä¾›æ“ä½œç³»ç»Ÿå’Œå®¹å™¨å¼•æ“ä¹‹é—´çš„æ¥å£ã€‚runc æ˜¯ä¸€ä¸ªæ”¯æŒ Windows å’Œ Linux çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒæŠ½è±¡äº†ç‰¹å®šäºæ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ï¼Œä½¿è¿è¡Œå’Œç›‘ç£å®¹å™¨ä»¥åŠç®¡ç†å›¾åƒä¼ è¾“å’Œå­˜å‚¨å˜å¾—æ›´åŠ å®¹æ˜“ã€‚&lt;/p&gt;&lt;p&gt;containerd æä¾›çš„è¿™ç§æŠ½è±¡çº§åˆ«åŠŸèƒ½æ¶ˆé™¤äº†è¿›è¡Œè‹¥å¹²ä½çº§ç³»ç»Ÿè°ƒç”¨çš„å¤æ‚æ€§ï¼Œä½¿å¾—å®¹å™¨çš„å¯ç§»æ¤æ€§å¾—ä»¥å®ç°ã€‚ç„¶è€Œï¼Œä¸ Docker ä¸åŒï¼Œcontainerd ä¸å¤„ç†é•œåƒçš„æ„å»ºæˆ–å·çš„åˆ›å»ºã€‚æœ‰è¶£çš„æ˜¯ï¼Œcontainerd æ˜¯ Docker çš„é»˜è®¤è¿è¡Œæ—¶ï¼Œç°åœ¨å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·ï¼Œå°±åƒ runc ä¸€æ ·ã€‚è¿™ä¹Ÿä½¿å¾— containerd åƒ Kubernetes ä¸€æ ·æˆä¸ºä¸€ä¸ªæ–¹ä¾¿çš„ç¼–æ’å·¥å…·ï¼Œcontainerd ä¹Ÿæ˜¯æœ€å—æ¬¢è¿çš„ Docker æ›¿ä»£å“ä¹‹ä¸€ã€‚&lt;/p&gt;&lt;section&gt;
&lt;span&gt;Buildah&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2906875543951262&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VPdOhe0afO6YmFOckTwrr17ZcY4FuiauOUibQicmxfyEy78iaeJq9rHIefza085fsHJy4I3eaZp5XYBpQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1149&quot;/&gt;&lt;/p&gt;&lt;p&gt;Buildah æ˜¯çº¢å¸½åŸºé‡‘ä¼šä¸ºå®¹å™¨åŒ–ç³»ç»Ÿå¼€å‘çš„ä¸€ä¸ª OCI é•œåƒæ„å»ºå·¥å…·ã€‚å®ƒæ˜¯ä¸€ä¸ªæä¾›ç±»ä¼¼äºåœ¨ Docker ä¸­è¿è¡Œ &lt;code&gt;docker build&lt;/code&gt; çš„åŠŸèƒ½çš„å·¥å…·ã€‚Buildah ç»å¸¸ä¸ Podman ä¸€èµ·ä½¿ç”¨ï¼Œäº’ä½œè¡¥å……ï¼Œä¾‹å¦‚ï¼ŒPodman åœ¨åå°ä½¿ç”¨ Buildah åŠŸèƒ½çš„å­é›†æ¥å®ç°å…¶æ„å»ºè¿‡ç¨‹ã€‚&lt;/p&gt;&lt;p&gt;å®ƒå¯ä»¥ä» Dockerfile æˆ– Containerfile ä¸­æ„å»ºé•œåƒï¼Œå¹¶ç”Ÿæˆä¸ä½¿ç”¨ Docker åˆ›å»ºçš„é•œåƒç›¸åŒçš„é•œåƒï¼Œå› ä¸ºè¿™äº›é•œåƒæ˜¯ç¬¦åˆ OCI çš„ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æä¾›äº†å¯¹é•œåƒå±‚çš„ç»†ç²’åº¦æ§åˆ¶ï¼Œå…è®¸åœ¨ä¸€ä¸ªå•ä¸€å±‚ä¸­è¿›è¡Œå¤šæ¬¡ä¿®æ”¹æäº¤ã€‚å®ƒè¿˜æä¾›äº†ä»å¤´å¼€å§‹æ„å»ºé•œåƒçš„èƒ½åŠ›ï¼Œå³ä¸åŒ…å«ä»»ä½•å†…å®¹çš„é•œåƒï¼Œè¿™è®©ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°åªæ·»åŠ è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚æœ€åï¼Œä¸ Docker ä¸åŒçš„æ˜¯ï¼Œåœ¨ Buildah ä¸­ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°ä»–ä»¬æ„å»ºçš„é•œåƒã€‚&lt;/p&gt;&lt;section&gt;
&lt;span&gt;BuildKit&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2831230283911672&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VPdOhe0afO6YmFOckTwrr17cyEvAcrCF9Uu7qQxbcicbBxRgu3mf5tO0hFK7qjV4246pJG24Uk6PicQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1268&quot;/&gt;&lt;/p&gt;&lt;p&gt;BuildKit æ˜¯ç¬¬äºŒä»£æ„å»ºé•œåƒçš„ Moby é¡¹ç›®ï¼Œåœ¨è¾ƒæ–°çš„ Docker ç‰ˆæœ¬ä¸­ä½œä¸ºå®éªŒæ€§åŠŸèƒ½æä¾›ã€‚&lt;span&gt;ä¸ Do&lt;/span&gt;&lt;span&gt;cker ä¸€æ ·ï¼Œå®ƒä½¿ç”¨å®ˆæŠ¤ç¨‹åº&lt;/span&gt;è¿è¡Œã€‚ä¸è¿‡ï¼Œæ ‡å‡† Docker æ„å»ºå’Œ BuildKit ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ä¹‹ä¸€æ˜¯ï¼Œå‰è€…æ˜¯é€å±‚æ„å»ºï¼Œåè€…æä¾›å¹¶è¡Œæ„å»ºå¤„ç†ã€‚è¿™ä¸ªåŠŸèƒ½æé«˜äº†æ€§èƒ½ï¼Œä½¿æ„å»ºé€Ÿåº¦æ›´å¿«ã€‚BuildKit è¿˜å…è®¸è·³è¿‡æœªä½¿ç”¨çš„é˜¶æ®µï¼Œæ”¹å–„å¢é‡æ„å»ºï¼Œå¹¶å…è®¸æ— æ ¹æ„å»ºã€‚æ­¤å¤–ï¼ŒBuildKit ä½¿ç”¨ä¸€ä¸ªç¼“å­˜æ¥å‡å°‘é‡å»ºå›¾åƒæ¯ä¸€å±‚çš„éœ€è¦ã€‚&lt;/p&gt;&lt;section&gt;
&lt;span&gt;Kaniko&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3467297084318361&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VPdOhe0afO6YmFOckTwrr17oDFlibicibMlDxGwy9MnM3QVwZiaBcuhKdrMNFNzAK4fdUc0N5m7ZTXjKQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1269&quot;/&gt;&lt;/p&gt;&lt;p&gt;Kaniko æ˜¯ä¸€ä¸ªè°·æ­Œé•œåƒæ„å»ºå·¥å…·ï¼Œå®ƒå¯ä»¥ä» Dockerfile æ„å»ºé•œåƒã€‚å®ƒå’Œ Buildah ä¸€æ ·æ˜¯æ— å®ˆæŠ¤è¿›ç¨‹çš„ï¼Œä½†æ›´ä¾§é‡äºåœ¨ Kubernetes ä¸­æ„å»ºé•œåƒã€‚Kaniko å¯¹äºæœ¬åœ°å¼€å‘å®ä¾‹æ¥è¯´ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå®ƒé€šå¸¸ä½œä¸ºé•œåƒä¸ Kubernetes ç­‰å®¹å™¨ç¼–æ’å™¨ä¸€èµ·è¿è¡Œã€‚å¯¹äº Kubernetes é›†ç¾¤ä¸­çš„æŒç»­é›†æˆå’Œäº¤ä»˜ç®¡é“ï¼ŒKaniko å¯ä»¥æˆä¸ºä¸€ä¸ªå®ç”¨çš„å·¥å…·ã€‚&lt;/p&gt;&lt;section&gt;
&lt;span&gt;RunC&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3230437903804738&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/YriaiaJPb26VPdOhe0afO6YmFOckTwrr17FAXBYfic6Y7wwhYfHTAMrY5HE72EoggsRuXmnrmGQz1AOP3TZiajOOmA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1393&quot;/&gt;&lt;/p&gt;&lt;p&gt;RunC ä»¥å‰æ˜¯åµŒå…¥åˆ° Docker æ¶æ„ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œåœ¨ 2015 å¹´ä½œä¸ºç‹¬ç«‹å·¥å…·å‘å¸ƒã€‚æ­¤åï¼Œå®ƒæˆä¸ºä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ã€æ ‡å‡†åŒ–çš„ã€å¯äº’æ“ä½œçš„å®¹å™¨è¿è¡Œæ—¶ã€‚DevOps å›¢é˜Ÿå¯ä»¥å°†å…¶ä½œä¸º Docker æˆ–å…¶ä»–å®šåˆ¶å®¹å™¨å¼•æ“çš„ä¸€éƒ¨åˆ†ã€‚RunC å±äºå®¹å™¨åŒ–ç”Ÿæ€ç³»ç»Ÿä¸­çš„å®¹å™¨è¿è¡Œæ—¶éƒ¨åˆ†ã€‚å®¹å™¨è¿è¡Œæ—¶æ˜¯å¤„ç†å®¹å™¨è¿è¡Œçš„å®¹å™¨å¼•æ“ä¸­ä½¿ç”¨çš„è¾ƒä½çº§åˆ«çš„ç»„ä»¶ã€‚&lt;/p&gt;&lt;p&gt;å°½ç®¡ Docker ä¸ºç»„ç»‡åœ¨å®¹å™¨åŒ–è¿‡ç¨‹ä¸­æ‰€éœ€çš„å„ä¸ªæ–¹é¢æä¾›äº†ä¸€ä¸ªå…¨é¢çš„å·¥å…·åŒ…ï¼Œä½†æŸäº› DevOps åŠŸèƒ½å¯èƒ½éœ€è¦æ¢ç´¢å…¶ä»–æ›¿ä»£æ–¹æ¡ˆã€‚ä½†æ˜¯ï¼Œåœ¨é€‰æ‹©ä»»ä½•æ­¤ç±»é€‰é¡¹æ—¶ä¹Ÿéœ€ç‰¢è®°æ­¤ç±»æ›¿ä»£æ–¹æ¡ˆæ‰€è¿è¡Œçš„ä¸»æœºæ“ä½œç³»ç»ŸåŠå…¶ä½¿ç”¨æƒ…å†µã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;åŸæ–‡é“¾æ¥ï¼š&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;https://www.containiq.com/post/docker-alternatives&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;ç‚¹å‡»åº•éƒ¨&lt;/span&gt;&lt;span&gt;é˜…è¯»åŸæ–‡&lt;/span&gt;&lt;span&gt;è®¿é—® InfoQ å®˜ç½‘ï¼Œè·å–æ›´å¤šç²¾å½©å†…å®¹ï¼&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span photoshow-hd-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/YriaiaJPb26VNPrPHVrV124MK6fhrWJSGLwiapMkaCSpJichgaCz6JzXr413C6xfEjiasT96KgRdhjRP3CHnaEHQe7A/&quot;&gt;ä»Šæ—¥å¥½æ–‡æ¨è&lt;/span&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&amp;amp;mid=2651106089&amp;amp;idx=1&amp;amp;sn=4eb1903a395a9544767d5383bd4cfbff&amp;amp;chksm=bdb9537a8aceda6c96a107d348b5e954fb2107f89870b67a6c50f557c7969029f21b4240aa2d&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;75%æ–°é¡¹ç›®éƒ½å¯ä»¥â€œæ— è„‘â€é€‰æ‹©å•ä½“æ¶æ„&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;75%æ–°é¡¹ç›®éƒ½å¯ä»¥â€œæ— è„‘â€é€‰æ‹©å•ä½“æ¶æ„&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&amp;amp;mid=2651105854&amp;amp;idx=1&amp;amp;sn=346fc790136616fc3e088acc8bf0f950&amp;amp;chksm=bdb9526d8acedb7bff88e236e17002102f92918bb3245796020239927cfa21ce5bd341caad6a&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;InfoQ æœ€æ–° Java å‘å±•è¶‹åŠ¿æŠ¥å‘Š&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;InfoQ æœ€æ–° Java å‘å±•è¶‹åŠ¿æŠ¥å‘Š&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&amp;amp;mid=2651105779&amp;amp;idx=1&amp;amp;sn=9d06a049aa0429b3eb56c6af73305bb0&amp;amp;chksm=bdb951a08aced8b68c97d4d0ed16bdeee3128bd0e081b173b2c35e955c7c09e737af191c2694&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;AlphaCodeç¼–ç¨‹æ¯”èµ›å‡»è´¥ä¸€åŠç¨‹åºå‘˜ï¼›å¾®ä¿¡è¶…1äº¿äººè§†é¢‘å·çœ‹æ˜¥æ™šï¼Œ6.6äº¿äººæŠ¢çº¢åŒ…ï¼›Flutter 2.10å‘å¸ƒ ï½œ Qèµ„è®¯&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;AlphaCodeç¼–ç¨‹æ¯”èµ›å‡»è´¥ä¸€åŠç¨‹åºå‘˜ï¼›å¾®ä¿¡è¶…1äº¿äººè§†é¢‘å·çœ‹æ˜¥æ™šï¼Œ6.6äº¿äººæŠ¢çº¢åŒ…ï¼›Flutter 2.10å‘å¸ƒ ï½œ Qèµ„è®¯&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&amp;amp;mid=2651105739&amp;amp;idx=1&amp;amp;sn=0c9a1d1a5b45c7a5a5c6779cb3f2a232&amp;amp;chksm=bdb951988aced88e599f05b2cb023a267e074a033cfb395d5742b5dbd7c5fd08ae924bd5df32&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;è¿™åä¸ªäº‹ä»¶ï¼Œè®©â€œæ°¸ä¸å®•æœºâ€å˜æˆäº†ä¸€ä¸ªç¬‘è¯&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;è¿™åä¸ªäº‹ä»¶ï¼Œè®©â€œæ°¸ä¸å®•æœºâ€å˜æˆäº†ä¸€ä¸ªç¬‘è¯&lt;/a&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img __bg_gif&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.1515625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/YriaiaJPb26VNBX66P2F9dF2yuYfbcibGMuaBYgvK62MGPE9HhgU2vptFAUZdaO2cGKCsP4h1DnibIGywKSkFv9b6g/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;640&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;ç‚¹ä¸ªåœ¨çœ‹å°‘ä¸ª bug&lt;/span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;span&gt;ğŸ‘‡&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>ff9faba0786646f10ee2bc7a294c11e8</guid>
<title>ä½¿ç”¨ Cilium å¢å¼º Kubernetes ç½‘ç»œå®‰å…¨</title>
<link>https://toutiao.io/k/37vv9md</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;TL;DR&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨æœ¬ç¯‡ï¼Œæˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨äº† Kubernetes åŸç”Ÿçš„ç½‘ç»œç­–ç•¥å’Œ Cilium çš„ç½‘ç»œç­–ç•¥å®ç°äº† Pod ç½‘ç»œå±‚é¢çš„éš”ç¦»ã€‚ä¸åŒçš„æ˜¯ï¼Œå‰è€…åªæä¾›äº†åŸºäº L3/4 çš„ç½‘ç»œç­–ç•¥ï¼›åè€…æ”¯æŒ L3/4ã€L7 çš„ç½‘ç»œç­–ç•¥ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é€šè¿‡ç½‘ç»œç­–ç•¥æ¥æå‡ç½‘ç»œå®‰å…¨ï¼Œå¯ä»¥æå¤§é™ä½äº†å®ç°å’Œç»´æŠ¤çš„æˆæœ¬ï¼ŒåŒæ—¶å¯¹ç³»ç»Ÿå‡ ä¹æ²¡æœ‰å½±å“ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å°¤å…¶æ˜¯åŸºäº eBPF æŠ€æœ¯çš„ Ciliumï¼Œè§£å†³äº†å†…æ ¸æ‰©å±•æ€§ä¸è¶³çš„é—®é¢˜ï¼Œä»å†…æ ¸å±‚é¢ä¸ºå·¥ä½œè´Ÿè½½æä¾›å®‰å…¨å¯é ã€å¯è§‚æµ‹çš„ç½‘ç»œè¿æ¥ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;èƒŒæ™¯&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ºä»€ä¹ˆè¯´ Kubernetes ç½‘ç»œå­˜åœ¨å®‰å…¨éšæ‚£ï¼Ÿé›†ç¾¤ä¸­çš„ Pod é»˜è®¤æ˜¯æœªéš”ç¦»çš„ï¼Œä¹Ÿå°±æ˜¯ Pod ä¹‹é—´çš„ç½‘ç»œæ˜¯äº’é€šçš„ï¼Œå¯ä»¥äº’ç›¸é€šä¿¡çš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™é‡Œå°±ä¼šæœ‰é—®é¢˜ï¼Œæ¯”å¦‚ç”±äºæ•°æ®æ•æ„ŸæœåŠ¡ B åªå…è®¸ç‰¹å®šçš„æœåŠ¡ A æ‰èƒ½è®¿é—®ï¼Œè€ŒæœåŠ¡ C æ— æ³•è®¿é—® Bã€‚è¦ç¦æ­¢æœåŠ¡ C å¯¹æœåŠ¡ B çš„è®¿é—®ï¼Œå¯ä»¥æœ‰å‡ ç§æ–¹æ¡ˆï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;åœ¨ SDK ä¸­æä¾›é€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå®ç°ç™½åå•çš„åŠŸèƒ½ã€‚é¦–å…ˆè¯·æ±‚è¦å¸¦æœ‰æ¥æºçš„æ ‡è¯†ï¼Œç„¶åæœåŠ¡ç«¯å¯ä»¥æ¥æ”¶è§„åˆ™è®¾ç½®æ”¾è¡Œç‰¹å®šæ ‡è¯†çš„è¯·æ±‚ï¼Œæ‹’ç»å…¶ä»–çš„è¯·æ±‚ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;äº‘åŸç”Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨æœåŠ¡ç½‘æ ¼çš„ RBACã€mTLS åŠŸèƒ½ã€‚RBAC å®ç°åŸç†ä¸åº”ç”¨å±‚çš„ SDK æ–¹æ¡ˆç±»ä¼¼ï¼Œä½†æ˜¯å±äºåŸºç¡€è®¾æ–½å±‚çš„æŠ½è±¡é€šç”¨æ–¹æ¡ˆï¼›mTLS åˆ™ä¼šæ›´åŠ å¤æ‚ä¸€äº›ï¼Œåœ¨è¿æ¥æ¡æ‰‹é˜¶æ®µè¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ¶‰åŠè¯ä¹¦çš„ç­¾å‘ã€éªŒè¯ç­‰æ“ä½œã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»¥ä¸Šä¸¤ç§æ–¹æ¡ˆå„æœ‰åˆ©å¼Šï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;SDK çš„æ–¹æ¡ˆå®ç°ç®€å•ï¼Œä½†æ˜¯è§„æ¨¡è¾ƒå¤§çš„ç³»ç»Ÿä¼šé¢ä¸´å‡çº§æ¨å¹¿å›°éš¾ã€å¤šè¯­è¨€æ”¯æŒæˆæœ¬é«˜ç­‰é—®é¢˜ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æœåŠ¡ç½‘æ ¼çš„æ–¹æ¡ˆæ˜¯åŸºç¡€è®¾æ–½å±‚çš„é€šç”¨æ–¹æ¡ˆï¼Œå¤©ç”Ÿæ”¯æŒå¤šè¯­è¨€ã€‚ä½†æ˜¯å¯¹äºæœªè½åœ°ç½‘æ ¼çš„ç”¨æˆ·æ¥è¯´ï¼Œæ¶æ„å˜åŒ–å¤§ï¼Œæˆæœ¬é«˜ã€‚å¦‚æœå•çº¯ä¸ºäº†è§£å†³å®‰å…¨é—®é¢˜ï¼Œä½¿ç”¨ç½‘æ ¼æ–¹æ¡ˆæ€§ä»·æ¯”åˆå¾ˆä½ï¼Œä¸”ä¸è¯´ç°æœ‰ç½‘æ ¼å®ç°ç­‰è½åœ°éš¾åº¦å¤§åŠåæœŸçš„ä½¿ç”¨ç»´æŠ¤æˆæœ¬é«˜ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç»§ç»­å‘åŸºç¡€è®¾æ–½ä¸‹å±‚æ‰¾æ–¹æ¡ˆï¼Œä»ç½‘ç»œå±‚å…¥æ‰‹ã€‚Kubernetes æä¾›äº†çš„&lt;span&gt;ç½‘ç»œç­–ç•¥ *NetworkPolicy*&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;ï¼Œåˆ™å¯ä»¥å®ç°â€œç½‘ç»œå±‚é¢çš„éš”ç¦»â€ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;ç¤ºä¾‹åº”ç”¨&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨è¿›ä¸€æ­¥æ¼”ç¤ºÂ &lt;span&gt;NetworkPolicy&lt;/span&gt;Â çš„æ–¹æ¡ˆä¹‹å‰ï¼Œå…ˆä»‹ç»ç”¨äºæ¼”ç¤ºçš„ç¤ºä¾‹åº”ç”¨ã€‚æˆ‘ä»¬ä½¿ç”¨ Cilium åœ¨äº’åŠ¨æ•™ç¨‹Â &lt;span&gt;Cilium getting started&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt;Â ä¸­ä½¿ç”¨çš„â€œæ˜Ÿçƒå¤§æˆ˜â€åœºæ™¯ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™é‡Œæœ‰ä¸‰ä¸ªåº”ç”¨ï¼Œæ˜Ÿæˆ˜è¿·ä¼°è®¡ä¸ä¼šé™Œç”Ÿï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;æ­»æ˜ŸÂ &lt;span&gt;deathstar&lt;/span&gt;ï¼šåœ¨Â &lt;code&gt;80&lt;/code&gt;Â ç«¯å£æä¾› web æœåŠ¡ï¼Œæœ‰ 2 ä¸ª å‰¯æœ¬ï¼Œé€šè¿‡ Kubernetes Service çš„è´Ÿè½½å‡è¡¡ä¸º&lt;strong&gt;å¸å›½æˆ˜æœº&lt;/strong&gt;å¯¹å¤–æä¾›â€ç™»é™†â€œæœåŠ¡ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;é’›æˆ˜æœºÂ &lt;span&gt;tiefighter&lt;/span&gt;ï¼šæ‰§è¡Œç™»é™†è¯·æ±‚ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Xç¿¼æˆ˜æœºÂ &lt;span&gt;xwing&lt;/span&gt;ï¼šæ‰§è¡Œç™»é™†è¯·æ±‚ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8492520138089759&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMghG0NOfxec2EkzdFcUSgwicz701f6VwrdfgPyCkOhzewcaKVHRnc5Dt6P1uDb5C63kgFcEQsXC8kjbmYDFpsw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;869&quot;/&gt;&lt;/figure&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Â &lt;span&gt;Label&lt;/span&gt;Â å¯¹ä¸‰ä¸ªåº”ç”¨è¿›è¡Œäº†æ ‡è¯†ï¼š&lt;code&gt;org&lt;/code&gt;Â å’ŒÂ &lt;code&gt;class&lt;/code&gt;ã€‚åœ¨æ‰§è¡Œç½‘ç»œç­–ç•¥æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªæ ‡ç­¾è¯†åˆ«è´Ÿè½½ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;#Â app.yaml&lt;/span&gt;&lt;br/&gt;&lt;span&gt;---&lt;/span&gt;&lt;br/&gt;&lt;span&gt;apiVersion:&lt;/span&gt;Â &lt;span&gt;v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind:&lt;/span&gt;Â &lt;span&gt;Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;labels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;app.kubernetes.io/name:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;type:&lt;/span&gt;Â &lt;span&gt;ClusterIP&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;ports:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;port:&lt;/span&gt;Â &lt;span&gt;80&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;selector:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;class:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;&lt;span&gt;---&lt;/span&gt;&lt;br/&gt;&lt;span&gt;apiVersion:&lt;/span&gt;Â &lt;span&gt;apps/v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind:&lt;/span&gt;Â &lt;span&gt;Deployment&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;labels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;app.kubernetes.io/name:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;replicas:&lt;/span&gt;Â &lt;span&gt;2&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;selector:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;matchLabels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;class:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;template:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;labels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;class:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;app.kubernetes.io/name:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;containers:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;image:&lt;/span&gt;Â &lt;span&gt;docker.io/cilium/starwars&lt;/span&gt;&lt;br/&gt;&lt;span&gt;---&lt;/span&gt;&lt;br/&gt;&lt;span&gt;apiVersion:&lt;/span&gt;Â &lt;span&gt;v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind:&lt;/span&gt;Â &lt;span&gt;Pod&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;tiefighter&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;labels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;class:&lt;/span&gt;Â &lt;span&gt;tiefighter&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;app.kubernetes.io/name:&lt;/span&gt;Â &lt;span&gt;tiefighter&lt;/span&gt;&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;containers:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;spaceship&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;image:&lt;/span&gt;Â &lt;span&gt;docker.io/tgraf/netperf&lt;/span&gt;&lt;br/&gt;&lt;span&gt;---&lt;/span&gt;&lt;br/&gt;&lt;span&gt;apiVersion:&lt;/span&gt;Â &lt;span&gt;v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind:&lt;/span&gt;Â &lt;span&gt;Pod&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;xwing&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;labels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;app.kubernetes.io/name:&lt;/span&gt;Â &lt;span&gt;xwing&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;alliance&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;class:&lt;/span&gt;Â &lt;span&gt;xwing&lt;/span&gt;&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;containers:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;spaceship&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;image:&lt;/span&gt;Â &lt;span&gt;docker.io/tgraf/netperf&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;Kubernetes ç½‘ç»œç­–ç•¥&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯ä»¥é€šè¿‡&lt;span&gt;å®˜æ–¹æ–‡æ¡£&lt;/span&gt;&lt;sup&gt;[3]&lt;/sup&gt;è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æ”¾å‡ºé…ç½®ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;#Â native/networkpolicy.yaml&lt;/span&gt;&lt;br/&gt;&lt;span&gt;apiVersion:&lt;/span&gt;Â &lt;span&gt;networking.k8s.io/v1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind:&lt;/span&gt;Â &lt;span&gt;NetworkPolicy&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;policy&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;namespace:&lt;/span&gt;Â &lt;span&gt;default&lt;/span&gt;&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;podSelector:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;matchLabels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;class:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;policyTypes:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;Ingress&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;ingress:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;from:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;podSelector:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;matchLabels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;ports:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;protocol:&lt;/span&gt;Â &lt;span&gt;TCP&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;port:&lt;/span&gt;Â &lt;span&gt;80&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;podSelector&lt;/code&gt;Â ï¼šè¡¨ç¤ºè¦åº”ç”¨ç½‘ç»œç­–ç•¥çš„å·¥ä½œè´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡Â &lt;span&gt;label&lt;/span&gt;Â é€‰æ‹©åˆ°äº†Â &lt;span&gt;deathstar&lt;/span&gt;Â çš„ 2 ä¸ª Podã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;policyTypes&lt;/code&gt;Â ï¼šè¡¨ç¤ºæµé‡çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯Â &lt;code&gt;Ingress&lt;/code&gt;Â æˆ–Â &lt;code&gt;Egress&lt;/code&gt;Â æˆ–ä¸¤è€…å…¼å…·ã€‚è¿™é‡Œä½¿ç”¨Â &lt;code&gt;Ingress&lt;/code&gt;ï¼Œè¡¨ç¤ºå¯¹é€‰æ‹©çš„Â &lt;span&gt;deathstar&lt;/span&gt;Â Pod çš„å…¥ç«™æµé‡æ‰§è¡Œè§„åˆ™ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;ingress.from&lt;/code&gt;ï¼šè¡¨ç¤ºæµé‡çš„æ¥æºå·¥ä½œè´Ÿè½½ï¼Œä¹Ÿæ˜¯ä½¿ç”¨Â &lt;code&gt;podSelector&lt;/code&gt;Â å’ŒÂ &lt;span&gt;Label&lt;/span&gt;Â è¿›è¡Œé€‰æ‹©ï¼Œè¿™é‡Œé€‰ä¸­äº†Â &lt;code&gt;org=empire&lt;/code&gt;Â ä¹Ÿå°±æ˜¯æ‰€æœ‰â€œå¸å›½çš„æˆ˜æœºâ€ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;ingress.ports&lt;/code&gt;ï¼šè¡¨ç¤ºæµé‡çš„è¿›å…¥ç«¯å£ï¼Œè¿™é‡Œåˆ—å‡ºäº†Â &lt;span&gt;deathstar&lt;/span&gt;Â çš„æœåŠ¡ç«¯å£ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æµ‹è¯•ä¸‹ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æµ‹è¯•&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…ˆå‡†å¤‡ç¯å¢ƒï¼Œæˆ‘ä»¬ä½¿ç”¨Â &lt;span&gt;K3s&lt;/span&gt;&lt;sup&gt;[4]&lt;/sup&gt;Â ä½œä¸º Kubernetes ç¯å¢ƒã€‚ä½†ç”±äº K3s é»˜è®¤çš„ CNI æ’ä»¶ Flannel ä¸æ”¯æŒç½‘ç»œç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦æ¢ä¸ªæ’ä»¶ï¼Œè¿™é‡Œé€‰æ‹©Â &lt;span&gt;Calico&lt;/span&gt;&lt;sup&gt;[5]&lt;/sup&gt;ï¼Œå³ K3s + Calico çš„æ–¹æ¡ˆã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…ˆåˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹çš„é›†ç¾¤ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;curlÂ -sfLÂ https://get.k3s.ioÂ |Â K3S_KUBECONFIG_MODE=&quot;644&quot;Â INSTALL_K3S_EXEC=&quot;--flannel-backend=noneÂ --cluster-cidr=10.42.0.0/16Â --disable-network-policyÂ --disable=traefik&quot;Â shÂ -&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ­¤æ—¶ï¼Œæ‰€æœ‰çš„ Pod éƒ½å¤„äºÂ &lt;code&gt;Pending&lt;/code&gt;Â çŠ¶æ€ï¼Œå› ä¸ºè¿˜éœ€è¦å®‰è£… Calicoï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ applyÂ -fÂ https://projectcalico.docs.tigera.io/manifests/calico.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¾… Calico æˆåŠŸè¿è¡Œåï¼Œæ‰€æœ‰çš„ Pod ä¹Ÿä¼šæˆåŠŸè¿è¡Œã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¥ä¸‹æ¥å°±æ˜¯éƒ¨ç½²åº”ç”¨ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ applyÂ -fÂ app.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;æ‰§è¡Œç­–ç•¥å‰&lt;/strong&gt;ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤çœ‹çœ‹â€œæˆ˜æœºèƒ½å¦ç™»é™†æ­»æ˜Ÿâ€ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ execÂ tiefighterÂ --Â curlÂ -sÂ -XPOSTÂ deathstar.default.svc.cluster.local/v1/request-landing&lt;br/&gt;ShipÂ landed&lt;br/&gt;&lt;br/&gt;kubectlÂ execÂ xwingÂ --Â curlÂ -sÂ -XPOSTÂ deathstar.default.svc.cluster.local/v1/request-landing&lt;br/&gt;ShipÂ landed&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»ç»“æœæ¥çœ‹ï¼Œä¸¤ç§ â€æˆ˜æœºâ€œï¼ˆPod è´Ÿè½½ï¼‰éƒ½å¯ä»¥è®¿é—®Â &lt;span&gt;deathstar&lt;/span&gt;Â æœåŠ¡ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8471264367816091&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMghG0NOfxec2EkzdFcUSgwicz701f6VwqzJotZtZoiaFoXD2okXDQNjxT4nyMxbDPC10k1LjFf46Hk37mIxZojA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;870&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ­¤æ—¶æ‰§è¡Œç½‘ç»œç­–ç•¥ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ applyÂ -fÂ native/networkpolicy.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å†æ¬¡å°è¯•â€ç™»é™†â€œï¼Œ&lt;span&gt;xwing&lt;/span&gt;Â çš„ç™»é™†è¯·æ±‚ä¼šåœåœ¨é‚£ï¼ˆéœ€è¦ä½¿ç”¨Â &lt;span&gt;ctrl+c&lt;/span&gt;Â é€€å‡ºï¼Œæˆ–è€…è¯·æ±‚æ—¶åŠ ä¸ŠÂ &lt;code&gt;--connect-timeout 2&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8471264367816091&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMghG0NOfxec2EkzdFcUSgwicz701f6VwgX2zaJQdclCx58FbCtDrHlicbeksxpTUz8ay5Rib653BTmUSOziaDrdmg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;870&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ€è€ƒ&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½¿ç”¨ Kubernetes ç½‘ç»œç­–ç•¥å®ç°äº†æˆ‘ä»¬æƒ³è¦çš„ï¼Œä»ç½‘ç»œå±‚é¢ä¸ºæœåŠ¡å¢åŠ äº†ç™½åå•çš„åŠŸèƒ½ï¼Œè¿™ç§æ–¹æ¡ˆæ²¡æœ‰æ”¹é€ æˆæœ¬ï¼Œå¯¹ç³»ç»Ÿä¹Ÿå‡ ä¹æ— å½±å“ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Cilium è¿˜æ²¡å‡ºåœºå°±ç»“æŸäº†ï¼Ÿæˆ‘ä»¬ç»§ç»­çœ‹ï¼š&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰æ—¶æˆ‘ä»¬çš„æœåŠ¡ä¼šå¯¹å¤–æš´éœ²ä¸€äº›ç®¡ç†ç«¯ç‚¹ï¼Œç”±ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œä¸€äº›ç®¡ç†ä¸Šçš„æ“ä½œï¼Œæ¯”å¦‚çƒ­æ›´æ–°ã€é‡å¯ç­‰ã€‚è¿™äº›ç«¯ç‚¹æ˜¯ä¸å…è®¸æ™®é€šæœåŠ¡æ¥è°ƒç”¨ï¼Œå¦åˆ™ä¼šé€ æˆä¸¥é‡çš„åæœã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯”å¦‚ç¤ºä¾‹ä¸­ï¼Œ&lt;span&gt;tiefighter&lt;/span&gt;Â è®¿é—®äº†Â &lt;span&gt;deathstar&lt;/span&gt;Â çš„ç®¡ç†ç«¯ç‚¹Â &lt;code&gt;/exhaust-port&lt;/code&gt;ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ execÂ tiefighterÂ --Â curlÂ -sÂ -XPUTÂ deathstar.default.svc.cluster.local/v1/exhaust-port&lt;br/&gt;Panic:Â deathstarÂ exploded&lt;br/&gt;&lt;br/&gt;goroutineÂ 1Â [running]:&lt;br/&gt;main.HandleGarbage(0x2080c3f50,Â 0x2,Â 0x4,Â 0x425c0,Â 0x5,Â 0xa)&lt;br/&gt;Â Â Â Â Â Â Â Â /code/src/github.com/empire/deathstar/&lt;br/&gt;Â Â Â Â Â Â Â Â temp/main.go:9Â +0x64&lt;br/&gt;main.main()&lt;br/&gt;Â Â Â Â Â Â Â Â /code/src/github.com/empire/deathstar/&lt;br/&gt;Â Â Â Â Â Â Â Â temp/main.go:5Â +0x85&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‡ºç°äº†Â &lt;span&gt;Panic&lt;/span&gt;Â é”™è¯¯ï¼Œæ£€æŸ¥ Pod ä½ ä¼šå‘ç°Â &lt;span&gt;dealthstar&lt;/span&gt;Â æŒ‚äº†ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;Kubernetes çš„ç½‘ç»œç­–ç•¥ä»…èƒ½å·¥ä½œåœ¨ L3/4 å±‚ï¼Œå¯¹ L7 å±‚å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿˜æ˜¯è¦è¯·å‡º Ciliumã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;Cilium ç½‘ç»œç­–ç•¥&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;ç”±äº Cilium æ¶‰åŠäº† Linux å†…æ ¸ã€ç½‘ç»œç­‰ä¼—å¤šçŸ¥è¯†ç‚¹ï¼Œè¦è®²æ¸…å®ç°åŸç†ç¯‡å¹…æå¤§ã€‚æ•…è¿™é‡Œä»…æ‘˜å–äº†å®˜ç½‘çš„ä»‹ç»ï¼ŒåæœŸå¸Œæœ›æœ‰æ—¶é—´å†å†™ä¸€ç¯‡å…³äºå®ç°çš„ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Cilium ç®€ä»‹&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;&lt;span&gt;Cilium&lt;/span&gt;&lt;sup&gt;[6]&lt;/sup&gt;Â æ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶ï¼Œç”¨äºæä¾›ã€ä¿æŠ¤å’Œè§‚å¯Ÿå®¹å™¨å·¥ä½œè´Ÿè½½ï¼ˆäº‘åŸç”Ÿï¼‰ä¹‹é—´çš„ç½‘ç»œè¿æ¥ï¼Œç”±é©å‘½æ€§çš„å†…æ ¸æŠ€æœ¯Â &lt;span&gt;eBPF&lt;/span&gt;&lt;sup&gt;[7]&lt;/sup&gt;Â æ¨åŠ¨ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;eBPF æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;Linux å†…æ ¸ä¸€ç›´æ˜¯å®ç°ç›‘æ§/å¯è§‚æµ‹æ€§ã€ç½‘ç»œå’Œå®‰å…¨åŠŸèƒ½çš„ç†æƒ³åœ°æ–¹ã€‚ä¸è¿‡å¾ˆå¤šæƒ…å†µä¸‹è¿™å¹¶éæ˜“äº‹ï¼Œå› ä¸ºè¿™äº›å·¥ä½œéœ€è¦ä¿®æ”¹å†…æ ¸æºç æˆ–åŠ è½½å†…æ ¸æ¨¡å—ï¼Œ æœ€ç»ˆå®ç°å½¢å¼æ˜¯åœ¨å·²æœ‰çš„å±‚å±‚æŠ½è±¡ä¹‹ä¸Šå åŠ æ–°çš„æŠ½è±¡ã€‚eBPF æ˜¯ä¸€é¡¹é©å‘½æ€§æŠ€æœ¯ï¼Œå®ƒèƒ½åœ¨å†…æ ¸ä¸­è¿è¡Œæ²™ç®±ç¨‹åºï¼ˆsandbox programsï¼‰ï¼Œ è€Œæ— éœ€ä¿®æ”¹å†…æ ¸æºç æˆ–è€…åŠ è½½å†…æ ¸æ¨¡å—ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;å°† Linux å†…æ ¸å˜æˆå¯ç¼–ç¨‹ä¹‹åï¼Œå°±èƒ½åŸºäºç°æœ‰çš„ï¼ˆè€Œéå¢åŠ æ–°çš„ï¼‰æŠ½è±¡å±‚æ¥æ‰“é€ æ›´åŠ æ™ºèƒ½ã€ åŠŸèƒ½æ›´åŠ ä¸°å¯Œçš„åŸºç¡€è®¾æ–½è½¯ä»¶ï¼Œè€Œä¸ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œä¹Ÿä¸ä¼šç‰ºç‰²æ‰§è¡Œæ•ˆç‡å’Œå®‰å…¨æ€§ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5268214571657326&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/tMghG0NOfxec2EkzdFcUSgwicz701f6VwwicXHKudjS0cAQPc1HUdqITaAicZ1HIfPHZBnPZh7Ya0FrEfGe92YbxA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1249&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬æ¥çœ‹ä¸‹ Cilium çš„ç½‘ç»œç­–ç•¥ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;#Â cilium/networkpolicy-L4.yaml&lt;/span&gt;&lt;br/&gt;&lt;span&gt;apiVersion:&lt;/span&gt;Â &lt;span&gt;&quot;cilium.io/v2&quot;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind:&lt;/span&gt;Â &lt;span&gt;CiliumNetworkPolicy&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;&quot;rule1&quot;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;description:&lt;/span&gt;Â &lt;span&gt;&quot;L7Â policyÂ toÂ restrictÂ accessÂ toÂ specificÂ HTTPÂ call&quot;&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;endpointSelector:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;matchLabels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;class:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;ingress:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;fromEndpoints:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;matchLabels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;toPorts:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;ports:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;port:&lt;/span&gt;Â &lt;span&gt;&quot;80&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;protocol:&lt;/span&gt;Â &lt;span&gt;TCP&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ Kubernetes çš„åŸç”Ÿç½‘ç»œç­–ç•¥å·®å¼‚ä¸å¤§ï¼Œå‚è€ƒå‰é¢çš„ä»‹ç»ä¹Ÿéƒ½çœ‹æ‡‚ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥æµ‹è¯•ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æµ‹è¯•&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç”±äº Cilium æœ¬èº«å°±å®ç°äº† CNIï¼Œæ‰€ä»¥ä¹‹å‰çš„é›†ç¾¤å°±ä¸èƒ½ç”¨äº†ï¼Œå…ˆå¸è½½é›†ç¾¤ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;k3s-uninstall.sh&lt;br/&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;Â ï¼ï¼ï¼åˆ‡è®°è¦æ¸…ç†ä¹‹å‰çš„ cni æ’ä»¶&lt;/span&gt;&lt;br/&gt;sudoÂ rmÂ -rfÂ /etc/cni/net.d&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿˜æ˜¯ä½¿ç”¨åŒæ ·çš„å‘½ä»¤åˆ›å»ºå•èŠ‚ç‚¹çš„é›†ç¾¤ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;curlÂ -sfLÂ https://get.k3s.ioÂ |Â K3S_KUBECONFIG_MODE=&quot;644&quot;Â INSTALL_K3S_EXEC=&quot;--flannel-backend=noneÂ --cluster-cidr=10.42.0.0/16Â --disable-network-policyÂ --disable=traefik&quot;Â shÂ -&lt;br/&gt;&lt;span&gt;&lt;br/&gt;#&lt;/span&gt;&lt;span&gt;Â ciliumÂ ä¼šä½¿ç”¨è¯¥å˜é‡&lt;/span&gt;&lt;br/&gt;exportÂ KUBECONFIG=/etc/rancher/k3s/k3s.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¥ä¸‹æ¥å®‰è£… Cilium CLIï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;curlÂ -LÂ --remote-name-allÂ https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz{,.sha256sum}&lt;br/&gt;sha256sumÂ --checkÂ cilium-linux-amd64.tar.gz.sha256sum&lt;br/&gt;sudoÂ tarÂ xzvfCÂ cilium-linux-amd64.tar.gzÂ /usr/local/bin&lt;br/&gt;rmÂ cilium-linux-amd64.tar.gz{,.sha256sum}&lt;br/&gt;&lt;br/&gt;ciliumÂ version&lt;br/&gt;cilium-cli:Â v0.10.2Â compiledÂ withÂ go1.17.6Â onÂ linux/amd64&lt;br/&gt;ciliumÂ imageÂ (default):Â v1.11.1&lt;br/&gt;ciliumÂ imageÂ (stable):Â v1.11.1&lt;br/&gt;ciliumÂ imageÂ (running):Â unknown.Â UnableÂ toÂ obtainÂ ciliumÂ version,Â noÂ ciliumÂ podsÂ foundÂ inÂ namespaceÂ &quot;kube-system&quot;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å®‰è£… Cilium åˆ°é›†ç¾¤ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;ciliumÂ install&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¾… Cilium æˆåŠŸè¿è¡Œï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;ciliumÂ status&lt;br/&gt;Â Â Â Â /Â¯Â¯\&lt;br/&gt;Â /Â¯Â¯\__/Â¯Â¯\Â Â Â Â Cilium:Â Â Â Â Â Â Â Â Â OK&lt;br/&gt;Â \__/Â¯Â¯\__/Â Â Â Â Operator:Â Â Â Â Â Â Â OK&lt;br/&gt;Â /Â¯Â¯\__/Â¯Â¯\Â Â Â Â Hubble:Â Â Â Â Â Â Â Â Â disabled&lt;br/&gt;Â \__/Â¯Â¯\__/Â Â Â Â ClusterMesh:Â Â Â Â disabled&lt;br/&gt;Â Â Â Â \__/&lt;br/&gt;&lt;br/&gt;DeploymentÂ Â Â Â Â Â Â Â cilium-operatorÂ Â Â Â Desired:Â 1,Â Ready:Â 1/1,Â Available:Â 1/1&lt;br/&gt;DaemonSetÂ Â Â Â Â Â Â Â Â ciliumÂ Â Â Â Â Â Â Â Â Â Â Â Â Desired:Â 1,Â Ready:Â 1/1,Â Available:Â 1/1&lt;br/&gt;Containers:Â Â Â Â Â Â Â ciliumÂ Â Â Â Â Â Â Â Â Â Â Â Â Running:Â 1&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â cilium-operatorÂ Â Â Â Running:Â 1&lt;br/&gt;ClusterÂ Pods:Â Â Â Â Â 3/3Â managedÂ byÂ Cilium&lt;br/&gt;ImageÂ versionsÂ Â Â Â cilium-operatorÂ Â Â Â quay.io/cilium/operator-generic:v1.11.1@sha256:977240a4783c7be821e215ead515da3093a10f4a7baea9f803511a2c2b44a235:Â 1&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ciliumÂ Â Â Â Â Â Â Â Â Â Â Â Â quay.io/cilium/cilium:v1.11.1@sha256:251ff274acf22fd2067b29a31e9fda94253d2961c061577203621583d7e85bd2:Â 1&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;éƒ¨ç½²åº”ç”¨ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ applyÂ -fÂ app.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¾…åº”ç”¨å¯åŠ¨åæµ‹è¯•æœåŠ¡è°ƒç”¨ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ execÂ tiefighterÂ --Â curlÂ -sÂ -XPOSTÂ deathstar.default.svc.cluster.local/v1/request-landing&lt;br/&gt;ShipÂ landed&lt;br/&gt;kubectlÂ execÂ xwingÂ --Â curlÂ -sÂ -XPOSTÂ deathstar.default.svc.cluster.local/v1/request-landing&lt;br/&gt;ShipÂ landed&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ‰§è¡Œ L4 ç½‘ç»œç­–ç•¥ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ applyÂ -fÂ cilium/networkpolicy-L4.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å†æ¬¡å°è¯•â€œç™»é™†â€æ­»æ˜Ÿï¼Œ&lt;span&gt;xwing&lt;/span&gt;Â æˆ˜æœºåŒæ ·æ— æ³•ç™»é™†ï¼Œè¯´æ˜ L4 å±‚çš„è§„åˆ™ç”Ÿæ•ˆã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬å†å°è¯• L7 å±‚çš„è§„åˆ™ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;#Â cilium/networkpolicy-L7.yaml&lt;/span&gt;&lt;br/&gt;&lt;span&gt;apiVersion:&lt;/span&gt;Â &lt;span&gt;&quot;cilium.io/v2&quot;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;kind:&lt;/span&gt;Â &lt;span&gt;CiliumNetworkPolicy&lt;/span&gt;&lt;br/&gt;&lt;span&gt;metadata:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;name:&lt;/span&gt;Â &lt;span&gt;&quot;rule1&quot;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;spec:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;description:&lt;/span&gt;Â &lt;span&gt;&quot;L7Â policyÂ toÂ restrictÂ accessÂ toÂ specificÂ HTTPÂ call&quot;&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;endpointSelector:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;matchLabels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;class:&lt;/span&gt;Â &lt;span&gt;deathstar&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;ingress:&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;fromEndpoints:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;matchLabels:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;org:&lt;/span&gt;Â &lt;span&gt;empire&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;toPorts:&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;ports:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;port:&lt;/span&gt;Â &lt;span&gt;&quot;80&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;protocol:&lt;/span&gt;Â &lt;span&gt;TCP&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;rules:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;http:&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;-&lt;/span&gt;Â &lt;span&gt;method:&lt;/span&gt;Â &lt;span&gt;&quot;POST&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â &lt;span&gt;path:&lt;/span&gt;Â &lt;span&gt;&quot;/v1/request-landing&quot;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ‰§è¡Œè§„åˆ™ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ applyÂ -fÂ cilium/networkpolicy-L7.yaml&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™å›ï¼Œä½¿ç”¨Â &lt;span&gt;tiefighter&lt;/span&gt;Â è°ƒç”¨æ­»æ˜Ÿçš„ç®¡ç†æ¥å£ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;kubectlÂ execÂ tiefighterÂ --Â curlÂ -sÂ -XPUTÂ deathstar.default.svc.cluster.local/v1/exhaust-port&lt;br/&gt;AccessÂ denied&lt;br/&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;Â ç™»é™†æ¥å£å·¥ä½œæ­£å¸¸&lt;/span&gt;&lt;br/&gt;kubectlÂ execÂ tiefighterÂ --Â curlÂ -sÂ -XPOSTÂ deathstar.default.svc.cluster.local/v1/request-landing&lt;br/&gt;ShipÂ landed&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™å›è¿”å›äº†Â &lt;span&gt;Access denied&lt;/span&gt;ï¼Œè¯´æ˜ L7 å±‚çš„è§„åˆ™ç”Ÿæ•ˆäº†ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.841324200913242&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/tMghG0NOfxec2EkzdFcUSgwicz701f6Vwy7ZqS9rAAZq5YMFlIHl2FTzcnbicXqa0B4dlIf8AfGjuQNp5JKGNonw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;876&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;å‚è€ƒèµ„æ–™&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;[1]Â &lt;/span&gt;&lt;p&gt;ç½‘ç»œç­–ç•¥Â &lt;span&gt;NetworkPolicy&lt;/span&gt;:Â &lt;span&gt;https://kubernetes.io/zh/docs/concepts/services-networking/network-policies/&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2]Â &lt;/span&gt;&lt;p&gt;Cilium getting started:Â &lt;span&gt;https://play.instruqt.com/isovalent/tracks/cilium-getting-started&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[3]Â &lt;/span&gt;&lt;p&gt;å®˜æ–¹æ–‡æ¡£:Â &lt;span&gt;https://kubernetes.io/zh/docs/concepts/services-networking/network-policies/&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[4]Â &lt;/span&gt;&lt;p&gt;K3s:Â &lt;span&gt;https://k3s.io&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[5]Â &lt;/span&gt;&lt;p&gt;Calico:Â &lt;span&gt;https://www.tigera.io/project-calico/&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[6]Â &lt;/span&gt;&lt;p&gt;Cilium:Â &lt;span&gt;https://cilium.io&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[7]Â &lt;/span&gt;&lt;p&gt;eBPF:Â &lt;span&gt;https://ebpf.io&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>70a71e80623d556d153bc42fd415d4bc</guid>
<title>500è¡Œä»£ç äº†è§£ç¼“å­˜å®¢æˆ·ç«¯é©±åŠ¨åŸç†</title>
<link>https://toutiao.io/k/ac0zoxq</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;åŸåˆ›ä¸æ˜“ï¼Œæ±‚åˆ†äº«ã€æ±‚ä¸€é”®ä¸‰è¿&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¼“å­˜ä¸€èˆ¬æ˜¯ç”¨æ¥åŠ é€Ÿæ•°æ®è®¿é—®çš„æ•ˆç‡ï¼Œåœ¨è·å–æ•°æ®è€—æ—¶é«˜çš„åœºæ™¯ä¸‹ä½¿ç”¨ç¼“å­˜å¯ä»¥æœ‰æ•ˆçš„æé«˜æ•°æ®è·å–çš„æ•ˆç‡ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯”å¦‚ï¼Œå…ˆä»memcachedä¸­è·å–æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™æŸ¥è¯¢mysqlä¸­çš„æ•°æ®å¾—åˆ°ç»“æœå†™å…¥åˆ°memcachedä¸­ç„¶åè¿”å›ï¼Œä¸‹æ¬¡è¯·æ±‚å°±èƒ½å¤Ÿä»memcachedä¸­è·å–æ•°æ®ç›´æ¥è¿”å›ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.1181102362204725&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdfjlwvwuTBicwZP34Pk8kpgiaaAicEh9yPy4ntGyw8l8icNKISicZicxic8NJAOGwR4h7EIFsxV9ehapjlohnBStYj7w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1016&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨è¡Œä¸šä¸­ä½¿ç”¨æ¯”è¾ƒå¤šçš„ç¼“å­˜æ•°æ®åº“æœ‰Rediså’ŒMemcachedã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»Šå¤©ç”¨goå®ç°Memcachedçš„é©±åŠ¨ç¨‹åºï¼Œæ·±å…¥äº†è§£Memcachedå’Œå’±ä»¬å¹³æ—¶æ‰€å†™çš„ä¸šåŠ¡ä»£ç å¦‚ä½•è¿›è¡Œæ•°æ®äº¤äº’çš„åè®®å’ŒåŸç†ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ä»€ä¹ˆæ˜¯memcached&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Memcachedæ˜¯LiveJournalæ——ä¸‹Danga Interactiveå…¬å¸çš„Brad Fitzpatricä¸ºé¦–å¼€å‘çš„ä¸€æ¬¾è‡ªç”±å¼€æºã€é«˜æ€§èƒ½çš„key-valueç¼“å­˜æ•°æ®åº“è½¯ä»¶ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;Mecachedåè®®&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;MecachedæœåŠ¡å’Œåº”ç”¨ç¨‹åºæ˜¯ä¸åŒæœºå™¨ä¸åŒçš„è¿›ç¨‹ï¼ŒåŒæ–¹è¿›è¡Œæ•°æ®äº¤äº’é€šè®¯æ¶‰åŠåˆ°tcpå’Œé€šè®¯åè®®ï¼Œåœ¨memcacheä¸­åè®®æœ‰ä¸¤ç§ç±»å‹ä¸€ç§æ˜¯æ–‡æœ¬è¡Œæ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯éç»“æ„åŒ–æ•°æ®æ–¹å¼ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬æŒ‘é€‰æ–‡æœ¬è¡Œåè®®æ¥å®ç°ï¼Œå¤§å¤šæ•°Mecachedçš„å®¢æˆ·ç«¯ä¹Ÿæ˜¯é‡‡ç”¨æ–‡æœ¬è¡Œåè®®æ¥å¼€å‘çš„å› ä¸ºæ¯”è¾ƒç®€å•ï¼Œç‰¹å®šæ ¼å¼æ–‡æœ¬å­—ç¬¦ä¸²æ¥çº¦å®šæ•°æ®äº¤äº’ï¼Œå¦‚ä¸‹ä»¥å®¢æˆ·ç«¯å‘é€å‘½ä»¤ä¸¾ä¾‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;command&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;&amp;gt;&lt;/span&gt;Â &lt;span&gt;&amp;lt;&lt;span&gt;key&lt;/span&gt;&amp;gt;&lt;/span&gt;Â &lt;span&gt;&amp;lt;&lt;span&gt;flags&lt;/span&gt;&amp;gt;&lt;/span&gt;Â &lt;span&gt;&amp;lt;&lt;span&gt;exptime&lt;/span&gt;&amp;gt;&lt;/span&gt;Â &lt;span&gt;&amp;lt;&lt;span&gt;bytes&lt;/span&gt;&amp;gt;&lt;/span&gt;\r\n&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;data&lt;/span&gt;Â &lt;span&gt;block&lt;/span&gt;&amp;gt;&lt;/span&gt;\r\n&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&amp;lt;command name&amp;gt;&lt;/code&gt; æ˜¯åè®®çš„å‘½ä»¤ï¼Œå¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å­˜å‚¨å‘½ä»¤ï¼šsetã€ addã€replaceã€appendã€prependã€casã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è·å–å‘½ä»¤ï¼šgetã€getsã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å…¶ä»–å‘½ä»¤ï¼šversionã€stats&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&amp;lt;key&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¦æ±‚å­˜å‚¨æ•°æ®çš„å…³é”®å­—ï¼›ç”±äºmemachedåº•å±‚å®ç°çš„é™åˆ¶ï¼Œkeyçš„é•¿åº¦é™åˆ¶åœ¨250ä¸ªå­—ç¬¦å†…ï¼Œå¹¶ä¸”keyä¸­ä¸èƒ½åŒ…å«æ§åˆ¶å­—ç¬¦æˆ–ç©ºæ ¼ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&amp;lt;flags&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ˜¯ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´æ•°ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&amp;lt;exptime&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ˜¯å­˜å‚¨è¶…æ—¶æ—¶é—´ã€‚å¦‚æœå€¼ä¸º0è¡¨ç¤ºè¯¥æ•°æ®é¡¹æ°¸ä¸è¶…æ—¶ï¼›&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿‡æœŸæ—¶é—´å®ç°é™åˆ¶ï¼Œè¿‡æœŸæ—¶é—´è¦ä¹ˆæ˜¯Unixæ—¶é—´ï¼ˆä»1970-1-1å¼€å§‹è®¡ç®—çš„ç§’æ•°ï¼‰ï¼Œè¦ä¹ˆæ˜¯ä»å½“å‰æ—¶é—´å¼€å§‹è®¡ç®—çš„ç§’æ•°ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯¥å€¼ä¸èƒ½è¶…è¿‡30å¤©ï¼Œå¦åˆ™æœåŠ¡å™¨å°†è¯¥å‚æ•°å½“åšçœŸæ­£çš„Unixæ—¶é—´è€Œä¸æ˜¯å½“å‰æ—¶é—´çš„ä¸€ä¸ªåç§»å€¼ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&amp;lt;bytes&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ˜¯éšåæ•°æ®çš„å­—èŠ‚æ•°ï¼Œä¸åŒ…æ‹¬ç»ˆç»“ç¬¦\r\nã€‚&lt;code&gt;&amp;lt;bytes&amp;gt;&lt;/code&gt;æœ‰å¯èƒ½æ˜¯0ï¼Œå®ƒåé¢å°†æ˜¯ä¸€ä¸ªç©ºçš„æ•°æ®å—ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&amp;lt;data block&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å­˜å‚¨æ•°æ®æµã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å®¢æˆ·ç«¯ä»¥å­—ç¬¦ä¸²çš„æ–¹å¼å‘æœåŠ¡ç«¯å‘é€æ–‡æœ¬è¡Œçš„å†…å®¹æœåŠ¡å™¨ç«¯ä¼šè¿”å›å¯¹åº”çš„æ‰§è¡Œç»“æœæ•°æ®ï¼Œä¹Ÿæœ‰è¿”å›é”™è¯¯çš„æƒ…å†µï¼Œmemcacheä¹Ÿå¯¹é”™è¯¯çš„æ•°æ®æ ¼å¼å®šä¹‰ä¸‰ç§ä¸åŒé”™è¯¯ç±»å‹çš„ä¸‰ç§æ ¼å¼è®©é”™è¯¯çš„è¿”å›ç®€å•ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ERROR\r\n&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯´æ˜å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªä¸å­˜åœ¨å‘½ä»¤&lt;/p&gt;&lt;ol start=&quot;2&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;CLIENT_ERROR&lt;error&gt;\r\n&lt;/error&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯´æ˜åœ¨è¾“å…¥è¡Œä¸­å­˜åœ¨æŸç§ç±»å‹çš„å®¢æˆ·ç«¯é”™è¯¯ï¼Œä¾‹å¦‚è¾“å…¥çš„ä¿¡æ¯æ²¡æœ‰éµå¾ªmemcachedçš„åè®®&lt;/p&gt;&lt;ol start=&quot;3&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;SERVER_ERROR&lt;error&gt;\r\n&lt;/error&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯´æ˜æœåŠ¡ç«¯å­˜åœ¨æŸç§ç±»å‹çš„é”™è¯¯å¯¼è‡´è‡´å‘½å‘½ä»¤æ— æ³•æ‰§è¡Œã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&amp;lt;error&amp;gt;&lt;/code&gt;æ˜¯å…·æœ‰å¯è¯»æ€§çš„é”™è¯¯å­—ç¬¦ä¸²ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“æœåŠ¡ç«¯é”™è¯¯å‘ç”Ÿåï¼Œå°†ä¼šå¯¼è‡´æœåŠ¡å™¨å°†ä¸ä¼šå†æä¾›æœåŠ¡ï¼ŒæœåŠ¡å™¨åœ¨å‘é€è¯¥é”™è¯¯ä¿¡æ¯è¡Œåå°†å…³é—­é“¾æ¥ã€‚åªæœ‰åœ¨æ­¤åœºæ™¯ä¸‹ï¼ŒæœåŠ¡å™¨æ‰ä¼šå…³é—­ä¸å®¢æˆ·ç«¯é“¾æ¥ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»¥ä¸‹å°±å…·ä½“ç½—åˆ—memcachedå¸¸ç”¨åŒ…å«å®¢æˆ·ç«¯å‘é€å’Œå“åº”çš„å‘½ä»¤æ ¼å¼åˆ—è¡¨ï¼š&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.1415241057542769&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdfjlwvwuTBicwZP34Pk8kpgiaaAicEh9yPbCLZkaWncxYJ1FPxN283giccMbXnKTzscQicfj67XgnBvWW4YSnJgeUw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1286&quot;/&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5429447852760736&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdfjlwvwuTBicwZP34Pk8kpgiaaAicEh9yPGibxy9LvsxNcbP9I8pibYvymeyHcOTuGJoGFOjhdHuYRTuu2U27icmn2A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1304&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;éœ€è¦æ³¨æ„çš„æ˜¯commandæ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨tcpè¿æ¥æœåŠ¡ç«¯å‘é€å®¢æˆ·ç«¯æ–‡æœ¬è¡Œå‘½ä»¤ï¼Œå‘é€æˆåŠŸåç­‰å¾…æœåŠ¡å™¨è¿”å›æ•°æ®ï¼Œæ ¹æ®æ ¼å¼è§£æè·å–éœ€è¦çš„è¿”å›å€¼è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„åè®®å‘½ä»¤æ‰§è¡Œæµç¨‹ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;Golangå®ç°å®¢æˆ·ç«¯é©±åŠ¨&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰äº†å¯¹memacheåè®®çš„äº†è§£ç°åœ¨æ¥å®ç°é€šè®¯å°±æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰Clientç»“æ„ä½“ï¼Œä¿å­˜å®¢æˆ·ç«¯ä¸€äº›åŸºæœ¬é…ç½®ä¿¡æ¯åŠé“¾æ¥ä¿¡æ¯ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â ClientÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â Â Â TimeoutÂ Â Â Â Â Â time.Duration&lt;br/&gt;Â Â Â MaxIdleConnsÂ &lt;span&gt;int&lt;/span&gt;&lt;br/&gt;Â Â Â lockÂ Â Â Â Â Â Â Â Â sync.Mutex&lt;br/&gt;Â Â Â addrÂ Â Â Â Â Â Â Â Â net.Addr&lt;br/&gt;Â Â Â connsÂ Â Â Â Â Â Â Â []*conn&lt;br/&gt;}Â Â &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Timeout tcpé“¾æ¥è¯»å†™è¶…æ—¶&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;conns æ˜¯memcacheé“¾æ¥æ± å­˜æ”¾çš„æ•°ç»„&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;MaxIdleConns æ˜¯Idleé“¾æ¥çš„æ•°é‡&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;lock æ˜¯æ“ä½œconnsæ—¶åŠ é”&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;addråˆ™æ˜¯é“¾æ¥çš„memcacheçš„åœ°å€&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;memcachedçš„å•ç‹¬ä¸€ä¸ªconnè¿æ¥ç»“æ„ä½“å®šä¹‰&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;type&lt;/span&gt;Â connÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â Â Â ncÂ Â Â net.Conn&lt;br/&gt;Â Â Â rwÂ Â Â *bufio.ReadWriter&lt;br/&gt;Â Â Â addrÂ net.Addr&lt;br/&gt;Â Â Â cÂ Â Â Â *Client&lt;br/&gt;}Â Â &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;nc æ˜¯å»ºç«‹å¥½çš„tcpç½‘ç»œé“¾æ¥&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;rw ä¸ºäº†æ–¹ä¾¿æ•°æ®å‘é€å’Œè¯»å–è®¾ç½®bufioçš„ReadWriter&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;addr å­˜å‚¨memcachedåœ°å€&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;c å­˜å‚¨å®¢æˆ·ç«¯çš„å¼•ç”¨&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸‹é¢æ˜¯çœ‹å¦‚ä½•è·å–é“¾æ¥å’Œä½¿ç”¨å®Œä¹‹åå¦‚ä½•å°†é“¾æ¥æ”¾å›åˆ°é“¾æ¥æ± ä¸­&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//è·å–memcachedçš„é“¾æ¥&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;getFreeConn&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;(cnÂ *conn,Â okÂ &lt;span&gt;bool&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â c.lock.Lock()&lt;br/&gt;Â Â Â &lt;span&gt;defer&lt;/span&gt;Â c.lock.Unlock()&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â c.connsÂ ==Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â freelistÂ :=Â c.conns&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â &lt;span&gt;len&lt;/span&gt;(freelist)Â ==Â &lt;span&gt;0&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â cnÂ =Â freelist[&lt;span&gt;len&lt;/span&gt;(freelist)&lt;span&gt;-1&lt;/span&gt;]&lt;br/&gt;Â Â Â c.connsÂ =Â freelist[:&lt;span&gt;len&lt;/span&gt;(freelist)&lt;span&gt;-1&lt;/span&gt;]&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â cn,Â &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span&gt;//å°†ä½¿ç”¨å®Œçš„é“¾æ¥æ”¾å›åˆ°connsä¸­&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;putFreeConn&lt;/span&gt;&lt;span&gt;(cnÂ *conn)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â c.lock.Lock()&lt;br/&gt;Â Â Â &lt;span&gt;defer&lt;/span&gt;Â c.lock.Unlock()&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â c.connsÂ ==Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â c.connsÂ =Â &lt;span&gt;make&lt;/span&gt;([]*conn,Â &lt;span&gt;0&lt;/span&gt;)&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â freelistÂ :=Â c.conns&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â &lt;span&gt;len&lt;/span&gt;(freelist)Â &amp;gt;=Â c.maxIdleConns()Â {&lt;br/&gt;Â Â Â Â Â Â cn.nc.Close()&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â c.connsÂ =Â &lt;span&gt;append&lt;/span&gt;(freelist,Â cn)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¥ä¸‹æ¥ä»¥GETå‘½ä»¤ä¸ºä¾‹ï¼Œæ¥è¯¦ç»†çœ‹å¦‚ä½•è¿›è¡Œç½‘ç»œä¼ è¾“å’Œåè®®è§£æçš„å®ç°&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Get&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;(itemÂ *Item,Â errÂ error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;//checkÂ keyÂ lenÂ éªŒè¯keyæ˜¯å¦é•¿äº250å­—ç¬¦&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â !legalKey(key)Â {&lt;br/&gt;Â Â Â Â Â Â errÂ =Â ErrMalformedKey&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â keysÂ :=Â []&lt;span&gt;string&lt;/span&gt;{key}&lt;br/&gt;Â Â Â cn,Â errÂ :=Â c.getConn()Â &lt;span&gt;//è·å–memcachedé“¾æ¥&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;defer&lt;/span&gt;Â cn.condRelease(&amp;amp;err)Â &lt;span&gt;//Â æ–¹æ³•æ‰§è¡Œå®Œä¹‹åå°†é“¾æ¥releaseï¼Œè¿”å›åˆ°é“¾æ¥æ± ä¸­&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â rwÂ :=Â cn.rw&lt;br/&gt;Â Â Â &lt;span&gt;//å°†getsÂ å‘½ä»¤ç”¨æ–‡æœ¬è¡Œåè®®å†™å…¥åˆ°rwä¸­&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â _,Â errÂ =Â fmt.Fprintf(rw,Â &lt;span&gt;&quot;getsÂ %s\r\n&quot;&lt;/span&gt;,Â strings.Join(keys,Â &lt;span&gt;&quot;Â &quot;&lt;/span&gt;));Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ =Â rw.Flush();Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â &lt;span&gt;//è·å–GETå‘½ä»¤å‘é€ä¹‹åç­‰å¾…å’Œè·å–è¿”å›çš„å“åº”æ•°æ®&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ =Â parseGetResponse(rw.Reader,Â &lt;span&gt;&lt;span&gt;func&lt;/span&gt;&lt;span&gt;(itÂ *Item)&lt;/span&gt;&lt;/span&gt;Â {Â itemÂ =Â itÂ });Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â itemÂ ==Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â errÂ =Â ErrCacheMiss&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;parseGetResponse&lt;/span&gt;&lt;span&gt;(rÂ *bufio.Reader,Â cbÂ &lt;span&gt;func&lt;/span&gt;(*Item)&lt;/span&gt;)Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;for&lt;/span&gt;Â {&lt;br/&gt;Â Â line,Â errÂ :=Â r.ReadSlice(&lt;span&gt;&#x27;\n&#x27;&lt;/span&gt;)&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â bytes.Equal(line,Â resultEnd)Â {Â &lt;span&gt;//å¦‚æœè·å–æ˜¯Â END\r\nÂ åˆ™æ•°æ®è¿”å›å®Œï¼Œåˆ™è¿”å›&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â Â }&lt;br/&gt;Â Â itÂ :=Â &lt;span&gt;new&lt;/span&gt;(Item)&lt;br/&gt;Â Â size,Â errÂ :=Â scanGetResponseLine(line,Â it)&lt;span&gt;//å…ˆæ ¹æ®æ ¼å¼è·å–ç¬¬ä¸€è¡Œæ•°æ®å’Œ&amp;lt;data&amp;gt;Â éƒ¨åˆ†çš„å¤§å°&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;//æ ¹æ®bytesè·å–æ•°æ®&lt;/span&gt;&lt;br/&gt;Â Â it.ValueÂ =Â &lt;span&gt;make&lt;/span&gt;([]&lt;span&gt;byte&lt;/span&gt;,Â size+&lt;span&gt;2&lt;/span&gt;)&lt;br/&gt;Â Â _,Â errÂ =Â io.ReadFull(r,Â it.Value)&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â it.ValueÂ =Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â !bytes.HasSuffix(it.Value,Â crlf)Â {&lt;br/&gt;Â Â Â it.ValueÂ =Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â fmt.Errorf(&lt;span&gt;&quot;memcache:Â corruptÂ getÂ resultÂ read&quot;&lt;/span&gt;)&lt;br/&gt;Â Â }&lt;br/&gt;Â Â it.ValueÂ =Â it.Value[:size]&lt;br/&gt;Â Â cb(it)&lt;br/&gt;Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//æ ¹æ®è¿”å›æ•°æ®æ ¼å¼è·å–è¿”å›å€¼è®¾ç½®åˆ°Itemç»“æ„ä¸­ã€‚&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;scanGetResponseLine&lt;/span&gt;&lt;span&gt;(lineÂ []&lt;span&gt;byte&lt;/span&gt;,Â itÂ *Item)&lt;/span&gt;Â &lt;span&gt;(sizeÂ &lt;span&gt;int&lt;/span&gt;,Â errÂ error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;//Â è¿”å›çš„æ•°æ®æ ¼å¼Â VALUEÂ &amp;lt;key&amp;gt;Â &amp;lt;falgs&amp;gt;Â &amp;lt;bytes&amp;gt;Â &amp;lt;casid&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â patternÂ :=Â &lt;span&gt;&quot;VALUEÂ %sÂ %dÂ %dÂ %d\r\n&quot;&lt;/span&gt;&lt;br/&gt;Â destÂ :=Â []&lt;span&gt;interface&lt;/span&gt;{}{&amp;amp;it.Key,Â &amp;amp;it.Flags,Â &amp;amp;size,Â &amp;amp;it.casid}&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â bytes.Count(line,Â space)Â ==Â &lt;span&gt;3&lt;/span&gt;Â {&lt;br/&gt;Â Â patternÂ =Â &lt;span&gt;&quot;VALUEÂ %sÂ %dÂ %d\r\n&quot;&lt;/span&gt;&lt;br/&gt;Â Â destÂ =Â dest[:&lt;span&gt;3&lt;/span&gt;]&lt;br/&gt;Â }&lt;br/&gt;Â n,Â errÂ :=Â fmt.Sscanf(&lt;span&gt;string&lt;/span&gt;(line),Â pattern,Â dest...)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â ||Â nÂ !=Â &lt;span&gt;len&lt;/span&gt;(dest)Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;-1&lt;/span&gt;,Â fmt.Errorf(&lt;span&gt;&quot;memcache:Â unexpectedÂ lineÂ inÂ getÂ response:Â %q&quot;&lt;/span&gt;,Â line)&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â size,Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//åˆ¤æ–­keyæ˜¯å¦ç¬¦åˆè¦æ±‚&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;legalKey&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;bool&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â &lt;span&gt;len&lt;/span&gt;(key)Â &amp;gt;Â &lt;span&gt;250&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;for&lt;/span&gt;Â iÂ :=Â &lt;span&gt;0&lt;/span&gt;;Â iÂ &amp;lt;Â &lt;span&gt;len&lt;/span&gt;(key);Â i++Â {&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â key[i]Â &amp;lt;=Â &lt;span&gt;&#x27;Â &#x27;&lt;/span&gt;Â ||Â key[i]Â ==Â &lt;span&gt;0x7f&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;}Â Â &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…¶å®ƒå‘½ä»¤ä¸åœ¨è¯¦ç»†æè¿°ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt;Â memcache&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt;Â (&lt;br/&gt;Â &lt;span&gt;&quot;bufio&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;bytes&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;errors&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;fmt&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;io&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;net&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;strconv&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;strings&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;sync&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;time&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//memcachedÂ -mÂ 1024Â Â -uÂ rootÂ -lÂ 127.0.0.1Â -pÂ 12001Â -cÂ 55535&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//#Â memcachedÂ -dÂ -mÂ 10Â Â -uÂ rootÂ -lÂ 127.0.0.1Â -pÂ 12001Â -cÂ 256Â -PÂ /tmp/memcached.pid&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-dé€‰é¡¹æ˜¯å¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-mæ˜¯åˆ†é…ç»™Memcacheä½¿ç”¨çš„å†…å­˜æ•°é‡ï¼Œå•ä½æ˜¯MBï¼Œæˆ‘è¿™é‡Œæ˜¯10MB&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-uæ˜¯è¿è¡ŒMemcacheçš„ç”¨æˆ·&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-læ˜¯ç›‘å¬çš„æœåŠ¡å™¨IPåœ°å€ï¼Œå¦‚æœæœ‰å¤šä¸ªåœ°å€çš„è¯ï¼Œæˆ‘è¿™é‡ŒæŒ‡å®šäº†æœåŠ¡å™¨çš„IPåœ°å€127.0.0.1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-pæ˜¯è®¾ç½®Â Memcacheç›‘å¬çš„ç«¯å£ï¼Œæˆ‘è¿™é‡Œè®¾ç½®äº†12001ï¼Œæœ€å¥½æ˜¯1024ä»¥ä¸Šçš„ç«¯å£&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-cé€‰é¡¹æ˜¯æœ€å¤§è¿è¡Œçš„å¹¶å‘è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯1024ï¼Œæˆ‘è¿™é‡Œè®¾ç½®äº†Â 256ï¼ŒæŒ‰ç…§ä½ æœåŠ¡å™¨çš„è´Ÿè½½é‡æ¥è®¾å®š&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-Pæ˜¯è®¾ç½®ä¿å­˜Memcacheçš„pidæ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œæ˜¯ä¿å­˜åœ¨Â /tmp/memcached.pid&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//åœæ­¢è¿›ç¨‹ï¼š# kill `cat /tmp/memcached.pid`&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;const&lt;/span&gt;Â (&lt;br/&gt;Â DefaultTimeoutÂ Â Â Â Â Â =Â &lt;span&gt;100&lt;/span&gt;Â *Â time.Millisecond&lt;br/&gt;Â DefaultMaxIdleConnsÂ =Â &lt;span&gt;40&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;var&lt;/span&gt;Â (&lt;br/&gt;Â resultClientErrorPrefixÂ =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;CLIENT_ERROR&quot;&lt;/span&gt;)&lt;br/&gt;Â resultErrPrefixÂ Â Â Â Â Â Â Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;ERROR&quot;&lt;/span&gt;)&lt;br/&gt;Â resultServerErrPrefixÂ Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;SERVER_ERROR&quot;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;Â crlfÂ Â Â Â Â Â Â Â Â Â Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;\r\n&quot;&lt;/span&gt;)&lt;br/&gt;Â spaceÂ Â Â Â Â Â Â Â Â Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;Â &quot;&lt;/span&gt;)&lt;br/&gt;Â resultOKÂ Â Â Â Â Â Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;OK\r\n&quot;&lt;/span&gt;)&lt;br/&gt;Â resultStoredÂ Â Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;STORED\r\n&quot;&lt;/span&gt;)&lt;br/&gt;Â resultNotStoredÂ =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;NOT_STORED\r\n&quot;&lt;/span&gt;)&lt;br/&gt;Â resultExistsÂ Â Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;EXISTS\r\n&quot;&lt;/span&gt;)&lt;br/&gt;Â resultNotFoundÂ Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;NOT_FOUND\r\n&quot;&lt;/span&gt;)&lt;br/&gt;Â resultDeletedÂ Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;DELETED\r\n&quot;&lt;/span&gt;)&lt;br/&gt;Â resultEndÂ Â Â Â Â Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;END\r\n&quot;&lt;/span&gt;)&lt;br/&gt;Â resultTouchedÂ Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;TOUCHED\r\n&quot;&lt;/span&gt;)&lt;br/&gt;Â versionPrefixÂ Â Â =Â []&lt;span&gt;byte&lt;/span&gt;(&lt;span&gt;&quot;VERSION&quot;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;Â ErrMalformedKeyÂ =Â errors.New(&lt;span&gt;&quot;malformed:Â keyÂ isÂ tooÂ longÂ orÂ containsÂ invalidÂ characters&quot;&lt;/span&gt;)&lt;br/&gt;Â ErrCacheMissÂ Â Â Â =Â errors.New(&lt;span&gt;&quot;memcache:Â cacheÂ miss&quot;&lt;/span&gt;)&lt;br/&gt;Â ErrCASConflictÂ Â =Â errors.New(&lt;span&gt;&quot;memcache:Â compare-and-swapÂ conflict&quot;&lt;/span&gt;)&lt;br/&gt;Â ErrNotStoredÂ Â Â Â =Â errors.New(&lt;span&gt;&quot;memcache:Â itemÂ notÂ stored&quot;&lt;/span&gt;)&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt;Â ClientÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â TimeoutÂ Â Â Â Â Â time.Duration&lt;br/&gt;Â MaxIdleConnsÂ &lt;span&gt;int&lt;/span&gt;&lt;br/&gt;Â lockÂ Â Â Â Â Â Â Â Â sync.Mutex&lt;br/&gt;Â addrÂ Â Â Â Â Â Â Â Â net.Addr&lt;br/&gt;Â connsÂ Â Â Â Â Â Â Â []*conn&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;NewClient&lt;/span&gt;&lt;span&gt;(timeoutÂ time.Duration,Â maxIdleConnsÂ &lt;span&gt;int&lt;/span&gt;,Â addrÂ net.Addr)&lt;/span&gt;Â *&lt;span&gt;Client&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â &amp;amp;Client{&lt;br/&gt;Â Â Timeout:Â Â Â Â Â Â timeout,&lt;br/&gt;Â Â MaxIdleConns:Â maxIdleConns,&lt;br/&gt;Â Â lock:Â Â Â Â Â Â Â Â Â sync.Mutex{},&lt;br/&gt;Â Â addr:Â Â Â Â Â Â Â Â Â addr,&lt;br/&gt;Â Â conns:Â Â Â Â Â Â Â Â &lt;span&gt;nil&lt;/span&gt;,&lt;br/&gt;Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt;Â ItemÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;//Â KeyÂ isÂ theÂ Item&#x27;sÂ keyÂ (250Â bytesÂ maximum).&lt;/span&gt;&lt;br/&gt;Â KeyÂ &lt;span&gt;string&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;//Â ValueÂ isÂ theÂ Item&#x27;sÂ value.&lt;/span&gt;&lt;br/&gt;Â ValueÂ []&lt;span&gt;byte&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;//Â FlagsÂ areÂ server-opaqueÂ flagsÂ whoseÂ semanticsÂ areÂ entirely&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;//Â upÂ toÂ theÂ app.&lt;/span&gt;&lt;br/&gt;Â FlagsÂ &lt;span&gt;uint32&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;//Â ExpirationÂ isÂ theÂ cacheÂ expirationÂ time,Â inÂ seconds:Â eitherÂ aÂ relative&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;//Â timeÂ fromÂ nowÂ (upÂ toÂ 1Â month),Â orÂ anÂ absoluteÂ UnixÂ epochÂ time.&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;//Â ZeroÂ meansÂ theÂ ItemÂ hasÂ noÂ expirationÂ time.&lt;/span&gt;&lt;br/&gt;Â ExpirationÂ &lt;span&gt;int32&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;//Â CompareÂ andÂ swapÂ ID.&lt;/span&gt;&lt;br/&gt;Â casidÂ &lt;span&gt;uint64&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;maxIdleConns&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â c.MaxIdleConnsÂ &amp;gt;Â &lt;span&gt;0&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â c.MaxIdleConns&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â DefaultMaxIdleConns&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;netTimeout&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;time&lt;/span&gt;.&lt;span&gt;Duration&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â c.TimeoutÂ !=Â &lt;span&gt;0&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â c.Timeout&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â DefaultTimeout&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt;Â connÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â ncÂ Â Â net.Conn&lt;br/&gt;Â rwÂ Â Â *bufio.ReadWriter&lt;br/&gt;Â addrÂ net.Addr&lt;br/&gt;Â cÂ Â Â Â *Client&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â è®¾ç½®è¶…æ—¶æ—¶é—´&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cnÂ *conn)&lt;/span&gt;Â &lt;span&gt;extendDeadline&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â cn.nc.SetDeadline(time.Now().Add(cn.c.netTimeout()))&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â ReleaseÂ å¦‚æœæ˜¯æ­£å¸¸çš„errÂ åˆ™æ”¾å›åˆ°connsä¸­ï¼Œå¦‚æœä¸æ˜¯è¿™ç›´æ¥closeæ‰conn&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cnÂ *conn)&lt;/span&gt;Â &lt;span&gt;condRelease&lt;/span&gt;&lt;span&gt;(errÂ *error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â *errÂ ==Â &lt;span&gt;nil&lt;/span&gt;Â ||Â resumableError(*err)Â {&lt;br/&gt;Â Â cn.release()&lt;br/&gt;Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â fmt.Println(&lt;span&gt;&quot;xxx&quot;&lt;/span&gt;,Â fmt.Sprintf(&lt;span&gt;&quot;%s&quot;&lt;/span&gt;,Â (*err).Error()))&lt;br/&gt;Â Â cn.nc.Close()&lt;br/&gt;Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â releaseÂ returnsÂ thisÂ connectionÂ backÂ toÂ theÂ client&#x27;sÂ freeÂ pool&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cnÂ *conn)&lt;/span&gt;Â &lt;span&gt;release&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â cn.c.putFreeConn(cn)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;putFreeConn&lt;/span&gt;&lt;span&gt;(cnÂ *conn)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â c.lock.Lock()&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â c.lock.Unlock()&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â c.connsÂ ==Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â c.connsÂ =Â &lt;span&gt;make&lt;/span&gt;([]*conn,Â &lt;span&gt;0&lt;/span&gt;)&lt;br/&gt;Â }&lt;br/&gt;Â freelistÂ :=Â c.conns&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â &lt;span&gt;len&lt;/span&gt;(freelist)Â &amp;gt;=Â c.maxIdleConns()Â {&lt;br/&gt;Â Â cn.nc.Close()&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â c.connsÂ =Â &lt;span&gt;append&lt;/span&gt;(freelist,Â cn)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;getFreeConn&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;(cnÂ *conn,Â okÂ &lt;span&gt;bool&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â c.lock.Lock()&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â c.lock.Unlock()&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â c.connsÂ ==Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â freelistÂ :=Â c.conns&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â &lt;span&gt;len&lt;/span&gt;(freelist)Â ==Â &lt;span&gt;0&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â cnÂ =Â freelist[&lt;span&gt;len&lt;/span&gt;(freelist)&lt;span&gt;-1&lt;/span&gt;]&lt;br/&gt;Â c.connsÂ =Â freelist[:&lt;span&gt;len&lt;/span&gt;(freelist)&lt;span&gt;-1&lt;/span&gt;]&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â cn,Â &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;type&lt;/span&gt;Â ConnectTimeoutErrorÂ &lt;span&gt;struct&lt;/span&gt;Â {&lt;br/&gt;Â AddrÂ net.Addr&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cteÂ *ConnectTimeoutError)&lt;/span&gt;Â &lt;span&gt;Error&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;string&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;memcache:Â connectÂ timeoutÂ toÂ &quot;&lt;/span&gt;Â +Â cte.Addr.String()&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//è·å–memcachedè¿æ¥&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;getConn&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;(*conn,Â error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â cn,Â okÂ :=Â c.getFreeConn()&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â okÂ {&lt;br/&gt;Â Â cn.extendDeadline()&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â cn,Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â nc,Â errÂ :=Â c.dial(c.addr)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â err&lt;br/&gt;Â }&lt;br/&gt;Â cnÂ =Â &amp;amp;conn{&lt;br/&gt;Â Â nc:Â Â Â nc,&lt;br/&gt;Â Â addr:Â c.addr,&lt;br/&gt;Â Â rw:Â Â Â bufio.NewReadWriter(bufio.NewReader(nc),Â bufio.NewWriter(nc)),&lt;br/&gt;Â Â c:Â Â Â Â c,&lt;br/&gt;Â }&lt;br/&gt;Â cn.extendDeadline()&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â cn,Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;dial&lt;/span&gt;&lt;span&gt;(addrÂ net.Addr)&lt;/span&gt;Â &lt;span&gt;(net.Conn,Â error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â nc,Â errÂ :=Â net.DialTimeout(addr.Network(),Â addr.String(),Â c.netTimeout())&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ ==Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â nc,Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â ne,Â okÂ :=Â err.(net.Error);Â okÂ &amp;amp;&amp;amp;Â ne.Timeout()Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â &amp;amp;ConnectTimeoutError{Addr:Â addr}&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â err&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Get&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;(itemÂ *Item,Â errÂ error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;//checkÂ keyÂ len&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â !legalKey(key)Â {&lt;br/&gt;Â Â errÂ =Â ErrMalformedKey&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â keysÂ :=Â []&lt;span&gt;string&lt;/span&gt;{key}&lt;br/&gt;Â cn,Â errÂ :=Â c.getConn()&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â cn.condRelease(&amp;amp;err)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â rwÂ :=Â cn.rw&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â _,Â errÂ =Â fmt.Fprintf(rw,Â &lt;span&gt;&quot;getsÂ %s\r\n&quot;&lt;/span&gt;,Â strings.Join(keys,Â &lt;span&gt;&quot;Â &quot;&lt;/span&gt;));Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ =Â rw.Flush();Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ =Â parseGetResponse(rw.Reader,Â &lt;span&gt;&lt;span&gt;func&lt;/span&gt;&lt;span&gt;(itÂ *Item)&lt;/span&gt;&lt;/span&gt;Â {Â itemÂ =Â itÂ });Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â itemÂ ==Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â errÂ =Â ErrCacheMiss&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;GetMulti&lt;/span&gt;&lt;span&gt;(keysÂ []&lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;(&lt;span&gt;map&lt;/span&gt;[&lt;span&gt;string&lt;/span&gt;]*Item,Â error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;var&lt;/span&gt;Â lkÂ sync.Mutex&lt;br/&gt;Â mÂ :=Â &lt;span&gt;make&lt;/span&gt;(&lt;span&gt;map&lt;/span&gt;[&lt;span&gt;string&lt;/span&gt;]*Item)&lt;br/&gt;Â addItemToMapÂ :=Â &lt;span&gt;&lt;span&gt;func&lt;/span&gt;&lt;span&gt;(itÂ *Item)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â lk.Lock()&lt;br/&gt;Â Â &lt;span&gt;defer&lt;/span&gt;Â lk.Unlock()&lt;br/&gt;Â Â m[it.Key]Â =Â it&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;for&lt;/span&gt;Â _,Â keyÂ :=Â &lt;span&gt;range&lt;/span&gt;Â keysÂ {&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â !legalKey(key)Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â ErrMalformedKey&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;Â cn,Â errÂ :=Â c.getConn()&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â cn.condRelease(&amp;amp;err)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â _,Â errÂ =Â fmt.Fprintf(cn.rw,Â &lt;span&gt;&quot;getsÂ %s\r\n&quot;&lt;/span&gt;,Â strings.Join(keys,Â &lt;span&gt;&quot;Â &quot;&lt;/span&gt;));Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ =Â cn.rw.Flush();Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ =Â parseGetResponse(cn.rw.Reader,Â addItemToMap);Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â m,Â err&lt;br/&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Touch&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;,Â secondsÂ &lt;span&gt;int32&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;(errÂ error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;&lt;br/&gt;Â cn,Â errÂ :=Â c.getConn()&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â cn.condRelease(&amp;amp;err)&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â _,Â errÂ =Â fmt.Fprintf(cn.rw,Â &lt;span&gt;&quot;touchÂ %sÂ %d\r\n&quot;&lt;/span&gt;,Â key,Â seconds);Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ =Â cn.rw.Flush();Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â line,Â errÂ :=Â cn.rw.ReadSlice(&lt;span&gt;&#x27;\n&#x27;&lt;/span&gt;)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;switch&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultTouched):&lt;br/&gt;Â Â &lt;span&gt;break&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultNotFound):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ErrCacheMiss&lt;br/&gt;Â &lt;span&gt;default&lt;/span&gt;:&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â fmt.Errorf(&lt;span&gt;&quot;memcache:Â unexpectedÂ responseÂ lineÂ fromÂ touch:Â %q&quot;&lt;/span&gt;,Â &lt;span&gt;string&lt;/span&gt;(line))&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Add&lt;/span&gt;&lt;span&gt;(itemÂ *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â c.onItem(item,Â &lt;span&gt;&lt;span&gt;func&lt;/span&gt;&lt;span&gt;(clientÂ *Client,Â rwÂ *bufio.ReadWriter,Â itemÂ *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â client.populateOne(rw,Â &lt;span&gt;&quot;add&quot;&lt;/span&gt;,Â item)&lt;br/&gt;Â })&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Set&lt;/span&gt;&lt;span&gt;(itemÂ *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â c.onItem(item,Â &lt;span&gt;&lt;span&gt;func&lt;/span&gt;&lt;span&gt;(clientÂ *Client,Â rwÂ *bufio.ReadWriter,Â itemÂ *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â client.populateOne(rw,Â &lt;span&gt;&quot;set&quot;&lt;/span&gt;,Â item)&lt;br/&gt;Â })&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;CompareAndSwap&lt;/span&gt;&lt;span&gt;(itemÂ *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â c.onItem(item,Â &lt;span&gt;&lt;span&gt;func&lt;/span&gt;&lt;span&gt;(clientÂ *Client,Â rwÂ *bufio.ReadWriter,Â itemÂ *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â client.populateOne(rw,Â &lt;span&gt;&quot;cas&quot;&lt;/span&gt;,Â item)&lt;br/&gt;Â })&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Replace&lt;/span&gt;&lt;span&gt;(itemÂ *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â c.onItem(item,Â &lt;span&gt;&lt;span&gt;func&lt;/span&gt;&lt;span&gt;(clientÂ *Client,Â rwÂ *bufio.ReadWriter,Â itemÂ *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â client.populateOne(rw,Â &lt;span&gt;&quot;replace&quot;&lt;/span&gt;,Â item)&lt;br/&gt;Â })&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Delete&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â !legalKey(key)Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ErrMalformedKey&lt;br/&gt;Â }&lt;br/&gt;Â cn,Â errÂ :=Â c.getConn()&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â cn.condRelease(&amp;amp;err)&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â writeExpectf(cn.rw,Â resultDeleted,Â &lt;span&gt;&quot;deleteÂ %s\r\n&quot;&lt;/span&gt;,Â key)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;FlushAll&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â cn,Â errÂ :=Â c.getConn()&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â cn.condRelease(&amp;amp;err)&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â writeExpectf(cn.rw,Â resultDeleted,Â &lt;span&gt;&quot;flush_all\r\n&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Version&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â cn,Â errÂ :=Â c.getConn()&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â cn.condRelease(&amp;amp;err)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;func&lt;/span&gt;&lt;span&gt;(rwÂ *bufio.ReadWriter)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â _,Â eÂ :=Â fmt.Fprintf(rw,Â &lt;span&gt;&quot;version\r\n&quot;&lt;/span&gt;);Â eÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â eÂ :=Â rw.Flush();Â eÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â e&lt;br/&gt;Â Â }&lt;br/&gt;Â Â line,Â eÂ :=Â rw.ReadSlice(&lt;span&gt;&#x27;\n&#x27;&lt;/span&gt;)&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â eÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â e&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;switch&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;case&lt;/span&gt;Â bytes.HasPrefix(line,Â versionPrefix):&lt;br/&gt;Â Â Â &lt;span&gt;break&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;default&lt;/span&gt;:&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â fmt.Errorf(&lt;span&gt;&quot;memcache:Â unexpectedÂ responseÂ lineÂ fromÂ ping:Â %q&quot;&lt;/span&gt;,Â &lt;span&gt;string&lt;/span&gt;(line))&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â }(cn.rw)&lt;br/&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Increment&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;,Â deltaÂ &lt;span&gt;uint64&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;(newValueÂ &lt;span&gt;uint64&lt;/span&gt;,Â errÂ error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â c.incrDecr(&lt;span&gt;&quot;incr&quot;&lt;/span&gt;,Â key,Â delta)&lt;br/&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;Decrement&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;,Â deltaÂ &lt;span&gt;uint64&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;(newValueÂ &lt;span&gt;uint64&lt;/span&gt;,Â errÂ error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â c.incrDecr(&lt;span&gt;&quot;decr&quot;&lt;/span&gt;,Â key,Â delta)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;onItem&lt;/span&gt;&lt;span&gt;(itemÂ *Item,Â fnÂ &lt;span&gt;func&lt;/span&gt;(*Client,Â *bufio.ReadWriter,Â *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;)Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â cn,Â errÂ :=Â c.getConn()&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â cn.condRelease(&amp;amp;err)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ =Â fn(c,Â cn.rw,Â item);Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;parseGetResponse&lt;/span&gt;&lt;span&gt;(rÂ *bufio.Reader,Â cbÂ &lt;span&gt;func&lt;/span&gt;(*Item)&lt;/span&gt;)Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;for&lt;/span&gt;Â {&lt;br/&gt;Â Â line,Â errÂ :=Â r.ReadSlice(&lt;span&gt;&#x27;\n&#x27;&lt;/span&gt;)&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â bytes.Equal(line,Â resultEnd)Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â Â }&lt;br/&gt;Â Â itÂ :=Â &lt;span&gt;new&lt;/span&gt;(Item)&lt;br/&gt;Â Â size,Â errÂ :=Â scanGetResponseLine(line,Â it)&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â Â }&lt;br/&gt;Â Â it.ValueÂ =Â &lt;span&gt;make&lt;/span&gt;([]&lt;span&gt;byte&lt;/span&gt;,Â size+&lt;span&gt;2&lt;/span&gt;)&lt;br/&gt;Â Â _,Â errÂ =Â io.ReadFull(r,Â it.Value)&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â it.ValueÂ =Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â !bytes.HasSuffix(it.Value,Â crlf)Â {&lt;br/&gt;Â Â Â it.ValueÂ =Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â fmt.Errorf(&lt;span&gt;&quot;memcache:Â corruptÂ getÂ resultÂ read&quot;&lt;/span&gt;)&lt;br/&gt;Â Â }&lt;br/&gt;Â Â it.ValueÂ =Â it.Value[:size]&lt;br/&gt;Â Â cb(it)&lt;br/&gt;Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;scanGetResponseLine&lt;/span&gt;&lt;span&gt;(lineÂ []&lt;span&gt;byte&lt;/span&gt;,Â itÂ *Item)&lt;/span&gt;Â &lt;span&gt;(sizeÂ &lt;span&gt;int&lt;/span&gt;,Â errÂ error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â patternÂ :=Â &lt;span&gt;&quot;VALUEÂ %sÂ %dÂ %dÂ %d\r\n&quot;&lt;/span&gt;&lt;br/&gt;Â destÂ :=Â []&lt;span&gt;interface&lt;/span&gt;{}{&amp;amp;it.Key,Â &amp;amp;it.Flags,Â &amp;amp;size,Â &amp;amp;it.casid}&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â bytes.Count(line,Â space)Â ==Â &lt;span&gt;3&lt;/span&gt;Â {&lt;br/&gt;Â Â patternÂ =Â &lt;span&gt;&quot;VALUEÂ %sÂ %dÂ %d\r\n&quot;&lt;/span&gt;&lt;br/&gt;Â Â destÂ =Â dest[:&lt;span&gt;3&lt;/span&gt;]&lt;br/&gt;Â }&lt;br/&gt;Â n,Â errÂ :=Â fmt.Sscanf(&lt;span&gt;string&lt;/span&gt;(line),Â pattern,Â dest...)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â ||Â nÂ !=Â &lt;span&gt;len&lt;/span&gt;(dest)Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;-1&lt;/span&gt;,Â fmt.Errorf(&lt;span&gt;&quot;memcache:Â unexpectedÂ lineÂ inÂ getÂ response:Â %q&quot;&lt;/span&gt;,Â line)&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â size,Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;legalKey&lt;/span&gt;&lt;span&gt;(keyÂ &lt;span&gt;string&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;bool&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â &lt;span&gt;len&lt;/span&gt;(key)Â &amp;gt;Â &lt;span&gt;250&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;for&lt;/span&gt;Â iÂ :=Â &lt;span&gt;0&lt;/span&gt;;Â iÂ &amp;lt;Â &lt;span&gt;len&lt;/span&gt;(key);Â i++Â {&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â key[i]Â &amp;lt;=Â &lt;span&gt;&#x27;Â &#x27;&lt;/span&gt;Â ||Â key[i]Â ==Â &lt;span&gt;0x7f&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;resumableError&lt;/span&gt;&lt;span&gt;(errÂ error)&lt;/span&gt;Â &lt;span&gt;bool&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;switch&lt;/span&gt;Â errÂ {&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â ErrCacheMiss,Â ErrCASConflict,Â ErrNotStored,Â ErrMalformedKey:&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;true&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;false&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;populateOne&lt;/span&gt;&lt;span&gt;(rwÂ *bufio.ReadWriter,Â verbÂ &lt;span&gt;string&lt;/span&gt;,Â itemÂ *Item)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â !legalKey(item.Key)Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ErrMalformedKey&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;var&lt;/span&gt;Â errÂ error&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â verbÂ ==Â &lt;span&gt;&quot;cas&quot;&lt;/span&gt;Â {&lt;br/&gt;Â Â _,Â errÂ =Â fmt.Fprintf(rw,Â &lt;span&gt;&quot;%sÂ %sÂ %dÂ %dÂ %dÂ %d\r\n&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â verb,Â item.Key,Â item.Flags,Â item.Expiration,Â &lt;span&gt;len&lt;/span&gt;(item.Value),Â item.casid)&lt;br/&gt;Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â _,Â errÂ =Â fmt.Fprintf(rw,Â &lt;span&gt;&quot;%sÂ %sÂ %dÂ %dÂ %d\r\n&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â verb,Â item.Key,Â item.Flags,Â item.Expiration,Â &lt;span&gt;len&lt;/span&gt;(item.Value))&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â _,Â errÂ =Â rw.Write(item.Value);Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â _,Â errÂ =Â rw.Write(crlf);Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ =Â rw.Flush();Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â line,Â errÂ :=Â rw.ReadSlice(&lt;span&gt;&#x27;\n&#x27;&lt;/span&gt;)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;switch&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultStored):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultNotStored):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ErrNotStored&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultExists):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ErrCASConflict&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultNotFound):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ErrCacheMiss&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â fmt.Errorf(&lt;span&gt;&quot;memcache:Â unexpectedÂ responseÂ lineÂ fromÂ %q:Â %q&quot;&lt;/span&gt;,Â verb,Â &lt;span&gt;string&lt;/span&gt;(line))&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;writeExpectf&lt;/span&gt;&lt;span&gt;(rwÂ *bufio.ReadWriter,Â expectÂ []&lt;span&gt;byte&lt;/span&gt;,Â formatÂ &lt;span&gt;string&lt;/span&gt;,Â argsÂ ...&lt;span&gt;interface&lt;/span&gt;{})&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â line,Â errÂ :=Â writeReadLine(rw,Â format,Â args...)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;switch&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultOK):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â expect):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultNotStored):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ErrNotStored&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultExists):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ErrCASConflict&lt;br/&gt;Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultNotFound):&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ErrCacheMiss&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â fmt.Errorf(&lt;span&gt;&quot;memcache:Â unexpectedÂ responseÂ line:Â %q&quot;&lt;/span&gt;,Â &lt;span&gt;string&lt;/span&gt;(line))&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;writeReadLine&lt;/span&gt;&lt;span&gt;(rwÂ *bufio.ReadWriter,Â formatÂ &lt;span&gt;string&lt;/span&gt;,Â argsÂ ...&lt;span&gt;interface&lt;/span&gt;{})&lt;/span&gt;Â &lt;span&gt;([]&lt;span&gt;byte&lt;/span&gt;,Â error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â _,Â errÂ :=Â fmt.Fprintf(rw,Â format,Â args...)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â eÂ :=Â rw.Flush();Â eÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;,Â e&lt;br/&gt;Â }&lt;br/&gt;Â line,Â errÂ :=Â rw.ReadSlice(&lt;span&gt;&#x27;\n&#x27;&lt;/span&gt;)&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â line,Â err&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;(cÂ *Client)&lt;/span&gt;Â &lt;span&gt;incrDecr&lt;/span&gt;&lt;span&gt;(verb,Â keyÂ &lt;span&gt;string&lt;/span&gt;,Â deltaÂ &lt;span&gt;uint64&lt;/span&gt;)&lt;/span&gt;Â &lt;span&gt;(&lt;span&gt;uint64&lt;/span&gt;,Â error)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â &lt;span&gt;var&lt;/span&gt;Â valÂ &lt;span&gt;uint64&lt;/span&gt;&lt;br/&gt;Â cn,Â errÂ :=Â c.getConn()&lt;br/&gt;Â &lt;span&gt;defer&lt;/span&gt;Â cn.condRelease(&amp;amp;err)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;0&lt;/span&gt;,Â err&lt;br/&gt;Â }&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;func&lt;/span&gt;&lt;span&gt;(rwÂ *bufio.ReadWriter)&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â Â line,Â eÂ :=Â writeReadLine(rw,Â &lt;span&gt;&quot;%sÂ %sÂ %d\r\n&quot;&lt;/span&gt;,Â verb,Â key,Â delta)&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â eÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â e&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;switch&lt;/span&gt;Â {&lt;br/&gt;Â Â &lt;span&gt;case&lt;/span&gt;Â bytes.Equal(line,Â resultNotFound):&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â ErrCacheMiss&lt;br/&gt;Â Â &lt;span&gt;case&lt;/span&gt;Â bytes.HasPrefix(line,Â resultClientErrorPrefix):&lt;br/&gt;Â Â Â errMsgÂ :=Â line[&lt;span&gt;len&lt;/span&gt;(resultClientErrorPrefix)Â :Â &lt;span&gt;len&lt;/span&gt;(line)&lt;span&gt;-2&lt;/span&gt;]&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â errors.New(&lt;span&gt;&quot;memcache:Â clientÂ error:Â &quot;&lt;/span&gt;Â +Â &lt;span&gt;string&lt;/span&gt;(errMsg))&lt;br/&gt;Â Â }&lt;br/&gt;Â Â val,Â eÂ =Â strconv.ParseUint(&lt;span&gt;string&lt;/span&gt;(line[:&lt;span&gt;len&lt;/span&gt;(line)&lt;span&gt;-2&lt;/span&gt;]),Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;64&lt;/span&gt;)&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â eÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;return&lt;/span&gt;Â e&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;nil&lt;/span&gt;&lt;br/&gt;Â }(cn.rw)&lt;br/&gt;Â &lt;span&gt;return&lt;/span&gt;Â val,Â err&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æµ‹è¯•ä»£ç ï¼Œå¯åŠ¨ä¸€ä¸ªhttpæœåŠ¡å™¨å…ˆè®¾ç½®åˆ°memcachedä¸­ï¼Œé€šè¿‡/hello æ¥å£ä»memcachedä¸­è·å–å¯¹åº”çš„å€¼&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;package&lt;/span&gt;Â main&lt;br/&gt;&lt;br/&gt;&lt;span&gt;import&lt;/span&gt;Â (&lt;br/&gt;Â &lt;span&gt;&quot;fmt&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;memcache_go/memcache&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;net&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;net/http&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&quot;time&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span&gt;var&lt;/span&gt;Â clientÂ *memcache.Client&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;IndexHandler&lt;/span&gt;&lt;span&gt;(wÂ http.ResponseWriter,Â rÂ *http.Request)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â ret,Â errÂ :=Â client.Get(&lt;span&gt;&quot;tcp_key&quot;&lt;/span&gt;)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â fmt.Fprintln(w,Â &lt;span&gt;&quot;errÂ &quot;&lt;/span&gt;)&lt;br/&gt;Â }&lt;br/&gt;Â strÂ :=Â &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â retÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â strÂ =Â &lt;span&gt;string&lt;/span&gt;(ret.Value)&lt;br/&gt;Â Â fmt.Fprintln(w,Â &lt;span&gt;&quot;helloÂ world&quot;&lt;/span&gt;,Â str)&lt;br/&gt;Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â fmt.Fprintln(w,Â &lt;span&gt;&quot;nil&quot;&lt;/span&gt;)&lt;br/&gt;Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;touchHandler&lt;/span&gt;&lt;span&gt;(wÂ http.ResponseWriter,Â rÂ *http.Request)&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â errÂ :=Â client.Touch(&lt;span&gt;&quot;tcp_key&quot;&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â fmt.Fprintln(w,Â &lt;span&gt;&quot;errÂ &quot;&lt;/span&gt;)&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â fmt.Fprintln(w,Â &lt;span&gt;&quot;succ&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;func&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt;Â {&lt;br/&gt;Â addr,Â errÂ :=Â net.ResolveTCPAddr(&lt;span&gt;&quot;tcp&quot;&lt;/span&gt;,Â &lt;span&gt;&quot;127.0.0.1:12001&quot;&lt;/span&gt;)&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â fmt.Println(fmt.Sprintf(&lt;span&gt;&quot;getÂ errÂ %v&quot;&lt;/span&gt;,Â err))&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â clientÂ =Â memcache.NewClient(&lt;span&gt;30&lt;/span&gt;*time.Second,Â &lt;span&gt;30&lt;/span&gt;,Â addr)&lt;br/&gt;&lt;br/&gt;Â errÂ =Â client.Add(&amp;amp;memcache.Item{&lt;br/&gt;Â Â Key:Â Â Â Â Â Â Â Â &lt;span&gt;&quot;tcp_key&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Value:Â Â Â Â Â Â []&lt;span&gt;byte&lt;/span&gt;(fmt.Sprintf(&lt;span&gt;&quot;tcp_key_value_%d&quot;&lt;/span&gt;,Â time.Now().UnixNano())),&lt;br/&gt;Â Â Flags:Â Â Â Â Â Â &lt;span&gt;0&lt;/span&gt;,&lt;br/&gt;Â Â Expiration:Â &lt;span&gt;0&lt;/span&gt;,&lt;br/&gt;Â })&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â errÂ !=Â &lt;span&gt;nil&lt;/span&gt;Â {&lt;br/&gt;Â Â fmt.Println(&lt;span&gt;&quot;æ‰§è¡Œå¤±è´¥&quot;&lt;/span&gt;)&lt;br/&gt;Â Â &lt;span&gt;//return&lt;/span&gt;&lt;br/&gt;Â }&lt;br/&gt;Â http.HandleFunc(&lt;span&gt;&quot;/get&quot;&lt;/span&gt;,Â IndexHandler)&lt;br/&gt;Â http.HandleFunc(&lt;span&gt;&quot;/touch&quot;&lt;/span&gt;,Â touchHandler)&lt;br/&gt;Â http.ListenAndServe(&lt;span&gt;&quot;127.0.0.1:8000&quot;&lt;/span&gt;,Â &lt;span&gt;nil&lt;/span&gt;)&lt;br/&gt;Â &lt;span&gt;//fmt.Println(&quot;memcache_test...&quot;)&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;for&lt;/span&gt;Â {&lt;br/&gt;Â Â time.Sleep(&lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;30&lt;/span&gt;)&lt;br/&gt;Â }&lt;br/&gt;}Â Â &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯åŠ¨memcachedæœåŠ¡è¿›è¡Œæµ‹è¯•&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;memcachedÂ -mÂ &lt;span&gt;1024&lt;/span&gt;Â Â -uÂ rootÂ -lÂ &lt;span&gt;127.0&lt;/span&gt;&lt;span&gt;.0&lt;/span&gt;&lt;span&gt;.1&lt;/span&gt;Â -pÂ &lt;span&gt;12001&lt;/span&gt;Â -cÂ &lt;span&gt;55535&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-dé€‰é¡¹æ˜¯å¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-mæ˜¯åˆ†é…ç»™Memcacheä½¿ç”¨çš„å†…å­˜æ•°é‡ï¼Œå•ä½æ˜¯MBï¼Œæˆ‘è¿™é‡Œæ˜¯10MB&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-uæ˜¯è¿è¡ŒMemcacheçš„ç”¨æˆ·&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-læ˜¯ç›‘å¬çš„æœåŠ¡å™¨IPåœ°å€ï¼Œå¦‚æœæœ‰å¤šä¸ªåœ°å€çš„è¯ï¼Œæˆ‘è¿™é‡ŒæŒ‡å®šäº†æœåŠ¡å™¨çš„IPåœ°å€127.0.0.1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-pæ˜¯è®¾ç½®Â Memcacheç›‘å¬çš„ç«¯å£ï¼Œæˆ‘è¿™é‡Œè®¾ç½®äº†12001ï¼Œæœ€å¥½æ˜¯1024ä»¥ä¸Šçš„ç«¯å£&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-cé€‰é¡¹æ˜¯æœ€å¤§è¿è¡Œçš„å¹¶å‘è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯1024ï¼Œæˆ‘è¿™é‡Œè®¾ç½®äº†Â 256ï¼ŒæŒ‰ç…§ä½ æœåŠ¡å™¨çš„è´Ÿè½½é‡æ¥è®¾å®š&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//-Pæ˜¯è®¾ç½®ä¿å­˜Memcacheçš„pidæ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œæ˜¯ä¿å­˜åœ¨Â /tmp/memcached.pid&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//åœæ­¢è¿›ç¨‹ï¼š# kill `cat /tmp/memcached.pid`Â Â &lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åˆ°è¿™é‡Œæˆ‘ä»¬å¤§æ¦‚ç”¨äº†å‡ ç™¾è¡Œä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„memcachedé“¾æ¥é©±åŠ¨çš„å­é›†ï¼Œå¯¹åº”ç”¨ç¨‹åºå’Œmemcachedå¦‚ä½•é€šè®¯æœ‰äº†å¤§è‡´äº†è§£ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¥½äº†ï¼Œä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™ï¼Œå¸Œæœ›å¯¹å„ä½æœ‰ç”¨ã€‚&lt;strong&gt;ã€ŒåŸåˆ›ä¸æ˜“ï¼Œå¤šå¤šåˆ†äº«ã€&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æƒ³è¦æ›´å¤šäº¤æµå¯ä»¥åŠ ç¾¤ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.2585227272727273&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdfjlwvwuTBicwZP34Pk8kpgiaaAicEh9yPjqfTJLBOMia0aPBJZRLvHIjMH27pnxsmgdTQicaY4aOXdtAEBVJkCSiaA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1056&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¹Ÿå¯ä»¥åŠ å…¥çŸ¥è¯†æ˜Ÿçƒå…è´¹æé—®ï¼š&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.2923076923076924&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/JdfjlwvwuTBicwZP34Pk8kpgiaaAicEh9yPptIEtuXVeuVzxPhziaiaCHeHy5IckpPZUm9vog1xgia5X2ZSqIHLeHUEQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1170&quot;/&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>