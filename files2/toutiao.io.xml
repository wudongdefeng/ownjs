<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>0299fcac506b8b51d268eca80a3d72c6</guid>
<title>DDD 之业务系统搭建的设计思考</title>
<link>https://toutiao.io/k/783naw9</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;profile_inner&quot;&gt;
                  &lt;strong class=&quot;profile_nickname&quot;&gt;蚂蚁研发效能&lt;/strong&gt;
                  &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;/&gt;

                  &lt;p class=&quot;profile_meta&quot;&gt;
                  &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                  &lt;span class=&quot;profile_meta_value&quot;&gt;AntLinkE&lt;/span&gt;
                  &lt;/p&gt;

                  &lt;p class=&quot;profile_meta&quot;&gt;
                  &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                  &lt;span class=&quot;profile_meta_value&quot;&gt;蚂蚁集团研发效能部有业界领先的工程和学术造诣，致力于为蚂蚁和多家金融企业提供核电级的全生命周期研发产品。&lt;/span&gt;
                  &lt;/p&gt;
                &lt;/div&gt;
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f09a0763c74aaf1f79c894cf81d4d6c5</guid>
<title>IM 通讯协议专题学习（一）：Protobuf 从入门到精通，一篇就够</title>
<link>https://toutiao.io/k/184gzpt</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content             autoTypeSetting24psection&amp;#10;            &quot; id=&quot;js_content&quot;&gt;&lt;h2 data-mpa-powered-by=&quot;yiban.io&quot;&gt;一、引言&lt;/h2&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;在当今移动网络时代，手机流量和电量是宝贵的资源，对于移动端最常见的即时通讯IM应用，由于实时通信基于Socket长连接，它对于流量和电量的需求较一般应用来说更高（&lt;/span&gt;&lt;span&gt;详见《&lt;/span&gt;&lt;/span&gt;&lt;span&gt;移动端IM实践：WhatsApp、Line、微信的心跳策略分析&lt;/span&gt;&lt;span&gt;&lt;span&gt;》&lt;/span&gt;&lt;span&gt;）。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;在IM应用中，优化数据流量消耗过多的基本方法就是使用高度压缩的通讯协议，而数据压缩后流量减小带来的自然结果也就是省电：因为大数据量的传输必然需要更久的网络操作、数据序列化及反序列化操作，这些都是电量消耗过快的根源。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;当前IM应用中最热门的通讯协议无疑就是Google的Protobuf了，基于它的优秀表现，微信和手机QQ这样的主流IM应用也早已在使用它。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;本文作为《IM通讯协议专题学习》系列文章的首篇，将从初学者的角度，用通俗简洁的文字，从零开始为你介绍Protobuf的方方面面，特别适合新手入门。&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;ignore_js_op&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2962962962962963&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/st3UArDtcvLDJkS2U0NAJUEsicQx0U5HZvlqk9T0k8MtweDKMvoFrLIxEibT9icxLuicWOzlERcBQu6UtBiaaW8AQnw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;567&quot; title=&quot;IM通讯协议专题学习(一)：Protobuf从入门到精通，一篇就够！_cover1-opti.png&quot;/&gt;&lt;/ignore_js_op&gt;&lt;/p&gt;&lt;h2&gt;二、本文目录&lt;/h2&gt;&lt;section&gt;&lt;em&gt;&lt;strong&gt;&lt;span&gt;1）&lt;/span&gt;&lt;/strong&gt;&lt;/em&gt;&lt;span&gt;引言&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;em&gt;&lt;span&gt;2）&lt;/span&gt;&lt;/em&gt;&lt;/strong&gt;&lt;span&gt;系列文章&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;em&gt;&lt;strong&gt;&lt;span&gt;3）&lt;/span&gt;&lt;/strong&gt;&lt;/em&gt;&lt;span&gt;什么是Protocol Buffer？&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;em&gt;&lt;strong&gt;&lt;span&gt;4）&lt;/span&gt;&lt;/strong&gt;&lt;/em&gt;&lt;span&gt;一个简单的例子&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4.1安装Protobuf&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4.2关于简单例子的描述    &lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4.3书写 .proto 文件&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4.4编译 .proto 文件&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4.5编写 writer 和 Reader&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;4.6运行结果&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;em&gt;&lt;strong&gt;&lt;span&gt;5）&lt;/span&gt;&lt;/strong&gt;&lt;/em&gt;&lt;span&gt;和其他类似技术的比较&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;5.1概述&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;5.2Protobuf 的优点&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;5.3Protobuf 的不足&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;em&gt;&lt;strong&gt;&lt;span&gt;6）&lt;/span&gt;&lt;/strong&gt;&lt;/em&gt;&lt;span&gt;Protobuf 的更多细节&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;6.1概述&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;6.2Protobuf的Encoding&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;6.3封解包的速度&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;em&gt;&lt;strong&gt;&lt;span&gt;7）&lt;/span&gt;&lt;/strong&gt;&lt;/em&gt;&lt;span&gt;写在最后&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;em&gt;&lt;strong&gt;&lt;span&gt;8）&lt;/span&gt;&lt;/strong&gt;&lt;/em&gt;&lt;span&gt;参考资料&lt;/span&gt;&lt;/section&gt;&lt;h2&gt;三、系列文章&lt;/h2&gt;&lt;p&gt;&lt;span&gt;本文是系列文章中的第 &lt;em&gt;1&lt;/em&gt; 篇，本系列总目录如下：&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;《IM通讯协议专题学习(一)：Protobuf从入门到精通，一篇就够！》（&lt;span&gt;* 本文&lt;/span&gt;）&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;《IM通讯协议专题学习(二)：快速理解ProtoBuf的背景、原理、使用、优缺点》（稍后发布..）&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;《IM通讯协议专题学习(三)：由浅入深，从通信编解码原理上理解Protobuf》（稍后发布..）&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;《IM通讯协议专题学习(四)：从Base64到Protobuf，详解Protobuf的数据编码原理》（稍后发布..）&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;《IM通讯协议专题学习(五)：Protobuf到底比JSON快几倍？请看全方位实测！》（稍后发布..）&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;《IM通讯协议专题学习(六)：手把手教你如何在Android上从零使用Protobuf》（稍后发布..）&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;《IM通讯协议专题学习(七)：手把手教你如何在NodeJS中从零使用Protobuf》（稍后发布..）&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;《IM通讯协议专题学习(八)：金蝶随手记团队的Protobuf应用实践(原理篇)  》（稍后发布..）&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;《IM通讯协议专题学习(九)：金蝶随手记团队的Protobuf应用实践(实战篇) 》（稍后发布..）&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;span&gt;四、&lt;/span&gt;什么是Protocol Buffer？&lt;/h2&gt;&lt;p&gt;&lt;span&gt;什么是 Google Protocol Buffer？&lt;/span&gt;&lt;span&gt;&lt;br/&gt;&lt;br/&gt;假如您在网上搜索，应该会得到类似于下面这样的文字介绍：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Google Protocol Buffer（简称 Protobuf）是 Google 公司内部的混合语言数据标准，目前已经正在使用的有超过 48,162 种报文格式定义和超过 12,183 个 .proto 文件。他们常用于 RPC 系统和持续数据存储系统等应用场景。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;实际上：&lt;/span&gt;&lt;span&gt;Protocol Buffers（&lt;/span&gt;&lt;span&gt;简称 Protobuf&lt;/span&gt;&lt;span&gt;）是一种轻便高效的结构化数据存储格式，可以用于结构化数据串行化，或者说序列化。它很适合做数据存储或 RPC 数据交换格式。可用于通讯协议、数据存储等领域的语言无关、平台无关、可扩展的序列化结构数据格式。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;目前：&lt;/span&gt;&lt;span&gt;Protobuf官方工程主页上显示的已支持的开发语言多达10种，分别有：C++、Java、Python、Objective-C、C#、Ruby、Go、PHP、Dart、Javascript，基本上主流的语言都已支持（&lt;/span&gt;&lt;span&gt;具体详见Protobuf工程主页：&lt;/span&gt;&lt;/span&gt;&lt;span&gt;https://github.com/protocolbuffers/protobuf&lt;/span&gt;&lt;span&gt;）。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;Protobuf已支持的开发语言如下图：&lt;/span&gt;&lt;br/&gt;&lt;ignore_js_op&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6976351351351351&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/st3UArDtcvLDJkS2U0NAJUEsicQx0U5HZusBZgvFicteaCnx0yRLMEodhdUiaWaDZS1A9XQtYDC6Y00APibicmrpibbQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;592&quot; title=&quot;IM通讯协议专题学习(一)：Protobuf从入门到精通，一篇就够！_1.png&quot;/&gt;&lt;/ignore_js_op&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;PS：&lt;/span&gt;&lt;span&gt;Protobuf的官网上有很多入门资料，有兴趣一定要看看：&lt;/span&gt;&lt;/span&gt;&lt;span&gt;https://developers.google.com/protocol-buffers&lt;/span&gt;&lt;span&gt;&lt;span&gt;（&lt;/span&gt;&lt;span&gt;如果不能直接访问，你懂的。。。&lt;/span&gt;&lt;span&gt;）&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;写到这里：&lt;/span&gt;&lt;span&gt;或许您和我一样，在第一次看完这些介绍后还是不明白 Protobuf 究竟是什么，那么我想一个简单的例子应该比较有助于理解它（&lt;/span&gt;&lt;span&gt;请继续往下阅读&lt;/span&gt;&lt;span&gt;）。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;h2&gt;五、一个简单的例子&lt;/h2&gt;&lt;h3&gt;&lt;span&gt;&lt;span&gt;5.1&lt;/span&gt;安装Protobuf&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;在网站 &lt;/span&gt;&lt;span&gt;https://developers.google.com/protocol-buffers&lt;/span&gt;&lt;span&gt;&lt;span&gt; 上可以下载 Protobuf 的源代码。然后解压编译安装便可以使用它了。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;安装步骤如下所示：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;span&gt;1&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;4&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;5&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;6&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;tar&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;-xzf protobuf-2.1.0.&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;tar&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;.gz&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;cd&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;protobuf-2.1.0&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;.&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;/configure&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;--prefix=$INSTALL_DIR&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;make&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;make&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;check&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;make&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;h3&gt;&lt;span&gt;5.2&lt;/span&gt;关于简单例子的描述&lt;/h3&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;我打算使用 Protobuf 和 C++ 开发一个十分简单的例子程序。该程序由两部分组成。第一部分被称为 Writer，第二部分叫做 Reader。Writer 负责将一些结构化的数据写入一个磁盘文件，Reader 则负责从该磁盘文件中读取结构化数据并打印到屏幕上。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;准备用于演示的结构化数据是 HelloWorld，它包含两个基本数据：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;em&gt;1）&lt;/em&gt;&lt;/strong&gt;&lt;span&gt;ID&lt;/span&gt;：&lt;/span&gt;&lt;span&gt;为一个整数类型的数据；&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;em&gt;2）&lt;/em&gt;&lt;/strong&gt;&lt;span&gt;Str&lt;/span&gt;：&lt;/span&gt;&lt;span&gt;这是一个字符串。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;&lt;span&gt;&lt;span&gt;5.3&lt;/span&gt;书写 .proto 文件&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;首先我们需要编写一个 proto 文件，定义我们程序中需要处理的结构化数据，在 protobuf 的术语中，结构化数据被称为 Message。proto 文件非常类似 java 或者 C 语言的数据定义。代码清单 1 显示了例子应用中的 proto 文件内容。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;清单 1. proto 文件：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;span&gt;1&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;4&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;5&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;6&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;7&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;package lm;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;message helloworld&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;{&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;   &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;required int32     id = 1;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;// ID&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;   &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;required string    str = 2;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;// str&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;   &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;optional int32     opt = 3;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;//optional field&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;一个比较好的习惯是认真对待 proto 文件的文件名。比如将命名规则定于如下：&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;span&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;packageName.MessageName.proto&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;在上例中，package 名字叫做 lm，定义了一个消息 helloworld，该消息有三个成员，类型为 int32 的 id，另一个为类型为 string 的成员 str。opt 是一个可选的成员，即消息中可以不包含该成员。&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;&lt;span&gt;&lt;span&gt;5.4&lt;/span&gt;编译 .proto 文件&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;写好 proto 文件之后就可以用 Protobuf 编译器将该文件编译成目标语言了。本例中我们将使用 C++。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;假设您的 proto 文件存放在 $SRC_DIR 下面，您也想把生成的文件放在同一个目录下，则可以使用如下命令：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;span&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;protoc -I=$SRC_DIR --cpp_out=$DST_DIR $SRC_DIR&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;/addressbook&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;.proto&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;命令将生成两个文件：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在生成的头文件中，定义了一个 C++ 类 helloworld，后面的 Writer 和 Reader 将使用这个类来对消息进行操作。诸如对消息的成员进行赋值，将消息序列化等等都有相应的方法。&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;&lt;span&gt;&lt;span&gt;5.5&lt;/span&gt;编写 writer 和 Reader&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;如前所述，Writer 将把一个结构化数据写入磁盘，以便其他人来读取。假如我们不使用 Protobuf，其实也有许多的选择。一个可能的方法是将数据转换为字符串，然后将字符串写入磁盘。转换为字符串的方法可以使用 &lt;/span&gt;&lt;span&gt;sprintf()&lt;/span&gt;&lt;span&gt;，这非常简单。数字 123 可以变成字符串“123”。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;这样做似乎没有什么不妥，但是仔细考虑一下就会发现，这样的做法对写 Reader 的那个人的要求比较高，Reader 的作者必须了 Writer 的细节。比如“123”可以是单个数字 123，但也可以是三个数字 1、2 和 3，等等。这么说来，我们还必须让 Writer 定义一种分隔符一样的字符，以便 Reader 可以正确读取。但分隔符也许还会引起其他的什么问题。最后我们发现一个简单的 Helloworld 也需要写许多处理消息格式的代码。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;如果使用 Protobuf，那么这些细节就可以不需要应用程序来考虑了。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;使用 Protobuf，Writer 的工作很简单，需要处理的结构化数据由 &lt;/span&gt;&lt;span&gt;.proto&lt;/span&gt;&lt;span&gt; 文件描述，经过上一节中的编译过程后，该数据化结构对应了一个 C++ 的类，并定义在 &lt;/span&gt;&lt;span&gt;lm.helloworld.pb.h&lt;/span&gt;&lt;span&gt; 中。对于本例，类名为 &lt;/span&gt;&lt;span&gt;lm::helloworld&lt;/span&gt;&lt;span&gt;。Writer 需要 include 该头文件，然后便可以使用这个类了。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;现在，在 Writer 代码中，将要存入磁盘的结构化数据由一个 &lt;/span&gt;&lt;span&gt;lm::helloworld&lt;/span&gt;&lt;span&gt; 类的对象表示，它提供了一系列的 get/set 函数用来修改和读取结构化数据中的数据成员，或者叫 field。当我们需要将该结构化数据保存到磁盘上时，类 &lt;/span&gt;&lt;span&gt;lm::helloworld&lt;/span&gt;&lt;span&gt; 已经提供相应的方法来把一个复杂的数据变成一个字节序列，我们可以将这个字节序列写入磁盘。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;对于想要读取这个数据的程序来说，也只需要使用类 &lt;/span&gt;&lt;span&gt;lm::helloworld&lt;/span&gt;&lt;span&gt; 的相应反序列化方法来将这个字节序列重新转换会结构化数据。这同我们开始时那个“123”的想法类似，不过 Protobuf 想的远远比我们那个粗糙的字符串转换要全面，因此，我们不如放心将这类事情交给 Protobuf 吧。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;程序清单 2 演示了 Writer 的主要代码，您一定会觉得很简单吧？&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;清单 2. Writer 的主要代码：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;span&gt;01&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;02&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;03&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;04&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;05&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;06&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;07&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;08&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;09&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;10&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;11&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;12&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;13&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;14&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;15&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;16&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;17&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;18&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;19&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;#include &quot;lm.helloworld.pb.h&quot;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;…&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;int&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;main(&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;void&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;{&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;lm::helloworld msg1;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;msg1.set_id(101);&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;msg1.set_str(“hello”);&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;    &lt;/span&gt;&lt;/code&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;// Write the new address book back to disk.&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;fstream output(&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;&quot;./log&quot;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;, ios::out | ios::trunc | ios::binary);&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;        &lt;/span&gt;&lt;/code&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;if&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;(!msg1.SerializeToOstream(&amp;amp;output)) {&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;      &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;cerr &amp;lt;&amp;lt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;&quot;Failed to write msg.&quot;&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;&amp;lt;&amp;lt; endl;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;      &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;return&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;-1;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;}        &lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;return&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;0;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;Msg1 是一个 helloworld 类的对象，set_id() 用来设置 id 的值。SerializeToOstream 将对象序列化后写入一个 fstream 流。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;代码清单 3 列出了 reader 的主要代码。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;清单 3. Reader：&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;span&gt;01&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;02&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;03&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;04&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;05&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;06&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;07&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;08&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;09&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;10&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;11&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;12&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;13&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;14&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;15&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;16&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;17&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;18&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;19&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;20&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;21&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;22&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;#include &quot;lm.helloworld.pb.h&quot;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;…&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;void&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;ListMsg(&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;const&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;lm::helloworld &amp;amp; msg) {&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;cout &amp;lt;&amp;lt; msg.id() &amp;lt;&amp;lt; endl;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;cout &amp;lt;&amp;lt; msg.str() &amp;lt;&amp;lt; endl;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;int&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;main(&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;int&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;argc, &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;char&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;* argv[]) {&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;lm::helloworld msg1;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;{&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;    &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;fstream input(&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;&quot;./log&quot;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;, ios::in | ios::binary);&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;    &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;if&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;(!msg1.ParseFromIstream(&amp;amp;input)) {&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;      &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;cerr &amp;lt;&amp;lt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;&quot;Failed to parse address book.&quot;&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;&amp;lt;&amp;lt; endl;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;      &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;return&lt;/span&gt;&lt;/code&gt; &lt;code&gt;&lt;span&gt;-1;&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;    &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;ListMsg(msg1);&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;…&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt; &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;同样，Reader 声明类 helloworld 的对象 msg1，然后利用 ParseFromIstream 从一个 fstream 流中读取信息并反序列化。此后，ListMsg 中采用 get 方法读取消息的内部信息，并进行打印输出操作。&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;&lt;span&gt;&lt;span&gt;5.6&lt;/span&gt;运行结果&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;运行 Writer 和 Reader 的结果如下：&lt;/span&gt;&lt;/p&gt;&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;span&gt;1&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;4&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;&amp;gt;writer&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;&amp;gt;reader&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;101&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;&lt;span&gt;Hello&lt;/span&gt;&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;Reader 读取文件 log 中的序列化信息并打印到屏幕上。本文中所有的例子代码都可以在附件中下载。您可以亲身体验一下。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;这个例子本身并无意义，但只要您稍加修改就可以将它变成更加有用的程序。比如将磁盘替换为网络 socket，那么就可以实现基于网络的数据交换任务。而存储和交换正是 Protobuf 最有效的应用领域。&lt;/span&gt;&lt;/p&gt;&lt;h2&gt;六、和其他类似技术的比较&lt;/h2&gt;&lt;h3&gt;&lt;span&gt;&lt;span&gt;6.1&lt;/span&gt;概述&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;看完这个简单的例子之后，希望您已经能理解 Protobuf 能做什么了，那么您可能会说，世上还有很多其他的类似技术啊，比如 XML，JSON，Thrift 等等。和他们相比，Protobuf 有什么不同呢？&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;简单说来 Protobuf 的主要优点就是：简单，快。这有测试为证，项目 thrift-protobuf-compare 比较了这些类似的技术，下图显示了该项目的一项测试结果——Total Time。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;性能测试结果：&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;ignore_js_op&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.61&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/st3UArDtcvLDJkS2U0NAJUEsicQx0U5HZcnQ0iaIpSV8NktDZpoeh2VsWUmTgPwOVNibIpA947jB0cptNJYUGfwdA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;600&quot; title=&quot;IM通讯协议专题学习(一)：Protobuf从入门到精通，一篇就够！_2.png&quot;/&gt;&lt;/ignore_js_op&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;Total Time 指一个对象操作的整个时间，包括创建对象，将对象序列化为内存中的字节序列，然后再反序列化的整个过程。从测试结果可以看到 Protobuf 的成绩很好，感兴趣的读者可以自行到网站 &lt;/span&gt;&lt;span&gt;https://github.com/eishay/jvm-serializers/wiki&lt;/span&gt;&lt;span&gt;上了解更详细的测试结果。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;6.2&lt;/span&gt;&lt;span&gt;Protobuf 的优点&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;Protobuf 有如 XML，不过它更小、更快、也更简单。你可以定义自己的数据结构，然后使用代码生成器生成的代码来读写这个数据结构。你甚至可以在无需重新部署程序的情况下更新数据结构。只需使用 Protobuf 对数据结构进行一次描述，即可利用各种不同语言或从各种不同数据流中对你的结构化数据轻松读写。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;它有一个非常棒的特性，即“向后”兼容性好，人们不必破坏已部署的、依靠“老”数据格式的程序就可以对数据结构进行升级。这样您的程序就可以不必担心因为消息结构的改变而造成的大规模的代码重构或者迁移的问题。因为添加新的消息中的 field 并不会引起已经发布的程序的任何改变。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;Protobuf 语义更清晰，无需类似 XML 解析器的东西（&lt;/span&gt;&lt;span&gt;因为 Protobuf 编译器会将 .proto 文件编译生成对应的数据访问类以对 Protobuf 数据进行序列化、反序列化操作&lt;/span&gt;&lt;span&gt;）。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;使用 Protobuf 无需学习复杂的文档对象模型，Protobuf 的编程模式比较友好，简单易学，同时它拥有良好的文档和示例，对于喜欢简单事物的人们而言，Protobuf 比其他的技术更加有吸引力。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;span&gt;6.3&lt;/span&gt;&lt;span&gt;Protobuf 的不足&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;Protbuf 与 XML 相比也有不足之处。它功能简单，无法用来表示复杂的概念。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;XML 已经成为多种行业标准的编写工具，Protobuf 只是 Google 公司内部使用的工具，在通用性上还差很多。&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;由于文本并不适合用来描述数据结构，所以 Protobuf 也不适合用来对基于文本的标记文档（&lt;/span&gt;&lt;span&gt;如 HTML&lt;/span&gt;&lt;span&gt;）建模。另外，由于 XML 具有某种程度上的自解释性，它可以被人直接读取编辑，在这一点上 Protobuf 不行，它以二进制的方式存储，除非你有 .proto 定义，否则你没法直接读出 Protobuf 的任何内容。&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;h2&gt;七、参考资料&lt;/h2&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;span/&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op/&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op/&gt;&lt;/ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;strong&gt;[1]&lt;/strong&gt; &lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;移动端IM实践：WhatsApp、Line、微信的心跳策略分析&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;http://www.52im.net/thread-121-1-2.html&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;strong&gt;&lt;span&gt;[2] &lt;/span&gt;&lt;/strong&gt;&lt;/ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;Protobuf通信协议详解：代码演示、详细原理介绍等&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;http://www.52im.net/thread-323-1-1.html&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;[3] &lt;/span&gt;&lt;/strong&gt;&lt;span&gt;如何选择即时通讯应用的数据传输格式&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;http://www.52im.net/thread-276-1-1.html&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;[4]&lt;/span&gt;&lt;/strong&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt;强列建议将Protobuf作为你的即时通讯应用数据传输格式&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;http://www.52im.net/thread-277-1-1.html&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;[5] &lt;/span&gt;&lt;/strong&gt;&lt;span&gt;APP与后台通信数据格式的演进：从文本协议到二进制协议&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;http://www.52im.net/thread-1536-1-1.html&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;[6]&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;面试必考，史上最通俗大小端字节序详解&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;http://www.52im.net/thread-3101-1-1.html&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;[7] &lt;/span&gt;&lt;/strong&gt;&lt;span&gt;移动端IM开发需要面对的技术问题（含通信协议选择）&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;http://www.52im.net/thread-133-1-1.html&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;[8] &lt;/span&gt;&lt;/strong&gt;&lt;span&gt;简述移动端IM开发的那些坑：架构设计、通信协议和客户端&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;http://www.52im.net/thread-289-1-1.html&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;[9]&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;理论联系实际：一套典型的IM通信协议设计详解&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;http://www.52im.net/thread-283-1-1.html&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;[10]&lt;/span&gt;&lt;/strong&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt;58到家实时消息系统的协议设计等技术实践分享&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;http://www.52im.net/thread-298-1-1.html&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;section&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;ignore_js_op&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/ignore_js_op&gt;&lt;/section&gt;&lt;h2&gt;八、全文链接&lt;/h2&gt;&lt;p&gt;&lt;span&gt;即时通讯网(52im.net)&lt;/span&gt;&lt;span&gt;&lt;span&gt;社区链接：&lt;/span&gt;&lt;span&gt;http://www.52im.net/thread-4080-1-1.html&lt;/span&gt;&lt;span&gt;，或点击下文的“&lt;/span&gt;&lt;span&gt;&lt;strong&gt;阅读原文&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;”！&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;mp-style-type data-value=&quot;3&quot;/&gt;&lt;/p&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>c43dd999e9a845f8b61aa6b85d392409</guid>
<title>Elasticsearch 亿级数据性能优化</title>
<link>https://toutiao.io/k/01odw5a</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content             autoTypeSetting24psection&amp;#10;            &quot; id=&quot;js_content&quot;&gt;&lt;blockquote class=&quot;js_blockquote_wrap&quot; data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;70&quot; data-source-title=&quot;&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;section class=&quot;js_blockquote_digest&quot;&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;作者：mikevictor&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;链接：https://www.cnblogs.com/mikevictor07/p/10006553.html&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;&lt;span&gt;一、前言&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;数据平台已迭代三个版本，从头开始遇到很多常见的难题，终于有片段时间整理一些已完善的文档，在此分享以供所需朋友的&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;实现参考，少走些弯路，在此篇幅中偏重于ES的优化，关于HBase，Hadoop的设计优化估计有很多文章可以参考，不再赘述。&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/h3&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;&lt;span&gt;二、需求说明&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;项目背景：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在一业务系统中，部分表每天的数据量过亿，已按天分表，但业务上受限于按天查询，并且DB中只能保留3个月的数据(硬件高配)，分库代价较高。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;改进版本目标：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1. 数据能跨月查询，并且支持1年以上的历史数据查询与导出。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2. 按条件的数据查询秒级返回。&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/h3&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;&lt;span&gt;三、ES 检索原理&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt; &lt;strong&gt;3.1 关于ES和Lucene基础结构&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;谈到优化，必须能了解组件的基本原理，才容易找到瓶颈所在，以免走多种弯路，先从ES的基础结构说起(如下图)：&lt;/span&gt;&lt;/p&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6666666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmG1NRw0WbficIXDN1Kj3Yog84icBsiaB5a4ZVVPBKxNNPibySK1W6rVbNyCQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;650&quot; title=&quot;img&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt; &lt;strong&gt;一些基本概念:&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;Cluster&lt;/strong&gt; 包含多个Node的集群&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;Node&lt;/strong&gt; 集群服务单元&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;Index&lt;/strong&gt; 一个ES索引包含一个或多个物理分片，它只是这些分片的逻辑命名空间&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;Type&lt;/strong&gt; 一个index的不同分类，6.x后只能配置一个type，以后将移除&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;Document&lt;/strong&gt; 最基础的可被索引的数据单元，如一个JSON串&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;Shards&lt;/strong&gt; 一个分片是一个底层的工作单元，它仅保存全部数据中的一部分，它是一个Lucence实例 &lt;em&gt;(一个lucene索引最大包含2,147,483,519 (= Integer.MAX_VALUE - 128)个文档数量)&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;Replicas&lt;/strong&gt; 分片备份，用于保障数据安全与分担检索压力&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;span&gt;ES依赖一个重要的组件Lucene，关于数据结构的优化通常来说是对Lucene的优化，它是集群的一个存储于检索工作单元，结构如下图：&lt;/span&gt;&lt;/p&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6666666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGc2d7OAUV35wR04jIE3DEoFpiapMs7aQH1iaCibfFtDtTrSqk6Ua5uzJDQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;650&quot; title=&quot;img&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;span&gt;在Lucene中，分为索引(录入)与检索(查询)两部分，索引部分包含 &lt;strong&gt;分词器、过滤器、字符映射器&lt;/strong&gt; 等，检索部分包含 &lt;strong&gt;查询解析器&lt;/strong&gt; 等。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;一个Lucene索引包含多个segments，一个segment包含多个文档，每个文档包含多个字段，每个字段经过分词后形成一个或多个term。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;通过Luke工具查看ES的lucene文件如下，主要增加了_id和_source字段:&lt;/span&gt;&lt;/p&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6666666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGc0sffGurhVBEDGUwdiahbhTvzeLZuz0DzVicco98hUH7ppAVMna4SuZQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;599&quot; title=&quot;img&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;3.2 Lucene索引实现&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Lucene 索引文件结构主要的分为：词典、倒排表、正向文件、DocValues等，如下图:&lt;/span&gt;&lt;/p&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6666666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGjsictf0aict7ConibGGO0Cu0rP877ic73kSltEZQBib5Yezteic6SxqAyAkw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;600&quot; title=&quot;img&quot;/&gt;&lt;/figure&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6666666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGM0F0mQeFSCbXAMKN4MDjUM5TIgJdJ6e8UE76dE2UYLGOIgmewBm5bA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;650&quot; title=&quot;img&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;注：整理来源于lucene官方: &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;em&gt;http://lucene.apache.org/core/7_2_1/core/org/apache/lucene/codecs/lucene70/package-summary.html#package.description&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Lucene 随机三次磁盘读取比较耗时。其中.fdt文件保存数据值损耗空间大，.tim和.doc则需要SSD存储提高随机读写性能。&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;另外一个比较消耗性能的是打分流程，不需要则可屏蔽。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt; &lt;strong&gt;关于DocValues： &lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;倒排索引解决从词快速检索到相应文档ID, 但如果需要对结果进行排序、分组、聚合等操作的时候则需要根据文档ID快速找到对应的值。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;通过倒排索引代价却很高：需迭代索引里的每个词项并收集文档的列里面 token。这很慢而且难以扩展：随着词项和文档的数量增加，执行时间也会增加。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Solr docs对此的解释如下：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;For other features that we now commonly associate with search, such as sorting, faceting, and highlighting, this approach is not very efficient. The faceting engine, for example, must look up each term that appears in each document that will make up the result set and pull the document IDs in order to build the facet list. In Solr, this is maintained in memory, and can be slow to load (depending on the number of documents, terms, etc.)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在lucene 4.0版本前通过FieldCache，原理是通过按列逆转倒排表将（field value -&amp;gt;doc）映射变成（doc -&amp;gt; field value）映射，问题为逐步构建时间长并且消耗大量内存，容易造成OOM。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;DocValues是一种列存储结构，能快速通过文档ID找到相关需要排序的字段。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在ES中，默认开启所有(除了标记需analyzed的字符串字段)字段的doc values，如果不需要对此字段做任何排序等工作，则可关闭以减少资源消耗。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt; &lt;strong&gt;3.3 关于ES索引与检索分片&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;ES中一个索引由一个或多个lucene索引构成，一个lucene索引由一个或多个segment构成，其中segment是最小的检索域。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;数据具体被存储到哪个分片上： &lt;strong&gt;shard&lt;/strong&gt; &lt;strong&gt;= hash(routing) % number_of_primary_shards&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;默认情况下 routing参数是文档ID (murmurhash3),可通过 URL中的 &lt;strong&gt;_routing&lt;/strong&gt; 参数指定数据分布在同一个分片中，index和search的时候都需要一致才能找到数据&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;如果能明确根据_routing进行数据分区，则可减少分片的检索工作，以提高性能&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/h3&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;&lt;span&gt;四、优化案例&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;在我们的案例中，查询字段都是固定的，不提供全文检索功能，这也是几十亿数据能秒级返回的一个大前提：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1、ES仅提供字段的检索，仅存储HBase的Rowkey不存储实际数据。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2、实际数据存储在HBase中，通过Rowkey查询，如下图。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3、提高索引与检索的性能建议，可参考官方文档（如 https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-for-indexing-speed.html）&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;一些细节优化项官方与其他的一些文章都有描述，在此文章中仅提出一些本案例的重点优化项。&lt;/span&gt;&lt;/p&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6666666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGLky2WcDWHHBQibnjeGhdlS26IPvacbSYVp4JKSBYKDAnbIHh97922pw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;650&quot; title=&quot;img&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;4.1 优化索引性能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1、&lt;strong&gt;批量写入&lt;/strong&gt;，看每条数据量的大小，一般都是几百到几千。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2、&lt;strong&gt;多线程写入&lt;/strong&gt;，写入线程数一般和机器数相当，可以配多种情况，在测试环境通过Kibana观察性能曲线。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3、&lt;strong&gt;增加segments的刷新时间&lt;/strong&gt;，通过上面的原理知道，segment作为一个最小的检索单元，比如segment有50个，目的需要查10条数据，但需要从50个segment&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;分别查询10条，共500条记录，再进行排序或者分数比较后，截取最前面的10条，丢弃490条。在我们的案例中将此 &lt;strong&gt;&quot;refresh_interval&quot;: &quot;-1&quot;&lt;/strong&gt; ，程序批量写入完成后&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;进行手工刷新(调用相应的API即可)。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;4、内存分配方面，很多文章已经提到，&lt;strong&gt;给系统50%的内存给Lucene做文件缓存，它任务很繁重，所以ES节点的内存需要比较多(比如每个节点能配置64G以上最好）&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;5、&lt;strong&gt;磁盘方面配置SSD&lt;/strong&gt;，机械盘做阵列RAID5 RAID10虽然看上去很快，但是随机IO还是SSD好。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;6、 &lt;strong&gt;使用自动生成的ID&lt;/strong&gt;，在我们的案例中使用自定义的KEY，也就是与HBase的ROW KEY，是为了能根据rowkey删除和更新数据，性能下降不是很明显。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;7、关于段合并，合并在后台定期执行，比较大的segment需要很长时间才能完成，为了减少对其他操作的影响(如检索)，elasticsearch进行阈值限制，默认是20MB/s，&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;可配置的参数：&quot;indices.store.throttle.max_bytes_per_sec&quot; : &quot;200mb&quot; （根据磁盘性能调整）&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;合并线程数默认是：Math.max(1, Math.min(4, Runtime.getRuntime().availableProcessors() / 2))，如果是机械磁盘，可以考虑设置为1：index.merge.scheduler.max_thread_count: 1，&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在我们的案例中使用SSD，配置了6个合并线程。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt; &lt;strong&gt;4.2 优化检索性能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1、关闭不需要字段的doc values。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2、尽量使用keyword替代一些long或者int之类，term查询总比range查询好 (参考lucene说明 http://lucene.apache.org/core/7_4_0/core/org/apache/lucene/index/PointValues.html)。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3、关闭不需要查询字段的_source功能，不将此存储仅ES中，以节省磁盘空间。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;4、评分消耗资源，如果不需要可使用filter过滤来达到关闭评分功能，score则为0，如果使用constantScoreQuery则score为1。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;5、关于分页：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;（1）&lt;strong&gt;from + size:&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;每分片检索结果数最大为 from + size，假设from = 20, size = 20，则每个分片需要获取20 * 20 = 400条数据，多个分片的结果在协调节点合并(假设请求的分配数为5，则结果数最大为 400*5 = 2000条) 再在内存中排序后然后20条给用户。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;这种机制导致越往后分页获取的代价越高，达到50000条将面临沉重的代价，默认from + size默认如下：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt; &lt;em&gt;index.max_result_window ：10000&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;(2) &lt;strong&gt;search_after&lt;/strong&gt;: 使用前一个分页记录的最后一条来检索下一个分页记录，在我们的案例中，首先使用from+size，检索出结果后再使用&lt;strong&gt;search_after&lt;/strong&gt;，在页面上我们限制了用户只能跳5页，不能跳到最后一页。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;(3) &lt;strong&gt;scroll&lt;/strong&gt; 用于大结果集查询，缺陷是需要维护scroll_id&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;6、关于排序：我们增加一个long字段，它用于存储时间和ID的组合(通过移位即可)，正排与倒排性能相差不明显。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;7、关于CPU消耗，检索时如果需要做排序则需要字段对比，消耗CPU比较大，如果有可能尽量分配16cores以上的CPU，具体看业务压力。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;8、关于合并被标记删除的记录，我们设置为0表示在合并的时候一定删除被标记的记录，默认应该是大于10%才删除：&quot;merge.policy.expunge_deletes_allowed&quot;: &quot;0&quot;。&lt;/span&gt;&lt;/p&gt;&lt;pre&gt;&lt;p&gt;&lt;span&gt;{&lt;br/&gt;    &lt;span&gt;&quot;mappings&quot;&lt;/span&gt;: {&lt;br/&gt;        &lt;span&gt;&quot;data&quot;&lt;/span&gt;: {&lt;br/&gt;            &lt;span&gt;&quot;dynamic&quot;&lt;/span&gt;: &lt;span&gt;&quot;false&quot;&lt;/span&gt;,&lt;br/&gt;            &lt;span&gt;&quot;_source&quot;&lt;/span&gt;: {&lt;br/&gt;                &lt;span&gt;&quot;includes&quot;&lt;/span&gt;: [&lt;span&gt;&quot;XXX&quot;&lt;/span&gt;]  -- 仅将查询结果所需的数据存储仅_source中&lt;br/&gt;            },&lt;br/&gt;            &lt;span&gt;&quot;properties&quot;&lt;/span&gt;: {&lt;br/&gt;                &lt;span&gt;&quot;state&quot;&lt;/span&gt;: {&lt;br/&gt;                    &lt;span&gt;&quot;type&quot;&lt;/span&gt;: &lt;span&gt;&quot;keyword&quot;&lt;/span&gt;,   -- 虽然state为&lt;span&gt;int&lt;/span&gt;值，但如果不需要做范围查询，尽量使用keyword，因为&lt;span&gt;int&lt;/span&gt;需要比keyword增加额外的消耗。&lt;br/&gt;                    &lt;span&gt;&quot;doc_values&quot;&lt;/span&gt;: &lt;span&gt;false&lt;/span&gt;  -- 关闭不需要字段的doc values功能，仅对需要排序，汇聚功能的字段开启。&lt;br/&gt;                },&lt;br/&gt;                &lt;span&gt;&quot;b&quot;&lt;/span&gt;: {&lt;br/&gt;                    &lt;span&gt;&quot;type&quot;&lt;/span&gt;: &lt;span&gt;&quot;long&quot;&lt;/span&gt;    -- 使用了范围查询字段，则需要用&lt;span&gt;long&lt;/span&gt;或者&lt;span&gt;int&lt;/span&gt;之类 （构建类似KD-trees结构）&lt;br/&gt;                }&lt;br/&gt;            }&lt;br/&gt;        }&lt;br/&gt;    },&lt;br/&gt;   &lt;span&gt;&quot;settings&quot;&lt;/span&gt;: {......}&lt;br/&gt;}&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;h3&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/h3&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;&lt;span&gt;五、性能测试&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;优化效果评估基于基准测试，如果没有基准测试无法了解是否有性能提升，在这所有的变动前做一次测试会比较好。在我们的案例中：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1、单节点5千万到一亿的数据量测试，检查单点承受能力。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2、集群测试1亿-30亿的数量，磁盘IO/内存/CPU/网络IO消耗如何。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3、随机不同组合条件的检索，在各个数据量情况下表现如何。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;4、另外SSD与机械盘在测试中性能差距如何。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;性能的测试组合有很多，通常也很花时间，不过作为评测标准时间上的投入有必要，否则生产出现性能问题很难定位或不好改善。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;对于ES的性能研究花了不少时间，最多的关注点就是lucene的优化，能深入了解lucene原理对优化有很大的帮助。&lt;/span&gt;&lt;/p&gt;&lt;h3&gt;&lt;span&gt;&lt;br mpa-from-tpl=&quot;t&quot;/&gt;&lt;/span&gt;&lt;/h3&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p data-mid=&quot;&quot; mpa-is-content=&quot;t&quot;&gt;&lt;span&gt;六、生产效果&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img data-ratio=&quot;1.2857142857142858&quot; data-type=&quot;png&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/fEsWkVrSk54ibLD5cWvxpEDhChiaVoyDmGm4OoBlHXwHFmoGzy1HM9J0TEYwLdCwa85UScnvsmH4XMre4hBQoBCQ/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;目前平台稳定运行，几十亿的数据查询100条都在3秒内返回，前后翻页很快，如果后续有性能瓶颈，可通过扩展节点分担数据压力。&lt;/span&gt;&lt;/p&gt;&lt;figure&gt;&lt;span&gt;--- EOF ---&lt;/span&gt;&lt;br/&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;span&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;推荐↓↓↓&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mp-common-profile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzA3NTUzNjk1OA==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/oGp3ImQqDoarjsIfwTvcrG25u7Uu0NBoISHFWqFc4kOOXLaTMXfPmGpSTnee8P8fqRzYw6KNxn74CzvplX2tDQ/0?wx_fmt=png&quot; data-nickname=&quot;Web开发&quot; data-alias=&quot;WebDev1024&quot; data-signature=&quot;分享Web后端开发技术，分享PHP、Ruby、Python等用于后端网站、后台系统等后端开发技术；还包含ThinkPHP,WordPress等PHP网站开发框架、Django,Flask等Python网站开发框架。&quot; data-from=&quot;0&quot; data-is_biz_ban=&quot;0&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;mp-style-type data-value=&quot;3&quot;/&gt;&lt;/p&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>d8e8f268c30ebc00892f517e11c7dd83</guid>
<title>一年一度！GitHub 开发者大会「GitHub 热点速递 v.22.45」</title>
<link>https://toutiao.io/k/6bl3bzh</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.56201171875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqy3VhOp0ga6m8WsGdG0CE0C0TaI78hMwdU3DrGu7agdD4wpchMickLBA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;2048&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;GitHub 是全球最大的开源社区，它的一举一动都深受每一位开源爱好者的关注。这周末刚落下帷幕的《GitHub Universe 2022》是 GitHub 发布最新产品、功能、报告和计划的一场大秀。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;本期&lt;a target=&quot;_blank&quot; href=&quot;https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA5MzYyNzQ0MQ==&amp;amp;action=getalbum&amp;amp;album_id=1332112026222641153&amp;amp;scene=173&amp;amp;from_msgid=2247514290&amp;amp;from_itemidx=1&amp;amp;count=3&amp;amp;nolastread=1#wechat_redirect&quot; textvalue=&quot;「GitHub 热点速递」&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;「GitHub 热点速递」&lt;/a&gt;就做了一个《GitHub 2022 开发者大会》专题，专门介绍今年的 GitHub Universe 盛会，内容主要分为 &lt;strong&gt;Universe 大会&lt;/strong&gt; 和 &lt;strong&gt;Octoverse 报告&lt;/strong&gt;两部分。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.7108695652173913&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqz5vdTABnnXXW1eXCkSWGkDlibzeMm728qFdBBTQLH4QdMq0AwrMzEuA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;920&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;HelloGitHub 不仅会介绍发布的新功能，还有数据报告解读，&lt;strong&gt;让你轻松掌握最新的开源风向&lt;/strong&gt;！&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;在一切开始之前，先看个 1 分钟的视频进行快速了解，顺便感受下 Universe 大会的气氛吧！&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;1. GitHub Universe 大会&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;下面提到的新功能，需要手动申请后才可以使用。&lt;/span&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;申请地址：https://github.com/features/preview&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1.1 嘿，GitHub&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqDwHg6QxiaWAZgpGcma8LzJnic4KHbfr0iaoAiaBnp70kuFh0vAv6uXdeTA/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;1920&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;GitHub Copilot 是去年的 GitHub 开发者大会上，发布的一款人工智能的编程辅助工具，它可以通过描述揣测开发者的意图自动编写代码，支持多种编程语言。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;不管是因为 Copilot 令人眼前一亮的便捷性，还是其存在的代码版权问题和舆论声讨，不可否认的是 GitHub Copilot 是一个划时代的产品。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;今年 GitHub 又为 Copilot 增加了新的功能：&lt;strong&gt;语音对话编程&lt;/strong&gt;。你可以通过”hi，GitHub”唤醒服务，然后用对话的方式告诉它，要写什么代码或者做什么操作，Copilot 就会自动编写代码或者运行程序。&lt;/span&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1.2 免费的 Codespaces&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5595703125&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqoaemDmUicoXls2oa7qthWqaB0ErH5qFRhh7svtg7lJ353u69CrtEKxg/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;1024&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;GitHub Codespaces 是一个云开发环境服务，可以让开发者在几秒钟内，构建好所需要的开发环境，极大地简化了部署环境的步骤。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;现在，开发人员可以在 Codespaces 上选择使用 JetBrains 或 JupyterLab(支持 GPU) 的 IDE。重点是 Codespaces 将向 GitHub 上的所有用户&lt;strong&gt;免费开放（60 小时/月）&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1.3 用 Markdown 管理项目&lt;/h3&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5625&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqdZ05s2rDfXdtd5gibkFwsP5XHAqrwxgG0dwrd1CBHChGO719y0B1Bew/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;1920&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;GitHub Projects 是 GitHub 提供的在线项目管理工具，这一年 GitHub 为它增加了 100 多项功能。这里，我简单介绍一个我很喜欢且经常用的功能：&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;GitHub issues 作为 Projects 的重要一部分，它目前已支持 Markdown 的 task 语法，然后 task 可以是关联 Issues 或者 Project view，实现了状态的变化实时+双向同步。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;比如：完成任务后，&lt;strong&gt;用 Markdown 修改 task 状态，就能同步到对应的 issues 和 view 啦，无需额外的操作&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4274193548387097&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqAnfoMJD1Dyu3j5LLlCK70IXkHxnFSaH35W3pWsq9QgFic42xV9jib0tw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2232&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;1.4 让开发者填饱肚子&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;毫不夸张地说，开源有了今天的繁荣，离不开最早那批&lt;strong&gt;用爱发电的开源大佬&lt;/strong&gt;，排除极少数已经财富自由的神人，大多数开源项目作者还都是需要吃五谷杂粮的凡人，谁都离不开柴米油盐的烦恼。&lt;/span&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5498652291105122&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqzRKYozfSwvpDOSvVv7pLOHrn26P5vytuia7tBjqMzPLKP4SwWoL7C2g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1484&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;GitHub 希望通过 GitHub Accelerator、GitHub Fund 和 GitHub Sponsors 三个计划，让开源爱好者可以通过开源获得收入，甚至全职做开源。&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;GitHub Accelerator&lt;/span&gt;&lt;span&gt;：GitHub 加速器将为 20 名维护人员和团队提供 2 万美元的津贴和指导，帮助他们开启全职的开源职业生涯。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;GitHub Fund&lt;/span&gt;&lt;span&gt;：GitHub 基金与微软的风险投资部门 M12 合作，成了 1000 万美元的开源基金。投资重点将是处于种子阶段的开源的开发者工具，&lt;/span&gt;&lt;span&gt;CodeSee&lt;/span&gt;&lt;span&gt; 是他们的第一笔投资。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;GitHub Sponsors：打赏&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;2. Octoverse 报告&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Octoverse 是 GitHub 分析数百万的开源项目和开发者得出的数据报告。从 2012 年开始 GitHub 每年都会发布一份报告，今年正好是 10 周年。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;今年的话题是：&lt;strong&gt;开源对企业有什么影响？企业对开源有什么影响？&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2.1 概览&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5755995828988529&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqbhcHacc57KEl89JPEPHyeEaUNd3ibLwoZ6Gzx0q8rSQkcP9NkLJ5UpQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1918&quot;/&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;GitHub 上有 9400 万的开发者&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;90% 的公司使用了开源代码&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;财富 100 强公司的 90% 以上都使用 GitHub&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;2022 年有 4.13 亿次开源贡献&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;2.2 三个值得关注的趋势&lt;/span&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.21617293835068055&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqIWjZPGichvS6DKjBJzTo5f5htQNjVsM2osT29SdgtBBjLl8wfO22YNg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2498&quot;/&gt;&lt;/figure&gt;&lt;h4&gt;&lt;span&gt;1、HCL 是 GitHub 上增长最快的语言&lt;/span&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;报告中指出开发者在 2022 年大量使用 HCL、Shell、Go 编程语言，这说明 GitHub 上的项目越来越多地采用基础设施即代码（IaC）的做法，即 &lt;strong&gt;IaC 越来越流行&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;这也说明了&lt;strong&gt;运营社区开始在开源世界中崭露头角&lt;/strong&gt;，而开源历史上更多地是以开发者为中心。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;补充解释&lt;/strong&gt;：&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;HCL 全称 Hashicorp Configuration Language (HCL) 是 Terraform 的配置语言，它是 HashiCorp 发明的一种声明式语言，能够以更加简短和人性化的方式来描述资源。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;IaC 是 Infrastructure as Code 基础设施即代码的缩写，一种通过代码而非手动流程管理基础设施的方法。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;&lt;span&gt;2、财富 100 强公司中 30% 设立了 OSPO&lt;/span&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;2022 年，GitHub 上一些最大的开源项目得到了商业支持。这说明，资本开始对开源进行投资，鼓励越来越多的人加入开源，而且&lt;strong&gt;大型科技公司也在建立开源社区&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;补充解释&lt;/strong&gt;：&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;OSPO 是 Open Source Program Office 的缩写，即开源规划办公室。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;&lt;span&gt;3、50% 的 OSS 贡献者，首选有商业支持的项目&lt;/span&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;贡献者更青睐有商业支持的项目&lt;/strong&gt;，这强调了有商业支持的开源项目，在发展更广泛的生态和品牌认知方面的重要性。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;从 Flutter 到 Next.js，从 React 到 VS Code，&lt;strong&gt;由公司主导的开源项目，在 GitHub 上已经成为普遍现象&lt;/strong&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;补充解释&lt;/strong&gt;：&lt;/span&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;OSS 是 Open-source software 的缩写，即开源软件又称开放源代码软件，&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;2.3 更多数据&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.0315581854043392&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqwgyMO4M5NxQ2Ffz3ubQj2qLKry62ibLlXq7tmKr9e2RkFP95VTdRUdA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1014&quot;/&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;GitHub 今年新增了 2050 万开发者，其印度的开发者人数增长最快。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;JavaScript 是最常用的编程语言，第 2 名是 Python，后面依次是 Java、TypeScript，去年第 6 名的 PHP 下降至第 7名。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;贡献者最多的开源项目，前三名分别是：microsoft/vscode、home-assistant/core、flutter/flutter。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.1268498942917549&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqiaa2fKMia5JeC3h0a1a2SN9miamp24ibdNnpjibegsQOVY1aW0ibicH3mPRMg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;946&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;3. 最后&lt;/span&gt;&lt;/h2&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5214827295703454&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xBgIbW1vdNMnSfRhX3jN6GYka1KwJhyqzS9ibBoicFopMWngib5emDfZZoaVgPJN9sn9NLTs15bziaq0z3C0L9SBdg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2374&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;我看完本次的 GitHub 开发者大会，感到 GitHub 所做的一切都是让开发变得更加简单，正如他们&lt;strong&gt;用 GitHub 构建 GitHub&lt;/strong&gt;，当 GitHub 成为一种深受好评的开发方式时，开发者自然会留在这个平台。这正是 GitHub 希望看到的，因为开发者是 GitHub 最大的财富，就像创作者和社区的关系。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;那么做开源项目的首要任务，就应该是让使用者产生依赖了吧？&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;另外，开源的流行趋势已经势不可挡，资本也以肉眼可见的速度加注开源，当开源不再靠“爱”发电，能否迎来&lt;strong&gt;开源盛世&lt;/strong&gt;，让我们拭目以待！&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;以上就是 GitHub Universe 和 Octoverse 报告的全部内容，由于篇幅有限我只介绍了我比较感兴趣的内容，完整内容可以查看&lt;/span&gt;&lt;span&gt;官方博客&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;你看完今年的 GitHub 开发者大会有什么感受？&lt;/strong&gt; 欢迎留言讨论。&lt;/span&gt;&lt;span&gt;如果您觉得这期内容还不错：求赞、求收藏、求转发，您的支持就是对我最大的鼓励！❤️&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;- END -&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>16240e056252fdd45ba7068d57100097</guid>
<title>浅谈架构：除了画架构图，架构师还需要些什么？</title>
<link>https://toutiao.io/k/sn3qnfk</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content             autoTypeSetting24psection&amp;#10;            &quot; id=&quot;js_content&quot;&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;引子&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;❝&lt;/span&gt;&lt;p&gt;&quot;架构就是处理一些重要事情，不过鬼知道那是些什么。&quot; -- Ralph Johnson&lt;/p&gt;&lt;span&gt;❞&lt;/span&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;「架构师」&lt;/strong&gt;（Architect）应该是一个很有份量而又饱受尊敬的职位。每当听到某某是某公司的架构师时，会不会有一种肃然起敬的感觉？在大众看来，架构师通常跟系统设计、技术实力、领导力、影响力有着密切联系。也正是这个原因，企业中很多架构师的岗位都是由经验丰富、技术能力扎实的资深软件工程师担任。然而，软件行业对于架构师的&lt;strong&gt;「定义」&lt;/strong&gt;，其实并&lt;strong&gt;「不明确」&lt;/strong&gt;：亚马逊、阿里云之类的云服务商有自己的架构师团队，不过大多是顶着架构师的名头进行客户售后服务而已；在某企业里的架构师，无外乎就是利用自己的丰富经验和过硬实力，来解决技术难题，相当于资深软件工程师。这些都跟我们心目中的设计高大上架构图的、无所不知的架构师，有很大差别。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本文中所指代的架构师相关概念，主要来自于最近阅读的一本书&lt;span&gt;《软件架构基础》&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;（英文名：Fundamentals of Software Architecture，作者 Mark Richards、Neal Ford）。本篇文章会简单介绍更具实用意义上的架构师&lt;strong&gt;「需要做什么」&lt;/strong&gt;，以及相关的&lt;strong&gt;「必备技能」&lt;/strong&gt;。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.312&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/vh4PtSfBxFMnauyURPwzWz8bl2NbKD4rONm5kwLdR1KsrLcP4CGCvqZicjX0uEMQ2Srk1la0v3HKVZMib8qP552A/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;250&quot;/&gt;&lt;figcaption&gt;&lt;span/&gt;Fundamentals of Software Architecture&lt;/figcaption&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;总工程师&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;架构师首先是整个软件项目中的&lt;strong&gt;「总工程师」&lt;/strong&gt;，需要对软件工程的整体设计、实施、质量负责。因此，对于软件架构师来说，其需要具有优秀的编程技能，熟悉软件项目开发流程，以及在各种技术领域具备一定的广度和深度。不仅如此，由于架构师是技术侧的总负责人，他（或她）通常需要站在系统的整体角度，来思考各个模块之间是如何交互的，功能服务的划分是否合理，整个系统的瓶颈会在哪里，等等。而这些，都是技术层面的东西。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当一个软件工程师经手了很多大大小小的项目之后，都应该会对软件工程以及架构有一些深刻理解，再加上一些系统学习，应该都可以有成为架构师的资质。因此，单从技术层面来看，&lt;strong&gt;「软件架构师相当于资深的软件工程师」&lt;/strong&gt;。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;架构图是否重要？&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大家或许都或多或少看过架构师们画的各式各样的架构图：分层式架构图、物理网络拓扑图、流程示意图、交互逻辑图，等等。但要回答架构图是否重要的问题，咱们需要稍微理解一下为什么需要架构图。架构图主要目的，是帮助对内部工程师或外部技术人员&lt;strong&gt;「快速理解」&lt;/strong&gt;其中包含的&lt;strong&gt;「系统模块信息」&lt;/strong&gt;。因此，那些看似酷炫、专业、赏心悦目的架构图，如果缺乏内涵，对帮助理解来说不一定有帮助。反倒是&lt;strong&gt;「简洁」&lt;/strong&gt;、&lt;strong&gt;「清晰」&lt;/strong&gt;、&lt;strong&gt;「易理解」&lt;/strong&gt;的架构图，即使看起来很丑，对于软件开发者来说也帮助巨大。因此，架构图是重要的，但主要目的是清晰简洁的展现系统模块信息。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6189944134078212&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/vh4PtSfBxFMnauyURPwzWz8bl2NbKD4r0ZRA4wXlFHhzB8kTeMs8Qu4VKQnI0BFXHRCRpau8AecZmDRCl9poKw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;895&quot;/&gt;&lt;figcaption&gt;&lt;span/&gt;WTF Architecture&lt;/figcaption&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;不仅仅是技术&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;前面说过，架构师作为软件工程的总工程师，会承担技术侧的责任。但是现实当中，很少有只聚焦于技术层面工作的架构师，或者至少只精通技术方面技能而能在项目中游刃有余的架构师。成功的架构师、或者具有影响力的架构师，至少需要具有良好的&lt;strong&gt;「领导力」&lt;/strong&gt;或&lt;strong&gt;「团队管理」&lt;/strong&gt;能力。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;《软件架构基础中》中关于架构师的 8 项技能要求列表中，有一半跟技术不直接相关。我们来看一下这本书提及的技术和非技术要求。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;技术要求&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;架构决策能力&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;架构持续分析优化&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;前沿技术更新同步&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;技术知识广泛涉猎&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;非技术要求&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;你可能会惊讶于后半部分对架构师的非技术要求，例如为什么架构师需要考虑&lt;strong&gt;「政治」&lt;/strong&gt;？笔者在之前做单纯的技术人员时也不明白，但随着项目经历不断积累，直至自己也成为项目管理者之后，才发现企业中的很多架构决策不单来自于架构本身的技术合理性，而是跟企业政治有关。这里说的政治不是传统意义上的官僚主义，而更多的是指代各部门之间&lt;strong&gt;「协作」&lt;/strong&gt;或&lt;strong&gt;「竞争」&lt;/strong&gt;关系；特别是当企业规模非常大时，这种考虑犹为重要。限于篇幅原因，这里不细说，后面有机会可以单独聊一聊。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.8564631245043616&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/vh4PtSfBxFMnauyURPwzWz8bl2NbKD4rNVCxhK98xCRFk2AoA9000P3N49E6yJbGzQ5IqqEKRBAQN3Ol1ZmyEA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1261&quot;/&gt;&lt;figcaption&gt;&lt;span/&gt;Not Only Architect&lt;/figcaption&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;不断精进&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可惜的是，不少从工程师提拔起来的架构师，还是在技术领域不断钻研，而忽视了非技术的东西。因此，本篇文章所强调的观点，就是架构师的职责和要求绝对不只是技术和架构本身，而需要考虑更多非技术方面的技巧和经验积累。例如，如何在合规性、资源、开发效率之中作出平衡；自己负责的软件项目，对公司提供什么商业价值，会对业务造成什么影响；如何向非技术人员（特别是老板）解释专业术语；面对外部部门不配合的情况，如何从中周旋，保证项目顺利进行。诸如此类的问题都需要非技术技巧和经验，而想要在职业道路上更进一步的架构师，或许更需要考虑这些。跨出自己的舒适圈，才能有效开始学习和成长。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;社区&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果您对笔者的文章感兴趣，可以加笔者微信 tikazyq1 并注明 &quot;码之道&quot;，笔者会将你拉入 &quot;码之道&quot; 交流群。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本篇文章英文版同步发布在 &lt;span&gt;Medium&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt;，技术分享无国界，欢迎大佬们指点。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Reference&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;span&gt;[1] &lt;/span&gt;&lt;p&gt;《软件架构基础》: &lt;span&gt;https://www.oreilly.com/library/view/fundamentals-of-software/9781492043447/&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2] &lt;/span&gt;&lt;p&gt;Medium: &lt;span&gt;https://medium.com/@MarvinZhang89/talking-architecture-what-skills-should-architects-have-apart-from-drawing-architecture-diagrams-66f68b935008&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;mp-style-type data-value=&quot;3&quot;/&gt;&lt;/p&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>