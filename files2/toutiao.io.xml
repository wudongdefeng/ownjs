<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>b5af55b0d163895dd2bfed56430a1c0e</guid>
<title>Go å·¥ç¨‹åŒ–ï¼ˆä¹ï¼‰ï¼šé¡¹ç›®é‡æ„å®è·µ</title>
<link>https://toutiao.io/k/et0t2lk</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;markdown-body&quot;&gt;&lt;h2 id=&quot;åº&quot;&gt;&lt;a href=&quot;#åº&quot; class=&quot;headerlink&quot; title=&quot;åº&quot;/&gt;åº&lt;/h2&gt;&lt;p&gt;æœ¬ç³»åˆ—ä¸º &lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://u.geekbang.org/subject/go?utm_source=lailin.xyz&amp;amp;utm_medium=lailin.xyz&quot;&gt;Go è¿›é˜¶è®­ç»ƒè¥&lt;/a&gt; ç¬”è®°ï¼Œé¢„è®¡ 2021Q2 å®Œæˆæ›´æ–°ï¼Œè®¿é—® &lt;a href=&quot;https://lailin.xyz/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/&quot;&gt;åšå®¢: Go è¿›é˜¶è®­ç»ƒè¥&lt;/a&gt; å³å¯æŸ¥çœ‹å½“å‰æ›´æ–°è¿›åº¦ï¼Œéƒ¨åˆ†æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œä½¿ç”¨ PC å¤§å±æµè§ˆä½“éªŒæ›´ä½³ã€‚&lt;strong&gt;3 æœˆè¿›åº¦: 06/15&lt;/strong&gt; 3 æœˆå¼€å§‹ä¼šå°è¯•çˆ†æ›´æ¨¡å¼ï¼Œäº‰å–åšåˆ°ä¸¤å¤©æ›´æ–°ä¸€ç¯‡æ–‡ç« ï¼Œå¦‚æœæ„Ÿå…´è¶£å¯ä»¥æ‹‰åˆ°æ–‡ç« æœ€ä¸‹æ–¹è·å–å…³æ³¨æ–¹å¼ã€‚&lt;/p&gt;&lt;p&gt;è¿™æ˜¯ã€ŠGo å·¥ç¨‹åŒ–ã€‹ç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« äº†ï¼Œå…¶å®åœ¨ Go å¹¶å‘ç¼–ç¨‹å®Œç»“çš„æ—¶å€™æˆ‘æƒ³çš„å·¥ç¨‹åŒ–è¿™ä¸€ç« èŠ‚ä¸è¦å†™è¿™ä¹ˆå¤šï¼Œä»¥å¬è¯¾ç¬”è®°ä¸ºä¸»å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯å±•å¼€è®²äº†å¾ˆå¤šå†…å®¹ï¼Œä¸å…¶è¯´æ˜¯ä¸ºäº†åšç¬”è®°æˆ–è€…æ˜¯å†™æ–‡ç« ï¼Œä¸å¦‚è¯´æ˜¯ä¸ºäº†æ•´ç†ä¸€ä¸‹è¿‡å»å‡ å¹´æˆ‘çš„ä¸€äº›å¾®ä¸è¶³é“çš„ç»éªŒï¼Œç»“åˆæ¯›è€å¸ˆè¯¾ä¸Šè®²çš„å†…å®¹ä¸è‡ªå·±çš„æƒ…å†µé‡æ–°å¯¹å·²æœ‰çš„çŸ¥è¯†è¿›è¡Œäº†ä¸€éæ¢³ç†ã€‚&lt;/p&gt;&lt;p&gt;åœ¨å‰é¢çš„å…«ç¯‡æ–‡ç« å½“ä¸­æˆ‘ä»¬è®²åˆ°äº†ï¼Œé¡¹ç›®ç»“æ„ã€ä¾èµ–æ³¨å…¥ï¼ŒAPI è®¾è®¡ã€é…ç½®ç®¡ç†ã€åŒ…ç®¡ç†ã€å•å…ƒæµ‹è¯•ï¼ŒåŸºæœ¬ä¸Šè¿˜æ˜¯å°†å·¥ç¨‹åŒ–å½“ä¸­çš„å¤§éƒ¨åˆ†ä¸œè¥¿éƒ½è®²åˆ°äº†ï¼Œä¸æ±‚å°½å–„å°½ç¾ï¼Œä½†æ±‚å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥ç»“åˆå‰é¢æ–‡ç« ä¸­æåˆ°çš„å„ç§çŸ¥è¯†æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å°†ä¸€ä¸ªè€çš„é¡¹ç›®è¿ç§»åˆ°æ–°çš„é¡¹ç›®ç»“æ„å½“ä¸­æ¥ï¼Œè¿™é‡Œé¢çš„å‘ä¹Ÿéå¸¸çš„å¤šã€‚&lt;/p&gt;&lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯ä»ä¹‹å‰é‡æ„çš„ä¸€ä¸ªçœŸå®é¡¹ç›®æ˜ å°„è€Œæ¥ï¼Œé‡Œé¢è®²åˆ°çš„å‘åŸºæœ¬ä¸Šåœ¨è¿ç§»é‡æ„çš„è¿‡ç¨‹ä¸­éƒ½è¶Ÿäº†ä¸æ­¢ä¸€æ¬¡ã€‚&lt;/p&gt;&lt;h2 id=&quot;è¿ç§»å‰&quot;&gt;&lt;a href=&quot;#è¿ç§»å‰&quot; class=&quot;headerlink&quot; title=&quot;è¿ç§»å‰&quot;/&gt;è¿ç§»å‰&lt;/h2&gt;&lt;h3 id=&quot;ç›®å½•ç»“æ„&quot;&gt;&lt;a href=&quot;#ç›®å½•ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;ç›®å½•ç»“æ„&quot;/&gt;ç›®å½•ç»“æ„&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs bash&quot;&gt;.&lt;br/&gt;â”œâ”€â”€ app&lt;br/&gt;â”‚   â”œâ”€â”€ controller&lt;br/&gt;â”‚   â”œâ”€â”€ lib&lt;br/&gt;â”‚   â”œâ”€â”€ middleware&lt;br/&gt;â”‚   â”œâ”€â”€ model&lt;br/&gt;â”‚   â””â”€â”€ router&lt;br/&gt;â”œâ”€â”€ cmd&lt;br/&gt;â”‚   â”œâ”€â”€ cron&lt;br/&gt;â”‚   â””â”€â”€ server&lt;br/&gt;â”œâ”€â”€ config&lt;br/&gt;â”‚   â””â”€â”€ initializer&lt;br/&gt;â”œâ”€â”€ db&lt;br/&gt;â”‚   â””â”€â”€ migrate&lt;br/&gt;â”‚   â””â”€â”€ migrate.go&lt;br/&gt;â”œâ”€â”€ go.mod&lt;br/&gt;â”œâ”€â”€ mock&lt;br/&gt;â”œâ”€â”€ &lt;span class=&quot;hljs-built_in&quot;&gt;test&lt;/span&gt;&lt;br/&gt;â””â”€â”€ third_party&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;è¿™æ˜¯æˆ‘ä»¬æœ€å¼€å§‹çš„ç›®å½•ç»“æ„ï¼Œè¿™ä¸ªç»“æ„æ˜¯ä»¿ç…§ rails æ¡†æ¶è®¾è®¡è€Œæ¥çš„ï¼Œè¿™ä¸ªç»“æ„åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½æ˜¯æŒºå¥½ç”¨çš„ï¼Œæˆ‘å…ˆå¤§æ¦‚è§£é‡Šä¸€ä¸‹æ¯ä¸ªç›®å½•çš„å«ä¹‰&lt;/p&gt;&lt;ul&gt;&lt;li&gt;app: åº”ç”¨é€»è¾‘ç›¸å…³çš„ä»£ç éƒ½åœ¨è¿™é‡Œ&lt;ul&gt;&lt;li&gt;controller: æ§åˆ¶å™¨å±‚ï¼Œä¸»è¦è´Ÿè´£è·¯ç”±&lt;/li&gt;&lt;li&gt;lib: ä¸€äº›å·¥å…·åº“å‡½æ•°&lt;/li&gt;&lt;li&gt;middleware: è·¯ç”±ä¸­é—´ä»¶&lt;/li&gt;&lt;li&gt;router: è·¯ç”±æ³¨å†Œ&lt;/li&gt;&lt;li&gt;model: ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å……è¡€æ¨¡å‹ï¼Œæ‰€ä»¥è¿™ä¸€å±‚çš„å†…å®¹æ¯”è¾ƒå¤šï¼ŒåŒ…å«äº†é¢†åŸŸå¯¹è±¡ï¼Œä¸šåŠ¡é€»è¾‘ï¼Œæ•°æ®å­˜å‚¨ç­‰éƒ½åœ¨è¿™é‡Œ&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;cmd: äºŒè¿›åˆ¶æ–‡ä»¶ç›®å½•&lt;ul&gt;&lt;li&gt;cron: å®šæ—¶ä»»åŠ¡&lt;/li&gt;&lt;li&gt;server: http server æœåŠ¡&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;db: migration ç›®å½•&lt;/li&gt;&lt;li&gt;mock: gomock ç”Ÿæˆçš„æ–‡ä»¶&lt;/li&gt;&lt;li&gt;test: æµ‹è¯•å·¥å…·åº“&lt;/li&gt;&lt;li&gt;third_party: ç¬¬ä¸‰æ–¹æ–‡ä»¶&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;è°ƒç”¨å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º&lt;br/&gt;&lt;img src=&quot;https://mohuishou-blog-sz.oss-cn-shenzhen.aliyuncs.com/image/1615219210365-000fcd85-392a-41da-b7e4-8b4fc583123f.jpeg&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;Frame 1 (4).jpg&quot;/&gt;&lt;/p&gt;&lt;h3 id=&quot;å­˜åœ¨çš„é—®é¢˜&quot;&gt;&lt;a href=&quot;#å­˜åœ¨çš„é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;å­˜åœ¨çš„é—®é¢˜&quot;/&gt;å­˜åœ¨çš„é—®é¢˜&lt;/h3&gt;&lt;p&gt;å…¶å®åœ¨æŠ¥åå‚åŠ  Go è¿›é˜¶è®­ç»ƒè¥ ä¹‹å‰æˆ‘å°±å› ä¸ºåœ¨æé«˜è¿™ä¸ªé¡¹ç›®çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡çš„æ—¶å€™å‘ç°äº†å¾ˆå¤šé—®é¢˜ï¼Œå½“æ—¶æˆ‘ç”¨äº†å„ç§æ“ä½œï¼Œéå¸¸éš¾å—çš„å°†å•å…ƒæµ‹è¯•è¦†ç›–ç‡å†™åˆ° 85% å·¦å³çš„æ—¶å€™å°±å†™ä¸ä¸Šå»äº†ï¼Œå› ä¸ºæˆ‘ä»¬çš„é¡¹ç›®çš„å†å²åŒ…è¢±å¤ªä¸¥é‡äº†ï¼Œå¾ˆå¤šä»£ç å†™çš„åŸºæœ¬å°±ä¸å¯æµ‹è¯•ï¼Œæƒ³è¦æé«˜æµ‹è¯•è¦†ç›–ç‡ä¹Ÿå°±æ— ä»è°ˆèµ·äº†ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;cmd&lt;ul&gt;&lt;li&gt;æˆ‘ä»¬ä¹‹å‰åœ¨è¿™ä¸€å±‚å½“ä¸­æœ€å¤§çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬æ‰‹å†™äº†å¤§é‡å¯åŠ¨ä»£ç ï¼Œå…¨æ‰‹åŠ¨ä¾èµ–æ³¨å…¥ï¼Œè¿˜æœ‰ä¸€äº›éšå¼çš„ä¾èµ–ï¼Œè¿™å°±å¯¼è‡´åœ¨é¡¹ç›®åæœŸçš„æ—¶å€™å¯åŠ¨çš„ä»£ç å·²ç»éå¸¸é•¿äº†ï¼Œè€Œä¸”å¾ˆå®¹æ˜“é—æ¼ä¾èµ–å…³ç³»çš„å¤„ç†ï¼Œå»ºè®®å¦‚æœä¸æ˜¯ç‰¹åˆ«å°çš„é¡¹ç›®è¿˜æ˜¯ä½¿ç”¨ wire æ¯”è¾ƒé¦™ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;initializer&lt;ul&gt;&lt;li&gt;æˆ‘ä»¬ä¹‹å‰æ‰€æœ‰çš„åˆå§‹åŒ–éƒ½åœ¨è¿™ä¸ªåŒ…å†…å®Œæˆï¼Œè¿™ä¸ªä¸æ˜¯å¤ªå¤§çš„é—®é¢˜ï¼Œä½†æ˜¯è¦å‘½çš„æ˜¯è¿™é‡Œé¢æœ‰å¤§é‡çš„å…¨å±€å˜é‡ï¼Œå„ç§å„æ ·ï¼Œè¿‡å¤šçš„å…¨å±€å˜é‡å¯¼è‡´æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•éå¸¸éš¾å†™ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;model&lt;ul&gt;&lt;li&gt;è¿™ä¸€å±‚çš„äº‹æƒ…ç‰¹åˆ«å¤šï¼Œä¸šåŠ¡é€»è¾‘ï¼Œé¢†åŸŸå¯¹è±¡ï¼ŒæŒä¹…åŒ–å­˜å‚¨ç­‰éƒ½åœ¨è¿™ä¸€å±‚å®Œæˆï¼Œè¿™å°±å¯¼è‡´äº†åé¢æˆ‘ä»¬ model å±‚çš„ä»£ç ç‰¹åˆ«å¤šï¼Œå˜æˆäº†ä¸€å›¢ä¹±éº»ï¼ŒçœŸçš„æ˜¯å‰ªä¸æ–­ç†è¿˜ä¹±ï¼Œæ…¢æ…¢çš„è¿™ä¸€å±‚çš„é€»è¾‘æˆ‘è‡ªå·±éƒ½ç†ä¸æ¸…äº†ã€‚&lt;/li&gt;&lt;li&gt;è¿™ä¸€å±‚çš„ä»£ç è€¦åˆä¹Ÿå¾ˆä¸¥é‡ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆå®šæ—¶ä»»åŠ¡è¿˜æ˜¯æ¶ˆæ¯é˜Ÿåˆ—è¿˜æ˜¯ server çš„ä»£ç éƒ½æ”¾åˆ°äº†è¿™é‡Œï¼Œå¯¼è‡´å‡ºç°äº†å¾ˆå¤šå‘ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¯èƒ½æˆ‘æœ‰ä¸€ä¸ªå‡½æ•°æ˜¯ &lt;code&gt;GetArticles&lt;/code&gt; è¿™ä¸ªå‡½æ•°æœ€å¼€å§‹æ˜¯ä¸ºäº† api æ¥å£è¿”å›ä¸€äº›ç®€è¦çš„åˆ—è¡¨æ•°æ®ï¼Œåªéœ€è¦æŸ¥è¯¢ä¸€å¼ è¡¨ï¼Œè¿”å›é€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯æˆ‘å®šæ—¶ä»»åŠ¡æœ‰ä¸€ä¸ªåœ°æ–¹ä¹Ÿéœ€è¦è¿™ä¸ªå‡½æ•°ï¼Œç„¶åæˆ‘ä¸€çœ‹ï¼ŒçœŸå¥½è¿™é‡Œå·²ç»æœ‰è¿™ä¸ªå‡½æ•°äº†æˆ‘ä»¬å°±ç›´æ¥å¤ç”¨ï¼Œä½†æ˜¯æ•°æ®å†…å®¹ä¸æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬å°±ç›´æ¥åœ¨è¿™ä¸ªå‡½æ•°å½“ä¸­åŠ é€»è¾‘ï¼Œç„¶åéœ€æ±‚æ»¡è¶³äº†ï¼Œè¿‡ä¸€æ®µæ—¶é—´æˆ‘ä»¬çªç„¶è¦æ±‚æ‰€æœ‰çš„æ¥å£å¿…é¡»è¦åœ¨ 500ms ä»¥å†…ï¼Œç»“æœå‘ç°å‘æ¥äº†ï¼Œå¾ˆå¤šåœ°æ–¹ä¾èµ–è¿™ä¸ªå‡½æ•°ï¼Œçœ‹ APMï¼Œå°±è¿™ä¸€ä¸ªå‡½æ•°çš„æŸ¥è¯¢å°±éœ€è¦è€—è´¹è¶…è¿‡ 500ms ğŸ¤£&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;controller&lt;ul&gt;&lt;li&gt;è¿™ä¸€å±‚ä¸»è¦åšå‚æ•°çš„å¤„ç†è¿˜æœ‰éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬çš„ Controller å±‚å’Œ model å±‚çš„ç•Œå®šæ¯”è¾ƒæ¨¡ç³Šï¼Œæœ‰çš„ä¸»è¦ä¸šåŠ¡é€»è¾‘æ”¾åˆ°äº† model æœ‰çš„æœ‰éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘åˆæ”¾åˆ°äº† Controller äº†ï¼Œåˆ°åé¢å°±æ˜¯ä¸€ç‚¹ä¸€ç‚¹çš„æ‰¾é—®é¢˜&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;é”™è¯¯å¤„ç†&lt;ul&gt;&lt;li&gt;æˆ‘ä»¬ä¹‹å‰åœ¨é¡¹ç›®å†…ç»Ÿä¸€äº†é”™è¯¯ç ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ä¸ªé—®é¢˜&lt;/li&gt;&lt;li&gt;ä¸€ä¸ªæ˜¯è¦ä¹ˆå¤„å¤„ wrapï¼Œè¦ä¹ˆå¿˜è®° wrap æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€å‡†åˆ™ï¼Œè¿™å°±å¯¼è‡´è¦ä¹ˆé”™è¯¯å †æ ˆé•¿çš„æ²¡æ³•çœ‹ï¼Œè¦ä¹ˆå°±æ²¡æœ‰å¤ªå¤šçš„é”™è¯¯ä¿¡æ¯æ²¡æ³•æ’æŸ¥&lt;/li&gt;&lt;li&gt;å¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨ Controller å±‚è·‘ä¸šåŠ¡é”™è¯¯ä»£ç ï¼Œè¿™å°±å¯¼è‡´äº†å¾ˆå¤šæ—¶å€™æƒ³è¦è¿”å›ä¸€äº›ç»†èŠ‚çš„é”™è¯¯ä¿¡æ¯å°±æ— èƒ½ä¸ºåŠ›ï¼Œå³ä½¿åœ¨ model å±‚æŠ›äº†ä¹Ÿä¼šè¢« Controller å±‚åæ‰&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;æ¥å£æ–‡æ¡£&lt;ul&gt;&lt;li&gt;è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç—›ç‚¹ï¼Œä¹‹å‰æƒ³äº†å¾ˆå¤šæ–¹å¼éƒ½ä¸èƒ½å¾ˆå¥½çš„è§£å†³ï¼Œæ¯›è€å¸ˆç»™å‡ºè¿™ä¸ªæ–¹æ¡ˆåï¼Œæˆ‘æ²¡å¤šä¹…å°±ç”¨ä¸Šäº†éå¸¸çˆ½ã€‚&lt;/li&gt;&lt;li&gt;ä¹‹å‰æˆ‘ä»¬çš„æ–‡æ¡£åˆ†å¸ƒäº”èŠ±å…«é—¨ï¼Œæœ€å¼€å§‹ä½¿ç”¨ gin swagger é€šè¿‡å†™æ³¨é‡Šçš„æ–¹å¼æ¥ç”Ÿæˆç›¸å…³æ¥å£æ–‡æ¡£ï¼Œè¯´å®è¯å¯ä»¥ç”¨ä½†æ˜¯æ¯”è¾ƒéš¾ç”¨ï¼Œå› ä¸ºè¿™ä¸ªæ³¨é‡Šå…¶å®å’Œä»£ç é€»è¾‘æ˜¯ä¸¤å¥—ä¸œè¥¿ï¼Œç›¸å½“äºå†™ä¸€éä»£ç å†å†™ä¸€éæ³¨é‡Šï¼Œæ…¢æ…¢çš„å°±æ²¡æœ‰äººå†™äº†ï¼Œæˆ–è€…è¿˜æœ‰å†™çš„æ˜¯é”™è¯¯çš„ã€‚æœ€éº»çƒ¦çš„æ˜¯åœ¨æ–¹æ¡ˆè®¾è®¡é˜¶æ®µæˆ‘ä»¬ä¸ä¼šç›´æ¥å†™ä»£ç æ³¨é‡Šï¼Œæ‰€ä»¥æµ‹è¯•åŒå­¦åœ¨å†™æµ‹è¯•æ–¹æ¡ˆçš„æ—¶å€™ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œä¹Ÿä¸ç¬¦åˆæˆ‘ä»¬åç»­æŠ€æœ¯æ–¹æ¡ˆè¯„å®¡çš„è¦æ±‚æ‰€ä»¥åé¢ä¹Ÿå°±åºŸå¼ƒäº†&lt;/li&gt;&lt;li&gt;åé¢æˆ‘ä»¬å†™åˆ°å†…éƒ¨çš„æ–‡æ¡£å¹³å°ä¸Šï¼Œè¿˜ä¸å¦‚ä¹‹å‰çš„ swaggerï¼Œè™½ç„¶è§£å†³äº†æ–¹æ¡ˆé˜¶æ®µæ²¡æ¥å£æ–‡æ¡£çš„é—®é¢˜ï¼Œä½†æ˜¯æ¥å£æ–‡æ¡£æ€»æ˜¯åœ¨å˜åŒ–å½“ä¸­çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼€å‘çš„æ—¶å€™ï¼Œè¿™å°±è®©å‰åç«¯å¯¹æ¥è”è°ƒï¼Œä»¥åŠæµ‹è¯•åŒå­¦æµ‹è¯•çš„éå¸¸éš¾å—ï¼Œç‰¹åˆ«æ˜¯ç»å¸¸ä¼šå‡ºç°å’Œå‰ç«¯åŒå­¦æ²Ÿé€šå¥½äº†ä½†æ˜¯å¿˜è®°å’Œæµ‹è¯•è¯´çš„æƒ…å†µã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;è¿ç§»&quot;&gt;&lt;a href=&quot;#è¿ç§»&quot; class=&quot;headerlink&quot; title=&quot;è¿ç§»&quot;/&gt;è¿ç§»&lt;/h2&gt;&lt;p&gt;&lt;em&gt;è¿ç§»è¦ä¸‰æ€ï¼Œå¤„å¤„éƒ½æ˜¯å‘, é‡æ„è¦å°å¿ƒï¼ŒTDD å¤§æ³•å¥½&lt;/em&gt;&lt;/p&gt;&lt;h3 id=&quot;è¿ç§»åç›®å½•ç»“æ„&quot;&gt;&lt;a href=&quot;#è¿ç§»åç›®å½•ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;è¿ç§»åç›®å½•ç»“æ„&quot;/&gt;è¿ç§»åç›®å½•ç»“æ„&lt;/h3&gt;&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿæ›´åŠ ç›´è§‚ï¼Œæˆ‘ä»¬å…ˆæ¥å¤ä¹ ä¸€ä¸‹ä¹‹å‰æåˆ°è¿‡çš„é¡¹ç›®ç›®å½•ç»“æ„çœ‹ä¸€ä¸‹è¿ç§»å‰åæœ‰å“ªäº›ä¸åŒ&lt;/p&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs bash&quot;&gt;.&lt;br/&gt;â”œâ”€â”€ api&lt;br/&gt;â”‚   â””â”€â”€ product&lt;br/&gt;â”‚       â””â”€â”€ app&lt;br/&gt;â”‚           â”œâ”€â”€ errcode&lt;br/&gt;â”‚           â””â”€â”€ v1&lt;br/&gt;â”‚               â””â”€â”€ v1.proto&lt;br/&gt;â”œâ”€â”€ cmd&lt;br/&gt;â”‚   â”œâ”€â”€ cron&lt;br/&gt;â”‚   â”‚   â”œâ”€â”€ main.go&lt;br/&gt;â”‚   â”‚   â””â”€â”€ wire.go&lt;br/&gt;â”‚   â”œâ”€â”€ migrate&lt;br/&gt;â”‚   â””â”€â”€ server&lt;br/&gt;â”œâ”€â”€ config&lt;br/&gt;â”œâ”€â”€ go.mod&lt;br/&gt;â”œâ”€â”€ internal&lt;br/&gt;â”‚   â”œâ”€â”€ cron&lt;br/&gt;â”‚   â”‚   â”œâ”€â”€ repo&lt;br/&gt;â”‚   â”‚   â”œâ”€â”€ service&lt;br/&gt;â”‚   â”‚   â”œâ”€â”€ usecase&lt;br/&gt;â”‚   â”‚   â””â”€â”€ wire_set.go&lt;br/&gt;â”‚   â”œâ”€â”€ domain&lt;br/&gt;â”‚   â”œâ”€â”€ pkg&lt;br/&gt;â”‚   â”‚   â”œâ”€â”€ copier&lt;br/&gt;â”‚   â”‚   â”œâ”€â”€ mock&lt;br/&gt;â”‚   â”‚   â””â”€â”€ &lt;span class=&quot;hljs-built_in&quot;&gt;test&lt;/span&gt;&lt;br/&gt;â”‚   â””â”€â”€ server&lt;br/&gt;â”‚       â”œâ”€â”€ repo&lt;br/&gt;â”‚       â”œâ”€â”€ service&lt;br/&gt;â”‚       â”œâ”€â”€ usecase&lt;br/&gt;â”‚       â””â”€â”€ wire_set.go&lt;br/&gt;â””â”€â”€ third_party&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;å…·ä½“æ¯ä¸ªæ–‡ä»¶å¤¹çš„å«ä¹‰å°±ä¸å†èµ˜è¿°ï¼Œå¦‚æœä¸å¤ªæ¸…æ¥šå¯ä»¥æŸ¥çœ‹ &lt;a href=&quot;https://lailin.xyz/post/go-training-week4-project-layout.html&quot;&gt;Go å·¥ç¨‹åŒ–(äºŒ) é¡¹ç›®ç›®å½•ç»“æ„&lt;/a&gt;&lt;br/&gt;æˆ‘ä»¬çœ‹ä¸€ä¸‹æ–°çš„ç›®å½•ç»“æ„çš„è°ƒç”¨é“¾è·¯&lt;br/&gt;&lt;img src=&quot;https://mohuishou-blog-sz.oss-cn-shenzhen.aliyuncs.com/image/1615268889054-251a4e39-c8d9-410f-950c-5262b368ae34.jpeg&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;Frame 2 (1).jpg&quot;/&gt;&lt;br/&gt;æ³¨æ„ï¼Œåœ¨è¿™é‡Œ service å’Œ usecase å®é™…è°ƒç”¨çš„éƒ½æ˜¯ domain ä¸­çš„æ¥å£ï¼Œåªæ˜¯ usecase å’Œ repo å®ç°è¿™äº›æ¥å£è€Œå·²ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç”¨è™šçº¿ç”»å‡ºæ¥&lt;/p&gt;&lt;h3 id=&quot;è¿ç§»é‡æ„åŸåˆ™&quot;&gt;&lt;a href=&quot;#è¿ç§»é‡æ„åŸåˆ™&quot; class=&quot;headerlink&quot; title=&quot;è¿ç§»é‡æ„åŸåˆ™&quot;/&gt;è¿ç§»é‡æ„åŸåˆ™&lt;/h3&gt;&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä¼šä»å„ä¸ªæ¨¡å—æ¥é˜è¿°æˆ‘åœ¨é‡æ„è¿™ä¸ªé¡¹ç›®çš„æ—¶å€™æ˜¯æ€ä¹ˆåšçš„ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰æ¯ä¸ªæ¨¡å—è‡ªå·±çš„å‘ã€‚å¼€å§‹ä¹‹å‰å‘¢æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å‡ ä¸ªæ€»çš„åŸåˆ™:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç»“æ„ç®€å•çš„åº”ç”¨ä¼˜å…ˆ&lt;/li&gt;&lt;li&gt;æœ‰å……åˆ†çš„å•å…ƒæµ‹è¯•çš„åº”ç”¨ä¼˜å…ˆ&lt;/li&gt;&lt;li&gt;å…ˆå†™æµ‹è¯•ï¼Œæµ‹è¯•éœ€è¦åœ¨æ–°è€ä»£ç åŒæ—¶é€šè¿‡&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;api&quot;&gt;&lt;a href=&quot;#api&quot; class=&quot;headerlink&quot; title=&quot;api&quot;/&gt;api&lt;/h3&gt;&lt;p&gt;api å½“ä¸­ä¸»è¦å†™çš„å°±æ˜¯ proto æ–‡ä»¶ï¼Œè¿™ä¸ª proto æ–‡ä»¶æ›¿ä»£äº†æˆ‘ä»¬åœ¨ä¹‹å‰çš„ &lt;code&gt;router&lt;/code&gt; ä»¥åŠéƒ¨åˆ† &lt;code&gt;controller&lt;/code&gt; ä¸­çš„é€»è¾‘ï¼Œå®šä¹‰äº† proto æ–‡ä»¶ä¹‹åï¼Œç”Ÿæˆçš„ä»£ç å½“ä¸­ä¸»è¦è¦å®Œæˆçš„å°±æ˜¯ï¼Œè·¯ç”±çš„æ³¨å†Œï¼Œå‚æ•°ç»‘å®šï¼Œè¿”å›å€¼ç»“æ„å¡«å……ã€‚&lt;/p&gt;&lt;h4 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;/&gt;èƒŒæ™¯&lt;/h4&gt;&lt;p&gt;å…ˆè¡¥å……ä¸€ä¸‹èƒŒæ™¯ï¼Œæˆ‘ä»¬ä¹‹å‰çš„é¡¹ç›®é‡‡ç”¨çš„æ˜¯ gin ä½œä¸ºè·¯ç”±æ¡†æ¶ï¼Œè¿”å›å€¼é‡‡ç”¨ä¸‹é¢è¿™ç§ç»Ÿä¸€çš„ç»“æ„&lt;/p&gt;&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs json&quot;&gt;{&lt;br/&gt;  &lt;span class=&quot;hljs-attr&quot;&gt;&quot;code&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;br/&gt;  &lt;span class=&quot;hljs-attr&quot;&gt;&quot;msg&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;æˆåŠŸ&quot;&lt;/span&gt;,&lt;br/&gt;  &lt;span class=&quot;hljs-attr&quot;&gt;&quot;data&quot;&lt;/span&gt;: {}&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;åœ¨ api å±‚çš„è·¯ç”±æ³¨å†Œï¼Œå‚æ•°ç»‘å®šï¼Œè¿”å›å€¼ç»“æ„å¡«å……æˆ‘ä»¬éƒ½ä½¿ç”¨å·¥å…·è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥çœ‹ä¹‹å‰çš„æ–‡ç« : &lt;a href=&quot;https://lailin.xyz/post/go-training-week4-protoc-gen-go-gin.html&quot;&gt;Go å·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç &lt;/a&gt;&lt;/p&gt;&lt;h4 id=&quot;ç®€å•æ¡ˆä¾‹&quot;&gt;&lt;a href=&quot;#ç®€å•æ¡ˆä¾‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€å•æ¡ˆä¾‹&quot;/&gt;ç®€å•æ¡ˆä¾‹&lt;/h4&gt;&lt;p&gt;å…ˆæ¥çœ‹ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­&lt;/p&gt;&lt;figure class=&quot;highlight protobuf&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs protobuf&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡ŒæŒ‡å®šäº† proto æ–‡ä»¶çš„ç‰ˆæœ¬&lt;/span&gt;&lt;br/&gt;syntax = &lt;span class=&quot;hljs-string&quot;&gt;&quot;proto3&quot;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// package å‘½åè§„åˆ™: product.application.version&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; product.app.v1;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// go_package ç”Ÿæˆ go æ–‡ä»¶å½“ä¸­çš„åŒ…å&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;option&lt;/span&gt; go_package = &lt;span class=&quot;hljs-string&quot;&gt;&quot;github.com/mohuishou/new-project/api/product/app/v1&quot;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;google/api/annotations.proto&quot;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;BlogService&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;  &lt;span class=&quot;hljs-comment&quot;&gt;// åˆ›å»ºæ–‡ç« &lt;/span&gt;&lt;br/&gt;  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;rpc&lt;/span&gt; CreateArticle(CreateArticleReq) &lt;span class=&quot;hljs-keyword&quot;&gt;returns&lt;/span&gt; (CreateArticleResp) &lt;/span&gt;{&lt;br/&gt;  &lt;span class=&quot;hljs-comment&quot;&gt;// option è¿˜æ˜¯éƒ½åŠ ä¸Šï¼Œå¯ä»¥åˆ©ç”¨æ’ä»¶è‡ªåŠ¨ç”Ÿæˆ swagger æ–‡æ¡£&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-keyword&quot;&gt;option&lt;/span&gt; (google.api.http) = {&lt;br/&gt;      post: &lt;span class=&quot;hljs-string&quot;&gt;&quot;/article&quot;&lt;/span&gt;&lt;br/&gt;      body: &lt;span class=&quot;hljs-string&quot;&gt;&quot;*&quot;&lt;/span&gt;&lt;br/&gt;    };&lt;br/&gt;  }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// å‚æ•°å’Œè¿”å›å€¼å®šä¹‰ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†åˆ—äº†&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CreateArticleReq&lt;/span&gt; &lt;/span&gt;{}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CreateArticleResp&lt;/span&gt; &lt;/span&gt;{}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æˆåŠŸçš„ä¾‹å­åƒç¯‡ä¸€å¾‹ï¼Œè·¯ä¸Šçš„å‘å„ä¸ç›¸åŒï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‡ ä¸ªå…¸å‹çš„å‘(é—®é¢˜)ï¼Œä»¥åŠè¯¥å¦‚ä½•è§£å†³&lt;/p&gt;&lt;h4 id=&quot;Q1-Get-è¯·æ±‚å‚æ•°å¦‚ä½•è¿›è¡Œç»‘å®šï¼Œé»˜è®¤æ— æ³•ä¿®æ”¹-struct-tag&quot;&gt;&lt;a href=&quot;#Q1-Get-è¯·æ±‚å‚æ•°å¦‚ä½•è¿›è¡Œç»‘å®šï¼Œé»˜è®¤æ— æ³•ä¿®æ”¹-struct-tag&quot; class=&quot;headerlink&quot; title=&quot;Q1: Get è¯·æ±‚å‚æ•°å¦‚ä½•è¿›è¡Œç»‘å®šï¼Œé»˜è®¤æ— æ³•ä¿®æ”¹ struct tag&quot;/&gt;Q1: Get è¯·æ±‚å‚æ•°å¦‚ä½•è¿›è¡Œç»‘å®šï¼Œé»˜è®¤æ— æ³•ä¿®æ”¹ struct tag&lt;/h4&gt;&lt;p&gt;è¿™ä¸ªç¨³å®šåŒæ ·é€‚ç”¨äºå‚æ•°æ ¡éªŒï¼ŒåŸæ¥ gin å‚æ•°æ ¡éªŒå¯ä»¥åœ¨ struct ä¸ŠåŠ  tag è§£å†³ï¼Œè¿™ä¸ªæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯ä½¿ç”¨ &lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/favadi/protoc-go-inject-tag&quot;&gt;protoc-go-inject-tag&lt;/a&gt; åŠ æ³¨é‡Šè§£å†³ï¼Œå¦å¤–ä¸€ç§æ˜¯ä½¿ç”¨ &lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/gogo/protobuf&quot;&gt;gogo/protobuf&lt;/a&gt; æ”¯æŒæ·»åŠ  option çš„æ–¹å¼æ¥æ·»åŠ  tagï¼Œç›®å‰æˆ‘é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€ç§&lt;/p&gt;&lt;p&gt;åªéœ€è¦åœ¨å®šä¹‰ message çš„æ—¶å€™æ·»åŠ æ³¨é‡Š &lt;code&gt;// @inject_tag:&lt;/code&gt; åé¢æ˜¯å…·ä½“çš„ tag&lt;/p&gt;&lt;figure class=&quot;highlight protobuf&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs protobuf&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;GetArticleReq&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;  &lt;span class=&quot;hljs-comment&quot;&gt;// @inject_tag: form:&quot;id&quot; binding:&quot;required&quot;&lt;/span&gt;&lt;br/&gt;  &lt;span class=&quot;hljs-built_in&quot;&gt;int32&lt;/span&gt; id = &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬åœ¨ç”Ÿæˆå¥½å¯¹åº”çš„ go æ–‡ä»¶ä¹‹åæ‰§è¡Œä¸€ä¸‹ &lt;code&gt;protoc-go-inject-tag -input=filepath&lt;/code&gt; å°±å¯ä»¥äº†&lt;/p&gt;&lt;h4 id=&quot;Q2-è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„&quot;&gt;&lt;a href=&quot;#Q2-è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„&quot; class=&quot;headerlink&quot; title=&quot;Q2: è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„&quot;/&gt;Q2: è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„&lt;/h4&gt;&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¹‹å‰å¯èƒ½æœ‰ä¸€ä¸ª &lt;code&gt;get: /article/tags&lt;/code&gt; çš„æ¥å£ï¼Œç”±äºä¸€ç¯‡æ–‡ç« å½“ä¸­çš„æ ‡ç­¾ä¸ä¼šå¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰åšåˆ†é¡µï¼Œè¿”å›æ•°æ®çš„æ—¶å€™ç›´æ¥åœ¨ data é‡Œé¢å¡äº†ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæˆ‘ä»¬è¿ç§»çš„æ—¶å€™å°±éº»çƒ¦äº† o(â•¥ï¹â•¥)o&lt;/p&gt;&lt;p&gt;å› ä¸ºåœ¨ protobuf çš„ rpc æ–¹æ³•å®šä¹‰å½“ä¸­ï¼Œåªèƒ½è¿”å›ä¸€ä¸ªç»“æ„ä½“ï¼Œæ— æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ç»“æ„ï¼Œä½†æ˜¯æˆ‘ä»¬åšé‡æ„çš„æ—¶å€™åˆä¸æƒ³æœ‰ api çš„ç ´åæ€§å˜æ›´ï¼Œå› ä¸ºè¿™é¡¹æ‰€æœ‰çš„ä¾èµ–æ–¹éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹æˆæœ¬å¤ªå¤§äº†ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•å…¼å®¹å‘¢ï¼Ÿ&lt;/p&gt;&lt;p&gt;æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯å…ˆç”Ÿæˆå¯¹åº”çš„ go ç»“æ„ä½“ï¼Œç„¶ååœ¨åŒä¸€ä¸ªåŒ…å†…åˆ›å»ºä¸€ä¸ª &lt;code&gt;xx_type.pb.go&lt;/code&gt; é‡Œé¢å®ç° json çš„è§£ææ¥å£ï¼Œè®©æˆ‘ä»¬è™½ç„¶å®šä¹‰çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä½†æ˜¯è¿”å›æ¥å£æ•°æ®çš„æ—¶å€™è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„&lt;/p&gt;&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯æˆ‘å®šä¹‰çš„ pb&lt;/p&gt;&lt;figure class=&quot;highlight protobuf&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs protobuf&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ListArticleTagsResp&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;  &lt;span class=&quot;hljs-keyword&quot;&gt;repeated&lt;/span&gt; Tag tags = &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Tag&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;  &lt;span class=&quot;hljs-built_in&quot;&gt;string&lt;/span&gt; key = &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;&lt;br/&gt;  &lt;span class=&quot;hljs-built_in&quot;&gt;string&lt;/span&gt; value = &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;ç„¶åç”Ÿæˆäº† &lt;code&gt;v1.pb.go&lt;/code&gt; ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª &lt;code&gt;v1_type.pb.go&lt;/code&gt;&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// UnmarshalJSON sets *m to a copy of data.&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(m *ListArticleTagsResp)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;UnmarshalJSON&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(data []&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; m == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; errors.New(&lt;span class=&quot;hljs-string&quot;&gt;&quot;json.RawMessage: UnmarshalJSON on nil pointer&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; json.Unmarshal(data, &amp;amp;m.Tags)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// MarshalJSON returns m as the JSON encoding of m.&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(m *ListArticleTagsResp)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MarshalJSON&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;([]&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; m == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; []&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;null&quot;&lt;/span&gt;), &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; json.Marshal(m.Tags)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;å½“ç„¶åç»­æœ€å¥½è¿˜æ˜¯ä¿®æ”¹ä¸€ä¸‹ï¼Œä½†æ˜¯é‡æ„çš„æ—¶å€™è¿˜æ˜¯å»ºè®®ä¸è¦åšç ´åæ€§çš„å˜åŠ¨&lt;/p&gt;&lt;h4 id=&quot;Q3-è¿”å›å€¼å½“ä¸­åŒ…å«æ—¶é—´&quot;&gt;&lt;a href=&quot;#Q3-è¿”å›å€¼å½“ä¸­åŒ…å«æ—¶é—´&quot; class=&quot;headerlink&quot; title=&quot;Q3: è¿”å›å€¼å½“ä¸­åŒ…å«æ—¶é—´&quot;/&gt;Q3: è¿”å›å€¼å½“ä¸­åŒ…å«æ—¶é—´&lt;/h4&gt;&lt;p&gt;é™¤äº†æ•°ç»„ä¹‹å¤–ï¼Œè¿”å›å€¼å½“ä¸­åŒ…å«æ—¶é—´ä¹Ÿæ˜¯æŒºéº»çƒ¦çš„ä¸€ä»¶äº‹æƒ…ï¼Œé¦–å…ˆ pb çš„åŸºç¡€ç±»å‹é‡Œé¢æ²¡æœ‰æ—¶é—´ç±»å‹ï¼Œç„¶å google å®˜æ–¹çš„åº“å½“ä¸­æœ‰ä¸€ä¸ª timestamp åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™å°±ä¼šå‘ç°ï¼Œåœ¨ json åºåˆ—è¯çš„æ—¶å€™ä¸æ˜¯ä¸€ä¸ªæ—¶é—´å­—æ®µï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡å€¼ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰ç›´æ¥ä½¿ç”¨ &lt;code&gt;time.Time&lt;/code&gt; çš„è¡Œä¸ºä¸ä¸€è‡´ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘çš„åšæ³•æ˜¯ä»¿ç…§ google çš„åŒ…è‡ªå·±æä¸€ä¸ªç„¶åå®ç° json çš„ç›¸å…³æ–¹æ³•ï¼Œè®© json åºåˆ—åŒ–çš„æ—¶å€™çš„è¡Œä¸ºå’Œ &lt;code&gt;time.Time&lt;/code&gt; ä¿æŒä¸€è‡´&lt;/p&gt;&lt;p&gt;é¦–å…ˆå®šä¹‰ &lt;code&gt;timestamp.proto&lt;/code&gt;&lt;/p&gt;&lt;figure class=&quot;highlight protobuf&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs protobuf&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡ŒæŒ‡å®šäº† proto æ–‡ä»¶çš„ç‰ˆæœ¬&lt;/span&gt;&lt;br/&gt;syntax = &lt;span class=&quot;hljs-string&quot;&gt;&quot;proto3&quot;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// package å‘½åè§„åˆ™: product.application.version&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; product.app.v1;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// go_package ç”Ÿæˆ go æ–‡ä»¶å½“ä¸­çš„åŒ…å&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;option&lt;/span&gt; go_package = &lt;span class=&quot;hljs-string&quot;&gt;&quot;github.com/mohuishou/new-project/api/product/app/v1&quot;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Timestamp&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// Represents seconds of UTC time since Unix epoch&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// 1970-01-01T00:00:00Z. Must be from 0001-01-01T00:00:00Z to&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// 9999-12-31T23:59:59Z inclusive.&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-built_in&quot;&gt;int64&lt;/span&gt; seconds = &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// Non-negative fractions of a second at nanosecond resolution. Negative&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// second values with fractions must still have non-negative nanos values&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// that count forward in time. Must be from 0 to 999,999,999&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// inclusive.&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-built_in&quot;&gt;int32&lt;/span&gt; nanos = &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;å’Œä¸Šé¢ä¸€æ ·ï¼Œåˆ›å»ºä¸€ä¸ª &lt;code&gt;timestamp_type.pb.go&lt;/code&gt; ï¼Œé™¤äº†å®ç° json çš„æ¥å£ä»¥å¤–è¿˜å®ç°äº†ä¸¤ä¸ªè½¬æ¢æ–¹æ³•ï¼Œç”¨äº service å±‚è°ƒç”¨&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// NewTimestamp NewTimestamp&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;NewTimestamp&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(t time.Time)&lt;/span&gt; *&lt;span class=&quot;hljs-title&quot;&gt;Timestamp&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;Timestamp{&lt;br/&gt;Seconds: t.Unix(),&lt;br/&gt;Nanos:   &lt;span class=&quot;hljs-keyword&quot;&gt;int32&lt;/span&gt;(t.Nanosecond()),&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Time ç±»å‹è½¬æ¢&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(m *Timestamp)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Time&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;time&lt;/span&gt;.&lt;span class=&quot;hljs-title&quot;&gt;Time&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Don&#x27;t return the zero value on error, because corresponds to a valid&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// timestamp. Instead return whatever time.Unix gives us.&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; m == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; time.Unix(&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;).UTC() &lt;span class=&quot;hljs-comment&quot;&gt;// treat nil like the empty Timestamp&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; time.Unix(m.Seconds, &lt;span class=&quot;hljs-keyword&quot;&gt;int64&lt;/span&gt;(m.Nanos)).UTC()&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// UnmarshalJSON sets *m to a copy of data.&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(m *Timestamp)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;UnmarshalJSON&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(data []&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; m == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; errors.New(&lt;span class=&quot;hljs-string&quot;&gt;&quot;json.RawMessage: UnmarshalJSON on nil pointer&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; t time.Time&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := json.Unmarshal(data, &amp;amp;t); err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; err&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;*m = *NewTimestamp(t)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// MarshalJSON returns m as the JSON encoding of m.&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(m *Timestamp)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MarshalJSON&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;([]&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; m == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; []&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;null&quot;&lt;/span&gt;), &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; json.Marshal(m.Time())&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;domain&quot;&gt;&lt;a href=&quot;#domain&quot; class=&quot;headerlink&quot; title=&quot;domain&quot;/&gt;domain&lt;/h3&gt;&lt;p&gt;domain è¿™ä¸€å±‚ä¸»è¦æ˜¯åŒ…å« do å¯¹è±¡çš„å®šä¹‰ï¼Œä»¥åŠ usecase å’Œ repo å±‚çš„æ¥å£å®šä¹‰ï¼Œç”±äºæˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„ gorm æ‰€ä»¥ï¼Œä¹Ÿä¼šåœ¨è¿™é‡Œç»™ do å¯¹è±¡åŠ ä¸Šä¸€äº› tag ç”¨äºæ ‡å¿—ç´¢å¼•ï¼Œå…³è”å…³ç³»ç­‰ã€‚&lt;/p&gt;&lt;h4 id=&quot;domain-example&quot;&gt;&lt;a href=&quot;#domain-example&quot; class=&quot;headerlink&quot; title=&quot;domain example&quot;/&gt;domain example&lt;/h4&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// article.go&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Article æ–‡ç« &lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; Article &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;Model &lt;span class=&quot;hljs-comment&quot;&gt;// åŸºç¡€ç»“æ„ä½“ï¼ŒåŒ…å« id, created_at, deleted_at, updated_at&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Title   &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;`json:&quot;title&quot;`&lt;/span&gt;&lt;br/&gt;Content &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;`json:&quot;content&quot;`&lt;/span&gt;&lt;br/&gt;Tags    []Tag  &lt;span class=&quot;hljs-string&quot;&gt;`json:&quot;tags&quot; gorm:&quot;many2many:article_tags&quot;`&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// IArticleUsecase IArticleUsecase&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; IArticleUsecase &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt; {&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// è·å–æ–‡ç« è¯¦æƒ…&lt;/span&gt;&lt;br/&gt;GetArticle(ctx context.Context, id &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt;) (*Article, error)&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// åˆ›å»ºä¸€ç¯‡æ–‡ç« &lt;/span&gt;&lt;br/&gt;    CreateArticle(ctx context.Context, article *Article) error&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// IArticleRepo IArticleRepo&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; IArticleRepo &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt; {&lt;br/&gt;GetArticle(ctx context.Context, id &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt;) (*Article, error)&lt;br/&gt;CreateArticle(ctx context.Context, article *Article) error&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// tag.go&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Tag æ ‡ç­¾æ•°æ®&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; Tag &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;Model&lt;br/&gt;&lt;br/&gt;Key   &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;`json:&quot;key&quot;`&lt;/span&gt;&lt;br/&gt;Value &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;`json:&quot;value&quot;`&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;è¿™ä¸€å±‚çš„å‘ç¨å¾®å°‘ä¸€äº›ï¼Œä¸»è¦æ˜¯æ¥å£å®šä¹‰çš„ç›¸å…³äº‹æƒ…&lt;/p&gt;&lt;h4 id=&quot;å°æŠ€å·§-æ‰¹é‡-mock-æ¥å£&quot;&gt;&lt;a href=&quot;#å°æŠ€å·§-æ‰¹é‡-mock-æ¥å£&quot; class=&quot;headerlink&quot; title=&quot;å°æŠ€å·§: æ‰¹é‡ mock æ¥å£&quot;/&gt;å°æŠ€å·§: æ‰¹é‡ mock æ¥å£&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨æœ€æ–°çš„é¡¹ç›®ç»“æ„æˆ‘ä»¬ä¼šåœ¨ domain ä¸­åˆ›å»ºå¤§é‡æ¥å£ï¼Œä¹‹å‰åœ¨ &lt;a href=&quot;https://lailin.xyz/post/go-training-week4-unit-test.html&quot;&gt;Go å·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯•&lt;/a&gt; ä¸­æˆ‘ä»¬æåˆ°äº†ï¼Œåœ¨æ¯ä¸€å±‚çš„å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä¼šæŠŠä¾èµ–çš„æ¥å£ç”¨ gomock ç»™ mock æ‰ï¼Œè®©æµ‹è¯•å°½é‡è½»é‡çº§ä¸€äº›ï¼Œä¸ºäº†ç®€åŒ– gomock çš„åˆ›å»ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ &lt;code&gt;makefile&lt;/code&gt; å½“ä¸­å†™ä¸€ä¸ª &lt;code&gt;shell&lt;/code&gt; è„šæœ¬ï¼Œæ‰¾å‡ºå«æœ‰ &lt;code&gt;interface&lt;/code&gt; å®šä¹‰çš„æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬ç”¨ gomock ç”Ÿæˆå¯¹åº”çš„ mock æ–‡ä»¶&lt;/p&gt;&lt;figure class=&quot;highlight makefile&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs makefile&quot;&gt;&lt;span class=&quot;hljs-section&quot;&gt;mockgen:&lt;/span&gt;&lt;br/&gt;cd ./internal &amp;amp;&amp;amp; for file in `egrep -rnl &lt;span class=&quot;hljs-string&quot;&gt;&quot;type.*?interface&quot;&lt;/span&gt; ./domain | grep -v &lt;span class=&quot;hljs-string&quot;&gt;&quot;_test&quot;&lt;/span&gt; `; do \&lt;br/&gt;echo $$file ; \&lt;br/&gt;cd .. &amp;amp;&amp;amp; mockgen -destination=&lt;span class=&quot;hljs-string&quot;&gt;&quot;./internal/pkg/mock/$$file&quot;&lt;/span&gt; -source=&lt;span class=&quot;hljs-string&quot;&gt;&quot;./internal/$$file&quot;&lt;/span&gt; &amp;amp;&amp;amp; cd ./internal ; \&lt;br/&gt;done&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;service&quot;&gt;&lt;a href=&quot;#service&quot; class=&quot;headerlink&quot; title=&quot;service&quot;/&gt;service&lt;/h3&gt;&lt;p&gt;æ–°çš„ service å±‚çš„ä¸»è¦å·¦å³å°±æ˜¯ dto æ•°æ®å’Œ do æ•°æ®çš„ç›¸äº’è½¬æ¢ï¼Œå®ƒå®ç°äº† &lt;code&gt;v1&lt;/code&gt; åŒ…ä¸­çš„ç›¸å…³æ¥å£ï¼Œservice çš„ä»£ç æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­&lt;/p&gt;&lt;h4 id=&quot;service-example&quot;&gt;&lt;a href=&quot;#service-example&quot; class=&quot;headerlink&quot; title=&quot;service example&quot;/&gt;service example&lt;/h4&gt;&lt;p&gt;æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨è¿ç§» serviceã€usecaseã€repo çš„æ—¶å€™ï¼Œéƒ½åº”è¯¥å…ˆå†™å¯¹åº”çš„å•å…ƒæµ‹è¯•ï¼Œæœ¬æ–‡å½“ä¸­ç”±äºç¯‡å¹…åŸå› æˆ‘å°±æ²¡æœ‰å†åˆ—äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥æŸ¥çœ‹ä¸Šä¸€ç¯‡æ–‡ç«  &lt;a href=&quot;https://lailin.xyz/post/go-training-week4-unit-test.html&quot;&gt;Go å·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯•&lt;/a&gt; å¯¹åº”ç« èŠ‚çš„å†…å®¹&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// ç¡®ä¿å®ç°äº†å¯¹åº”çš„æ¥å£&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; _ v1.BlogServiceHTTPServer = &amp;amp;Artcile{}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Artcile Artcile&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; Artcile &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;usecase domain.IArticleUsecase&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// NewArticleService åˆå§‹åŒ–æ–¹æ³•&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;NewArticleService&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(usecase domain.IArticleUsecase)&lt;/span&gt; *&lt;span class=&quot;hljs-title&quot;&gt;Artcile&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;Artcile{usecase: usecase}&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// CreateArticle åˆ›å»ºä¸€ç¯‡æ–‡ç« &lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(a *Artcile)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CreateArticle&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context, req *v1.CreateArticleReq)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*v1.CreateArticleResp, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;article := &amp;amp;domain.Article{&lt;br/&gt;Title:   req.Title,&lt;br/&gt;Content: req.Content,&lt;br/&gt;}&lt;br/&gt;err := a.usecase.CreateArticle(ctx, article)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;v1.CreateArticleResp{}, err&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&quot;å°æŠ€å·§-copier-å‡å°‘é‡å¤çš„å¤åˆ¶ç²˜è´´æ“ä½œ&quot;&gt;&lt;a href=&quot;#å°æŠ€å·§-copier-å‡å°‘é‡å¤çš„å¤åˆ¶ç²˜è´´æ“ä½œ&quot; class=&quot;headerlink&quot; title=&quot;å°æŠ€å·§: copier å‡å°‘é‡å¤çš„å¤åˆ¶ç²˜è´´æ“ä½œ&quot;/&gt;å°æŠ€å·§: copier å‡å°‘é‡å¤çš„å¤åˆ¶ç²˜è´´æ“ä½œ&lt;/h4&gt;&lt;p&gt;åœ¨ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æ•°æ®è½¬æ¢æ˜¯æ‰‹åŠ¨å†™çš„ï¼Œè¿™ç§æ–¹æ³•ä¸æ˜¯ä¸è¡Œï¼Œä½†æ˜¯ç¤ºä¾‹å½“ä¸­çš„å­—æ®µæ¯”è¾ƒå°‘ï¼Œå¦‚æœå­—æ®µå¤šäº†èµ·æ¥ï¼Œå¹¶ä¸”è¿˜æœ‰å„ç§æ•°ç»„ç±»å‹çš„å­˜åœ¨çš„æ—¶å€™ï¼Œæ•°æ®è½¬æ¢çš„è¿™éƒ¨åˆ†ä»£ç å†™çš„å°±ä¼šæ¯”è¾ƒéš¾å—äº†ï¼Œå¦‚æœä½ çš„åº”ç”¨å’Œæˆ‘çš„ä¸€æ ·å¯¹æ€§èƒ½çš„è¦æ±‚ä¸æ˜¯å¾ˆé«˜çš„è¯å¯ä»¥è¯•è¯•ä¸‹é¢è¿™ç§æ–¹å¼ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘æœ€å¼€å§‹æ˜¯ç”¨äº† jinzhu å¤§ä½¬çš„ &lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://pkg.go.dev/github.com/jinzhu/copier&quot;&gt;copier&lt;/a&gt; åŒ…æ¥åšçš„æ•°æ®è½¬æ¢ï¼Œä½†æ˜¯è¿™ä¸ªåŒ…æ¯”è¾ƒå±€é™ï¼Œå®ƒä¸»è¦æ˜¯åœ¨ä¸¤ä¸ªç»“æ„çš„ä¹‹é—´çš„å­—æ®µåä»¥åŠç±»å‹ç›¸åŒçš„æ—¶å€™æœ‰ç”¨ï¼Œå‘å‡ºç°æˆ‘ä»¬ä¸Šé¢åœ¨ api éƒ¨åˆ†è®²çš„é‚£ç§éªšæ“ä½œå°±ä¸é€‚ç”¨äº†ï¼Œå¹¶ä¸”æˆ‘è¿˜å‡ºç°è¿‡ç”±äºä¸¤è¾¹å­—æ®µçš„å¤§å°å†™ä¸ä¸€è‡´å¯¼è‡´æœ€åæœ‰ä¸€ä¸ªå­—æ®µæ²¡æœ‰å¤åˆ¶æˆåŠŸå¯¼è‡´çš„é—®é¢˜ï¼ˆæ‰€ä»¥ç”¨è¿™ä¸ªä¸€å®šè¦å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•ï¼‰ã€‚&lt;/p&gt;&lt;p&gt;æ‰€ä»¥ç»“åˆæˆ‘ä»¬ä¹‹å‰çš„æ“ä½œï¼Œæˆ‘è‡ªå·±æ‰‹åŠ¨å†™äº†ä¸€ä¸ª copier å‡½æ•°ç­¾åä¸€æ ·ï¼Œå®ç°éå¸¸ç®€å•ï¼Œå½“ç„¶æ€§èƒ½ä¸å¤ªå¥½ï¼Œä½†æ˜¯å¦‚æœå¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„è¯ä¹Ÿèƒ½ç”¨.&lt;/p&gt;&lt;p&gt;å¦‚ä¸‹æ‰€ç¤ºï¼Œå°±æ˜¯ç”¨ json æ¥å›å€’è…¾ä¸¤æ¬¡å°±è¡Œäº†&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Copy ä»ä¸€ä¸ªç»“æ„ä½“å¤åˆ¶åˆ°å¦ä¸€ä¸ªç»“æ„ä½“&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Copy&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(to, from &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{})&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;b, err := json.Marshal(from)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; errors.Wrap(err, &lt;span class=&quot;hljs-string&quot;&gt;&quot;marshal from data err&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;err = json.Unmarshal(b, to)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; errors.Wrap(err, &lt;span class=&quot;hljs-string&quot;&gt;&quot;unmarshal to data err&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;å¦‚æœä½¿ç”¨è¿™ä¸ªå‡½æ•°çš„è¯ï¼Œæˆ‘ä»¬ä¸Šé¢çš„ä»£ç å°±å¯ä»¥æ”¹æˆ&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// CreateArticle åˆ›å»ºä¸€ç¯‡æ–‡ç« &lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(a *Artcile)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CreateArticle&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context, req *v1.CreateArticleReq)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*v1.CreateArticleResp, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; article domain.Article&lt;br/&gt;err := copier.Copy(&amp;amp;article, req)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;, err&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;err = a.usecase.CreateArticle(ctx, &amp;amp;article)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;v1.CreateArticleResp{}, err&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;usecase&quot;&gt;&lt;a href=&quot;#usecase&quot; class=&quot;headerlink&quot; title=&quot;usecase&quot;/&gt;usecase&lt;/h3&gt;&lt;p&gt;è¿™ä¸€å±‚ä¸»è¦æ˜¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸šåŠ¡é€»è¾‘ç›¸å…³ä»£ç éƒ½åº”è¯¥åœ¨è¿™ä¸€å±‚å†™ï¼Œå½“ç„¶æœ‰æ—¶å€™æˆ‘ä»¬çš„ä»£ç å¯èƒ½å°±åªæ˜¯ä¿å­˜ä¸€ä¸‹æ•°æ®æ²¡å•¥ä¸šåŠ¡é€»è¾‘ï¼Œå¯èƒ½æ˜¯ç›´æ¥è°ƒç”¨ä¸€ä¸‹ repo çš„æ–¹å¼&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; article &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;repo domain.IArticleRepo&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// NewArticleUsecase init&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;NewArticleUsecase&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(repo domain.IArticleRepo)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;domain&lt;/span&gt;.&lt;span class=&quot;hljs-title&quot;&gt;IArticleUsecase&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;article{repo: repo}&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(u *article)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;GetArticle&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context, id &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt;)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*domain.Article, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œå¯èƒ½æœ‰å…¶ä»–ä¸šåŠ¡é€»è¾‘...&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; u.repo.GetArticle(ctx, id)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(u *article)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CreateArticle&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context, article *domain.Article)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; u.repo.CreateArticle(ctx, article)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;repo&quot;&gt;&lt;a href=&quot;#repo&quot; class=&quot;headerlink&quot; title=&quot;repo&quot;/&gt;repo&lt;/h3&gt;&lt;p&gt;è¿™ä¸€å±‚æ˜¯æ•°æ®æŒä¹…å±‚ï¼Œåƒæ•°æ®åº“å­˜å–ï¼Œç¼“å­˜çš„å¤„ç†åº”è¯¥éƒ½åœ¨è¿™ä¸€å±‚åšæ‰ï¼Œè¿˜æœ‰å¯èƒ½åç»­æˆ‘ä»¬å˜æˆè°ƒç”¨ä¸€ä¸ªå¾®æœåŠ¡æ¥å®ç°ï¼Œé‚£ä¹ˆè¿™ä¸ªè¢«è°ƒç”¨çš„å¾®æœåŠ¡ä¹Ÿåº”è¯¥åœ¨è¿™é‡Œåšã€‚&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; article &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;db *gorm.DB&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// NewArticleRepo init&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;NewArticleRepo&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(db *gorm.DB)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;domain&lt;/span&gt;.&lt;span class=&quot;hljs-title&quot;&gt;IArticleRepo&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;article{db: db}&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(r *article)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;GetArticle&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context, id &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt;)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*domain.Article, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; a domain.Article&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := r.db.WithContext(ctx).Find(&amp;amp;a, id); err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œè¿”å›ä¸šåŠ¡é”™è¯¯ç &lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;a, &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(r *article)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CreateArticle&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context, article *domain.Article)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := r.db.WithContext(ctx).Create(article); err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œè¿”å›ä¸šåŠ¡é”™è¯¯ç &lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;wire-set-go&quot;&gt;&lt;a href=&quot;#wire-set-go&quot; class=&quot;headerlink&quot; title=&quot;wire_set.go&quot;/&gt;wire_set.go&lt;/h3&gt;&lt;p&gt;ä¹‹å‰åœ¨ &lt;a href=&quot;https://lailin.xyz/post/go-training-week4-wire.html&quot;&gt;Go å·¥ç¨‹åŒ–(ä¸‰) ä¾èµ–æ³¨å…¥æ¡†æ¶ wire&lt;/a&gt; è¿™ä¸€èŠ‚è®²åˆ°è¿‡ï¼Œæˆ‘ä»¬ä½¿ç”¨ wire ä½œä¸ºæˆ‘ä»¬çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œç”±äº wire ä¸èƒ½å‡ºç°ç›¸åŒçš„ Provider æ‰€ä»¥æˆ‘ä»¬ä¼šåœ¨ internal çš„æ¯ä¸ªå­ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸‹ wire_set.go ç”¨äºæ„å»º wire.Set ç»“æ„ï¼Œåˆ°æ—¶æˆ‘ä»¬åœ¨ cmd ä¸‹ç›´æ¥åº”ç”¨è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å°±å¯ä»¥äº†&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; server&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; (&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;github.com/google/wire&quot;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;github.com/mohuishou/new-project/internal/server/repo&quot;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;github.com/mohuishou/new-project/internal/server/service&quot;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;github.com/mohuishou/new-project/internal/server/usecase&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Set for di&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; Set = wire.NewSet(&lt;br/&gt;service.NewArticleService,&lt;br/&gt;usecase.NewArticleUsecase,&lt;br/&gt;repo.NewArticleRepo,&lt;br/&gt;)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;cmd&quot;&gt;&lt;a href=&quot;#cmd&quot; class=&quot;headerlink&quot; title=&quot;cmd&quot;/&gt;cmd&lt;/h3&gt;&lt;p&gt;cmd ä¸‹çš„äºŒè¿›åˆ¶ç›®å½•ï¼Œæˆ‘ä¸€èˆ¬ä¼šåŒ…å«å››ä¸ªæ–‡ä»¶&lt;/p&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs bash&quot;&gt;.&lt;br/&gt;â”œâ”€â”€ main.go &lt;span class=&quot;hljs-comment&quot;&gt;# åŒ…å« main å‡½æ•°&lt;/span&gt;&lt;br/&gt;â”œâ”€â”€ server.go &lt;span class=&quot;hljs-comment&quot;&gt;# åŒ…å« wire set ç­‰&lt;/span&gt;&lt;br/&gt;â”œâ”€â”€ wire.go &lt;span class=&quot;hljs-comment&quot;&gt;# for wire build&lt;/span&gt;&lt;br/&gt;â””â”€â”€ wire_gen.go &lt;span class=&quot;hljs-comment&quot;&gt;# wire è‡ªåŠ¨ç”Ÿæˆçš„&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;server.go&lt;/strong&gt; åœ¨çœŸå®çš„é¡¹ç›®å½“ä¸­æˆ‘ä»¬ service åŒ…ä¸‹é¢ä¸€èˆ¬ä¼šæœ‰å¤šä¸ª service æ–‡ä»¶ï¼Œå¯¹åº”ä¸åŒçš„ç»“æ„ä½“ï¼Œå¹¶ä¸”é™¤äº† internal ä¸­çš„ä¾èµ–å¤–æˆ‘ä»¬å¯èƒ½è¿˜ä¼šæœ‰å¾ˆå¤šå…¬å…±çš„ä¾èµ–ï¼Œä¾‹å¦‚é…ç½®ä¸­å¿ƒï¼Œæ—¥å¿—ï¼Œæ•°æ®åº“ç­‰ï¼Œæˆ‘çš„ä¹ æƒ¯æ˜¯æ„å»ºä¸€ä¸ªæ–°çš„ç»“æ„ï¼Œåœ¨è¿™ä¸ªç»“æ„å½“ä¸­æˆ‘ä»¬æŠŠæ‰€æœ‰çš„æ³¨å†Œè¿˜è¿˜æœ‰ wire.set æå¥½ï¼Œè¿™æ · main å‡½æ•°å°±ä¼šå¾ˆæ¸…çˆ½ï¼Œæ•´ä½“ä¸Šä¹Ÿä¼šæ¯”è¾ƒæ•´æ´&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; set = wire.NewSet(&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// domains&lt;/span&gt;&lt;br/&gt;server.Set,&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// common&lt;/span&gt;&lt;br/&gt;initializer.Set,&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; services &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;article *service.Artcile&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(s *services)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(r gin.IRouter)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;v1.RegisterBlogServiceHTTPServer(r, s.article)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;wire.go&lt;/strong&gt; ç»è¿‡ server.go å°è£…ä¹‹åï¼Œwire.go çš„ä»£ç å°±éå¸¸ç®€å•äº†&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// NewServices NewServices&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;NewServices&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*services, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(wire.Build(&lt;br/&gt;wire.Struct(&lt;span class=&quot;hljs-built_in&quot;&gt;new&lt;/span&gt;(services), &lt;span class=&quot;hljs-string&quot;&gt;&quot;*&quot;&lt;/span&gt;),&lt;br/&gt;set,&lt;br/&gt;))&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;main.go&lt;/strong&gt; æˆ‘è¿™é‡Œè¿˜æ²¡æœ‰åƒ &lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/go-kratos/kratos/blob/main/app.go&quot;&gt;kratos&lt;/a&gt; æŠŠç¨‹åºçš„å¯åŠ¨å’Œé€€å‡ºå°è£…èµ·æ¥ï¼Œå¦‚æœå°è£…äº†ä¼šæ›´åŠ ä¼˜é›…ä¸€ç‚¹&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;s, err := NewServices()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(err)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;e := gin.Default()&lt;br/&gt;s.register(e)&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œè¿˜æœ‰ä¼˜é›…ä¸­æ­¢çš„ä¸€äº›ä»£ç ï¼Œå°±ä¸è´´äº†&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h2 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;/&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://mohuishou-blog-sz.oss-cn-shenzhen.aliyuncs.com/image/1615219210365-000fcd85-392a-41da-b7e4-8b4fc583123f.jpeg&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;Frame 1 (4).jpg&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;https://mohuishou-blog-sz.oss-cn-shenzhen.aliyuncs.com/image/1615268889054-251a4e39-c8d9-410f-950c-5262b368ae34.jpeg&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;Frame 2 (1).jpg&quot;/&gt;&lt;br/&gt;æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹ä¸Šé¢è¿™ä¸¤ç§ç»“æ„ï¼Œå¯ä»¥å‘ç°ï¼Œç¬¬ä¸€ç§ç»“æ„æ•´ä½“ä¸ŠèŒè´£ç›¸å¯¹æ²¡æœ‰é‚£ä¹ˆæ¸…æ™°ï¼Œå°±å¯¼è‡´äº†åœ¨å›¢é˜Ÿåä½œçš„è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¾ˆå¤šäºŒä¹‰æ€§ï¼Œå¯¼è‡´æœ€åè¶Šæ¥è¶Šæ··ä¹±ï¼Œå¹¶ä¸”ç”±äº model å±‚å°±æ˜¯ä¸€ä¸ªå¤§é”…é¥­ï¼Œä»€ä¹ˆéƒ½å¾€é‡Œé¢æ‰”æ‰€ä»¥ä¹Ÿå°±ä¹±çš„ä¸è¡Œäº†ã€‚&lt;/p&gt;&lt;p&gt;æ–°çš„ç»“æ„ä¸ä»…ä»…è¿›è¡Œäº†æ°´å¹³æ‹†åˆ†è¿˜æŒ‰ç…§åŠŸèƒ½è¿›è¡Œäº†å‚ç›´æ‹†åˆ†ï¼Œå°†å®šæ—¶ä»»åŠ¡å’Œ http æœåŠ¡çš„ä»£ç æ‹†åˆ†å¼€æ¥ï¼Œæ•´ä½“çš„ç»“æ„éƒ½æ¸…æ™°äº†å¾ˆå¤šï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬å¤§é‡ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œæ‰€ä»¥ä»£ç çš„å¯æµ‹æ€§éå¸¸çš„å¥½ï¼Œå†™å•å…ƒæµ‹è¯•éå¸¸å®¹æ˜“ã€‚&lt;br/&gt;ä½†æ˜¯è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå‘ï¼Œæ‹†åˆ†çš„æ—¶å€™è¦æ³¨æ„ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ‹†åˆ†æƒ³æŒ‰ç…§é¢†åŸŸè¿›è¡Œæ‹†åˆ†ï¼Œå¹¶ä¸”æ‹†åˆ†çš„éå¸¸ç»†ï¼Œå¯¼è‡´å‡ºç°äº†å¾ˆå¤šæœåŠ¡ï¼Œåé¢å¬è¿‡æ¯›è€å¸ˆè¯¾ä¸Šçš„è®²è§£åé‡æ–° review äº†ä¸€ä¸‹å‘ç°å…¶å®è¿™äº›æœåŠ¡è¾¹ç•Œæ²¡æœ‰é‚£ä¹ˆæ¸…æ™°ï¼Œå³ä½¿æˆ‘ä»¬ä»¥åæ‹†å¾®æœåŠ¡ï¼Œä¹Ÿä¸ä¼šæŠŠè¿™äº›æ‹†æˆä¸¤ä¸ªä¸åŒçš„å¾®æœåŠ¡ï¼Œæ‰€ä»¥åé¢å†æ”¹äº†ä¸€æ¬¡æ‰æ„æˆäº†ç°åœ¨çš„ç»“æ„ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è¿›è¡Œå‚ç›´æ‹†åˆ†çš„æ—¶å€™ä¸€å®šè¦å¤šé—®é—®è‡ªå·±ï¼Œæˆ–è€…å¤šå’Œå›¢é˜Ÿçš„åŒå­¦è®¨è®ºä¸€ä¸‹ã€‚&lt;/p&gt;&lt;p&gt;æœ€åæƒ³è¦ä¸šåŠ¡å¼€å‘çš„æ¯”è¾ƒå¼€å¿ƒæ„‰å¿«ï¼Œé‚£åŸºç¡€è®¾æ–½çš„å»ºè®¾éå¸¸é‡è¦ï¼Œåƒæœ¬æ–‡æåˆ°çš„å¾ˆå¤šä»£ç åªè¦æˆ‘ä»¬ç»Ÿä¸€äº†è§„èŒƒå’Œç»“æ„éƒ½å¯ä»¥é€šè¿‡å·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;æˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« è§ï¼ŒåŠ æ²¹æ‰“å·¥äºº ğŸ’ªï¼ˆçœ‹å®Œåˆ«å¿˜äº†è½¬å‘ï¼Œè®¢é˜…ï¼Œç‚¹èµå“¦ï¼‰&lt;/strong&gt;&lt;/p&gt;&lt;h2 id=&quot;å‚è€ƒæ–‡çŒ®&quot;&gt;&lt;a href=&quot;#å‚è€ƒæ–‡çŒ®&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒæ–‡çŒ®&quot;/&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;&lt;ol&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://u.geekbang.org/subject/go?utm_source=lailin.xyz&amp;amp;utm_medium=lailin.xyz&quot;&gt;Go è¿›é˜¶è®­ç»ƒè¥-æå®¢æ—¶é—´&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz/post/go-training-week4-clean-arch.html&quot;&gt;Go å·¥ç¨‹åŒ–(ä¸€) æ¶æ„æ•´æ´ä¹‹é“é˜…è¯»ç¬”è®° - Mohuishou&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz/post/go-training-week4-project-layout.html&quot;&gt;Go å·¥ç¨‹åŒ–(äºŒ) é¡¹ç›®ç›®å½•ç»“æ„ - Mohuishou&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz/post/go-training-week4-wire.html&quot;&gt;Go å·¥ç¨‹åŒ–(ä¸‰) ä¾èµ–æ³¨å…¥æ¡†æ¶ wire - Mohuishou&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz/post/go-training-week4-api-design.html&quot;&gt;Go å·¥ç¨‹åŒ–(å››) API è®¾è®¡ä¸Š: é¡¹ç›®ç»“æ„ &amp;amp; è®¾è®¡ - Mohuishou&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz/post/go-training-week4-protoc-gen-go-gin.html&quot;&gt;Go å·¥ç¨‹åŒ–(äº”) API è®¾è®¡ä¸‹: åŸºäº protobuf è‡ªåŠ¨ç”Ÿæˆ gin ä»£ç  - Mohuishou&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz/post/go-training-week4-config.html&quot;&gt;Go å·¥ç¨‹åŒ–(å…­) é…ç½®ç®¡ç† - Mohuishou&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz/post/go-training-week4-go-module.html&quot;&gt;Go å·¥ç¨‹åŒ–(ä¸ƒ) Go Module - Mohuishou&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz/post/go-training-week4-unit-test.html&quot;&gt;Go å·¥ç¨‹åŒ–(å…«) å•å…ƒæµ‹è¯• - Mohuishou&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/favadi/protoc-go-inject-tag&quot;&gt;https://github.com/favadi/protoc-go-inject-tag&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://pkg.go.dev/github.com/jinzhu/copier&quot;&gt;https://pkg.go.dev/github.com/jinzhu/copier&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/go-kratos/kratos/blob/main/app.go&quot;&gt;https://github.com/go-kratos/kratos/blob/main/app.go&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>e2e1a6409258c0c4c1efe823d2839590</guid>
<title>Java åŸºç¡€ï¼šæ—¥æœŸä¸æ—¶é—´ API ç”¨æ³•è¯¦è§£</title>
<link>https://toutiao.io/k/soqwk0v</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;h1&gt;&lt;span&gt;ä¸€ã€æ—¶é—´å’Œæ—¥æœŸ&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;åœ¨ç³»ç»Ÿå¼€å‘ä¸­ï¼Œæ—¥æœŸä¸æ—¶é—´ä½œä¸ºé‡è¦çš„ä¸šåŠ¡å› ç´ ï¼Œèµ·åˆ°ååˆ†å…³é”®çš„ä½œç”¨ï¼Œä¾‹å¦‚åŒä¸€ä¸ªæ—¶é—´èŠ‚ç‚¹ä¸‹çš„æ•°æ®ç”Ÿæˆï¼ŒåŸºäºæ—¶é—´èŒƒå›´çš„å„ç§æ•°æ®ç»Ÿè®¡å’Œåˆ†æï¼Œé›†ç¾¤èŠ‚ç‚¹ç»Ÿä¸€æ—¶é—´é¿å…è¶…æ—¶ç­‰ã€‚&lt;/p&gt;&lt;p&gt;åœ¨æ—¶é—´å’Œæ—¥æœŸä¸­æœ‰å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š&lt;/p&gt;&lt;p&gt;æ—¥æœŸå’Œæ—¶é—´çš„ç”¨æ³•åœ¨ç³»ç»Ÿä¸­é€šå¸¸æ˜¯è·å–æ—¶é—´å’Œä¸€äº›å¸¸è§çš„è®¡ç®—ä¸æ ¼å¼è½¬æ¢å¤„ç†ï¼Œåœ¨ä¸€äº›å®æ—¶åŒºçš„ä¸šåŠ¡ä¸­å°±ä¼šå˜çš„å¤æ‚å¾ˆå¤šï¼Œä¾‹å¦‚åœ¨ç”µå•†ä¸šåŠ¡ä¸­çš„å…¨çƒè´¸æ˜“æˆ–è€…æµ·æ·˜ç­‰ã€‚&lt;/p&gt;&lt;h1&gt;&lt;span&gt;äºŒã€JDKåŸç”ŸAPI&lt;/span&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span&gt;1ã€DateåŸºç¡€&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;åŸºç¡€ç”¨æ³•&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;java.sql.Dateç»§æ‰¿java.util.Dateï¼Œç›¸å…³æ–¹æ³•ä¹Ÿå¤§éƒ¨åˆ†ç›´æ¥è°ƒç”¨çˆ¶ç±»æ–¹æ³•ã€‚&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;DateTime01&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;(String[]Â args)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;long&lt;/span&gt;Â nowTimeÂ =Â System.currentTimeMillis()Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â java.util.DateÂ data01Â =Â &lt;span&gt;new&lt;/span&gt;Â java.util.Date(nowTime);&lt;br/&gt;Â Â Â Â Â Â Â Â java.sql.DateÂ date02Â =Â &lt;span&gt;new&lt;/span&gt;Â java.sql.Date(nowTime);&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(data01);&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(date02.getTime());&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;æ‰“å°ï¼š&lt;br/&gt;FriÂ JanÂ &lt;span&gt;29&lt;/span&gt;Â &lt;span&gt;15&lt;/span&gt;:&lt;span&gt;11&lt;/span&gt;:&lt;span&gt;25&lt;/span&gt;Â CSTÂ &lt;span&gt;2021&lt;/span&gt;&lt;br/&gt;&lt;span&gt;1611904285848&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;è®¡ç®—è§„åˆ™&lt;/strong&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;DateTime02&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;(String[]Â args)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â DateÂ nowDateÂ =Â &lt;span&gt;new&lt;/span&gt;Â Date();&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;å¹´:&quot;&lt;/span&gt;+nowDate.getYear());&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;æœˆ:&quot;&lt;/span&gt;+nowDate.getMonth());&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;æ—¥:&quot;&lt;/span&gt;+nowDate.getDay());&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¹´ä»½ï¼šå½“å‰æ—¶é—´å‡å»1900ï¼›&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;getYear&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â normalize().getYear()Â -Â &lt;span&gt;1900&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æœˆä»½ï¼š0-11è¡¨ç¤º1-12æœˆä»½ï¼›&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;getMonth&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â normalize().getMonth()Â -Â &lt;span&gt;1&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¤©ä»½ï¼šæ­£å¸¸è¡¨ç¤ºï¼›&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;getDay&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â normalize().getDayOfWeek()Â -Â BaseCalendar.SUNDAY;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;æ ¼å¼è½¬æ¢&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;éçº¿ç¨‹å®‰å…¨çš„æ—¥æœŸè½¬æ¢APIï¼Œè¯¥ç”¨æ³•åœ¨è§„èŒƒçš„å¼€å‘ä¸­æ˜¯ä¸å…è®¸ä½¿ç”¨çš„ã€‚&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;DateTime02&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;(String[]Â args)&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â ExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â é»˜è®¤è½¬æ¢&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â DateFormatÂ dateFormat01Â =Â &lt;span&gt;new&lt;/span&gt;Â SimpleDateFormat()Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â StringÂ nowDate01Â =Â dateFormat01.format(&lt;span&gt;new&lt;/span&gt;Â Date())Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;nowDate01=&quot;&lt;/span&gt;+nowDate01);&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æŒ‡å®šæ ¼å¼è½¬æ¢&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â StringÂ formatÂ =Â &lt;span&gt;&quot;yyyy-MM-ddÂ HH:mm:ss&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â SimpleDateFormatÂ dateFormat02Â =Â &lt;span&gt;new&lt;/span&gt;Â SimpleDateFormat(format);&lt;br/&gt;Â Â Â Â Â Â Â Â StringÂ nowDate02Â =Â dateFormat02.format(&lt;span&gt;new&lt;/span&gt;Â Date())Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;nowDate02=&quot;&lt;/span&gt;+nowDate02);&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â è§£ææ—¶é—´&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â StringÂ parseÂ =Â &lt;span&gt;&quot;yyyy-MM-ddÂ HH:mm&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â SimpleDateFormatÂ dateFormat03Â =Â &lt;span&gt;new&lt;/span&gt;Â SimpleDateFormat(parse);&lt;br/&gt;Â Â Â Â Â Â Â Â DateÂ parseDateÂ =Â dateFormat03.parse(&lt;span&gt;&quot;2021-01-18Â 16:59:59&quot;&lt;/span&gt;)Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;parseDate=&quot;&lt;/span&gt;+parseDate);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½œä¸ºJDKåˆå§‹ç‰ˆæœ¬å°±ä½¿ç”¨çš„æ—¥æœŸå’Œæ—¶é—´ï¼ŒDateç±»ä¸€ç›´åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯ç›¸å…³APIçš„æ–¹æ³•éƒ½å·²ç»åŸºæœ¬åºŸå¼ƒï¼Œé€šå¸¸ä½¿ç”¨ä¸€äº›äºŒæ¬¡å°è£…çš„æ—¶é—´ç»„ä»¶ã€‚è¯¥APIçš„è®¾è®¡å ªç§°Javaä¸­çš„æœ€çƒ‚ã€‚&lt;/p&gt;&lt;h2&gt;&lt;span&gt;2ã€Calendarå‡çº§&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;Calendarä½œä¸ºä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®šä¹‰æ—¥æœŸæ—¶é—´ç›¸å…³è½¬æ¢ä¸è®¡ç®—çš„æ–¹æ³•ï¼Œè¿™ä¸ªç±»ç›®æµ‹&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;DateTime04&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;(String[]Â args)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â CalendarÂ calendarÂ =Â Calendar.getInstance();&lt;br/&gt;Â Â Â Â Â Â Â Â calendar.set(Calendar.YEAR,&lt;span&gt;2021&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â calendar.set(Calendar.MONTH,&lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â calendar.set(Calendar.DAY_OF_MONTH,&lt;span&gt;12&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â calendar.set(Calendar.HOUR_OF_DAY,&lt;span&gt;23&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â calendar.set(Calendar.MINUTE,&lt;span&gt;59&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â calendar.set(Calendar.SECOND,&lt;span&gt;59&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â calendar.set(Calendar.MILLISECOND,&lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â DateFormatÂ dateFormatÂ =Â &lt;span&gt;new&lt;/span&gt;Â SimpleDateFormat(&lt;span&gt;&quot;yyyy-MM-ddÂ HH:mm:ss&quot;&lt;/span&gt;)Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â DateÂ defDateÂ =Â calendar.getTime();&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(defDate+&lt;span&gt;&quot;||&quot;&lt;/span&gt;+dateFormat.format(defDate));&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;è¾“å‡ºï¼šFri Feb &lt;span&gt;12&lt;/span&gt;Â &lt;span&gt;23&lt;/span&gt;:&lt;span&gt;59&lt;/span&gt;:&lt;span&gt;59&lt;/span&gt;Â CSTÂ &lt;span&gt;2021&lt;/span&gt;||&lt;span&gt;2021&lt;/span&gt;-&lt;span&gt;02&lt;/span&gt;-&lt;span&gt;12&lt;/span&gt;Â &lt;span&gt;23&lt;/span&gt;:&lt;span&gt;59&lt;/span&gt;:&lt;span&gt;59&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç›´è§‚æ„Ÿè§‰ï¼ŒDateä¸­ç›¸å…³æ–¹æ³•è¿ç§»Calendarå®ç°ï¼Œç®€åŒ–Dateçš„åŠŸèƒ½ä¾§é‡å¯¹æ—¥æœŸä¸æ—¶é—´çš„å®ä½“å°è£…ï¼ŒCalendarå¤æ‚ç›¸å…³è®¡ç®—ç­–ç•¥ï¼ŒDateFormatä¾æ—§ç”¨æ¥åšæ ¼å¼å¤„ç†ã€‚ä½†æ˜¯Calendarä¾æ—§å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œä¸Šè¿°åŸºç¡€APIå°±å·²ç»æ˜¯å¾ˆå¥½çš„è¯´æ˜äº†ã€‚&lt;/p&gt;&lt;h2&gt;&lt;span&gt;3ã€JDK1.8å‡çº§API&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;Java8ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œæ ¸å¿ƒAPIç±»åŒ…æ‹¬LocalDate-æ—¥æœŸã€LocalTime-æ—¶é—´ã€LocalDateTime-æ—¥æœŸåŠ æ—¶é—´ã€‚&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;LocalDateï¼šæ—¥æœŸæè¿°æ˜¯finalä¿®é¥°çš„ä¸å¯å˜ç±»ï¼Œé»˜è®¤æ ¼å¼yyyy-MM-ddã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;LocalTimeï¼šæ—¶é—´æè¿°æ˜¯finalä¿®é¥°çš„ä¸å¯å˜ç±»ï¼Œé»˜è®¤æ ¼å¼hh:mm:ss.zzzã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;LocalDateTimeï¼šæ—¥æœŸä¸æ—¶é—´æè¿°finalä¿®é¥°çš„ä¸å¯å˜ç±»ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;DateTime05&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;(String[]Â args)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ—¥æœŸï¼šå¹´-æœˆ-æ—¥&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(LocalDate.now());&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ—¶é—´ï¼šæ—¶-åˆ†-ç§’-æ¯«ç§’&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(LocalTime.now());&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ—¥æœŸæ—¶é—´ï¼šå¹´-æœˆ-æ—¥Â æ—¶-åˆ†-ç§’-æ¯«ç§’&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(LocalDateTime.now());&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ—¥æœŸèŠ‚ç‚¹è·å–&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â LocalDateÂ localDateÂ =Â LocalDate.now();&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;[&quot;&lt;/span&gt;Â +Â localDate.getYear()Â +&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;å¹´]ï¼›[&quot;&lt;/span&gt;Â +Â localDate.getMonthValue()Â +&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;æœˆ]ï¼›[&quot;&lt;/span&gt;Â +Â localDate.getDayOfMonth()+&lt;span&gt;&quot;æ—¥]&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â è®¡ç®—æ–¹æ³•&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;1å¹´åï¼š&quot;&lt;/span&gt;Â +Â localDate.plusYears(&lt;span&gt;1&lt;/span&gt;));&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;2æœˆå‰ï¼š&quot;&lt;/span&gt;Â +Â localDate.minusMonths(&lt;span&gt;2&lt;/span&gt;));&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;3å‘¨åï¼š&quot;&lt;/span&gt;Â +Â localDate.plusWeeks(&lt;span&gt;3&lt;/span&gt;));&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;3å¤©å‰ï¼š&quot;&lt;/span&gt;Â +Â localDate.minusDays(&lt;span&gt;3&lt;/span&gt;));&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ—¶é—´æ¯”è¾ƒ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â LocalTimeÂ localTime1Â =Â LocalTime.of(&lt;span&gt;12&lt;/span&gt;,Â &lt;span&gt;45&lt;/span&gt;,Â &lt;span&gt;45&lt;/span&gt;);Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â LocalTimeÂ localTime2Â =Â LocalTime.of(&lt;span&gt;16&lt;/span&gt;,Â &lt;span&gt;30&lt;/span&gt;,Â &lt;span&gt;30&lt;/span&gt;);Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(localTime1.isAfter(localTime2));&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(localTime2.isAfter(localTime1));&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(localTime2.equals(localTime1));&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ—¥æœŸå’Œæ—¶é—´æ ¼å¼&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â LocalDateTimeÂ localDateTimeÂ =Â LocalDateTime.now()Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â LocalDateÂ myLocalDateÂ =Â localDateTime.toLocalDate();&lt;br/&gt;Â Â Â Â Â Â Â Â LocalTimeÂ myLocalTimeÂ =Â localDateTime.toLocalTime();&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;æ—¥æœŸï¼š&quot;&lt;/span&gt;Â +Â myLocalDate);&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;æ—¶é—´ï¼š&quot;&lt;/span&gt;Â +Â myLocalTime);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœä½œä¸ºJodaTimeç»„ä»¶çš„æ·±åº¦ç”¨æˆ·ï¼Œå¯¹è¿™ä¸ªå‡ ä¸ªAPIä½¿ç”¨åŸºæœ¬æ— å‹åŠ›ã€‚&lt;/p&gt;&lt;h2&gt;&lt;span&gt;4ã€æ—¶é—´æˆ³&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;æ—¶é—´æˆ³ä¹Ÿæ˜¯ä¸šåŠ¡ä¸­å¸¸ç”¨çš„æ–¹å¼ï¼ŒåŸºäºLongç±»å‹è¡¨ç¤ºæ—¶é—´ï¼Œåœ¨å¾ˆå¤šæ—¶å€™è¿œæ¯”å¸¸è§„æ—¥æœŸä¸æ—¶é—´çš„æ ¼å¼æ›´å¥½ç”¨ã€‚&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;DateTime06&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;(String[]Â args)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â ç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(System.currentTimeMillis());&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;new&lt;/span&gt;Â Date().getTime());&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(Calendar.getInstance().getTime().getTime());&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(LocalDateTime.now().toInstant(&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ZoneOffset.of(&lt;span&gt;&quot;+8&quot;&lt;/span&gt;)).toEpochMilli());&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨å®é™…ä¸šåŠ¡ä¸­ç”±äºè·å–æ—¶é—´æˆ³çš„æ–¹å¼æ˜¯å¤šæ ·çš„ï¼Œæ‰€ä»¥å»ºè®®ç»Ÿä¸€å·¥å…·æ–¹æ³•ï¼Œå’Œè§„å®šç²¾ç¡®åº¦ï¼Œé¿å…éƒ¨åˆ†ç²¾ç¡®åˆ°ç§’éƒ¨åˆ†ç²¾ç¡®åˆ°æ¯«ç§’çš„é—®é¢˜ï¼Œè¿™æ ·å¯ä»¥è§„é¿åœ¨ä½¿ç”¨æ—¶ç›¸äº’è½¬æ¢çš„æƒ…å†µã€‚&lt;/p&gt;&lt;h1&gt;&lt;span&gt;ä¸‰ã€JodaTimeç»„ä»¶&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;åœ¨Java8ä¹‹å‰JodaTimeç»„ä»¶æ˜¯å¤§éƒ¨åˆ†ç³»ç»Ÿä¸­çš„å¸¸è§é€‰æ‹©ï¼Œæœ‰å¾ˆå¤šæ–¹ä¾¿å¥½ç”¨çš„æ—¥æœŸä¸æ—¶é—´çš„å¤„ç†æ–¹æ³•å°è£…ã€‚&lt;/p&gt;&lt;p&gt;åŸºç¡€ä¾èµ–ï¼š&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;joda-time&lt;span&gt;&amp;lt;/&lt;span&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;joda-time&lt;span&gt;&amp;lt;/&lt;span&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;/&lt;span&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨joda-timeæä¾›çš„ç»„ä»¶ä¹‹ä¸Šåšä¸€ä¸ªç®€å•çš„å·¥å…·ç±»å°è£…ï¼Œä¿è¯ä¸šåŠ¡å¤„ç†é£æ ¼ç»Ÿä¸€ã€‚&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;JodaTimeUtil&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â æ—¶é—´æ ¼å¼&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â StringÂ DATE_FORMATÂ =Â &lt;span&gt;&quot;yyyy-MM-ddÂ HH:mm:ss&quot;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;JodaTimeUtil&lt;/span&gt;Â &lt;span&gt;()&lt;/span&gt;&lt;/span&gt;{}&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â è·å–å½“å‰æ—¶é—´&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â DateTimeÂ &lt;span&gt;getCurrentTime&lt;/span&gt;Â &lt;span&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â DateTime()Â ;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â è·å–æŒ‡å®šæ—¶é—´&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â DateTimeÂ &lt;span&gt;getDateTime&lt;/span&gt;Â &lt;span&gt;(ObjectÂ obj)&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â DateTime(obj)Â ;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â æŠŠæ—¶é—´ä»¥æŒ‡å®šæ ¼å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â StringÂ &lt;span&gt;getNowDate&lt;/span&gt;Â &lt;span&gt;(DateÂ date,Â StringÂ format)&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â DateTime(date).toString(format)Â ;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â è·å–æ˜ŸæœŸæ—¶é—´&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â StringÂ &lt;span&gt;getWeek&lt;/span&gt;Â &lt;span&gt;(ObjectÂ date)&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â DateTimeÂ timeÂ =Â getDateTimeÂ (date)Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â StringÂ weekÂ =Â &lt;span&gt;null&lt;/span&gt;Â ;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;switch&lt;/span&gt;Â (time.getDayOfWeek())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â DateTimeConstants.SUNDAY:&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â weekÂ =Â &lt;span&gt;&quot;æ˜ŸæœŸæ—¥&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â DateTimeConstants.MONDAY:&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â weekÂ =Â &lt;span&gt;&quot;æ˜ŸæœŸä¸€&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â DateTimeConstants.TUESDAY:&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â weekÂ =Â &lt;span&gt;&quot;æ˜ŸæœŸäºŒ&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â DateTimeConstants.WEDNESDAY:&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â weekÂ =Â &lt;span&gt;&quot;æ˜ŸæœŸä¸‰&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â DateTimeConstants.THURSDAY:&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â weekÂ =Â &lt;span&gt;&quot;æ˜ŸæœŸå››&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â DateTimeConstants.FRIDAY:&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â weekÂ =Â &lt;span&gt;&quot;æ˜ŸæœŸäº”&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â DateTimeConstants.SATURDAY:&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â weekÂ =Â &lt;span&gt;&quot;æ˜ŸæœŸå…­&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;default&lt;/span&gt;:&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â weekÂ ;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h1&gt;&lt;span&gt;å››ã€æºä»£ç åœ°å€&lt;/span&gt;&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;GitHubÂ·åœ°å€&lt;br/&gt;https:&lt;span&gt;//github.com/cicadasmile/java-base-parent&lt;/span&gt;&lt;br/&gt;GitEEÂ·åœ°å€&lt;br/&gt;https:&lt;span&gt;//gitee.com/cicadasmile/java-base-parent&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.3783359497645212&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvCjMheLZtcM2iaVMBOpIUKR4CDRCG9FLT5K6NmGXvG7exrW0TSuDjnTKJQ5PDq8j8Y7PHDd17Z3gicA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1274&quot;/&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>32d99c2a832139d7597175f634cba838</guid>
<title>Linux æ–‡ä»¶ I/O è¿›åŒ–å²ï¼ˆä¸‰ï¼‰ï¼šDirect I/O å’Œ Linux AIO</title>
<link>https://toutiao.io/k/peychra</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Direct I/O&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‰é¢ä»‹ç»çš„ buffered I/O å’Œ mmapï¼Œè®¿é—®æ–‡ä»¶éƒ½æ˜¯éœ€è¦ç»è¿‡å†…æ ¸çš„ page cacheã€‚è¿™å¯¹äºæ•°æ®åº“è¿™ç§ self-caching çš„åº”ç”¨å¯èƒ½ä¸æ˜¯ç‰¹åˆ«å‹å¥½ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ç”¨æˆ·å±‚çš„ cache å’Œå†…æ ¸çš„ page cache å…¶å®æ˜¯é‡å¤çš„ï¼Œå¯¼è‡´å†…å­˜æµªè´¹ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ•°æ®çš„ä¼ è¾“ï¼šdisk -&amp;gt; page cache -&amp;gt; user buffer éœ€è¦ä¸¤æ¬¡å†…å­˜æ‹·è´ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ºæ­¤ï¼ŒLinux æä¾›äº†ä¸€ç§ç»•è¿‡ page cache è¯»å†™æ–‡ä»¶çš„æ–¹å¼ï¼šdirect I/Oã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¦ä½¿ç”¨ direct I/O éœ€è¦åœ¨ open æ–‡ä»¶çš„æ—¶å€™åŠ ä¸Š O_DIRECT çš„ flagã€‚æ¯”å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;int&lt;/span&gt;Â fdÂ =Â open(fname,Â O_RDWRÂ |Â O_DIRECT);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;ä½¿ç”¨ direct I/O æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼šbuffer çš„å†…å­˜åœ°å€ã€æ¯æ¬¡è¯»å†™æ•°æ®çš„å¤§å°ã€æ–‡ä»¶çš„ offset ä¸‰è€…éƒ½è¦ä¸åº•å±‚è®¾å¤‡çš„é€»è¾‘å—å¤§å°å¯¹é½ï¼ˆä¸€èˆ¬æ˜¯ 512 å­—èŠ‚ï¼‰ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;Since Linux 2.6.0, alignment to the logical block size of the underlying storage (typically 512 bytes) suffices. The logical block size can be determined using the ioctl(2) BLKSSZGET operation or from the shell using the command:
blockdev --getss&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;$Â blockdevÂ --getssÂ /dev/vdb1Â &lt;br/&gt;&lt;span&gt;512&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä¸æ»¡è¶³å¯¹é½è¦æ±‚ï¼Œç³»ç»Ÿä¼šæŠ¥ EINVALï¼ˆInvalid argumentã€‚ï¼‰ é”™è¯¯ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;assert.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;sys/stat.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;sys/types.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;int&lt;/span&gt;Â fdÂ =Â open(&lt;span&gt;&quot;/tmp/direct_io_test&quot;&lt;/span&gt;,Â O_CREATÂ |Â O_RDWRÂ |Â O_DIRECT);&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (fdÂ &amp;lt;Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â perror(&lt;span&gt;&quot;open&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;-1&lt;/span&gt;;&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â kBlockSizeÂ =Â &lt;span&gt;512&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;//Â bufferÂ åœ°å€ä¸å¯¹é½&lt;/span&gt;&lt;br/&gt;Â Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;char&lt;/span&gt;*Â pÂ =Â &lt;span&gt;nullptr&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â retÂ =Â posix_memalign(&lt;br/&gt;Â Â Â Â Â Â Â Â (&lt;span&gt;void&lt;/span&gt;**)&amp;amp;p,Â kBlockSizeÂ /Â &lt;span&gt;2&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â kBlockSize);Â Â &lt;span&gt;//Â è¿™é‡Œæœ‰ä¸€å®šæ¦‚ç‡å¯ä»¥åˆ†é…å‡ºä¸Â kBlockSizeÂ å¯¹é½çš„å†…å­˜&lt;/span&gt;&lt;br/&gt;Â Â Â Â assert(retÂ ==Â &lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â nÂ =Â write(fd,Â p,Â kBlockSize);&lt;br/&gt;Â Â Â Â assert(nÂ &amp;lt;Â &lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â perror(&lt;span&gt;&quot;write&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;free&lt;/span&gt;(p);&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;//Â bufferÂ å¤§å°ä¸å¯¹é½&lt;/span&gt;&lt;br/&gt;Â Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;char&lt;/span&gt;*Â pÂ =Â &lt;span&gt;nullptr&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â retÂ =Â posix_memalign((&lt;span&gt;void&lt;/span&gt;**)&amp;amp;p,Â kBlockSize,Â kBlockSizeÂ /Â &lt;span&gt;2&lt;/span&gt;);&lt;br/&gt;Â Â Â Â assert(retÂ ==Â &lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â nÂ =Â write(fd,Â p,Â kBlockSizeÂ /Â &lt;span&gt;2&lt;/span&gt;);&lt;br/&gt;Â Â Â Â assert(nÂ &amp;lt;Â &lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â perror(&lt;span&gt;&quot;write&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;free&lt;/span&gt;(p);&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;//Â æ–‡ä»¶Â offsetÂ ä¸å¯¹é½&lt;/span&gt;&lt;br/&gt;Â Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;char&lt;/span&gt;*Â pÂ =Â &lt;span&gt;nullptr&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â retÂ =Â posix_memalign((&lt;span&gt;void&lt;/span&gt;**)&amp;amp;p,Â kBlockSize,Â kBlockSize);&lt;br/&gt;Â Â Â Â assert(retÂ ==Â &lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;off_t&lt;/span&gt;Â offsetÂ =Â lseek(fd,Â kBlockSizeÂ /Â &lt;span&gt;2&lt;/span&gt;,Â SEEK_SET);&lt;br/&gt;Â Â Â Â assert(offsetÂ ==Â kBlockSizeÂ /Â &lt;span&gt;2&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â nÂ =Â write(fd,Â p,Â kBlockSize);&lt;br/&gt;Â Â Â Â assert(nÂ &amp;lt;Â &lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â perror(&lt;span&gt;&quot;write&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;free&lt;/span&gt;(p);&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;//Â ä¸‰è€…å¯¹é½&lt;/span&gt;&lt;br/&gt;Â Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;char&lt;/span&gt;*Â pÂ =Â &lt;span&gt;nullptr&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â retÂ =Â posix_memalign((&lt;span&gt;void&lt;/span&gt;**)&amp;amp;p,Â kBlockSize,Â kBlockSize);&lt;br/&gt;Â Â Â Â assert(retÂ ==Â &lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;off_t&lt;/span&gt;Â offsetÂ =Â lseek(fd,Â &lt;span&gt;0&lt;/span&gt;,Â SEEK_SET);&lt;br/&gt;Â Â Â Â assert(offsetÂ ==Â &lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â nÂ =Â write(fd,Â p,Â kBlockSize);&lt;br/&gt;Â Â Â Â assert(nÂ ==Â kBlockSize);&lt;br/&gt;Â Â Â Â &lt;span&gt;printf&lt;/span&gt;(&lt;span&gt;&quot;writeÂ ok\n&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;free&lt;/span&gt;(p);&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Direct I/O ä¸æ•°æ®æŒä¹…åŒ–&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½¿ç”¨ buffered I/O å†™å…¥æ•°æ®ï¼Œwrite è¿”å›ä¹‹åï¼Œæ•°æ®å®é™…ä¸Šåªåˆ°è¾¾ page cache â€”â€” è¿˜åœ¨å†…å­˜ä¸­ï¼Œéœ€è¦ç­‰å†…æ ¸çº¿ç¨‹å‘¨æœŸæ€§å°†è„é¡µåˆ·æ–°åˆ°æŒä¹…åŒ–å­˜å‚¨ä¸Šï¼Œæˆ–åº”ç”¨ç¨‹åºè°ƒç”¨ fsync ä¸»åŠ¨å°†æ•°æ®åˆ·æ–°è„é¡µã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç†è®ºä¸Šï¼Œä½¿ç”¨ direct I/O ä¸ä¼šç»è¿‡ page cacheï¼Œå½“ write è¿”å›ä¹‹åï¼Œæ•°æ®åº”è¯¥è¾¾åˆ°æŒä¹…åŒ–å­˜å‚¨ã€‚ä½†æ˜¯ï¼Œé™¤äº†æ–‡ä»¶æ•°æ®æœ¬èº«ï¼Œæ–‡ä»¶çš„ä¸€äº›é‡è¦çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶çš„å¤§å°ï¼Œä¹Ÿä¼šå½±å“æ•°æ®çš„å®Œæ•´æ€§ã€‚è€Œ direct I/O åªæ˜¯å¯¹æ–‡ä»¶æ•°æ®æœ¬èº«æœ‰æ•ˆï¼Œæ–‡ä»¶çš„å…ƒæ•°æ®è¯»å†™è¿˜æ˜¯ä¼šç»è¿‡å†…æ ¸ç¼“å­˜ â€”â€” ä½¿ç”¨ direct I/O è¯»å†™æ–‡ä»¶ï¼Œä¾ç„¶éœ€è¦ä½¿ç”¨ fsync æ¥åˆ·æ–°æ–‡ä»¶çš„å…ƒæ•°æ®ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ–‡ä»¶å…ƒæ•°æ®éƒ½ä¼šå½±å“åˆ°æ•°æ®çš„å®Œæ•´æ€§ï¼Œæ¯”å¦‚æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ã€‚ä¸ºæ­¤ï¼ŒMySQL æä¾›äº†ä¸€ä¸ªæ–°çš„åˆ·ç›˜å‚æ•°ï¼šO_DIRECT_NO_FSYNC â€”â€” ä½¿ç”¨ O_DIRECT Â è¯»å†™æ•°æ®ï¼Œåªæœ‰åœ¨å¿…è¦çš„ä½¿ç”¨è¿›è¡Œ fsyncã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;As of MySQL 8.0.14, fsync() is called after creating a new file, after increasing file size, and after closing a file, to ensure that file system metadata changes are synchronized. The fsync() system call is still skipped after each write operation.&lt;/p&gt;&lt;/blockquote&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Linux AIO&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‰é¢ä»‹ç»çš„ï¼Œæ— è®ºæ˜¯è°ƒç”¨ read/write è¯»å†™æ–‡ä»¶ï¼ˆåŒ…æ‹¬ buffered I/O å’Œ direct I/Oï¼‰ï¼Œè¿˜æ˜¯ä½¿ç”¨ mmap æ˜ å°„æ–‡ä»¶ï¼Œéƒ½æ˜¯å±äºåŒæ­¥æ–‡ä»¶ I/Oã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åŒæ­¥ I/O æ¥å£çš„ä¼˜ç‚¹æ˜¯ï¼šç®€å•æ˜“ç”¨ã€é€»è¾‘æ¸…æ™°ã€‚ä½†æ˜¯é™¤äº†è¿™ä¸ªï¼ŒåŒæ­¥ I/O ä¼¼ä¹æ²¡åˆ«çš„ä¼˜ç‚¹äº†ã€‚åŒæ­¥çš„ I/O æ¥å£ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ page cacheï¼Œä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ =&amp;gt; è¿™ç§æƒ…å†µä¸‹ï¼Œå¾€å¾€ä¼šä½¿ç”¨å¤šçº¿ç¨‹æ¥è§£å†³ =&amp;gt; éšç€ SSD ç­‰æŒä¹…åŒ–è®¾å¤‡çš„æ€§èƒ½æå‡ï¼Œç»§ç»­å¢åŠ çº¿ç¨‹æ•° =&amp;gt; å¤§é‡çº¿ç¨‹çš„åŸºç¡€å¼€é”€ + å¤§é‡ä¸Šä¸‹æ–‡åˆ‡æ¢ + å†…æ ¸è°ƒåº¦å™¨çš„è´Ÿè½½ =&amp;gt; ç³»ç»Ÿæ€§èƒ½å¾ˆå·® =&amp;gt; éœ€è¦å¼‚æ­¥æ–‡ä»¶ I/O æ¥æå‡é«˜å¹¶å‘è¯»å†™æ—¶çš„æ€§èƒ½ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Linux AIO æ˜¯å†…æ ¸æä¾›çš„ä¸€å¥—æ”¯æŒæ–‡ä»¶å¼‚æ­¥ I/O çš„æ¥å£ï¼ˆåªæ”¯æŒä½¿ç”¨ O_DIRECT çš„æ–¹å¼æ¥è¯»å†™æ–‡ä»¶ï¼‰ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;io_setup&lt;/span&gt;&lt;span&gt;(&lt;span&gt;unsigned&lt;/span&gt;Â nr_events,Â &lt;span&gt;aio_context_t&lt;/span&gt;Â *ctx_idp)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;io_submit&lt;/span&gt;&lt;span&gt;(&lt;span&gt;aio_context_t&lt;/span&gt;Â ctx_id,Â &lt;span&gt;long&lt;/span&gt;Â nr,Â structÂ iocbÂ **iocbpp)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;io_getevents&lt;/span&gt;&lt;span&gt;(&lt;span&gt;aio_context_t&lt;/span&gt;Â ctx_id,Â &lt;span&gt;long&lt;/span&gt;Â min_nr,Â &lt;span&gt;long&lt;/span&gt;Â nr,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â structÂ io_eventÂ *events,Â structÂ timespecÂ *timeout)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;io_cancel&lt;/span&gt;&lt;span&gt;(&lt;span&gt;aio_context_t&lt;/span&gt;Â ctx_id,Â structÂ iocbÂ *iocb,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â structÂ io_eventÂ *result)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;io_destroy&lt;/span&gt;&lt;span&gt;(&lt;span&gt;aio_context_t&lt;/span&gt;Â ctx_id)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;io_setup&lt;/code&gt;Â åˆ›å»ºä¸€ä¸ªèƒ½æ”¯æŒ &lt;code&gt;nr_events&lt;/code&gt;Â ä¸ªæ“ä½œçš„å¼‚æ­¥ I/O contextã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;io_submit&lt;/code&gt;Â æäº¤å¼‚æ­¥ I/O è¯·æ±‚ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;io_getevents&lt;/code&gt;Â è·å–å·²å®Œæˆçš„å¼‚æ­¥ I/O ç»“æœã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;io_cancel&lt;/code&gt;Â å–æ¶ˆä¹‹å‰æäº¤çš„æŸä¸ªå¼‚æ­¥ I/O è¯·æ±‚ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;io_destroy&lt;/code&gt;Â å–æ¶ˆæ‰€æœ‰æäº¤çš„å¼‚æ­¥ I/O è¯·æ±‚ï¼Œå¹¶é”€æ¯å¼‚æ­¥ I/O contextã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ­£å¸¸æƒ…å†µä¸‹ï¼ŒLinux AIO çš„æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;è°ƒç”¨ &lt;code&gt;io_setup&lt;/code&gt;Â åˆ›å»ºä¸€ä¸ª I/O context ç”¨äºæäº¤å’Œæ”¶å‰² I/O è¯·æ±‚ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;åˆ›å»º 1~n å’Œ I/O è¯·æ±‚ï¼Œè°ƒç”¨ &lt;code&gt;io_submit&lt;/code&gt;Â æäº¤è¯·æ±‚ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;I/O è¯·æ±‚æ‰§è¡Œå®Œæˆï¼Œé€šè¿‡ DMA ç›´æ¥å°†æ•°æ®ä¼ è¾“åˆ° user bufferã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è°ƒç”¨ &lt;code&gt;io_getevents&lt;/code&gt;Â æ”¶å‰²å·²å®Œæˆçš„ I/Oã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;é‡æ–°æ‰§è¡Œç¬¬ 2 æ­¥ï¼Œæˆ–è€…ç¡®è®¤ä¸éœ€è¦ç»§ç»­æ‰§è¡Œ AIOï¼Œè°ƒç”¨ &lt;code&gt;io_destroy&lt;/code&gt;Â é”€æ¯ I/O contextã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.50375&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/9637P74IBOEOmWPg8AtGYYOAtIAuDEXDvdGvce8IacUq2sMHkb3bXCxYUFNluOztcYIJWvZtMmOaRCz3PqN1iaA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1600&quot;/&gt;&lt;/figure&gt;&lt;center data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ï¼ˆå›¾ç‰‡æ¥è‡ª https://www.scylladb.com/2017/10/05/io-access-methods-scylla/ï¼‰&lt;/center&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™é‡Œç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­ä»‹ç»ä¸€ä¸‹ Linux AIO æ¥å£çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚å„ä¸ª Linux AIO æ¥å£çš„è¯¦ç»†ä»‹ç»ï¼Œå»ºè®®å‚è€ƒç›¸å…³çš„ Linux Manual Pageã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;glibc å¹¶æ²¡æœ‰æä¾› Linux AIO ç³»ç»Ÿè°ƒç”¨æ¥å£çš„å°è£…ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦ä½¿ç”¨ syscall ç®€å•å°è£…ä¸€ä¸‹ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;libaio æ˜¯å¯¹ Linux AIO çš„å°è£…ï¼Œæ¥å£å¾ˆåƒä½†æ˜¯ä¸å®Œå…¨ä¸€æ ·ï¼Œä¸è¦æ··æ·†ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;assert.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;inttypes.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;linux/aio_abi.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;sys/syscall.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;include&lt;/span&gt;Â &lt;span&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;io_setup&lt;/span&gt;&lt;span&gt;(&lt;span&gt;unsigned&lt;/span&gt;Â nr,Â &lt;span&gt;aio_context_t&lt;/span&gt;Â *ctxp)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â syscall(__NR_io_setup,Â nr,Â ctxp);&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;io_destroy&lt;/span&gt;&lt;span&gt;(&lt;span&gt;aio_context_t&lt;/span&gt;Â ctx)&lt;/span&gt;Â &lt;/span&gt;{Â &lt;span&gt;return&lt;/span&gt;Â syscall(__NR_io_destroy,Â ctx);Â }&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;io_submit&lt;/span&gt;&lt;span&gt;(&lt;span&gt;aio_context_t&lt;/span&gt;Â ctx,Â &lt;span&gt;long&lt;/span&gt;Â nr,Â structÂ iocbÂ **iocbpp)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â syscall(__NR_io_submit,Â ctx,Â nr,Â iocbpp);&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;io_getevents&lt;/span&gt;&lt;span&gt;(&lt;span&gt;aio_context_t&lt;/span&gt;Â ctx,Â &lt;span&gt;long&lt;/span&gt;Â min_nr,Â &lt;span&gt;long&lt;/span&gt;Â max_nr,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â structÂ io_eventÂ *events,Â structÂ timespecÂ *timeout)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â syscall(__NR_io_getevents,Â ctx,Â min_nr,Â max_nr,Â events,Â timeout);&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;int&lt;/span&gt;Â &lt;span&gt;main&lt;/span&gt;&lt;span&gt;(&lt;span&gt;int&lt;/span&gt;Â argc,Â &lt;span&gt;char&lt;/span&gt;Â *argv[])&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;int&lt;/span&gt;Â fdÂ =Â open(&lt;span&gt;&quot;/tmp/linux_aio_test&quot;&lt;/span&gt;,Â O_RDWRÂ |Â O_CREATÂ |Â O_DIRECT,Â &lt;span&gt;0666&lt;/span&gt;);&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (fdÂ &amp;lt;Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â perror(&lt;span&gt;&quot;open&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;-1&lt;/span&gt;;&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;aio_context_t&lt;/span&gt;Â ctxÂ =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;Â Â &lt;span&gt;int&lt;/span&gt;Â retÂ =Â io_setup(&lt;span&gt;128&lt;/span&gt;,Â &amp;amp;ctx);&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (retÂ &amp;lt;Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â perror(&lt;span&gt;&quot;io_setup&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;-1&lt;/span&gt;;&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;struct&lt;/span&gt;Â &lt;span&gt;iocb&lt;/span&gt;Â &lt;span&gt;cb&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;memset&lt;/span&gt;(&amp;amp;cb,Â &lt;span&gt;0&lt;/span&gt;,Â &lt;span&gt;sizeof&lt;/span&gt;(cb));&lt;br/&gt;Â Â cb.aio_fildesÂ =Â fd;&lt;br/&gt;Â Â cb.aio_lio_opcodeÂ =Â IOCB_CMD_PWRITE;&lt;br/&gt;Â Â &lt;span&gt;char&lt;/span&gt;Â *dataÂ =Â &lt;span&gt;nullptr&lt;/span&gt;;&lt;br/&gt;Â Â retÂ =Â posix_memalign((&lt;span&gt;void&lt;/span&gt;Â **)&amp;amp;data,Â &lt;span&gt;512&lt;/span&gt;,Â &lt;span&gt;4096&lt;/span&gt;);&lt;br/&gt;Â Â assert(retÂ ==Â &lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â &lt;span&gt;memset&lt;/span&gt;(data,Â &lt;span&gt;&#x27;A&#x27;&lt;/span&gt;,Â &lt;span&gt;4096&lt;/span&gt;);&lt;br/&gt;Â Â cb.aio_bufÂ =Â (&lt;span&gt;uint64_t&lt;/span&gt;)data;&lt;br/&gt;Â Â cb.aio_offsetÂ =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;Â Â cb.aio_nbytesÂ =Â &lt;span&gt;4096&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;struct&lt;/span&gt;Â &lt;span&gt;iocb&lt;/span&gt;Â *&lt;span&gt;cbs&lt;/span&gt;[1];&lt;/span&gt;&lt;br/&gt;Â Â cbs[&lt;span&gt;0&lt;/span&gt;]Â =Â &amp;amp;cb;&lt;br/&gt;Â Â retÂ =Â io_submit(ctx,Â &lt;span&gt;1&lt;/span&gt;,Â cbs);&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (retÂ !=Â &lt;span&gt;1&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;free&lt;/span&gt;(data);&lt;br/&gt;Â Â Â Â perror(&lt;span&gt;&quot;io_submit&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;-1&lt;/span&gt;;&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;struct&lt;/span&gt;Â &lt;span&gt;io_event&lt;/span&gt;Â &lt;span&gt;events&lt;/span&gt;[1];&lt;/span&gt;&lt;br/&gt;Â Â retÂ =Â io_getevents(ctx,Â &lt;span&gt;1&lt;/span&gt;,Â &lt;span&gt;1&lt;/span&gt;,Â events,Â &lt;span&gt;nullptr&lt;/span&gt;);&lt;br/&gt;Â Â assert(retÂ ==Â &lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;Â Â &lt;span&gt;printf&lt;/span&gt;(&lt;span&gt;&quot;%ldÂ %ld\n&quot;&lt;/span&gt;,Â events[&lt;span&gt;0&lt;/span&gt;].res,Â events[&lt;span&gt;0&lt;/span&gt;].res2);&lt;br/&gt;Â Â &lt;span&gt;free&lt;/span&gt;(data);&lt;br/&gt;Â Â retÂ =Â io_destroy(ctx);&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (retÂ &amp;lt;Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â perror(&lt;span&gt;&quot;io_destroy&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;-1&lt;/span&gt;;&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å°ç»“&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Linux AIO æ˜¯ Linux ä¸‹ä¸€ä¸ªå°è¯•è§£å†³æ–‡ä»¶å¼‚æ­¥ I/O çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆå¹¶ä¸å½»åº•ã€ä¸å®Œç¾ã€‚&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;Linux AIO åªæ”¯æŒ direct I/Oã€‚&lt;/strong&gt; è¿™æ„å‘³ç€ä½¿ç”¨ Linux AIO çš„æ‰€æœ‰è¯»å†™æ“ä½œéƒ½è¦å—åˆ° direct I/O çš„é™åˆ¶ï¼š1ï¼‰buffer åœ°å€ã€buffer å¤§å°ã€æ–‡ä»¶ offset çš„å¯¹é½é™åˆ¶ï¼›2ï¼‰æ— æ³•ä½¿ç”¨ page cacheã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;ä¸å®Œå¤‡çš„å¼‚æ­¥ï¼Œä»ç„¶æœ‰å¯èƒ½è¢«é˜»å¡ã€‚&lt;/strong&gt; æ¯”å¦‚åœ¨ ext4 æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¦‚æœéœ€è¦è¯»å–æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œæ­¤æ—¶è°ƒç”¨å¯èƒ½ä¼šè¢«é˜»å¡ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;è¾ƒå¤§çš„å‚æ•°æ‹·è´å¼€é”€ã€‚&lt;/strong&gt; æ¯ä¸ª I/O æäº¤éœ€è¦æ‹·è´ä¸€ä¸ª 64 å­—èŠ‚çš„ &lt;code&gt;struct iocb&lt;/code&gt;Â å¯¹è±¡ï¼›æ¯ä¸ª I/O å®Œæˆéœ€è¦æ‹·è´ä¸€ä¸ª 32 å­—èŠ‚çš„ &lt;code&gt;struct io_event&lt;/code&gt;Â å¯¹è±¡ï¼›ä¸€ä¸ª I/O è¯·æ±‚æ€»å…±éœ€è¦ 96 å­—èŠ‚çš„æ‹·è´ã€‚è¿™ä¸ªæ‹·è´å¼€é”€æ˜¯å¦å¯ä»¥æ‰¿å—ï¼Œå’Œå•æ¬¡ I/O çš„å¤§å°æœ‰å…³ï¼šå¦‚æœå•æ¬¡ I/O æœ¬èº«å°±å¾ˆå¤§ï¼Œç›¸è¾ƒä¹‹ä¸‹ï¼Œè¿™ç‚¹æ¶ˆè€—å¯ä»¥å¿½ç•¥ï¼›è€Œåœ¨å¤§é‡å° I/O çš„åœºæ™¯ä¸‹ï¼Œè¿™æ ·çš„æ‹·è´å½±å“æ¯”è¾ƒå¤§ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¤šçº¿ç¨‹æäº¤æˆ–æ”¶å‰² I/O è¯·æ±‚ä¼šå¯¹ io_context_tÂ é€ æˆæ¯”è¾ƒå¤§çš„&lt;strong&gt;é”ç«äº‰&lt;/strong&gt;ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ¯ä¸ª I/O éœ€è¦ä¸¤æ¬¡ç³»ç»Ÿè°ƒç”¨æ‰èƒ½å®Œæˆï¼ˆ &lt;code&gt;io_submit&lt;/code&gt;Â  å’Œ &lt;code&gt;io_getevents&lt;/code&gt;Â )ï¼Œå¤§é‡å° I/O éš¾ä»¥æ¥å— â€”â€” ä¸è¿‡ &lt;code&gt;io_submit&lt;/code&gt;Â å’Œ &lt;code&gt;io_getevents&lt;/code&gt;Â éƒ½æ”¯æŒæ‰¹é‡æ“ä½œï¼Œå¯ä»¥é€šè¿‡æ‰¹é‡æäº¤å’Œæ‰¹é‡æ”¶å‰²æ¥å‡å°‘ç³»ç»Ÿè°ƒç”¨ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Linux AIO ä»è¯ç”Ÿä¹‹æ—¥ï¼ˆå†…æ ¸ 2.5 ç‰ˆæœ¬ï¼‰èµ·åˆ°ç°åœ¨ï¼ˆ2021 å¹´ï¼‰ï¼Œä¸€ç›´åœ¨ä¸æ–­å®Œå–„ã€‚ä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä¸€äº›ä¿®ä¿®è¡¥è¡¥çš„å·¥ä½œï¼ŒLinux AIO ä¸€ç›´éƒ½æ²¡æœ‰è¢«å®ç°å®Œæ•´ â€”â€” ç‰¹åˆ«æ˜¯åªæ”¯æŒ direct I/Oï¼Œå¼‚æ­¥æ¥å£ä»ç„¶å¯èƒ½è¢«é˜»å¡ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ºäº†å½»åº•è§£å†³ Linux AIO åœ¨è®¾è®¡ä¸Šçš„ä¸å®Œå–„ï¼ŒLinux 5.1 å¼€å§‹å¼•å…¥äº†å…¨æ–°çš„å¼‚æ­¥ I/O æ¥å£ï¼šio_uring â€”â€” å¸Œæœ› io_uring èƒ½å½»åº•è§£å†³ Linux ä¸‹çš„å¼‚æ­¥ I/O é—®é¢˜ã€‚&lt;/p&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å‚è€ƒèµ„æ–™&lt;/h1&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Linux Programmer&#x27;s Manual - open (2)&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Page-based direct I/O&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;InnoDB innodb_flush_method é…ç½®&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Why does O_DIRECT require I/O to be 512-byte aligned?&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;linux-aio&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>86cb8e39b795dd070946324de4a7c83c</guid>
<title>èŠä¸€èŠè®¾è®¡æ¨¡å¼ç©¶ç«Ÿæ˜¯ä»€ä¹ˆ</title>
<link>https://toutiao.io/k/yqyaefq</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p&gt;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æµæ²™ã€‚è®¾è®¡æ¨¡å¼æ˜¯æ¯ä¸ªç¨‹åºå‘˜éƒ½ä¼šç»å¸¸æ¥è§¦åˆ°çš„ä¸œè¥¿ï¼Œä½†æ˜¯ç›¸ä¿¡å¾ˆå¤šäººå¯¹äºè®¾è®¡æ¨¡å¼ç©¶ç«Ÿæ˜¯ä»€ä¹ˆè¿˜ä¼šæœ‰äº›ç–‘é—®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä»Šå¤©å°±èŠèŠè¿™ä¸ªï¼Œä¸»è¦ç›®æ ‡æ˜¯å¸®å¤§å®¶ç†è§£è®¾è®¡æ¨¡å¼çš„ä½œç”¨ï¼Œä»¥åŠè¦ç”¨ä»€ä¹ˆæ ·çš„å¿ƒæ€å¯¹å¾…è®¾è®¡æ¨¡å¼ã€‚&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;h1&gt;å‰ç½®çŸ¥è¯†&lt;/h1&gt;&lt;p&gt;æåˆ°è®¾è®¡æ¨¡å¼ï¼Œå…¶å®é¦–å…ˆéœ€è¦ç†è§£æ¸…æ¥šçš„æ˜¯é¢å‘å¯¹è±¡æ€æƒ³ã€‚ç›¸ä¿¡å¤§å®¶å³ä½¿ä¸èƒ½éå¸¸æ¸…æ™°çš„æè¿°å‡ºæ¥ï¼Œå¯¹é¢å‘å¯¹è±¡ä¹Ÿåº”è¯¥æ˜¯æ¯”è¾ƒç†Ÿæ‚‰çš„ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬å°±å¿«é€Ÿè®²ä¸€ä¸‹ï¼Œé¢å‘å¯¹è±¡æœ‰å››å¤§åŸºæœ¬ç‰¹æ€§ï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€ï¼›&lt;/p&gt;&lt;p&gt;å°è£…ï¼šä»…æš´éœ²æœ‰é™çš„æ¥å£ï¼Œæˆæƒå¤–éƒ¨æ¥è®¿é—®ã€‚å°†é€»è¾‘é›†ä¸­ï¼Œå› æ­¤æ›´å¯æ§ï¼›å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ä¹Ÿæ›´å¥½ï¼›æ˜“ç”¨æ€§ä¹Ÿæ›´å¥½ã€‚&lt;/p&gt;&lt;p&gt;æŠ½è±¡ï¼šéšè—æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œè®©è°ƒç”¨è€…åªéœ€è¦å…³å¿ƒæ–¹æ³•æä¾›äº†å“ªäº›åŠŸèƒ½ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“è¿™äº›åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;/p&gt;&lt;p&gt;ç»§æ‰¿ï¼šå¥½å¤„å°±æ˜¯ä»£ç å¤ç”¨ã€‚&lt;/p&gt;&lt;p&gt;å¤šæ€ï¼šå­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»ã€‚æé«˜ä»£ç çš„å¯æ‰©å±•å’Œå¯å¤ç”¨æ€§ã€‚&lt;/p&gt;&lt;h1&gt;ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼&lt;/h1&gt;&lt;p&gt;è®¾è®¡æ¨¡å¼æ˜¯é’ˆå¯¹è½¯ä»¶å¼€å‘ä¸­ç»å¸¸é‡åˆ°çš„ä¸€äº›è®¾è®¡é—®é¢˜ï¼Œæ ¹æ®åŸºæœ¬çš„è®¾è®¡åŸåˆ™ï¼Œæ€»ç»“å‡ºæ¥çš„ä¸€å¥—å®ç”¨çš„è§£å†³æ–¹æ¡ˆæˆ–è€…è®¾è®¡æ€è·¯ã€‚&lt;/p&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œè®¾è®¡æ¨¡å¼æ˜¯éå¸¸åå®é™…åº”ç”¨çš„ï¼Œç›¸æ¯”è®¾è®¡åŸåˆ™æ›´åŠ å…·ä½“ã€å¯æ‰§è¡Œã€‚&lt;/p&gt;&lt;p&gt;å› æ­¤ï¼Œåœ¨äº†è§£è®¾è®¡æ¨¡å¼ä¹‹å‰ï¼Œå°±éœ€è¦äº†è§£ä¸€äº›åŸºæœ¬çš„è®¾è®¡åŸåˆ™ã€‚è¿™äº›åŸåˆ™æ‰æ˜¯æŒ‡å¯¼æˆ‘ä»¬å†™å‡ºå¥½ä»£ç çš„å…³é”®ã€‚&lt;/p&gt;&lt;p&gt;é‚£ä¹ˆä»€ä¹ˆæ˜¯å¥½ä»£ç å‘¢ï¼Ÿ&lt;/p&gt;&lt;h2&gt;å¥½ä»£ç çš„æ ‡å‡†&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªå…¶å®å¾ˆéš¾æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç€å½’çº³ä¸€äº›å¥½ä»£ç çš„ç‰¹å¾ï¼Œæ¯”å¦‚ä¸‹é¢è¿™äº›ï¼š&lt;/p&gt;&lt;p&gt;å¯ç»´æŠ¤ã€å¯æ‰©å±•ã€å¯è¯»ã€å¯æµ‹ã€å¯å¤ç”¨ã€ç®€æ´ã€‚&lt;/p&gt;&lt;p&gt;ä¸ºäº†è¾¾åˆ°è¿™äº›æ ‡å‡†ï¼Œå°±éœ€è¦ç°æœ‰ä¸€äº›åŸºæœ¬çš„è®¾è®¡åŸåˆ™ã€‚&lt;/p&gt;&lt;h1&gt;åŸºæœ¬è®¾è®¡åŸåˆ™&lt;/h1&gt;&lt;h2&gt;SOLID&lt;/h2&gt;&lt;h3&gt;å•ä¸€èŒè´£ Single Responsibility Principle&lt;/h3&gt;&lt;p&gt;æè¿°å¾ˆç®€å•ï¼Œä¸€ä¸ªç±»åªè´Ÿè´£å®Œæˆä¸€ä¸ªèŒè´£æˆ–è€…åŠŸèƒ½ã€‚ä½†æ˜¯å®é™…è¦åšå¥½å…¶å®è¿˜æ˜¯å¾ˆéš¾çš„ã€‚&lt;/p&gt;&lt;p&gt;å…³äºæ€ä¹ˆæ ·æ‰ç®—èŒè´£å•ä¸€ï¼Œå¯ä»¥å®šå‡ºä¸€äº›ç®€å•çš„æ ‡å‡†ï¼Œæ¯”å¦‚ä»£ç è¡Œæ•°è¿‡å¤šï¼›ä¾èµ–çš„å…¶ä»–ç±»è¿‡å¤šï¼›ç§æœ‰æ–¹æ³•è¿‡å¤šï¼›éš¾ä»¥ç»™ç±»èµ·åï¼›ç±»ä¸­å¤§é‡æ–¹æ³•åŠŸèƒ½é›†ä¸­ç­‰ã€‚ä½†æ˜¯æ— æ³•å®šä¹‰å‡ºä¸€ä¸ªæ™®é€‚çš„æ ‡å‡†ï¼Œä¸€å®šè¦ç»“åˆå®é™…æƒ…å†µå»è€ƒè™‘ã€‚&lt;/p&gt;&lt;p&gt;æ¯”å¦‚è¿™æ ·ä¸€ä¸ªç±»&lt;/p&gt;&lt;figure&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span&gt;11&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;Student {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    int id;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;String&lt;/span&gt; name;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;String&lt;/span&gt; age;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;...&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;String&lt;/span&gt; province;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;String&lt;/span&gt; city;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;String&lt;/span&gt; county;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;String&lt;/span&gt; detailAddress;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;...&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;åœ¨å…¶ä¸­è‡³å°‘æœ‰å››ä¸ªå­—æ®µæ˜¯å’Œåœ°å€æœ‰å…³çš„ï¼Œé‚£ä¹ˆæ˜¯å¦éœ€è¦æŠŠåœ°å€ç›¸å…³çš„èŒè´£æŠ½ç¦»å‡ºæ¥ï¼Œå°è£…ä¸€ä¸ªæ–°çš„Addressç±»?&lt;/p&gt;&lt;p&gt;å…¶å®ï¼Œæ˜¯è¦è§†æƒ…å†µè€Œå®šçš„ï¼Œå¦‚æœåœ°å€è¿™äº›å±æ€§åªæ˜¯å•çº¯çš„å±•ç¤ºä¿¡æ¯ï¼Œé‚£ä¹ˆç›´æ¥æ”¾åœ¨Studentç±»é‡Œï¼Œå°±æ²¡æœ‰é—®é¢˜ï¼›å¦‚æœåœ¨è¿™èƒŒåè¿˜æœ‰ä¸€å¥—å¤æ‚çš„ç‰©æµç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æœ‰å¾ˆå¤šåœ°å€ç›¸å…³çš„å¤æ‚é€»è¾‘ï¼Œé‚£ä¹ˆè¿™ä¸€éƒ¨åˆ†å°±åº”å½“å•ç‹¬æŠ½ç¦»å‡ºæ¥ã€‚&lt;/p&gt;&lt;p&gt;åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå†™ä¸€ä¸ªç²—ç²’åº¦çš„ç±»ï¼Œæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œå¦‚æœç²—ç²’åº¦çš„ç±»è¶Šæ¥è¶Šåºå¤§ï¼Œä»£ç è¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™ä¸ªç²—ç²’åº¦çš„ç±»ï¼Œæ‹†åˆ†æˆå‡ ä¸ªæ›´ç»†ç²’åº¦çš„ç±»ã€‚è¿™å°±æ˜¯æ‰€è°“çš„æŒç»­é‡æ„ã€‚&lt;/p&gt;&lt;h3&gt;å¼€é—­åŸåˆ™ Open Closed Principle&lt;/h3&gt;&lt;p&gt;å¯¹æ‰©å±•å¼€æ”¾ã€å¯¹ä¿®æ”¹å…³é—­ã€‚&lt;/p&gt;&lt;p&gt;æ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œåº”è¯¥æ˜¯é€šè¿‡åœ¨å·²æœ‰ä»£ç åŸºç¡€ä¸Šæ‰©å±•ä»£ç ï¼ˆæ–°å¢æ¨¡å—ã€ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ï¼‰ï¼Œè€Œéä¿®æ”¹å·²æœ‰ä»£ç ï¼ˆä¿®æ”¹æ¨¡å—ã€ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ï¼‰çš„æ–¹å¼æ¥å®Œæˆã€‚&lt;/p&gt;&lt;p&gt;å¼€é—­åŸåˆ™æ˜¯ç›¸å¯¹éš¾ç†è§£çš„ä¸€æ¡åŸåˆ™ã€‚&lt;/p&gt;&lt;p&gt;â€œæ€æ ·çš„ä»£ç æ”¹åŠ¨æ‰è¢«å®šä¹‰ä¸ºâ€˜æ‰©å±•â€™ï¼Ÿæ€æ ·çš„ä»£ç æ”¹åŠ¨æ‰è¢«å®šä¹‰ä¸ºâ€˜ä¿®æ”¹â€™ï¼Ÿæ€ä¹ˆæ‰ç®—æ»¡è¶³æˆ–è¿åâ€˜å¼€é—­åŸåˆ™â€™ï¼Ÿä¿®æ”¹ä»£ç å°±ä¸€å®šæ„å‘³ç€è¿åâ€˜å¼€é—­åŸåˆ™â€™å—ï¼Ÿâ€ç­‰é—®é¢˜ï¼Œéƒ½å¾ˆéš¾å›ç­”ã€‚&lt;/p&gt;&lt;p&gt;è€Œè¿™æ¡åŸåˆ™åˆæ˜¯æœ€æœ‰ç”¨ï¼Œå› ä¸ºæ‰©å±•æ€§æ˜¯ä»£ç è´¨é‡æœ€é‡è¦çš„è¡¡é‡æ ‡å‡†ä¹‹ä¸€ã€‚&lt;/p&gt;&lt;p&gt;å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿæ²¡å¿…è¦çº ç»“æŸä¸ªä»£ç æ”¹åŠ¨æ˜¯â€œä¿®æ”¹â€è¿˜æ˜¯â€œæ‰©å±•â€ï¼Œæ›´æ²¡å¿…è¦å¤ªçº ç»“å®ƒæ˜¯å¦è¿åâ€œå¼€é—­åŸåˆ™â€ã€‚æˆ‘ä»¬åº”å½“å›åˆ°å®ƒçš„åˆè¡·ä¸Šï¼Œåªè¦æ²¡æœ‰ç ´ååŸæœ‰ä»£ç çš„è¿è¡Œï¼Œå°±æ²¡æœ‰è¿åå¼€é—­åŸåˆ™ã€‚ä¸€ä¸ªç®€å•çš„åˆ¤æ–­æ ‡å‡†ï¼Œå½“åŠŸèƒ½æ²¡æœ‰å˜åŒ–æ—¶ï¼Œå¯¹åº”çš„å•å…ƒæµ‹è¯•æ²¡è¢«ç ´åï¼Œå°±æ˜¯ä¸€æ¬¡æ»¡è¶³å¼€é—­åŸåˆ™çš„æ”¹åŠ¨ã€‚&lt;/p&gt;&lt;p&gt;å…³äºå¦‚ä½•åšåˆ°å¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­ï¼Œä¹Ÿéœ€è¦æ…¢æ…¢å­¦ä¹ å’Œç§¯ç´¯ã€‚åœ¨ 23 ç§ç»å…¸è®¾è®¡æ¨¡å¼ä¸­ï¼Œå¤§éƒ¨åˆ†è®¾è®¡æ¨¡å¼éƒ½æ˜¯ä¸ºäº†è§£å†³ä»£ç çš„æ‰©å±•æ€§é—®é¢˜è€Œå­˜åœ¨çš„ï¼Œä¸»è¦éµä»çš„è®¾è®¡åŸåˆ™å°±æ˜¯å¼€é—­åŸåˆ™ã€‚&lt;/p&gt;&lt;p&gt;å®é™…å†™ä»£ç æ—¶å¯ä»¥å‡å®šå˜åŒ–ä¸ä¼šå‘ç”Ÿï¼Œå½“å‡ºç°å˜åŒ–æ—¶ï¼Œéœ€è¦æŠ½è±¡ä»¥éš”ç¦»å°†æ¥çš„åŒç±»å˜åŒ–ã€‚&lt;/p&gt;&lt;h3&gt;é‡Œå¼æ›¿æ¢åŸåˆ™ Liskov Substitution Principle&lt;/h3&gt;&lt;p&gt;å­ç±»èƒ½å¤Ÿåœ¨ä»»ä½•åœ°æ–¹æ›¿æ¢çˆ¶ç±»ï¼Œå¹¶ä¸”ä¿è¯åŸæ¥ç¨‹åºçš„é€»è¾‘è¡Œä¸ºä¸å˜åŠæ­£ç¡®æ€§ä¸è¢«ç ´åã€‚&lt;/p&gt;&lt;p&gt;é‡Œå¼æ›¿æ¢åŸåˆ™è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ›´åŠ èƒ½è½åœ°ã€æ›´æœ‰æŒ‡å¯¼æ„ä¹‰çš„æè¿°ï¼Œé‚£å°±æ˜¯â€œDesign By Contractâ€ï¼Œä¸­æ–‡ç¿»è¯‘å°±æ˜¯â€œæŒ‰ç…§åè®®æ¥è®¾è®¡â€ã€‚æè¿°é‡Œå­ç±»å’Œçˆ¶ç±»çš„å…³ç³»ï¼Œå¯ä»¥æ›¿æ¢æˆæ¥å£å’Œå®ç°çš„å…³ç³»ã€‚æ¢ä¸€ç§æ–¹å¼æè¿°é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå°±æ˜¯å®ç°ç±»ä¸èƒ½è¿åæ¥å£å£°æ˜è¦æä¾›çš„åŠŸèƒ½ã€è¾“å…¥ã€è¾“å‡ºã€å¼‚å¸¸ç­‰ã€‚&lt;/p&gt;&lt;h3&gt;æ¥å£éš”ç¦»åŸåˆ™ Interface Segregation Principle&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;Clients should not be forced to depend upon interfaces that they do not useã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;å…¶æ ¸å¿ƒè¦ç´ å°±æ˜¯ä¸€ä¸ªã€Œæ¥å£ã€çš„åŠŸèƒ½è¦å°½é‡å•ä¸€ï¼Œè°ƒç”¨æ–¹åªéœ€è¦ä¾èµ–å®ƒéœ€è¦çš„éƒ¨åˆ†ï¼Œè€Œä¸éœ€è¦å»ä¾èµ–æˆ–è€…è°ƒç”¨æ•´ä¸ªã€Œæ¥å£ã€ã€‚&lt;/p&gt;&lt;p&gt;è¿™é‡Œçš„æ¥å£å¯ä»¥æŒ‡ä»£ä¸åŒçš„å«ä¹‰ï¼Œæ¯”å¦‚ä¸€ç»„apiæ¥å£é›†åˆï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬ç”¨çš„ä¸€ä¸ªproxyï¼‰ã€‚&lt;/p&gt;&lt;p&gt;æ¯”å¦‚æœ‰ä¸ªé¡¹ç›®ï¼Œä¼šåšä¸€äº›ä¸šåŠ¡æµç¨‹ï¼Œç”Ÿæˆä¸€äº›æ•°æ®ï¼Œç„¶ååˆè¦ä½œä¸ºåŸºç¡€æœåŠ¡æŠŠæ•°æ®æä¾›å‡ºå»ï¼Œè¿™æ—¶ï¼Œæœ€åå°±æ˜¯æä¾›äº†ä¸¤ä¸ªæ¥å£, ä¸€ä¸ªæ˜¯ç”¨æ¥å¤„ç†å†…éƒ¨æµç¨‹ï¼›ä¸€ä¸ªåˆ™æ˜¯ä½œä¸ºåŸºç¡€æœåŠ¡å †å¤–æä¾›ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé¿å…è¯¯è°ƒç”¨ã€‚&lt;/p&gt;&lt;p&gt;ä¹Ÿå¯ä»¥å°†æ¥å£å°±ç†è§£ä¸ºå•ç‹¬ä¸€ä¸ªæ¥å£æ–¹æ³•ï¼Œè¿™æ—¶å€™å°±æ˜¯è¯´ä¸€ä¸ªæ–¹æ³•çš„åŠŸèƒ½è¦å•ä¸€ã€‚&lt;/p&gt;&lt;p&gt;æ¥å£éš”ç¦»åŸåˆ™è·Ÿå•ä¸€èŒè´£åŸåˆ™æœ‰ç‚¹ç±»ä¼¼ï¼Œä¸è¿‡ç¨å¾®è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«ã€‚å•ä¸€èŒè´£åŸåˆ™é’ˆå¯¹çš„æ˜¯æ¨¡å—ã€ç±»ã€æ¥å£çš„è®¾è®¡ã€‚è€Œæ¥å£éš”ç¦»åŸåˆ™ç›¸å¯¹äºå•ä¸€èŒè´£åŸåˆ™ï¼Œæ›´ä¾§é‡äºæ¥å£çš„è®¾è®¡ã€‚æ¥å£éš”ç¦»åŸåˆ™æä¾›äº†ä¸€ç§åˆ¤æ–­æ¥å£çš„èŒè´£æ˜¯å¦å•ä¸€çš„æ ‡å‡†ï¼šé€šè¿‡è°ƒç”¨è€…å¦‚ä½•ä½¿ç”¨æ¥å£æ¥é—´æ¥åœ°åˆ¤å®šã€‚å¦‚æœè°ƒç”¨è€…åªä½¿ç”¨éƒ¨åˆ†æ¥å£æˆ–æ¥å£çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œé‚£æ¥å£çš„è®¾è®¡å°±ä¸å¤ŸèŒè´£å•ä¸€ã€‚&lt;/p&gt;&lt;h3&gt;ä¾èµ–åè½¬åŸåˆ™ Dependency Inversion Principle&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;High-level modules shouldnâ€™t depend on low-level modules. Both modules should depend on abstractions. In addition, abstractions shouldnâ€™t depend on details. Details depend on abstractions.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;æ‰€è°“é«˜å±‚æ¨¡å—å’Œä½å±‚æ¨¡å—çš„åˆ’åˆ†ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼Œåœ¨è°ƒç”¨é“¾ä¸Šï¼Œè°ƒç”¨è€…å±äºé«˜å±‚ï¼Œè¢«è°ƒç”¨è€…å±äºä½å±‚.&lt;/p&gt;&lt;p&gt;è¿™ä¸€åŸåˆ™æ›´å¤šé’ˆå¯¹æ¡†æ¶å¼€å‘ï¼Œä¸šåŠ¡å¼€å‘é‡Œï¼Œé«˜å±‚æ¨¡å—ä¾èµ–åº•å±‚æ¨¡å—ï¼Œå®é™…ä¸Šæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚&lt;/p&gt;&lt;p&gt;ä»¥tomcatä¸ºä¾‹ï¼Œtomcatè°ƒç”¨webç¨‹åºæ¥è¿è¡Œï¼Œæ‰€ä»¥tomcatæ˜¯é«˜å±‚æ¨¡å—ã€‚&lt;/p&gt;&lt;p&gt;Tomcat å’Œåº”ç”¨ç¨‹åºä»£ç ä¹‹é—´å¹¶æ²¡æœ‰ç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œä¸¤è€…éƒ½ä¾èµ–åŒä¸€ä¸ªâ€œæŠ½è±¡â€ï¼Œä¹Ÿå°±æ˜¯ Servlet è§„èŒƒã€‚Servlet è§„èŒƒä¸ä¾èµ–å…·ä½“çš„ Tomcat å®¹å™¨å’Œåº”ç”¨ç¨‹åºçš„å®ç°ç»†èŠ‚ï¼Œè€Œ Tomcat å®¹å™¨å’Œåº”ç”¨ç¨‹åºä¾èµ– Servlet è§„èŒƒã€‚&lt;/p&gt;&lt;h3&gt;KISS&lt;/h3&gt;&lt;p&gt;Keep It Simple and Stupid.&lt;/p&gt;&lt;p&gt;Keep It Short and Simple.&lt;/p&gt;&lt;p&gt;Keep It Simple and Straightforward&lt;/p&gt;&lt;p&gt;KISSåŸåˆ™æœ‰ä¸åŒçš„è¡¨è¿°æ–¹å¼ï¼Œä½†æ˜¯å¤§ä½“æ„æ€éƒ½å·®ä¸å¤šï¼Œå°±æ˜¯è¦è®©ä»£ç å°½é‡ç®€å•ã€‚&lt;/p&gt;&lt;p&gt;ã€Œç®€å•ã€å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆä¸»è§‚çš„äº‹æƒ…ï¼Œcode reviewæ˜¯ä¸€ç§å¾ˆå¥½çš„é—´æ¥è¯„ä»·ä»£ç æ˜¯å¦ç®€å•çš„æ–¹å¼ã€‚å¦‚æœåŒäº‹reviewä½ çš„ä»£ç æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šåœ°æ–¹çœ‹ä¸æ‡‚ï¼Œè¿™å°±å¾ˆå¯èƒ½æ˜¯ä»£ç ä¸å¤Ÿç®€å•ã€‚&lt;/p&gt;&lt;p&gt;ä¸€äº›ç®€å•çš„ç»éªŒï¼šä¸è¦é‡å¤é€ è½®å­ï¼›é¿å…è¿‡åº¦è®¾è®¡ï¼Œæ— è®ºæ˜¯ä¸ºäº†æœªæ¥ä¸ç¡®å®šçš„æ‰©å±•æ€§ï¼Œè¿˜æ˜¯ç»†å¾®çš„æ€§èƒ½å·®åˆ«ã€‚&lt;/p&gt;&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼ŒStringUtilsä¸­çš„å¾ˆå¤šæ–¹æ³•ï¼Œåœ¨ä¸€ä¸ªå…·ä½“çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¤§æ¦‚ç‡å¯ä»¥å†™å‡ºä¸€ä¸ªæ€§èƒ½æ›´å¥½çš„å®ç°çš„ï¼Œå› ä¸ºStringUtilsä¸­è¦è€ƒè™‘çš„å¾ˆå¤šé€šç”¨æ€§çš„é—®é¢˜ï¼Œåœ¨å…·ä½“çš„åœºæ™¯ä¸­å°±ä¸éœ€è¦è€ƒè™‘äº†ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯è¦çœŸçš„è¿™ä¹ˆå»åšï¼Ÿ&lt;/p&gt;&lt;h3&gt;DRY åŸåˆ™ï¼ˆDonâ€™t Repeat Yourselfï¼‰&lt;/h3&gt;&lt;p&gt;è¿™ä¸€æ¡æœ¬èº«å¾ˆç®€å•ï¼Œä¸è¿‡è¦æ³¨æ„è¿™é‡Œçš„repeatå’Œå•çº¯ä»£ç é‡å¤æ˜¯æœ‰åŒºåˆ«çš„ã€‚æ¯”å¦‚ä¸¤ä¸ªæ— å…³çš„æ–¹æ³•ï¼Œå®ç°æ°å¥½ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™æ—¶å€™å°±ä¸è®¤ä¸ºå®ƒè¿åäº†DRYåŸåˆ™ï¼Œå› ä¸ºè¯­ä¹‰ä¸Šæ˜¯ä¸é‡å¤çš„ã€‚è€Œä¸¤ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ–¹æ³•ååˆ°å®ç°éƒ½å®Œå…¨ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ˜¯åœ¨åšä¸€ä»¶äº‹ï¼Œæ¯”å¦‚isValidIp(), checkIpValid(), ä¸¤ä¸ªæ–¹æ³•å„è‡ªç”¨ä¸åŒçš„æ–¹æ³•å®ç°äº†ï¼Œæˆ‘ä»¬ä¹Ÿè®¤ä¸ºè¿åäº†DRYåŸåˆ™ã€‚&lt;/p&gt;&lt;p&gt;å¦å¤–è¦æ³¨æ„æ‰§è¡Œé‡å¤çš„é—®é¢˜ï¼Œæ¯”å¦‚&lt;/p&gt;&lt;figure&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span&gt;14&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;&lt;span&gt;void&lt;/span&gt; run1() {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;a();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;b();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;void&lt;/span&gt; run2() {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;a();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;c();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;main () {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;run1();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;run2();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;è™½ç„¶çœ‹èµ·æ¥ä»£ç å°è£…çš„å¾ˆå¥½ï¼Œä½†æ˜¯æ‰§è¡Œmainæ–¹æ³•æ—¶ï¼Œaæ–¹æ³•æ‰§è¡Œäº†ä¸¤æ¬¡ã€‚å¦‚æœaæ˜¯ä¸€ä¸ªå¼€é”€å¾ˆå¤§çš„æ–¹æ³•ï¼Œå°±ä¼šå¾ˆæœ‰é—®é¢˜ã€‚&lt;/p&gt;&lt;h3&gt;è¿ªç±³ç‰¹æ³•åˆ™&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;Each unit should have only limited knowledge about other units: only units â€œcloselyâ€ related to the current unit. Or: Each unit should only talk to its friends; Donâ€™t talk to strangers.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;â€œé«˜å†…èšã€æ¾è€¦åˆâ€æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„è®¾è®¡æ€æƒ³ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å¯¼ä¸åŒç²’åº¦ä»£ç çš„è®¾è®¡ä¸å¼€å‘ï¼Œæ¯”å¦‚ç³»ç»Ÿã€æ¨¡å—ã€ç±»ã€å‡½æ•°ã€‚&lt;/p&gt;&lt;p&gt;æ‰€è°“é«˜å†…èšï¼Œå°±æ˜¯æŒ‡ç›¸è¿‘çš„åŠŸèƒ½åº”è¯¥æ”¾åˆ°åŒä¸€ä¸ªç±»ï¼ˆæ¨¡å—ã€ç³»ç»Ÿï¼‰ä¸­ï¼Œä¸ç›¸è¿‘çš„åŠŸèƒ½ä¸è¦æ”¾åˆ°åŒä¸€ä¸ªç±»ï¼ˆæ¨¡å—ã€ç³»ç»Ÿï¼‰ä¸­ã€‚&lt;/p&gt;&lt;p&gt;æ‰€è°“æ¾è€¦åˆæ˜¯è¯´ï¼Œåœ¨ä»£ç ä¸­ï¼Œç±»ï¼ˆæ¨¡å—ã€ç³»ç»Ÿï¼‰ä¸ç±»ï¼ˆæ¨¡å—ã€ç³»ç»Ÿï¼‰ä¹‹é—´çš„ä¾èµ–å…³ç³»ç®€å•æ¸…æ™°ï¼Œåªä¾èµ–å¿…è¦çš„ä¸œè¥¿ã€‚&lt;/p&gt;&lt;p&gt;åƒqwertyä¸­ä¹‹å‰å¯¹ä½œä¸šç›¸å…³é€»è¾‘çš„å¤„ç†ï¼Œéœ€è¦äº†è§£æ¯ç§ç±»å‹ä½œä¸šçš„å®ç°ç»†èŠ‚ï¼Œå°±æ˜¯ä¸€ç§è¿åäº†è¿ªç±³ç‰¹æ³•åˆ™çš„åšæ³•ã€‚æ­£ç¡®çš„åšæ³•æ˜¯åœ¨ä½œä¸šè¿™ä¸€ä¾§å®šä¹‰ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼Œæ¨¡å‹ä¸­å°†å„ç±»ä½œä¸šçš„ä¸åŒé€»è¾‘å°è£…å¥½ï¼Œqwertyåˆ™åªéœ€è¦äº†è§£è¿™ä¸ªæ¨¡å‹ã€‚&lt;/p&gt;&lt;p&gt;å¯¹äºè¿™äº›è®¾è®¡åŸåˆ™ï¼Œä¸éœ€è¦èŠ±è´¹å¾ˆå¤šç²¾åŠ›æ¥æ‰£å®ƒä»¬çš„å­—çœ¼ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç†è§£å®ƒä»¬çš„æ€æƒ³ï¼Œç†è§£ä¸ºä»€ä¹ˆè¿™äº›åŸåˆ™èƒ½å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ¥ã€Œå¯ç»´æŠ¤ã€å¯æ‰©å±•ã€å¯è¯»ã€å¯æµ‹ã€å¯å¤ç”¨ã€ç®€æ´ã€çš„ä»£ç ã€‚&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å…·ä½“è¯´è®¾è®¡æ¨¡å¼äº†ã€‚&lt;/p&gt;&lt;h1&gt;å¸¸ç”¨è®¾è®¡æ¨¡å¼&lt;/h1&gt;&lt;p&gt;ç»å…¸çš„è®¾è®¡æ¨¡å¼æœ‰ 23 ç§ã€‚éšç€ç¼–ç¨‹è¯­è¨€çš„æ¼”è¿›ï¼Œä¸€äº›è®¾è®¡æ¨¡å¼ï¼ˆæ¯”å¦‚ Singletonï¼‰ä¹Ÿéšä¹‹è¿‡æ—¶ï¼Œç”šè‡³æˆäº†åæ¨¡å¼ï¼Œä¸€äº›åˆ™è¢«å†…ç½®åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼ˆæ¯”å¦‚ Iteratorï¼‰ï¼Œå¦å¤–è¿˜æœ‰ä¸€äº›æ–°çš„æ¨¡å¼è¯ç”Ÿï¼ˆæ¯”å¦‚ Monostateï¼‰&lt;/p&gt;&lt;p&gt;åˆ›å»ºå‹æ¨¡å¼ï¼Œå…±äº”ç§ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼&lt;/p&gt;&lt;p&gt;ç»“æ„å‹æ¨¡å¼ï¼Œå…±ä¸ƒç§ï¼šé€‚é…å™¨æ¨¡å¼ã€è£…é¥°è€…æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€é—¨é¢æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€‚&lt;/p&gt;&lt;p&gt;è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…±åä¸€ç§ï¼šç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬åªæŒ‘å…¶ä¸­ä¸€äº›é‡è¦çš„æ¥è®²å§ã€‚&lt;/p&gt;&lt;h2&gt;ç®€å•å·¥å‚&amp;amp;å·¥å‚æ–¹æ³•&lt;/h2&gt;&lt;p&gt;æ¯”å¦‚ä¸€ä¸ªéœ€è¦æ ¹æ®æ–‡ä»¶æ ¼å¼æ¥åˆ›å»ºä¸åŒparserï¼Œå°†é…ç½®è¯»å–åˆ°RuleConfigä¸­çš„åŠŸèƒ½ï¼Œç®€å•å·¥å‚æ¨¡å¼çš„å®ç°å¦‚ä¸‹ã€‚&lt;/p&gt;&lt;figure&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span&gt;36&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RuleConfigSource&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  &lt;span&gt;&lt;span&gt;public&lt;/span&gt; RuleConfig &lt;span&gt;load&lt;/span&gt;&lt;span&gt;(String ruleConfigFilePath)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    String ruleConfigFileExtension = getFileExtension(ruleConfigFilePath);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    IRuleConfigParser parser = RuleConfigParserFactory.createParser(ruleConfigFileExtension);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;if&lt;/span&gt; (parser == &lt;span&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;      &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; InvalidRuleConfigException(&lt;/span&gt;&lt;br/&gt;&lt;span&gt;              &lt;span&gt;&quot;Rule config file format is not supported: &quot;&lt;/span&gt; + ruleConfigFilePath);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    }&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;    String configText = &lt;span&gt;&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;//ä»ruleConfigFilePathæ–‡ä»¶ä¸­è¯»å–é…ç½®æ–‡æœ¬åˆ°configTextä¸­&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    RuleConfig ruleConfig = parser.parse(configText);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;return&lt;/span&gt; ruleConfig;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  }&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;  &lt;span&gt;&lt;span&gt;private&lt;/span&gt; String &lt;span&gt;getFileExtension&lt;/span&gt;&lt;span&gt;(String filePath)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;//...è§£ææ–‡ä»¶åè·å–æ‰©å±•åï¼Œæ¯”å¦‚rule.jsonï¼Œè¿”å›json&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;return&lt;/span&gt; &lt;span&gt;&quot;json&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  }&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RuleConfigParserFactory&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; IRuleConfigParser &lt;span&gt;createParser&lt;/span&gt;&lt;span&gt;(String configFormat)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    IRuleConfigParser parser = &lt;span&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;&quot;json&quot;&lt;/span&gt;.equalsIgnoreCase(configFormat)) {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;      parser = &lt;span&gt;new&lt;/span&gt; JsonRuleConfigParser();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    } &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;&quot;xml&quot;&lt;/span&gt;.equalsIgnoreCase(configFormat)) {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;      parser = &lt;span&gt;new&lt;/span&gt; XmlRuleConfigParser();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    } &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;&quot;yaml&quot;&lt;/span&gt;.equalsIgnoreCase(configFormat)) {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;      parser = &lt;span&gt;new&lt;/span&gt; YamlRuleConfigParser();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    } &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;&quot;properties&quot;&lt;/span&gt;.equalsIgnoreCase(configFormat)) {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;      parser = &lt;span&gt;new&lt;/span&gt; PropertiesRuleConfigParser();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    }&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;return&lt;/span&gt; parser;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  }&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªå·¥å‚ç±»ï¼Œä¸“é—¨ç”¨æ¥ã€Œç”Ÿäº§ã€parserã€‚&lt;/p&gt;&lt;p&gt;è¿™é‡Œå¦‚æœå°±æŠŠåˆ›å»ºparserçš„è¿‡ç¨‹ï¼Œæ”¾åˆ°loadæ–¹æ³•é‡Œï¼Œå…¶å®ä¹Ÿä¸æ˜¯ä¸è¡Œã€‚ä¹‹æ‰€ä»¥æ‹†å‡ºæ¥ï¼Œå°±æ˜¯è¦æŠŠåˆ›å»ºè¿™ä¸€éƒ¨åˆ†é€»è¾‘æ‹†åˆ†å¼€ã€‚æ‰€ä»¥ï¼Œåªæœ‰å½“åˆ›å»ºé€»è¾‘æ¯”è¾ƒå¤æ‚çš„æ—¶å€™æ‰ä¼šä½¿ç”¨å·¥å‚æ¨¡å¼ã€‚&lt;/p&gt;&lt;p&gt;ä¸Šè¾¹çš„å®ç°è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå»é™¤å¤§é‡çš„if-elseã€‚&lt;/p&gt;&lt;figure&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span&gt;42&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RuleConfigSource&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  &lt;span&gt;&lt;span&gt;public&lt;/span&gt; RuleConfig &lt;span&gt;load&lt;/span&gt;&lt;span&gt;(String ruleConfigFilePath)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    String ruleConfigFileExtension = getFileExtension(ruleConfigFilePath);&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;    IRuleConfigParserFactory parserFactory = RuleConfigParserFactoryMap.getParserFactory(ruleConfigFileExtension);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;if&lt;/span&gt; (parserFactory == &lt;span&gt;null&lt;/span&gt;) {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;      &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; InvalidRuleConfigException(&lt;span&gt;&quot;Rule config file format is not supported: &quot;&lt;/span&gt; + ruleConfigFilePath);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    }&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    IRuleConfigParser parser = parserFactory.createParser();&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;    String configText = &lt;span&gt;&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;//ä»ruleConfigFilePathæ–‡ä»¶ä¸­è¯»å–é…ç½®æ–‡æœ¬åˆ°configTextä¸­&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    RuleConfig ruleConfig = parser.parse(configText);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;return&lt;/span&gt; ruleConfig;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  }&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;  &lt;span&gt;&lt;span&gt;private&lt;/span&gt; String &lt;span&gt;getFileExtension&lt;/span&gt;&lt;span&gt;(String filePath)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;//...è§£ææ–‡ä»¶åè·å–æ‰©å±•åï¼Œæ¯”å¦‚rule.jsonï¼Œè¿”å›json&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;return&lt;/span&gt; &lt;span&gt;&quot;json&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  }&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;//å› ä¸ºå·¥å‚ç±»åªåŒ…å«æ–¹æ³•ï¼Œä¸åŒ…å«æˆå‘˜å˜é‡ï¼Œå®Œå…¨å¯ä»¥å¤ç”¨ï¼Œ&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;//ä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„å·¥å‚ç±»å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œç®€å•å·¥å‚æ¨¡å¼çš„ç¬¬äºŒç§å®ç°æ€è·¯æ›´åŠ åˆé€‚ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RuleConfigParserFactoryMap&lt;/span&gt; &lt;/span&gt;{ &lt;span&gt;//å·¥å‚çš„å·¥å‚&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Map&amp;lt;String, IRuleConfigParserFactory&amp;gt; cachedFactories = &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;  &lt;span&gt;static&lt;/span&gt; {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    cachedFactories.put(&lt;span&gt;&quot;json&quot;&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; JsonRuleConfigParserFactory());&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    cachedFactories.put(&lt;span&gt;&quot;xml&quot;&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; XmlRuleConfigParserFactory());&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    cachedFactories.put(&lt;span&gt;&quot;yaml&quot;&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; YamlRuleConfigParserFactory());&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    cachedFactories.put(&lt;span&gt;&quot;properties&quot;&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; PropertiesRuleConfigParserFactory());&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  }&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;  &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; IRuleConfigParserFactory &lt;span&gt;getParserFactory&lt;/span&gt;&lt;span&gt;(String type)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;if&lt;/span&gt; (type == &lt;span&gt;null&lt;/span&gt; || type.isEmpty()) {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;      &lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    }&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    IRuleConfigParserFactory parserFactory = cachedFactories.get(type.toLowerCase());&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;return&lt;/span&gt; parserFactory;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  }&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;è¿™å°±æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼å®è´¨ä¸Šæ˜¯ä¸ºå·¥å‚ç±»å†åˆ›å»ºä¸€ä¸ªç®€å•å·¥å‚ï¼Œä¹Ÿå°±æ˜¯å·¥å‚çš„å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºå·¥å‚ç±»å¯¹è±¡ã€‚&lt;/p&gt;&lt;p&gt;å·¥å‚æ¨¡å¼çš„åŸç†å’Œå®ç°éƒ½å¾ˆç®€å•ï¼Œåœ¨å®ç°æ—¶å…¶å®è¿˜æœ‰å¾ˆå¤šå¯ä»¥æ¢ç©¶çš„ç»†èŠ‚ï¼Œä½†åœ¨è¿™é‡Œå°±ä¸ç»†è¯´äº†ã€‚æˆ‘ä»¬æ¢è®¨çš„å…³é”®è¿˜æ˜¯ç†è§£ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥ç”¨è¿™ç§æ¨¡å¼ï¼Œå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚&lt;/p&gt;&lt;p&gt;å¯¹äºå·¥å‚æ¨¡å¼æ¥è¯´ï¼Œåº”ç”¨çš„åœºæ™¯å°±æ˜¯åˆ›å»ºç±»çš„é€»è¾‘æ¯”è¾ƒå¤æ‚æ—¶ï¼Œæ¯”å¦‚éœ€è¦æœ‰ä¸€å †if-else, åŠ¨æ€çš„å†³å®šè¦åˆ›å»ºä»€ä¹ˆå¯¹è±¡ï¼›æˆ–è€…è™½ç„¶åˆ›å»ºå•ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯åˆ›å»ºæœ¬èº«çš„è¿‡ç¨‹å¾ˆå¤æ‚ï¼Œè°ƒç”¨æ–¹æ— éœ€äº†è§£å¦‚ä½•å»åˆ›å»ºã€‚&lt;/p&gt;&lt;h2&gt;å»ºé€ è€…&lt;/h2&gt;&lt;p&gt;å»ºé€ è€…æ¨¡å¼(Builder), å…¶å®åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæˆ‘ä»¬æ‰“å¼€ä»»ä½•ä¸€ä¸ªé¡¹ç›®ï¼Œéƒ½å¯ä»¥çœ‹åˆ°å¾ˆå¤šXXXBuilder.&lt;/p&gt;&lt;p&gt;å»ºé€ è€…æ¨¡å¼ä½¿ç”¨çš„åœºæ™¯æ˜¯ï¼šä¸€ä¸ªç±»æœ‰å¤šä¸ªå¯é…ç½®é¡¹ï¼Œä½¿ç”¨æ–¹å¯ä»¥è‡ªç”±é€‰æ‹©å…¶ä¸­è‹¥å¹²ä¸ªè¿›è¡Œé…ç½®ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœé‡‡ç”¨ä¸åŒæ„é€ æ–¹æ³•æ¥å®ç°è¿™ç§æ•ˆæœï¼Œé¢å¯¹çš„å°±ä¼šè¯´æ— ç©·æ— å°½çš„ç»„åˆã€‚&lt;/p&gt;&lt;p&gt;è€Œå¦‚æœé‡‡ç”¨setæ–¹æ³•æ¥é…ç½®ï¼Œé‚£ä¹ˆé¦–å…ˆå½“å‰ç±»å°±å½»åº•å¤±å»äº†å¯¹é…ç½®é¡¹çš„æ§åˆ¶ï¼Œè°ƒç”¨æ–¹å¯ä»¥éšæ—¶éšåœ°è°ƒç”¨setæ–¹æ³•ã€‚å¦å¤–ï¼Œå¦‚æœéœ€è¦åœ¨é…ç½®é¡¹è¢«é…ç½®å¥½ä¹‹åè¿›è¡Œä¸€äº›åˆæ³•æ€§çš„æ ¡éªŒï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ— æ³•å®ç°ã€‚&lt;/p&gt;&lt;p&gt;è¿™ç§æƒ…å†µä¸‹çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å»ºé€ è€…æ¨¡å¼ã€‚&lt;/p&gt;&lt;figure&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span&gt;6&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;ResourcePoolConfig config = &lt;span&gt;new&lt;/span&gt; ResourcePoolConfig.Builder()&lt;/span&gt;&lt;br/&gt;&lt;span&gt; .setName(&lt;span&gt;&quot;dbconnectionpool&quot;&lt;/span&gt;) &lt;/span&gt;&lt;br/&gt;&lt;span&gt; .setMaxTotal(&lt;span&gt;16&lt;/span&gt;) &lt;/span&gt;&lt;br/&gt;&lt;span&gt; .setMaxIdle(&lt;span&gt;10&lt;/span&gt;) &lt;/span&gt;&lt;br/&gt;&lt;span&gt; .setMinIdle(&lt;span&gt;12&lt;/span&gt;)&lt;/span&gt;&lt;br/&gt;&lt;span&gt; .build();&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ã€‚&lt;/p&gt;&lt;p&gt;å·¥å‚æ¨¡å¼æ˜¯ç”¨æ¥åˆ›å»ºä¸€ç»„ç›¸å…³ä½†ä¸åŒçš„çš„å¯¹è±¡ï¼Œå»ºé€ è€…æ¨¡å¼åˆ™æ˜¯å¯¹åŒä¸€ä¸ªå¯¹è±¡è¿›è¡Œä¸åŒæ–¹å¼çš„å®šåˆ¶ã€‚&lt;/p&gt;&lt;h2&gt;å•ä¾‹&lt;/h2&gt;&lt;p&gt;å…³äºå•ä¾‹æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆå®ç°å•ä¾‹ï¼Œä½œä¸ºç»å…¸çš„é¢è¯•é¢˜ï¼Œå°±ä¸å¤šè¯´äº†ã€‚åªè¯´ä¸€ä¸‹å•ä¾‹çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå•ä¾‹ä¸»é”®å˜æˆäº†ä¸€ç§åæ¨¡å¼ã€‚&lt;/p&gt;&lt;p&gt;å•ä¾‹çš„é—®é¢˜ï¼š&lt;/p&gt;&lt;p&gt;éšè—ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼›&lt;/p&gt;&lt;p&gt;åŒæ—¶ï¼Œä¾èµ–çš„ç›´æ¥å°±æ˜¯å•ä¾‹çš„å®ç°ï¼Œè¿åäº†åŸºäºæ¥å£è€Œéå®ç°çš„è®¾è®¡åŸåˆ™ï¼›&lt;/p&gt;&lt;p&gt;å¯æµ‹æ€§ä¸å¥½: æ— æ³•è¢«mock(Mockitoä¸­)ï¼›å…¨å±€å˜é‡æœ‰å¯èƒ½å¯¼è‡´æµ‹è¯•ä¹‹é—´äº’ç›¸å½±å“ï¼›&lt;/p&gt;&lt;p&gt;ä¸æ”¯æŒæœ‰å‚æ•°çš„æ„é€ å‡½æ•°ã€‚&lt;/p&gt;&lt;p&gt;ä½†æ˜¯ï¼Œå•ä¾‹æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯æœ‰äº›åœºæ™¯ä¸‹ä½¿ç”¨èµ·æ¥æ›´ç®€æ´æ–¹ä¾¿ï¼Œæ‰€ä»¥ä¹Ÿæ²¡å¿…è¦ç›´æ¥å°±è®¤å®šä¸èƒ½ä½¿ç”¨å•ä¾‹ã€‚&lt;/p&gt;&lt;h2&gt;ä»£ç†&amp;amp;è£…é¥°å™¨&lt;/h2&gt;&lt;p&gt;ä»£ç†æ¨¡å¼å’Œè¢«ä»£ç†ç±»å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œè´Ÿè´£åœ¨ä¸šåŠ¡ä»£ç æ‰§è¡Œå‰åé™„åŠ å…¶ä»–é€»è¾‘ä»£ç ï¼ˆæ¯”å¦‚æ€§èƒ½ç›‘æ§ã€è®¡æ•°ç­‰ï¼‰ï¼Œç„¶åç”¨å§”æ‰˜çš„å½¢å¼è°ƒç”¨è¢«ä»£ç†ç±»å®Œæˆä¸šåŠ¡åŠŸèƒ½ï¼Œä»è€Œå®ç°ä¸šåŠ¡ä»£ç å’Œæ¡†æ¶ä»£ç çš„è§£è€¦ã€‚&lt;/p&gt;&lt;p&gt;è£…é¥°å™¨æ¨¡å¼æ˜¯é€šè¿‡ç»§æ‰¿è¢«è£…é¥°ç±»ï¼Œæ¥å®ç°åŠŸèƒ½çš„å¢å¼ºã€‚æ¯”å¦‚javaä¸­inputStreamç³»åˆ—ç±»ï¼Œå°±æ˜¯è£…é¥°å™¨æ¨¡å¼çš„åº”ç”¨ã€‚&lt;/p&gt;&lt;p&gt;å®ç°å±‚é¢ï¼Œä»£ç†æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼å‡ ä¹ä¸€æ ·ï¼Œä½†æ˜¯å…¶æ„å›¾ä¸åŒã€‚&lt;/p&gt;&lt;p&gt;ä»£ç†æ¨¡å¼ä¸­ï¼Œä»£ç†ç±»é™„åŠ çš„æ˜¯è·ŸåŸå§‹ç±»æ— å…³çš„åŠŸèƒ½ï¼Œè€Œåœ¨è£…é¥°å™¨æ¨¡å¼ä¸­ï¼Œè£…é¥°å™¨ç±»é™„åŠ çš„æ˜¯è·ŸåŸå§‹ç±»ç›¸å…³çš„å¢å¼ºåŠŸèƒ½ã€‚&lt;/p&gt;&lt;p&gt;è¿˜æ˜¯è¿™ä¸ªè§‚ç‚¹ï¼Œå¯¹äºè®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬æ²¡å¿…è¦æ‰£å­—çœ¼æ·±ç©¶æ¯ç§è®¾è®¡æ¨¡å¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œåªè¦çŸ¥é“æœ‰è¿™ä¹ˆä¸€ç§æŠ€å·§ï¼Œå¯ä»¥å¤„ç†ç±»ä¼¼çš„è¿™ç§åœºæ™¯å°±å¯ä»¥äº†ã€‚&lt;/p&gt;&lt;h2&gt;é€‚é…å™¨&lt;/h2&gt;&lt;p&gt;é€‚é…å™¨æ¨¡å¼å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥çœ‹ä¾‹å­ã€‚&lt;/p&gt;&lt;figure&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span&gt;10&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;debug&lt;/span&gt;&lt;span&gt;(String msg)&lt;/span&gt; &lt;/span&gt;{ &lt;/span&gt;&lt;br/&gt;&lt;span&gt;logger.log(FQCN, Level.DEBUG, msg, &lt;span&gt;null&lt;/span&gt;); &lt;/span&gt;&lt;br/&gt;&lt;span&gt;} &lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;debug&lt;/span&gt;&lt;span&gt;(String format, Object arg)&lt;/span&gt; &lt;/span&gt;{ &lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;if&lt;/span&gt; (logger.isDebugEnabled()) { &lt;/span&gt;&lt;br/&gt;&lt;span&gt;FormattingTuple ft = MessageFormatter.format(format, arg); &lt;/span&gt;&lt;br/&gt;&lt;span&gt;logger.log(FQCN, Level.DEBUG, ft.getMessage(), ft.getThrowable()); &lt;/span&gt;&lt;br/&gt;&lt;span&gt;} &lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š&lt;/p&gt;&lt;p&gt;å…¼å®¹è€ç‰ˆæœ¬æ¥å£ï¼›&lt;/p&gt;&lt;p&gt;åº”å¯¹ä¸åŒçš„è¾“å…¥ï¼›&lt;/p&gt;&lt;p&gt;å°è£…æœ‰ç¼ºé™·çš„æ¥å£è®¾è®¡ï¼›&lt;/p&gt;&lt;p&gt;â€¦&lt;/p&gt;&lt;h2&gt;é—¨é¢&lt;/h2&gt;&lt;p&gt;é—¨é¢æ¨¡å¼ä¸ºå­ç³»ç»Ÿæä¾›ä¸€ç»„ç»Ÿä¸€çš„æ¥å£ï¼Œå®šä¹‰ä¸€ç»„é«˜å±‚æ¥å£è®©å­ç³»ç»Ÿæ›´æ˜“ç”¨ã€‚è¿™é‡Œä¸»è¦æ˜¯å…³ç³»åˆ°ä¸€ä¸ªæ¥å£çš„ç²’åº¦åº”è¯¥æœ‰å¤šå¤§ï¼Œä»è€Œå¹³è¡¡æ¥å£çš„é€šç”¨æ€§å’Œæ˜“ç”¨æ€§ã€‚&lt;/p&gt;&lt;p&gt;é€šå¸¸ï¼Œç²’åº¦å°çš„æ¥å£é€šç”¨æ€§è‚¯å®šä¼šå¥½ä¸€äº›ï¼Œä½†è¿™æ ·è°ƒç”¨æ–¹å°±éœ€è¦è°ƒç”¨å¤šä¸ªæ–¹æ³•ï¼Œå¿…ç„¶ä¸å¤ªå¥½ç”¨ã€‚ç›¸åï¼Œå¦‚æœæ¥å£ç²’åº¦å¤ªå¤§ï¼Œå°±ä¼šæœ‰é€šç”¨æ€§ä¸è¶³çš„é—®é¢˜ã€‚&lt;/p&gt;&lt;p&gt;é—¨é¢æ¨¡å¼çš„ä½œç”¨å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘æ˜¯åšåœ¨çº¿æ•™è‚²çš„ï¼Œæœ‰ä¸€ä¸ªåœºæ™¯æ˜¯åœ¨Bç«¯å±•ç¤ºå„ç§å„æ ·çš„é¢˜ç›®ï¼Œæ¯”å¦‚è¯¾å‰çš„é¢˜ã€è¯¾ä¸­çš„é¢˜ã€è¯¾åçš„é¢˜ï¼Œæ¯ç±»ä¸­åˆåˆ†å¾ˆå¤šå…·ä½“ç±»å‹ï¼Œæ¯ä¸ªç±»å‹æœ‰ä¸åŒçš„æ•°æ®æ¥æºã€‚&lt;/p&gt;&lt;p&gt;è¿™é‡Œï¼Œå°±éœ€è¦æƒè¡¡æ¥å£çš„é€šç”¨æ€§å’Œå¯ç”¨æ€§äº†ã€‚è€Œé—¨é¢æ¨¡å¼åˆšå¥½å¯ä»¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬é¢˜å¹²ã€å‚è€ƒç­”æ¡ˆã€ç”¨æˆ·ä½œç­”ç­‰ï¼Œç„¶åå®ç°ä¸€æ‰¹å…·ä½“ç±»å‹çš„æ¥å£ã€‚åœ¨æ­¤ä¹‹ä¸Šæ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œå°è£…ä¸€äº›é—¨é¢å±‚ï¼Œé—¨é¢å±‚ä¸­åªæ˜¯ç®€å•çš„å°†å­ç³»ç»Ÿçš„æ•°æ®ç»„åˆèµ·æ¥ã€‚&lt;/p&gt;&lt;h2&gt;ç­–ç•¥&lt;/h2&gt;&lt;p&gt;å®šä¹‰ä¸€æ—ç®—æ³•ç±»ï¼Œå°†æ¯ä¸ªç®—æ³•åˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚&lt;/p&gt;&lt;p&gt;å®ç°æ–¹å¼æ˜¯å®šä¹‰ä¸€ä¸ªç­–ç•¥æ¥å£å’Œä¸€ç»„å®ç°è¿™ä¸ªæ¥å£çš„ç­–ç•¥ï¼Œè¿è¡Œæ—¶å¯ä»¥æ ¹æ®ä¸€äº›æ¡ä»¶åŠ¨æ€çš„é€‰æ‹©æ‰§è¡Œå“ªä¸ªç­–ç•¥ã€‚&lt;/p&gt;&lt;h2&gt;æ¨¡æ¿æ–¹æ³•&lt;/h2&gt;&lt;p&gt;æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•éª¨æ¶ï¼Œå¹¶å°†æŸäº›æ­¥éª¤æ¨è¿Ÿåˆ°å­ç±»ä¸­å®ç°ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¯ä»¥è®©å­ç±»åœ¨ä¸æ”¹å˜ç®—æ³•æ•´ä½“ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•ä¸­çš„æŸäº›æ­¥éª¤ã€‚&lt;/p&gt;&lt;p&gt;æ¯”å¦‚javaçš„AbstractList çš„addAllæ–¹æ³•å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚&lt;/p&gt;&lt;figure&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span&gt;13&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; &lt;span&gt;addAll&lt;/span&gt;&lt;span&gt;(&lt;span&gt;int&lt;/span&gt; index, Collection&amp;lt;? extends E&amp;gt; c)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    rangeCheckForAdd(index);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;boolean&lt;/span&gt; modified = &lt;span&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;for&lt;/span&gt; (E e : c) {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;        add(index++, e);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;        modified = &lt;span&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    }&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;return&lt;/span&gt; modified;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(&lt;span&gt;int&lt;/span&gt; index, E element)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; UnsupportedOperationException();&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h2&gt;è§‚å¯Ÿè€…&lt;/h2&gt;&lt;p&gt;åœ¨å¯¹è±¡ä¹‹é—´å®šä¹‰ä¸€ä¸ªä¸€å¯¹å¤šçš„ä¾èµ–ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜çš„æ—¶å€™ï¼Œæ‰€æœ‰ä¾èµ–çš„å¯¹è±¡éƒ½ä¼šè‡ªåŠ¨æ”¶åˆ°é€šçŸ¥ã€‚ä¹Ÿå°±æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚&lt;/p&gt;&lt;p&gt;è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¨¡å¼ï¼Œæ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ï¼Œæœ‰å®Œå…¨ä¸åŒçš„å®ç°æ–¹å¼ï¼Œä½†æ˜¯æ€æƒ³å¾ˆå®¹æ˜“ç†è§£ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸åˆ—ä»£ç äº†ã€‚åƒæˆ‘ä»¬ä½¿ç”¨mq, ä¹Ÿå°±æ˜¯åœ¨ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ã€‚&lt;/p&gt;&lt;h2&gt;è´£ä»»é“¾&lt;/h2&gt;&lt;p&gt;å°†è¯·æ±‚çš„å‘é€å’Œæ¥æ”¶è§£è€¦ï¼Œè®©å¤šä¸ªæ¥æ”¶å¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚å°†è¿™äº›æ¥æ”¶å¯¹è±¡ä¸²æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¿™ä¸ªè¯·æ±‚ï¼Œç›´åˆ°é“¾ä¸Šçš„æŸä¸ªæ¥æ”¶å¯¹è±¡èƒ½å¤Ÿå¤„ç†å®ƒä¸ºæ­¢ã€‚&lt;/p&gt;&lt;p&gt;å®é™…ä½¿ç”¨ä¸­ï¼Œè´£ä»»é“¾æ¨¡å¼çš„ä¸€ç§å˜ä½“åº”ç”¨ä¹Ÿå¾ˆå¹¿æ³›ï¼Œå°±æ˜¯è®©é“¾ä¸Šçš„æ¯ä¸ªæ¥æ”¶å¯¹è±¡éƒ½å¤„ç†ä¸€éè¿™ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ‹¼è£…æ•°æ®çš„é€»è¾‘ï¼Œå°±æ˜¯è´£ä»»é“¾å˜ä½“çš„ä¸€ä¸ªåº”ç”¨ã€‚&lt;/p&gt;&lt;figure&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span&gt;7&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; &lt;span&gt;fillUserDataCollection&lt;/span&gt;&lt;span&gt;(Map&amp;lt;Integer, UserDataCollection&amp;gt; userExpandMap, Map&amp;lt;Integer, UserDataCollection&amp;gt; originUserExpandMap)&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;br/&gt;&lt;span&gt;        &lt;span&gt;return&lt;/span&gt; !fillingServices&lt;/span&gt;&lt;br/&gt;&lt;span&gt;                .stream()&lt;/span&gt;&lt;br/&gt;&lt;span&gt;                .map(filler -&amp;gt; filler.fillUserDataWithFallback(userExpandMap, originUserExpandMap))&lt;/span&gt;&lt;br/&gt;&lt;span&gt;                .collect(toSet())&lt;/span&gt;&lt;br/&gt;&lt;span&gt;                .contains(&lt;span&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    }&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;UserDataCollectionä¸­åŒ…å«å¤§é‡å­—æ®µï¼Œæ¯ä¸ªfillingServiceè´Ÿè´£å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®çš„è¡¥å……ã€‚&lt;/p&gt;&lt;p&gt;è´£ä»»é“¾çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯æ‹†åˆ†ï¼Œå°†å¤§ç±»æ‹†æˆå°ç±»ã€‚è¿™ä¹Ÿæ˜¯è§£å†³ä»£ç å¤æ‚åº¦çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ã€‚&lt;/p&gt;&lt;h1&gt;ç»éªŒæ€»ç»“&lt;/h1&gt;&lt;p&gt;å¯¹äºå¦‚ä½•å†™å‡ºå¥½çš„ä»£ç ï¼Œæœ€å…³é”®çš„æ˜¯è¦å…ˆå»ºç«‹èµ·å¿ƒç†ä¸Šçš„è®¤çŸ¥ï¼ŒçŸ¥é“ä»€ä¹ˆæ˜¯å¥½ä»£ç ï¼Œä¹Ÿæœ‰å†™å¥½ä»£ç çš„æ„æ„¿ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¦å¯¹é¢å‘å¯¹è±¡çš„æ€æƒ³å’Œå„ç±»è®¾è®¡åŸåˆ™æœ‰å……åˆ†çš„ç†è§£ï¼ŒçŸ¥é“ä¸ºä»€ä¹ˆå¥½ä»£ç è¦ç¬¦åˆè¿™äº›åŸåˆ™ã€‚&lt;/p&gt;&lt;p&gt;å®è·µä¸Šï¼Œå†™å‡ºå¥½ä»£ç çš„æœ€ä½³æ–¹å¼å°±æ˜¯æŒç»­é‡æ„ã€‚ä¸€å¼€å§‹ä¸šåŠ¡å‘å±•ä¸æ˜æœ—çš„æ—¶å€™ï¼Œä»£ç æ— æ³•è®¾è®¡åˆ°æœ€å¥½æ˜¯å¾ˆæ­£å¸¸çš„ã€‚è€Œéšç€ä¸šåŠ¡çš„å‘å±•ï¼Œæˆ‘ä»¬ä¼šé€æ¸æ„è¯†åˆ°ä»£ç é‡Œå­˜åœ¨çš„é—®é¢˜ï¼Œè¿™æ—¶å€™å¯ä»¥ç¿»ç¿»è®¾è®¡æ¨¡å¼ä¸­æœ‰æ²¡æœ‰ä»€ä¹ˆç°æˆçš„è§£å†³æ–¹æ¡ˆï¼Œç„¶ååº”ç”¨åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚&lt;/p&gt;&lt;p&gt;æœ€åï¼Œè¯´ä¸€ä¸‹ï¼Œè¿™ç¯‡æ–‡ç« ä¸­çš„å¾ˆå¤šå†…å®¹å®é™…ä¸Šæ¥è‡ªæå®¢æ—¶é—´çš„ä¸“æ ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹ã€‚æˆ‘è§‰å¾—è¿™ä¸ªä¸“æ æ˜¯è®²è®¾è®¡æ¨¡å¼æœ€å¥½çš„ä¸€ä¸ªä¸“æ ï¼Œæ¨èå¤§å®¶ä¹Ÿå¯ä»¥å»çœ‹çœ‹ã€‚ç‚¹å‡»ä¸‹æ–¹å›¾ç‰‡è´­ä¹°å³å¯ã€‚&lt;/p&gt;&lt;p&gt;&lt;img data-ratio=&quot;1.7785829307568437&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/xxBW79XJVvTtMGE9YezxUCR7ibfPicAAAYbAibg6LEGCLUsTRFjYHPEmO9KyQArHsOMoUHyNsFZxKdJKQwnMQCRgA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1242&quot;/&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f2378a4ead252d7c8fe07154b52bc277</guid>
<title>CompletableFuture è®©ä½ çš„ä»£ç å…å—é˜»å¡ä¹‹è‹¦</title>
<link>https://toutiao.io/k/6sgy0vy</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å‰è¨€&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç°åœ¨å¤§éƒ¨åˆ†çš„CPUéƒ½æ˜¯å¤šæ ¸ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æƒ³è¦æå‡æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œå°±å¿…é¡»å¾—å……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„è®¡ç®—èƒ½åŠ›ï¼›Javaæ—©å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†å¤šçº¿ç¨‹çš„APIï¼Œä½†æ˜¯å®ç°æ–¹å¼ç•¥å¾®éº»çƒ¦ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹Java8åœ¨è¿™æ–¹é¢æä¾›çš„æ”¹å–„ã€‚&lt;/p&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å‡è®¾åœºæ™¯&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç°åœ¨ä½ éœ€è¦ä¸ºåœ¨çº¿æ•™è‚²å¹³å°æä¾›ä¸€ä¸ªæŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…çš„APIï¼Œè¯¥æ¥å£éœ€è¦è¿”å›ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ ‡ç­¾ä¿¡æ¯ï¼Œè¿™ä¸¤ä¸ªä¿¡æ¯å­˜æ”¾åœ¨ä¸åŒä½ç½®ï¼Œéœ€è¦è¿œç¨‹è°ƒç”¨æ¥è·å–è¿™ä¸¤ä¸ªä¿¡æ¯ï¼›ä¸ºäº†æ¨¡æ‹Ÿè¿œç¨‹è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»£ç é‡Œé¢å»¶è¿Ÿ 1s;&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;publicÂ interfaceÂ RemoteLoaderÂ {&lt;br/&gt;&lt;br/&gt;Â Â Â Â StringÂ load();&lt;br/&gt;&lt;br/&gt;Â Â Â Â defaultÂ voidÂ &lt;span&gt;&lt;span&gt;delay&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â tryÂ {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Thread.sleep(1000L);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â catchÂ (InterruptedExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â e.printStackTrace();&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;publicÂ classÂ CustomerInfoServiceÂ implementsÂ RemoteLoaderÂ {&lt;br/&gt;&lt;br/&gt;Â Â Â Â publicÂ StringÂ &lt;span&gt;&lt;span&gt;load&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â this.delay();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;åŸºæœ¬ä¿¡æ¯&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;publicÂ classÂ LearnRecordServiceÂ implementsÂ RemoteLoaderÂ {&lt;br/&gt;&lt;br/&gt;Â Â Â Â publicÂ StringÂ &lt;span&gt;&lt;span&gt;load&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â this.delay();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;å­¦ä¹ ä¿¡æ¯&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;åŒæ­¥æ–¹å¼å®ç°ç‰ˆæœ¬&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœæˆ‘ä»¬é‡‡ç”¨åŒæ­¥çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ªAPIæ¥å£ï¼Œæˆ‘ä»¬çš„å®ç°ä»£ç ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ &lt;span&gt;&lt;span&gt;testSync&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â longÂ startÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â List&amp;lt;RemoteLoader&amp;gt;Â remoteLoadersÂ =Â Arrays.asList(newÂ CustomerInfoService(),Â newÂ LearnRecordService());&lt;br/&gt;Â Â Â Â List&amp;lt;String&amp;gt;Â customerDetailÂ =Â remoteLoaders.stream().map(RemoteLoader::load).collect(toList());&lt;br/&gt;Â Â Â Â System.out.println(customerDetail);&lt;br/&gt;Â Â Â Â longÂ endÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â System.out.println(&lt;span&gt;&quot;æ€»å…±èŠ±è´¹æ—¶é—´:&quot;&lt;/span&gt;Â +Â (endÂ -Â start));&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸å‡ºæ‰€æ–™ï¼Œå› ä¸ºè°ƒç”¨çš„ä¸¤ä¸ªæ¥å£éƒ½æ˜¯å»¶è¿Ÿäº† 1s ï¼Œæ‰€ä»¥ç»“æœå¤§äº2ç§’&lt;img data-ratio=&quot;0.2&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ggRgNal7zGicf6vk3kaemSzAD7bHhK4yQuJOuWrSTria1w2Cciaj42W4dWjPTzQ9gNt5cIKfQSBhiaUHkDzHuGCABw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;800&quot;/&gt;&lt;/p&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;Futureå®ç°çš„ç‰ˆæœ¬&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠè¿™ä¸ªä¾‹å­ç”¨Java7æä¾›çš„&lt;code&gt;Future&lt;/code&gt;æ¥å®ç°å¼‚æ­¥çš„ç‰ˆæœ¬ï¼Œçœ‹ä¸‹æ•ˆæœå¦‚ä½•å‘¢ï¼Ÿä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ &lt;span&gt;&lt;span&gt;testFuture&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â longÂ startÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â ExecutorServiceÂ executorServiceÂ =Â Executors.newFixedThreadPool(2);&lt;br/&gt;Â Â Â Â List&amp;lt;RemoteLoader&amp;gt;Â remoteLoadersÂ =Â Arrays.asList(newÂ CustomerInfoService(),Â newÂ LearnRecordService());&lt;br/&gt;Â Â Â Â List&amp;lt;Future&amp;lt;String&amp;gt;&amp;gt;Â futuresÂ =Â remoteLoaders.stream()&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .map(remoteLoaderÂ -&amp;gt;Â executorService.submit(remoteLoader::load))&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .collect(toList());&lt;br/&gt;&lt;br/&gt;Â Â Â Â List&amp;lt;String&amp;gt;Â customerDetailÂ =Â futures.stream()&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .map(futureÂ -&amp;gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â tryÂ {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â future.get();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (InterruptedExceptionÂ |Â ExecutionExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â e.printStackTrace();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â null;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â })&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .filter(Objects::nonNull)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .collect(toList());&lt;br/&gt;Â Â Â Â System.out.println(customerDetail);&lt;br/&gt;Â Â Â Â longÂ endÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â System.out.println(&lt;span&gt;&quot;æ€»å…±èŠ±è´¹æ—¶é—´:&quot;&lt;/span&gt;Â +Â (endÂ -Â start));&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™æ¬¡æˆ‘ä»¬é‡‡ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼æ¥æ”¹é€ äº†æˆ‘ä»¬è¿™ä¸ªä¾‹å­ï¼Œç»“æœè¿˜æ˜¯æ¯”è¾ƒæ»¡æ„çš„ï¼Œæ—¶é—´å¤§æ¦‚èŠ±è´¹äº†1så¤šä¸€ç‚¹&lt;img data-ratio=&quot;0.18625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ggRgNal7zGicf6vk3kaemSzAD7bHhK4yQ9ALROVdMT42QJwoNb3IkRmicGzhzh40GnOQN4wuIU9Y5lzrWcYy0Xjw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;800&quot;/&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;â&lt;/span&gt;&lt;p&gt;æ³¨æ„ï¼šè¿™é‡Œæˆ‘åˆ†æˆäº†ä¸¤ä¸ªStreamï¼Œå¦‚ä½•åˆåœ¨ä¸€èµ·ç”¨åŒä¸€ä¸ªStreamï¼Œé‚£ä¹ˆåœ¨ç”¨&lt;code&gt;future.get()&lt;/code&gt;çš„æ—¶å€™ä¼šå¯¼è‡´é˜»å¡ï¼Œç›¸å½“äºæäº¤ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œåæ‰æäº¤ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ ·è¾¾ä¸åˆ°å¼‚æ­¥çš„æ•ˆæœ&lt;/p&gt;&lt;span&gt;â&lt;/span&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è™½ç„¶&lt;code&gt;Future&lt;/code&gt;è¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœï¼Œä½†æ˜¯å¦‚æœéœ€è¦å®ç°å°†ä¸¤ä¸ªå¼‚æ­¥çš„ç»“æœè¿›è¡Œåˆå¹¶å¤„ç†å°±ç¨å¾®éº»ä¸€äº›ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´ï¼Œåé¢ä¸»è¦çœ‹ä¸‹&lt;code&gt;CompletableFuture&lt;/code&gt;åœ¨è¿™æ–¹é¢çš„æ”¹è¿›&lt;/p&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;Java8å¹¶è¡Œæµ&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»¥ä¸Šæˆ‘ä»¬ç”¨çš„æ˜¯Java8ä¹‹å‰æä¾›çš„æ–¹æ³•æ¥å®ç°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹Java8ä¸­æä¾›çš„å¹¶è¡Œæµæ¥å®ä¹ æˆ‘ä»¬è¿™ä¸ªä¾‹å­æ•ˆæœæ€æ ·å‘¢ï¼Ÿ&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ &lt;span&gt;&lt;span&gt;testParallelStream&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â longÂ startÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â List&amp;lt;RemoteLoader&amp;gt;Â remoteLoadersÂ =Â Arrays.asList(newÂ CustomerInfoService(),Â newÂ LearnRecordService());&lt;br/&gt;Â Â Â Â List&amp;lt;String&amp;gt;Â customerDetailÂ =Â remoteLoaders.parallelStream().map(RemoteLoader::load).collect(toList());&lt;br/&gt;Â Â Â Â System.out.println(customerDetail);&lt;br/&gt;Â Â Â Â longÂ endÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â System.out.println(&lt;span&gt;&quot;æ€»å…±èŠ±è´¹æ—¶é—´:&quot;&lt;/span&gt;Â +Â (endÂ -Â start));&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿è¡Œçš„ç»“æœè¿˜æ˜¯ç›¸å½“çš„æ»¡æ„ï¼ŒèŠ±è´¹æ—¶é—´ 1s å¤šç‚¹&lt;img data-ratio=&quot;0.17875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ggRgNal7zGicf6vk3kaemSzAD7bHhK4yQciaglARgQBPdiaEjaibDHCRF9A6uPoBf55LTsY1liaHhMlvjywlxBJPL8A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;800&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å’ŒJava8ä¹‹å‰çš„å®ç°å¯¹æ¯”ï¼Œæˆ‘ä»¬å‘ç°æ•´ä¸ªä»£ç ä¼šæ›´åŠ çš„ç®€æ´ï¼›&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„ä¾‹å­æ”¹å˜ä¸€ä¸‹ï¼ŒæŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…çš„æ¥å£è¿˜éœ€è¦è¿”å›è§†é¢‘è§‚çœ‹è®°å½•ï¼Œç”¨æˆ·çš„æ ‡ç­¾ä¿¡æ¯ï¼Œè´­ä¹°è®¢å•&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;publicÂ classÂ WatchRecordServiceÂ implementsÂ RemoteLoaderÂ {&lt;br/&gt;Â Â Â Â @Override&lt;br/&gt;Â Â Â Â publicÂ StringÂ &lt;span&gt;&lt;span&gt;load&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â this.delay();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;è§‚çœ‹è®°å½•&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;publicÂ classÂ OrderServiceÂ implementsÂ RemoteLoaderÂ {&lt;br/&gt;Â Â Â Â @Override&lt;br/&gt;Â Â Â Â publicÂ StringÂ &lt;span&gt;&lt;span&gt;load&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â this.delay();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;è®¢å•ä¿¡æ¯&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;publicÂ classÂ LabelServiceÂ implementsÂ RemoteLoaderÂ {&lt;br/&gt;Â Â Â Â @Override&lt;br/&gt;Â Â Â Â publicÂ StringÂ &lt;span&gt;&lt;span&gt;load&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â this.delay();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;æ ‡ç­¾ä¿¡æ¯&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬ç»§ç»­ä½¿ç”¨Java8æä¾›çš„å¹¶è¡Œæµæ¥å®ç°ï¼Œçœ‹ä¸‹è¿è¡Œçš„ç»“æœæ˜¯å¦ç†æƒ³&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ &lt;span&gt;&lt;span&gt;testParallelStream2&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â longÂ startÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â List&amp;lt;RemoteLoader&amp;gt;Â remoteLoadersÂ =Â Arrays.asList(&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ CustomerInfoService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ LearnRecordService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ LabelService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ OrderService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ WatchRecordService());&lt;br/&gt;Â Â Â Â List&amp;lt;String&amp;gt;Â customerDetailÂ =Â remoteLoaders.parallelStream().map(RemoteLoader::load).collect(toList());&lt;br/&gt;Â Â Â Â System.out.println(customerDetail);&lt;br/&gt;Â Â Â Â longÂ endÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â System.out.println(&lt;span&gt;&quot;æ€»å…±èŠ±è´¹æ—¶é—´:&quot;&lt;/span&gt;Â +Â (endÂ -Â start));&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†æ˜¯è¿™æ¬¡è¿è¡Œçš„ç»“æœä¸æ˜¯å¤ªç†æƒ³ï¼ŒèŠ±è´¹æ—¶é—´è¶…è¿‡äº†2ç§’&lt;img data-ratio=&quot;0.20875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ggRgNal7zGicf6vk3kaemSzAD7bHhK4yQ8hbOibacBe5etWF2zWnNNEKG5ze65pj9fh9SRWaamDZic8ibzldRrpyBg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;800&quot;/&gt;&lt;/p&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;CompletableFuture&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;&lt;span/&gt;åŸºæœ¬çš„ç”¨æ³•&lt;/span&gt;&lt;span/&gt;&lt;/h4&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ &lt;span&gt;&lt;span&gt;testCompletableFuture&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â CompletableFuture&amp;lt;String&amp;gt;Â futureÂ =Â newÂ CompletableFuture&amp;lt;&amp;gt;();&lt;br/&gt;Â Â Â Â newÂ Thread(()Â -&amp;gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â doSomething();&lt;br/&gt;Â Â Â Â Â Â Â Â future.complete(&lt;span&gt;&quot;Finish&quot;&lt;/span&gt;);Â Â Â Â Â Â Â Â Â Â //ä»»åŠ¡æ‰§è¡Œå®ŒæˆåÂ è®¾ç½®è¿”å›çš„ç»“æœ&lt;br/&gt;Â Â Â Â }).start();&lt;br/&gt;Â Â Â Â System.out.println(future.join());Â Â Â Â Â Â //è·å–ä»»åŠ¡çº¿ç¨‹è¿”å›çš„ç»“æœ&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;privateÂ voidÂ &lt;span&gt;&lt;span&gt;doSomething&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â System.out.println(&lt;span&gt;&quot;doSomething...&quot;&lt;/span&gt;);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ç§ç”¨æ³•è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä»»åŠ¡å‡ºç°äº†å¼‚å¸¸ï¼Œä¸»çº¿ç¨‹ä¼šæ— æ„ŸçŸ¥ï¼Œä»»åŠ¡çº¿ç¨‹ä¸ä¼šæŠŠå¼‚å¸¸ç»™æŠ›å‡ºæ¥ï¼›è¿™ä¼šå¯¼è‡´ä¸»çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œé€šå¸¸æˆ‘ä»¬ä¹Ÿéœ€è¦çŸ¥é“å‡ºç°äº†ä»€ä¹ˆå¼‚å¸¸ï¼Œåšå‡ºå¯¹åº”çš„å“åº”ï¼›æ”¹è¿›çš„æ–¹å¼æ˜¯åœ¨ä»»åŠ¡ä¸­try-catchæ‰€æœ‰çš„å¼‚å¸¸ï¼Œç„¶åè°ƒç”¨&lt;code&gt;future.completeExceptionally(e)&lt;/code&gt; ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ testCompletableFuture()Â throwsÂ ExecutionException,Â InterruptedExceptionÂ {&lt;br/&gt;Â Â Â Â CompletableFuture&amp;lt;String&amp;gt;Â futureÂ =Â newÂ CompletableFuture&amp;lt;&amp;gt;();&lt;br/&gt;Â Â Â Â newÂ Thread(()Â -&amp;gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â tryÂ {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â doSomething();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â future.complete(&lt;span&gt;&quot;Finish&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â future.completeExceptionally(e);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }).start();&lt;br/&gt;Â Â Â Â System.out.println(future.get());&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;privateÂ voidÂ &lt;span&gt;&lt;span&gt;doSomething&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â System.out.println(&lt;span&gt;&quot;doSomething...&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â throwÂ newÂ RuntimeException(&lt;span&gt;&quot;TestÂ Exception&quot;&lt;/span&gt;);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»ç°åœ¨æ¥çœ‹&lt;code&gt;CompletableFuture&lt;/code&gt;çš„ä½¿ç”¨è¿‡ç¨‹éœ€è¦å¤„ç†çš„äº‹æƒ…å¾ˆå¤šï¼Œä¸å¤ªç®€æ´ï¼Œä½ ä¼šè§‰å¾—çœ‹èµ·æ¥å¾ˆéº»çƒ¦ï¼›ä½†æ˜¯è¿™åªæ˜¯è¡¨è±¡ï¼ŒJava8å…¶å®å¯¹è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œäº†å°è£…ï¼Œæä¾›äº†å¾ˆå¤šç®€æ´çš„æ“ä½œæ–¹å¼ï¼›æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•æ”¹é€ ä¸Šé¢çš„ä»£ç &lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ testCompletableFuture2()Â throwsÂ ExecutionException,Â InterruptedExceptionÂ {&lt;br/&gt;Â Â Â Â CompletableFuture&amp;lt;String&amp;gt;Â futureÂ =Â CompletableFuture.supplyAsync(()Â -&amp;gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â doSomething();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;Finish&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â });&lt;br/&gt;Â Â Â Â System.out.println(future.get());&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨äº†&lt;code&gt;supplyAsync&lt;/code&gt;ï¼Œè¿™ä¸‹çœ‹èµ·æ¥ç®€æ´äº†è®¸å¤šï¼Œä¸–ç•Œéƒ½æ˜äº®äº†; Java8ä¸ä»…æä¾›å…è®¸ä»»åŠ¡è¿”å›ç»“æœçš„&lt;code&gt;supplyAsync&lt;/code&gt;ï¼Œè¿˜æä¾›äº†æ²¡æœ‰è¿”å›å€¼çš„&lt;code&gt;runAsync&lt;/code&gt;ï¼›è®©æˆ‘ä»¬å¯ä»¥æ›´åŠ çš„å…³æ³¨ä¸šåŠ¡çš„å¼€å‘ï¼Œä¸éœ€è¦å¤„ç†å¼‚å¸¸é”™è¯¯çš„ç®¡ç†&lt;/p&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;&lt;span/&gt;CompletableFutureå¼‚å¸¸å¤„ç†&lt;/span&gt;&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœè¯´ä¸»çº¿ç¨‹éœ€è¦å…³å¿ƒä»»åŠ¡åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆå¼‚å¸¸ï¼Œéœ€è¦å¯¹å…¶ä½œå‡ºç›¸åº”æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°&lt;code&gt;exceptionally&lt;/code&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ testCompletableFuture2()Â throwsÂ ExecutionException,Â InterruptedExceptionÂ {&lt;br/&gt;Â Â Â Â CompletableFuture&amp;lt;String&amp;gt;Â futureÂ =Â CompletableFuture&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .supplyAsync(()Â -&amp;gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â doSomething();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;Finish&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â })&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .exceptionally(throwableÂ -&amp;gt;Â &lt;span&gt;&quot;ThrowableÂ exceptionÂ message:&quot;&lt;/span&gt;Â +Â throwable.getMessage());&lt;br/&gt;Â Â Â Â System.out.println(future.get());&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;&lt;span/&gt;ä½¿ç”¨CompletableFutureæ¥å®Œæˆæˆ‘ä»¬æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…çš„APIæ¥å£&lt;/span&gt;&lt;span/&gt;&lt;/h4&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ testCompletableFuture3()Â throwsÂ ExecutionException,Â InterruptedExceptionÂ {&lt;br/&gt;Â Â Â Â longÂ startÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â List&amp;lt;RemoteLoader&amp;gt;Â remoteLoadersÂ =Â Arrays.asList(&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ CustomerInfoService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ LearnRecordService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ LabelService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ OrderService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ WatchRecordService());&lt;br/&gt;Â Â Â Â List&amp;lt;CompletableFuture&amp;lt;String&amp;gt;&amp;gt;Â completableFuturesÂ =Â remoteLoaders&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .stream()&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .map(loaderÂ -&amp;gt;Â CompletableFuture.supplyAsync(loader::load))&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .collect(toList());&lt;br/&gt;&lt;br/&gt;Â Â Â Â List&amp;lt;String&amp;gt;Â customerDetailÂ =Â completableFutures&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .stream()&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .map(CompletableFuture::join)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .collect(toList());&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â System.out.println(customerDetail);&lt;br/&gt;Â Â Â Â longÂ endÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â System.out.println(&lt;span&gt;&quot;æ€»å…±èŠ±è´¹æ—¶é—´:&quot;&lt;/span&gt;Â +Â (endÂ -Â start));&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™é‡Œä¾ç„¶æ˜¯é‡‡ç”¨çš„ä¸¤ä¸ªStreamæ¥å®Œæˆçš„ï¼Œæ‰§è¡Œçš„ç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.26125&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ggRgNal7zGicf6vk3kaemSzAD7bHhK4yQFWovU0sGEmWGXjsbzLL6xOLwsuOHJxhQhXIM8u6y9CvTWPcP3ia9PgA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;800&quot;/&gt;&lt;figcaption&gt;&lt;span/&gt;result&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ªç»“æœä¸å¤ªæ»¡æ„ï¼Œå’Œå¹¶è¡Œæµçš„ç»“æœå·®ä¸å¤šï¼Œæ¶ˆè€—æ—¶é—´ 2ç§’å¤šç‚¹ï¼›åœ¨è¿™ç§åœºæ™¯ä¸‹æˆ‘ä»¬ç”¨&lt;code&gt;CompletableFuture&lt;/code&gt;åšäº†è¿™ä¹ˆå¤šå·¥ä½œï¼Œä½†æ˜¯æ•ˆæœä¸ç†æƒ³ï¼Œéš¾é“å°±æœ‰æ²¡æœ‰å…¶ä»–çš„æ–¹å¼å¯ä»¥è®©å®ƒå†å¿«ä¸€ç‚¹å—ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»æ·±å…¥äº†è§£ä¸‹å¹¶è¡Œæµå’Œ&lt;code&gt;CompletableFuture&lt;/code&gt;çš„å®ç°åŸç†ï¼Œå®ƒä»¬åº•å±‚ä½¿ç”¨çš„çº¿ç¨‹æ± çš„å¤§å°éƒ½æ˜¯CPUçš„æ ¸æ•°&lt;code&gt;Runtime.getRuntime().availableProcessors()&lt;/code&gt;ï¼›é‚£ä¹ˆæˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹ä¿®æ”¹çº¿ç¨‹æ± çš„å¤§å°ï¼Œçœ‹çœ‹æ•ˆæœå¦‚ä½•ï¼Ÿ&lt;/p&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;&lt;span/&gt;è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œä¼˜åŒ–CompletableFuture&lt;/span&gt;&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½¿ç”¨å¹¶è¡Œæµæ— æ³•è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œä½†æ˜¯&lt;code&gt;CompletableFuture&lt;/code&gt;å¯ä»¥&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;@Test&lt;br/&gt;publicÂ voidÂ testCompletableFuture4()Â throwsÂ ExecutionException,Â InterruptedExceptionÂ {&lt;br/&gt;Â Â Â Â longÂ startÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â List&amp;lt;RemoteLoader&amp;gt;Â remoteLoadersÂ =Â Arrays.asList(&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ CustomerInfoService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ LearnRecordService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ LabelService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ OrderService(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â newÂ WatchRecordService());&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â ExecutorServiceÂ executorServiceÂ =Â Executors.newFixedThreadPool(Math.min(remoteLoaders.size(),Â 50));&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â List&amp;lt;CompletableFuture&amp;lt;String&amp;gt;&amp;gt;Â completableFuturesÂ =Â remoteLoaders&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .stream()&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .map(loaderÂ -&amp;gt;Â CompletableFuture.supplyAsync(loader::load,Â executorService))&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .collect(toList());&lt;br/&gt;&lt;br/&gt;Â Â Â Â List&amp;lt;String&amp;gt;Â customerDetailÂ =Â completableFutures&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .stream()&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .map(CompletableFuture::join)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â .collect(toList());&lt;br/&gt;&lt;br/&gt;Â Â Â Â System.out.println(customerDetail);&lt;br/&gt;Â Â Â Â longÂ endÂ =Â System.currentTimeMillis();&lt;br/&gt;Â Â Â Â System.out.println(&lt;span&gt;&quot;æ€»å…±èŠ±è´¹æ—¶é—´:&quot;&lt;/span&gt;Â +Â (endÂ -Â start));&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œè®¾ç½®æœ€å¤§çš„çº¿ç¨‹æ± æ•°é‡50ï¼Œæ¥çœ‹ä¸‹æ‰§è¡Œçš„ç»“æœ&lt;img data-ratio=&quot;0.27875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ggRgNal7zGicf6vk3kaemSzAD7bHhK4yQib8giahCmNR2hfO15vCHiaycXajib6mKucjWJZvySduiahWiagFFDribicQC0Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;800&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸‹æ‰§è¡Œçš„ç»“æœæ¯”è¾ƒæ»¡æ„äº†ï¼Œ1ç§’å¤šç‚¹ï¼›ç†è®ºä¸Šæ¥è¯´è¿™ä¸ªç»“æœå¯ä»¥ä¸€ç›´æŒç»­ï¼Œç›´åˆ°è¾¾åˆ°çº¿ç¨‹æ± çš„å¤§å°50&lt;/p&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;&lt;span/&gt;å¹¶è¡Œæµå’Œ&lt;code&gt;CompletableFuture&lt;/code&gt;ä¸¤è€…è¯¥å¦‚ä½•é€‰æ‹©&lt;/span&gt;&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸¤è€…å¦‚ä½•é€‰æ‹©ä¸»è¦çœ‹ä»»åŠ¡ç±»å‹ï¼Œå»ºè®®&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å¦‚æœä½ çš„ä»»åŠ¡æ˜¯è®¡ç®—å¯†é›†å‹çš„ï¼Œå¹¶ä¸”æ²¡æœ‰I/Oæ“ä½œçš„è¯ï¼Œé‚£ä¹ˆæ¨èä½ é€‰æ‹©Streamçš„å¹¶è¡Œæµï¼Œå®ç°ç®€å•å¹¶è¡Œæ•ˆç‡ä¹Ÿæ˜¯æœ€é«˜çš„&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦‚æœä½ çš„ä»»åŠ¡æ˜¯æœ‰é¢‘ç¹çš„I/Oæˆ–è€…ç½‘ç»œè¿æ¥ç­‰æ“ä½œï¼Œé‚£ä¹ˆæ¨èä½¿ç”¨&lt;code&gt;CompletableFuture&lt;/code&gt;ï¼Œé‡‡ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± çš„æ–¹å¼ï¼Œæ ¹æ®æœåŠ¡å™¨çš„æƒ…å†µè®¾ç½®çº¿ç¨‹æ± çš„å¤§å°ï¼Œå°½å¯èƒ½çš„è®©CPUå¿™ç¢Œèµ·æ¥&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;&lt;span/&gt;&lt;code&gt;CompletableFuture&lt;/code&gt;çš„å…¶ä»–å¸¸ç”¨æ–¹æ³•&lt;/span&gt;&lt;span/&gt;&lt;/h4&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;thenApplyã€thenApplyAsync: å‡å¦‚ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œè¿˜éœ€è¦åç»­çš„æ“ä½œï¼Œæ¯”å¦‚è¿”å›ç»“æœçš„è§£æç­‰ç­‰ï¼›å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•æ¥å®Œæˆ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;thenComposeã€thenComposeAsync: å…è®¸ä½ å¯¹ä¸¤ä¸ªå¼‚æ­¥æ“ä½œè¿›è¡Œæµæ°´çº¿çš„æ“ä½œï¼Œå½“ç¬¬ä¸€ä¸ªæ“ä½œå®Œæˆåï¼Œå°†å…¶ç»“æœä¼ å…¥åˆ°ç¬¬äºŒä¸ªæ“ä½œä¸­&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;thenCombineã€thenCombineAsyncï¼šå…è®¸ä½ æŠŠä¸¤ä¸ªå¼‚æ­¥çš„æ“ä½œæ•´åˆï¼›æ¯”å¦‚æŠŠç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªæ“ä½œè¿”å›çš„ç»“æœåšå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œ&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;hr data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;/&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;æ€»ç»“&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Java8å¹¶è¡Œæµçš„ä½¿ç”¨æ–¹å¼&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;CompletableFutureçš„ä½¿ç”¨æ–¹å¼ã€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œè®©æˆ‘ä»¬æœ‰æœºä¼šç®¡ç†ä»»åŠ¡æ‰§è¡Œä¸­å‘é€çš„å¼‚å¸¸&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Java8å¹¶è¡Œæµå’Œ&lt;code&gt;CompletableFuture&lt;/code&gt;ä¸¤è€…è¯¥å¦‚ä½•é€‰æ‹©&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;CompletableFuture&lt;/code&gt;çš„å¸¸ç”¨æ–¹æ³•&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>