<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>e504d26a6491f1f67c83d6f6f3021076</guid>
<title>优质网站同好者周刊（第 075 期） | 倾城博客</title>
<link>https://toutiao.io/k/5ev52vr</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;content&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://nicelinks.site/?utm_source=weekly&quot;&gt;倾城之链&lt;/a&gt;作为一个开放平台，旨在云集全球&lt;strong&gt;优秀网站&lt;/strong&gt;，探索互联网中更广阔的世界。此周刊，将汇聚过去一周&lt;a href=&quot;https://nicelinks.site/?utm_source=weekly&quot;&gt;倾城&lt;/a&gt;所收录的内容，以飨同好；欢迎推荐或自荐（仅限有独立域名的网站，可以是二级域名）。您如果要了解收录要求，请参见&lt;a href=&quot;https://nicelinks.site/about?utm_source=weekly&quot;&gt;关于倾城&lt;/a&gt;。&lt;/p&gt;&lt;p&gt;&lt;strong&gt;备注&lt;/strong&gt;：本周刊&lt;strong&gt;每周五&lt;/strong&gt;生成，首发于个人微信公众号&lt;a href=&quot;https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDIwMzM2Mg==&amp;amp;action=getalbum&amp;amp;album_id=1530765143352082433&amp;amp;scene=173&amp;amp;from_msgid=2650641087&amp;amp;from_itemidx=1&amp;amp;count=3#wechat_redirect&quot;&gt;晚晴幽草轩&lt;/a&gt;、博客&lt;a href=&quot;https://www.jeffjade.com&quot;&gt;晚晴幽草轩&lt;/a&gt;，以及&lt;a href=&quot;https://forum.lovejade.cn/&quot;&gt;悠然宜想亭&lt;/a&gt;社区；此一键生成脚本基于 &lt;a href=&quot;https://nicelinks.site/post/602d30aad099ff5688618591&quot;&gt;Deno&lt;/a&gt; 编写，并在 Github 开源：&lt;a href=&quot;https://github.com/nicejade/nicelinks-weekly&quot;&gt;nicejade/nicelinks-weekly&lt;/a&gt;。&lt;/p&gt;&lt;p&gt;&lt;strong&gt;标签&lt;/strong&gt;：&lt;a href=&quot;https://nicelinks.site/tags/%E6%90%9C%E7%B4%A2&quot;&gt;&lt;code&gt;搜索&lt;/code&gt;&lt;/a&gt; · &lt;a href=&quot;https://nicelinks.site/tags/%E5%BC%95%E6%93%8E&quot;&gt;&lt;code&gt;引擎&lt;/code&gt;&lt;/a&gt; · &lt;a href=&quot;https://nicelinks.site/tags/%E7%A8%8B%E5%BA%8F%E5%91%98&quot;&gt;&lt;code&gt;程序员&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;You.com is an ad-free, private search engine that you control. Customize search results with 150 apps alongside web results. Access a zero-trace private mode.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://oss.nicelinks.site/you.com.png?x-oss-process=style/png2jpg&quot; alt=&quot;倾城之链 - You.com | The search engine you control&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;推荐语&lt;/strong&gt;：&lt;a href=&quot;https://nicelinks.site/redirect?url=https://you.com/&quot;&gt;You.com&lt;/a&gt; 是一个无广告的私人搜索引擎，由你控制，免费使用；进入零跟踪的私人模式。它用 150+ 个应用程序和网页结果，一起定制搜索结果。在 &lt;a href=&quot;https://nicelinks.site/post/5f40d0bf15435e0906a0a26f&quot;&gt;Product Hunt&lt;/a&gt; 介绍到：You.com 的 YouCode 是为开发者提供的搜索引擎。可以基于她复制代码片段，用人工智能编写代码，验证 JSON，并以比传统搜索引擎快 10 倍的速度，找到文档、技巧、窍门和实用工具。&lt;/p&gt;&lt;p&gt;世界最大的问答网站 Stack Overflow，每年举办一次全世界程序员调查，2022 增加了一个问题：&quot;哪些因素会影响你的工作效率？它们频繁发生吗？会花费你多少时间？&quot;。68% 的程序员说，&lt;strong&gt;最影响工作效率的是找不到答案&lt;/strong&gt;。&lt;/p&gt;&lt;p&gt;遇到问题，要么没人可问，要么没有文档，工作就被迫卡在那里，无法进行下去。越是高级程序员，给出这个回答的百分比越高。也就是说，水平高的人更苦于找不到答案，因为遇到的都是非典型问题，很少有人提到过。程序员用来找答案的时间，每天平均 30 分钟，25% 的人更是超过一个小时。这对个人和公司，都是很大的损耗。如能很好解决此问题，将能带来巨大价值，并产生无法估量的利润。&lt;/p&gt;&lt;p&gt;对于程序员而言，Goolge、Stack Overflow 以及国内的 &lt;a href=&quot;https://nicelinks.site/post/59c8e9208f066a5dda100f4b&quot;&gt;SegmentFault&lt;/a&gt;，都是解决这一问题的工具。有用户评论 you.com 是真正挖掘领域优化搜索体验的想法——超越 StackOverflow 为开发人员提供搜索工具，是一个聪明而精明的角度。&lt;/p&gt;&lt;p&gt;作为不怎么记忆 API 的编程开发人员，初步体验 You.com，感觉这是值得使用的产品，它能快速根据我的「关键字」，快速且准确找到我想要的内容，而且对「中文」支持的相当好；此外还做了些特色优化，诸如在结果列表中，清晰的展示了页面地址、以及层级路径（譬如 &lt;a href=&quot;https://you.com/search?q=%E5%80%BE%E5%9F%8E%E4%B9%8B%E9%93%BE&quot;&gt;nicelinks.site &amp;gt; about&lt;/a&gt;）。除了 Web 应用，适用于 iOS 和 Android 的应用程序，以及 Chrome 扩展。如果您对 you.com 感兴趣，可以参见 &lt;a href=&quot;https://nicelinks.site/redirect?url=https://about.you.com/hc-category/getting-started/&quot;&gt;You.com 入门&lt;/a&gt;。&lt;/p&gt;&lt;p&gt;── 出自&lt;a href=&quot;https://nicelinks.site/post/62d947dd65fb1506218fa5e5&quot;&gt;倾城之链 - You.com | The search engine you control&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;标签&lt;/strong&gt;：&lt;a href=&quot;https://nicelinks.site/tags/JavaScript&quot;&gt;&lt;code&gt;JavaScript&lt;/code&gt;&lt;/a&gt; · &lt;a href=&quot;https://nicelinks.site/tags/%E6%95%99%E7%A8%8B&quot;&gt;&lt;code&gt;教程&lt;/code&gt;&lt;/a&gt; · &lt;a href=&quot;https://nicelinks.site/tags/Web%E5%BC%80%E5%8F%91&quot;&gt;&lt;code&gt;Web开发&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;A quick reference to best practices for writing JavaScript -- links to code patterns and tutorials from around the web .&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://oss.nicelinks.site/jstherightway.org.png?x-oss-process=style/png2jpg&quot; alt=&quot;倾城之链 - JS: The Right Way&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;推荐语&lt;/strong&gt;：&lt;a href=&quot;https://nicelinks.site/redirect?url=https://jstherightway.org/&quot;&gt;JS: The Right Way&lt;/a&gt; 编写J avaScript 最佳实践的参考指南；该指南旨在向新开发人员介绍 JavaScript，并帮助有经验的开发人员，更多地了解其最佳实践。当然，该指南并不一定意味着执行 JavaScript 的“唯一方法”，它只是收集来自顶级开发人员的所有文章、提示和技巧，并将其放在这里。由于它来自杰出的人，可以说这是“正确的方式”，或者说是最好的方式。&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://nicelinks.site/redirect?url=https://jstherightway.org/&quot;&gt;JS: The Right Way&lt;/a&gt; 所涉及的内容非常丰富，包含：JavaScript 入门，代码风格、特色功能、设计模式、各种框架、测试工具、游戏引擎，以及相关方面的推荐文章、新闻。如果您从事，或打算从事 Web 前端开发，相信 &lt;a href=&quot;https://nicelinks.site/redirect?url=https://jstherightway.org/&quot;&gt;JS: The Right Way&lt;/a&gt; 都能带来或多或少的帮助。&lt;/p&gt;&lt;p&gt;── 出自&lt;a href=&quot;https://nicelinks.site/post/62d7f92a65fb1506218fa5e3&quot;&gt;倾城之链 - JS: The Right Way&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;标签&lt;/strong&gt;：&lt;a href=&quot;https://nicelinks.site/tags/%E5%BC%80%E6%BA%90&quot;&gt;&lt;code&gt;开源&lt;/code&gt;&lt;/a&gt; · &lt;a href=&quot;https://nicelinks.site/tags/CMS&quot;&gt;&lt;code&gt;CMS&lt;/code&gt;&lt;/a&gt; · &lt;a href=&quot;https://nicelinks.site/tags/API&quot;&gt;&lt;code&gt;API&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Strapi is the next-gen headless CMS, open-source, javascript, enabling content-rich experiences to be created, managed and exposed to any digital device.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://oss.nicelinks.site/strapi.io.png?x-oss-process=style/png2jpg&quot; alt=&quot;倾城之链 - Strapi - Open source Node.js Headless CMS 🚀&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;推荐语&lt;/strong&gt;：&lt;a href=&quot;https://nicelinks.site/redirect?url=https://strapi.io/&quot;&gt;Strapi&lt;/a&gt; 是一款免费的、领先的&lt;strong&gt;开源&lt;/strong&gt;无头（Headless） CMS，轻松构建可定制的 API，可在您需要的任何地方提供您的内容。它是 100% JavaScript，完全可定制和开发者优先。除此之外，它还具有以下功能特色：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;控制您的数据&lt;/strong&gt;：使用 Strapi，您可以知道您的数据存储在哪里，并始终保持完全控制。&lt;/li&gt;&lt;li&gt;&lt;strong&gt;自托管&lt;/strong&gt;：您可以按照自己的方式托管和扩展 Strapi 项目。您可以选择任何您想要的托管平台：AWS、Render、Netlify、Heroku、VPS 或专用服务器。您可以随着成长而扩展，100% 独立。&lt;/li&gt;&lt;li&gt;&lt;strong&gt;数据库不可知论&lt;/strong&gt;：Strapi 适用于 SQL 数据库。您可以选择您喜欢的数据库：PostgreSQL、MySQL、MariaDB 和 SQLite。&lt;/li&gt;&lt;li&gt;&lt;strong&gt;可定制&lt;/strong&gt;。您可以通过完全自定义 API、路由或插件来快速构建逻辑，以完美满足您的需求。&lt;/li&gt;&lt;li&gt;&lt;strong&gt;速度极快：&lt;/strong&gt; Strapi 建立在 Node.js 之上，提供了惊人的性能。&lt;/li&gt;&lt;li&gt;&lt;strong&gt;RESTful 或 GraphQL&lt;/strong&gt;：从任何客户端使用 API（React，Vue、Angular）、移动应用程序甚至物联网设备，使用 REST 或 GraphQL。&lt;/li&gt;&lt;li&gt;&lt;strong&gt;默认安全&lt;/strong&gt;：可重用策略、CORS、CSP、P3P、Xframe、XSS 等。&lt;/li&gt;&lt;li&gt;&lt;strong&gt;现代管理面板&lt;/strong&gt;：优雅、完全可定制且完全可扩展的管理面板。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;您可以使用如下&lt;strong&gt;快速启动&lt;/strong&gt;命令，安装 Strapi，并以立即创建一个 Strapi 项目：&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;# yarn
yarn create strapi-app my-project --quickstart

# npx
npx create-strapi-app my-project --quickstart
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;此命令生成一个具有默认功能（身份验证、权限、内容管理、内容类型构建器和文件上传）的全新项目。&lt;strong&gt;Quickstart 命令使用&lt;/strong&gt; SQLite 数据库安装 Strapi，该数据库用于开发中的原型设计。&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;Headless CMS 是什么&lt;/strong&gt;？Headless CMS 是一套内容管理系统，但它仅仅是管理内容的创造；好比写作，您只关注需要写什么就行，至于外观怎么去展示不用关心，系统将内容与展示外观分离（好比说 Markdown 之于内容）。对于有大量 WEB 内容的朋友来说，这些内容能够在不同的地方和渠道被重复使用。这个理念对于内容创作者来说意义非凡。具体体现在以下两个方面：&lt;/p&gt;&lt;p&gt;首先，Web 内容变得更加多样复杂，而且用户的期望在不断提高。 企业要在竞争中脱颖而出，需要构建出色、响应性高且具有互动性的内容，而且还要能够快速实施并发布。&lt;/p&gt;&lt;p&gt;第二，新的渠道和用户设备不断涌现。构建出色的内容并不足够，企业还需要确保尽可能高效地将其发布到任何位置。 Headless  CMS 意味着内容创作人员无需考虑Web界面设计而专注于构建出色的内容，而且它使企业的内容运营工作能够适应未来发展需求，将内容发布到任何渠道。&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;长期以来，大多数网站内容通过浏览器（通常是网页）发布。 但是新的互联设备层出不穷。如今，受众通过具有不同形状系数的新设备界面（例如智能手机、可穿戴设备、支持 AI 的语音助理、乃至虚拟现实耳机）使用内容。Headless CMS 架构，对于应对这些新的内容挑战，具有基础性的作用。这意味着您可以轻松创建和管理更多内容，并将其发布到更多位置。&lt;a href=&quot;https://nicelinks.site/redirect?url=https://strapi.io/&quot;&gt;Strapi&lt;/a&gt; 让开发人员可以自由使用他们最喜欢的工具和框架，同时允许编辑人员轻松管理他们的内容，并将其分发到任何地方。&lt;/p&gt;&lt;p&gt;── 出自&lt;a href=&quot;https://nicelinks.site/post/62d6a53a65fb1506218fa5e1&quot;&gt;倾城之链 - Strapi - Open source Node.js Headless CMS 🚀&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;标签&lt;/strong&gt;：&lt;a href=&quot;https://nicelinks.site/tags/CSS&quot;&gt;&lt;code&gt;CSS&lt;/code&gt;&lt;/a&gt; · &lt;a href=&quot;https://nicelinks.site/tags/JavaScript&quot;&gt;&lt;code&gt;JavaScript&lt;/code&gt;&lt;/a&gt; · &lt;a href=&quot;https://nicelinks.site/tags/%E8%AE%BE%E8%AE%A1&quot;&gt;&lt;code&gt;设计&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Articles all around CSS, JavaScript, front-end, UX and design. For designers and web developers.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://oss.nicelinks.site/www.smashingmagazine.com.png?x-oss-process=style/png2jpg&quot; alt=&quot;倾城之链 - Smashing Magazine — For Web Designers And DevelopersClear SearchBack to top&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;推荐语&lt;/strong&gt;： &lt;a href=&quot;https://nicelinks.site/redirect?url=https://www.smashingmagazine.com/&quot;&gt;Smashing Magazine&lt;/a&gt; ，于 2006 年 9 月在德国成立，为网页设计师和 Web 开发人员提供可靠、有用但最重要的实用文章，围绕 CSS、JavaScript、前端、用户体验和设计等方面（内容十分丰富）。该团队小而精，他们真正在意自己的工作，热情而专注，诚实和尊重；他们不关心趋势，关心在实际项目中成功或失败的事情；10 多年以来，始终坚持&lt;strong&gt;高质量的内容&lt;/strong&gt;，致力于提高生产力、提高设计、开发技能以及&lt;strong&gt;平衡工作与生活&lt;/strong&gt;。通过互相学习，一起变得更好——这就是该团队多年来，一直奉行的精神（&lt;code&gt;赞&lt;/code&gt;）。事实上，他们做到了，在这里读到了蛮多精品内容分享，如果您从事前端开发，或网页设计相关工作，Smashing 是非常值得关注的网站。&lt;/p&gt;&lt;p&gt;── 出自&lt;a href=&quot;https://nicelinks.site/post/62d69eb465fb1506218fa5df&quot;&gt;倾城之链 - Smashing Magazine — For Web Designers And DevelopersClear SearchBack to top&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;标签&lt;/strong&gt;：&lt;a href=&quot;https://nicelinks.site/tags/%E5%85%8D%E8%B4%B9&quot;&gt;&lt;code&gt;免费&lt;/code&gt;&lt;/a&gt; · &lt;a href=&quot;https://nicelinks.site/tags/%E8%B5%84%E6%BA%90&quot;&gt;&lt;code&gt;资源&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;关键字&lt;/strong&gt;：免费主机, 免费PHP主机, 免费虚拟空间, 免费 MYSQL 数据库, 永久免费空间, 海外免备案主机, freehost&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;免费主机（&lt;a href=&quot;http://www.freehost.cc%EF%BC%89%E6%8F%90%E4%BE%9B%E6%B0%B8%E4%B9%85%E5%85%8D%E8%B4%B9%E3%80%81%E5%85%8D%E5%A4%87%E6%A1%88%E7%9A%84%E6%B5%B7%E5%A4%96%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E7%A9%BA%E9%97%B4%EF%BC%8C%E9%85%8D%E7%BD%AE&quot;&gt;www.freehost.cc）提供永久免费、免备案的海外虚拟主机空间，配置&lt;/a&gt; PHP + Apache + MYSQL，10G 存储空间、每月 100G 流量，支持绑定独立域名，搭配简单易用的 cPanel 建站面板，是初期建站学习的最佳选择。&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://oss.nicelinks.site/www.freehost.cc.png?x-oss-process=style/png2jpg&quot; alt=&quot;倾城之链 - 免费主机（freehost.cc）提供永久免费、无广告的海外虚拟主机空间&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;推荐语&lt;/strong&gt;： &lt;a href=&quot;https://nicelinks.site/redirect?url=https://www.freehost.cc/&quot;&gt;freehost.cc&lt;/a&gt; 提供专业的免费主机服务，采用服务器集群技术，是互联网领先的免费云虚拟主机提供商。在这里注册的免费高速 PHP 主机和 MYSQL 数据库包含一个免费的二级域名，他提供一个强大的、且易于使用的控制面板来管理你的网站，这个控制面板包含几百个强大的功能，包含：一键建站工具、电子邮件、FTP 具，并且提供 SSH/HTTPS 来保护每一个域名。使用他们的免费主机服务您的个人网站，会更安全，以及更好的搜索引擎排名（以上内容，完全出自 freehost.cc 网站介绍，还未切实去体验，感兴趣的朋友，请自行判断）。&lt;/p&gt;&lt;p&gt;── 出自&lt;a href=&quot;https://nicelinks.site/post/62d5153f65fb1506218fa5dd&quot;&gt;倾城之链 - 免费主机（freehost.cc）提供永久免费、无广告的海外虚拟主机空间&lt;/a&gt;&lt;/p&gt;&lt;p&gt;对倾城之链感兴趣的朋友，可通过 Web，小程序，快应用等渠道进行访问(后续将支持更多，如 VsCode 插件，Chrome 扩展等)。您有任何问题，欢迎随时向我们反馈（您可以通过官网反馈渠道，或添加如下客服微信），🤲 。&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://image.nicelinks.site/%E5%80%BE%E5%9F%8E%E4%B9%8B%E9%93%BE-%E5%BE%AE%E4%BF%A1-mini.jpeg&quot; alt=&quot;倾城之链 - 客服微信&quot;/&gt;&lt;/p&gt;&lt;h2 id=&quot;本期文末寄语&quot;&gt;&lt;a href=&quot;#%E6%9C%AC%E6%9C%9F%E6%96%87%E6%9C%AB%E5%AF%84%E8%AF%AD&quot; aria-label=&quot;本期文末寄语 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;本期文末寄语&lt;/h2&gt;&lt;p&gt;可怜白雪曲，未遇知音人。&lt;br/&gt;恓惶戎旅下，蹉跎淮海滨。&lt;br/&gt;涧树含朝雨，山鸟哢馀春。&lt;br/&gt;&lt;strong&gt;我有一瓢酒，可以慰风尘&lt;/strong&gt;。&lt;br/&gt;──唐代 · 韦应物《简卢陟》&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://nicelinks.site/?utm_source=weekly&quot;&gt;倾城之链&lt;/a&gt;作为一个开放平台，旨在云集全球&lt;strong&gt;优秀网站&lt;/strong&gt;，探索互联网中更广阔的世界；在这里，你可以轻松发现、学习、分享更多有用或有趣的事物。&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://image.nicelinks.site/nicelinks-miniprogram-code.jpeg?imageView2/1/w/250/h/250/interlace/1/ignore-error/1&quot; alt=&quot;小程序码 - 倾城之链&quot;/&gt;&lt;/p&gt;&lt;h2 id=&quot;您可能感兴趣的文章&quot;&gt;&lt;a href=&quot;#%E6%82%A8%E5%8F%AF%E8%83%BD%E6%84%9F%E5%85%B4%E8%B6%A3%E7%9A%84%E6%96%87%E7%AB%A0&quot; aria-label=&quot;您可能感兴趣的文章 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; version=&quot;1.1&quot; viewbox=&quot;0 0 16 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;您可能感兴趣的文章&lt;/h2&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>9ef95452ba5f9fe36457f833900456c0</guid>
<title>聊聊 Kafka：协调者 GroupCoordinator 源码剖析之 FIND_COORDINATOR</title>
<link>https://toutiao.io/k/ghl5ia9</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                       &quot; id=&quot;js_content&quot;&gt;
            &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;我们上一篇讲的是 &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg3NDA1MTgwNA==&amp;amp;mid=2247487082&amp;amp;idx=1&amp;amp;sn=246b90252d90c17fb6f20ea3d5bb5edf&amp;amp;chksm=ced7efd9f9a066cffe8871afbdca21bed0a4286e5f60e873f914a94cac0c5895b4bc00dd4210&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;聊聊 Kafka：协调者 GroupCoordinator 源码剖析之实例化与启动 GroupCoordinator&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;聊聊 Kafka：协调者 GroupCoordinator 源码剖析之实例化与启动 GroupCoordinator&lt;/a&gt;，这一篇我们来讲讲聊聊 Kafka：协调者 GroupCoordinator 源码剖析之 FIND_COORDINATOR。&lt;span/&gt;&lt;/p&gt;&lt;section&gt;&lt;h2&gt;&lt;span&gt;四、ApiKeys.FIND_COORDINATOR&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;我们前面的文章说过，与消费组相关的两个组件，一个是消费者客户端的 ConsumerCoordinator，一个是 Kafka Broker 服务端的 GroupCoordinator。ConsumerCoordinator 负责与 GroupCoordinator 通信，Broker 启动的时候，都会启动一个 GroupCoordinator 实例，而一个集群中，会有多个 Broker，那么如何确定一个新的 Consumer 加入 Consumer Group 后，到底和哪个 Broker 上的 GroupCoordinator 进行交互呢？&lt;/p&gt;&lt;p&gt;这个问题就就交给服务端的 ApiKeys.FIND_COORDINATOR 命令来处理。&lt;/p&gt;&lt;h3&gt;&lt;span&gt;4.1 客户端源码分析&lt;/span&gt;&lt;/h3&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6027980535279805&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6F983Jmy8ucZTia14TYVyaqpibrx3vKx1D5YNQJV3HLpPmicR7zcrmOtw2w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;3288&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;/figure&gt;&lt;br/&gt;coordinator 即获取到的 group 节点对象，&lt;code&gt;client.isUnavailable(coordinator)&lt;/code&gt; 是在与 group 建立连接，每次判断 coordinator 不为空且 client 与 group 连接失败，则将 coordinator 置空，为什么会这样呢？很有可能是请求到 group 的信息之后发现该节点已下线或者不可用，此时服务端很有可能也在进行选举，所以我们需要将 coordinator 清空，待服务端选举完成后再次通信。&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6049079754601226&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6FrPa1sWVXpuH1JUdAmhOEKpbll91icTXAcznByvMmhcwl7nicrUFkdRvA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;3260&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;/figure&gt;&lt;br/&gt;如果通信一次发现该 GroupCoordinator 的信息还未获取到则继续重试，直到超时，这里的超时时间即为 poll 时传入的超时时间，这个时间设置贯穿了整个 consume 的运行代码。&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6734265734265734&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6FiaTRHQ7afsdSmFZwuR5NFib8esS28SOTLTl4EjH48r1aQBNuu08icBZ0Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2860&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;/figure&gt;&lt;br/&gt;我们来看看是如何寻找负载最小节点的，首先就是取随机数，防止每次都从第一个节点连接，如果判断没有在途的 request 则直接返回该节点，否则取在途 request 最小的节点，如果该节点不存在，则依次取连接的节点、需要重试的节点，如果找到不为 null 的节点则返回该节点，否则返回 null。&lt;h3&gt;&lt;span&gt;4.2 FindCoordinatorRequest 请求报文&lt;/span&gt;&lt;/h3&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.27282377919320594&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6FB1tibVUnmheXeeey8OibX3K9ib3XNbL8Vh9IibdTQ3CdqczicdItI1O4QWA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1884&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;br/&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.19448275862068964&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6FbQonR64U37rVM4iaAj1xMjdOMJA2yefCMiadCRgsu3LEdTDRnWnKX7cw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1450&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4218181818181818&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6Fmx7S0ECJ4hrLKqOkNicAOy2bddmasApcpzwQojRc7icib2iacmwxNdZw6A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1650&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;br/&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5462012320328542&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6FFWSKYoV6Yhxh071GqNo8h4eDaIfe6lKwabbIcbRZRt3GFPr1USEVAg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1948&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;br/&gt;key_type 有两种枚举，一种是 GROUP，另一种是 TRANSACTION，如果 type 为 GROUP 的话那 key 就是 groupId，反之是 transactionId。&lt;h3&gt;&lt;span&gt;4.3 服务端源码分析&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;直接看到 FIND_COORDINATOR 命令调用的方法 &lt;code&gt;kafka.server.KafkaApis#handleFindCoordinatorRequest&lt;/code&gt;&lt;/p&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.4378194207836457&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6F4woD4ia6e5BA0VSnEvJoQLBuBbNOXwJzMmRpjjyJvCftQhVCiadjibVMw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2348&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;/figure&gt;&lt;br/&gt;&lt;code&gt;kafka.coordinator.group.GroupMetadataManager#partitionFor&lt;/code&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;kotlin&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;def partitionFor(groupId: String): &lt;span class=&quot;code-snippet__built_in&quot;&gt;Int&lt;/span&gt; = Utils.abs(groupId.hashCode) % groupMetadataTopicPartitionCount&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;/&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;val&lt;/span&gt; groupMetadataTopicPartitionCount = getGroupMetadataTopicPartitionCount&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;private&lt;/span&gt; def getGroupMetadataTopicPartitionCount: &lt;span class=&quot;code-snippet__built_in&quot;&gt;Int&lt;/span&gt; = {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  zkClient.getTopicPartitionCount(Topic.GROUP_METADATA_TOPIC_NAME).getOrElse(config.offsetsTopicNumPartitions)&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;val&lt;/span&gt; DefaultOffsetsTopicNumPartitions = &lt;span class=&quot;code-snippet__number&quot;&gt;50&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;code&gt;__consumer_offsets&lt;/code&gt; 这个内部 Topic，专门用来存储 Consumer Group 消费的情况，内置 Topic 初始化时由 &lt;code&gt;offsets.topic.num.partitions&lt;/code&gt; 参数来决定分区数，默认值是 50。相同 Consumer Group 的 offset 最终会保存在其中一个分区中，而保存在哪个分区就由上面这段代码来决定，可以看到逻辑很简单，就是取 groupId 的 hashCode，然后对总的分区数取模。&lt;/p&gt;&lt;p&gt;举个例子，假设一个 GroupId 计算出来的 hashCode 是 8，之后取模 50 得到 8。那么 partition-8 的 leader 所在的 broker 就是我们要找的那个节点。这个 Consumer Group 后面都会直接在 partition-8 分区保存位点。&lt;/p&gt;&lt;p&gt;&lt;code&gt;kafka.server.KafkaApis#getOrCreateInternalTopic&lt;/code&gt;&lt;/p&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.1721611721611722&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6FNCs7xkT4X4Hv0jCYs8DnPQDh0Vhd0ynJafw5lk7h2qSUzkug09BibAQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1638&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;首先从当前 node 的元数据缓存中拿到对应 topic 的数据，如果没有，则创建。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;注意：kafka 创建 topic 是需要时间的，而这里的实现方式是往 zk 中写入数据触发创建 topic 流程，是一种异步方式，往 zk 中写入数据之后会返回一个 error，LEADER_NOT_AVAILABLE，待创建 topic 的流程走完，并同步各个节点 metaData 之后，最后从 metaData 中取到该节点信息 findCoordinatorRequest 才会成功返回。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;&lt;span&gt;4.4 FindCoordinatorResponse 响应报文&lt;/span&gt;&lt;/h3&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6464088397790055&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6FpjEdiaPHlgcTvba9dEvXFjIt6k0HeLJ2pEknIoR31AoIMl5Eo67GFJg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1448&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;br/&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.32754010695187163&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6FpxgFecpYFljuraHUVica3XhK6bRG80xV96sFIp4M8EohWGGTwOibvDibw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1496&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3&gt;&lt;span&gt;4.5 小结&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;总体分析下来，主要流程如下图所示：&lt;/p&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6960444136016655&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qK2eibTaic1WwGjaR64wKAg6FHqOIjvOjiaE6BuEh0eiagolUjd9ygqYBonunPHakYoeSzpLhRCTibuejw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2882&quot; title=&quot;在这里插入图片描述&quot;/&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;hr/&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span data-darkmode-bgcolor-16477831276806=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16477831276806=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16477831276806=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16477831276806=&quot;#fff|rgb(53, 53, 53)&quot; data-style=&quot;margin: 0px; padding: 0px; outline: 0px; max-width: 100%; background-color: rgb(255, 255, 255); color: rgb(53, 53, 53); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: 0.544px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 16px; text-align: start; font-family: &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, 黑体, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__7&quot; data-darkmode-bgcolor-16487444041949=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16487444041949=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16487444041949=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16487444041949=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16496839375872=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16496839375872=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16496839375872=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16496839375872=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-color-16514157760684=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16514157760684=&quot;#fff|rgb(62, 62, 62)|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16514157760684=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16514157760684=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16523678600428=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16523678600428=&quot;#fff|rgb(62, 62, 62)|rgb(62, 62, 62)|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16523678600428=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16523678600428=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16538336827459=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16538336827459=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16538336827459=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16538336827459=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-color-16545233284494=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16545233284494=&quot;#fff|rgb(62, 62, 62)|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16545233284494=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16545233284494=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16559903728502=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16559903728502=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16559903728502=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16559903728502=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16570351966348=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16570351966348=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16570351966348=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16570351966348=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16584090139606=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16584090139606=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16584090139606=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16584090139606=&quot;#fff|rgb(53, 53, 53)&quot;&gt;欢迎大家关注我的公众号&lt;/span&gt;&lt;span data-darkmode-bgcolor-16338773239656=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16338773239656=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16338773239656=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16338773239656=&quot;#fff|rgb(77, 77, 77)&quot; data-style=&quot;margin: 0px; padding: 0px; outline: 0px; max-width: 100%; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: 0.544px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 16px; text-align: start; font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei UI&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__8&quot; data-darkmode-color-16363833270363=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16363833270363=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16363833270363=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16363833270363=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16388856250974=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16388856250974=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16388856250974=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16388856250974=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16397576800587=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16397576800587=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16397576800587=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16397576800587=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16419173777418=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16419173777418=&quot;#fff|rgb(62, 62, 62)|rgb(53, 53, 53)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16419173777418=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16419173777418=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16423427337853=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16423427337853=&quot;#fff|rgb(62, 62, 62)|rgb(62, 62, 62)|rgb(53, 53, 53)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16423427337853=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16423427337853=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16477831276806=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16477831276806=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16477831276806=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16477831276806=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16487444041949=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16487444041949=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16487444041949=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16487444041949=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16496839375872=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16496839375872=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16496839375872=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16496839375872=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-color-16514157760684=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16514157760684=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16514157760684=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16514157760684=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16523678600428=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16523678600428=&quot;#fff|rgb(62, 62, 62)|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16523678600428=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16523678600428=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16538336827459=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16538336827459=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16538336827459=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16538336827459=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-color-16545233284494=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16545233284494=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16545233284494=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16545233284494=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16559903728502=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16559903728502=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16559903728502=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16559903728502=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16570351966348=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16570351966348=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16570351966348=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16570351966348=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16584090139606=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16584090139606=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16584090139606=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16584090139606=&quot;#fff|rgb(77, 77, 77)&quot;&gt;【&lt;/span&gt;&lt;span data-darkmode-bgcolor-16338773239656=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16338773239656=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16338773239656=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16338773239656=&quot;#fff|rgb(0, 82, 255)&quot; data-style=&quot;margin: 0px; padding: 0px; outline: 0px; max-width: 100%; background-color: rgb(255, 255, 255); color: rgb(0, 82, 255); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: 0.544px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 16px; text-align: start; font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei UI&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__9&quot; data-darkmode-color-16363833270363=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16363833270363=&quot;#fff|rgb(62, 62, 62)|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16363833270363=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16363833270363=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16388856250974=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16388856250974=&quot;#fff|rgb(62, 62, 62)|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16388856250974=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16388856250974=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16397576800587=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16397576800587=&quot;#fff|rgb(62, 62, 62)|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16397576800587=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16397576800587=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16419173777418=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16419173777418=&quot;#fff|rgb(62, 62, 62)|rgb(53, 53, 53)|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16419173777418=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16419173777418=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16423427337853=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16423427337853=&quot;#fff|rgb(62, 62, 62)|rgb(62, 62, 62)|rgb(53, 53, 53)|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16423427337853=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16423427337853=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16477831276806=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16477831276806=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16477831276806=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16477831276806=&quot;#fff|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16487444041949=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16487444041949=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16487444041949=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16487444041949=&quot;#fff|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16496839375872=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16496839375872=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16496839375872=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16496839375872=&quot;#fff|rgb(0, 82, 255)&quot; data-darkmode-color-16514157760684=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16514157760684=&quot;#fff|rgb(62, 62, 62)|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16514157760684=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16514157760684=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16523678600428=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16523678600428=&quot;#fff|rgb(62, 62, 62)|rgb(62, 62, 62)|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16523678600428=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16523678600428=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16538336827459=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16538336827459=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16538336827459=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16538336827459=&quot;#fff|rgb(0, 82, 255)&quot; data-darkmode-color-16545233284494=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16545233284494=&quot;#fff|rgb(62, 62, 62)|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16545233284494=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16545233284494=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16559903728502=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16559903728502=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16559903728502=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16559903728502=&quot;#fff|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16570351966348=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16570351966348=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16570351966348=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16570351966348=&quot;#fff|rgb(0, 82, 255)&quot; data-darkmode-bgcolor-16584090139606=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16584090139606=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16584090139606=&quot;rgb(0, 104, 255)&quot; data-darkmode-original-color-16584090139606=&quot;#fff|rgb(0, 82, 255)&quot;&gt;老周聊架构&lt;/span&gt;&lt;span data-darkmode-bgcolor-16338773239656=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16338773239656=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16338773239656=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16338773239656=&quot;#fff|rgb(77, 77, 77)&quot; data-style=&quot;margin: 0px; padding: 0px; outline: 0px; max-width: 100%; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: 0.544px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 16px; text-align: start; font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei UI&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__10&quot; data-darkmode-color-16363833270363=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16363833270363=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16363833270363=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16363833270363=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16388856250974=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16388856250974=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16388856250974=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16388856250974=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16397576800587=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16397576800587=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16397576800587=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16397576800587=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16419173777418=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16419173777418=&quot;#fff|rgb(62, 62, 62)|rgb(53, 53, 53)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16419173777418=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16419173777418=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16423427337853=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16423427337853=&quot;#fff|rgb(62, 62, 62)|rgb(62, 62, 62)|rgb(53, 53, 53)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16423427337853=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16423427337853=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16477831276806=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16477831276806=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16477831276806=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16477831276806=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16487444041949=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16487444041949=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16487444041949=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16487444041949=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16496839375872=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16496839375872=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16496839375872=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16496839375872=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-color-16514157760684=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16514157760684=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16514157760684=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16514157760684=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16523678600428=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16523678600428=&quot;#fff|rgb(62, 62, 62)|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16523678600428=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16523678600428=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16538336827459=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16538336827459=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16538336827459=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16538336827459=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-color-16545233284494=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16545233284494=&quot;#fff|rgb(62, 62, 62)|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16545233284494=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16545233284494=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16559903728502=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16559903728502=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16559903728502=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16559903728502=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16570351966348=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16570351966348=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16570351966348=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16570351966348=&quot;#fff|rgb(77, 77, 77)&quot; data-darkmode-bgcolor-16584090139606=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16584090139606=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16584090139606=&quot;rgb(153, 153, 153)&quot; data-darkmode-original-color-16584090139606=&quot;#fff|rgb(77, 77, 77)&quot;&gt;】，&lt;/span&gt;&lt;span data-darkmode-bgcolor-16477831276806=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16477831276806=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16477831276806=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16477831276806=&quot;#fff|rgb(53, 53, 53)&quot; data-style=&quot;margin: 0px; padding: 0px; outline: 0px; max-width: 100%; background-color: rgb(255, 255, 255); color: rgb(53, 53, 53); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: 0.544px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; font-size: 16px; text-align: start; font-family: &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, 黑体, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__11&quot; data-darkmode-bgcolor-16487444041949=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16487444041949=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16487444041949=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16487444041949=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16496839375872=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16496839375872=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16496839375872=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16496839375872=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-color-16514157760684=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16514157760684=&quot;#fff|rgb(62, 62, 62)|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16514157760684=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16514157760684=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16523678600428=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16523678600428=&quot;#fff|rgb(62, 62, 62)|rgb(62, 62, 62)|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16523678600428=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16523678600428=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16538336827459=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16538336827459=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16538336827459=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16538336827459=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-color-16545233284494=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16545233284494=&quot;#fff|rgb(62, 62, 62)|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16545233284494=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16545233284494=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16559903728502=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16559903728502=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16559903728502=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16559903728502=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16570351966348=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16570351966348=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16570351966348=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16570351966348=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16584090139606=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16584090139606=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16584090139606=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16584090139606=&quot;#fff|rgb(53, 53, 53)&quot;&gt;&lt;span data-raw-text=&quot;J&quot; data-textnode-index-1646230222184=&quot;67&quot; data-index-1646230222184=&quot;1452&quot; data-darkmode-bgcolor-16477831276806=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16477831276806=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16477831276806=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16477831276806=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16487444041949=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16487444041949=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16487444041949=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16487444041949=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16496839375872=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16496839375872=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16496839375872=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16496839375872=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-color-16514157760684=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16514157760684=&quot;#fff|rgb(62, 62, 62)|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16514157760684=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16514157760684=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16523678600428=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16523678600428=&quot;#fff|rgb(62, 62, 62)|rgb(62, 62, 62)|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16523678600428=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16523678600428=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16538336827459=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16538336827459=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16538336827459=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16538336827459=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-color-16545233284494=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16545233284494=&quot;#fff|rgb(62, 62, 62)|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16545233284494=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16545233284494=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16559903728502=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16559903728502=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16559903728502=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16559903728502=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16570351966348=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16570351966348=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16570351966348=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16570351966348=&quot;#fff|rgb(53, 53, 53)&quot; data-darkmode-bgcolor-16584090139606=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16584090139606=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16584090139606=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16584090139606=&quot;#fff|rgb(53, 53, 53)&quot;&gt;Java后端主流技术&lt;/span&gt;栈的原理、源码分析、架构以及各种互联网高并发、高性能、高可用的解决方案。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;Mzg3NDA1MTgwNA==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/80icw67Ot0qKIibpDGuCNF06Nr4uOxRUJwEFFuIQuuoSJAt4KJj5KUI1AgOpOez2QFYg5rbupg8NrGQvmk6jedzQ/0?wx_fmt=png&quot; data-nickname=&quot;老周聊架构&quot; data-alias=&quot;&quot; data-signature=&quot;Java后端主流技术栈的原理、源码分析、架构以及各种互联网高并发、高性能、高可用的解决方案。&quot; data-from=&quot;0&quot;/&gt;&lt;span/&gt;&lt;/section&gt;&lt;/section&gt;
          &lt;/div&gt;

          

          



           
                                
                    
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>b685e64e227dc2841f1a99ef345ca381</guid>
<title>Canvas 从入门到劝朋友放弃（图解版）</title>
<link>https://toutiao.io/k/z8mcoqf</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;本文简介&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;点赞 + 关注 + 收藏 = 学会了&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在前端领域，如果只是懂 &lt;code&gt;Vue&lt;/code&gt; 或者 &lt;code&gt;React&lt;/code&gt; ，未来在职场的竞争力可能会比较弱。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;根据我多年在家待业经验来看，前端未来在 &lt;code&gt;数据可视化&lt;/code&gt; 和 &lt;code&gt;AI&lt;/code&gt; 这两个领域会比较香，而 &lt;code&gt;Canvas&lt;/code&gt; 是数据可视化在前端方面的基础技术。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本文就用光的速度将 &lt;code&gt;canvas&lt;/code&gt; 给入门了。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9130434782608695&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt959kxhgf5stYRlZMgxVWia3tIkYaf4tqQJPxLy8revgFPtibSdor60FQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;138&quot;/&gt;&lt;figcaption&gt;01.gif&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;要入门一个技术，前期最重要是快！所以本文只讲入门内容，能应付简单项目。深入的知识点会在其他文章讲解。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Canvas 是什么？&lt;/span&gt;&lt;/h1&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;Canvas&lt;/code&gt; 中文名叫 “画布”，是 &lt;code&gt;HTML5&lt;/code&gt; 新增的一个标签。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;Canvas&lt;/code&gt; 允许开发者通过 &lt;code&gt;JS&lt;/code&gt;在这个标签上绘制各种图案。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;Canvas&lt;/code&gt; 拥有多种绘制路径、矩形、圆形、字符以及图片的方法。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;Canvas&lt;/code&gt; 在某些情况下可以 “代替” 图片。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;Canvas&lt;/code&gt; 可用于动画、游戏、数据可视化、图片编辑器、实时视频处理等领域。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Canvas 和 SVG 的区别&lt;/span&gt;&lt;/h1&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Canvas&lt;/th&gt;&lt;th&gt;SVG&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;用JS动态生成元素（一个HTML元素）&lt;/td&gt;&lt;td&gt;用XML描述元素（类似HTML元素那样，可用多个元素来描述一个图形）&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;位图（受屏幕分辨率影响）&lt;/td&gt;&lt;td&gt;矢量图（不受屏幕分辨率影响）&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;不支持事件&lt;/td&gt;&lt;td&gt;支持事件&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;数据发生变化需要重绘&lt;/td&gt;&lt;td&gt;不需要重绘&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;就上面的描述而言可能有点难懂，你可以打开 &lt;code&gt;AntV&lt;/code&gt; 旗下的图形编辑引擎做对比。&lt;span&gt;G6&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt; 是使用 &lt;code&gt;canvas&lt;/code&gt; 开发的，&lt;span&gt;X6&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt; 是使用 &lt;code&gt;svg&lt;/code&gt; 开发的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我的建议是：如果要展示的数据量比较大，比如一条数据就是一个元素节点，那使用 &lt;code&gt;canvas&lt;/code&gt; 会比较合适；如果用户操作的交互比较多，而且对清晰度有要求（矢量图），那么使用 &lt;code&gt;svg&lt;/code&gt; 会比较合适。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;起步&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;学习前端一定要动手敲代码，然后看效果展示。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;起步阶段会用几句代码说明 &lt;code&gt;canvas&lt;/code&gt; 如何使用，本例会画一条直线。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;画条直线&lt;/span&gt;&lt;/h2&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;在 &lt;code&gt;HTML&lt;/code&gt; 中创建 &lt;code&gt;canvas&lt;/code&gt; 元素&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;通过 &lt;code&gt;js&lt;/code&gt; 获取 &lt;code&gt;canvas&lt;/code&gt; 标签&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;从 &lt;code&gt;canvas&lt;/code&gt; 标签中获取到绘图工具&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;通过绘图工具，在 &lt;code&gt;canvas&lt;/code&gt; 标签上绘制图形&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6823899371069182&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAticibJGEuCfBn49I1S6T6Yh0fYXEqmExjLtw9cK3eDIHFIXibR5jsm8Ntg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;318&quot;/&gt;&lt;figcaption&gt;02.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;!-- 1、创建 canvas 元素 --&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;200&quot;&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&lt;br/&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;// 2、获取 canvas 对象&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 3、获取 canvas 上下文环境对象&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 4、绘制图形&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;) &lt;span&gt;// 起点坐标 (x, y)&lt;/span&gt;&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;) &lt;span&gt;// 终点坐标 (x, y)&lt;/span&gt;&lt;br/&gt;  cxt.stroke() &lt;span&gt;// 将起点和终点连接起来&lt;/span&gt;&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;moveTo&lt;/code&gt; 、 &lt;code&gt;lineTo&lt;/code&gt; 和 &lt;code&gt;stroke&lt;/code&gt; 方法暂时可以不用管，它们的作用是绘制图形，这些方法在后面会讲到~&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;注意点&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;1、默认宽高&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;canvas&lt;/code&gt; 有 &lt;strong&gt;默认的 宽度(300px) 和 高度(150px)&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果不在 &lt;code&gt;canvas&lt;/code&gt; 上设置宽高，那 &lt;code&gt;canvas&lt;/code&gt; 元素的默认宽度是300px，默认高度是150px。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;2、设置 canvas 宽高&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;canvas&lt;/code&gt; 元素提供了 &lt;code&gt;width&lt;/code&gt; 和 &lt;code&gt;height&lt;/code&gt; 两个属性，可设置它的宽高。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;需要注意的是，这两个属性只需传入数值，不需要传入单位（比如 &lt;code&gt;px&lt;/code&gt; 等）。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;600&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;400&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;3、不能通过 CSS 设置画布的宽高&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;css&lt;/code&gt; 设置 &lt;code&gt;canvas&lt;/code&gt; 的宽高，会出现 &lt;strong&gt;内容被拉伸&lt;/strong&gt; 的后果！！！&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.0023866348448687&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtwscBqmOpDiad9gLsnbjPSmZQickZ6FKXZCQGQZgAULibqgicibCIVMzH7UQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;419&quot;/&gt;&lt;figcaption&gt;03.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;style&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;#c&lt;/span&gt; {&lt;br/&gt;    &lt;span&gt;width&lt;/span&gt;: &lt;span&gt;400px&lt;/span&gt;;&lt;br/&gt;    &lt;span&gt;height&lt;/span&gt;: &lt;span&gt;400px&lt;/span&gt;;&lt;br/&gt;    &lt;span&gt;border&lt;/span&gt;: &lt;span&gt;1px&lt;/span&gt; solid &lt;span&gt;#ccc&lt;/span&gt;;&lt;br/&gt;  }&lt;br/&gt;&amp;lt;/&lt;span&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;// 1、获取canvas对象&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 2、获取canvas上下文环境对象&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 3、绘制图形&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;) &lt;span&gt;// 起点&lt;/span&gt;&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;) &lt;span&gt;// 终点&lt;/span&gt;&lt;br/&gt;  cxt.stroke() &lt;span&gt;// 将起点和终点连接起来&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;console&lt;/span&gt;.log(cnv.width) &lt;span&gt;// 获取 canvas 的宽度，输出：300&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;console&lt;/span&gt;.log(cnv.height) &lt;span&gt;// 获取 canvas 的高度，输出：150&lt;/span&gt;&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;canvas&lt;/code&gt; 的默认宽度是300px，默认高度是150px。&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;如果使用 &lt;code&gt;css&lt;/code&gt; 修改 &lt;code&gt;canvas&lt;/code&gt; 的宽高（比如本例变成 400px * 400px），那宽度就由 300px 拉伸到 400px，高度由 150px 拉伸到 400px。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;使用 &lt;code&gt;js&lt;/code&gt; 获取 &lt;code&gt;canvas&lt;/code&gt; 的宽高，此时返回的是 &lt;code&gt;canvas&lt;/code&gt; 的默认值。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最后出现的效果如上图所示。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;4、线条默认宽度和颜色&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;线条的默认宽度是 &lt;code&gt;1px&lt;/code&gt; ，默认颜色是黑色。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但由于默认情况下 &lt;code&gt;canvas&lt;/code&gt; 会将线条的中心点和像素的底部对齐，所以会导致显示效果是 &lt;code&gt;2px&lt;/code&gt; 和非纯黑色问题。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;5、IE兼容性高&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;暂时只有 &lt;code&gt;IE 9&lt;/code&gt; 以上才支持 &lt;code&gt;canvas&lt;/code&gt; 。但好消息是 &lt;code&gt;IE&lt;/code&gt; 已经有自己的墓碑了。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如需兼容 &lt;code&gt;IE 7 和 8&lt;/code&gt; ，可以使用 &lt;span&gt;ExplorerCanvas&lt;/span&gt;&lt;sup&gt;[3]&lt;/sup&gt; 。但即使是使用了 &lt;code&gt;ExplorerCanvas&lt;/code&gt; 仍然会有所限制，比如无法使用 &lt;code&gt;fillText()&lt;/code&gt; 方法等。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;基础图形&lt;/span&gt;&lt;/h1&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;坐标系&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在绘制基础图形之前，需要先搞清除 &lt;code&gt;Canvas&lt;/code&gt; 使用的坐标系。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;Canvas&lt;/code&gt; 使用的是 &lt;strong&gt;W3C 坐标系&lt;/strong&gt; ，也就是遵循我们屏幕、报纸的阅读习惯，从上往下，从左往右。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.75&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAty7I3tpVp08RZLst20YGbe63OYfb7lG6Gze9A49P50TYxYyI3NO7oeA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1440&quot;/&gt;&lt;figcaption&gt;04.jpg&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;W3C 坐标系&lt;/strong&gt; 和 &lt;strong&gt;数学直角坐标系&lt;/strong&gt; 的 &lt;code&gt;X轴&lt;/code&gt; 是一样的，只是 &lt;code&gt;Y轴&lt;/code&gt; 的反向相反。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;W3C 坐标系&lt;/strong&gt; 的 &lt;code&gt;Y轴&lt;/code&gt; 正方向向下。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;直线&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;一条直线&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;最简单的起步方式是画一条直线。这里所说的 “直线” 是几何学里的 “线段” 的意思。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;需要用到这3个方法：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;moveTo(x1, y1)&lt;/code&gt;：起点坐标 (x, y)&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;lineTo(x2, y2)&lt;/code&gt;：下一个点的坐标 (x, y)&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;stroke()&lt;/code&gt;：将所有坐标用一条线连起来&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;起步阶段可以先这样理解。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.534375&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt2PhPIVJic8DFgXzYGhGt2TdXNJ9zUicNvMYyc2ls80ahRmw228qKfP0g/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;320&quot;/&gt;&lt;figcaption&gt;05.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 绘制直线&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;) &lt;span&gt;// 起点坐标&lt;/span&gt;&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;) &lt;span&gt;// 下一个点的坐标&lt;/span&gt;&lt;br/&gt;  cxt.stroke() &lt;span&gt;// 将上面的坐标用一条线连接起来&lt;/span&gt;&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面的代码所呈现的效果，可以看下图解释（手不太聪明，画得不是很标准，希望能看懂）&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5594771241830065&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtibelqAUMHPZnxRNhqq4oDO4kWUBFV9Lqu1iaiawT45p7niatCWDHdVBX3g/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1530&quot;/&gt;&lt;figcaption&gt;06.jpg&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;多条直线&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如需画多条直线，可以用会上面那几个方法。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9937106918238994&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtu9iavIJb4AjGeUfBaGoFsUBmhfbboFUsFq9eCaZaNVyuW90R93yElUg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;318&quot;/&gt;&lt;figcaption&gt;07.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;仔细观察一下，为什么两条线的粗细不一样的？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;明明使用的方法都是一样的，只是第二条直线的 &lt;code&gt;Y轴&lt;/code&gt; 的值是有小数点。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;答：&lt;strong&gt;默认情况下 &lt;code&gt;canvas&lt;/code&gt; 会将线条的中心点和像素的底部对齐，所以会导致显示效果是 &lt;code&gt;2px&lt;/code&gt; 和非纯黑色问题。&lt;/strong&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.75&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtcpNiabian3ibEJiaTKpnoTeQ3vG2qcricZnWU6cRN8W9AhMos1c9TIyzkXA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1440&quot;/&gt;&lt;figcaption&gt;08.jpg&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上图每个格子代表 &lt;code&gt;1px&lt;/code&gt;。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;线的中心点会和画布像素点的底部对齐&lt;/strong&gt;，所以会线中间是黑色的，但由于一个像素就不能再切割了，所以会有半个像素被染色，就变成了浅灰色。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所以如果你设置的 &lt;code&gt;Y轴&lt;/code&gt; 值是一个整数，就会出现上面那种情况。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;设置样式&lt;/span&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;lineWidth&lt;/code&gt;：线的粗细&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;strokeStyle&lt;/code&gt;：线的颜色&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;lineCap&lt;/code&gt;：线帽：默认: &lt;code&gt;butt&lt;/code&gt;; 圆形: &lt;code&gt;round&lt;/code&gt;; 方形: &lt;code&gt;square&lt;/code&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5235109717868338&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtpf76Oe6kbQibnicVoVFXWibqoVIQzcYpa36ibjoJhfQU63Xem0D3WtX6nQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;319&quot;/&gt;&lt;figcaption&gt;09.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 绘制直线&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 修改直线的宽度&lt;/span&gt;&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 修改直线的颜色&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 修改直线两端样式&lt;/span&gt;&lt;br/&gt;  cxt.lineCap = &lt;span&gt;&#x27;round&#x27;&lt;/span&gt; &lt;span&gt;// 默认: butt; 圆形: round; 方形: square&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;新开路径&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;开辟新路径的方法：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在绘制多条线段的同时，还要设置线段样式，通常需要开辟新路径。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;要不然样式之间会相互污染。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如这样&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtHxqgHFbOBUsiaYkmfHJsONkiaLrHNlm6eOmYMd9duIuDcrqEkTjcAX5Q/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;319&quot;/&gt;&lt;figcaption&gt;10.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 第一条线&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;10&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 第二条线&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果不想相互污染，需要做2件事：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;使用 &lt;code&gt;beginPath()&lt;/code&gt; 方法，重新开一个路径&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;设置新线段的样式（必须项）&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果上面2步却了其中1步都会有影响。&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;只使用 &lt;code&gt;beginPath()&lt;/code&gt;&lt;/span&gt;&lt;/h4&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.0031446540880504&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtpUE3A2LyFr9j4TCSvAIHXfEPVVqtFzOT5KFLf3xpdlicUicxtHbic1FRQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;318&quot;/&gt;&lt;figcaption&gt;11.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 第一条线&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;10&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 第二条线&lt;/span&gt;&lt;br/&gt;  cxt.beginPath() &lt;span&gt;// 重新开启一个路径&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;第一条线的样式会影响之后的线。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但如果使用了 &lt;code&gt;beginPath()&lt;/code&gt; ，后面的线段不会影响前面的线段。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.0063091482649842&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt85R0y2gmFFAcghslOxMhKiasTnCCMq3zibd2iaCq7M89EAKgUlYWEAbyQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;317&quot;/&gt;&lt;figcaption&gt;12.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 第一条线&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 第二条线&lt;/span&gt;&lt;br/&gt;  cxt.beginPath() &lt;span&gt;// 重新开启一个路径&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;4&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;red&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;设置新线段的样式，没使用 &lt;code&gt;beginPath()&lt;/code&gt; 的情况&lt;/span&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个情况会反过来，后面的线能影响前面的线。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtk9orwIdJmeaQ7LhEsoianYL4qXzUccedm64DK4ycqOzAcn6tLqNhpPg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;318&quot;/&gt;&lt;figcaption&gt;13.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 第一条线&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;10&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 第二条线&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;4&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;red&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;正确的做法&lt;/span&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在设置 &lt;code&gt;beginPath()&lt;/code&gt; 的同时，也各自设置样式。这样就能做到相互不影响了。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.0063291139240507&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtuzzt2qnuPmpibicFr2mGxa5VjPOQqlllfwsZTMc94wLFqKB7JSDuZftA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;316&quot;/&gt;&lt;figcaption&gt;14.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;10&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  cxt.beginPath() &lt;span&gt;// 重新开启一个路径&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;20&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;120.5&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;4&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;red&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;折线&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;和 &lt;strong&gt;直线&lt;/strong&gt; 差不多，都是使用 &lt;code&gt;moveTo()&lt;/code&gt; 、&lt;code&gt;lineTo()&lt;/code&gt; 和 &lt;code&gt;stroke()&lt;/code&gt; 方法可以绘制折线。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtE0hMB5Wn2KbCFjRlQkfRNnCE4BwObf7CB0huct3EMRppo8uJfcU94g/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;319&quot;/&gt;&lt;figcaption&gt;15.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;画这种折线，最好在草稿纸上画一个坐标系，自己计算并描绘一下每个点大概在什么什么位置，最后在 &lt;code&gt;canvas&lt;/code&gt; 中看看效果。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;矩形&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;根据前面的基础，我们可以 &lt;strong&gt;使用线段来描绘矩形&lt;/strong&gt;，但 &lt;code&gt;canvas&lt;/code&gt; 也提供了 &lt;code&gt;rect()&lt;/code&gt; 等方法可以直接生成矩形。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;使用线段描绘矩形&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以使用前面画线段的方法来绘制矩形&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;1.0031446540880504&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt2eo3ov4ZgCfOZ7TUOdfGNkUKWqdPlLvMpdJibbx04VoY02PAjA0ciciaQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;318&quot;/&gt;&lt;figcaption&gt;16.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;canvas id=&quot;c&quot; width=&quot;300&quot; height=&quot;300&quot; style=&quot;border: 1px solid #ccc;&quot;&amp;gt;&lt;span&gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt; &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt; &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt; &lt;span&gt;// 绘制矩形&lt;/span&gt;&lt;br/&gt; cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt; cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt; cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;120&lt;/span&gt;)&lt;br/&gt; cxt.lineTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;120&lt;/span&gt;)&lt;br/&gt; cxt.lineTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;) &lt;span&gt;// 需要闭合，又或者使用 closePath() 方法进行闭合，推荐使用 closePath()&lt;/span&gt;&lt;br/&gt;&lt;br/&gt; cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面的代码几个点分别对应下图。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6402664692820134&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtOGicFX9wwib8L6D5IjB0f8ltExmHtgCkt6TY7kbK8Dgtd93VSuCSticZQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1351&quot;/&gt;&lt;figcaption&gt;17.jpg&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;使用 &lt;code&gt;strokeRect()&lt;/code&gt; 描边矩形&lt;/span&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;strokeStyle&lt;/code&gt;：设置描边的属性（颜色、渐变、图案）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;strokeRect(x, y, width, height)&lt;/code&gt;：描边矩形（x和y是矩形左上角起点；width 和 height 是矩形的宽高）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;strokeStyle&lt;/code&gt; 必须写在 &lt;code&gt;strokeRect()&lt;/code&gt; 前面，不然样式不生效。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9937304075235109&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtMvJZhbUczNEsWc6Bzxiaa3UAppJbOSWokXlhsZlZndyP1BaHkdAnqicQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;319&quot;/&gt;&lt;figcaption&gt;18.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// strokeStyle 属性&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;// strokeRect(x, y, width, height) 方法&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.strokeRect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面的代码可以这样理解&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6402664692820134&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtW0ADkCichibQ3jOJXvDOlGCrQm3HRIad18ZiahKYGlxoyNPqLLjxyBYdA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1351&quot;/&gt;&lt;figcaption&gt;19.jpg&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;使用 &lt;code&gt;fillRect()&lt;/code&gt; 填充矩形&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;fillRect()&lt;/code&gt; 和 &lt;code&gt;strokeRect()&lt;/code&gt; 方法差不多，但 &lt;code&gt;fillRect()&lt;/code&gt; 的作用是填充。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;需要注意的是，&lt;code&gt;fillStyle&lt;/code&gt; 必须写在 &lt;code&gt;fillRect()&lt;/code&gt; 之前，不然样式不生效。&lt;/strong&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt7iaiaqDLK3aSm0WRcOibcJedd388QNYTUGZp09kg9QryibjwoWRZ6ibxdSQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;318&quot;/&gt;&lt;figcaption&gt;20.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// fillStyle 属性&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;// fillRect(x, y, width, height) 方法&lt;/span&gt;&lt;br/&gt;  cxt.fillStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillRect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;) &lt;span&gt;// fillRect(x, y, width, height)&lt;/span&gt;&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;同时使用 &lt;code&gt;strokeRect()&lt;/code&gt; 和 &lt;code&gt;fillRect()&lt;/code&gt;&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;同时使用 &lt;code&gt;strokeRect()&lt;/code&gt; 和 &lt;code&gt;fillRect()&lt;/code&gt; 会产生描边和填充的效果&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.003154574132492&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtBN4nXC2JaVNUicHnOVJe3RgELFleib823DAVDsicKjETGgmtXHywrQPKA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;317&quot;/&gt;&lt;figcaption&gt;21.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;red&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.strokeRect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;) &lt;span&gt;// strokeRect(x, y, width, height)&lt;/span&gt;&lt;br/&gt;  cxt.fillStyle = &lt;span&gt;&#x27;yellow&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillRect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;) &lt;span&gt;// fillRect(x, y, width, height)&lt;/span&gt;&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;使用 &lt;code&gt;rect()&lt;/code&gt; 生成矩形&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;rect()&lt;/code&gt; 和 &lt;code&gt;fillRect() 、strokeRect()&lt;/code&gt; 的用法差不多，唯一的区别是：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;&lt;code&gt;strokeRect()&lt;/code&gt; 和 &lt;code&gt;fillRect()&lt;/code&gt; 这两个方法调用后会立即绘制；&lt;code&gt;rect()&lt;/code&gt; 方法被调用后，不会立刻绘制矩形，而是需要调用 &lt;code&gt;stroke()&lt;/code&gt; 或 &lt;code&gt;fill()&lt;/code&gt; 辅助渲染。&lt;/strong&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9937694704049844&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt5Vb9C6lz4ncg337ib4JGj74ZN05vOwDf1Dkck565s5SA87tdd6UMecA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;321&quot;/&gt;&lt;figcaption&gt;22.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;red&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  cxt.rect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;) &lt;span&gt;// rect(x, y, width, height)&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;  cxt.fill()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;等价公式：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;cxt.strokeStyle = &lt;span&gt;&#x27;red&#x27;&lt;/span&gt;,&lt;br/&gt;cxt.rect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;cxt.stroke()&lt;br/&gt;&lt;br/&gt;&lt;span&gt;// 等价于&lt;/span&gt;&lt;br/&gt;cxt.strokeStyle = &lt;span&gt;&#x27;red&#x27;&lt;/span&gt;&lt;br/&gt;cxt.strokerect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;// -----------------------------&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;cxt.fillStyle = &lt;span&gt;&#x27;hotpink&#x27;&lt;/span&gt;&lt;br/&gt;cxt.rect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;cxt.fill()&lt;br/&gt;&lt;br/&gt;&lt;span&gt;// 等价于&lt;/span&gt;&lt;br/&gt;cxt.fillStyle = &lt;span&gt;&#x27;yellowgreen&#x27;&lt;/span&gt;&lt;br/&gt;cxt.fillRect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;使用 &lt;code&gt;clearRect()&lt;/code&gt; 清空矩形&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;clearRect()&lt;/code&gt; 方法可以清空指定区域。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;clearRect(x, y, width, height)&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其语法和创建 &lt;code&gt;cxt.rect()&lt;/code&gt; 差不多。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.006269592476489&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt0dlf3rV1AA4jXrYM1NYzujnKNP63ibNZR4KGTIblW5EXn2CwbE3rdmw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;319&quot;/&gt;&lt;figcaption&gt;23.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.fillStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt; &lt;span&gt;// 设置填充颜色&lt;/span&gt;&lt;br/&gt;  cxt.fillRect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;) &lt;span&gt;// 填充矩形&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  cxt.clearRect(&lt;span&gt;60&lt;/span&gt;, &lt;span&gt;60&lt;/span&gt;, &lt;span&gt;180&lt;/span&gt;, &lt;span&gt;90&lt;/span&gt;) &lt;span&gt;// 清空矩形&lt;/span&gt;&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;清空画布&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;canvas&lt;/code&gt; 画布元素是矩形，所以可以通过下面的代码把整个画布清空掉。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;// 省略部分代码&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;cxt.clearRect(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, cnv.width, cnv.height)&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;要清空的区域：从画布左上角开始，直到画布的宽和画布的高为止。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;多边形&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;Canvas&lt;/code&gt; 要画多边形，需要使用 &lt;code&gt;moveTo()&lt;/code&gt; 、 &lt;code&gt;lineTo()&lt;/code&gt; 和 &lt;code&gt;closePath()&lt;/code&gt; 。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;三角形&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;虽然三角形是常见图形，但 &lt;code&gt;canvas&lt;/code&gt; 并没有提供类似 &lt;code&gt;rect()&lt;/code&gt; 的方法来绘制三角形。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;需要确定三角形3个点的坐标位置，然后使用 &lt;code&gt;stroke()&lt;/code&gt; 或者 &lt;code&gt;fill()&lt;/code&gt; 方法生成三角形。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtNc6ibmMr0yIEF3ribt9ocVCibxafsmAr7pPy0bZaEeiaVhzHgMRnFyR2Og/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;321&quot;/&gt;&lt;figcaption&gt;24.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 注意点：如果使用 lineTo 闭合图形，是不能很好闭合拐角位的。&lt;/span&gt;&lt;br/&gt;  cxt.lineTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;) &lt;span&gt;// 闭合&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;注意，默认情况下不会自动从最后一个点连接到起点。最后一步需要设置一下 &lt;code&gt;cxt.lineTo(50, 50)&lt;/code&gt; ，让它与 &lt;code&gt;cxt.moveTo(50, 50)&lt;/code&gt; 一样。这样可以让路径回到起点，形成一个闭合效果。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但这样做其实是有点问题的，而且也比较麻烦，要记住起始点坐标。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面的闭合操作，如果遇到设置了 &lt;code&gt;lineWidth&lt;/code&gt; 或者 &lt;code&gt;lineJoin&lt;/code&gt; 就会有问题，比如：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.00625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtuyMFNn6eeBFia3oLW8vr2caw6mlIEN0yKeydVT3Wz4nkSvxfAed0jTg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;320&quot;/&gt;&lt;figcaption&gt;25.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;// 省略部分代码&lt;/span&gt;&lt;br/&gt;cxt.lineWidth = &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当线段变粗后，起始点和结束点的链接处，拐角就出现“不正常”现象。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果需要真正闭合，可以使用 &lt;code&gt;closePath()&lt;/code&gt; 方法。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9755351681957186&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAttzqVg4QqAEVfZC2wFaOJj8iaVYqK7ibcWu4ia6oCvOm5dXg7VqjcGXH3Q/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;327&quot;/&gt;&lt;figcaption&gt;26.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;// 手动闭合&lt;/span&gt;&lt;br/&gt;  cxt.closePath()&lt;br/&gt;&lt;br/&gt;  cxt.lineJoin = &lt;span&gt;&#x27;miter&#x27;&lt;/span&gt; &lt;span&gt;// 线条连接的样式。miter: 默认; bevel: 斜面; round: 圆角&lt;/span&gt;&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;cxt.closePath()&lt;/code&gt; 可以自动将终点和起始点连接起来，此时看上去就正常多了。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;菱形&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;有一组邻边相等的平行四边形是菱形&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.9968553459119497&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt7dXY13BuOrp5Pic9b6LEzVMMBUqtYhDP2s98Rb4fNVDMwRrv47Oht6w/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;318&quot;/&gt;&lt;figcaption&gt;27.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;150&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;150&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.closePath()&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;要绘制直线类型的图形，在草稿纸上标记出起始点和每个拐角的点，然后再连线即可。相对曲线图形来说，直线图形是比较容易的。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;圆形&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;绘制圆形的方法是 &lt;code&gt;arc()&lt;/code&gt;。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;语法：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;arc(x, y, r, sAngle, eAngle，counterclockwise)&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;x&lt;/code&gt; 和 &lt;code&gt;y&lt;/code&gt;: 圆心坐标&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;r&lt;/code&gt;: 半径&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;sAngle&lt;/code&gt;: 开始角度&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;eAngle&lt;/code&gt;: 结束角度&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;counterclockwise&lt;/code&gt;: 绘制方向（true: 逆时针; false: 顺时针），默认 false&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.0417052826691382&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtTEKricz6ec6HqfqMXhdiboB0cvQhLKSBahWicuhMAWJrIOnpGdpSibnibjA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1079&quot;/&gt;&lt;figcaption&gt;28.jpg&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;开始角度和结束角度，都是以&lt;strong&gt;弧度&lt;/strong&gt;为单位。例如 180°就写成 &lt;code&gt;Math.PI&lt;/code&gt; ，360°写成 &lt;code&gt;Math.PI * 2&lt;/code&gt; ，以此类推。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在实际开发中，为了让自己或者别的开发者更容易看懂&lt;strong&gt;弧度的数值&lt;/strong&gt;，1°应该写成 &lt;code&gt;Math.PI / 180&lt;/code&gt;。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;100°: &lt;code&gt;100 * Math.PI / 180&lt;/code&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;110°: &lt;code&gt;110 * Math.PI / 180&lt;/code&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;241°: &lt;code&gt;241 * Math.PI / 180&lt;/code&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;注意：绘制圆形之前，必须先调用 &lt;code&gt;beginPath()&lt;/code&gt; 方法！！！在绘制完成之后，还需要调用 &lt;code&gt;closePath()&lt;/code&gt; 方法！！！&lt;/strong&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtY3lY922XktpuSKJo1bicYB9PJDwb53EO7I2cCiaAQtcYHnNJ1efFNIhA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;320&quot;/&gt;&lt;figcaption&gt;29.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.arc(&lt;span&gt;150&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;, &lt;span&gt;80&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;360&lt;/span&gt; * &lt;span&gt;Math&lt;/span&gt;.PI / &lt;span&gt;180&lt;/span&gt;)&lt;br/&gt;  cxt.closePath()&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;半圆&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果使用 &lt;code&gt;arc()&lt;/code&gt; 方法画圆时，没做到刚好绕完一周（360°）就直接闭合路径，就会出现半圆的状态。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.006269592476489&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtAlxibzAwEfZESzhUa8KFNILPtibA4Wjer2iaxIDyyxI0pLrYpEgLoU6ibw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;319&quot;/&gt;&lt;figcaption&gt;30.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.arc(&lt;span&gt;150&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;180&lt;/span&gt; * &lt;span&gt;Math&lt;/span&gt;.PI / &lt;span&gt;180&lt;/span&gt;) &lt;span&gt;// 顺时针&lt;/span&gt;&lt;br/&gt;  cxt.closePath()&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上面的代码中，&lt;code&gt;cxt.arc&lt;/code&gt; 最后一个参数没传，默认是 &lt;code&gt;false&lt;/code&gt; ，所以是顺时针绘制。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9880952380952381&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtLBzAyoRDGoXVzkntfNIqPy3RiatbmkSdiaTJL5PmNQZPXSXQbxFqHzMw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1092&quot;/&gt;&lt;figcaption&gt;31.jpg&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果希望半圆的弧面在上方，可以将 &lt;code&gt;cxt.arc&lt;/code&gt; 最后一个参数设置成 &lt;code&gt;true&lt;/code&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtOd74O4fr2wCUdZRPufA9mLny1Jc3GUdteooxDZHPHpbUEMjugdBiawA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;323&quot;/&gt;&lt;figcaption&gt;32.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.arc(&lt;span&gt;150&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;180&lt;/span&gt; * &lt;span&gt;Math&lt;/span&gt;.PI / &lt;span&gt;180&lt;/span&gt;, &lt;span&gt;true&lt;/span&gt;)&lt;br/&gt;  cxt.closePath()&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;弧线&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;arc()&lt;/code&gt; 方法画半圆时，如果最后不调用 &lt;code&gt;closePath()&lt;/code&gt; 方法，就不会出现闭合路径。也就是说，那是一条弧线。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在 &lt;code&gt;canvas&lt;/code&gt; 中，画弧线有2中方法：&lt;code&gt;arc()&lt;/code&gt; 和 &lt;code&gt;arcTo()&lt;/code&gt; 。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;arc() 画弧线&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果想画一条 &lt;code&gt;0° ~ 30°&lt;/code&gt; 的弧线，可以这样写&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9937888198757764&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt8lH5P4yluwtpDg9MAubRDu2Jic8E5kc8r6oBTDibq6MOzbq8OfJl6STg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;322&quot;/&gt;&lt;figcaption&gt;33.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.arc(&lt;span&gt;150&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt; * &lt;span&gt;Math&lt;/span&gt;.PI / &lt;span&gt;180&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;原理如下图所示，红线代表画出来的那条弧线。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9880952380952381&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtiavQpiaM57H6jYeFocy3AKfAuKWVEFlgqIltbhia9T1lE5ic6YMiczKwQqg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1092&quot;/&gt;&lt;figcaption&gt;34.jpg&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;arcTo() 画弧线&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;arcTo()&lt;/code&gt; 的使用方法会更加复杂，如果初学看不太懂的话可以先跳过，看完后面的再回来补补。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;语法：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;arcTo(cx, cy, x2, y2, radius)&lt;br/&gt;复制代码&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;cx&lt;/code&gt;: 两切线交点的横坐标&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;cy&lt;/code&gt;: 两切线交点的纵坐标&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;x2&lt;/code&gt;: 结束点的横坐标&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;y2&lt;/code&gt;: 结束点的纵坐标&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;radius&lt;/code&gt;: 半径&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其中，&lt;code&gt;(cx, cy)&lt;/code&gt; 也叫控制点，&lt;code&gt;(x2, y2)&lt;/code&gt; 也叫结束点。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;是不是有点奇怪，为什么没有 &lt;code&gt;x1&lt;/code&gt; 和 &lt;code&gt;y1&lt;/code&gt; ？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;(x1, y1)&lt;/code&gt; 是开始点，通常是由 &lt;code&gt;moveTo()&lt;/code&gt; 或者 &lt;code&gt;lineTo()&lt;/code&gt; 提供。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;arcTo()&lt;/code&gt; 方法利用 &lt;strong&gt;开始点、控制点和结束点形成的夹角，绘制一段与夹角的两边相切并且半径为 &lt;code&gt;radius&lt;/code&gt; 的圆弧&lt;/strong&gt;。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9490333919156415&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtfuc2VX9YyTaPUTVR8pSpnAz3zFvRUlhC2wMGsbS7mNU8lXEJPGZv2g/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1138&quot;/&gt;&lt;figcaption&gt;35.jpg&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;举个例子&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9907120743034056&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtg7icY6ebcXASsPcj9m11gqlwU4Lgb2iayb8GDFAxZwvRhlu6VdCmJ62w/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;323&quot;/&gt;&lt;figcaption&gt;36.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;40&lt;/span&gt;, &lt;span&gt;40&lt;/span&gt;)&lt;br/&gt;  cxt.arcTo(&lt;span&gt;120&lt;/span&gt;, &lt;span&gt;40&lt;/span&gt;, &lt;span&gt;120&lt;/span&gt;, &lt;span&gt;120&lt;/span&gt;, &lt;span&gt;80&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;基础样式&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;前面学完基础图形，接下来可以开始了解一下如何设置元素的基础样式。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;描边 stroke()&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;前面的案例中，其实已经知道使用 &lt;code&gt;stroke()&lt;/code&gt; 方法进行描边了。这里就不再多讲这个方法。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;线条宽度 lineWidth&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;lineWidth&lt;/code&gt; 默认值是 &lt;code&gt;1&lt;/code&gt; ，默认单位是 &lt;code&gt;px&lt;/code&gt;。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;语法：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;lineWidth = 线宽&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9815950920245399&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtBicLAciadCm9Cia5qVx6BxicukyHqglQiaxNkRibl0wHxKVe7MRibm6ibPlGww/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;326&quot;/&gt;&lt;figcaption&gt;37.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 线宽 10&lt;/span&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;10&lt;/span&gt; &lt;span&gt;// 设置线宽&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 线宽 20&lt;/span&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;20&lt;/span&gt; &lt;span&gt;// 设置线宽&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 线宽 30&lt;/span&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;250&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;250&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;30&lt;/span&gt; &lt;span&gt;// 设置线宽&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;线条颜色 strokeStyle&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;strokeStyle&lt;/code&gt; 可以设置线条颜色&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;语法:&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;strokeStyle = 颜色值&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9937694704049844&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtkAQF4rghwWc1Qly9cXZobETmD6FHbqvmulksYo2h3w3uZjibHSNMWPQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;321&quot;/&gt;&lt;figcaption&gt;38.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt; &lt;span&gt;// 设置颜色&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了展示方便，我将 &lt;code&gt;lineWidth&lt;/code&gt; 设为 20。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;线帽 lineCap&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;线帽指的是线段的开始和结尾处的样式，使用 &lt;code&gt;lineCap&lt;/code&gt; 可以设置&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;语法：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;lineCap = &lt;span&gt;&#x27;属性值&#x27;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;属性值包括：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;butt&lt;/code&gt;: 默认值，无线帽&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;square&lt;/code&gt;: 方形线帽&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;round&lt;/code&gt;: 圆形线帽&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.003125&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtMAfrticHx2Tsu1wRnU6K4icjKu06KJhYbTgXP8fCNtdPCzWspOwZjfgQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;320&quot;/&gt;&lt;figcaption&gt;39.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 设置线宽，方便演示&lt;/span&gt;&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;16&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 默认线帽 butt&lt;/span&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;60&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;60&lt;/span&gt;)&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 方形线帽 square&lt;/span&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.lineCap = &lt;span&gt;&#x27;square&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 圆形线帽 round&lt;/span&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.lineCap = &lt;span&gt;&#x27;round&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;250&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;250&lt;/span&gt;)&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;square&lt;/code&gt; 和 &lt;code&gt;round&lt;/code&gt; 的话，会使线条变得稍微长一点点，这是给线条增加线帽的部分，这个长度在日常开发中需要注意。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;线帽只对线条的开始和结尾处产生作用，对拐角不会产生任何作用。&lt;/strong&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;拐角样式 lineJoin&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果需要设置拐角样式，可以使用 &lt;code&gt;lineJoin&lt;/code&gt; 。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;语法：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;lineJoin = &lt;span&gt;&#x27;属性值&#x27;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;属性值包括：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;miter&lt;/code&gt;: 默认值，尖角&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;round&lt;/code&gt;: 圆角&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;bevel&lt;/code&gt;: 斜角&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9906542056074766&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtiavqfEpz3GkI3labMKxLn1uJrrsbKyt6xfENWzzuwpKcqeoVVgsRiagw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;321&quot;/&gt;&lt;figcaption&gt;40.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;br/&gt;  cxt.lineWidth = &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 默认，尖角&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;40&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;40&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;90&lt;/span&gt;)&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 斜角 bevel&lt;/span&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;140&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;140&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;190&lt;/span&gt;)&lt;br/&gt;  cxt.lineJoin = &lt;span&gt;&#x27;bevel&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 圆角 round&lt;/span&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;240&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;240&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;290&lt;/span&gt;)&lt;br/&gt;  cxt.lineJoin = &lt;span&gt;&#x27;round&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;虚线 setLineDash()&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;setLineDash()&lt;/code&gt; 方法可以将描边设置成虚线。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;语法：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;setLineDash([])&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;需要传入一个数组，且元素是数值型。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;虚线分3种情况&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;只传1个值&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;有2个值&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;有3个以上的值&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt80DpiclO7NxfGmazt3jd6jKd1H8iao4wTLC0G0wc4dGZickqkZOVSjgMw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;321&quot;/&gt;&lt;figcaption&gt;41.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.lineWidth = &lt;span&gt;20&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.setLineDash([&lt;span&gt;10&lt;/span&gt;]) &lt;span&gt;// 只传1个参数，实线与空白都是 10px&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.setLineDash([&lt;span&gt;10&lt;/span&gt;, &lt;span&gt;20&lt;/span&gt;]) &lt;span&gt;// 2个参数，此时，实线是 10px, 空白 20px&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;  cxt.beginPath()&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;  cxt.setLineDash([&lt;span&gt;10&lt;/span&gt;, &lt;span&gt;20&lt;/span&gt;, &lt;span&gt;5&lt;/span&gt;]) &lt;span&gt;// 传3个以上的参数，此例：10px实线，20px空白，5px实线，10px空白，20px实线，5px空白 ……&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;此外，还可以始终 &lt;code&gt;cxt.getLineDash()&lt;/code&gt; 获取虚线不重复的距离；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用 &lt;code&gt;cxt.lineDashOffset&lt;/code&gt; 设置虚线的偏移位。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;填充&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;fill()&lt;/code&gt; 可以填充图形，根据前面的例子应该掌握了如何使用 &lt;code&gt;fill()&lt;/code&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.009375&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtB0iav4SCExRWlwGxDbfH9HdENLMv6n2dnIXqkSew9R1WicThQWRLXaMA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;320&quot;/&gt;&lt;figcaption&gt;42.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.fillStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  cxt.rect(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.fill()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可以使用 &lt;code&gt;fillStyle&lt;/code&gt; 设置填充颜色，默认是黑色。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;非零环绕填充&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在使用 &lt;code&gt;fill()&lt;/code&gt; 方法填充时，需要注意一个规则：&lt;strong&gt;非零环绕填充&lt;/strong&gt;。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在使用 &lt;code&gt;moveTo&lt;/code&gt; 和 &lt;code&gt;lineTo&lt;/code&gt; 描述图形时，如果是按顺时针绘制，计数器会加1；如果是逆时针，计数器会减1。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当图形所处的位置，计数器的结果为0时，它就不会被填充。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这样说有点复杂，先看看例子&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtw0RfOnic51CdPVuJqaRGxJicNl2PEKgthaCILT1icejKQzeL0qKlZntOQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;322&quot;/&gt;&lt;figcaption&gt;43.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 外层矩形&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;50&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;250&lt;/span&gt;, &lt;span&gt;250&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;50&lt;/span&gt;, &lt;span&gt;250&lt;/span&gt;)&lt;br/&gt;  cxt.closePath()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 内层矩形&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;100&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;  cxt.closePath()&lt;br/&gt;  cxt.fill()&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;请看看上面的代码，我画了2个矩形，它们都没有用 &lt;code&gt;beginPath()&lt;/code&gt; 方法开辟新路径。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7575250836120402&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtu4s65vmHfGRSh4peQ1PGLR2LaN9Yzufw561ku0qAYHgEnjRrdWV04A/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;1196&quot;/&gt;&lt;figcaption&gt;44.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;内层矩形是逆时针绘制的，所以内层的值是 &lt;code&gt;-1&lt;/code&gt; ，它又经过外层矩形，而外层矩形是顺时针绘制，所以经过外层时值 &lt;code&gt;+1&lt;/code&gt;，最终内层的值为 &lt;code&gt;0&lt;/code&gt; ，所以不会被填充。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;文本&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;Canvas&lt;/code&gt; 提供了一些操作文本的方法。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了方便演示，我们先了解一下在 &lt;code&gt;Canvas&lt;/code&gt; 中如何给本文设置样式。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;样式 font&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;和 &lt;code&gt;CSS&lt;/code&gt; 设置 &lt;code&gt;font&lt;/code&gt; 差不多，&lt;code&gt;Canvas&lt;/code&gt; 也可以通过 &lt;code&gt;font&lt;/code&gt; 设置样式。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;语法：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;cxt.font = &lt;span&gt;&#x27;font-style font-variant font-weight font-size/line-height font-family&#x27;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果需要设置字号 &lt;code&gt;font-size&lt;/code&gt;，需要同事设置 &lt;code&gt;font-family&lt;/code&gt;。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;cxt.font = &lt;span&gt;&#x27;30px 宋体&#x27;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;描边 strokeText()&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;strokeText()&lt;/code&gt; 方法进行文本描边&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;语法：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;strokeText(text, x, y, maxWidth)&lt;br/&gt;复制代码&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;text&lt;/code&gt;: 字符串，要绘制的内容&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;x&lt;/code&gt;: 横坐标，文本&lt;strong&gt;左边&lt;/strong&gt;要对齐的坐标（默认左对齐）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;y&lt;/code&gt;: 纵坐标，文本&lt;strong&gt;底边&lt;/strong&gt;要对齐的坐标&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;maxWidth&lt;/code&gt;: 可选参数，表示文本渲染的最大宽度（px），如果文本超出 &lt;code&gt;maxWidth&lt;/code&gt; 设置的值，文本会被压缩。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9968847352024922&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAttRa8mgJFIicUa4Bq8WkrRKu9icRWFGYqUicP1MUw9RE8dLWmRfOmcPESw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;321&quot;/&gt;&lt;figcaption&gt;45.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.font = &lt;span&gt;&#x27;60px Arial&#x27;&lt;/span&gt; &lt;span&gt;// 将字号设置成 60px，方便观察&lt;/span&gt;&lt;br/&gt;  cxt.strokeText(&lt;span&gt;&#x27;雷猴&#x27;&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;90&lt;/span&gt;)&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;设置描边颜色 strokeStyle&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;strokeStyle&lt;/code&gt; 设置描边颜色。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtiaqw0rlmkRxkia5wyFKkAzib649qMBdYYqeW23FUPF6EhFhgYc0IMtADw/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;319&quot;/&gt;&lt;figcaption&gt;46.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.font = &lt;span&gt;&#x27;60px Arial&#x27;&lt;/span&gt; &lt;span&gt;// 将字号设置成 60px，方便观察&lt;/span&gt;&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt; &lt;span&gt;// 设置文本描边颜色&lt;/span&gt;&lt;br/&gt;  cxt.strokeText(&lt;span&gt;&#x27;雷猴&#x27;&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;90&lt;/span&gt;)&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;填充 fillText&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;fillText()&lt;/code&gt; 可填充文本。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;语法和 &lt;code&gt;strokeText()&lt;/code&gt; 一样。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;fillText(text, x, y, maxWidth)&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9906542056074766&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtvUxd69xA1Jg5nNs63dkdXWXOtV6k4FOMtPa46L7DCGVH6LJW4xO5gA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;321&quot;/&gt;&lt;figcaption&gt;47.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.font = &lt;span&gt;&#x27;60px Arial&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴&#x27;&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;90&lt;/span&gt;)&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;设置填充颜色 fillStyle&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;fillStyle&lt;/code&gt; 可以设置文本填充颜色。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtFrtpLqxic9Rp8Q2Lm2QFysTibiccD1UoehEbj7j4nrutibyV1F1GLT5vpg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;320&quot;/&gt;&lt;figcaption&gt;48.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.font = &lt;span&gt;&#x27;60px Arial&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillStyle = &lt;span&gt;&#x27;pink&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴&#x27;&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;90&lt;/span&gt;)&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;获取文本长度 measureText()&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;measureText().width&lt;/code&gt; 方法可以获取文本的长度，单位是 &lt;code&gt;px&lt;/code&gt; 。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;let&lt;/span&gt; text = &lt;span&gt;&#x27;雷猴&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.font = &lt;span&gt;&#x27;bold 40px Arial&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillText(text, &lt;span&gt;40&lt;/span&gt;, &lt;span&gt;80&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;console&lt;/span&gt;.log(cxt.measureText(text).width) &lt;span&gt;// 80&lt;/span&gt;&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;水平对齐方式 textAlign&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;textAlign&lt;/code&gt; 属性可以设置文字的水平对齐方式，一共有5个值可选&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;start&lt;/code&gt;: 默认。在指定位置的横坐标开始。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;end&lt;/code&gt;: 在指定坐标的横坐标结束。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;left&lt;/code&gt;: 左对齐。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;right&lt;/code&gt;: 右对齐。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;center&lt;/code&gt;: 居中对齐。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.004750593824228&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt0VbNA4twbuRIvDWicjC8Qov5Uz8xDAsKRkl6rhAibpTBjd8gemmj8GPQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;421&quot;/&gt;&lt;figcaption&gt;49.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;红线是辅助参考线。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;400&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;400&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 竖向的辅助线（参考线，在画布中间）&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;200&lt;/span&gt;, &lt;span&gt;400&lt;/span&gt;)&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;red&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  cxt.font = &lt;span&gt;&#x27;30px Arial&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 横坐标开始位对齐&lt;/span&gt;&lt;br/&gt;  cxt.textAlign = &lt;span&gt;&#x27;start&#x27;&lt;/span&gt; &lt;span&gt;// 默认值,&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 start&#x27;&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;40&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 横坐标结束位对齐&lt;/span&gt;&lt;br/&gt;  cxt.textAlign = &lt;span&gt;&#x27;end&#x27;&lt;/span&gt; &lt;span&gt;// 结束对齐&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 end&#x27;&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 左对齐&lt;/span&gt;&lt;br/&gt;  cxt.textAlign = &lt;span&gt;&#x27;left&#x27;&lt;/span&gt; &lt;span&gt;// 左对齐&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 left&#x27;&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;160&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 右对齐&lt;/span&gt;&lt;br/&gt;  cxt.textAlign = &lt;span&gt;&#x27;right&#x27;&lt;/span&gt; &lt;span&gt;// 右对齐&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 right&#x27;&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;220&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 居中对齐&lt;/span&gt;&lt;br/&gt;  cxt.textAlign = &lt;span&gt;&#x27;center&#x27;&lt;/span&gt; &lt;span&gt;// 右对齐&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 center&#x27;&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;280&lt;/span&gt;)&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;从上面的例子看，&lt;code&gt;start&lt;/code&gt; 和 &lt;code&gt;left&lt;/code&gt; 的效果好像是一样的，&lt;code&gt;end&lt;/code&gt; 和 &lt;code&gt;right&lt;/code&gt; 也好像是一样的。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在大多数情况下，它们的确一样。但在某些国家或者某些场合，阅读文字的习惯是 &lt;strong&gt;从右往左&lt;/strong&gt; 时，&lt;code&gt;start&lt;/code&gt; 就和 &lt;code&gt;right&lt;/code&gt; 一样了，&lt;code&gt;end&lt;/code&gt; 和 &lt;code&gt;left&lt;/code&gt; 也一样。这是需要注意的地方。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;垂直对齐方式 textBaseline&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 &lt;code&gt;textBaseline&lt;/code&gt; 属性可以设置文字的垂直对齐方式。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在使用 &lt;code&gt;textBaseline&lt;/code&gt; 前，需要自行了解 &lt;code&gt;css&lt;/code&gt; 的文本基线。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img data-ratio=&quot;0.20638820638820637&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtWrialtpUSqM0P3icg3norF68KwacE95wiaCzjZzsybtV51EqSibia8fUrww/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;407&quot;/&gt;&lt;figcaption&gt;50.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用一张网图解释一下基线&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;&lt;code&gt;textBaseline&lt;/code&gt; 可选属性：&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;alphabetic&lt;/code&gt;: 默认。文本基线是普通的字母基线。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;top&lt;/code&gt;: 文本基线是 &lt;code&gt;em&lt;/code&gt; 方框的顶端。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;bottom&lt;/code&gt;: 文本基线是 &lt;code&gt;em&lt;/code&gt; 方框的底端。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;middle&lt;/code&gt;: 文本基线是 &lt;code&gt;em&lt;/code&gt; 方框的正中。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;hanging&lt;/code&gt;: 文本基线是悬挂基线。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.39416058394160586&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtJo5EuicgFIqm1yuWfm6qT1kFQv1k8ngruibxY1GG1hjvY8ThVJKz50ZA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;822&quot;/&gt;&lt;figcaption&gt;51.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;红线是辅助参考线。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;800&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;300&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 横向的辅助线（参考线，在画布中间）&lt;/span&gt;&lt;br/&gt;  cxt.moveTo(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;  cxt.lineTo(&lt;span&gt;800&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;  cxt.strokeStyle = &lt;span&gt;&#x27;red&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.stroke()&lt;br/&gt;&lt;br/&gt;  cxt.font = &lt;span&gt;&#x27;20px Arial&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 默认 alphabetic&lt;/span&gt;&lt;br/&gt;  cxt.textBaseline = &lt;span&gt;&#x27;alphabetic&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 alphabetic&#x27;&lt;/span&gt;, &lt;span&gt;10&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 默认 top&lt;/span&gt;&lt;br/&gt;  cxt.textBaseline = &lt;span&gt;&#x27;top&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 top&#x27;&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 默认 bottom&lt;/span&gt;&lt;br/&gt;  cxt.textBaseline = &lt;span&gt;&#x27;bottom&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 bottom&#x27;&lt;/span&gt;, &lt;span&gt;320&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 默认 middle&lt;/span&gt;&lt;br/&gt;  cxt.textBaseline = &lt;span&gt;&#x27;middle&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 middle&#x27;&lt;/span&gt;, &lt;span&gt;480&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 默认 hanging&lt;/span&gt;&lt;br/&gt;  cxt.textBaseline = &lt;span&gt;&#x27;hanging&#x27;&lt;/span&gt;&lt;br/&gt;  cxt.fillText(&lt;span&gt;&#x27;雷猴 hanging&#x27;&lt;/span&gt;, &lt;span&gt;640&lt;/span&gt;, &lt;span&gt;150&lt;/span&gt;)&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;注意：在绘制文字的时候，默认是以文字的左下角作为参考点进行绘制&lt;/strong&gt;&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;图片&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在 &lt;code&gt;Canvas&lt;/code&gt; 中可以使用 &lt;code&gt;drawImage()&lt;/code&gt; 方法绘制图片。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;渲染图片&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;渲染图片的方式有2中，一种是&lt;strong&gt;在JS里加载图片再渲染&lt;/strong&gt;，另一种是&lt;strong&gt;把DOM里的图片拿到 &lt;code&gt;canvas&lt;/code&gt; 里渲染&lt;/strong&gt;。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;渲染的语法：&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;drawImage(image, dx, dy)&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;image&lt;/code&gt;: 要渲染的图片对象。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;dx&lt;/code&gt;: 图片左上角的横坐标位置。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;dy&lt;/code&gt;: 图片左上角的纵坐标位置。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;JS版&lt;/span&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在 &lt;code&gt;JS&lt;/code&gt; 里加载图片并渲染，有以下几个步骤：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;创建 &lt;code&gt;Image&lt;/code&gt; 对象&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;引入图片&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;等待图片加载完成&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;使用 &lt;code&gt;drawImage()&lt;/code&gt; 方法渲染图片&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9980879541108987&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtWBuwBQwc3MHrnbJuncpbeic5z4nic8InEia9HX8nxWnRe0WQSHed8Qiang/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;523&quot;/&gt;&lt;figcaption&gt;52.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;500&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;500&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 1 创建 Image 对象&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; image = &lt;span&gt;new&lt;/span&gt; Image()&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 2 引入图片&lt;/span&gt;&lt;br/&gt;  image.src = &lt;span&gt;&#x27;./images/dog.jpg&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;// 3 等待图片加载完成&lt;/span&gt;&lt;br/&gt;  image.onload = &lt;span&gt;&lt;span&gt;()&lt;/span&gt; =&amp;gt;&lt;/span&gt; {&lt;br/&gt;    &lt;span&gt;// 4 使用 drawImage() 方法渲染图片&lt;/span&gt;&lt;br/&gt;    cxt.drawImage(image, &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt;)&lt;br/&gt;  }&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;DOM版&lt;/span&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9980769230769231&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt5uOMYEnibdcl3A6153H3NYhkwms5JPmvk5nebpWCYhgBuzILyNw5Vrg/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;520&quot;/&gt;&lt;figcaption&gt;53.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;style&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;#dogImg&lt;/span&gt; {&lt;br/&gt;    &lt;span&gt;display&lt;/span&gt;: none;&lt;br/&gt;  }&lt;br/&gt;&amp;lt;/&lt;span&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;img&lt;/span&gt; &lt;span&gt;src&lt;/span&gt;=&lt;span&gt;&quot;./images/dog.jpg&quot;&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;dogImg&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;500&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;500&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; image = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;dogImg&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  cxt.drawImage(image, &lt;span&gt;70&lt;/span&gt;, &lt;span&gt;70&lt;/span&gt;)&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;因为图片是从 &lt;code&gt;DOM&lt;/code&gt; 里获取到的，所以一般来说，只要在 &lt;code&gt;window.onload&lt;/code&gt; 这个生命周期内使用 &lt;code&gt;drawImage&lt;/code&gt; 都可以正常渲染图片。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本例使用了 &lt;code&gt;css&lt;/code&gt; 的方式，把图片的 &lt;code&gt;display&lt;/code&gt; 设置成 &lt;code&gt;none&lt;/code&gt; 。因为我不想被 &lt;code&gt;&amp;lt;img&amp;gt;&lt;/code&gt; 影响到本例讲解。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;实际开发过程中按照实际情况设置即可。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;设置图片宽高&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;前面的例子都是直接加载图片，图片默认的宽高是多少就加载多少。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果需要指定图片宽高，可以在前面的基础上再添加两个参数：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;drawImage(image, dx, dy, dw, dh)&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;image、 dx、 dy&lt;/code&gt; 的用法和前面一样。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;dw&lt;/code&gt; 用来定义图片的宽度，&lt;code&gt;dh&lt;/code&gt; 定义图片的高度。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9961538461538462&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAtxIAmb44PpqYia0BCOLc3D343YVcAB1JkmCSSGf9RQD2hwfUFicvzvfIA/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;520&quot;/&gt;&lt;figcaption&gt;54.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;500&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;500&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; image = &lt;span&gt;new&lt;/span&gt; Image()&lt;br/&gt;  image.src = &lt;span&gt;&#x27;./images/dog.jpg&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  image.onload = &lt;span&gt;&lt;span&gt;()&lt;/span&gt; =&amp;gt;&lt;/span&gt; {&lt;br/&gt;    cxt.drawImage(image, &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;)&lt;br/&gt;  }&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我把图片的尺寸设为 100px * 100px，图片看上去比之前就小了很多。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;截取图片&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;截图图片同样使用&lt;code&gt;drawImage()&lt;/code&gt; 方法，只不过传入的参数数量比之前都多，而且顺序也有点不一样了。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh)&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;以上参数缺一不可&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;image&lt;/code&gt;: 图片对象&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;sx&lt;/code&gt;: 开始截取的横坐标&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;sy&lt;/code&gt;: 开始截取的纵坐标&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;sw&lt;/code&gt;: 截取的宽度&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;sh&lt;/code&gt;: 截取的高度&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;dx&lt;/code&gt;: 图片左上角的横坐标位置&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;dy&lt;/code&gt;: 图片左上角的纵坐标位置&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;dw&lt;/code&gt;: 图片宽度&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;dh&lt;/code&gt;: 图片高度&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9961612284069098&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/bwG40XYiaOKlxDHCn21fyEeiaE8icHzbcAt8QQ2qibicKelobnJ8soB4FwW3OtQY9RoSqfGriaHjMnhmyoVAUicGHOxAQ/640?wx_fmt=other&quot; data-type=&quot;other&quot; data-w=&quot;521&quot;/&gt;&lt;figcaption&gt;55.png&lt;/figcaption&gt;&lt;/figure&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;&lt;span&gt;&amp;lt;&lt;span&gt;canvas&lt;/span&gt; &lt;span&gt;id&lt;/span&gt;=&lt;span&gt;&quot;c&quot;&lt;/span&gt; &lt;span&gt;width&lt;/span&gt;=&lt;span&gt;&quot;500&quot;&lt;/span&gt; &lt;span&gt;height&lt;/span&gt;=&lt;span&gt;&quot;500&quot;&lt;/span&gt; &lt;span&gt;style&lt;/span&gt;=&lt;span&gt;&quot;border: 1px solid #ccc;&quot;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cnv = &lt;span&gt;document&lt;/span&gt;.getElementById(&lt;span&gt;&#x27;c&#x27;&lt;/span&gt;)&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; cxt = cnv.getContext(&lt;span&gt;&#x27;2d&#x27;&lt;/span&gt;)&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;const&lt;/span&gt; image = &lt;span&gt;new&lt;/span&gt; Image()&lt;br/&gt;  image.src = &lt;span&gt;&#x27;./images/dog.jpg&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  image.onload = &lt;span&gt;&lt;span&gt;()&lt;/span&gt; =&amp;gt;&lt;/span&gt; {&lt;br/&gt;    cxt.drawImage(image, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;30&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;)&lt;br/&gt;  }&lt;br/&gt;&amp;lt;/&lt;span&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;复制代码&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;总结&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本文主要讲解了在 &lt;code&gt;Canvas&lt;/code&gt; 中绘制一些基础图形，还有一些基础样式设置。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;还有更多高级的玩法会在之后的文章中讲到，比如渐变、投影、滤镜等等。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;代码仓库&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;⭐&lt;span&gt;雷猴 Canvas&lt;/span&gt;&lt;sup&gt;[4]&lt;/sup&gt;&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;推荐阅读&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;👍&lt;span&gt;《Fabric.js 从入门到膨胀》&lt;/span&gt;&lt;sup&gt;[5]&lt;/sup&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;👍&lt;span&gt;《『Three.js』起飞！》&lt;/span&gt;&lt;sup&gt;[6]&lt;/sup&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;👍&lt;span&gt;《console.log也能插图！！！》&lt;/span&gt;&lt;sup&gt;[7]&lt;/sup&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;👍&lt;span&gt;《纯css实现117个Loading效果》&lt;/span&gt;&lt;sup&gt;[8]&lt;/sup&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;👍&lt;span&gt;《视差特效的原理和实现方法》&lt;/span&gt;&lt;sup&gt;[9]&lt;/sup&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;👍&lt;span&gt;《这18个网站能让你的页面背景炫酷起来》&lt;/span&gt;&lt;sup&gt;[10]&lt;/sup&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;点赞 + 关注 + 收藏 = 学会了&lt;/strong&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;p&gt;&lt;em/&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;关于本文&lt;/span&gt;&lt;/section&gt;&lt;h1 data-v-233fc3fe=&quot;&quot;&gt;&lt;span&gt;作者：德育处主任&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;&lt;span&gt;https://juejin.cn/post/7116784455561248775&lt;/span&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-darkmode-color-16057140139831=&quot;rgb(162, 162, 162)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(68, 68, 68)&quot; data-style=&quot;padding-top: 7px; padding-bottom: 7px; color: rgb(68, 68, 68); font-size: 14px; line-height: 1.8; font-family: &amp;quot;Helvetica Neue&amp;quot;, Helvetica, &amp;quot;Lucida Grande&amp;quot;, Arial, &amp;quot;Hiragino Sans GB&amp;quot;, 微软雅黑, &amp;quot;WenQuanYi Micro Hei&amp;quot;, STHeiti, SimSun, sans-serif; text-align: center;&quot;&gt;&lt;span data-darkmode-color-16057140139831=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(63, 63, 63)&quot; data-style=&quot;color: rgb(63, 63, 63); font-family: monospace; font-size: 20px; letter-spacing: 0.544px; white-space: pre-wrap; widows: 1; caret-color: rgb(51, 51, 51);&quot;&gt;The End&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;如果你觉得这篇内容对你挺有启发，我想请你帮我三个小忙：&lt;/span&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-darkmode-color-16057140139831=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(0,0,0)&quot; data-style=&quot;padding-right: 10px; padding-left: 10px; font-size: 16px; color: black; line-height: 1.6; letter-spacing: 0px; word-break: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &amp;quot;PingFang SC&amp;quot;, Cambria, Cochin, Georgia, Times, &amp;quot;Times New Roman&amp;quot;, serif;&quot;&gt;&lt;section&gt;&lt;span data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;1、点个 &lt;span data-darkmode-color-16057140139831=&quot;rgb(71, 193, 168)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(71, 193, 168)&quot;&gt;「在看」&lt;/span&gt;，让更多的人也能看到这篇内容&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;2、关注官网 &lt;span data-darkmode-color-16057140139831=&quot;rgb(71, 193, 168)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(71, 193, 168)&quot;&gt;https://muyiy.cn&lt;/span&gt;，让我们成为长期关系&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;3、关注公众号「高级前端进阶」，公众号后台回复 &lt;span data-darkmode-color-16057140139831=&quot;rgb(71, 193, 168)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(71, 193, 168)&quot;&gt;「加群」&lt;/span&gt; ，加入我们一起学习并送你精心整理的高级前端面试题。&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzA4Nzg0MDM5Nw==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/sz_mmbiz_png/H8M5QJDxMHpg1ClH18gOQIicISIoSybyDNK203zFMpSM7jHdovb4elgdqNoy6Bylk7XicC6Rpj5QrCv3FkOpR6tw/0?wx_fmt=png&quot; data-nickname=&quot;高级前端进阶&quot; data-alias=&quot;FrontendGaoji&quot; data-signature=&quot;网易 &amp;amp; 蚂蚁前端，专注前端进阶领域，已帮助无数前端跳槽涨薪。每日一题「Daily-Interview-Question」 Github 收获近 25000 颗小星星，各公司面试官都在使用。接下来带你走进高级前端的世界，在进阶的路上，共勉！&quot; data-from=&quot;2&quot; has-insert-preloading=&quot;1&quot; wah-hotarea=&quot;click&quot;/&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdnice编辑器&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot; data-style=&quot;padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: rgb(89, 89, 89);&quot;&gt;&lt;a class=&quot;weapp_text_link&quot; data-miniprogram-appid=&quot;wx27c980b913cbfb08&quot; data-miniprogram-path=&quot;pages/index/index?_um_campaign=5ec14536978eea0825f4eb6f&amp;amp;_um_channel=5ec14536978eea0825f4eb70&quot; data-miniprogram-nickname=&quot;高级前端面试&quot; data-miniprogram-type=&quot;text&quot; data-miniprogram-servicetype=&quot;0&quot; data-darkmode-bgcolor-15950741730771=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-15950741730771=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15950741730771=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-15950741730771=&quot;rgb(0,0,0)&quot; data-darkmode-color-15963792901125=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-15963792901125=&quot;rgb(0,0,0)&quot; data-darkmode-bgcolor-16018219266315=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16018219266315=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16018219266315=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16018219266315=&quot;rgb(58, 58, 58)&quot; data-darkmode-bgcolor-16020008769986=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16020008769986=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16020008769986=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16020008769986=&quot;rgb(58, 58, 58)&quot; data-darkmode-color-16021670869911=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16021670869911=&quot;rgb(58, 58, 58)&quot; data-darkmode-bgcolor-16021670869911=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16021670869911=&quot;rgb(255, 255, 255)&quot; data-darkmode-bgcolor-16030305897056=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16030305897056=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16030305897056=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(58, 58, 58)&quot; data-darkmode-color-16057140139831=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(58, 58, 58)&quot; wah-hotarea=&quot;click&quot; href=&quot;&quot;&gt;》》面试官都在用的题库，快来看看《&lt;/a&gt;《&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot; data-style=&quot;padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: rgb(89, 89, 89);&quot;&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-darkmode-color-16030305897056=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(63, 63, 63)&quot; data-style=&quot;color: rgb(63, 63, 63); font-size: 16px; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;&quot; data-darkmode-color-16057140139831=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(63, 63, 63)&quot;&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-darkmode-color-16030305897056=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(89, 89, 89)&quot; data-style=&quot;padding-right: 10px; padding-left: 10px; line-height: 1.6; word-break: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &amp;quot;PingFang SC&amp;quot;, Cambria, Cochin, Georgia, Times, &amp;quot;Times New Roman&amp;quot;, serif; font-size: 15px; letter-spacing: 0.05em; color: rgb(89, 89, 89);&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-darkmode-color-16030305897056=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(89, 89, 89)&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;&lt;pre data-darkmode-bgcolor-15987645674728=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-15987645674728=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15987645674728=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-15987645674728=&quot;rgb(0, 0, 0)&quot; data-style=&quot;color: rgb(0, 0, 0); text-align: left; letter-spacing: 0.544px; word-spacing: 2px; font-size: 20px; font-weight: 700; background-color: rgb(255, 255, 255);&quot; data-original-code=&quot;&amp;lt;br&amp;gt;扩展阅读1、一篇文章上手Vue3中新增的API&amp;lt;br&amp;gt;2、Vue源码解析——异步组件是如何使用的&amp;lt;br&amp;gt;3、写好JavaScript条件语句的5条守则&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;The End如果你觉得这篇内容对你挺有启发，我想请你帮我三个小忙：点个「在看」，让更多的人也能看到这篇内容&amp;lt;br&amp;gt;关注官网 https://muyiy.cn，让我们成为长期关系&amp;lt;br&amp;gt;关注公众号「高级前端进阶」，公众号后台回复「加群」 加入我们一起学习并送你精心整理的高级前端面试题。&amp;lt;br&amp;gt;》》面试官都在用的题库，快来看看《《                        高级前端进阶 发起了一个读者讨论         写留言                                        &amp;lt;br&amp;gt;“在看”吗？在看就点一下吧&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&quot; data-snippet-id=&quot;ext.dfdc660f8db84bdd3e9d3d519ceaec46&quot; data-snippet-saved=&quot;false&quot; data-codota-status=&quot;done&quot; data-darkmode-color-16030305897056=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(89, 89, 89)&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;&lt;section data-darkmode-bgcolor-15987645674728=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-15987645674728=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15987645674728=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-15987645674728=&quot;rgb(62, 62, 62)&quot; data-style=&quot;letter-spacing: 0px; white-space: normal; font-size: 16px; color: rgb(62, 62, 62); font-family: &#x27;Helvetica Neue&#x27;, Helvetica, &#x27;Hiragino Sans GB&#x27;, &#x27;Microsoft YaHei&#x27;, Arial, sans-serif; widows: 1; line-height: 1.6;&quot; data-darkmode-color-16030305897056=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(89, 89, 89)&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-darkmode-bgcolor-15987645674728=&quot;rgba(112, 0, 0, 0.018750000000000003)&quot; data-darkmode-original-bgcolor-15987645674728=&quot;rgba(20, 0, 0, 0.018750000000000003)&quot; data-darkmode-color-15987645674728=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-15987645674728=&quot;rgb(89, 89, 89)&quot; data-style=&quot;padding: 10px; word-break: break-word; line-height: 1.75; color: rgb(89, 89, 89); font-family: Optima-Regular, Optima, PingFangTC-Light, PingFangSC-light, PingFangTC-light; letter-spacing: 2px; background-image: linear-gradient(90deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%), linear-gradient(360deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%); background-size: 20px 20px; background-position: center center;&quot; data-darkmode-color-16030305897056=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(89, 89, 89)&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;&lt;pre data-original-code=&quot;&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;The End如果你觉得这篇内容对你挺有启发，我想请你帮我三个小忙：点个「在看」，让更多的人也能看到这篇内容&amp;lt;br&amp;gt;关注官网 https://muyiy.cn，让我们成为长期关系&amp;lt;br&amp;gt;关注公众号「高级前端进阶」，公众号后台回复「加群」 加入我们一起学习并送你精心整理的高级前端面试题。&amp;lt;br&amp;gt;》》面试官都在用的题库，快来看看《《                        高级前端进阶 发起了一个读者讨论         参与讨论                                        &amp;lt;br&amp;gt;“在看”吗？在看就点一下吧&amp;lt;br&amp;gt;&quot; data-snippet-id=&quot;ext.89a96a6ef2d46757b2677de8206703d5&quot; data-snippet-saved=&quot;false&quot; data-codota-status=&quot;done&quot; data-darkmode-color-16030305897056=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(89, 89, 89)&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-darkmode-bgcolor-16018219266315=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16018219266315=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16018219266315=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16018219266315=&quot;rgb(0,0,0)&quot; data-style=&quot;padding-right: 10px; padding-left: 10px; letter-spacing: 0px; background-color: rgb(255, 255, 255); line-height: 1.6; word-break: break-word;&quot; data-darkmode-bgcolor-16020008769986=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16020008769986=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16020008769986=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16020008769986=&quot;rgb(0,0,0)&quot; data-darkmode-color-16021670869911=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16021670869911=&quot;rgb(0,0,0)&quot; data-darkmode-bgcolor-16021670869911=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16021670869911=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-16030305897056=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(89, 89, 89)&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;&lt;section data-tools=&quot;新媒体排版&quot; data-id=&quot;13777&quot; data-style-type=&quot;关注&quot; data-darkmode-color-16030305897056=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(89, 89, 89)&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;&lt;section data-darkmode-color-16030305897056=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(89, 89, 89)&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot;&gt;&lt;section data-darkmode-color-16030305897056=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16030305897056=&quot;rgb(0, 0, 0)&quot; data-style=&quot;font-family: &amp;quot;PingFang SC&amp;quot;, 微软雅黑, mp-quote, -apple-system-font, BlinkMacSystemFont, &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei UI&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; font-size: 14px; color: rgb(0, 0, 0); letter-spacing: 1.56px; font-weight: 600; line-height: 20px;&quot; data-darkmode-color-16057140139831=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(0, 0, 0)&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot; data-style=&quot;padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: rgb(89, 89, 89);&quot;&gt;&lt;span&gt;最后不要忘了点赞呦！&lt;span&gt;&lt;img data-ratio=&quot;1.0076923076923077&quot; data-type=&quot;gif&quot; data-w=&quot;260&quot; data-fileid=&quot;100022933&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_gif/H8M5QJDxMHo0BmF9r9Z5jmnjiaRjia63KdItrdfQPpQLTn685ib4pQK1j8wNibqXIQb5m7oLf2v7pke7SMTzCFVs3w/640?wx_fmt=gif&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot; data-darkmode-color-16057140139831=&quot;rgb(141, 141, 141)&quot; data-darkmode-original-color-16057140139831=&quot;rgb(89, 89, 89)&quot; data-style=&quot;padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: rgb(89, 89, 89);&quot;&gt;&lt;span&gt;祝 2022 年暴富！暴美！暴瘦！&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/section&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;
          &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>06b4de454dd71ec6aced82b1e25ff709</guid>
<title>腾讯游戏 ：我们如何基于 StarRocks 构建云原生数仓</title>
<link>https://toutiao.io/k/cp62jt4</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-role=&quot;paragraph&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;#02&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;StarRocks 存算分离方案&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;—&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;114645&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-role=&quot;title&quot; data-tools=&quot;135编辑器&quot; data-id=&quot;113983&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;strong data-original-title=&quot;&quot; title=&quot;&quot;&gt;1&lt;/strong&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;span&gt;存算分离的想法提出&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;为了简化腾讯游戏公共数据平台技术栈，提高查询效率，我们从不同维度进行了技术栈的筛选：&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;115224&quot; data-width=&quot;100%&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-autoskip=&quot;1&quot;&gt;&lt;section data-role=&quot;list&quot; data-width=&quot;100%&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;在经过一系列的对比后，我们选择 StarRocks 作为分析平台 OLAP 存储引擎，并决定与 StarRocks 社区合作，将计算层从 BE 节点剥离，形成存算分离的结构。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在当前 StarRocks 的存算一体架构中，BE 既作为存储节点，也作为计算节点负责执行查询计划任务。随着接入业务查询分析场景越来越多，定位发现很多查询的瓶颈并不在 IO，而是在计算（CPU 和内存）。因此，如果我们希望提升用户体验，就只能选择加 BE 节点。但是 BE 节点本身又是带存储的，不仅扩容时会带来数据迁移，而且扩充的存储资源也是一种资源浪费。同时，针对不同的查询分析场景，如 SQL 相对固定的报表分析以及自定义 SQL 查询，二者之间能进行节点的隔离，避免相互影响。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;综合上面两点需求，我们认为需要对 BE 节点进行改造，实现了纯计算节点 CN（Compute Node）以及 BE 数据的数据下沉，来构建存算分离后的 StarRocks 的 Serverless 架构。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;1414&quot; data-ratio=&quot;0.5898148148148148&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-width=&quot;2396&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Sq4ia0xXeMC7afaibJ9d7DHW81OiajgXY2yukbWhvYiazJqOMVBH7uoGSedhMLjHetU77pHlgLTu67XQ1p2L0eKcOQ/640?wx_fmt=png&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在拆分了存储层与计算层后，我们选择 Kubernetes 作为 StarRocks 上云的运维底座。基于 Kubernetes，我们开发了 StarRocks CRD 与 StarRocks Controller。StarRocks CRD 帮助我们可以通过声明式 yaml 文件进行 Operator 及 StarRocks 的部署，而 StarRocks Controller 帮助我们管理 pod 的状态，将现实的状态向期望状态转化。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-role=&quot;title&quot; data-tools=&quot;135编辑器&quot; data-id=&quot;113983&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;strong&gt;2&lt;/strong&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;span&gt;存算分离的具体实现&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;StarRocks 中 SQL 的生命周期&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在 StarRocks 中，FE 节点接收到客户端发起的 SQL 请求，经过 Optimizer 生成一棵分布式执行计划树，然后转换成 BE 可以直接执行的 PlanFragment，根据元信息下发到相应的 BE 节点。&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;269&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5220535068691251&quot; data-s=&quot;300,640&quot; data-type=&quot;png&quot; data-w=&quot;2766&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Sq4ia0xXeMC6iatNW4jhk0c1hbjE4qHuz0frh8KDTiciaibdibM7EMqs5qebHdOOBpKR0u13NHvChS2gV4Eia0hs0A4fA/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;以简单的聚合为例。原先 StarRocks 的逻辑是，StarRocks 会根据数据所在位置，选择对应的 BE 进行数据读取以及初次聚合操作，如果数据存在于外表中，也会由这些 BE 进行读取聚合。然后给这些 BE 一个 partition id ，将数据根据聚合的 key 进行 hash 分组，将分组后的数据分发到对应 partitionId 的 BE 上，BE 通过 ExchangeNode 接收数据进行二次聚合，完成后最终交由原先选举的 ResultSink 对应的 BE 进行最后的聚合计算。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;计算节点的拆分&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;为了将计算操作从 BE 节点中拆分出来，我们需要完成以下步骤：&lt;/span&gt;&lt;span/&gt;&lt;/section&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;113101&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-autoskip=&quot;1&quot;&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt; 1 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; &lt;span&gt;新增一种 DummyStoargeEngine 的存储引擎，不存储数据，只用来保存 StarRocks cluster&lt;/span&gt;&lt;span&gt; id &lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt; 2 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; &lt;span&gt;裁剪 BE 节点的 InternalService 和 HttpService，并支持使用空存储路径启动&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt; 3 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; &lt;span&gt;调整启动参数和新增启动脚本，支持和 BE 同时运行&lt;/span&gt; &lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;在经过拆分后，我们将 BE 的计算能力独立出去成为一个无状态的 Computer Node (CN) 节点，在设置了 CN 节点的调度参数后，整体的执行逻辑发生了变化，如下图所示：&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.7537037037037037&quot; data-s=&quot;300,640&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Sq4ia0xXeMC7afaibJ9d7DHW81OiajgXY2yGMo8iaMj0glS4Rn5GvWibuOiaDBIZ4f4xffoEhawibfAWmXDagv6wqpYPQ/640?wx_fmt=png&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;我们依然以简单的聚合操作为例：&lt;/span&gt;&lt;/p&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;113101&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-autoskip=&quot;1&quot;&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt; 1 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; OlapScanNode 会选 tablet 所在的 BE 进行数据读取以及初次聚合操作，而 HdfsScanNode 则会根据数据情况均衡地分发给 CN 进行读取与初次聚合。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt; 2 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; 为每个 CN 生成一个 partitionId，将 BE 与 CN 初次聚合后的数据根据聚合的 key 通过 hash 计算对应到 partitionId 然后发送到所在的 CN 上，CN 通过 ExchangeNode 接收数据进行二次聚合&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt; 3 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; 从这些 CN 节点选取一个作为 ResultSink，上一步完成后最终交由这台 CN 进行最后的聚合计算 &lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;Kubernetes 运维底座&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;游戏业务遇到周年庆、营销活动、节假日等节点，会伴随后端流量、日志量的激增，也会带来分析平台负载激增。CN 计算节点拆分独立后，我们进一步结合 Kubernetes（TKE）能力，打通公司算力平台，最终使得 StarRocks 具备计算层面的弹性伸缩能力。基于云原生的理念，我们通过容器化的方式来创建 CN 节点，并通过 K8s 的能力来做到快速的创建和扩缩容。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;团队实现了 StarRocks 的 Operator 自定义控制器，负责监控 k8s 集群内的自定义资源的创建、改动、销毁等事件，并触发相应的逻辑。StarRocks Operator 主要分为两个组件：&lt;/span&gt;&lt;/p&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;115224&quot; data-width=&quot;100%&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-autoskip=&quot;1&quot;&gt;&lt;section data-role=&quot;list&quot; data-width=&quot;100%&quot;&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;section data-role=&quot;list&quot;/&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;StarRocks Controller 会根据声明的信息创建 Deployment，帮助我们管理集群的状态。当我们声明式的扩容或缩容节点时，Controller 可以帮助我们将集群向期望状态转化。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;当容器启动成功以后，自动调用 FE 的接口，将这些 CN 注册到集群里面。当我们将 StarRocks 迁移到 Kubernetes 后，就可以利用 Kubernetes 原生的 HPA（Horizontal Pod Autoscale）资源对象，对 StarRocks 的 CN pod 进行动态伸缩管理，使 CN pod 可以根据资源指标实现流量变化的自适应，自动弹性地扩充新节点或者销毁不需要的节点。&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在 HPA 资源对象中，我们对 CPU、Memory 指标进行了监控，当指标发生变化时，Controller 会每 15s 检查一次指标是否发生了变化。一旦触发了伸缩条件，Controller 会向 Kuberneters 发送请求，修改 CN pod 的数量。为了避免因抖动产生过于频繁的伸缩，我们在 HPA 上做了限制，每 5 分钟，Controller 只能发送一次伸缩请求。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;1384&quot; data-ratio=&quot;0.4842592592592593&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-width=&quot;2860&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Sq4ia0xXeMC7afaibJ9d7DHW81OiajgXY2yZnEkc1Fz33BC3FI5rut0NUunUKwkTzacib13khPPDwSy84nk6tLeOTQ/640?wx_fmt=png&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;#03&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;冷热数据分层&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;—&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;在我们从 BE 节点将计算操作独立抽出成为 CN 节点后，可以通过 Kubernetes 的 HPA 功能完成 CN 节点的弹性扩缩容。同时，针对 BE 的存储功能，我们也与 StarRocks 社区一起规划设计了冷热数据分离存储的功能。为了更好存储一年甚至几年的冷数据，我们决定将 BE 节点中的冷数据下沉到 HDFS 或 COS 等更为廉价的存储。一方面期望大幅降低成本，另一方面，面向业务开发，期望湖仓技术在接下来演进中能够更好融合。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;冷数据的下沉存储&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;基于前述架构，BE Cluster 保存业务的热数据（可以根据时间，如保存近 2 个月的；也可以根据 BE 本地容量占比），非热数据则保存到底层廉价的 COS 或者 HDFS 中。&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;在实际业务中，在如下两个典型场景，我们达成了不同的资源使用及负载隔离的目的： &lt;/span&gt;&lt;/p&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;115224&quot; data-width=&quot;100%&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-autoskip=&quot;1&quot;&gt;&lt;section data-role=&quot;list&quot; data-width=&quot;100%&quot;&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;section data-role=&quot;list&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;同时，CN Cluster 集群容量，可根据分析 workload 的负载，自助一键式伸缩；或通过配置集群自动扩缩容策略，让 CN Cluster 进行自动伸缩；当探索分析场景结束后，亦可释放此次的 CN Cluster 资源，达到计算资源“按需使用”高性价比方式。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;冷热数据分层存储功能实现&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;当前选择了基于 Iceberg+(HDFS/COS) 的方案。以分区下沉方案为例，大概可分为四个步骤：&lt;/span&gt;&lt;/p&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;113101&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-autoskip=&quot;1&quot;&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt; 1 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; 在 BE 上支持导出 ORC 格式文件，生成的 ORC 格式文件通过 Broker 上传到 COS/HDFS 中&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt; 2 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; 提取生成的 ORC 文件统计信息，通过 Iceberg API 添加一个分区&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt; 3 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; 添加定时任务生成需要下沉的分区信息。当数据下沉之后，即可通过 StarRocks 进行查询分析。在上述架构中，我们初期在 Iceberg 外表功能测试中遇到了若干问题，对应的优化项均已提交开源社区，后文将有所罗列。 &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt; 4 &lt;/strong&gt;&lt;/span&gt;&lt;span&gt; 当执行查询语句时，我们通过分区元数据信息，自动判断数据存在本地还是外部存储生成不同的 ScanNode。如果需要同时获取两边的数据，则通过一个 Union 算子，将两个 ScanNode 的结果进行合并，获得全量数据。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;分层后的性能优化&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;在数据下沉及查询功能完成之后，性能压测中，我们发现存算分离相比存算一体，在业务典型业务 SQL 场景，性能差距在 50-100 倍之间。通过分析 Profile，在以下方面做了优化:&lt;/span&gt;&lt;/p&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;113101&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-autoskip=&quot;1&quot;&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;1&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt; FE 生成执行计划的时候，会多次调用 Iceberg 的 planFiles 接口来获取计算 CBO 的统计数据和 HDFS NODE 的 Range location。而这两个操作需要获取 Iceberg 的元数据，需要和远端存储交互，这也是 FE 耗时最多的地方。对此，我们也参考 Iceberg 社区，尽量减少对依赖包改动的原则下，在 StarRocks 中添加 Iceberg FILEIO cache 机制，将 Iceberg metadata.josn, manifest, manifest-list 缓存下来，加速 FE 的生成执行计划。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;2&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt; Iceberg 表频繁刷新，也会增加 100ms 左右的耗时，我们保证每条 SQL 只刷新一次，跳过其他情况下的表刷新。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;3&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt; &lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt; 调试本地和外部存储同时查询的语句时，我们发现这种查询比单独查询两边的数据都要慢，大概能有 5-8 倍的性能差异。通过定位，我们发现是生成的 Union 执行计划不优导致的。具体来说，如果原来的执行计划只有一个 ScanNode，并且上面包含 Aggregate（或者 Project）算子的时候，这个算子会被下推到 ScanNode 所在的 Fragment。而我们生成 Union 的时候，将 ScanNode 替换成了 Union，这个时候生成物理计划的时候会插入一个 ExchangeNode，这就会导致每次执行都会做一次全量数据传输。为了解决这个问题，我们优化了执行计划，将 Aggregate 的第一阶段聚合下推到了 Union 下面，从而减少了大量 Exchange 传输数据量，达到了直接查询外表相当的性能表现。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;1340&quot; data-ratio=&quot;0.562962962962963&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-width=&quot;2382&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Sq4ia0xXeMC7afaibJ9d7DHW81OiajgXY2yRfJFxryibhrgb5DicBUJ0yIuQAwmeJM4uYotW3qlRkzCGtlGOIAx7fcQ/640?wx_fmt=png&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;经过上述优化，截止目前，我们基于业务真实的 1TB，260亿行单表数据量，CN 和 BE 均投入为 12 个节点，分别对应存算分离及存算一体两条链路 ，采用典型 SQL 进行对比测试。性能差距从 50-100倍，缩减到了目前的 5-10倍。在整体方案具备按不同业务场景 ，不同 SQL 负载，可以互相隔离的前提下，达成了性能和成本平衡的初步目标。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-height=&quot;685&quot; data-ratio=&quot;0.5351851851851852&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-width=&quot;1280&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Sq4ia0xXeMC7afaibJ9d7DHW81OiajgXY2ye0QtjAjMLTwwYB1Npr6Uic9RA3oAIDibFomYPYXuftgXfg4Dyvfb1iaNg/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;#04&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;StarRocks 云原生的未来&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;—&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;存算分离是 StarRocks 迈向云原生的第一步，我们已经初步完成了：&lt;/span&gt;&lt;/p&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;115224&quot; data-width=&quot;100%&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-autoskip=&quot;1&quot;&gt;&lt;section data-role=&quot;list&quot; data-width=&quot;100%&quot;&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;独立无状态的 Compute Node 支持灵活的计算扩展。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;存储层可以在对象存储上进行灵活的资源扩展。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;Compute Node 支持在热存储（BE）和 冷存储（对象存储）上执行查询。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;通过数据下沉机制，可以实现数据在冷热存储的转储。&lt;/span&gt;&lt;span/&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;长期来看，我们会按照社区的路线图一起继续完善云原生架构：&lt;/span&gt;&lt;/section&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;115224&quot; data-width=&quot;100%&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-autoskip=&quot;1&quot;&gt;&lt;section data-role=&quot;list&quot; data-width=&quot;100%&quot;&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;支持多集群模式，能够让独立的集群完成独立的特定的任务，比如晚上有大规模 ETL 作业时可以弹性出一个专用的 ETL 集群。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;完善 Primary Key 的存算分离机制，解决秒级实时更新场景下的存算分离难题。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;持续优化缓存机制，让存算分离架构的查询性能可以媲美存算一体架构。在 Compute Node 上增加 Local cache，降低远程数据访问的延迟。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;BE 会逐步演进成一个多集群公用的 Global cache，为 Serverless 架构提供完整算子下推能力的通用查询加速层。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;实现 FE 存算分离，为更大规模的云原生数仓设计元数据管理架构。&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;269&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.44814814814814813&quot; data-s=&quot;300,640&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/Sq4ia0xXeMC7afaibJ9d7DHW81OiajgXY2yCCaWl8ayQafKx38JGWnia1RyYJs5vJTvH23pzen9aeoWqyNgHpbqGZA/640?wx_fmt=png&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;从上图可以看到，StarRocks 未来会支持两种计算分离模式，左边的模式类似 Snowflake 的架构，计算层上有一个本地的 Local cache，可以保证数据缓存命中时的高性能。&lt;/span&gt;&lt;span&gt;但是，在&lt;/span&gt;&lt;span&gt;集群做弹性的时候会导致 cache 数据的重新分布和远程加载，所以在扩容过程中会有一定的性能损失。&lt;/span&gt;&lt;span&gt;此种模式比较适合对弹性要求不高，比较适合追求极致性能的业务场景。&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;在右侧的架构中，我们在现在的计算和存储层之间增加了一个公共的全局数据缓存，可以给上层所有 Compute Node 提供包括算子下推内的计算能力。这样就可以实现秒级的弹性以及弹性过程中集群的性能稳定，同时可以针对每一个请求即时分配计算资源，计算完成以后马上释放，实现真正的 Serverless 级别的弹性伸缩。比较适合在满足性能要求下追求弹性的业务场景。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;通过支持两种计算分离模式，可以非常好地利用 StarRocks 来统一满足各类业务要求，实现“极速统一”的数据分析新范式。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;#05&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;腾讯天穹 Oteam 介绍&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;—&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;天穹是协同腾讯内各 BG 大数据能力而生的 Oteam，作为腾讯大数据领域的代名词，旨在拉通大数据各个技术组件，打造一个具有统一技术栈的公司级大数据平台体系。从底层数据接入、数据存储、资源管理、计算引擎、作业调度，到上层数据治理及数据应用等多个环节，支持腾讯内部近 EB 级数据的存储和计算，为业务提供海量、高效、稳定的大数据平台支撑和决策支持。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;#06&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;社区贡献&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;—&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;我们选择 StarRocks 作为腾讯游戏公共数据平台 OLAP 分析引擎的同时，也深刻感受到了 StarRocks 社区开放、包容、共创的开源文化。在腾讯游戏业务落地的过程中，我们还参与了 UDF 函数开发、Iceberg 外表查询优化以及 StarRocks CN Operator 等功能模块的共同开发：&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;漏斗函数&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section data-role=&quot;list&quot;/&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;外表优化&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;[#6846] Generate statistics for empty iceberg table&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;https://github.com/StarRocks/starrocks/pull/6846&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;[#6237] Support FileIO cache for iceberg table&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;https://github.com/StarRocks/starrocks/pull/6237&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;[#5680] Reduce call to get iceberg TableStatistics&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;https://github.com/StarRocks/starrocks/pull/5680&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;[#5640] Reduce Iceberg metadata refresh operation&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;https://github.com/StarRocks/starrocks/pull/5640&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;CN 节点和 FE 调度&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;  [#5441] Add Compute node to support serveless &lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;https://github.com/StarRocks/starrocks/pull/5441&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;  [#6394] Add compute node in FE&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;https://github.com/StarRocks/starrocks/pull/6394&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;StarRocks CN Operator&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;  https://github.com/StarRocks/starrocks-kubernetes-operator&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;随着更多的业务落地 StarRocks 以及更深入的使用，我们会持续在执行计划优化、物化视图、CN 节点分组逻辑等功能以及云原生数仓方向上深入建设，与大家一起在社区共创的路上行稳致远。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>b1fc78a081739228c8fe685def7d76f0</guid>
<title>从SGD到NadaMax，十种优化算法原理及实现</title>
<link>https://toutiao.io/k/ep85azx</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                       &quot; id=&quot;js_content&quot;&gt;
            &lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;span&gt;作者丨永远在你身后@知乎&lt;/span&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;span&gt;来源丨https://zhuanlan.zhihu.com/p/81020717&lt;/span&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;span&gt;编辑丨极市平台&lt;/span&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;span&gt;转自 | 极市平台&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;span title=&quot;&quot; opera-tn-ra-cell=&quot;_$.pages:0.layers:0.comps:0.title1&quot;&gt;&lt;p&gt;&lt;strong&gt;导读&lt;/strong&gt;&lt;/p&gt;&lt;/span&gt; &lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;本文总结了&lt;/span&gt;&lt;span&gt;SGD、&lt;/span&gt;&lt;span&gt;Momentum&lt;/span&gt;&lt;span&gt;Nesterov、Momentum、&lt;/span&gt;&lt;span&gt;AdaGrad...&lt;/span&gt;&lt;span&gt;等&lt;/span&gt;&lt;span&gt;十&lt;/span&gt;&lt;span&gt;种&lt;/span&gt;&lt;span&gt;优化算法，每一种算法的讲解都附有详细的公式过程以及代码实现。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;无论是什么优化算法，最后都可以用一个简单的公式抽象：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.065&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR4mAkR3V8rd2P6IfCTABPq7ZlMJzIdnfp19bErLzib9EVY5QWGjQcbuq9rWXMcSzP2/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-ratio=&quot;1&quot; data-type=&quot;svg&quot; data-w=&quot;13&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRpqn9rVtkJtBpyPtIffnia7dd9TrUBKtZqTw31JlflyTfA6xMgSj5099ZZC4h7SlcB/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 是参数，而 &lt;/span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5862068965517241&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR0RCqEvYictPOf3zVSmAFY3mcMBE2JEgH0WYtZ5dv5aiaKyFGYN8Q3G7tacACqjREf2/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;29&quot;/&gt;&lt;span&gt; 是参数的增量，而各种优化算法的主要区别在于对 &lt;/span&gt;&lt;img data-ratio=&quot;0.5862068965517241&quot; data-type=&quot;svg&quot; data-w=&quot;29&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR0RCqEvYictPOf3zVSmAFY3mcMBE2JEgH0WYtZ5dv5aiaKyFGYN8Q3G7tacACqjREf2/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 的计算不同，本文总结了下面十个优化算法的公式，以及简单的Python实现：&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;SGD&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Momentum&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Nesterov Momentum&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;AdaGrad&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;RMSProp&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;AdaDelta&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Adam&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;AdaMax&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Nadam&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;NadaMax&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/p&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;SGD&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;虽然有凑数的嫌疑，不过还是把SGD也顺带说一下，就算做一个符号说明了。常规的随机梯度下降公式如下：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.06666666666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRwAvxsSQs1tjmQfxfISOibCIgkd7BCFdZG8SxxlquE5vibdWqYoZQHLGBjkMQoUib7Sic/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;其中 &lt;/span&gt;&lt;img data-ratio=&quot;1.8888888888888888&quot; data-type=&quot;svg&quot; data-w=&quot;9&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR8sGZb20s3hGeYtmuLOPlenOge4oXdjt3ibG176bXJLtbrkcAwzarQ59QGTW8KibW50/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 是学习率， &lt;/span&gt;&lt;img data-ratio=&quot;0.5333333333333333&quot; data-type=&quot;svg&quot; data-w=&quot;45&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR5dYz5N3bG4c6USGsuWBVPvbPMkibjicpW712FlPMcBxZy1mTFcdU7uHzFbYricEia5CD/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 是损失关于参数的梯度（有的资料中会写成 &lt;/span&gt;&lt;img data-ratio=&quot;0.3484848484848485&quot; data-type=&quot;svg&quot; data-w=&quot;66&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRZXbGuMV7abN6MNkQzsCs1Sfo79LeU90c4KSa5EsNTvzfVMHHw606YEjIZYiacPoicE/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 等形式），不过相比SGD，用的更多的还是小批量梯度下降（mBGD）算法，不同之处在于一次训练使用多个样本，然后取所有参与训练样本梯度的平均来更新参数，公式如下：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.14833333333333334&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRdrTJvgMwbic1iaZ3WsQ7DtciaNYI4wribaFDOFXbfLVqjksoeiaYQX4J5IMiaghY9qfSFY/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;其中 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR5NUBkTdRhicQZgzHwTZNQXRBgFDNPzY2rEW2GZNeNCia3Tv4NaahJrBhmQGXeJwibMV/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 是第 &lt;/span&gt;&lt;img data-ratio=&quot;2.8333333333333335&quot; data-type=&quot;svg&quot; data-w=&quot;6&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRj7UAwosn53KIIFpPrZDjeb3UdJvZjktJMXr9iaBNNibzjIf2P8UWczUVfP1TqnHibgU/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 次训练中 &lt;/span&gt;&lt;img data-ratio=&quot;0.8125&quot; data-type=&quot;svg&quot; data-w=&quot;16&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRtD2ia5mIuKrsrCbkTZ6EksoqDah4gadpn2YbvrnM27ouwxhCBTibF04VRtCFT2Czqy/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 个样本损失关于参数梯度的均值，如无特别声明，下文所出现 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR5NUBkTdRhicQZgzHwTZNQXRBgFDNPzY2rEW2GZNeNCia3Tv4NaahJrBhmQGXeJwibMV/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 也遵循该定义&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;另外 &lt;/span&gt;&lt;img data-ratio=&quot;0.5333333333333333&quot; data-type=&quot;svg&quot; data-w=&quot;45&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR5dYz5N3bG4c6USGsuWBVPvbPMkibjicpW712FlPMcBxZy1mTFcdU7uHzFbYricEia5CD/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 或者 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR5NUBkTdRhicQZgzHwTZNQXRBgFDNPzY2rEW2GZNeNCia3Tv4NaahJrBhmQGXeJwibMV/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 在下面的优化算法中，只是作为一个传入的变量，其具体的计算是由其他模块负责，可以参考下面两个链接：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h1&gt;&lt;span&gt;Numpy实现神经网络框架(3)——线性层反向传播推导及实现&lt;/span&gt;&lt;/h1&gt;&lt;section&gt;&lt;span&gt;https://zhuanlan.zhihu.com/p/67854272&lt;/span&gt;&lt;/section&gt;&lt;h1&gt;&lt;span&gt;卷积核梯度计算的推导及实现&lt;/span&gt;&lt;/h1&gt;&lt;section&gt;&lt;span&gt;https://zhuanlan.zhihu.com/p/64248652&lt;/span&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;p&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/p&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;Momentum&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Momentum，也就是动量的意思。该算法将梯度下降的过程视为一个物理系统，下图是在百度图片中找的（侵删）&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5432432432432432&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/gYUsOT36vfpr8aj9kd5kicSCgxQg4mSMv9HniblHcibvX6HAT7f4ahjyqdj2Yibq8oYNibToiaBKZq5zCnYuxkjqCdaw/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;jpeg&quot; data-w=&quot;740&quot;/&gt;&lt;section&gt;&lt;span&gt;图片来自网络&lt;/span&gt;&lt;/section&gt;&lt;/figure&gt;&lt;section&gt;&lt;span&gt;如上图所示，在该物理系统中有一个小球（质点），它所处的水平方向的位置对应为 &lt;/span&gt;&lt;img data-ratio=&quot;1&quot; data-type=&quot;svg&quot; data-w=&quot;13&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRpqn9rVtkJtBpyPtIffnia7dd9TrUBKtZqTw31JlflyTfA6xMgSj5099ZZC4h7SlcB/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 的值，而垂直方向对应为损失。设其质量 &lt;/span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.34&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRjbMKdFkvprR2vDwh92EJvtZCch3OQFFT1r9amiaiag4fArMNE3ibmqBpeyOTFxNn8Jy/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;50&quot;/&gt;&lt;span&gt; ，在第 &lt;/span&gt;&lt;img data-ratio=&quot;2.8333333333333335&quot; data-type=&quot;svg&quot; data-w=&quot;6&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRj7UAwosn53KIIFpPrZDjeb3UdJvZjktJMXr9iaBNNibzjIf2P8UWczUVfP1TqnHibgU/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 时刻，在单位时间内，该质点受外力而造成的动量改变为：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.095&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRTCS9PzIicJHic1hshKnkc1V3HtKZUVpWiacXhXWFCPLzMgL7Fz5icsh48r7B3DWRxO8S/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;(1.1)到(1.2)是因为 &lt;/span&gt;&lt;img data-ratio=&quot;0.20202020202020202&quot; data-type=&quot;svg&quot; data-w=&quot;99&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRwW9ADbwxpgkdo3KqFyuYaagks2UbWk0ymb9EYuwe86HH2ZXiaB1dYWianCiccKoSj5Q/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，所以约去了。另外受到的外力可以分为两个分量：&lt;span&gt;重力&lt;/span&gt;沿斜面向下的力 &lt;/span&gt;&lt;img data-ratio=&quot;1&quot; data-type=&quot;svg&quot; data-w=&quot;20&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRGiaaUa38GoKaArorvvDTLzNw3dAdnObLWEs2Ubd4cddHicVkKOIqR6Uo3icDRYpYkyW/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 和&lt;span&gt;粘性阻尼力&lt;/span&gt; &lt;/span&gt;&lt;img data-ratio=&quot;1&quot; data-type=&quot;svg&quot; data-w=&quot;20&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRuica37T6eJUPyibQuicvoB2uRuOpW1UmJaRIBGoicf9K91W2GdLMoNE0SZgmsBbwS81e/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.09166666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRBGrmsYWsItfr5ibhN4FpUZrwSHnUkFaK9UjDlGnF3WsKwMPP3zcKEx3ichyJHHW9hB/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;令&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.065&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRslZwKvu3pzglq7gPibzZibMUA5MuvkiaewfR3Z2GKNIC9ddcFpPTd7BTyFfqgWmLVor/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;代入(1.2)式中：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.09166666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRFFvKeAvhbxJaL4ZSNumDiaAd9PE8VK9eqiaI2JyxglhmTWCq9uX5b37Y0lK87XV7w6/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;然后对“位置”进行更新：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.09166666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRzFia2crbG5Mur0tD83aCLOCt04mzqPByCKkL0R6HvrKWM2vVWB88FPm76V8NJ9yrS/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;所以这里 &lt;/span&gt;&lt;img data-ratio=&quot;0.2898550724637681&quot; data-type=&quot;svg&quot; data-w=&quot;69&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRQf1ZQY52RhzMgK1ibyibuMnGAwo15iaqOJBCicibkhUsZhHzmaXF7YyNZ8U6NDc2qCtUX/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; ，另外 &lt;/span&gt;&lt;img data-ratio=&quot;1&quot; data-type=&quot;svg&quot; data-w=&quot;20&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRGiaaUa38GoKaArorvvDTLzNw3dAdnObLWEs2Ubd4cddHicVkKOIqR6Uo3icDRYpYkyW/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 的方向与损失的梯度方向相反，并取系数为 &lt;/span&gt;&lt;img data-ratio=&quot;1.8888888888888888&quot; data-type=&quot;svg&quot; data-w=&quot;9&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR8sGZb20s3hGeYtmuLOPlenOge4oXdjt3ibG176bXJLtbrkcAwzarQ59QGTW8KibW50/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; ，得到：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.065&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRC1v0tQKP0IswFUgTC1ccUXToshQiaWEUQOIWKHqCZ7kB0wOEGsFG61tCpG8B56Dz1/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;代入(1.4)，得到速度的更新公式：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.06666666666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR58gVo98uJehibWswy6eNOU0nBsMffEAbE1QUnLGBib5So5s1no8C29iaGMeGicDodpAW/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;进一步的，将(1.6)式展开，可以得到：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.425&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRjsPUwozH8hq7iaXVWIgnia6F0VsggYdXibA2EYFxSaoB6osc0QMzQohaT9ohTB4z1KN/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;可以看出来是一个变相的等比数列之和，且公比小于1，所以存在极限，当 &lt;/span&gt;&lt;img data-ratio=&quot;2.8333333333333335&quot; data-type=&quot;svg&quot; data-w=&quot;6&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRj7UAwosn53KIIFpPrZDjeb3UdJvZjktJMXr9iaBNNibzjIf2P8UWczUVfP1TqnHibgU/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 足够大时， &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRkwOcB7IzFxcPToEhFkyB1VwzFSwV5cFPokLPkPOX4JueRRicOgNWcr8JAlQlAlwWR/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 趋近于 &lt;/span&gt;&lt;img data-ratio=&quot;0.6666666666666666&quot; data-type=&quot;svg&quot; data-w=&quot;60&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRkNsnubIPI6sVib3zqJSLnwXadw0AAUpBkzjs5fvBiaWnWHhicYNc6mHGG3xpLEehtSp/640?wx_fmt=svg&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;实现代码&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;pre&gt;&lt;section&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;import&lt;/span&gt; &lt;span&gt;numpy&lt;/span&gt; &lt;span&gt;as&lt;/span&gt; &lt;span&gt;np&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;Momentum&lt;/span&gt;(&lt;span&gt;object&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, alpha&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.9&lt;/span&gt;, lr&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-3&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;=&lt;/span&gt; alpha  &lt;span&gt;# 动量系数&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;=&lt;/span&gt; lr        &lt;span&gt;# 学习率&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;v &lt;span&gt;=&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;          &lt;span&gt;# 初始速度为0&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;update&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, g: np&lt;span&gt;.&lt;/span&gt;ndarray):    &lt;span&gt;# g = J&#x27;(w) 为本轮训练参数的梯度&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;v &lt;span&gt;=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;v &lt;span&gt;-&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;*&lt;/span&gt; g  &lt;span&gt;# 公式&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;return&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;v    &lt;span&gt;# 返回的是参数的增量，下同&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;以上是基于&lt;span&gt;指数衰减&lt;/span&gt;的实现方式，另外有的Momentum算法中会使用&lt;span&gt;指数加权平均&lt;/span&gt;来实现，主要公式如下：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.09333333333333334&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRdsDJW5KcCFqXt8FrcRqMfvtejFQ48ico3X3pvmiaicLicywFWyL6evqTF12VmVFE7bHE/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;不过该方式因为 &lt;/span&gt;&lt;img data-ratio=&quot;0.38461538461538464&quot; data-type=&quot;svg&quot; data-w=&quot;52&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRXEIPzZ8aSytiadhqnqAW2Ied35lb6ficicPgLTpPX4AyASibib94VXcQ4XfG1H0bz99rJ/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，刚开始时 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRkwOcB7IzFxcPToEhFkyB1VwzFSwV5cFPokLPkPOX4JueRRicOgNWcr8JAlQlAlwWR/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 会比期望值要小，需要进行修正，下面的Adam等算法会使用该方式&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;Nesterov Momentum&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Nesterov Momentum是Momentum的改进版本，与Momentum唯一区别就是，Nesterov先用当前的速度 &lt;/span&gt;&lt;img data-ratio=&quot;1.4444444444444444&quot; data-type=&quot;svg&quot; data-w=&quot;9&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRXiawSTicbiadoz5KxXOWZs5F4v6bO9YrSGj9KAuHWB2xrxECMkINEDw7WtwNRTbsDKG/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 更新一遍参数，得到一个临时参数 &lt;/span&gt;&lt;img data-ratio=&quot;1.3076923076923077&quot; data-type=&quot;svg&quot; data-w=&quot;13&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRMgLlxwRWouUKN7rNCplPOibZcJgGqNvf0BMz4njImNtZwXjo9Qyxdic6Slz9r4CzFz/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，然后使用这个临时参数计算本轮训练的梯度。相当于是小球预判了自己下一时刻的位置，并提前使用该位置的梯度更新 ：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.175&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRVhV86EpPYHqq5DP0dQkU9S8MrqraZw0M0xqVljicN8mprnSaA4RVtOBgKavppHtzu/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;为了更加直观，还是上几个图吧，以下是Momentum算法 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRkwOcB7IzFxcPToEhFkyB1VwzFSwV5cFPokLPkPOX4JueRRicOgNWcr8JAlQlAlwWR/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 的更新过程：&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7913907284768212&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/gYUsOT36vfpr8aj9kd5kicSCgxQg4mSMvAgiad4x6B4wnUefvWB9hPPYSJGhYcibk5YmVlHCVhmQIPq3JjSibZey2g/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;jpeg&quot; data-w=&quot;302&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;假设下一个位置的梯度如下：&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5960698689956332&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/gYUsOT36vfpr8aj9kd5kicSCgxQg4mSMvkQr3JicOzlxmuuuvy6uOTXLcVEDHvbYrHRO4zwtR6snlN7qpzldfWvw/640?wx_fmt=jpeg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;jpeg&quot; data-w=&quot;458&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;那么Nesterov Momentum就提前使用这个梯度进行更新：&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.74&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/gYUsOT36vfpr8aj9kd5kicSCgxQg4mSMvwxC2P1FmJKT2FWNFubqf3Gn4jbVRAvHEG1c3iaDWaibL2AhQJZtTkWWQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;300&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;整体来看Nesterov的表现要好于Momentum，至于代码实现的话因为主要变化的是 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR5NUBkTdRhicQZgzHwTZNQXRBgFDNPzY2rEW2GZNeNCia3Tv4NaahJrBhmQGXeJwibMV/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; ，所以可以之前使用Momentum的代码&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;AdaGrad&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;AdaGrad全称为Adaptive Subgradient，其主要特点在于不断累加每次训练中梯度的平方，公式如下：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.175&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR7AtJbOCGiaXb35lIXq2MO4x2wJT9ZS6amib9EF72RicCeoczCvvZZ3ibl8sxlGZAfYgib/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;其中 &lt;/span&gt;&lt;img data-ratio=&quot;1.625&quot; data-type=&quot;svg&quot; data-w=&quot;8&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRbibFXY7heRaHbes5YKyaibYS8gbKibdNriamqRvGUMiahpOKE2nricNGr6HGw8OpT4HzQA/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 是一个极小的正数，用来防止除0，而 &lt;/span&gt;&lt;img data-ratio=&quot;0.2631578947368421&quot; data-type=&quot;svg&quot; data-w=&quot;95&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR9APCBnQIuDe3VIID3BN0yVZ3uubXwTIzgglSibBgT6bh7JS4st9GyXUiamw4zdhsZib/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ， &lt;/span&gt;&lt;img data-ratio=&quot;1.2142857142857142&quot; data-type=&quot;svg&quot; data-w=&quot;14&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRiaic53TpWKvt9TPr29QoO3TbSGl2IMLyRRTiby8wJhzasicI3cyN6CG4zhLXJiby3x0KW/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 是矩阵的&lt;span&gt;哈达玛积&lt;/span&gt;运算符，另外，本文中矩阵的平方或者两矩阵相乘都是计算哈达玛积，而不是计算矩阵乘法&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;从公式中可以看出，随着算法不断迭代， &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRUq1gXvcZiceAfCpRV38BX6GyNhHUxqnLnic5PLsGWAuI0HFKeOOt1juSY3o7Kaiauch/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 会越来越大，整体的学习率会越来越小。所以，一般来说AdaGrad算法一开始是激励收敛，到了后面就慢慢变成惩罚收敛，速度越来越慢&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;对于代码实现，首先将 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRUq1gXvcZiceAfCpRV38BX6GyNhHUxqnLnic5PLsGWAuI0HFKeOOt1juSY3o7Kaiauch/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 展开得到：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.25166666666666665&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR25HEjaBoDPa0jiaVkqvD5zxtoT0Lwia8JiacXC0DicXy40rTF6ocibtIlMu4pCMIm6oaL/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;通常 &lt;/span&gt;&lt;img data-ratio=&quot;0.39215686274509803&quot; data-type=&quot;svg&quot; data-w=&quot;51&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRqM4TZrKYXhNRSJXPJSB2INia8gUgZ7T8kZKS1e004a0g95cEs6mz3ibsDeNtkVSOOM/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，所以在第一次训练时(2.2)式为：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.16166666666666665&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRT7WdIUlVQuY9OT2LpqyYolzKJmwicQPSzKWacqOzibcbnT0gbbVJgTEMibVjibQYYbaT/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;因为每次训练 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR5NUBkTdRhicQZgzHwTZNQXRBgFDNPzY2rEW2GZNeNCia3Tv4NaahJrBhmQGXeJwibMV/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 的值是不确定的，所以要防止处0，但是可以令 &lt;/span&gt;&lt;img data-ratio=&quot;0.32653061224489793&quot; data-type=&quot;svg&quot; data-w=&quot;49&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRxOJAxprKHhWuhbrJwroP0AO3x0s2n3WhNf1sM1KUL91JhfrUNEhx9cUd4w0TwDFh/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，这样就可以在(2.2)式中去掉 &lt;/span&gt;&lt;img data-ratio=&quot;1.625&quot; data-type=&quot;svg&quot; data-w=&quot;8&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRbibFXY7heRaHbes5YKyaibYS8gbKibdNriamqRvGUMiahpOKE2nricNGr6HGw8OpT4HzQA/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; &lt;/span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.09166666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRvh2YLKHB11Gs0WnIib3dIy8lCA6y5ZibjgOxMlib7J5HForGY7cOsgriaM9RvExBichrV/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;将 &lt;/span&gt;&lt;img data-ratio=&quot;0.32653061224489793&quot; data-type=&quot;svg&quot; data-w=&quot;49&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRxOJAxprKHhWuhbrJwroP0AO3x0s2n3WhNf1sM1KUL91JhfrUNEhx9cUd4w0TwDFh/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 代入(2.3)式，可以得到：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.22&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRrDfXTvVOXB8zX73vMAH5pnQxNYk3JeIgFXRn7XVBg49ghUoeUEI4ptCADmeHBZMq/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;可知 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRUq1gXvcZiceAfCpRV38BX6GyNhHUxqnLnic5PLsGWAuI0HFKeOOt1juSY3o7Kaiauch/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 恒大于0，因此不必在计算 &lt;/span&gt;&lt;img data-ratio=&quot;0.5862068965517241&quot; data-type=&quot;svg&quot; data-w=&quot;29&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR0RCqEvYictPOf3zVSmAFY3mcMBE2JEgH0WYtZ5dv5aiaKyFGYN8Q3G7tacACqjREf2/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 中额外加入 &lt;/span&gt;&lt;img data-ratio=&quot;1.625&quot; data-type=&quot;svg&quot; data-w=&quot;8&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRbibFXY7heRaHbes5YKyaibYS8gbKibdNriamqRvGUMiahpOKE2nricNGr6HGw8OpT4HzQA/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，代码如下：&lt;/span&gt;&lt;/section&gt;&lt;pre&gt;&lt;section&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;AdaGrad&lt;/span&gt;(&lt;span&gt;object&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, eps&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-8&lt;/span&gt;, lr&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-3&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; eps    &lt;span&gt;# r_0 = epsilon&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;=&lt;/span&gt; lr&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;update&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, g: np&lt;span&gt;.&lt;/span&gt;ndarray):&lt;br data-filtered=&quot;filtered&quot;/&gt;        r &lt;span&gt;=&lt;/span&gt; r &lt;span&gt;+&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;square(g)&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;return&lt;/span&gt; &lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;*&lt;/span&gt; g &lt;span&gt;/&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;sqrt(r)&lt;/span&gt;&lt;/code&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;RMSProp&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;RMSProp是AdaGrad的改进算法，其公式和AdaGrad的区别只有 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRUq1gXvcZiceAfCpRV38BX6GyNhHUxqnLnic5PLsGWAuI0HFKeOOt1juSY3o7Kaiauch/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 的计算不同，先看公式&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.175&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRglQib3Fo1xoCfzPPUoz3F9PQGUrvUmlavgR4tKYqGnibh0XeBG6IicZhOyB32QQjy2C/640?wx_fmt=svg&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;可以看出，与AdaGrad不同，RMSProp只会累积近期的梯度信息，对于“遥远的历史”会以指数衰减的形式放弃&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;并且AdaGrad算法虽然在&lt;span&gt;凸函数&lt;/span&gt;(Convex Functions)上表现较好，但是当目标函数非凸时，算法梯度下降的轨迹所经历的结构会复杂的多，早期梯度对当前训练没有太多意义，此时RMSProp往往表现更好&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;以下是将 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRUq1gXvcZiceAfCpRV38BX6GyNhHUxqnLnic5PLsGWAuI0HFKeOOt1juSY3o7Kaiauch/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 展开后的公式：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.15833333333333333&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRuV2zLrppB9TXSSgAQzSI3bbV0Z0BZqeibZMUjKvSnXKiceByaLuhsCDq2wOPiaUdO5s/640?wx_fmt=svg&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;与AdaGrad一样，令 &lt;/span&gt;&lt;img data-ratio=&quot;0.32653061224489793&quot; data-type=&quot;svg&quot; data-w=&quot;49&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRxOJAxprKHhWuhbrJwroP0AO3x0s2n3WhNf1sM1KUL91JhfrUNEhx9cUd4w0TwDFh/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; ，从而去掉计算 &lt;/span&gt;&lt;img data-ratio=&quot;0.5862068965517241&quot; data-type=&quot;svg&quot; data-w=&quot;29&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR0RCqEvYictPOf3zVSmAFY3mcMBE2JEgH0WYtZ5dv5aiaKyFGYN8Q3G7tacACqjREf2/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 时的 &lt;/span&gt;&lt;img data-ratio=&quot;1.625&quot; data-type=&quot;svg&quot; data-w=&quot;8&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRbibFXY7heRaHbes5YKyaibYS8gbKibdNriamqRvGUMiahpOKE2nricNGr6HGw8OpT4HzQA/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; ，实现代码：&lt;/span&gt;&lt;/section&gt;&lt;pre&gt;&lt;section&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RMSProp&lt;/span&gt;(&lt;span&gt;object&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, lr&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-3&lt;/span&gt;, beta&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.999&lt;/span&gt;, eps&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-8&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; eps&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;=&lt;/span&gt; lr&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;=&lt;/span&gt; beta&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;update&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, g: np&lt;span&gt;.&lt;/span&gt;ndarray):&lt;br data-filtered=&quot;filtered&quot;/&gt;        r &lt;span&gt;=&lt;/span&gt; r &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;+&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta) &lt;span&gt;*&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;square(g)&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;return&lt;/span&gt; &lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;*&lt;/span&gt; g &lt;span&gt;/&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;sqrt(r)&lt;/span&gt;&lt;/code&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;AdaDelta&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;AdaDelta是与RMSProp相同时间对立发展出来的一个算法，在实现上可以看作是RMSProp的一个变种，先看公式：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.23333333333333334&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRjsPUwozH8hqosJjlSKrLWTfc4P5lWhLgibmJxiaABsNCVqs1XlWQ6r6cibicn9rtM0Wh/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;可以看到该算法不需要设置学习率 &lt;/span&gt;&lt;img data-ratio=&quot;1.8888888888888888&quot; data-type=&quot;svg&quot; data-w=&quot;9&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR8sGZb20s3hGeYtmuLOPlenOge4oXdjt3ibG176bXJLtbrkcAwzarQ59QGTW8KibW50/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，这是该算法的一大优势。除了同样以 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRUq1gXvcZiceAfCpRV38BX6GyNhHUxqnLnic5PLsGWAuI0HFKeOOt1juSY3o7Kaiauch/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 来累积梯度的信息之外，该算法还多了一个 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRpWpIlA6HZGvJxyBNz7xCfrYjy2Pdbib2CbEtNiaCgk7jAic7dHd35qf3OCkFu1AzWtA/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 以指数衰减的形式来累积 &lt;/span&gt;&lt;img data-ratio=&quot;0.5862068965517241&quot; data-type=&quot;svg&quot; data-w=&quot;29&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR0RCqEvYictPOf3zVSmAFY3mcMBE2JEgH0WYtZ5dv5aiaKyFGYN8Q3G7tacACqjREf2/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 的信息&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;与前面相同，令：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.095&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRjVp7DrNFqtZ2AYtgf2CVBgPtWGicIz1ib6umyibZMvAqG6ibtN3MNX5SGPlvbx4cVrzF/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;然后去掉(3.1)中的 &lt;/span&gt;&lt;img data-ratio=&quot;1.625&quot; data-type=&quot;svg&quot; data-w=&quot;8&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRbibFXY7heRaHbes5YKyaibYS8gbKibdNriamqRvGUMiahpOKE2nricNGr6HGw8OpT4HzQA/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，得到：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.24666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR5XZ7KJjzlyQxv1xib0Uh6WIJrjOhsHMlIesX83en9FtNansBb8ONELo8fb4bTd4wt/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;这样的话可以减少一些计算，代码如下：&lt;/span&gt;&lt;/section&gt;&lt;pre&gt;&lt;section&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;AdaDelta&lt;/span&gt;(&lt;span&gt;object&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, beta&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.999&lt;/span&gt;, eps&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-8&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; eps&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;=&lt;/span&gt; eps&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;=&lt;/span&gt; beta&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;update&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, g: np&lt;span&gt;.&lt;/span&gt;ndarray):&lt;br data-filtered=&quot;filtered&quot;/&gt;        g_square &lt;span&gt;=&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta) &lt;span&gt;*&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;square(g)     &lt;span&gt;# (1-beta)*g^2&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        r &lt;span&gt;=&lt;/span&gt; r &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;+&lt;/span&gt; g_square&lt;br data-filtered=&quot;filtered&quot;/&gt;        frac &lt;span&gt;=&lt;/span&gt; s &lt;span&gt;/&lt;/span&gt; r&lt;br data-filtered=&quot;filtered&quot;/&gt;        res &lt;span&gt;=&lt;/span&gt; &lt;span&gt;-&lt;/span&gt;np&lt;span&gt;.&lt;/span&gt;sqrt(frac) &lt;span&gt;*&lt;/span&gt; g&lt;br data-filtered=&quot;filtered&quot;/&gt;        s &lt;span&gt;=&lt;/span&gt; s &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;+&lt;/span&gt; frac &lt;span&gt;*&lt;/span&gt; g_squaretmp      &lt;span&gt;# 少一次乘法。。。&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;return&lt;/span&gt; res&lt;/span&gt;&lt;/code&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;关于以上几个算法的对比：&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7741935483870968&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_gif/gYUsOT36vfpr8aj9kd5kicSCgxQg4mSMvx6Mp6iaUjcz2JvqJ3OaEa38YWFAF9QQQvtZPpDB1iaDo8AlE6FH8CL6g/640?wx_fmt=gif&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;gif&quot; data-w=&quot;620&quot;/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;section&gt;&lt;span&gt;其中NAG是Nesterov Momentum&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7741935483870968&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_gif/gYUsOT36vfpr8aj9kd5kicSCgxQg4mSMvjk4OGs1b8aWwqsELMRp1dI2ic5GreP4ag7EwGFrPdZsUnAltibh0Klzg/640?wx_fmt=gif&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;gif&quot; data-w=&quot;620&quot;/&gt;&lt;/p&gt;&lt;/figure&gt;&lt;section&gt;&lt;span&gt;更多关于AdaDelta的信息，可以参考这篇文章：自适应学习率调整：AdaDelta（&lt;/span&gt;&lt;span&gt;https://www.cnblogs.com/neopenx/p/4768388.html&lt;/span&gt;&lt;span&gt;）&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;Adam&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Adam的名称来自Adaptive Momentum，可以看作是Momentum与RMSProp的一个结合体，该算法通过计算梯度的一阶矩估计和二阶矩估计而为不同的参数设计独立的自适应性学习率，公式如下：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.375&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRTsLFntmEYWKZZAvlVn8UrWOibDJgYHCO1ZFQic0CnWZWffrErDo965ERIrYYYbXUtR/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;(4.1)和(4.2)在Momentum和RMSProp中已经介绍过了，而不直接使用 &lt;/span&gt;&lt;img data-ratio=&quot;0.42105263157894735&quot; data-type=&quot;svg&quot; data-w=&quot;38&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRY29yogCjxibND1YPlFvIcbv7MtqWFHjzWr07euPvDhgiaDGZibxRZGaEPGzqOVJ6OYs/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 计算 &lt;/span&gt;&lt;img data-ratio=&quot;0.5862068965517241&quot; data-type=&quot;svg&quot; data-w=&quot;29&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR0RCqEvYictPOf3zVSmAFY3mcMBE2JEgH0WYtZ5dv5aiaKyFGYN8Q3G7tacACqjREf2/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 却先经过(4.3)和(4.4)式是因为通常会设 &lt;/span&gt;&lt;img data-ratio=&quot;0.21505376344086022&quot; data-type=&quot;svg&quot; data-w=&quot;93&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR4hoQOZb1NetkCQEL31kmscR0CZWApBzTRtllWa7OmOd4ibLuX6icnVtibXgykoGJBfN/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，所以此时梯度的一阶矩估计和二阶矩估是有偏的，需要进行修正&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;虽然没办法避免修正计算，但是还是可以省去一些计算过程，初始化时令：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.10166666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRFiag6A1gaticRneLWfhiaQclIxr7qAyIr8Iveia5EdVHIpdjd6uExzojYRjaPPmkuk66/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;然后(4.5)式变为：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.19333333333333333&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRSjuScs9wPtMibBVvBbgFHzibIOyZq1sqD3qJAw0hWcD3SqKIWsGvMNRf93NSibzYhwl/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;因为 &lt;/span&gt;&lt;img data-ratio=&quot;0.3076923076923077&quot; data-type=&quot;svg&quot; data-w=&quot;65&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRBXh2B9LBIj6GtZxUWCDaX2VIfofkZ4aknKYicsryCqsSRZGXibueyIia6VUFQib5zaHV/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，可知当 &lt;/span&gt;&lt;img data-ratio=&quot;2.8333333333333335&quot; data-type=&quot;svg&quot; data-w=&quot;6&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRj7UAwosn53KIIFpPrZDjeb3UdJvZjktJMXr9iaBNNibzjIf2P8UWczUVfP1TqnHibgU/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 足够大时修正将不起作用（也不需要修正了）：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRjoZWgJWGL7c2F14JIgnuwYGJwAQGDuiaXyLWmWzefQKscPHHic6mesbhFekQcI6ibIQ/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;代码如下：&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;pre&gt;&lt;section&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;Adam&lt;/span&gt;(&lt;span&gt;object&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, lr&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-3&lt;/span&gt;, alpha&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.9&lt;/span&gt;, beta&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.999&lt;/span&gt;, eps&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-8&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;=&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; eps&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;=&lt;/span&gt; lr&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;=&lt;/span&gt; alpha&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;=&lt;/span&gt; beta&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i &lt;span&gt;=&lt;/span&gt; &lt;span&gt;1&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta_i &lt;span&gt;=&lt;/span&gt; &lt;span&gt;1&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;update&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, g: np&lt;span&gt;.&lt;/span&gt;ndarray):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;+&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha) &lt;span&gt;*&lt;/span&gt; g&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;+&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta) &lt;span&gt;*&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;square(g)&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i &lt;span&gt;*=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta_i &lt;span&gt;*=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta_i&lt;br data-filtered=&quot;filtered&quot;/&gt;        lr &lt;span&gt;=&lt;/span&gt; &lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;*&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta_i)&lt;span&gt;**&lt;/span&gt;&lt;span&gt;0.5&lt;/span&gt; &lt;span&gt;/&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i)&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;return&lt;/span&gt; lr &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;/&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;sqrt(&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r)&lt;/span&gt;&lt;/code&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;AdaMax&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;首先回顾RSMSProp中 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRUq1gXvcZiceAfCpRV38BX6GyNhHUxqnLnic5PLsGWAuI0HFKeOOt1juSY3o7Kaiauch/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 的展开式并且令 &lt;/span&gt;&lt;img data-ratio=&quot;0.39215686274509803&quot; data-type=&quot;svg&quot; data-w=&quot;51&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRqM4TZrKYXhNRSJXPJSB2INia8gUgZ7T8kZKS1e004a0g95cEs6mz3ibsDeNtkVSOOM/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ，得到：&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.15833333333333333&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRzEzWh2Pm2asZicWzSuvKshLQOdfib6xiaKAvFZuumuGALCoLJVu7XJ5z2icicVNcT1szn/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;可以看到这相当于是一个 &lt;/span&gt;&lt;img data-ratio=&quot;1.1875&quot; data-type=&quot;svg&quot; data-w=&quot;16&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR142ADBxjCHOUfNQhgrCkpbH2HYnqwMBibFwPKyibaicgN5yZr5IUPouN1sKAjLibycX2/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 的 &lt;/span&gt;&lt;img data-ratio=&quot;0.9523809523809523&quot; data-type=&quot;svg&quot; data-w=&quot;21&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRqY2ViaHNNGdPZGlibZAqbFW4bIuc17H2aKlLLmJXVtYga7WPSX30xU62bQ6creZ6dS/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 范数，也就是说 &lt;/span&gt;&lt;img data-ratio=&quot;1&quot; data-type=&quot;svg&quot; data-w=&quot;13&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRpqn9rVtkJtBpyPtIffnia7dd9TrUBKtZqTw31JlflyTfA6xMgSj5099ZZC4h7SlcB/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 的各维度的增量是根据该维度上梯度的 &lt;/span&gt;&lt;img data-ratio=&quot;0.9523809523809523&quot; data-type=&quot;svg&quot; data-w=&quot;21&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRqY2ViaHNNGdPZGlibZAqbFW4bIuc17H2aKlLLmJXVtYga7WPSX30xU62bQ6creZ6dS/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 范数的累积量进行缩放的。如果用 &lt;/span&gt;&lt;img data-ratio=&quot;1.0952380952380953&quot; data-type=&quot;svg&quot; data-w=&quot;21&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRKuBicBe7JYWzQUvqJ0ybJA0y23bAIEjZZjfVIFUeHUf1ZTaicYr4D9RKJNcwyFgEAV/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 范数替代就得到了Adam的不同变种，不过其中 &lt;/span&gt;&lt;img data-ratio=&quot;0.7142857142857143&quot; data-type=&quot;svg&quot; data-w=&quot;28&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRC1m4I0DUBDor4CicsNak6axmLdGn1Lhnqmx0e9ZIiaeQkcFf0BOAbZvFwQg8rMG13a/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 范数对应的变种算法简单且稳定&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;对于 &lt;/span&gt;&lt;img data-ratio=&quot;1.0952380952380953&quot; data-type=&quot;svg&quot; data-w=&quot;21&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRKuBicBe7JYWzQUvqJ0ybJA0y23bAIEjZZjfVIFUeHUf1ZTaicYr4D9RKJNcwyFgEAV/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 范数，第 &lt;/span&gt;&lt;img data-ratio=&quot;2.8333333333333335&quot; data-type=&quot;svg&quot; data-w=&quot;6&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRj7UAwosn53KIIFpPrZDjeb3UdJvZjktJMXr9iaBNNibzjIf2P8UWczUVfP1TqnHibgU/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 轮训练时梯度的累积为：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.15833333333333333&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRBpIQyRktVhq2jtS30yvE7MbxC4vxvpuxkyYOr2ZZdvMoCxib2naMNLEhs4hNwUic5l/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;然后求无穷范数：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.36666666666666664&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRNict6ibbqUfb91BTCesqqNwr578nZduicKR1R4Gy0QkjyJYLnfzeZteYzlYRjJ4VsfB/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;由此再来递推 &lt;/span&gt;&lt;img data-ratio=&quot;0.5&quot; data-type=&quot;svg&quot; data-w=&quot;32&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRQMnmeqInzvn3md2MUf6IV19PhgvyUlD8Jk68GT0iaJBA4VS0HBWSHwELg6WiaMj7yc/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; ：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.095&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRYiaGICLkLKQpuBDxUlBicUS8Ipky5mCKibAqM6ZicYRH7XnZ8braeYC2ZaDYpI0yP7d3/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;需要注意，这个max比较的是梯度&lt;span&gt;各个维度&lt;/span&gt;上的当前值和历史最大值，具体可以结合代码来看，最后其公式总结如下：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img data-ratio=&quot;0.2816666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRDPl10myicruORlUTTOUTWNxqXg8rlLGaOUC8oFRGWpLoRJ1znu4ian7B7IZUVguv6s/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;另外，因为 &lt;/span&gt;&lt;img data-ratio=&quot;1.0666666666666667&quot; data-type=&quot;svg&quot; data-w=&quot;15&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRUq1gXvcZiceAfCpRV38BX6GyNhHUxqnLnic5PLsGWAuI0HFKeOOt1juSY3o7Kaiauch/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;span&gt; 是累积的梯度各个分量的绝对值最大值，所以直接用做分母且不需要修正，代码如下：&lt;/span&gt;&lt;/section&gt;&lt;pre&gt;&lt;section&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;AdaMax&lt;/span&gt;(&lt;span&gt;object&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, lr&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-3&lt;/span&gt;, alpha&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.9&lt;/span&gt;, beta&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.999&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;=&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;=&lt;/span&gt; lr&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;=&lt;/span&gt; alpha&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i &lt;span&gt;=&lt;/span&gt; &lt;span&gt;1&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;=&lt;/span&gt; beta&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;update&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, g: np&lt;span&gt;.&lt;/span&gt;ndarray):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;+&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha) &lt;span&gt;*&lt;/span&gt; g&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;maximum(&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r&lt;span&gt;*&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta, np&lt;span&gt;.&lt;/span&gt;abs(g))&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i &lt;span&gt;*=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha&lt;br data-filtered=&quot;filtered&quot;/&gt;        lr &lt;span&gt;=&lt;/span&gt; &lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;/&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i)&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;return&lt;/span&gt; lr &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;/&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r&lt;/span&gt;&lt;/code&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;Nadam&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Adam可以看作是Momentum与RMSProp的结合，既然Nesterov的表现较Momentum更优，那么自然也就可以把Nesterov Momentum与RMSProp组合到一起了，首先来看Nesterov的主要公式：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.135&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRv3m169pAm6wrI1AJcPq5nsw95TvuH4wQc6BUyXhelDzFYqXOSuGYCscrKiab5Z4UF/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;为了令其更加接近Momentum，将(5.1)和(5.2)修改为：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.135&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRPU20t0XsSsxRNHraeH2znrLvib4m8VzP6BEic1DVnbdRWGKicia33Tnt8z7c8kwhL1KJ/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;然后列出Adam中Momentum的部分：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.215&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRKv0pbicD8KDJQrLYzkEW4tp884DSLMHrOsAWM2HGCem5lU25bul6WCZDauMibajdq0/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;将(5.5)和(5.6)式代入到(5.7)式中：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.20166666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR142ADBxjCHMq0PfryZ9ibJRASFvFqJMl01fgp0wnptAlIDGic0nSll7n90vvsiadLWj/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;将上式中标红部分进行近似：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.085&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRVXAcER3p9zcCELPGPTOUZEToNHybuiclg96WzTPKeSLmJibxdRxOggNcbXKJOB9c7a/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;代入原式，得到：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.10833333333333334&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRRLE4pV3fKblTVp3SU2ewJ2pa4aueJodUDVkI2JpCjzLnoib64Eo2PCLTh7AvkRsKQ/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;接着，按照(5.4)式的套路，将 &lt;/span&gt;&lt;img data-ratio=&quot;0.5882352941176471&quot; data-type=&quot;svg&quot; data-w=&quot;34&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRvLWRUTauQFGP5m5Hm3jbV99Y4gzEvDiasfCiansDv6ydfJQhn6BvZzN4ZfFRplKN72/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; 替换成 &lt;/span&gt;&lt;img data-ratio=&quot;1.1764705882352942&quot; data-type=&quot;svg&quot; data-w=&quot;17&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRvnmib6hOib3cM116eN3G40etkQItUxvTXbGEto8XBSpJKSFdicZZ4xhXX38WrngIibHH/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; ，得到：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.10833333333333334&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRr83CmKCuw9MVbNsqHdGy7sgktFWqBwg8xpQD3TmltxyMSz349kibYXmbVWI0yiarNI/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;整理一下公式：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.335&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR7AtJbOCGiaXZbIOCbQF4Oa4GYdV5TvYFDfkBU9uXRMzKA83WOxnHAMWZuTl6ojkHy/640?wx_fmt=svg&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;同样令 &lt;/span&gt;&lt;img data-ratio=&quot;0.32653061224489793&quot; data-type=&quot;svg&quot; data-w=&quot;49&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRxOJAxprKHhWuhbrJwroP0AO3x0s2n3WhNf1sM1KUL91JhfrUNEhx9cUd4w0TwDFh/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; ，消去(5.8)式种的 &lt;/span&gt;&lt;img data-ratio=&quot;1.625&quot; data-type=&quot;svg&quot; data-w=&quot;8&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRbibFXY7heRaHbes5YKyaibYS8gbKibdNriamqRvGUMiahpOKE2nricNGr6HGw8OpT4HzQA/640?wx_fmt=svg&quot;/&gt;&lt;span&gt; ：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.40166666666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR8krWGXW2IavOnWtW9INCrC8Q05skspyyqhccVVp50lLbLmBXzvZdJbibexHW33DlB/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;代码&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;pre&gt;&lt;section&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;Nadam&lt;/span&gt;(&lt;span&gt;object&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, lr&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-3&lt;/span&gt;, alpha&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.9&lt;/span&gt;, beta&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.999&lt;/span&gt;, eps&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-8&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;=&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; eps&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;=&lt;/span&gt; lr&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;=&lt;/span&gt; alpha&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;=&lt;/span&gt; beta&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i &lt;span&gt;=&lt;/span&gt; &lt;span&gt;1&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta_i &lt;span&gt;=&lt;/span&gt; &lt;span&gt;1&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;update&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, g: np&lt;span&gt;.&lt;/span&gt;ndarray):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;+&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha) &lt;span&gt;*&lt;/span&gt; g&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;+&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta) &lt;span&gt;*&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;square(g)&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i &lt;span&gt;*=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta_i &lt;span&gt;*=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta_i&lt;br data-filtered=&quot;filtered&quot;/&gt;        lr &lt;span&gt;=&lt;/span&gt; &lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;*&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta_i)&lt;span&gt;**&lt;/span&gt;&lt;span&gt;0.5&lt;/span&gt; &lt;span&gt;/&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i)&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;return&lt;/span&gt; lr &lt;span&gt;*&lt;/span&gt; (&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;+&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha) &lt;span&gt;*&lt;/span&gt; g) &lt;span&gt;/&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;sqrt(&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r)&lt;/span&gt;&lt;/code&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;&lt;br mpa-from-tpl=&quot;t&quot; data-filtered=&quot;filtered&quot;/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;NadaMax&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;按照同样的思路，可以将Nesterov与AdaMax结合变成NadaMax，回顾以下(5.8)式：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.10833333333333334&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCR1rFejWPydvdoVhoU7c167MnBfVzibf97eO3GB3Y38EsxURib5GYrNwLujWd2bicgfkt/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;然后是AdaMax的二阶矩估计部分：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.13166666666666665&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRia7UliagtRqQXDUjbENSkQGoBNQ3vucuEVGIHzahqX1dakujHWb0sPibpnrdAGDKDgy/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;用(6.2)式替换掉(6.1)式中标红部分，得到：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.17166666666666666&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCRiblyLj2A2AgD8uklzTZqJEryRMH6oeymFiaELolorOuyB27UPK27wy9hAChgIhBDPn/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;最后，整理公式：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.24166666666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_svg/kMaz9nc8bgIEdcLicp5Kd2K0bjVIyjGCROqaxverUhzWsbhiauib8iaXQGibR5UiauU1WWU9CtuuvfGpwYdLGzIdZ00XF5mibJwwichu/640?wx_fmt=svg&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;svg&quot; data-w=&quot;600&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;代码实现：&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;pre&gt;&lt;section&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;NadaMax&lt;/span&gt;(&lt;span&gt;object&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, lr&lt;span&gt;=&lt;/span&gt;&lt;span&gt;1e-3&lt;/span&gt;, alpha&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.9&lt;/span&gt;, beta&lt;span&gt;=&lt;/span&gt;&lt;span&gt;0.999&lt;/span&gt;):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;=&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;=&lt;/span&gt; lr&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;=&lt;/span&gt; alpha&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i &lt;span&gt;=&lt;/span&gt; &lt;span&gt;1&lt;/span&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta &lt;span&gt;=&lt;/span&gt; beta&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;update&lt;/span&gt;(&lt;span&gt;self&lt;/span&gt;, g: np&lt;span&gt;.&lt;/span&gt;ndarray):&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;+&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha) &lt;span&gt;*&lt;/span&gt; g&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r &lt;span&gt;=&lt;/span&gt; np&lt;span&gt;.&lt;/span&gt;maximum(&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r&lt;span&gt;*&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;beta, np&lt;span&gt;.&lt;/span&gt;abs(g))&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i &lt;span&gt;*=&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha&lt;br data-filtered=&quot;filtered&quot;/&gt;        lr &lt;span&gt;=&lt;/span&gt; &lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;lr &lt;span&gt;/&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha_i)&lt;br data-filtered=&quot;filtered&quot;/&gt;        &lt;span&gt;return&lt;/span&gt; lr &lt;span&gt;*&lt;/span&gt; (&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;s &lt;span&gt;*&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha &lt;span&gt;+&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;-&lt;/span&gt;&lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;alpha) &lt;span&gt;*&lt;/span&gt; g) &lt;span&gt;/&lt;/span&gt; &lt;span&gt;self&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;r&lt;/span&gt;&lt;/code&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;br data-filtered=&quot;filtered&quot;/&gt;&lt;/section&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot; mpa-is-content=&quot;t&quot;&gt;参考资料：&lt;/h1&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;[1]: 《机器学习算法背后的理论与优化》 ISBN 978-7-302-51718-4&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[2]: Adam: A Method for Stochastic Optimization(https://arxiv.org/abs/1412.6980)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[3]: Incorporating Nesterov Momentum into Adam(https://openreview.net/forum?id=OM0jvwB8jIp57ZJjtNEZ&amp;amp;noteId=OM0jvwB8jIp57ZJjtNEZ)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;[4]: An overview of gradient descent optimization algorithms(https://ruder.io/optimizing-gradient-descent/index.html)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/jupejmznDCicCEDfm4Q5koCraSm45XoTnY8A5RQMIFlLNVKlC8bo97y7Pibp6VwDZmUGebhLN3akM0R19icNU6tCw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;258&quot;/&gt;&lt;/p&gt;
          &lt;/div&gt;

          

          



           
                                
                    
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>