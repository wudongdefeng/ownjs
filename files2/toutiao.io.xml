<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>5af31c40f510eb5e1f0fe10ad1e6f70f</guid>
<title>Thrift åºåˆ—åŒ–åè®®æµ…æ</title>
<link>https://toutiao.io/k/v6esqht</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ç¼–ç ç®€å›¾&lt;span/&gt;&lt;/h4&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6463414634146342&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOiaQFeS3PEy4Qvdh15OU7JPIw3ib5IfGdZFxBgxyfahXhvZRx3UubRW7Ls9vWCibQYqicHUCUjiaMicSzeQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;738&quot;/&gt;&lt;/figure&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ç¼–ç å…·ä½“å†…å®¹&lt;span/&gt;&lt;/h4&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;æŠ“åŒ…æ‹¿åˆ°ç¼–ç åçš„å­—èŠ‚æµï¼ˆè½¬æˆäº†åè¿›åˆ¶ï¼Œæ–¹ä¾¿å¤§å®¶çœ‹ï¼‰&lt;br/&gt;&lt;br/&gt;/*Â æ¥å£åé•¿åº¦Â */Â Â Â Â Â Â Â Â Â 0Â Â Â 0Â Â Â 0Â Â Â Â 25&lt;br/&gt;/*Â æ¥å£åÂ */Â Â Â Â Â Â Â Â Â Â Â Â 83Â Â 101Â Â 97Â Â 114Â Â 99Â Â 104Â Â 68Â Â 101Â Â 112Â Â 97Â Â 114Â Â 116&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 109Â Â 101Â Â 110Â Â 116Â Â 66Â Â 121Â Â 75Â Â 101Â Â 121Â Â 119Â Â 111&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 114Â Â 100&lt;br/&gt;/*Â æ¶ˆæ¯ç±»å‹Â */Â Â Â Â Â Â Â Â Â Â Â 1&lt;br/&gt;/*Â æ¶ˆæ¯åºå·Â */Â Â Â Â Â Â Â Â Â Â Â 0Â Â Â 0Â Â Â 0Â Â Â 1&lt;br/&gt;/*Â keywordÂ å­—æ®µç±»å‹Â */Â Â Â 11&lt;br/&gt;/*Â keywordÂ å­—æ®µID*/Â Â Â Â Â 0Â Â Â 1&lt;br/&gt;/*Â keywordÂ lenÂ */Â Â Â Â Â Â 0Â Â Â 0Â Â Â 0Â Â Â 4&lt;br/&gt;/*Â keywordÂ valueÂ */Â Â Â Â 108Â Â Â 97Â Â Â 114Â Â Â 107&lt;br/&gt;/*Â &lt;span&gt;limit&lt;/span&gt;Â å­—æ®µç±»å‹Â */Â Â Â Â Â 8&lt;br/&gt;/*Â &lt;span&gt;limit&lt;/span&gt;Â å­—æ®µID*/Â Â Â Â Â Â Â 0Â Â Â 2&lt;br/&gt;/*Â &lt;span&gt;limit&lt;/span&gt;Â valueÂ */Â Â Â Â Â Â 0Â Â Â 0Â Â Â 0Â Â Â 50&lt;br/&gt;/*Â å­—æ®µç»ˆæ­¢ç¬¦Â */Â Â Â Â Â Â Â Â Â 0&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ç¼–ç å«ä¹‰&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;æ¶ˆæ¯å¤´&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;msg_typeï¼šæ¶ˆæ¯ç±»å‹ï¼ŒåŒ…å«å››ç§ç±»å‹&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;Callï¼šå®¢æˆ·ç«¯æ¶ˆæ¯ã€‚è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼Œå¹¶ä¸”æœŸå¾…å¯¹æ–¹å‘é€å“åº”ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;OneWayï¼šå®¢æˆ·ç«¯æ¶ˆæ¯ã€‚è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼Œä¸æœŸå¾…å“åº”ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;Replyï¼šæœåŠ¡ç«¯æ¶ˆæ¯ã€‚æ­£å¸¸å“åº”ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;Exceptionï¼šæœåŠ¡ç«¯æ¶ˆæ¯ã€‚å¼‚å¸¸å“åº”ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;msg_seq_idï¼šæ¶ˆæ¯åºå·ã€‚å®¢æˆ·ç«¯ä½¿ç”¨æ¶ˆæ¯åºå·æ¥å¤„ç†å“åº”çš„å¤±åºåˆ°è¾¾ï¼Œå®ç°è¯·æ±‚å’Œå“åº”çš„åŒ¹é…ã€‚æœåŠ¡ç«¯ä¸éœ€è¦æ£€æŸ¥è¯¥åºåˆ—å·ï¼Œä¹Ÿä¸èƒ½å¯¹åºåˆ—å·æœ‰ä»»ä½•çš„é€»è¾‘ä¾èµ–ï¼Œåªéœ€è¦å“åº”çš„æ—¶å€™å°†å…¶åŸæ ·è¿”å›å³å¯ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;æ¶ˆæ¯ä½“&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¶ˆæ¯ä½“åˆ†ä¸ºä¸¤ç§ç¼–ç æ¨¡å¼ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;å®šé•¿ç±»å‹ -&amp;gt; T-V æ¨¡å¼ï¼Œå³ï¼šå­—æ®µç±»å‹ + åºå· + å­—æ®µå€¼&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;å˜é•¿ç±»å‹ -&amp;gt; T-L-V æ¨¡å¼ï¼Œå³ï¼šå­—æ®µç±»å‹ + åºå· + å­—æ®µé•¿åº¦ + å­—æ®µå€¼&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;field_typeï¼šå­—æ®µç±»å‹ï¼ŒåŒ…æ‹¬ Stringã€I64ã€Structã€Stop ç­‰ã€‚å­—æ®µç±»å‹æœ‰ä¸¤ä¸ªä½œç”¨ï¼š&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;Stop ç±»å‹ç”¨äºåœæ­¢åµŒå¥—è§£æ&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;é Stop ç±»å‹ç”¨äº Skipï¼ˆSkip æ“ä½œæ˜¯è·³è¿‡å½“å‰å­—æ®µï¼Œä¼šåœ¨ã€Œå¸¸è§é—®é¢˜ - å…¼å®¹æ€§ã€è¿›è¡Œè®²è§£ï¼‰&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;fied_idï¼šå­—æ®µåºå·ï¼Œè§£ç æ—¶é€šè¿‡åºå·ç¡®å®šå­—æ®µ&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;lenï¼šå­—æ®µé•¿åº¦ï¼Œç”¨äºå˜é•¿ç±»å‹ï¼Œå¦‚ String&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;valueï¼šå­—æ®µå€¼&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;strong&gt;æ•°æ®æ ¼å¼&lt;/strong&gt;&lt;span/&gt;&lt;/h4&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;1. å®šé•¿æ•°æ®ç±»å‹&lt;span/&gt;&lt;/h4&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;æ•°æ®ç±»å‹&lt;/th&gt;&lt;th&gt;ç±»å‹æ ‡è¯†(8 ä½)&lt;/th&gt;&lt;th&gt;ç±»å‹å°ºå¯¸ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;bool&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;byte&lt;/td&gt;&lt;td&gt;3&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;double&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;i16&lt;/td&gt;&lt;td&gt;6&lt;/td&gt;&lt;td&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;i32&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;i64&lt;/td&gt;&lt;td&gt;10&lt;/td&gt;&lt;td&gt;8&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2. å˜é•¿æ•°æ®ç±»å‹&lt;span/&gt;&lt;/h4&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;æ•°æ®ç±»å‹&lt;/th&gt;&lt;th&gt;ç±»å‹æ ‡è¯†ï¼ˆ8 ä½ï¼‰&lt;/th&gt;&lt;th&gt;ç±»å‹å°ºå¯¸ï¼ˆé•¿åº¦ + å€¼ï¼‰&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;string&lt;/td&gt;&lt;td&gt;11&lt;/td&gt;&lt;td&gt;4 + N&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;struct&lt;/td&gt;&lt;td&gt;12&lt;/td&gt;&lt;td&gt;åµŒå¥—æ•°æ® + ä¸€ä¸ªå­—èŠ‚åœæ­¢ç¬¦ï¼ˆ0ï¼‰&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;map&lt;/td&gt;&lt;td&gt;13&lt;/td&gt;&lt;td&gt;1 + 1 + 4 + N*(X+Y) ã€key ç±»å‹ + val ç±»å‹ + é•¿åº¦ + å€¼ã€‘&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;set&lt;/td&gt;&lt;td&gt;14&lt;/td&gt;&lt;td&gt;1 + 4 + N ã€val ç±»å‹ + é•¿åº¦ + å€¼ã€‘&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;list&lt;/td&gt;&lt;td&gt;15&lt;/td&gt;&lt;td&gt;1 + 4 + N ã€val ç±»å‹ + é•¿åº¦ + å€¼ã€‘&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å…¶ä»–åè®®&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Compact åè®®&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Compact åè®®æ˜¯äºŒè¿›åˆ¶å‹ç¼©åè®®ï¼Œåœ¨å¤§éƒ¨åˆ†å­—æ®µçš„ç¼–ç æ–¹å¼ä¸Šä¸ Binary åè®®ä¿æŒä¸€è‡´ã€‚åŒºåˆ«åœ¨äºæ•´æ•°ç±»å‹ï¼ˆåŒ…æ‹¬å˜é•¿ç±»å‹çš„é•¿åº¦ï¼‰é‡‡ç”¨äº†ã€å…ˆ zigzag ç¼–ç  ï¼Œå† varint å‹ç¼©ç¼–ç ã€‘å®ç°ï¼Œæœ€å¤§åŒ–èŠ‚çœç©ºé—´å¼€é”€ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œvarint å’Œ zigzag æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;varint ç¼–ç &lt;span/&gt;&lt;/h4&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;è§£å†³çš„é—®é¢˜ï¼šå®šé•¿å­˜å‚¨çš„æ•´æ•°ç±»å‹ç»å¯¹å€¼è¾ƒå°æ—¶ç©ºé—´æµªè´¹å¤§&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ®ç»Ÿè®¡ï¼ŒRPC é€šä¿¡æ—¶å¤§éƒ¨åˆ†æ—¶å€™ä¼ é€’çš„æ•´æ•°å€¼éƒ½å¾ˆå°ï¼Œå¦‚æœä½¿ç”¨å®šé•¿å­˜å‚¨ä¼šå¾ˆæµªè´¹ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸¾ä¸ª ğŸŒ°ï¼Œå¯¹ i32 ç±»å‹çš„ 7 è¿›è¡Œç¼–ç ï¼Œå¯ä»¥è¯´å‰é¢ 3 ä¸ªå­—èŠ‚éƒ½æµªè´¹äº†ï¼š&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;00000000 00000000 00000000 00000111&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;è§£å†³æ€è·¯ï¼šå°†æ•´æ•°ç±»å‹ç”±å®šé•¿å­˜å‚¨è½¬ä¸ºå˜é•¿å­˜å‚¨ï¼ˆèƒ½ç”¨ 1 ä¸ªå­—èŠ‚å­˜ä¸‹å°±åšå†³ä¸ç”¨ 2 ä¸ªå­—èŠ‚ï¼‰&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åŸç†å¹¶ä¸å¤æ‚ï¼Œå°±æ˜¯å°†æ•´æ•°æŒ‰ 7bit åˆ†æ®µï¼Œæ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½ä½œä¸ºæ ‡è¯†ä½ï¼Œæ ‡è¯†åä¸€ä¸ªå­—èŠ‚æ˜¯å¦å±äºè¯¥æ•°æ®ã€‚1 ä»£è¡¨åé¢çš„å­—èŠ‚è¿˜æ˜¯å±äºå½“å‰æ•°æ®ï¼Œ0 ä»£è¡¨è¿™æ˜¯å½“å‰æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»¥ i32 ç±»å‹ï¼Œæ•°å€¼ 955 ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹å‡ºï¼Œç”±åŸæ¥çš„ 4 å­—èŠ‚å‹ç¼©åˆ°äº† 2 å­—èŠ‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;binaryç¼–ç ï¼šÂ Â Â Â Â Â Â 00000000Â Â 00000000Â Â 00000011  10111011&lt;br/&gt;åˆ‡åˆ†ï¼šÂ Â Â Â Â Â Â Â 0000Â Â 0000000Â Â Â 0000000Â Â Â 0000111 Â Â 0111011&lt;br/&gt;compactç¼–ç ï¼šÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 00000111  10111011&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“ç„¶ï¼Œvarint ç¼–ç åŒæ ·å­˜åœ¨ç¼ºé™·ï¼Œé‚£å°±æ˜¯å­˜å‚¨å¤§æ•°çš„æ—¶å€™ï¼Œåè€Œä¼šæ¯” binary çš„ç©ºé—´å¼€é”€æ›´å¤§ï¼šæœ¬æ¥ 4 ä¸ªå­—èŠ‚å­˜ä¸‹çš„æ•°å¯èƒ½éœ€è¦ 5 ä¸ªå­—èŠ‚ï¼Œ8 ä¸ªå­—èŠ‚å­˜ä¸‹çš„æ•°å¯èƒ½éœ€è¦ 10 ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;zigzag ç¼–ç &lt;span/&gt;&lt;/h4&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;è§£å†³çš„é—®é¢˜ï¼šç»å¯¹å€¼è¾ƒå°çš„è´Ÿæ•°ç»è¿‡ varint ç¼–ç åç©ºé—´å¼€é”€è¾ƒå¤§
ä¸¾ä¸ª ğŸŒ°ï¼Œi32 ç±»å‹çš„è´Ÿæ•°ï¼ˆ-11ï¼‰&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;åŸç ï¼šÂ Â Â Â Â Â Â Â  10000000Â Â 00000000Â Â 00000000Â Â 00001011&lt;br/&gt;åç ï¼šÂ Â Â Â Â Â Â Â  11111111  11111111  11111111  11110100&lt;br/&gt;è¡¥ç ï¼šÂ Â Â Â Â Â Â Â  11111111  11111111  11111111  11110101&lt;br/&gt;varintç¼–ç ï¼šÂ Â Â 00001111  11111111  11111111  11111111  11110101&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ˜¾ç„¶ï¼Œå¯¹äºç»å¯¹å€¼è¾ƒå°çš„è´Ÿæ•°ï¼Œç”¨ varint ç¼–ç ä»¥åå‰å¯¼ 1 è¿‡å¤šï¼Œéš¾ä»¥å‹ç¼©ï¼Œç©ºé—´å¼€é”€æ¯” binary ç¼–ç è¿˜å¤§ã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;è§£å†³æ€è·¯ï¼šè´Ÿæ•°è½¬æ­£æ•°ï¼Œä»è€ŒæŠŠå‰å¯¼ 1 è½¬æˆå‰å¯¼ 0ï¼Œä¾¿äº varint å‹ç¼©&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç®—æ³•å…¬å¼ &amp;amp; æ­¥éª¤ &amp;amp; ç¤ºèŒƒï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;//Â ç®—æ³•å…¬å¼&lt;br/&gt;32ä½ï¼šÂ (n &amp;lt;&amp;lt; 1)Â ^Â (n &amp;gt;&amp;gt; 31)&lt;br/&gt;64ä½ï¼šÂ (n &amp;lt;&amp;lt; 1)Â ^Â (n &amp;gt;&amp;gt; 63)&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;/*&lt;br/&gt;Â *Â ç®—æ³•æ­¥éª¤ï¼š&lt;br/&gt;Â * 1. ä¸åˆ†æ­£è´Ÿï¼šç¬¦å·ä½åç½®ï¼Œæ•°å€¼ä½å‰ç§»&lt;br/&gt;Â * 2. å¯¹äºè´Ÿæ•°ï¼šç¬¦å·ä½ä¸å˜ï¼Œæ•°å€¼ä½å–å&lt;br/&gt;Â */&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;//Â ç¤ºä¾‹&lt;br/&gt;è´Ÿæ•°(-11ï¼‰&lt;br/&gt;Â Â è¡¥ç ï¼šÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  11111111  11111111  11111111  11110101&lt;br/&gt;Â Â ç¬¦å·ä½åç½®ï¼Œæ•°å€¼ä½å‰ç§»ï¼šÂ Â Â Â Â  11111111  11111111  11111111  11101011&lt;br/&gt;Â Â ç¬¦å·ä½ä¸å˜ï¼Œæ•°å€¼ä½å–å(21)ï¼šÂ Â 00000000Â Â 00000000Â Â 00000000Â Â 00010101&lt;br/&gt;&lt;br/&gt;æ­£æ•°(11ï¼‰&lt;br/&gt;Â Â è¡¥ç ï¼šÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 00000000Â Â 00000000Â Â 00000000Â Â 00010101&lt;br/&gt;Â Â ç¬¦å·ä½åç½®ï¼Œæ•°å€¼ä½å‰ç§»(22)ï¼šÂ Â 00000000Â Â 00000000Â Â 00000000Â Â 00101010&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ã€å¥‡æ€ªçš„çŸ¥è¯†ã€‘ä¸ºä»€ä¹ˆå–åå« zigzagï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å› ä¸ºè¿™ä¸ªç®—æ³•å°†è´Ÿæ•°ç¼–ç æˆæ­£å¥‡æ•°ï¼Œæ­£æ•°ç¼–ç æˆå¶æ•°ã€‚æœ€åæ•ˆæœæ˜¯æ­£è´Ÿæ•°ç©¿æ’å‘å‰ï¼Œå°±åƒè¿™æ ·ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;ç¼–ç å‰Â Â Â Â Â Â Â ç¼–ç å&lt;br/&gt;Â Â 0Â Â Â Â Â Â Â Â Â Â Â 0&lt;br/&gt;Â Â -1Â Â Â Â Â Â Â Â Â Â 1&lt;br/&gt;Â Â 1Â Â Â Â Â Â Â Â Â Â Â 2&lt;br/&gt;Â Â -2Â Â Â Â Â Â Â Â Â Â 3&lt;br/&gt;Â Â 2Â Â Â Â Â Â Â Â Â Â Â 4&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Json åè®®&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Thrift ä¸ä»…æ”¯æŒäºŒè¿›åˆ¶åºåˆ—åŒ–åè®®ï¼Œä¹Ÿæ”¯æŒ Json è¿™ç§æ–‡æœ¬åè®®&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;æ•°æ®æ ¼å¼&lt;span/&gt;&lt;/h4&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;/*Â boolã€i8ã€i16ã€i32ã€i64ã€doubleã€stringÂ */&lt;br/&gt;&lt;span&gt;&quot;ç¼–å·&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â &lt;span&gt;&quot;ç±»å‹&quot;&lt;/span&gt;:Â &lt;span&gt;&quot;å€¼&quot;&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;//Â ç¤ºä¾‹&lt;br/&gt;&lt;span&gt;&quot;1&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â &lt;span&gt;&quot;str&quot;&lt;/span&gt;:Â &lt;span&gt;&quot;keyword&quot;&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;/*Â structÂ */&lt;br/&gt;&lt;span&gt;&quot;ç¼–å·&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â &lt;span&gt;&quot;rec&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;æˆå‘˜ç¼–å·&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&quot;æˆå‘˜ç±»å‹&quot;&lt;/span&gt;:Â &lt;span&gt;&quot;æˆå‘˜å€¼&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â },&lt;br/&gt;Â Â Â Â ...&lt;br/&gt;Â Â }&lt;br/&gt;}&lt;br/&gt;//Â ç¤ºä¾‹&lt;br/&gt;&lt;span&gt;&quot;1&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â &lt;span&gt;&quot;rec&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;1&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&quot;i32&quot;&lt;/span&gt;:Â 50&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;/*Â mapÂ */&lt;br/&gt;&lt;span&gt;&quot;ç¼–å·&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â &lt;span&gt;&quot;map&quot;&lt;/span&gt;:Â [&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;é”®ç±»å‹&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;å€¼ç±»å‹&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â å…ƒç´ ä¸ªæ•°,&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&quot;é”®1&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&quot;å€¼1&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â ...&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&quot;é”®n&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&quot;å€¼n&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â ]&lt;br/&gt;}&lt;br/&gt;//Â ç¤ºä¾‹&lt;br/&gt;&lt;span&gt;&quot;6&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â &lt;span&gt;&quot;map&quot;&lt;/span&gt;:Â [&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;i64&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;str&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â 1,&lt;br/&gt;Â Â Â Â 666,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;mapValue&quot;&lt;/span&gt;&lt;br/&gt;Â Â ]&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;/*Â ListÂ */&lt;br/&gt;&lt;span&gt;&quot;ç¼–å·&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â &lt;span&gt;&quot;set/lst&quot;&lt;/span&gt;:Â [&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;å€¼ç±»å‹&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â å…ƒç´ ä¸ªæ•°,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;ele1&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;ele2&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;elen&quot;&lt;/span&gt;&lt;br/&gt;Â Â ]&lt;br/&gt;}&lt;br/&gt;//Â ç¤ºä¾‹&lt;br/&gt;&lt;span&gt;&quot;2&quot;&lt;/span&gt;:Â {&lt;br/&gt;Â Â &lt;span&gt;&quot;lst&quot;&lt;/span&gt;:Â [&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;str&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â 2,&lt;br/&gt;Â Â Â Â &lt;span&gt;&quot;lark&quot;&lt;/span&gt;,&lt;span&gt;&quot;keyword&quot;&lt;/span&gt;]&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;case åˆ†æ&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ä¿®æ”¹å­—æ®µç±»å‹å¯¼è‡´ RPC è¶…æ—¶&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç°è±¡ï¼šA æœåŠ¡è®¿é—® B æœåŠ¡ï¼Œä¸šåŠ¡é€»è¾‘çŸ­æ—¶é—´å¤„ç†å®Œï¼Œä½†æ•´ä¸ªè¯·æ±‚ 15s è¶…æ—¶ï¼Œå¿…ç°ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç›´æ¥åŸå› ï¼šIDL ç±»å‹è¢«ä¿®æ”¹ï¼›å¹¶ä¸”åªå‡çº§äº†æœåŠ¡ç«¯ï¼ˆB æœåŠ¡ï¼‰ï¼Œæ²¡å‡çº§å®¢æˆ·ç«¯ï¼ˆA æœåŠ¡ï¼‰&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.31368993653671806&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOiaQFeS3PEy4Qvdh15OU7JPIiac3ia5DgujnicJnlx4uoS1aPHE7Z9rgFAq0icRmxmfSY3PkDqrClwp8xQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2206&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ¬è´¨åŸå› ï¼šstring æ˜¯å˜é•¿ç¼–ç ï¼Œi64 æ˜¯å®šé•¿ç¼–ç ã€‚ç”±äºå®¢æˆ·ç«¯æ²¡æœ‰å‡çº§ï¼Œæ‰€ä»¥ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šæŠŠ signTime å½“åš string ç±»å‹æ¥è§£æã€‚è€Œå˜é•¿ç¼–ç æ˜¯ T-L-V æ¨¡å¼ï¼Œæ‰€ä»¥è§£æçš„æ—¶å€™ä¼šæŠŠ signTime çš„ä½ä½ 4 å­—èŠ‚ç¿»è¯‘æˆ string çš„ lengthã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;signTime æ˜¯æ—¶é—´æˆ³ï¼Œå¤§æ•´æ•°ï¼Œæ¯”å¦‚ï¼š1624206147902ï¼Œè½¬æˆäºŒè¿›åˆ¶ä¸ºï¼š&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;00000000 00000000 00000001 01111010 00101010 00111011 00000001 00111110&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½ä½ 4 å­—èŠ‚è½¬æˆåè¿›åˆ¶ä¸ºï¼š378&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¹Ÿå°±æ˜¯è¦å†è¯» 378 ä¸ªå­—èŠ‚ä½œä¸º SignTime çš„å€¼ï¼Œè¿™å·²ç»è¶…è¿‡äº†æ•´ä¸ª payload çš„å¤§å°ï¼Œæœ€ç»ˆå¯¼è‡´ Socket è¯»è¶…æ—¶ã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ã€æ³¨ã€‘ä¿®æ”¹ç±»å‹ä¸ä¸€å®šå°±ä¼šå¯¼è‡´è¶…æ—¶ï¼Œå¦‚æœ value çš„å€¼æ¯”è¾ƒå°ï¼Œè§£æåˆ°çš„ length ä¹Ÿæ¯”è¾ƒå°ï¼Œèƒ½å¤Ÿä¿è¯è¯»å®Œã€‚ä½†æ˜¯é”™è¯¯çš„è§£æå¯èƒ½ä¼šå¯¼è‡´å„ç§é¢„æœŸä¹‹å¤–çš„æƒ…å†µï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;ä¹±ç &lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;ç©ºå€¼&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;æŠ¥é”™ï¼šunknown data type xxx ï¼ˆskip å¼‚å¸¸ï¼‰&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å¸¸è§é—®é¢˜&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å…¼å®¹æ€§&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å¢åŠ å­—æ®µ&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é€šè¿‡ skip æ¥è·³è¿‡å¢åŠ çš„å­—æ®µï¼Œä»è€Œä¿è¯å…¼å®¹æ€§&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.550185873605948&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOiaQFeS3PEy4Qvdh15OU7JPIqduvE5zmCdobaa7Xhj86ZrNucsEhWDfJ65gQ78VJ95paGfpUkwy21g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2152&quot;/&gt;&lt;/figure&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;åˆ é™¤å­—æ®µ&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¼–è¯‘ç”Ÿæˆçš„è§£æä»£ç æ˜¯åŸºäº field_id çš„ switch-case ç»“æ„ï¼Œè¯­æ³•ç»“æ„ä¸Šç›´æ¥å…·å¤‡å…¼å®¹æ€§ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.49913344887348354&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOiaQFeS3PEy4Qvdh15OU7JPIY25mOuC4YEsviba15EvnNcLcWFNVYCib3ibl0Gyn12dVpaibGzcdXvPW8w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2308&quot;/&gt;&lt;/figure&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ä¿®æ”¹å­—æ®µå&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ç ´åå…¼å®¹æ€§ï¼Œå› ä¸º binary åè®®ä¸ä¼šå¯¹ name è¿›è¡Œç¼–ç &lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Exception&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Thrift æœ‰ä¸¤ç§ Exceptionï¼Œä¸€ç§æ˜¯æ¡†æ¶å†…ç½®çš„å¼‚å¸¸ï¼Œä¸€ç§æ˜¯ IDL è‡ªå®šä¹‰çš„å¼‚å¸¸ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¡†æ¶å†…ç½®çš„å¼‚å¸¸åŒ…æ‹¬ï¼šã€Œæ–¹æ³•åé”™è¯¯ã€ã€ã€Œæ¶ˆæ¯åºåˆ—å·é”™è¯¯ã€ã€ã€Œåè®®é”™è¯¯ã€ï¼Œè¿™äº›å¼‚å¸¸ç”±æ¡†æ¶æ•è·å¹¶å°è£…æˆ Exception æ¶ˆæ¯ï¼Œååºåˆ—åŒ–æ—¶ä¼šè½¬æˆ error å¹¶æŠ›ç»™ä¸Šå±‚ï¼Œé€»è¾‘å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5452586206896551&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOiaQFeS3PEy4Qvdh15OU7JPI5fdYBoZPz4artJQYfhKrIeiabySQscvsq12F9ZoeLZTDVPSTBqN1oYA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1856&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦ä¸€ç§å¼‚å¸¸æ˜¯ç”±ç”¨æˆ·åœ¨ IDL ä¸­è‡ªå®šä¹‰çš„ï¼Œå…³é”®å­—æ˜¯ exceptionï¼Œç”¨æ³•ä¸Šè·Ÿ struct æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.28315946348733234&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/5EcwYhllQOiaQFeS3PEy4Qvdh15OU7JPIdov82JAyeXYUJRfBibgDPpbyvoIo4eAUDcmNqx1hHFFq7sBmAFXLdLA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1342&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;optionalã€require å®ç°åŸç†&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;optional è¡¨ç¤ºå­—æ®µå¯å¡«ï¼Œrequire è¡¨ç¤ºå¿…å¡«&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;å­—æ®µè¢«æ ‡è¯†ä¸º optional ä¹‹åï¼š&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;åŸºæœ¬ç±»å‹ä¼šè¢«ç¼–è¯‘ä¸ºæŒ‡é’ˆç±»å‹&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;åºåˆ—åŒ–ä»£ç ä¼šåšç©ºå€¼åˆ¤æ–­ï¼Œå¦‚æœå­—æ®µä¸ºç©ºï¼Œåˆ™ä¸ä¼šè¢«ç¼–ç &lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;&lt;span&gt;å­—æ®µè¢«æ ‡è¯†ä¸º require ä¹‹åï¼š&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;åŸºæœ¬ç±»å‹ä¼šè¢«ç¼–è¯‘ä¸ºéæŒ‡é’ˆç±»å‹ï¼ˆå¤åˆç±»å‹ optional å’Œ require æ²¡åŒºåˆ«ï¼‰&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;åºåˆ—åŒ–ä¸ä¼šåšç©ºå€¼åˆ¤æ–­ï¼Œå­—æ®µä¸€å®šä¼šè¢«ç¼–ç ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼èµ‹å€¼ï¼Œå°±ç¼–ç é»˜è®¤å€¼ï¼ˆé»˜è®¤ç©ºå€¼ï¼Œæˆ–è€… IDL æ˜¾å¼æŒ‡å®šçš„é»˜è®¤å€¼ï¼‰&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>7af845a3418e67b0ef038a16bc1e866b</guid>
<title>æ—¥å¿—å¯¼è‡´çº¿ç¨‹Blockçš„è¿™äº›å‘ï¼Œä½ ä¸å¾—ä¸é˜²</title>
<link>https://toutiao.io/k/eakgqf8</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                       &quot; id=&quot;js_content&quot;&gt;
            &lt;p data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;578&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;58&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.1546875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsU2zk0q52HtKQjubeUEyZHBVHPgeBXgTUj0ib1Kwfosl82xO1Aw7x6gccLuuYs1dbxI7REI7OcjbGw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;æ€»ç¬¬525&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;ç¯‡&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;2022å¹´ ç¬¬042ç¯‡&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section data-role=&quot;outer&quot; label=&quot;Powered by 135editor.com&quot;&gt;&lt;section data-role=&quot;outer&quot; label=&quot;Powered by 135editor.com&quot;&gt;&lt;section data-tools=&quot;135ç¼–è¾‘å™¨&quot; data-id=&quot;127&quot;&gt;&lt;section data-tools=&quot;135ç¼–è¾‘å™¨&quot; data-id=&quot;127&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;img border=&quot;0&quot; class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;103&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;103&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsU2zk0q52HtKQjubeUEyZHBic5ADGrKxgSd0tibyMiasOHXjb46qFBw7PTfuWAxXzWq32lDkL05icwkMg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;750&quot; data-width=&quot;100%&quot; opacity=&quot;&quot; title=&quot;undefined&quot;/&gt;&lt;/p&gt;&lt;/section&gt;&lt;section data-brushtype=&quot;text&quot; data-style=&quot;text-align: left; font-size: 14px; color: inherit;&quot;&gt;&lt;p&gt;&lt;span&gt;ç ”å‘äººå‘˜åœ¨é¡¹ç›®å¼€å‘ä¸­ä¸å¯é¿å…åœ°è¦ä½¿ç”¨æ—¥å¿—ï¼Œé€šè¿‡å®ƒæ¥è®°å½•ä¿¡æ¯å’Œæ’æŸ¥é—®é¢˜ã€‚Apache Log4j2æä¾›äº†çµæ´»ä¸”å¼ºå¤§çš„æ—¥å¿—æ¡†æ¶ï¼Œè™½ç„¶ä¸Šæ‰‹æ¯”è¾ƒå¿«ï¼Œä½†ç¨æœ‰ä¸æ…ä¹Ÿéå¸¸å®¹æ˜“è¸©â€œå‘â€ã€‚&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;æœ¬æ–‡ä»‹ç»äº†ç¾å›¢ç»Ÿä¸€APIç½‘å…³æœåŠ¡Shepherdåœ¨å®è·µä¸­æ‰€è¸©è¿‡çš„å…³äºæ—¥å¿—å¯¼è‡´çº¿ç¨‹Blockçš„é‚£äº›â€œå‘â€ï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•ä»æ—¥å¿—æ¡†æ¶æºç å±‚é¢è¿›è¡Œåˆ†æå’Œè§£å†³é—®é¢˜çš„è¿‡ç¨‹ï¼Œå¹¶åœ¨æœ€åç»™å¤§å®¶åˆ†äº«ä¸€äº›å…³äºæ—¥å¿—é¿â€œå‘â€çš„å®è·µç»éªŒï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¸®åŠ©ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;1. å‰è¨€&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;2. èƒŒæ™¯&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;3. è¸©è¿‡çš„å‘&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;4. é¿å‘æŒ‡å—&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;5. æœ€ä½³å®è·µ&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;1. å‰è¨€&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—å¯¹ç¨‹åºçš„é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚å®ƒå¾ˆâ€œå¤§â€ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ç»å¸¸é€šè¿‡æ—¥å¿—æ¥è®°å½•ä¿¡æ¯å’Œæ’æŸ¥é—®é¢˜ï¼Œç›¸å…³ä»£ç éšå¤„å¯è§ã€‚å®ƒä¹Ÿå¾ˆâ€œå°â€ï¼Œä½œä¸ºè¾…åŠ©å·¥å…·ï¼Œæ—¥å¿—ä½¿ç”¨ç®€å•ã€ä¸Šæ‰‹å¿«ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ä¼šèŠ±è´¹è¿‡å¤šç²¾åŠ›è€—åœ¨æ—¥å¿—ä¸Šã€‚ä½†çœ‹ä¼¼ä¸èµ·çœ¼çš„æ—¥å¿—ä¹Ÿéšè—ç€å„ç§å„æ ·çš„â€œå‘â€ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå®ƒä¸ä»…ä¸èƒ½å¸®åŠ©æˆ‘ä»¬ï¼Œåè€Œè¿˜å¯èƒ½é™ä½æœåŠ¡æ€§èƒ½ï¼Œç”šè‡³æ‹–å®æˆ‘ä»¬çš„æœåŠ¡ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—å¯¼è‡´çº¿ç¨‹Blockçš„é—®é¢˜ï¼Œç›¸ä¿¡ä½ æˆ–è®¸å·²ç»é‡åˆ°è¿‡ï¼Œå¯¹æ­¤åº”è¯¥æ·±æœ‰ä½“ä¼šï¼›æˆ–è®¸ä½ è¿˜æ²¡é‡åˆ°è¿‡ï¼Œä½†ä¸ä»£è¡¨æ²¡æœ‰é—®é¢˜ï¼Œåªæ˜¯å¯èƒ½è¿˜æ²¡æœ‰è§¦å‘è€Œå·²ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»ç¾å›¢ç»Ÿä¸€APIç½‘å…³æœåŠ¡Shepherdï¼ˆ&lt;/span&gt;&lt;span&gt;å‚è§&lt;/span&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651762298&amp;amp;idx=1&amp;amp;sn=1fec5406ab2f3cc9161050247d9c1a9a&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;ã€Šç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç°ã€‹&lt;/span&gt;&lt;/a&gt;&lt;span&gt;ä¸€æ–‡&lt;/span&gt;&lt;span&gt;ï¼‰åœ¨å®è·µä¸­æ‰€è¸©è¿‡çš„å…³äºæ—¥å¿—å¯¼è‡´çº¿ç¨‹Blockçš„é‚£äº›â€œå‘â€ï¼Œç„¶åå†åˆ†äº«ä¸€äº›é¿â€œå‘â€ç»éªŒã€‚&lt;/span&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;2. èƒŒæ™¯&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;APIç½‘å…³æœåŠ¡ShepherdåŸºäºJavaè¯­è¨€å¼€å‘ï¼Œä½¿ç”¨ä¸šç•Œå¤§åé¼é¼çš„&lt;/span&gt;&lt;a href=&quot;https://logging.apache.org/log4j/2.x/&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;Apache Log4j2&lt;/span&gt;&lt;/a&gt;&lt;span&gt;ä½œä¸ºä¸»è¦æ—¥å¿—æ¡†æ¶ï¼ŒåŒæ—¶ä½¿ç”¨ç¾å›¢å†…éƒ¨çš„XMD-Log SDKå’ŒScribe-Log SDKå¯¹æ—¥å¿—å†…å®¹è¿›è¡Œå¤„ç†ï¼Œæ—¥å¿—å¤„ç†æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾1æ‰€ç¤ºã€‚ä¸šåŠ¡æ‰“å°æ—¥å¿—æ—¶ï¼Œæ—¥å¿—æ¡†æ¶åŸºäºLoggeré…ç½®æ¥å†³å®šæŠŠæ—¥å¿—äº¤ç»™XMDFileå¤„ç†è¿˜æ˜¯Scribeå¤„ç†ã€‚å…¶ä¸­ï¼ŒXMDFileæ˜¯XMD-Logå†…éƒ¨æä¾›çš„æ—¥å¿—Appenderåç§°ï¼Œè´Ÿè´£è¾“å‡ºæ—¥å¿—åˆ°æœ¬åœ°ç£ç›˜ï¼ŒScribeæ˜¯Scribe-Logå†…éƒ¨æä¾›çš„æ—¥å¿—Appenderåç§°ï¼Œè´Ÿè´£ä¸ŠæŠ¥æ—¥å¿—åˆ°è¿œç¨‹æ—¥å¿—ä¸­å¿ƒã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;542&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;184&quot; data-ratio=&quot;0.3389592123769339&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJyickBNiboIQLHPnw4QYGyibARL2XZlFianferjD0kqZbQM3AnKEW84yiaKg/640?wx_fmt=png&quot; data-w=&quot;1422&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾1 æ—¥å¿—å¤„ç†æµç¨‹ç¤ºæ„å›¾&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;éšç€ä¸šåŠ¡çš„å¿«é€Ÿå¢é•¿ï¼Œæ—¥å¿—å¯¼è‡´çš„çº¿ç¨‹Blocké—®é¢˜æ„ˆå‘é¢‘ç¹ã€‚æ¯”å¦‚è°ƒç”¨åç«¯RPCæœåŠ¡è¶…æ—¶ï¼Œå¯¼è‡´è°ƒç”¨æ–¹å¤§é‡çº¿ç¨‹Blockï¼›å†æ¯”å¦‚ï¼Œä¸šåŠ¡å†…éƒ¨è¾“å‡ºå¼‚å¸¸æ—¥å¿—å¯¼è‡´æœåŠ¡å¤§é‡çº¿ç¨‹Blockç­‰ï¼Œè¿™äº›é—®é¢˜ä¸¥é‡å½±å“ç€æœåŠ¡çš„ç¨³å®šæ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç»“åˆé¡¹ç›®åœ¨è¿‡å»ä¸€æ®µæ—¶é—´æš´éœ²å‡ºæ¥çš„å„ç§ç”±äºæ—¥å¿—å¯¼è‡´çš„çº¿ç¨‹Blocké—®é¢˜ï¼Œå¯¹æ—¥å¿—æ¡†æ¶å­˜åœ¨çš„ç¨³å®šæ€§é£é™©å› ç´ è¿›è¡Œäº†å½»åº•çš„æ’æŸ¥å’Œä¿®å¤ï¼Œå¹¶åœ¨çº¿ä¸‹ã€çº¿ä¸Šç¯å¢ƒè¿›è¡Œå…¨æ–¹ä½éªŒè¯ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ€»ç»“äº†ä¸€äº›æ—¥å¿—ä½¿ç”¨ç›¸å…³çš„å®è·µç»éªŒï¼Œå¸Œæœ›åˆ†äº«ç»™å¤§å®¶ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;åœ¨è¿›å…¥æ­£æ–‡å‰ï¼Œé¦–å…ˆä»‹ç»é¡¹ç›®å½“æ—¶çš„è¿è¡Œç¯å¢ƒå’Œæ—¥å¿—ç›¸å…³é…ç½®ä¿¡æ¯ã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;javaÂ versionÂ &quot;1.8.0_45&quot;&lt;br/&gt;Java(TM)Â SEÂ RuntimeÂ EnvironmentÂ (buildÂ 1.8.0_45-b14)&lt;br/&gt;JavaÂ HotSpot(TM)Â 64-BitÂ ServerÂ VMÂ (buildÂ 25.45-b02,Â mixedÂ mode)&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&amp;lt;&lt;span&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.apache.logging.log4j&lt;span&gt;&amp;lt;/&lt;span&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;log4j-api&lt;span&gt;&amp;lt;/&lt;span&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.7&lt;span&gt;&amp;lt;/&lt;span&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;/&lt;span&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.apache.logging.log4j&lt;span&gt;&amp;lt;/&lt;span&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;log4j-core&lt;span&gt;&amp;lt;/&lt;span&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.7&lt;span&gt;&amp;lt;/&lt;span&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;/&lt;span&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.apache.logging.log4j&lt;span&gt;&amp;lt;/&lt;span&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;log4j-slf4j-impl&lt;span&gt;&amp;lt;/&lt;span&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;2.7&lt;span&gt;&amp;lt;/&lt;span&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;/&lt;span&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&amp;lt;?xmlÂ version=&quot;1.0&quot;Â encoding=&quot;UTF-8&quot;?&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;configuration&lt;/span&gt;Â &lt;span&gt;status&lt;/span&gt;=&lt;span&gt;&quot;warn&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;appenders&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Console&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;Console&quot;&lt;/span&gt;Â &lt;span&gt;target&lt;/span&gt;=&lt;span&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;Â &lt;span&gt;follow&lt;/span&gt;=&lt;span&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;PatternLayout&lt;/span&gt;Â &lt;span&gt;pattern&lt;/span&gt;=&lt;span&gt;&quot;%d{yyyy/MM/ddÂ HH:mm:ss.SSS}Â %tÂ [%p]Â %c{1}Â (%F:%L)Â %msg%n&quot;&lt;/span&gt;Â /&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Console&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;XMDFile&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;ShepherdLog&quot;&lt;/span&gt;Â &lt;span&gt;fileName&lt;/span&gt;=&lt;span&gt;&quot;shepherd.log&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--XMDFileå¼‚æ­¥ç£ç›˜æ—¥å¿—é…ç½®ç¤ºä¾‹--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--é»˜è®¤æŒ‰å¤©&amp;amp;æŒ‰512Mæ–‡ä»¶å¤§å°åˆ‡åˆ†æ—¥å¿—ï¼Œé»˜è®¤æœ€å¤šä¿ç•™30ä¸ªæ—¥å¿—æ–‡ä»¶ã€‚--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--æ³¨æ„ï¼šfileNameå‰ä¼šè‡ªåŠ¨å¢åŠ æ–‡ä»¶è·¯å¾„ï¼Œåªé…ç½®æ–‡ä»¶åå³å¯--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;XMDFile&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;LocalServiceLog&quot;&lt;/span&gt;Â &lt;span&gt;fileName&lt;/span&gt;=&lt;span&gt;&quot;request.log&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Scribe&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;LogCenterSync&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--Â åœ¨æŒ‡å®šæ—¥å¿—åæ–¹é¢ï¼ŒscribeCategory å’Œ appkey ä¸¤è€…è‡³å°‘å­˜åœ¨ä¸€ç§ï¼Œä¸” scribeCategory é«˜äº appkeyã€‚--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--Â &amp;lt;PropertyÂ name=&quot;scribeCategory&quot;&amp;gt;data_update_test_lc&amp;lt;/Property&amp;gt;Â --&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;LcLayout&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Scribe&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Async&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;LogCenterAsync&quot;&lt;/span&gt;Â &lt;span&gt;blocking&lt;/span&gt;=&lt;span&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;AppenderRef&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;LogCenterSync&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Async&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;appenders&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;loggers&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;AsyncLogger&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;com.sankuai.shepherd&quot;&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;info&quot;&lt;/span&gt;Â &lt;span&gt;additivity&lt;/span&gt;=&lt;span&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;AppenderRef&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;ShepherdLog&quot;&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;warn&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;AppenderRef&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;LogCenterAsync&quot;&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;info&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;AsyncLogger&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;root&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;info&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--Consoleæ—¥å¿—æ˜¯åŒæ­¥ã€é˜»å¡çš„ï¼Œæ¨èåªåœ¨æœ¬åœ°è°ƒè¯•æ—¶ä½¿ç”¨ï¼Œçº¿ä¸Šå°†è¯¥é…ç½®å»æ‰--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--appender-refÂ ref=&quot;Console&quot;Â /--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;appender-ref&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;LocalServiceLog&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;appender-ref&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;LogCenterAsync&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;root&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;loggers&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;/&lt;span&gt;configuration&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3. è¸©è¿‡çš„å‘&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;æœ¬ç« èŠ‚ä¸»è¦è®°å½•é¡¹ç›®è¿‡å»ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬æ‰€é‡åˆ°çš„ä¸€ç³»åˆ—æ—¥å¿—å¯¼è‡´çš„çº¿ç¨‹Blocké—®é¢˜ï¼Œå¹¶é€ä¸ªæ·±å…¥åˆ†æé—®é¢˜æ ¹å› ã€‚&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.1 æ—¥å¿—é˜Ÿåˆ—æ»¡å¯¼è‡´çº¿ç¨‹Block&lt;/span&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.1.1 é—®é¢˜ç°åœº&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;æ”¶åˆ°â€œjvm.thread.blocked.countâ€å‘Šè­¦åç«‹åˆ»é€šè¿‡ç›‘æ§å¹³å°æŸ¥çœ‹çº¿ç¨‹ç›‘æ§æŒ‡æ ‡ï¼Œå½“æ—¶çš„çº¿ç¨‹å †æ ˆå¦‚å›¾2å’Œå›¾3æ‰€ç¤ºã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;542&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;272&quot; data-ratio=&quot;0.5010416666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJwraRbxibEywyvzYrKOhLr6GhJExg0K6qKLeicwWiaaFONeqgBsQtia299A/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;542&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;233&quot; data-ratio=&quot;0.4296875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJ8q1gTHY8NiavyJCIQPVibdXCzuCCiaF7G15zhE4tiawUzSZKx1r7N8zBqQ/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾2 ç­‰å¾…é”çš„Blockedçº¿ç¨‹å †æ ˆ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;542&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;271&quot; data-ratio=&quot;0.5&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJFCwsbUn1l3B3DIb8bngIRXDYT8cibfmiafCtyAqzHAjD7OrgwtCP6UTQ/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾3 æŒæœ‰é”çš„Runnableçº¿ç¨‹å †æ ˆ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä»Blockedçº¿ç¨‹å †æ ˆä¸éš¾çœ‹å‡ºè¿™è·Ÿæ—¥å¿—æ‰“å°ç›¸å…³ï¼Œè€Œä¸”æ˜¯INFOçº§åˆ«çš„æ—¥å¿—ï¼Œé‚å³ç™»é™†æœºå™¨æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰å¼‚æ ·ï¼Œå‘ç°å½“æ—¶æ—¥å¿—é‡éå¸¸å¤§ï¼Œå·®ä¸å¤šæ¯ä¸¤åˆ†é’Ÿå°±å†™æ»¡ä¸€ä¸ª500MBçš„æ—¥å¿—æ–‡ä»¶ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;é‚£å¤§é‡è¾“å‡ºæ—¥å¿—å’Œçº¿ç¨‹Blockä¹‹é—´ä¼šæœ‰æ€æ ·çš„å…³è”å‘¢ï¼Ÿæ¥ä¸‹æ¥æœ¬ç« èŠ‚å°†ç»“åˆå¦‚ä¸‹å›¾4æ‰€ç¤ºçš„è°ƒç”¨é“¾è·¯æ·±å…¥åˆ†æçº¿ç¨‹Blockçš„æ ¹å› ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;542&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;271&quot; data-ratio=&quot;0.5004803073967339&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJfQMuCFeiaH033ATFjTWpLZiaeZuohtQzhdicGwFxmia5H2icTW9XZ8EjfAw/640?wx_fmt=png&quot; data-w=&quot;2082&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾4 æ—¥å¿—è°ƒç”¨é“¾è·¯&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.1.2 ä¸ºä»€ä¹ˆä¼šBlockçº¿ç¨‹ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;ä»Blockedçº¿ç¨‹å †æ ˆç€æ‰‹åˆ†æï¼ŒæŸ¥çœ‹PrintStreamç›¸å…³ä»£ç ç‰‡æ®µå¦‚ä¸‹å›¾5æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°è¢«é˜»å¡åœ°æ–¹æœ‰synchronizedåŒæ­¥è°ƒç”¨ï¼Œå†ç»“åˆä¸Šæ–‡å‘ç°æ¯ä¸¤åˆ†é’Ÿå†™æ»¡ä¸€ä¸ª500MBæ—¥å¿—æ–‡ä»¶çš„ç°è±¡ï¼Œåˆæ­¥æ€€ç–‘æ˜¯æ—¥å¿—é‡è¿‡å¤§å¯¼è‡´äº†çº¿ç¨‹é˜»å¡ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;142&quot; data-ratio=&quot;0.2534908700322234&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJb7cTxPg2bc3H2AIxkicXER5KqHZwj2PufsrH1QAaX9K27cADUIxRVMQ/640?wx_fmt=png&quot; data-w=&quot;1862&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾5 PringStreamä»£ç ç‰‡æ®µ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä½†ä¸Šè¿°çŒœæµ‹ä»æœ‰ä¸€äº›å€¼å¾—æ¨æ•²çš„åœ°æ–¹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å¦‚æœä»…ä»…å› ä¸ºæ—¥å¿—é‡è¿‡å¤§å°±å¯¼è‡´çº¿ç¨‹Blockï¼Œé‚£æ—¥å¿—æ¡†æ¶ä¹Ÿå¤ªä¸å ªé‡ç”¨äº†ï¼Œæ ¹æœ¬æ²¡æ³•åœ¨é«˜å¹¶å‘ã€é«˜ååä¸šåŠ¡åœºæ™¯ä¸‹ä½¿ç”¨ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—é…ç½®é‡Œæ˜æ˜æ˜¯è¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶ï¼Œæ€ä¹ˆä¼šè¾“å‡ºåˆ°Console PrintStreamï¼Ÿ&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.1.3 ä¸ºä»€ä¹ˆä¼šè¾“å‡ºåˆ°Consoleï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;ç»§ç»­æ²¿ç€çº¿ç¨‹å †æ ˆè°ƒç”¨é“¾è·¯åˆ†æï¼Œå¯ä»¥çœ‹å‡ºæ˜¯AsyncAppenderè°ƒç”¨appendæ–¹æ³•è¿½åŠ æ—¥å¿—æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œç›¸å…³ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.appender.AsyncAppender&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â å†…éƒ¨ç»´æŠ¤çš„é˜»å¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å¤§å°é»˜è®¤æ˜¯128&lt;/span&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â BlockingQueue&amp;lt;LogEvent&amp;gt;Â queue;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;append&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ logEvent)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!isStarted())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;throw&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â IllegalStateException(&lt;span&gt;&quot;AsyncAppenderÂ &quot;&lt;/span&gt;Â +Â getName()Â +Â &lt;span&gt;&quot;Â isÂ notÂ active&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!Constants.FORMAT_MESSAGES_IN_BACKGROUND)Â {Â &lt;span&gt;//Â LOG4J2-898:Â userÂ mayÂ choose&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â logEvent.getMessage().getFormattedMessage();Â &lt;span&gt;//Â LOG4J2-763:Â askÂ messageÂ toÂ freezeÂ parameters&lt;/span&gt;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â Log4jLogEventÂ mementoÂ =Â Log4jLogEvent.createMemento(logEvent,Â includeLocation);&lt;br/&gt;Â Â Â &lt;span&gt;//Â æ—¥å¿—äº‹ä»¶è½¬å…¥å¼‚æ­¥é˜Ÿåˆ—&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!transfer(memento))Â {&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â æ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜é˜Ÿåˆ—æ»¡äº†ï¼Œå…¥é˜Ÿå¤±è´¥ï¼Œæ ¹æ®æ˜¯å¦blockingæ‰§è¡Œå…·ä½“ç­–ç•¥&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (blocking)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â é˜»å¡æ¨¡å¼ï¼Œé€‰å–ç‰¹å®šçš„ç­–ç•¥æ¥å¤„ç†ï¼Œç­–ç•¥å¯èƒ½æ˜¯Â &quot;å¿½ç•¥æ—¥å¿—&quot;ã€&quot;æ—¥å¿—å…¥é˜Ÿå¹¶é˜»å¡&quot;ã€&quot;å½“å‰çº¿ç¨‹æ‰“å°æ—¥å¿—&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â delegateÂ toÂ theÂ eventÂ routerÂ (whichÂ mayÂ discard,Â enqueueÂ andÂ block,Â orÂ logÂ inÂ currentÂ thread)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â EventRouteÂ routeÂ =Â asyncQueueFullPolicy.getRoute(thread.getId(),Â memento.getLevel());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â route.logMessage(&lt;span&gt;this&lt;/span&gt;,Â memento);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â éé˜»å¡æ¨¡å¼ï¼Œäº¤ç”±Â ErrorHandlerÂ å¤„ç†å¤±è´¥æ—¥å¿—&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â error(&lt;span&gt;&quot;AppenderÂ &quot;&lt;/span&gt;Â +Â getName()Â +Â &lt;span&gt;&quot;Â isÂ unableÂ toÂ writeÂ primaryÂ appenders.Â queueÂ isÂ full&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â logToErrorAppenderIfNecessary(&lt;span&gt;false&lt;/span&gt;,Â memento);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â &lt;span&gt;transfer&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ memento)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â queueÂ &lt;span&gt;instanceof&lt;/span&gt;Â TransferQueue&lt;br/&gt;Â Â Â Â Â Â Â Â ?Â ((TransferQueue&amp;lt;LogEvent&amp;gt;)Â queue).tryTransfer(memento)&lt;br/&gt;Â Â Â Â Â Â Â Â :Â queue.offer(memento);&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â StringÂ msg)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â handler.error(msg);&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;AsyncAppenderé¡¾åæ€ä¹‰æ˜¯ä¸ªå¼‚æ­¥Appenderï¼Œé‡‡ç”¨å¼‚æ­¥æ–¹å¼å¤„ç†æ—¥å¿—ï¼Œåœ¨å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªBlockingQueueé˜Ÿåˆ—ï¼Œæ¯æ¬¡å¤„ç†æ—¥å¿—æ—¶ï¼Œéƒ½å…ˆå°è¯•æŠŠLog4jLogEventäº‹ä»¶å­˜å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åäº¤ç”±åå°çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–å‡ºäº‹ä»¶å¹¶å¤„ç†ï¼ˆ&lt;/span&gt;&lt;span&gt;æŠŠæ—¥å¿—äº¤ç”±AsyncAppenderæ‰€å…³è”çš„Appenderå¤„ç†&lt;/span&gt;&lt;span&gt;ï¼‰ï¼Œä½†é˜Ÿåˆ—é•¿åº¦æ€»æ˜¯æœ‰é™çš„ï¼Œä¸”é˜Ÿåˆ—é»˜è®¤å¤§å°æ˜¯128ï¼Œå¦‚æœæ—¥å¿—é‡è¿‡å¤§æˆ–æ—¥å¿—å¼‚æ­¥çº¿ç¨‹å¤„ç†ä¸åŠæ—¶ï¼Œå°±å¾ˆå¯èƒ½å¯¼è‡´æ—¥å¿—é˜Ÿåˆ—è¢«æ‰“æ»¡ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å½“æ—¥å¿—é˜Ÿåˆ—æ»¡æ—¶ï¼Œæ—¥å¿—æ¡†æ¶å†…éƒ¨æä¾›äº†ä¸¤ç§å¤„ç†æ–¹å¼ï¼Œå…·ä½“å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å¦‚æœblockingé…ç½®ä¸ºtrueï¼Œä¼šé€‰æ‹©ç›¸åº”çš„å¤„ç†ç­–ç•¥ï¼Œé»˜è®¤æ˜¯SYNCHRONOUSç­–ç•¥ï¼Œå¯ä»¥åœ¨log4j2.component.propertiesæ–‡ä»¶ä¸­ï¼Œé€šè¿‡log4j2.AsyncQueueFullPolicyå‚æ•°é…ç½®æ—¥å¿—æ¡†æ¶æä¾›çš„å…¶ä»–ç­–ç•¥æˆ–è‡ªå®šä¹‰ç­–ç•¥ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;DISCARDç­–ç•¥ï¼Œç›´æ¥å¿½ç•¥æ—¥å¿—ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;SYNCHRONOUSç­–ç•¥ï¼Œå½“å‰çº¿ç¨‹ç›´æ¥å‘é€æ—¥å¿—åˆ°Appenderã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;ENQUEUEç­–ç•¥ï¼Œå¼ºåˆ¶é˜»å¡å…¥é˜Ÿã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å¦‚æœblockingé…ç½®ä¸ºfalseï¼Œåˆ™ç”±ErrorHandlerå’ŒErrorAppenderå¤„ç†å¤±è´¥æ—¥å¿—ã€‚æ—¥å¿—æ¡†æ¶æä¾›äº†é»˜è®¤çš„ErrorHandlerå®ç°ï¼Œå³DefaultErrorHandlerï¼Œç›®å‰æš‚ä¸æ”¯æŒä¸šåŠ¡åœ¨XMLã€JSONç­‰æ—¥å¿—é…ç½®æ–‡ä»¶é‡Œè‡ªå®šä¹‰ErrorHandlerã€‚æ—¥å¿—æ¡†æ¶é»˜è®¤ä¸æä¾›ErrorAppenderï¼Œä¸šåŠ¡å¦‚æœ‰éœ€è¦å¯åœ¨XMLã€JSONç­‰æ—¥å¿—é…ç½®æ–‡ä»¶é‡Œè‡ªå®šä¹‰error-refé…ç½®ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;åœ¨æœ¬é¡¹ç›®çš„æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒAsyncAppenderè®¾ç½®äº†blockingä¸ºfalseï¼Œä¸”æ²¡æœ‰é…ç½®error-refï¼Œä¸‹é¢å…·ä½“åˆ†æDefaultErrorHandlerã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.appender.DefaultErrorHandler&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â LoggerÂ LOGGERÂ =Â StatusLogger.getLogger();&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â MAX_EXCEPTIONSÂ =Â &lt;span&gt;3&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â 5minÂ æ—¶é—´é—´éš”&lt;/span&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â EXCEPTION_INTERVALÂ =Â TimeUnit.MINUTES.toNanos(&lt;span&gt;5&lt;/span&gt;);&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â exceptionCountÂ =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â lastExceptionÂ =Â System.nanoTime()Â -Â EXCEPTION_INTERVALÂ -Â &lt;span&gt;1&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;error&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â StringÂ msg)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â currentÂ =Â System.nanoTime();&lt;br/&gt;Â Â Â &lt;span&gt;//Â å½“å‰æ—¶é—´è·ç¦»ä¸Šæ¬¡å¼‚å¸¸å¤„ç†æ—¶é—´é—´éš”è¶…è¿‡5minÂ æˆ–è€…å¼‚å¸¸å¤„ç†æ•°å°äº3æ¬¡&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (currentÂ -Â lastExceptionÂ &amp;gt;Â EXCEPTION_INTERVALÂ ||Â exceptionCount++Â &amp;lt;Â MAX_EXCEPTIONS)Â {&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â StatusLoggerÂ è´Ÿè´£å¤„ç†&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â LOGGER.error(msg);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â lastExceptionÂ =Â current;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;DefaultErrorHandlerå†…éƒ¨åœ¨å¤„ç†å¼‚å¸¸æ—¥å¿—æ—¶å¢åŠ äº†æ¡ä»¶é™åˆ¶ï¼Œåªæœ‰ä¸‹è¿°&lt;strong&gt;ä¸¤ä¸ªæ¡ä»¶ä»»ä¸€æ»¡è¶³&lt;/strong&gt;æ—¶æ‰ä¼šå¤„ç†ï¼Œä»è€Œé¿å…å¤§é‡å¼‚å¸¸æ—¥å¿—å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚&lt;/span&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ä¸¤æ¡æ—¥å¿—å¤„ç†é—´éš”è¶…è¿‡5minã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å¼‚å¸¸æ—¥å¿—æ•°é‡ä¸è¶…è¿‡3æ¬¡ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;ä½†é¡¹ç›®æ‰€ç”¨æ—¥å¿—æ¡†æ¶ç‰ˆæœ¬çš„é»˜è®¤å®ç°çœ‹èµ·æ¥å­˜åœ¨ä¸€äº›ä¸å¤ªåˆç†çš„åœ°æ–¹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æ‰€ä»¥ï¼Œåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå¯èƒ½æœ‰å¤§é‡å¼‚å¸¸æ—¥å¿—åŒæ—¶è¢«DefaultErrorHandlerå¤„ç†ï¼Œå¸¦æ¥çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¯¥é—®é¢˜å·²æœ‰ç›¸å…³&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3185&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;Issue: DefaultErrorHandler can not share values across threads&lt;/span&gt;&lt;/a&gt;&lt;span&gt;åé¦ˆç»™ç¤¾åŒºï¼Œå¹¶åœ¨&lt;/span&gt;&lt;a href=&quot;https://logging.apache.org/log4j/2.x/changes-report.html#a2.15.0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;2.15.0&lt;/span&gt;&lt;/a&gt;&lt;span&gt;ç‰ˆæœ¬ä¸­è¿›è¡Œäº†ä¿®å¤ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä»ä¸Šè¿°DefaultErrorHandlerä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒçœŸæ­£è´Ÿè´£å¤„ç†æ—¥å¿—çš„æ˜¯StatusLoggerï¼Œç»§ç»­è·Ÿè¿›ä»£ç è¿›å…¥logMessageæ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å¦‚æœStatusLoggerå†…éƒ¨æ³¨å†Œäº†StatusListenerï¼Œåˆ™ç”±å¯¹åº”çš„StatusListenerè´Ÿè´£å¤„ç†æ—¥å¿—ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å¦åˆ™ç”±SimpleLoggerè´Ÿè´£å¤„ç†æ—¥å¿—ï¼Œç›´æ¥è¾“å‡ºæ—¥å¿—åˆ°System.errè¾“å‡ºæµã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.status.StatusLogger&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â StatusLoggerÂ STATUS_LOGGERÂ =Â &lt;span&gt;new&lt;/span&gt;Â StatusLogger(StatusLogger&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;.&lt;span&gt;getName&lt;/span&gt;(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;ParameterizedNoReferenceMessageFactory&lt;/span&gt;.&lt;span&gt;INSTANCE&lt;/span&gt;)&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â StatusListener&lt;/span&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â Collection&amp;lt;StatusListener&amp;gt;Â listenersÂ =Â &lt;span&gt;new&lt;/span&gt;Â CopyOnWriteArrayList&amp;lt;&amp;gt;();&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â SimpleLoggerÂ logger;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;StatusLogger&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â StringÂ name,Â &lt;span&gt;final&lt;/span&gt;Â MessageFactoryÂ messageFactory)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;super&lt;/span&gt;(name,Â messageFactory);&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.loggerÂ =Â &lt;span&gt;new&lt;/span&gt;Â SimpleLogger(&lt;span&gt;&quot;StatusLogger&quot;&lt;/span&gt;,Â Level.ERROR,Â &lt;span&gt;false&lt;/span&gt;,Â &lt;span&gt;true&lt;/span&gt;,Â &lt;span&gt;false&lt;/span&gt;,Â &lt;span&gt;false&lt;/span&gt;,Â Strings.EMPTY,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â messageFactory,Â PROPS,Â System.err);&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.listenersLevelÂ =Â Level.toLevel(DEFAULT_STATUS_LEVEL,Â Level.WARN).intLevel();&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;/**&lt;br/&gt;Â *Â RetrieveÂ theÂ StatusLogger.&lt;br/&gt;Â *&lt;br/&gt;Â *Â &lt;span&gt;@return&lt;/span&gt;Â TheÂ StatusLogger.&lt;br/&gt;Â */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â StatusLoggerÂ &lt;span&gt;getLogger&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â STATUS_LOGGER;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;logMessage&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â StringÂ fqcn,Â &lt;span&gt;final&lt;/span&gt;Â LevelÂ level,Â &lt;span&gt;final&lt;/span&gt;Â MarkerÂ marker,Â &lt;span&gt;final&lt;/span&gt;Â MessageÂ msg,&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â ThrowableÂ t)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â StackTraceElementÂ elementÂ =Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (fqcnÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â elementÂ =Â getStackTraceElement(fqcn,Â Thread.currentThread().getStackTrace());&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StatusDataÂ dataÂ =Â &lt;span&gt;new&lt;/span&gt;Â StatusData(element,Â level,Â msg,Â t,Â &lt;span&gt;null&lt;/span&gt;);&lt;br/&gt;Â Â Â Â msgLock.lock();&lt;br/&gt;Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â messages.add(data);&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;finally&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â msgLock.unlock();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â &lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (listeners.size()Â &amp;gt;Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â å¦‚æœç³»ç»Ÿæ³¨å†Œäº†Â listenerï¼Œç”±Â StatusConsoleListenerÂ å¤„ç†æ—¥å¿—&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (&lt;span&gt;final&lt;/span&gt;Â StatusListenerÂ listenerÂ :Â listeners)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (data.getLevel().isMoreSpecificThan(listener.getStatusLevel()))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â listener.log(data);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â å¦åˆ™ç”±Â SimpleLoggerÂ å¤„ç†æ—¥å¿—ï¼Œç›´æ¥è¾“å‡ºåˆ°Â System.err&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â logger.logMessage(fqcn,Â level,Â marker,Â msg,Â t);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;ä»ä¸Šè¿°Blockedçº¿ç¨‹å †æ ˆæ¥çœ‹ï¼Œæ˜¯StatusConsoleListenerè´Ÿè´£å¤„ç†æ—¥å¿—ï¼Œè€ŒStatusConsoleListeneræ˜¯StatusListeneræ¥å£çš„å®ç°ç±»ï¼Œé‚£ä¹ˆStatusConsoleListeneræ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ï¼Ÿ&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.1.4 StatusConsoleListeneræ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;é€šå¸¸æ¥è¯´ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½ä¼šæœ‰ä¸€ä¸ªæ—¥å¿—é…ç½®æ–‡ä»¶ï¼ˆ&lt;/span&gt;&lt;span&gt;å¦‚log4j2.xml&lt;/span&gt;&lt;span&gt;ï¼‰ï¼Œè¯¥é…ç½®å¯¹åº”Log4j2æ—¥å¿—æ¡†æ¶ä¸­çš„Configurationæ¥å£ï¼Œä¸åŒçš„æ—¥å¿—é…ç½®æ–‡ä»¶æ ¼å¼æœ‰ä¸åŒçš„å®ç°ç±»ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;XmlConfigurationï¼Œå³XMLæ ¼å¼æ—¥å¿—é…ç½®&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;JsonConfigurationï¼Œå³JSONæ ¼å¼æ—¥å¿—é…ç½®&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;XMDConfigurationï¼Œå³ç¾å›¢å†…éƒ¨æ—¥å¿—ç»„ä»¶XMD-Logå®šä¹‰çš„æ—¥å¿—é…ç½®ï¼ˆ&lt;/span&gt;&lt;span&gt;XMLæ ¼å¼&lt;/span&gt;&lt;span&gt;ï¼‰&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;......&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;log4j2.xml ç¤ºä¾‹é…ç½®ï¼ˆ&lt;/span&gt;&lt;span&gt;ä»…åšç¤ºä¾‹ï¼Œè¯·å‹¿å®é™…é¡¹ç›®ä¸­ä½¿ç”¨è¯¥é…ç½®&lt;/span&gt;&lt;span&gt;ï¼‰ã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&amp;lt;?xmlÂ version=&quot;1.0&quot;Â encoding=&quot;UTF-8&quot;?&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;&lt;span&gt;Configuration&lt;/span&gt;Â &lt;span&gt;status&lt;/span&gt;=&lt;span&gt;&quot;debug&quot;&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;RoutingTest&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Properties&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Property&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;filename&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;target/rolling1/rollingtest-$${sd:type}.log&lt;span&gt;&amp;lt;/&lt;span&gt;Property&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Properties&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;&amp;lt;&lt;span&gt;ThresholdFilter&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;debug&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â &lt;br/&gt;Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Appenders&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Console&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;STDOUT&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;PatternLayout&lt;/span&gt;Â &lt;span&gt;pattern&lt;/span&gt;=&lt;span&gt;&quot;%m%n&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;ThresholdFilter&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;debug&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Console&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Routing&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;Routing&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Routes&lt;/span&gt;Â &lt;span&gt;pattern&lt;/span&gt;=&lt;span&gt;&quot;$${sd:type}&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Route&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;RollingFile&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;Rolling-${sd:type}&quot;&lt;/span&gt;Â &lt;span&gt;fileName&lt;/span&gt;=&lt;span&gt;&quot;${filename}&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;filePattern&lt;/span&gt;=&lt;span&gt;&quot;target/rolling1/test1-${sd:type}.%i.log.gz&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;PatternLayout&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;pattern&lt;/span&gt;&amp;gt;&lt;/span&gt;%dÂ %pÂ %c{1.}Â [%t]Â %m%n&lt;span&gt;&amp;lt;/&lt;span&gt;pattern&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;PatternLayout&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;SizeBasedTriggeringPolicy&lt;/span&gt;Â &lt;span&gt;size&lt;/span&gt;=&lt;span&gt;&quot;500&quot;&lt;/span&gt;Â /&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;RollingFile&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Route&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Route&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;STDOUT&quot;&lt;/span&gt;Â &lt;span&gt;key&lt;/span&gt;=&lt;span&gt;&quot;Audit&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Routes&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Routing&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Appenders&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â &lt;br/&gt;Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Loggers&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Logger&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;EventLogger&quot;&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;info&quot;&lt;/span&gt;Â &lt;span&gt;additivity&lt;/span&gt;=&lt;span&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;AppenderRef&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;Routing&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Logger&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â &lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Root&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;error&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;AppenderRef&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;STDOUT&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Root&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Loggers&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;/&lt;span&gt;Configuration&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;Log4j2åœ¨å¯åŠ¨æ—¶ä¼šåŠ è½½å¹¶è§£ælog4j2.xmlé…ç½®æ–‡ä»¶ï¼Œç”±å¯¹åº”çš„ConfigurationFactoryåˆ›å»ºå…·ä½“Configurationå®ä¾‹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.config.xml.XmlConfiguration&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;XmlConfiguration&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LoggerContextÂ loggerContext,Â &lt;span&gt;final&lt;/span&gt;Â ConfigurationSourceÂ configSource)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;super&lt;/span&gt;(loggerContext,Â configSource);&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â FileÂ configFileÂ =Â configSource.getFile();&lt;br/&gt;Â Â Â Â &lt;span&gt;byte&lt;/span&gt;[]Â bufferÂ =Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â InputStreamÂ configStreamÂ =Â configSource.getInputStream();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â bufferÂ =Â toByteArray(configStream);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;finally&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Closer.closeSilently(configStream);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â InputSourceÂ sourceÂ =Â &lt;span&gt;new&lt;/span&gt;Â InputSource(&lt;span&gt;new&lt;/span&gt;Â ByteArrayInputStream(buffer));&lt;br/&gt;Â Â Â Â Â Â Â Â source.setSystemId(configSource.getLocation());&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â DocumentBuilderÂ documentBuilderÂ =Â newDocumentBuilder(&lt;span&gt;true&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â DocumentÂ document;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â è§£æÂ xmlÂ é…ç½®æ–‡ä»¶&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â documentÂ =Â documentBuilder.parse(source);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (&lt;span&gt;final&lt;/span&gt;Â ExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â LOG4J2-1127&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â ThrowableÂ throwableÂ =Â Throwables.getRootCause(e);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (throwableÂ &lt;span&gt;instanceof&lt;/span&gt;Â UnsupportedOperationException)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOGGER.warn(&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;TheÂ DocumentBuilderÂ {}Â doesÂ notÂ supportÂ anÂ operation:Â {}.&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â +Â &lt;span&gt;&quot;TryingÂ againÂ withoutÂ XInclude...&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â documentBuilder,Â e);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â documentÂ =Â newDocumentBuilder(&lt;span&gt;false&lt;/span&gt;).parse(source);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;throw&lt;/span&gt;Â e;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â rootElementÂ =Â document.getDocumentElement();&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â å¤„ç†æ ¹èŠ‚ç‚¹å±æ€§é…ç½®ï¼Œå³Â &amp;lt;Configuration&amp;gt;&amp;lt;/Configuration&amp;gt;Â èŠ‚ç‚¹&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â Map&amp;lt;String,Â String&amp;gt;Â attrsÂ =Â processAttributes(rootNode,Â rootElement);&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â åˆ›å»ºÂ StatusConfiguration&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StatusConfigurationÂ statusConfigÂ =Â &lt;span&gt;new&lt;/span&gt;Â StatusConfiguration().withVerboseClasses(VERBOSE_CLASSES)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .withStatus(getDefaultStatus());&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (&lt;span&gt;final&lt;/span&gt;Â Map.Entry&amp;lt;String,Â String&amp;gt;Â entryÂ :Â attrs.entrySet())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringÂ keyÂ =Â entry.getKey();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringÂ valueÂ =Â getStrSubstitutor().replace(entry.getValue());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„Â statusÂ å±æ€§å€¼ï¼Œæ¥è®¾ç½®Â StatusConfigurationÂ çš„Â statusÂ level&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;status&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â statusConfig.withStatus(value);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„Â destÂ å±æ€§å€¼ï¼Œæ¥è®¾ç½®Â StatusConfigurationÂ çš„æ—¥å¿—è¾“å‡ºÂ destination&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;dest&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â statusConfig.withDestination(value);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;shutdownHook&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â isShutdownHookEnabledÂ =Â !&lt;span&gt;&quot;disable&quot;&lt;/span&gt;.equalsIgnoreCase(value);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;verbose&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â statusConfig.withVerbosity(value);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;packages&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â pluginPackages.addAll(Arrays.asList(value.split(Patterns.COMMA_SEPARATOR)));&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;name&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â setName(value);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;strict&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â strictÂ =Â Boolean.parseBoolean(value);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;schema&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â schemaResourceÂ =Â value;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;monitorInterval&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â intervalSecondsÂ =Â Integer.parseInt(value);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (intervalSecondsÂ &amp;gt;Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â getWatchManager().setIntervalSeconds(intervalSeconds);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (configFileÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â FileWatcherÂ watcherÂ =Â &lt;span&gt;new&lt;/span&gt;Â ConfiguratonFileWatcher(&lt;span&gt;this&lt;/span&gt;,Â listeners);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â getWatchManager().watchFile(configFile,Â watcher);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;&quot;advertiser&quot;&lt;/span&gt;.equalsIgnoreCase(key))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â createAdvertiser(value,Â configSource,Â buffer,Â &lt;span&gt;&quot;text/xml&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â &lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â åˆå§‹åŒ–Â StatusConfiguration&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â statusConfig.initialize();&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (&lt;span&gt;final&lt;/span&gt;Â SAXExceptionÂ |Â IOExceptionÂ |Â ParserConfigurationExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â LOGGER.error(&lt;span&gt;&quot;ErrorÂ parsingÂ &quot;&lt;/span&gt;Â +Â configSource.getLocation(),Â e);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (getName()Â ==Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â setName(configSource.getLocation());&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â &lt;br/&gt;Â Â Â &lt;span&gt;//Â å¿½ç•¥ä»¥ä¸‹å†…å®¹&lt;/span&gt;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.config.status.StatusConfiguration&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â PrintStreamÂ DEFAULT_STREAMÂ =Â System.out;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â LevelÂ DEFAULT_STATUSÂ =Â Level.ERROR;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â VerbosityÂ DEFAULT_VERBOSITYÂ =Â Verbosity.QUIET;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â Collection&amp;lt;String&amp;gt;Â errorMessagesÂ =Â Collections.synchronizedCollection(&lt;span&gt;new&lt;/span&gt;Â LinkedList&amp;lt;String&amp;gt;());&lt;br/&gt;&lt;span&gt;//Â StatusLogger&lt;/span&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â StatusLoggerÂ loggerÂ =Â StatusLogger.getLogger();&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;volatile&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â initializedÂ =Â &lt;span&gt;false&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â PrintStreamÂ destinationÂ =Â DEFAULT_STREAM;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â LevelÂ statusÂ =Â DEFAULT_STATUS;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â VerbosityÂ verbosityÂ =Â DEFAULT_VERBOSITY;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;initialize&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!&lt;span&gt;this&lt;/span&gt;.initialized)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;this&lt;/span&gt;.statusÂ ==Â Level.OFF)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.initializedÂ =Â &lt;span&gt;true&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â configuredÂ =Â configureExistingStatusConsoleListener();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!configured)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ³¨å†Œæ–°Â StatusConsoleListener&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â registerNewStatusConsoleListener();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â migrateSavedLogMessages();&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â &lt;span&gt;configureExistingStatusConsoleListener&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;boolean&lt;/span&gt;Â configuredÂ =Â &lt;span&gt;false&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (&lt;span&gt;final&lt;/span&gt;Â StatusListenerÂ statusListenerÂ :Â &lt;span&gt;this&lt;/span&gt;.logger.getListeners())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (statusListenerÂ &lt;span&gt;instanceof&lt;/span&gt;Â StatusConsoleListener)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StatusConsoleListenerÂ listenerÂ =Â (StatusConsoleListener)Â statusListener;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â StatusConsoleListenerÂ çš„Â levelÂ ä»¥Â StatusConfigurationÂ çš„Â statusÂ ä¸ºå‡†&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â listener.setLevel(&lt;span&gt;this&lt;/span&gt;.status);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.logger.updateListenerLevel(&lt;span&gt;this&lt;/span&gt;.status);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;this&lt;/span&gt;.verbosityÂ ==Â Verbosity.QUIET)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â listener.setFilters(&lt;span&gt;this&lt;/span&gt;.verboseClasses);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â configuredÂ =Â &lt;span&gt;true&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â configured;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;registerNewStatusConsoleListener&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â &lt;span&gt;//Â åˆ›å»ºÂ StatusConsoleListenerï¼Œçº§åˆ«ä»¥Â StatusConfigurationÂ ä¸ºå‡†&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;//Â é»˜è®¤Â statusÂ æ˜¯Â DEFAULT_STATUSÂ å³Â ERROR&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;//Â é»˜è®¤Â destinationÂ æ˜¯Â DEFAULT_STREAMÂ å³Â System.out&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StatusConsoleListenerÂ listenerÂ =Â &lt;span&gt;new&lt;/span&gt;Â StatusConsoleListener(&lt;span&gt;this&lt;/span&gt;.status,Â &lt;span&gt;this&lt;/span&gt;.destination);&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (&lt;span&gt;this&lt;/span&gt;.verbosityÂ ==Â Verbosity.QUIET)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â listener.setFilters(&lt;span&gt;this&lt;/span&gt;.verboseClasses);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.logger.registerListener(listener);&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.status.StatusConsoleListener&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â LevelÂ levelÂ =Â Level.FATAL;Â &lt;span&gt;//Â çº§åˆ«&lt;/span&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â String[]Â filters;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â PrintStreamÂ stream;Â &lt;span&gt;//Â è¾“å‡ºæµ&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;StatusConsoleListener&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LevelÂ level,Â &lt;span&gt;final&lt;/span&gt;Â PrintStreamÂ stream)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (streamÂ ==Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;throw&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â IllegalArgumentException(&lt;span&gt;&quot;YouÂ mustÂ provideÂ aÂ streamÂ toÂ useÂ forÂ thisÂ listener.&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.levelÂ =Â level;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.streamÂ =Â stream;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;ä»¥XmlConfigurationä¸ºä¾‹ï¼Œåˆ†æä¸Šè¿°æ—¥å¿—é…ç½®è§£æä»£ç ç‰‡æ®µå¯ä»¥å¾—çŸ¥ï¼Œåˆ›å»ºXmlConfigurationæ—¶ï¼Œä¼šå…ˆåˆ›å»ºStatusConfigurationï¼Œéšååœ¨åˆå§‹åŒ–StatusConfigurationæ—¶åˆ›å»ºå¹¶æ³¨å†ŒStatusConsoleListeneråˆ°StatusLoggerçš„listenersä¸­ï¼Œæ—¥å¿—é…ç½®æ–‡ä»¶ä¸­&amp;lt;Configuration&amp;gt;æ ‡ç­¾çš„å±æ€§å€¼é€šè¿‡XmlConfiguration-&amp;gt;StatusConfiguration-&amp;gt;StatusConsoleListenerè¿™æ ·çš„å…³ç³»é“¾è·¯æœ€ç»ˆå½±å“StatusConsoleListenerçš„è¡Œä¸ºã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­çš„&amp;lt;Configuration&amp;gt;æ ‡ç­¾å¯ä»¥é…ç½®å±æ€§å­—æ®µï¼Œéƒ¨åˆ†å­—æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;åœ¨æœ¬é¡¹ç›®çš„æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰è®¾ç½®Configurationçš„destå±æ€§å€¼ï¼Œæ‰€ä»¥æ—¥å¿—ç›´æ¥è¾“å‡ºåˆ°System.outã€‚&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.1.5 StatusLoggeræœ‰ä»€ä¹ˆç”¨ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;ä¸Šæ–‡æåˆ°StatusConsoleListeneræ˜¯æ³¨å†Œåœ¨StatusLoggerä¸­ï¼ŒStatusLoggeråœ¨äº¤ç”±StatusListenerå¤„ç†æ—¥å¿—å‰ï¼Œä¼šåˆ¤æ–­æ—¥å¿—çº§åˆ«ï¼Œå¦‚æœçº§åˆ«æ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™å¿½ç•¥æ­¤æ—¥å¿—ï¼ŒStatusConsoleListenerçš„æ—¥å¿—çº§åˆ«é»˜è®¤æ˜¯ERRORã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.status.StatusLogger&lt;/span&gt;&lt;br/&gt;Â Â &lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;logMessage&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â StringÂ fqcn,Â &lt;span&gt;final&lt;/span&gt;Â LevelÂ level,Â &lt;span&gt;final&lt;/span&gt;Â MarkerÂ marker,Â &lt;span&gt;final&lt;/span&gt;Â MessageÂ msg,&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â ThrowableÂ t)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â StackTraceElementÂ elementÂ =Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (fqcnÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â elementÂ =Â getStackTraceElement(fqcn,Â Thread.currentThread().getStackTrace());&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StatusDataÂ dataÂ =Â &lt;span&gt;new&lt;/span&gt;Â StatusData(element,Â level,Â msg,Â t,Â &lt;span&gt;null&lt;/span&gt;);&lt;br/&gt;Â Â Â Â msgLock.lock();&lt;br/&gt;Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â messages.add(data);&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;finally&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â msgLock.unlock();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â &lt;br/&gt;Â Â Â &lt;span&gt;//Â ç³»ç»Ÿæ³¨å†Œäº†Â listenerï¼Œç”±Â StatusConsoleListenerÂ å¤„ç†æ—¥å¿—&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (listeners.size()Â &amp;gt;Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (&lt;span&gt;final&lt;/span&gt;Â StatusListenerÂ listenerÂ :Â listeners)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ¯”è¾ƒå½“å‰æ—¥å¿—çš„Â leveÂ å’ŒÂ listenerÂ çš„Â level&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (data.getLevel().isMoreSpecificThan(listener.getStatusLevel()))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â listener.log(data);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â logger.logMessage(fqcn,Â level,Â marker,Â msg,Â t);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;æˆ‘ä»¬å›å¤´å†æ¥çœ‹ä¸‹StatusLoggerï¼ŒStatusLoggeré‡‡ç”¨å•ä¾‹æ¨¡å¼å®ç°ï¼Œå®ƒè¾“å‡ºæ—¥å¿—åˆ°Consoleï¼ˆ&lt;/span&gt;&lt;span&gt;å¦‚System.outæˆ–System.err&lt;/span&gt;&lt;span&gt;ï¼‰ï¼Œä»ä¸Šæ–‡åˆ†æå¯çŸ¥ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹éå¸¸å®¹æ˜“å¯¼è‡´çº¿ç¨‹Blockï¼Œé‚£ä¹ˆå®ƒçš„å­˜åœ¨æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;çœ‹å®˜æ–¹ä»‹ç»å¤§æ„æ˜¯è¯´ï¼Œåœ¨æ—¥å¿—åˆå§‹åŒ–å®Œæˆå‰ï¼Œä¹Ÿæœ‰æ‰“å°æ—¥å¿—è°ƒè¯•çš„éœ€æ±‚ï¼ŒStatusLoggerå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿã€‚&lt;/span&gt;&lt;/section&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;Troubleshooting tip for the impatient:&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;From log4j-2.9 onward, log4j2 will print all internal logging to the console if system property log4j2.debug is defined (&lt;/span&gt;&lt;span&gt;with any or no value&lt;/span&gt;&lt;span&gt;).&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Prior to log4j-2.9, there are two places where internal logging can be controlled:&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;Before a configuration is found, status logger level can be controlled with system property org.apache.logging.log4j.simplelog.StatusLogger.level.&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;After a configuration is found, status logger level can be controlled in the configuration file with the &quot;status&quot; attribute, for example: &amp;lt;Configuration status=&quot;trace&quot;&amp;gt;.&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;Just as it is desirable to be able to diagnose problems in applications, it is frequently necessary to be able to diagnose problems in the logging configuration or in the configured components. Since logging has not been configured, &quot;normal&quot; logging cannot be used during initialization. In addition, normal logging within appenders could create infinite recursion which Log4j will detect and cause the recursive events to be ignored. To accomodate this need, the Log4j 2 API includes a &lt;/span&gt;&lt;a href=&quot;https://logging.apache.org/log4j/2.x/log4j-api/apidocs/org/apache/logging/log4j/status/StatusLogger.html&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;StatusLogger&lt;/span&gt;&lt;/a&gt;&lt;span&gt;.&lt;/span&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.1.6 é—®é¢˜å°ç»“&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—é‡è¿‡å¤§å¯¼è‡´AsyncAppenderæ—¥å¿—é˜Ÿåˆ—è¢«æ‰“æ»¡ï¼Œæ–°çš„æ—¥å¿—äº‹ä»¶æ— æ³•å…¥é˜Ÿï¼Œè¿›è€Œç”±ErrorHandlerå¤„ç†æ—¥å¿—ï¼ŒåŒæ—¶ç”±äºErrorHandlerå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯¼è‡´å¤§é‡æ—¥å¿—è¾“å‡ºåˆ°äº†Consoleï¼Œè€ŒConsoleåœ¨è¾“å‡ºæ—¥å¿—åˆ°PrintStreamè¾“å‡ºæµæ—¶ï¼Œå­˜åœ¨synchronizedåŒæ­¥ä»£ç å—ï¼Œæ‰€ä»¥åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯¼è‡´çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.2 AsyncAppenderå¯¼è‡´çº¿ç¨‹Block&lt;/span&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.2.1 é—®é¢˜ç°åœº&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;æ”¶åˆ°â€œjvm.thread.blocked.countâ€å‘Šè­¦åç«‹åˆ»é€šè¿‡ç›‘æ§å¹³å°æŸ¥çœ‹çº¿ç¨‹ç›‘æ§æŒ‡æ ‡ï¼Œå½“æ—¶çš„çº¿ç¨‹å †æ ˆå¦‚ä¸‹å›¾6å’Œå›¾7æ‰€ç¤ºã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;284&quot; data-ratio=&quot;0.5046875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJNyODMs6BSzv9eEdEpeibQFAa9ONd6MOy15dAUQDG0464TjicicMBSiaicIw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾6 ç­‰å¾…é”çš„Blockedçº¿ç¨‹å †æ ˆ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;275&quot; data-ratio=&quot;0.4890625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJM1iaBUETc10QG5eaic9fBaDaZzI8UHL7uRUYN5vrW2khibJ9pGzEs9a6g/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾7 æŒæœ‰é”çš„Runnableçº¿ç¨‹å †æ ˆ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä»Blockedçº¿ç¨‹å †æ ˆä¸éš¾çœ‹å‡ºæ˜¯è·Ÿæ—¥å¿—æ‰“å°ç›¸å…³ï¼Œç”±äºæ˜¯ERRORçº§åˆ«æ—¥å¿—ï¼ŒæŸ¥çœ‹å…·ä½“æŠ¥é”™æ—¥å¿—ï¼Œå‘ç°æœ‰ä¸¤ç§ä¸šåŠ¡å¼‚å¸¸ï¼Œåˆ†åˆ«å¦‚ä¸‹å›¾8å’Œå›¾9æ‰€ç¤ºï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;296&quot; data-ratio=&quot;0.5265625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJ4OSQrNjPZwf2Fg1TFWrmH3a0Y7Ux07ibucEPbvRyHyPbz2GXMomqdJw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾8 ä¸šåŠ¡å¼‚å¸¸å †æ ˆä¸€&lt;/span&gt;&lt;span/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;177&quot; data-ratio=&quot;0.3151041666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJS5YgdnjMrbKltZmczQnng4MSzmm7wjbMcamEJytnpUrtLEwOLicqnjw/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾9 ä¸šåŠ¡å¼‚å¸¸å †æ ˆäºŒ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;è¿™äº›ä¸šåŠ¡å¼‚å¸¸ä¼šæ˜¯å¯¼è‡´çº¿ç¨‹Blockçš„å¹•åå…ƒå‡¶å—ï¼Ÿæ¥ä¸‹æ¥æœ¬ç« èŠ‚å°†ç»“åˆå¦‚ä¸‹å›¾10æ‰€ç¤ºçš„è°ƒç”¨é“¾è·¯æ·±å…¥åˆ†æçº¿ç¨‹Blockçš„æ ¹å› ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;281&quot; data-ratio=&quot;0.5004803073967339&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJPQQUHFMFSZ5Vk1ia9uCMlWOnfsD18n3T6v9QuKfUPz65eqspNS00mNA/640?wx_fmt=png&quot; data-w=&quot;2082&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾10 æ—¥å¿—è°ƒç”¨é“¾è·¯&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.2.2 ä¸ºä»€ä¹ˆä¼šBlockçº¿ç¨‹ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;ä»Blockedçº¿ç¨‹å †æ ˆä¸­å¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹é˜»å¡åœ¨ç±»åŠ è½½æµç¨‹ä¸Šï¼ŒæŸ¥çœ‹WebAppClassLoaderç›¸å…³ä»£ç ç‰‡æ®µå¦‚ä¸‹å›¾11æ‰€ç¤ºï¼Œå‘ç°åŠ è½½ç±»æ—¶ç¡®å®ä¼šæ ¹æ®ç±»åæ¥åŠ synchronizedåŒæ­¥å—ï¼Œå› æ­¤åˆæ­¥çŒœæµ‹æ˜¯ç±»åŠ è½½å¯¼è‡´çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;289&quot; data-ratio=&quot;0.5142231947483589&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJcQXkeWElickoPBpWHfw7CaczRelbsD6LiaBDLaJ5jAgBplqEZvMQI5oQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1828&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾11 WebAppClassLoader&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä½†ä¸Šè¿°çŒœæµ‹è¿˜æœ‰ä¸€äº›å€¼å¾—æ¨æ•²çš„åœ°æ–¹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;é¡¹ç›®ä»£ç é‡Œåªæ˜¯æ™®é€šåœ°è¾“å‡ºä¸€æ¡ERRORæ—¥å¿—è€Œå·²ï¼Œä¸ºä½•ä¼šè§¦å‘ç±»åŠ è½½ï¼Ÿ&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;é€šå¸¸æƒ…å†µä¸‹ç±»åŠ è½½å‡ ä¹ä¸ä¼šè§¦å‘çº¿ç¨‹Blockï¼Œä¸ç„¶ä¸€ä¸ªé¡¹ç›®è¦åŠ è½½æˆåƒä¸Šä¸‡ä¸ªç±»ï¼Œå¦‚æœå› ä¸ºåŠ è½½ç±»å°±å¯¼è‡´Blockï¼Œé‚£é¡¹ç›®å°±æ²¡æ³•æ­£å¸¸è¿è¡Œäº†ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.2.3 ä¸ºä»€ä¹ˆä¼šè§¦å‘ç±»åŠ è½½ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;ç»§ç»­ä»Blockedçº¿ç¨‹å †æ ˆç€æ‰‹åˆ†æï¼ŒæŸ¥çœ‹å †æ ˆä¸­çš„ThrowableProxyç›¸å…³ä»£ç ï¼Œå‘ç°å…¶æ„é€ å‡½æ•°ä¼šéå†æ•´ä¸ªå¼‚å¸¸å †æ ˆä¸­çš„æ‰€æœ‰å †æ ˆå…ƒç´ ï¼Œæœ€ç»ˆè·å–æ‰€æœ‰å †æ ˆå…ƒç´ ç±»æ‰€åœ¨çš„JARåç§°å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;é¦–å…ˆè·å–å †æ ˆå…ƒç´ çš„ç±»åç§°ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å†é€šè¿‡loadClassçš„æ–¹å¼è·å–å¯¹åº”çš„Classå¯¹è±¡ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;è¿›ä¸€æ­¥è·å–è¯¥ç±»æ‰€åœ¨çš„JARä¿¡æ¯ï¼Œä»CodeSourceä¸­è·å–JARåç§°ï¼Œä»Packageä¸­è·å–JARç‰ˆæœ¬ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.impl.ThrowableProxy&lt;/span&gt;&lt;br/&gt;Â Â &lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;ThrowableProxy&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â ThrowableÂ throwable,Â &lt;span&gt;final&lt;/span&gt;Â Set&amp;lt;Throwable&amp;gt;Â visited)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.throwableÂ =Â throwable;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.nameÂ =Â throwable.getClass().getName();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.messageÂ =Â throwable.getMessage();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.localizedMessageÂ =Â throwable.getLocalizedMessage();&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â Map&amp;lt;String,Â CacheEntry&amp;gt;Â mapÂ =Â &lt;span&gt;new&lt;/span&gt;Â HashMap&amp;lt;&amp;gt;();&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â Stack&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;Â stackÂ =Â ReflectionUtil.getCurrentStackTrace();&lt;br/&gt;Â Â Â &lt;span&gt;//Â è·å–å †æ ˆæ‰©å±•ä¿¡æ¯&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.extendedStackTraceÂ =Â &lt;span&gt;this&lt;/span&gt;.toExtendedStackTrace(stack,Â map,Â &lt;span&gt;null&lt;/span&gt;,Â throwable.getStackTrace());&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â ThrowableÂ throwableCauseÂ =Â throwable.getCause();&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â Set&amp;lt;Throwable&amp;gt;Â causeVisitedÂ =Â &lt;span&gt;new&lt;/span&gt;Â HashSet&amp;lt;&amp;gt;(&lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.causeProxyÂ =Â throwableCauseÂ ==Â &lt;span&gt;null&lt;/span&gt;Â ?Â &lt;span&gt;null&lt;/span&gt;Â :Â &lt;span&gt;new&lt;/span&gt;Â ThrowableProxy(throwable,Â stack,Â map,Â throwableCause,&lt;br/&gt;Â Â Â Â Â Â Â Â visited,Â causeVisited);&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.suppressedProxiesÂ =Â &lt;span&gt;this&lt;/span&gt;.toSuppressedProxies(throwable,Â visited);&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;ExtendedStackTraceElement[]Â toExtendedStackTrace(&lt;span&gt;final&lt;/span&gt;Â Stack&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;Â stack,Â &lt;span&gt;final&lt;/span&gt;Â Map&amp;lt;String,Â CacheEntry&amp;gt;Â map,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StackTraceElement[]Â rootTrace,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StackTraceElement[]Â stackTrace)Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â stackLength;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (rootTraceÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â rootIndexÂ =Â rootTrace.lengthÂ -Â &lt;span&gt;1&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â stackIndexÂ =Â stackTrace.lengthÂ -Â &lt;span&gt;1&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;while&lt;/span&gt;Â (rootIndexÂ &amp;gt;=Â &lt;span&gt;0&lt;/span&gt;Â &amp;amp;&amp;amp;Â stackIndexÂ &amp;gt;=Â &lt;span&gt;0&lt;/span&gt;Â &amp;amp;&amp;amp;Â rootTrace[rootIndex].equals(stackTrace[stackIndex]))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â --rootIndex;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â --stackIndex;&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.commonElementCountÂ =Â stackTrace.lengthÂ -Â &lt;span&gt;1&lt;/span&gt;Â -Â stackIndex;&lt;br/&gt;Â Â Â Â Â Â Â Â stackLengthÂ =Â stackIndexÂ +Â &lt;span&gt;1&lt;/span&gt;;&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.commonElementCountÂ =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â stackLengthÂ =Â stackTrace.length;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â ExtendedStackTraceElement[]Â extStackTraceÂ =Â &lt;span&gt;new&lt;/span&gt;Â ExtendedStackTraceElement[stackLength];&lt;br/&gt;Â Â Â Â Class&amp;lt;?&amp;gt;Â clazzÂ =Â stack.isEmpty()Â ?Â &lt;span&gt;null&lt;/span&gt;Â :Â stack.peek();&lt;br/&gt;Â Â Â Â ClassLoaderÂ lastLoaderÂ =Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (&lt;span&gt;int&lt;/span&gt;Â iÂ =Â stackLengthÂ -Â &lt;span&gt;1&lt;/span&gt;;Â iÂ &amp;gt;=Â &lt;span&gt;0&lt;/span&gt;;Â --i)Â {&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â éå†Â StackTraceElement&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StackTraceElementÂ stackTraceElementÂ =Â stackTrace[i];&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â è·å–å †æ ˆå…ƒç´ å¯¹åº”çš„ç±»åç§°&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringÂ classNameÂ =Â stackTraceElement.getClassName();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â TheÂ stackÂ returnedÂ fromÂ getCurrentStackÂ mayÂ beÂ missingÂ entriesÂ forÂ java.lang.reflect.Method.invoke()&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â andÂ itsÂ implementation.Â TheÂ ThrowableÂ mightÂ alsoÂ containÂ stackÂ entriesÂ thatÂ areÂ noÂ longer&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â presentÂ asÂ thoseÂ methodsÂ haveÂ returned.&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â ExtendedClassInfoÂ extClassInfo;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (clazzÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â className.equals(clazz.getName()))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â CacheEntryÂ entryÂ =Â &lt;span&gt;this&lt;/span&gt;.toCacheEntry(stackTraceElement,Â clazz,Â &lt;span&gt;true&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â extClassInfoÂ =Â entry.element;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â lastLoaderÂ =Â entry.loader;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â stack.pop();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â clazzÂ =Â stack.isEmpty()Â ?Â &lt;span&gt;null&lt;/span&gt;Â :Â stack.peek();&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â å¯¹åŠ è½½è¿‡çš„Â classNameÂ è¿›è¡Œç¼“å­˜ï¼Œé¿å…é‡å¤åŠ è½½&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â CacheEntryÂ cacheEntryÂ =Â map.get(className);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (cacheEntryÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â CacheEntryÂ entryÂ =Â cacheEntry;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â extClassInfoÂ =Â entry.element;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (entry.loaderÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lastLoaderÂ =Â entry.loader;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â é€šè¿‡åŠ è½½ç±»æ¥è·å–ç±»çš„æ‰©å±•ä¿¡æ¯ï¼Œå¦‚Â locationÂ å’ŒÂ versionÂ ç­‰&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â CacheEntryÂ entryÂ =Â &lt;span&gt;this&lt;/span&gt;.toCacheEntry(stackTraceElement,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â è·å–Â ClassÂ å¯¹è±¡&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.loadClass(lastLoader,Â className),Â &lt;span&gt;false&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â extClassInfoÂ =Â entry.element;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â map.put(stackTraceElement.toString(),Â entry);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (entry.loaderÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lastLoaderÂ =Â entry.loader;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â extStackTrace[i]Â =Â &lt;span&gt;new&lt;/span&gt;Â ExtendedStackTraceElement(stackTraceElement,Â extClassInfo);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â extStackTrace;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;/**&lt;br/&gt;Â *Â ConstructÂ theÂ CacheEntryÂ fromÂ theÂ Class&#x27;sÂ information.&lt;br/&gt;Â *&lt;br/&gt;Â *Â &lt;span&gt;@param&lt;/span&gt;Â stackTraceElementÂ TheÂ stackÂ traceÂ element&lt;br/&gt;Â *Â &lt;span&gt;@param&lt;/span&gt;Â callerClassÂ Â Â Â Â Â Â TheÂ Class.&lt;br/&gt;Â *Â &lt;span&gt;@param&lt;/span&gt;Â exactÂ Â Â Â Â Â Â Â Â Â Â Â Â TrueÂ ifÂ theÂ classÂ wasÂ obtainedÂ viaÂ Reflection.getCallerClass.&lt;br/&gt;Â *Â &lt;span&gt;@return&lt;/span&gt;Â TheÂ CacheEntry.&lt;br/&gt;Â */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â CacheEntryÂ &lt;span&gt;toCacheEntry&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â StackTraceElementÂ stackTraceElement,Â &lt;span&gt;final&lt;/span&gt;Â Class&amp;lt;?&amp;gt;Â callerClass,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â exact)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â StringÂ locationÂ =Â &lt;span&gt;&quot;?&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â StringÂ versionÂ =Â &lt;span&gt;&quot;?&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â ClassLoaderÂ lastLoaderÂ =Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (callerClassÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â è·å–Â jarÂ æ–‡ä»¶ä¿¡æ¯&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â CodeSourceÂ sourceÂ =Â callerClass.getProtectionDomain().getCodeSource();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (sourceÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â URLÂ locationURLÂ =Â source.getLocation();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (locationURLÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringÂ strÂ =Â locationURL.toString().replace(&lt;span&gt;&#x27;\\&#x27;&lt;/span&gt;,Â &lt;span&gt;&#x27;/&#x27;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â indexÂ =Â str.lastIndexOf(&lt;span&gt;&quot;/&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (indexÂ &amp;gt;=Â &lt;span&gt;0&lt;/span&gt;Â &amp;amp;&amp;amp;Â indexÂ ==Â str.length()Â -Â &lt;span&gt;1&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â indexÂ =Â str.lastIndexOf(&lt;span&gt;&quot;/&quot;&lt;/span&gt;,Â indexÂ -Â &lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â locationÂ =Â str.substring(indexÂ +Â &lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â locationÂ =Â str.substring(indexÂ +Â &lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (&lt;span&gt;final&lt;/span&gt;Â ExceptionÂ ex)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â IgnoreÂ theÂ exception.&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;//Â è·å–ç±»æ‰€åœ¨Â jarÂ ç‰ˆæœ¬ä¿¡æ¯&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â PackageÂ pkgÂ =Â callerClass.getPackage();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (pkgÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringÂ verÂ =Â pkg.getImplementationVersion();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (verÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â versionÂ =Â ver;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â lastLoaderÂ =Â callerClass.getClassLoader();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â CacheEntry(&lt;span&gt;new&lt;/span&gt;Â ExtendedClassInfo(exact,Â location,Â version),Â lastLoader);&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;ä»ä¸Šè¿°ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒThrowableProxy#toExtendedStackTraceæ–¹æ³•é€šè¿‡Map&amp;lt;String, CacheEntry&amp;gt;ç¼“å­˜å½“å‰å †æ ˆå…ƒç´ ç±»å¯¹åº”çš„CacheEntryï¼Œæ¥é¿å…é‡å¤è§£æCacheEntryï¼Œä½†æ˜¯ç”±äºMapç¼“å­˜putæ“ä½œä½¿ç”¨çš„keyæ¥è‡ªäºStackTraceElement.toStringæ–¹æ³•ï¼Œè€Œgetæ“ä½œä½¿ç”¨çš„keyå´æ¥è‡ªäºStackTraceElement.getClassNameæ–¹æ³•ï¼Œå³ä½¿å¯¹äºåŒä¸€ä¸ªStackTraceElementè€Œè¨€ï¼Œå…¶toStringå’ŒgetClassNameæ–¹æ³•å¯¹åº”çš„è¿”å›ç»“æœä¹Ÿä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ­¤mapå½¢åŒè™šè®¾ã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â java.lang.StackTraceElement&lt;/span&gt;&lt;br/&gt;Â Â &lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â StringÂ &lt;span&gt;getClassName&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â declaringClass;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â StringÂ &lt;span&gt;toString&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â getClassName()Â +Â &lt;span&gt;&quot;.&quot;&lt;/span&gt;Â +Â methodNameÂ +&lt;br/&gt;Â Â Â Â Â Â Â Â (isNativeMethod()Â ?Â &lt;span&gt;&quot;(NativeÂ Method)&quot;&lt;/span&gt;Â :&lt;br/&gt;Â Â Â Â Â Â Â Â Â (fileNameÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â lineNumberÂ &amp;gt;=Â &lt;span&gt;0&lt;/span&gt;Â ?&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&quot;(&quot;&lt;/span&gt;Â +Â fileNameÂ +Â &lt;span&gt;&quot;:&quot;&lt;/span&gt;Â +Â lineNumberÂ +Â &lt;span&gt;&quot;)&quot;&lt;/span&gt;Â :&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â (fileNameÂ !=Â &lt;span&gt;null&lt;/span&gt;Â ?Â Â &lt;span&gt;&quot;(&quot;&lt;/span&gt;+fileName+&lt;span&gt;&quot;)&quot;&lt;/span&gt;Â :Â &lt;span&gt;&quot;(UnknownÂ Source)&quot;&lt;/span&gt;)));&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;è¯¥é—®é¢˜å·²æœ‰ç›¸å…³&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2389&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;Issue: fix the CacheEntry map in ThrowableProxy#toExtendedStackTrace to be put and gotten with same key&lt;/span&gt;&lt;/a&gt;&lt;span&gt;åé¦ˆç»™ç¤¾åŒºï¼Œå¹¶åœ¨&lt;/span&gt;&lt;a href=&quot;https://logging.apache.org/log4j/2.x/changes-report.html#a2.11.1&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;2.11.1&lt;/span&gt;&lt;/a&gt;&lt;span&gt;ç‰ˆæœ¬ä¸­ä¿®å¤äº†è¯¥é—®é¢˜ã€‚è™½ç„¶é€šè¿‡è®©get/putæ–¹æ³•ä½¿ç”¨åŒä¸€ä¸ªkeyæ¥ä¿®å¤ç¼“å­˜çš„æœ‰æ•ˆæ€§é—®é¢˜ï¼Œä½†ç”±äºThrowableProxyå¯¹æ¯ä¸ªThrowableéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„Mapï¼Œè€Œä¸æ˜¯ä½¿ç”¨å…¨å±€Mapï¼Œå› æ­¤å…¶ç¼“å­˜ä¹Ÿä»…ä»…å¯¹å•ä¸ªThrowableç”Ÿæ•ˆï¼Œä½œç”¨èŒƒå›´éå¸¸æœ‰é™ï¼Œé£Ÿä¹‹æ— å‘³ï¼Œå¼ƒä¹‹å¯æƒœã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;è¨€å½’æ­£ä¼ ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸€ä¸ªç±»åŠ è½½å™¨å¯¹äºä¸€ä¸ªç±»åªä¼šåŠ è½½ä¸€æ¬¡ï¼Œç±»åŠ è½½å™¨å†…éƒ¨ä¿å­˜æœ‰ç±»ç¼“å­˜ï¼Œæ— éœ€é‡å¤åŠ è½½ï¼Œä½†ç›®å‰çš„ç°è±¡å´æ˜¯ç”±äºç±»åŠ è½½è€Œå¯¼è‡´çº¿ç¨‹å¤§é‡Blockï¼Œå› æ­¤å¿…ç„¶æ˜¯æœ‰äº›ç±»åŠ è½½ä¸äº†ï¼Œä¸”ä¸æ–­é‡å¤å°è¯•åŠ è½½ï¼Œé‚£åˆ°åº•æ˜¯ä»€ä¹ˆç±»æ— æ³•åŠ è½½å‘¢ï¼Ÿ&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.2.4 åˆ°åº•ä»€ä¹ˆç±»åŠ è½½ä¸äº†ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;è¦æ‰¾åˆ°å…·ä½“æ˜¯ä»€ä¹ˆç±»æ— æ³•åŠ è½½ï¼Œå½’æ ¹ç»“åº•è¿˜æ˜¯è¦åˆ†æä¸šåŠ¡å¼‚å¸¸çš„å…·ä½“å †æ ˆã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;545&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;287&quot; data-ratio=&quot;0.5265625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJ4OSQrNjPZwf2Fg1TFWrmH3a0Y7Ux07ibucEPbvRyHyPbz2GXMomqdJw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾12 ä¸šåŠ¡å¼‚å¸¸å †æ ˆä¸€&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;1&quot; data-cropselx2=&quot;546&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;172&quot; data-ratio=&quot;0.3151041666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJS5YgdnjMrbKltZmczQnng4MSzmm7wjbMcamEJytnpUrtLEwOLicqnjw/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾13 ä¸šåŠ¡å¼‚å¸¸å †æ ˆäºŒ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å¯¹æ¯”å¦‚å›¾12å’Œå›¾13æ‰€ç¤ºçš„ä¸¤ä»½ä¸šåŠ¡å¼‚å¸¸å †æ ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä»½å †æ ˆåŸºæœ¬ç›¸ä¼¼ï¼Œä¸”å¤§å¤šæ•°ç±»éƒ½æ˜¯å¾ˆæ™®é€šçš„ç±»ï¼Œä½†æ˜¯å”¯ä¸€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;sun.reflect.NativeMethodAccessorImplï¼ˆ&lt;/span&gt;&lt;span&gt;å‚è§å›¾12&lt;/span&gt;&lt;span&gt;ï¼‰ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;sun.reflect.GeneratedMethodAccessor261ï¼ˆ&lt;/span&gt;&lt;span&gt;å‚è§å›¾13&lt;/span&gt;&lt;span&gt;ï¼‰ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;ä»å­—é¢ä¿¡æ¯ä¸­ä¸éš¾çŒœæµ‹å‡ºè¿™ä¸åå°„è°ƒç”¨ç›¸å…³ï¼Œä½†é—®é¢˜æ˜¯è¿™ä¸¤ä»½å †æ ˆå¯¹åº”çš„å…¶å®æ˜¯åŒä¸€ä»½ä¸šåŠ¡ä»£ç ï¼Œä¸ºä»€ä¹ˆä¼šäº§ç”Ÿä¸¤ä»½ä¸åŒçš„å¼‚å¸¸å †æ ˆï¼Ÿ&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æŸ¥é˜…ç›¸å…³èµ„æ–™å¾—çŸ¥ï¼Œè¿™ä¸JVMåå°„è°ƒç”¨ç›¸å…³ï¼ŒJVMå¯¹åå°„è°ƒç”¨åˆ†ä¸¤ç§æƒ…å†µï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;é»˜è®¤ä½¿ç”¨nativeæ–¹æ³•è¿›è¡Œåå°„æ“ä½œã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;ä¸€å®šæ¡ä»¶ä¸‹ä¼šç”Ÿæˆå­—èŠ‚ç è¿›è¡Œåå°„æ“ä½œï¼Œå³ç”Ÿæˆsun.reflect.GeneratedMethodAccessor&amp;lt;N&amp;gt;ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°„è°ƒç”¨æ–¹æ³•çš„åŒ…è£…ç±»ï¼Œä»£ç†ä¸åŒçš„æ–¹æ³•ï¼Œç±»åç¼€åºå·é€’å¢ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;JVMåå°„è°ƒç”¨çš„ä¸»è¦æµç¨‹æ˜¯è·å–MethodAccessorï¼Œå¹¶ç”±MethodAccessoræ‰§è¡Œinvokeè°ƒç”¨ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â java.lang.reflect.MethodÂ Â &lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@CallerSensitive&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â ObjectÂ &lt;span&gt;invoke&lt;/span&gt;&lt;span&gt;(ObjectÂ obj,Â Object...Â args)&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;throws&lt;/span&gt;Â IllegalAccessException,Â IllegalArgumentException,&lt;br/&gt;Â Â Â Â Â Â Â InvocationTargetException&lt;br/&gt;&lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!override)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!Reflection.quickCheckMemberAccess(clazz,Â modifiers))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Class&amp;lt;?&amp;gt;Â callerÂ =Â Reflection.getCallerClass();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â checkAccess(caller,Â clazz,Â obj,Â modifiers);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â MethodAccessorÂ maÂ =Â methodAccessor;Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â readÂ volatile&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (maÂ ==Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;//Â è·å–Â MethodAccessor&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â maÂ =Â acquireMethodAccessor();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â é€šè¿‡Â MethodAccessorÂ è°ƒç”¨&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â ma.invoke(obj,Â args);&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â MethodAccessorÂ &lt;span&gt;acquireMethodAccessor&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â MethodAccessorÂ tmpÂ =Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (rootÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â tmpÂ =Â root.getMethodAccessor();&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (tmpÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â methodAccessorÂ =Â tmp;&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â é€šè¿‡Â ReflectionFactoryÂ åˆ›å»ºÂ MethodAccessor&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â tmpÂ =Â reflectionFactory.newMethodAccessor(&lt;span&gt;this&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â setMethodAccessor(tmp);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â tmp;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;å½“noInflationä¸ºfalseï¼ˆ&lt;/span&gt;&lt;span&gt;é»˜è®¤ä¸ºfalse&lt;/span&gt;&lt;span&gt;ï¼‰æˆ–è€…åå°„æ–¹æ³•æ‰€åœ¨ç±»æ˜¯VMåŒ¿åç±»ï¼ˆ&lt;/span&gt;&lt;span&gt;ç±»åä¸­åŒ…æ‹¬æ–œæ â€œ/â€&lt;/span&gt;&lt;span&gt;ï¼‰çš„æƒ…å†µä¸‹ï¼ŒReflectionFactoryä¼šè¿”å›ä¸€ä¸ªMethodAccessorä»£ç†ç±»ï¼Œå³DelegatingMethodAccessorImplã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â sun.reflect.ReflectionFactory&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â MethodAccessorÂ &lt;span&gt;newMethodAccessor&lt;/span&gt;&lt;span&gt;(MethodÂ method)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â &lt;span&gt;//Â é€šè¿‡å¯åŠ¨å‚æ•°è·å–å¹¶è§£æÂ noInflationÂ å’ŒÂ inflationThresholdÂ å€¼&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;//Â noInflationÂ é»˜è®¤ä¸ºÂ false&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;//Â inflationThresholdÂ é»˜è®¤ä¸º15&lt;/span&gt;&lt;br/&gt;Â Â Â Â checkInitted();&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (noInflationÂ &amp;amp;&amp;amp;Â !ReflectUtil.isVMAnonymousClass(method.getDeclaringClass()))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â MethodAccessorGenerator().&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â generateMethod(method.getDeclaringClass(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getName(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getParameterTypes(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getReturnType(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getExceptionTypes(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getModifiers());&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â NativeMethodAccessorImplÂ accÂ =&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;new&lt;/span&gt;Â NativeMethodAccessorImpl(method);&lt;br/&gt;Â Â Â Â Â Â Â Â DelegatingMethodAccessorImplÂ resÂ =&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;new&lt;/span&gt;Â DelegatingMethodAccessorImpl(acc);&lt;br/&gt;Â Â Â Â Â Â Â Â acc.setParent(res);&lt;br/&gt;Â Â Â Â Â Â &lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â è¿”å›ä»£ç†Â DelegatingMethodAccessorImpl&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â res;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;checkInitted&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (initted)Â &lt;span&gt;return&lt;/span&gt;;&lt;br/&gt;Â Â Â Â AccessController.doPrivileged(&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;new&lt;/span&gt;Â PrivilegedAction&amp;lt;Void&amp;gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â VoidÂ &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â TestsÂ toÂ ensureÂ theÂ systemÂ propertiesÂ tableÂ isÂ fully&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â initialized.Â ThisÂ isÂ neededÂ becauseÂ reflectionÂ codeÂ is&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â calledÂ veryÂ earlyÂ inÂ theÂ initializationÂ processÂ (before&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â command-lineÂ argumentsÂ haveÂ beenÂ parsedÂ andÂ therefore&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â theseÂ user-settableÂ propertiesÂ installed.)Â WeÂ assumeÂ that&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â ifÂ System.outÂ isÂ non-nullÂ thenÂ theÂ SystemÂ classÂ hasÂ been&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â fullyÂ initializedÂ andÂ thatÂ theÂ bulkÂ ofÂ theÂ startupÂ code&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â hasÂ beenÂ run.&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (System.outÂ ==Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â java.lang.SystemÂ notÂ yetÂ fullyÂ initialized&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ valÂ =Â System.getProperty(&lt;span&gt;&quot;sun.reflect.noInflation&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (valÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â val.equals(&lt;span&gt;&quot;true&quot;&lt;/span&gt;))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â noInflationÂ =Â &lt;span&gt;true&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â valÂ =Â System.getProperty(&lt;span&gt;&quot;sun.reflect.inflationThreshold&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (valÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â inflationThresholdÂ =Â Integer.parseInt(val);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (NumberFormatExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;throw&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â RuntimeException(&lt;span&gt;&quot;UnableÂ toÂ parseÂ propertyÂ sun.reflect.inflationThreshold&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â inittedÂ =Â &lt;span&gt;true&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â });&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;é»˜è®¤æƒ…å†µä¸‹DelegatingMethodAccessorImplä»£ç†äº†NativeMethodAccessorImplï¼Œä½†æ˜¯éšç€åå°„è°ƒç”¨æ¬¡æ•°çš„å¢åŠ ï¼Œå½“ä¸€ä¸ªæ–¹æ³•è¢«åå°„è°ƒç”¨çš„æ¬¡æ•°è¶…è¿‡ä¸€å®šçš„é˜€å€¼æ—¶ï¼ˆ&lt;/span&gt;&lt;span&gt;inflationThresholdï¼Œé»˜è®¤å€¼æ˜¯15&lt;/span&gt;&lt;span&gt;ï¼‰ï¼ŒNativeMethodAccessorImplä¼šé€šè¿‡å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯ï¼Œè‡ªåŠ¨ç”ŸæˆMethodAccessorImplå®ç°ç±»ï¼Œå¹¶ä¿®æ”¹DelegatingMethodAccessorImplçš„å†…éƒ¨ä»£ç†å¯¹è±¡æŒ‡å‘å­—èŠ‚ç ç”Ÿæˆç±»å®ä¾‹ï¼Œä»è€Œæ”¹å˜åç»­åå°„è°ƒç”¨é€»è¾‘ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;583&quot; data-ratio=&quot;1.0379981464318813&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJicllsLdibFLTDnn9BGkwxUBNTfup2iczicnruN8ORMnQPq21WVMqdohO0g/640?wx_fmt=png&quot; data-w=&quot;1079&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾14 MethodAccessorå…³ç³»å›¾&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â sun.reflect.DelegatingMethodAccessorImpl&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;DelegatingMethodAccessorImpl&lt;/span&gt;Â &lt;span&gt;extends&lt;/span&gt;Â &lt;span&gt;MethodAccessorImpl&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â &lt;span&gt;//Â å†…éƒ¨ä»£ç†Â MethodAccessorImpl&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â MethodAccessorImplÂ delegate;&lt;br/&gt;&lt;br/&gt;Â Â Â Â DelegatingMethodAccessorImpl(MethodAccessorImplÂ delegate)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â setDelegate(delegate);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â ObjectÂ &lt;span&gt;invoke&lt;/span&gt;&lt;span&gt;(ObjectÂ obj,Â Object[]Â args)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;throws&lt;/span&gt;Â IllegalArgumentException,Â InvocationTargetException&lt;br/&gt;Â Â Â Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â delegate.invoke(obj,Â args);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;setDelegate&lt;/span&gt;&lt;span&gt;(MethodAccessorImplÂ delegate)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.delegateÂ =Â delegate;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â sun.reflect.NativeMethodAccessorImpl&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;NativeMethodAccessorImpl&lt;/span&gt;Â &lt;span&gt;extends&lt;/span&gt;Â &lt;span&gt;MethodAccessorImpl&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â MethodÂ method;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â DelegatingMethodAccessorImplÂ parent;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â numInvocations;&lt;br/&gt;&lt;br/&gt;Â Â Â Â NativeMethodAccessorImpl(MethodÂ method)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.methodÂ =Â method;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â ObjectÂ &lt;span&gt;invoke&lt;/span&gt;&lt;span&gt;(ObjectÂ obj,Â Object[]Â args)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;throws&lt;/span&gt;Â IllegalArgumentException,Â InvocationTargetException&lt;br/&gt;Â Â Â Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â WeÂ can&#x27;tÂ inflateÂ methodsÂ belongingÂ toÂ vm-anonymousÂ classesÂ because&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â thatÂ kindÂ ofÂ classÂ can&#x27;tÂ beÂ referredÂ toÂ byÂ name,Â henceÂ can&#x27;tÂ be&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â foundÂ fromÂ theÂ generatedÂ bytecode.&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â æ¯æ¬¡è°ƒç”¨æ—¶Â numInvocationsÂ éƒ½ä¼šè‡ªå¢åŠ 1ï¼Œå¦‚æœè¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤æ˜¯15æ¬¡ï¼‰ï¼Œå°±ä¼šä¿®æ”¹çˆ¶ç±»çš„ä»£ç†å¯¹è±¡ï¼Œä»è€Œæ”¹å˜è°ƒç”¨é“¾è·¯&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (++numInvocationsÂ &amp;gt;Â ReflectionFactory.inflationThreshold()&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &amp;amp;&amp;amp;Â !ReflectUtil.isVMAnonymousClass(method.getDeclaringClass()))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â MethodAccessorImplÂ accÂ =Â (MethodAccessorImpl)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç ï¼Œä¼˜åŒ–åå°„è°ƒç”¨é€Ÿåº¦&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;new&lt;/span&gt;Â MethodAccessorGenerator().&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â generateMethod(method.getDeclaringClass(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getName(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getParameterTypes(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getReturnType(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getExceptionTypes(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method.getModifiers());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â ä¿®æ”¹çˆ¶ä»£ç†ç±»çš„ä»£ç†å¯¹è±¡&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â parent.setDelegate(acc);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â invoke0(method,Â obj,Â args);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;setParent&lt;/span&gt;&lt;span&gt;(DelegatingMethodAccessorImplÂ parent)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.parentÂ =Â parent;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;native&lt;/span&gt;Â ObjectÂ &lt;span&gt;invoke0&lt;/span&gt;&lt;span&gt;(MethodÂ m,Â ObjectÂ obj,Â Object[]Â args)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;ä»MethodAccessorGenerator#generateNameæ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œå­—èŠ‚ç ç”Ÿæˆçš„ç±»åç§°è§„åˆ™æ˜¯sun.reflect.GeneratedConstructorAccessor&amp;lt;N&amp;gt;ï¼Œå…¶ä¸­Næ˜¯ä»0å¼€å§‹çš„é€’å¢æ•°å­—ï¼Œä¸”ç”Ÿæˆç±»æ˜¯ç”±DelegatingClassLoaderç±»åŠ è½½å™¨å®šä¹‰ï¼Œæ‰€ä»¥å…¶ä»–ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»ï¼Œä¹Ÿå°±æ— æ³•ç”Ÿæˆç±»ç¼“å­˜æ•°æ®ï¼Œä»è€Œå¯¼è‡´æ¯æ¬¡åŠ è½½ç±»æ—¶éƒ½éœ€è¦éå†JarFileï¼Œæå¤§åœ°é™ä½äº†ç±»æŸ¥æ‰¾é€Ÿåº¦ï¼Œä¸”ç±»åŠ è½½è¿‡ç¨‹æ˜¯synchronizedåŒæ­¥è°ƒç”¨ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ä¼šæ›´åŠ æ¶åŒ–ï¼Œä»è€Œå¯¼è‡´çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â sun.reflect.MethodAccessorGenerator&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â MethodAccessorÂ &lt;span&gt;generateMethod&lt;/span&gt;&lt;span&gt;(Class&amp;lt;?&amp;gt;Â declaringClass,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ Â Â name,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Class&amp;lt;?&amp;gt;[]Â parameterTypes,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Class&amp;lt;?&amp;gt;Â Â Â returnType,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Class&amp;lt;?&amp;gt;[]Â checkedExceptions,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â modifiers)&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â (MethodAccessor)Â generate(declaringClass,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â name,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â parameterTypes,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnType,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â checkedExceptions,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â modifiers,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;false&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;null&lt;/span&gt;);&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â MagicAccessorImplÂ &lt;span&gt;generate&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â Class&amp;lt;?&amp;gt;Â declaringClass,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ name,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Class&amp;lt;?&amp;gt;[]Â parameterTypes,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Class&amp;lt;?&amp;gt;Â Â Â returnType,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Class&amp;lt;?&amp;gt;[]Â checkedExceptions,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â modifiers,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;boolean&lt;/span&gt;Â isConstructor,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;boolean&lt;/span&gt;Â forSerialization,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Class&amp;lt;?&amp;gt;Â serializationTargetClass)&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;{&lt;br/&gt;Â Â &lt;br/&gt;Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringÂ generatedNameÂ =Â generateName(isConstructor,Â forSerialization);&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â å¿½ç•¥ä»¥ä¸Šä»£ç &lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â AccessController.doPrivileged(&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;new&lt;/span&gt;Â PrivilegedAction&amp;lt;MagicAccessorImpl&amp;gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â MagicAccessorImplÂ &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â (MagicAccessorImpl)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ClassDefiner.defineClass&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (generatedName,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bytes,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;0&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â bytes.length,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â declaringClass.getClassLoader()).newInstance();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (InstantiationExceptionÂ |Â IllegalAccessExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;throw&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â InternalError(e);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â });&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â ç”Ÿæˆåå°„ç±»åï¼Œçœ‹åˆ°äº†ç†Ÿæ‚‰çš„Â sun.reflect.GeneratedConstructorAccessor&amp;lt;N&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;synchronized&lt;/span&gt;Â StringÂ &lt;span&gt;generateName&lt;/span&gt;&lt;span&gt;(&lt;span&gt;boolean&lt;/span&gt;Â isConstructor,Â &lt;span&gt;boolean&lt;/span&gt;Â forSerialization)&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (isConstructor)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (forSerialization)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â numÂ =Â ++serializationConstructorSymnum;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;sun/reflect/GeneratedSerializationConstructorAccessor&quot;&lt;/span&gt;Â +Â num;&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â numÂ =Â ++constructorSymnum;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;sun/reflect/GeneratedConstructorAccessor&quot;&lt;/span&gt;Â +Â num;&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â numÂ =Â ++methodSymnum;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;sun/reflect/GeneratedMethodAccessor&quot;&lt;/span&gt;Â +Â num;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â sun.reflect.ClassDefiner&lt;/span&gt;&lt;br/&gt;Â Â &lt;br/&gt;&lt;span&gt;static&lt;/span&gt;Â Class&amp;lt;?&amp;gt;Â defineClass(StringÂ name,Â &lt;span&gt;byte&lt;/span&gt;[]Â bytes,Â &lt;span&gt;int&lt;/span&gt;Â off,Â &lt;span&gt;int&lt;/span&gt;Â len,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â ClassLoaderÂ parentClassLoader)&lt;br/&gt;{&lt;br/&gt;Â Â Â Â ClassLoaderÂ newLoaderÂ =Â AccessController.doPrivileged(&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;new&lt;/span&gt;Â PrivilegedAction&amp;lt;ClassLoader&amp;gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â ClassLoaderÂ &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â DelegatingClassLoader(parentClassLoader);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â });&lt;br/&gt;Â Â Â &lt;span&gt;//Â é€šè¿‡Â DelegatingClassLoaderÂ ç±»åŠ è½½å™¨å®šä¹‰ç”Ÿæˆç±»&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â unsafe.defineClass(name,Â bytes,Â off,Â len,Â newLoader,Â &lt;span&gt;null&lt;/span&gt;);&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;é‚£ä¹ˆï¼ŒJVMåå°„è°ƒç”¨ä¸ºä»€ä¹ˆè¦åšè¿™ä¹ˆåšï¼Ÿ&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å…¶å®è¿™æ˜¯JVMå¯¹åå°„è°ƒç”¨çš„ä¸€ç§ä¼˜åŒ–æ‰‹æ®µï¼Œåœ¨sun.reflect.ReflectionFactoryçš„æ–‡æ¡£æ³¨é‡Šé‡Œå¯¹æ­¤åšäº†è§£é‡Šï¼Œè¿™æ˜¯ä¸€ç§â€œInflationâ€æœºåˆ¶ï¼ŒåŠ è½½å­—èŠ‚ç çš„è°ƒç”¨æ–¹å¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ä¼šæ¯”Nativeè°ƒç”¨çš„é€Ÿåº¦è¦æ…¢3~4å€ï¼Œä½†æ˜¯åœ¨åç»­è°ƒç”¨æ—¶ä¼šæ¯”Nativeè°ƒç”¨é€Ÿåº¦å¿«20å¤šå€ã€‚ä¸ºäº†é¿å…åå°„è°ƒç”¨å½±å“åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦ï¼Œæ‰€ä»¥åœ¨åå°„è°ƒç”¨çš„å‰å‡ æ¬¡é€šè¿‡Nativeæ–¹å¼è°ƒç”¨ï¼Œå½“è¶…è¿‡ä¸€å®šè°ƒç”¨æ¬¡æ•°åä½¿ç”¨å­—èŠ‚ç æ–¹å¼è°ƒç”¨ï¼Œæå‡åå°„è°ƒç”¨æ€§èƒ½ã€‚&lt;/span&gt;&lt;/section&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&quot;Inflation&quot; mechanism. Loading bytecodes to implement Method.invoke() and Constructor.newInstance() currently costs 3-4x more than an invocation via native code for the first invocation (though subsequent invocations have been benchmarked to be over 20x faster). Unfortunately this cost increases startup time for certain applications that use reflection intensively (but only once per class) to bootstrap themselves. To avoid this penalty we reuse the existing JVM entry points for the first few invocations of Methods and Constructors and then switch to the bytecode-based implementations.&lt;/span&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;section&gt;&lt;span&gt;è‡³æ­¤ï¼Œæ€»ç®—ç†æ¸…äº†ç±»åŠ è½½å¯¼è‡´çº¿ç¨‹Blockçš„ç›´æ¥åŸå› ï¼Œä½†è¿™å¹¶éæ ¹å› ï¼Œä¸šåŠ¡ä»£ç ä¸­æ™®æ™®é€šé€šåœ°æ‰“å°ä¸€æ¡ERRORæ—¥å¿—ï¼Œä¸ºä½•ä¼šå¯¼è‡´è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ï¼Ÿ&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.2.5 ä¸ºä»€ä¹ˆè¦è§£æå¼‚å¸¸å †æ ˆï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;276&quot; data-ratio=&quot;0.4905897114178168&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJntLZDgMWfkl3xDffTQL46gX28YddkuqOLFdHibqcFbMMhrTSEX7KeSw/640?wx_fmt=png&quot; data-w=&quot;1594&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾15 AsyncAppenderå¤„ç†æ—¥å¿—æµç¨‹&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;AsyncAppenderå¤„ç†æ—¥å¿—ç®€è¦æµç¨‹å¦‚ä¸Šå›¾15æ‰€ç¤ºï¼Œåœ¨å…¶å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªBlockingQueueé˜Ÿåˆ—å’Œä¸€ä¸ªAsyncThreadçº¿ç¨‹ï¼Œå¤„ç†æ—¥å¿—æ—¶å…ˆæŠŠæ—¥å¿—è½¬æ¢æˆLog4jLogEventå¿«ç…§ç„¶åå…¥é˜Ÿï¼ŒåŒæ—¶AsyncThreadçº¿ç¨‹è´Ÿè´£ä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ æ¥å¼‚æ­¥å¤„ç†æ—¥å¿—äº‹ä»¶ã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.appender.AsyncAppender&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;append&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ logEvent)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!isStarted())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;throw&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â IllegalStateException(&lt;span&gt;&quot;AsyncAppenderÂ &quot;&lt;/span&gt;Â +Â getName()Â +Â &lt;span&gt;&quot;Â isÂ notÂ active&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!Constants.FORMAT_MESSAGES_IN_BACKGROUND)Â {Â &lt;span&gt;//Â LOG4J2-898:Â userÂ mayÂ choose&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â logEvent.getMessage().getFormattedMessage();Â &lt;span&gt;//Â LOG4J2-763:Â askÂ messageÂ toÂ freezeÂ parameters&lt;/span&gt;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â &lt;span&gt;//Â åˆ›å»ºÂ æ—¥å¿—æ•°æ®å¿«ç…§&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â Log4jLogEventÂ mementoÂ =Â Log4jLogEvent.createMemento(logEvent,Â includeLocation);&lt;br/&gt;Â Â Â &lt;span&gt;//Â æ”¾å…¥Â BlockingQueueÂ ä¸­&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!transfer(memento))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (blocking)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â delegateÂ toÂ theÂ eventÂ routerÂ (whichÂ mayÂ discard,Â enqueueÂ andÂ block,Â orÂ logÂ inÂ currentÂ thread)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â EventRouteÂ routeÂ =Â asyncQueueFullPolicy.getRoute(thread.getId(),Â memento.getLevel());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â route.logMessage(&lt;span&gt;this&lt;/span&gt;,Â memento);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â error(&lt;span&gt;&quot;AppenderÂ &quot;&lt;/span&gt;Â +Â getName()Â +Â &lt;span&gt;&quot;Â isÂ unableÂ toÂ writeÂ primaryÂ appenders.Â queueÂ isÂ full&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â logToErrorAppenderIfNecessary(&lt;span&gt;false&lt;/span&gt;,Â memento);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;AsyncAppenderåœ¨ç”ŸæˆLogEventçš„å¿«ç…§Log4jLogEventæ—¶ï¼Œä¼šå…ˆå¯¹LogEventåºåˆ—åŒ–å¤„ç†ç»Ÿä¸€è½¬æ¢ä¸ºLogEventProxyï¼Œæ­¤æ—¶ä¸åŒç±»å‹çš„LogEventçš„å¤„ç†æƒ…å†µç¨æœ‰å·®å¼‚ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ç»¼ä¸Šï¼Œä¸ç®¡LogEventçš„å®é™…ç±»å‹æ˜¯MutableLogEventè¿˜æ˜¯Log4jLogEventï¼Œæœ€ç»ˆéƒ½ä¼šè§¦å‘åˆ›å»ºThrowableProxyå®ä¾‹ï¼Œå¹¶åœ¨ThrowableProxyæ„é€ å‡½æ•°å†…è§¦å‘äº†è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.impl.Log4jLogEvent&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â ç”ŸæˆLog4jLogEventå¿«ç…§&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â Log4jLogEventÂ &lt;span&gt;createMemento&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event,Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â includeLocation)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â TODOÂ implementÂ Log4jLogEvent.createMemento()&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â deserialize(serialize(event,Â includeLocation));&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â SerializableÂ &lt;span&gt;serialize&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event,Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â includeLocation)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (eventÂ &lt;span&gt;instanceof&lt;/span&gt;Â Log4jLogEvent)Â {&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â ç¡®ä¿Â ThrowableProxyÂ å·²å®Œæˆåˆå§‹åŒ–&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â event.getThrownProxy();Â &lt;span&gt;//Â ensureÂ ThrowableProxyÂ isÂ initialized&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â åˆ›å»ºÂ LogEventProxy&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â LogEventProxy((Log4jLogEvent)Â event,Â includeLocation);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â &lt;span&gt;//Â åˆ›å»ºÂ LogEventProxy&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â LogEventProxy(event,Â includeLocation);&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â ThrowableProxyÂ &lt;span&gt;getThrownProxy&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (thrownProxyÂ ==Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â thrownÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â thrownProxyÂ =Â &lt;span&gt;new&lt;/span&gt;Â ThrowableProxy(thrown);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â thrownProxy;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;LogEventProxy&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event,Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â includeLocation)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.loggerFQCNÂ =Â event.getLoggerFqcn();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.markerÂ =Â event.getMarker();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.levelÂ =Â event.getLevel();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.loggerNameÂ =Â event.getLoggerName();&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â MessageÂ msgÂ =Â event.getMessage();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.messageÂ =Â msgÂ &lt;span&gt;instanceof&lt;/span&gt;Â ReusableMessage&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â ?Â memento((ReusableMessage)Â msg)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â :Â msg;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.timeMillisÂ =Â event.getTimeMillis();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.thrownÂ =Â event.getThrown();&lt;br/&gt;Â Â Â &lt;span&gt;//Â åˆ›å»ºÂ ThrownProxyÂ å®ä¾‹&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.thrownProxyÂ =Â event.getThrownProxy();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.contextDataÂ =Â memento(event.getContextData());&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.contextStackÂ =Â event.getContextStack();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.sourceÂ =Â includeLocationÂ ?Â event.getSource()Â :Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.threadIdÂ =Â event.getThreadId();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.threadNameÂ =Â event.getThreadName();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.threadPriorityÂ =Â event.getThreadPriority();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.isLocationRequiredÂ =Â includeLocation;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.isEndOfBatchÂ =Â event.isEndOfBatch();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.nanoTimeÂ =Â event.getNanoTime();&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.impl.MutableLogEvent&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â ThrowableProxyÂ &lt;span&gt;getThrownProxy&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (thrownProxyÂ ==Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â thrownÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â æ„é€ Â ThrowableProxyÂ æ—¶æ‰“å°å¼‚å¸¸å †æ ˆ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â thrownProxyÂ =Â &lt;span&gt;new&lt;/span&gt;Â ThrowableProxy(thrown);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â thrownProxy;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.2.6 é—®é¢˜å°ç»“&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;Log4j2æ‰“å°å¼‚å¸¸æ—¥å¿—æ—¶ï¼ŒAsyncAppenderä¼šå…ˆåˆ›å»ºæ—¥å¿—äº‹ä»¶å¿«ç…§ï¼Œå¹¶è¿›ä¸€æ­¥è§¦å‘è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ã€‚JVMé€šè¿‡ç”Ÿæˆå­—èŠ‚ç çš„æ–¹å¼ä¼˜åŒ–åå°„è°ƒç”¨æ€§èƒ½ï¼Œä½†è¯¥åŠ¨æ€ç”Ÿæˆçš„ç±»æ— æ³•è¢«WebAppClassLoaderç±»åŠ è½½å™¨åŠ è½½ï¼Œå› æ­¤å½“å¤§é‡åŒ…å«åå°„è°ƒç”¨çš„å¼‚å¸¸å †æ ˆè¢«è¾“å‡ºåˆ°æ—¥å¿—æ—¶ï¼Œä¼šé¢‘ç¹åœ°è§¦å‘ç±»åŠ è½½ï¼Œç”±äºç±»åŠ è½½è¿‡ç¨‹æ˜¯synchronizedåŒæ­¥åŠ é”çš„ï¼Œä¸”æ¯æ¬¡åŠ è½½éƒ½éœ€è¦è¯»å–æ–‡ä»¶ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œä»è€Œå¯¼è‡´çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.3 Lambdaè¡¨è¾¾å¼å¯¼è‡´çº¿ç¨‹Block&lt;/span&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.3.1 é—®é¢˜ç°åœº&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;æ”¶åˆ°â€œjvm.thread.blocked.countâ€å‘Šè­¦åï¼Œç«‹åˆ»é€šè¿‡ç›‘æ§å¹³å°æŸ¥çœ‹çº¿ç¨‹ç›‘æ§æŒ‡æ ‡ï¼Œå½“æ—¶çš„çº¿ç¨‹å †æ ˆå¦‚ä¸‹å›¾16å’Œå›¾17æ‰€ç¤ºï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;286&quot; data-ratio=&quot;0.5083333333333333&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJrqL8ib4EeWcSvtlGkbnETtNKsHGSIJjax9ia4czzBDbHic2mWvfia6eC7Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1920&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;212&quot; data-ratio=&quot;0.3776041666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJvL0AZKq3RU8nGmwrjnqKWHqrhXNSzMS3wVImyTjdQmK17aMD1o8tZw/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾16 ç­‰å¾…é”çš„Blockedçº¿ç¨‹å †æ ˆ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;290&quot; data-ratio=&quot;0.515625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJviaMs45iaZ1ib3mCv4iczrSNUMiaLniaeLwZBD5dic6Nwx9K3KcW2IwEXVPDA/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾17 æŒæœ‰é”çš„Runnableçº¿ç¨‹å †æ ˆ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä»Blockedçº¿ç¨‹å †æ ˆä¸éš¾çœ‹å‡ºæ˜¯å’Œæ—¥å¿—æ‰“å°ç›¸å…³ï¼Œç”±äºæ˜¯ERRORçº§åˆ«æ—¥å¿—ï¼ŒæŸ¥çœ‹å…·ä½“æŠ¥é”™æ—¥å¿—ï¼Œå‘ç°å¦‚ä¸‹å›¾18æ‰€ç¤ºçš„ä¸šåŠ¡å¼‚å¸¸ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;376&quot; data-ratio=&quot;0.66875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJcQ8FpYiaDJPQIMibykV6YicAhctlhTacKicQJ3FrAwM9goicncPu6UBhwVA/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾18 ä¸šåŠ¡å¼‚å¸¸å †æ ˆ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æœ¬æ¡ˆä¾‹çš„Blockedçº¿ç¨‹å †æ ˆå’Œä¸Šè¿°â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ä¸€æ ·ï¼Œé‚£ä¹ˆå¯¼è‡´çº¿ç¨‹Blockçš„ç½ªé­ç¥¸é¦–ä¼šæ˜¯ä¸šåŠ¡å¼‚å¸¸å—ï¼Ÿæ¥ä¸‹æ¥æœ¬ç« èŠ‚å°†ç»“åˆä¸‹å›¾19æ‰€ç¤ºçš„è°ƒç”¨é“¾è·¯æ·±å…¥åˆ†æçº¿ç¨‹Blockçš„æ ¹å› ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;281&quot; data-ratio=&quot;0.5004803073967339&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJPQQUHFMFSZ5Vk1ia9uCMlWOnfsD18n3T6v9QuKfUPz65eqspNS00mNA/640?wx_fmt=png&quot; data-w=&quot;2082&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾19 æ—¥å¿—è°ƒç”¨é“¾è·¯&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.3.2 ä¸ºä»€ä¹ˆä¼šBlockçº¿ç¨‹ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;ä»Blockedçº¿ç¨‹å †æ ˆä¸­å¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹é˜»å¡åœ¨ç±»åŠ è½½ä¸Šï¼Œè¯¥çº¿ç¨‹å †æ ˆå’Œä¸Šè¿°â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ç›¸ä¼¼ï¼Œè¿™é‡Œä¸å†é‡å¤åˆ†æã€‚&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.3.3 ä¸ºä»€ä¹ˆä¼šè§¦å‘ç±»åŠ è½½ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;åŸå› å’Œä¸Šè¿°â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ç›¸ä¼¼ï¼Œè¿™é‡Œä¸å†é‡å¤åˆ†æã€‚&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.3.4 åˆ°åº•ä»€ä¹ˆç±»åŠ è½½ä¸äº†ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;ä¸Šè¿°â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ä¸­ï¼Œç±»åŠ è½½å™¨æ— æ³•åŠ è½½ç”±JVMé’ˆå¯¹åå°„è°ƒç”¨ä¼˜åŒ–æ‰€ç”Ÿæˆçš„å­—èŠ‚ç ç±»ï¼Œæœ¬æ¡ˆä¾‹æ˜¯å¦ä¹Ÿæ˜¯è¯¥åŸå› å¯¼è‡´ï¼Œè¿˜å¾…è¿›ä¸€æ­¥å…·ä½“åˆ†æã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;è¦æ‰¾åˆ°å…·ä½“æ˜¯ä»€ä¹ˆç±»æ— æ³•åŠ è½½ï¼Œå½’æ ¹ç»“åº•è¿˜æ˜¯è¦åˆ†æä¸šåŠ¡å¼‚å¸¸çš„å…·ä½“å †æ ˆã€‚ä»ä¸šåŠ¡å †æ ˆä¸­å¯ä»¥æ˜æ˜¾çœ‹å‡ºæ¥ï¼Œæ²¡æœ‰ä»»ä½•å †æ ˆå…ƒç´ å’ŒJVMåå°„è°ƒç”¨ç›¸å…³ï¼Œå› æ­¤æ’é™¤JVMåå°„è°ƒç”¨åŸå› ï¼Œä½†å¦‚ä¸‹çš„ç‰¹æ®Šå †æ ˆä¿¡æ¯å¼•èµ·äº†æ³¨æ„ï¼š&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;com.sankuai.shepherd.core.process.ProcessHandlerFactory$$Lambda$&lt;span&gt;35&lt;/span&gt;/&lt;span&gt;1331430278&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;ä»å †æ ˆçš„å…³é”®å­—$$Lambda$å¤§è‡´èƒ½çŒœæµ‹å‡ºè¿™æ˜¯ä»£ç é‡Œä½¿ç”¨äº†Lambdaè¡¨è¾¾å¼çš„ç¼˜æ•…ï¼ŒæŸ¥çœ‹ä»£ç ç¡®å®ç›¸å…³éƒ¨åˆ†ä½¿ç”¨äº†Lambdaè¡¨è¾¾å¼ï¼Œç»è¿‡æ–­ç‚¹è°ƒè¯•ï¼Œè¯å®çš„ç¡®æ— æ³•åŠ è½½è¯¥ç±»ã€‚é‚£ä¹ˆï¼Œè¿™æ ·çš„ç±»æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æŸ¥é˜…ç›¸å…³èµ„æ–™å¾—çŸ¥ï¼ŒLambdaè¡¨è¾¾å¼åŒºåˆ«äºåŒ¿åå†…éƒ¨ç±»å®ç°ï¼Œåœ¨æ„å»ºæ—¶ä¸ä¼šç”Ÿæˆclassæ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡invokeDynamicæŒ‡ä»¤åŠ¨æ€è°ƒç”¨ï¼ŒLambdaè¡¨è¾¾å¼çš„å†…å®¹ä¼šè¢«å°è£…åœ¨ä¸€ä¸ªé™æ€æ–¹æ³•å†…ï¼ŒJVMé€šè¿‡ASMå­—èŠ‚ç æŠ€æœ¯æ¥åŠ¨æ€ç”Ÿæˆè°ƒç”¨ç±»ï¼Œä¹Ÿå°±æ˜¯$$Lambda$è¿™ç§å½¢å¼çš„ç±»ï¼Œç”Ÿæˆç±»ç¤ºä¾‹å¦‚ä¸‹å›¾20æ‰€ç¤ºï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;307&quot; data-ratio=&quot;0.5453795379537953&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJwpO0vKka6SsYH6wFYT2noY43R4IcwIdccKxfDPp4WD2ONS0PqKkyWQ/640?wx_fmt=png&quot; data-w=&quot;1212&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾20 Lambdaç”Ÿæˆç±»ç¤ºä¾‹&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Lambdaè¡¨è¾¾å¼çš„å®ç°åŸç†ä¸æ˜¯æœ¬æ–‡é‡ç‚¹å†…å®¹ï¼Œåœ¨æ­¤ä¸åšè¿‡å¤šä»‹ç»ã€‚é¡¹ç›®ä»£ç ä¸­ä½¿ç”¨Lambdaè¡¨è¾¾å¼æ˜¯å†æ™®é€šä¸è¿‡çš„äº‹æƒ…ï¼Œä½†æ˜¯å…³äºæ­¤ç±»çš„æ¡ˆä¾‹å´å¹¶ä¸å¤šè§ï¼Œå®åœ¨ä»¤äººéš¾ä»¥ç½®ä¿¡ã€‚ç»§ç»­æŸ¥é˜…Lambdaè¡¨è¾¾å¼ç›¸å…³æ–‡æ¡£ï¼Œå‘ç°å¼‚å¸¸å †æ ˆç±»ååŒ…å«$$Lambda$è¿™æ ·çš„å…³é”®å­—ï¼Œå…¶å®æ˜¯JDKçš„ä¸€ä¸ªBugï¼Œç›¸å…³Issueå¯å‚è€ƒ:&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¯¥Bugåœ¨JDK9ç‰ˆæœ¬å·²ç»ä¿®å¤ï¼Œå®é™…æµ‹è¯•ä¸­å‘ç°ï¼Œåœ¨JDK8çš„é«˜ç‰ˆæœ¬å¦‚8U171ç­‰å·²ä¿®å¤è¯¥Bugï¼Œå¼‚å¸¸å †æ ˆä¸­ä¸ä¼šæœ‰ç±»ä¼¼$$Lambda$çš„å †æ ˆä¿¡æ¯ï¼Œç¤ºä¾‹å¦‚ä¸‹å›¾21æ‰€ç¤ºï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;185&quot; data-ratio=&quot;0.3296875&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJKYbFZrshb9EYophgL9R6USYXZ5NWibrF9sP43fePo2ygp3XBMBhqGQQ/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾21 JDK8U171ç‰ˆæœ¬ä¸‹Lambdaå¼‚å¸¸å †æ ˆç¤ºä¾‹&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.3.5 ä¸ºä»€ä¹ˆè¦è§£æå¼‚å¸¸å †æ ˆï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;åŸå› å’Œä¸Šè¿°â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ç›¸ä¼¼ï¼Œä¸å†é‡å¤åˆ†æã€‚&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.3.6 é—®é¢˜å°ç»“&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;Log4j2æ‰“å°å¼‚å¸¸æ—¥å¿—æ—¶ï¼ŒAsyncAppenderä¼šå…ˆåˆ›å»ºæ—¥å¿—äº‹ä»¶å¿«ç…§ï¼Œå¹¶è¿›ä¸€æ­¥è§¦å‘è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ã€‚JDK 8ä½ç‰ˆæœ¬ä¸­ä½¿ç”¨Lambdaè¡¨è¾¾å¼æ‰€ç”Ÿæˆçš„å¼‚å¸¸å †æ ˆç±»æ— æ³•è¢«WebAppClassLoaderç±»åŠ è½½å™¨åŠ è½½ï¼Œå› æ­¤ï¼Œå½“å¤§é‡åŒ…å«Lambdaè¡¨è¾¾å¼è°ƒç”¨çš„å¼‚å¸¸å †æ ˆè¢«è¾“å‡ºåˆ°æ—¥å¿—æ—¶ï¼Œä¼šé¢‘ç¹åœ°è§¦å‘ç±»åŠ è½½ï¼Œç”±äºç±»åŠ è½½è¿‡ç¨‹æ˜¯synchronizedåŒæ­¥åŠ é”çš„ï¼Œä¸”æ¯æ¬¡åŠ è½½éƒ½éœ€è¦è¯»å–æ–‡ä»¶ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œä»è€Œå¯¼è‡´äº†çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.4 AsyncLoggerConfigå¯¼è‡´çº¿ç¨‹Block&lt;/span&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.4.1 é—®é¢˜ç°åœº&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;æ”¶åˆ°â€œjvm.thread.blocked.countâ€å‘Šè­¦åç«‹åˆ»é€šè¿‡ç›‘æ§å¹³å°æŸ¥çœ‹çº¿ç¨‹ç›‘æ§æŒ‡æ ‡ï¼Œå½“æ—¶çš„çº¿ç¨‹å †æ ˆå¦‚ä¸‹å›¾22å’Œå›¾23æ‰€ç¤ºã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;282&quot; data-ratio=&quot;0.5010416666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJ6NyN5hwgsNeA4jkPjyVWjUVZBYyR7QunYZZTEicNg83XLknmWH3DAWA/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;145&quot; data-ratio=&quot;0.25833333333333336&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJsAHxH2EoGibTrGwgkicKwWmum2SkT3SLNryoJKE2ltfiaeXVgnAIX863A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾22 ç­‰å¾…é”çš„Blockedçº¿ç¨‹å †æ ˆ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;281&quot; data-ratio=&quot;0.49947916666666664&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJP86NkLceZ6CNBtG8BaO2gd0xibrBicynHNYA4JzPRyKkZcAuAaH9UylQ/640?wx_fmt=png&quot; data-w=&quot;1920&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾23 æŒæœ‰é”çš„Runnableçº¿ç¨‹å †æ ˆ&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä»Blockedçº¿ç¨‹å †æ ˆä¸éš¾çœ‹å‡ºæ˜¯å’Œæ—¥å¿—æ‰“å°ç›¸å…³ï¼Œæœ¬æ¡ˆä¾‹çš„ä¸šåŠ¡å¼‚å¸¸å’Œä¸Šè¿°â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€çš„ä¸šåŠ¡å¼‚å¸¸ä¸€æ ·ï¼Œè¿™é‡Œä¸å†é‡å¤ä»‹ç»ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;é‚£ä¹ˆï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çº¿ç¨‹Blockå‘¢ï¼Ÿæ¥ä¸‹æ¥æœ¬ç« èŠ‚å°†ç»“åˆä¸‹å›¾24æ‰€ç¤ºçš„è°ƒç”¨é“¾è·¯æ·±å…¥åˆ†æçº¿ç¨‹Blockçš„æ ¹å› ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;247&quot; data-ratio=&quot;0.43981831945495836&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJSEicHcN1AXcOFicpwwyY4uiawXicwGkIy8E6D2SSMHWrE6A4ZjGkftVichA/640?wx_fmt=png&quot; data-w=&quot;2642&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾24 æ—¥å¿—è°ƒç”¨é“¾è·¯&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.4.2 ä¸ºä»€ä¹ˆä¼šBlockçº¿ç¨‹ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;åŸå› å’Œä¸Šè¿°â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ç›¸ä¼¼ï¼Œè¿™é‡Œä¸å†é‡å¤åˆ†æã€‚&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.4.3 ä¸ºä»€ä¹ˆä¼šè§¦å‘ç±»åŠ è½½ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;åŸå› å’Œä¸Šè¿°â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ç›¸ä¼¼ï¼Œè¿™é‡Œä¸å†é‡å¤åˆ†æã€‚&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.4.4 åˆ°åº•æ˜¯ä»€ä¹ˆç±»åŠ è½½ä¸äº†ï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;åŸå› å’Œä¸Šè¿°â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ç›¸ä¼¼ï¼Œè¿™é‡Œä¸å†é‡å¤åˆ†æã€‚&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.4.5 ä¸ºä»€ä¹ˆè¦è§£æå¼‚å¸¸å †æ ˆï¼Ÿ&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;åœ¨å¼€å§‹åˆ†æåŸå› ä¹‹å‰ï¼Œå…ˆç†æ¸…æ¥šLog4j2å…³äºæ—¥å¿—çš„å‡ ä¸ªé‡è¦æ¦‚å¿µï¼š&lt;/span&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&amp;lt;Logger&amp;gt;ï¼Œæ—¥å¿—é…ç½®æ ‡ç­¾ï¼Œç”¨äºXMLæ—¥å¿—é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹åº”Log4j2æ¡†æ¶ä¸­çš„LoggerConfigç±»ï¼ŒåŒæ­¥åˆ†å‘æ—¥å¿—äº‹ä»¶åˆ°å¯¹åº”Appenderã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&amp;lt;AsyncLogger&amp;gt;ï¼Œæ—¥å¿—é…ç½®æ ‡ç­¾ï¼Œç”¨äºXMLæ—¥å¿—é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹åº”Log4j2æ¡†æ¶ä¸­çš„AsyncLoggerConfigç±»ï¼Œå†…éƒ¨ä½¿ç”¨Disruptoré˜Ÿåˆ—å¼‚æ­¥åˆ†å‘æ—¥å¿—äº‹ä»¶åˆ°å¯¹åº”Appenderã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Loggerï¼ŒåŒæ­¥æ—¥å¿—ç±»ï¼Œç”¨äºåˆ›å»ºåŒæ­¥æ—¥å¿—å®ä¾‹ï¼ŒåŒæ­¥è°ƒç”¨ReliabilityStrategyå¤„ç†æ—¥å¿—ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;AsyncLoggerï¼Œå¼‚æ­¥æ—¥å¿—ç±»ï¼Œç”¨äºåˆ›å»ºå¼‚æ­¥æ—¥å¿—å®ä¾‹ï¼Œå†…éƒ¨ä½¿ç”¨Disruptoré˜Ÿåˆ—å®ç°å¼‚æ­¥è°ƒç”¨ReliabilityStrategyå¤„ç†æ—¥å¿—ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;æ€»çš„æ¥è¯´ï¼Œ&amp;lt;Logger&amp;gt;æ ‡ç­¾å’ŒLoggerç±»æ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªæ¦‚å¿µï¼Œ&amp;lt;AsyncLogger&amp;gt;æ ‡ç­¾å’ŒAsyncLoggerç±»ä¹Ÿæ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸å¯æ··æ·†ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ç”±äºé¡¹ç›®å¹¶æœªé…ç½®Log4jContextSelectorå‚æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯åŒæ­¥Loggerï¼Œå³é€šè¿‡LoggerFactory.getLoggeræ–¹æ³•è·å–çš„æ˜¯Loggerç±»å®ä¾‹è€Œä¸æ˜¯AsyncLoggerç±»å®ä¾‹ï¼ŒåŒæ—¶ç”±äºé¡¹ç›®çš„log4j2.xmlé…ç½®æ–‡ä»¶é‡Œé…ç½®äº†&amp;lt;AsyncLogger&amp;gt;æ ‡ç­¾ï¼Œæ‰€ä»¥å…¶åº•å±‚æ˜¯Loggerå’ŒAsyncLoggerConfigç»„åˆã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;AsyncLoggerConfigå¤„ç†æ—¥å¿—äº‹ä»¶ç®€è¦æµç¨‹å¦‚ä¸‹å›¾25æ‰€ç¤ºï¼Œå†…éƒ¨ä½¿ç”¨Disruptoré˜Ÿåˆ—ï¼Œåœ¨ç”Ÿæˆé˜Ÿåˆ—å…ƒç´ æ—¶ï¼Œç”±translatoræ¥è´Ÿè´£å¡«å……å…ƒç´ å­—æ®µï¼Œå¹¶æŠŠå¡«å……åçš„å…ƒç´ æ”¾å…¥RingBufferä¸­ï¼Œäºæ­¤åŒæ—¶ï¼Œç‹¬ç«‹çš„å¼‚æ­¥çº¿ç¨‹ä»RingBufferä¸­æ¶ˆè´¹äº‹ä»¶ï¼Œå¹¶è°ƒç”¨é…ç½®åœ¨è¯¥AsyncLoggerConfigä¸Šçš„Appenderå¤„ç†æ—¥å¿—è¯·æ±‚ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;116&quot; data-ratio=&quot;0.2070030895983522&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJyOZ20ibSgg3JgxhsA37ZiaMSPSd1gMYDUpUzibQy2BOtheme8X4BYgZ8g/640?wx_fmt=png&quot; data-w=&quot;1942&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾25 AsyncLoggerConfigå¤„ç†æµç¨‹&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;AsyncLoggerConfigæä¾›äº†å¸¦æœ‰Disruptoré˜Ÿåˆ—å®ç°çš„ä»£ç†ç±»å³AsyncLoggerConfigDisruptorï¼Œåœ¨æ—¥å¿—äº‹ä»¶è¿›å…¥RingBufferæ—¶ï¼Œç”±äºé¡¹ç›®ä½¿ç”¨çš„æ˜¯ReusableLogEventFactoryï¼Œæ‰€ä»¥ç”±MUTABLE_TRANSLATORè´Ÿè´£åˆå§‹åŒ–æ—¥å¿—äº‹ä»¶ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨getThrownProxyæ–¹æ³•åˆ›å»ºThrowableProxyå®ä¾‹ï¼Œè¿›è€Œåœ¨ThrowableProxyæ„é€ å‡½æ•°å†…éƒ¨è§¦å‘è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.async.AsyncLoggerConfigDisruptor$EventTranslatorTwoArg&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;/**&lt;br/&gt;Â *Â ObjectÂ responsibleÂ forÂ passingÂ onÂ dataÂ toÂ aÂ RingBufferÂ eventÂ withÂ aÂ MutableLogEvent.&lt;br/&gt;Â */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â EventTranslatorTwoArg&amp;lt;Log4jEventWrapper,Â LogEvent,Â AsyncLoggerConfig&amp;gt;Â MUTABLE_TRANSLATORÂ =&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;new&lt;/span&gt;Â EventTranslatorTwoArg&amp;lt;Log4jEventWrapper,Â LogEvent,Â AsyncLoggerConfig&amp;gt;()Â {&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;translateTo&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â Log4jEventWrapperÂ ringBufferElement,Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â sequence,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â LogEventÂ logEvent,Â &lt;span&gt;final&lt;/span&gt;Â AsyncLoggerConfigÂ loggerConfig)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â åˆå§‹åŒ–Â DisruptorÂ RingBufferÂ æ—¥å¿—å…ƒç´ å­—æ®µ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â ((MutableLogEvent)Â ringBufferElement.event).initFrom(logEvent);&lt;br/&gt;Â Â Â Â Â Â Â Â ringBufferElement.loggerConfigÂ =Â loggerConfig;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;};&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.impl.MutableLogEvent&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;initFrom&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.loggerFqcnÂ =Â event.getLoggerFqcn();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.markerÂ =Â event.getMarker();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.levelÂ =Â event.getLevel();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.loggerNameÂ =Â event.getLoggerName();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.timeMillisÂ =Â event.getTimeMillis();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.thrownÂ =Â event.getThrown();&lt;br/&gt;Â Â Â &lt;span&gt;//Â è§¦å‘åˆ›å»ºÂ ThrowableProxyÂ å®ä¾‹&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.thrownProxyÂ =Â event.getThrownProxy();&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â &lt;span&gt;NOTE:&lt;/span&gt;Â thisÂ ringbufferÂ eventÂ SHOULDÂ NOTÂ keepÂ aÂ referenceÂ toÂ theÂ specified&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â thread-localÂ MutableLogEvent&#x27;sÂ contextÂ data,Â becauseÂ thenÂ twoÂ threadsÂ wouldÂ call&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â ReadOnlyStringMap.clear()Â onÂ theÂ sameÂ sharedÂ instance,Â resultingÂ inÂ dataÂ corruption.&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.contextData.putAll(event.getContextData());&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.contextStackÂ =Â event.getContextStack();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.sourceÂ =Â event.isIncludeLocation()Â ?Â event.getSource()Â :Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.threadIdÂ =Â event.getThreadId();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.threadNameÂ =Â event.getThreadName();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.threadPriorityÂ =Â event.getThreadPriority();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.endOfBatchÂ =Â event.isEndOfBatch();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.includeLocationÂ =Â event.isIncludeLocation();&lt;br/&gt;Â Â Â Â &lt;span&gt;this&lt;/span&gt;.nanoTimeÂ =Â event.getNanoTime();&lt;br/&gt;Â Â Â Â setMessage(event.getMessage());&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â ThrowableProxyÂ &lt;span&gt;getThrownProxy&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (thrownProxyÂ ==Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â thrownÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â æ„é€ Â ThrowableProxyÂ æ—¶æ‰“å°å¼‚å¸¸å †æ ˆ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â thrownProxyÂ =Â &lt;span&gt;new&lt;/span&gt;Â ThrowableProxy(thrown);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â thrownProxy;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;3.4.6 é—®é¢˜å°ç»“&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;Log4j2æ‰“å°å¼‚å¸¸æ—¥å¿—æ—¶ï¼ŒAsyncLoggerConfigä¼šåˆå§‹åŒ–Disruptor RingBufferæ—¥å¿—å…ƒç´ å­—æ®µï¼Œå¹¶è¿›ä¸€æ­¥è§¦å‘è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ã€‚JVMé€šè¿‡ç”Ÿæˆå­—èŠ‚ç çš„æ–¹å¼ä¼˜åŒ–åå°„è°ƒç”¨æ€§èƒ½ï¼Œä½†è¯¥åŠ¨æ€ç”Ÿæˆçš„ç±»æ— æ³•è¢«WebAppClassLoaderç±»åŠ è½½å™¨åŠ è½½ï¼Œå› æ­¤å½“å¤§é‡åŒ…å«åå°„è°ƒç”¨çš„å¼‚å¸¸å †æ ˆè¢«è¾“å‡ºåˆ°æ—¥å¿—æ—¶ï¼Œä¼šé¢‘ç¹åœ°è§¦å‘ç±»åŠ è½½ï¼Œç”±äºç±»åŠ è½½è¿‡ç¨‹æ˜¯synchronizedåŒæ­¥åŠ é”çš„ï¼Œä¸”æ¯æ¬¡åŠ è½½éƒ½éœ€è¦è¯»å–æ–‡ä»¶ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œä»è€Œå¯¼è‡´çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;4. é¿å‘æŒ‡å—&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;æœ¬ç« èŠ‚ä¸»è¦å¯¹ä¸Šè¿°æ¡ˆä¾‹ä¸­å¯¼è‡´çº¿ç¨‹Blockçš„åŸå› è¿›è¡Œæ±‡æ€»åˆ†æï¼Œå¹¶ç»™å‡ºç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;4.1 é—®é¢˜æ€»ç»“&lt;/span&gt;&lt;/h3&gt;&lt;section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-cropselx1=&quot;0&quot; data-cropselx2=&quot;562&quot; data-cropsely1=&quot;0&quot; data-cropsely2=&quot;121&quot; data-ratio=&quot;0.21521997621878716&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsXQu61RnticpkHboWVKAGbMJvkDdxRibHNJTicv3PObBZlibRAL9PkzRfiaPMl6xdEDZZnHGf9LA0Ldsqw/640?wx_fmt=png&quot; data-w=&quot;1682&quot;/&gt;&lt;figcaption&gt;&lt;span&gt;å›¾26 æ—¥å¿—å¼‚æ­¥å¤„ç†æµç¨‹&lt;/span&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—å¼‚æ­¥å¤„ç†æµç¨‹ç¤ºæ„å¦‚å›¾26æ‰€ç¤ºï¼Œæ•´ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ä¸šåŠ¡çº¿ç¨‹ç»„è£…æ—¥å¿—äº‹ä»¶å¯¹è±¡ï¼Œå¦‚åˆ›å»ºæ—¥å¿—å¿«ç…§æˆ–è€…åˆå§‹åŒ–æ—¥å¿—å­—æ®µç­‰ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æ—¥å¿—äº‹ä»¶å¯¹è±¡å…¥é˜Ÿï¼Œå¦‚BlockingQueueé˜Ÿåˆ—æˆ–Disruptor RingBufferé˜Ÿåˆ—ç­‰ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—å¼‚æ­¥çº¿ç¨‹ä»é˜Ÿåˆ—è·å–æ—¥å¿—äº‹ä»¶å¯¹è±¡ï¼Œå¹¶è¾“å‡ºè‡³ç›®çš„åœ°ï¼Œå¦‚æœ¬åœ°ç£ç›˜æ–‡ä»¶æˆ–è¿œç¨‹æ—¥å¿—ä¸­å¿ƒç­‰ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;å¯¹åº”åœ°ï¼ŒLog4j2å¯¼è‡´çº¿ç¨‹Blockçš„ä¸»è¦æ½œåœ¨é£é™©ç‚¹å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å¦‚ä¸Šå›¾æ ‡å·â‘ æ‰€ç¤ºï¼Œæ—¥å¿—äº‹ä»¶å¯¹è±¡åœ¨å…¥é˜Ÿå‰ï¼Œç»„è£…æ—¥å¿—äº‹ä»¶æ—¶è§¦å‘äº†å¼‚å¸¸å †æ ˆç±»è§£æã€åŠ è½½ï¼Œä»è€Œå¼•å‘çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å¦‚ä¸Šå›¾æ ‡å·â‘¡æ‰€ç¤ºï¼Œæ—¥å¿—äº‹ä»¶å¯¹è±¡åœ¨å…¥é˜Ÿæ—¶ï¼Œç”±äºé˜Ÿåˆ—æ»¡ï¼Œæ— æ³•å…¥é˜Ÿï¼Œä»è€Œå¼•å‘çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å¦‚ä¸Šå›¾æ ‡å·â‘¢æ‰€ç¤ºï¼Œæ—¥å¿—äº‹ä»¶å¯¹è±¡åœ¨å‡ºé˜Ÿåï¼Œå¯¹æ—¥å¿—å†…å®¹è¿›è¡Œæ ¼å¼åŒ–å¤„ç†æ—¶è§¦å‘äº†å¼‚å¸¸å †æ ˆç±»è§£æã€åŠ è½½ï¼Œä»è€Œå¼•å‘çº¿ç¨‹ Blockã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;ä»ä¸Šè¿°åˆ†æä¸éš¾çœ‹å‡ºï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;æ ‡å·â‘ å’Œâ‘¡å¤„å¦‚æœå‘ç”Ÿçº¿ç¨‹Blockï¼Œé‚£ä¹ˆä¼šç›´æ¥å½±å“ä¸šåŠ¡çº¿ç¨‹æ± å†…çš„æ‰€æœ‰çº¿ç¨‹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;æ ‡å·â‘¢å‡ºå¦‚æœå‘ç”Ÿçº¿ç¨‹Blockï¼Œé‚£ä¹ˆä¼šå½±å“æ—¥å¿—å¼‚æ­¥çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹é€šå¸¸ä¸ºå•çº¿ç¨‹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;æ ‡å·â‘ å’Œâ‘¡å¤„å‘ç”Ÿçº¿ç¨‹Blockçš„å½±å“èŒƒå›´è¿œæ¯”æ ‡å·â‘¢æ›´å¤§ï¼Œå› æ­¤æ ¸å¿ƒæ˜¯è¦é¿å…æ—¥å¿—äº‹ä»¶åœ¨å…¥é˜Ÿæ“ä½œå®Œæˆå‰è§¦å‘çº¿ç¨‹Block&lt;/strong&gt;ã€‚å…¶å®æ—¥å¿—å¼‚æ­¥çº¿ç¨‹é€šå¸¸æ˜¯å•çº¿ç¨‹ï¼Œå› æ­¤å¯¹äºå•ä¸ªAppenderæ¥è¯´ï¼Œä¸ä¼šå‡ºç°Blockç°è±¡ï¼Œè‡³å¤šä¼šå¯¼è‡´å¼‚æ­¥çº¿ç¨‹å¤„ç†é€Ÿåº¦å˜æ…¢è€Œå·²ï¼Œä½†å¦‚æœå­˜åœ¨å¤šä¸ªå¼‚æ­¥Appenderï¼Œé‚£ä¹ˆå¤šä¸ªæ—¥å¿—å¼‚æ­¥çº¿ç¨‹ä»ç„¶ä¼šå‡ºç°å½¼æ­¤Blockçš„ç°è±¡ã€‚&lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;4.2 å¯¹ç—‡ä¸‹è¯&lt;/span&gt;&lt;/h3&gt;&lt;section&gt;&lt;span&gt;ææ¸…æ¥šäº†æ—¥å¿—å¯¼è‡´çº¿ç¨‹Blockçš„åŸå› åï¼Œé—®é¢˜ä¹Ÿå°±ä¸éš¾è§£å†³ï¼Œè§£å†³æ–¹æ¡ˆä¸»è¦ä»æ—¥å¿—äº‹ä»¶â€œå…¥é˜Ÿå‰â€ã€â€œå…¥é˜Ÿæ—¶â€å’Œâ€œå‡ºé˜Ÿåâ€ä¸‰æ–¹é¢å±•å¼€ã€‚&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;4.2.1 å…¥é˜Ÿå‰é¿å…çº¿ç¨‹Block&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;ç»“åˆä¸Šæ–‡åˆ†æçš„â€œAsyncAppenderå¯¼è‡´çº¿ç¨‹Blockâ€ã€â€œLambdaè¡¨è¾¾å¼å¯¼è‡´çº¿ç¨‹Blockâ€å’Œâ€œAsyncLoggerConfigå¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ï¼Œæ—¥å¿—äº‹ä»¶å…¥é˜Ÿå‰é¿å…çº¿ç¨‹Blockçš„è§£å†³æ–¹æ¡ˆå¯ä»å¦‚ä¸‹å‡ æ–¹é¢è€ƒè™‘ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æ—¥å¿—äº‹ä»¶å…¥é˜Ÿå‰é¿å…è§¦å‘å¼‚å¸¸å †æ ˆç±»è§£æã€åŠ è½½æ“ä½œã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ç¦ç”¨JVMåå°„è°ƒç”¨ä¼˜åŒ–ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å‡çº§JDKç‰ˆæœ¬ä¿®å¤Lambdaç±»Bugã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;å…ˆè¯´æ–¹æ¡ˆç»“è®ºï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;è‡ªå®šä¹‰Appenderå®ç°ï¼Œåˆ›å»ºæ—¥å¿—äº‹ä»¶å¿«ç…§æ—¶é¿å…è§¦å‘å¼‚å¸¸å †æ ˆç±»è§£æã€åŠ è½½ï¼Œç¾å›¢å†…éƒ¨Scribe-Logæä¾›çš„AsyncScribeAppenderå³æ˜¯å¦‚æ­¤ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­ä¸ä½¿ç”¨&amp;lt;AsyncLogger&amp;gt;æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨&amp;lt;Logger&amp;gt;æ ‡ç­¾æ¥ä»£æ›¿ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;ä¸‹é¢å…·ä½“åˆ†ææ–¹æ¡ˆå¯è¡Œæ€§ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;1.&lt;/strong&gt; &lt;strong&gt;æ—¥å¿—äº‹ä»¶å…¥é˜Ÿå‰é¿å…è§¦å‘å¼‚å¸¸å †æ ˆç±»è§£æã€åŠ è½½æ“ä½œ&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å¦‚æœåœ¨æ—¥å¿—äº‹ä»¶å…¥é˜Ÿå‰ï¼Œèƒ½é¿å…å¼‚å¸¸å †æ ˆç±»è§£æã€åŠ è½½æ“ä½œï¼Œåˆ™å¯ä»æ ¹æœ¬ä¸Šè§£å†³è¯¥é—®é¢˜ï¼Œä½†åœ¨Log4j2çš„2.17.1ç‰ˆæœ¬ä¸­AsyncAppenderå’ŒAsyncLoggerConfigä»å­˜åœ¨è¯¥é—®é¢˜ï¼Œæ­¤æ—¶ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å¯¹äºAsyncAppenderåœºæ™¯æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰Appenderå®ç°ï¼Œåœ¨ç”Ÿæˆæ—¥å¿—äº‹ä»¶å¿«ç…§æ—¶é¿å…è§¦å‘è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„Appenderä»£æ›¿Log4j2æä¾›çš„AsyncAppenderã€‚è‡ªå®šä¹‰AsyncScribeAppenderç›¸å…³ä»£ç ç‰‡æ®µå¦‚ä¸‹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.scribe.appender.AsyncScribeAppender&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;append&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ logEvent)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â ...Â ä»¥ä¸Šéƒ¨åˆ†å¿½ç•¥Â ...&lt;/span&gt;&lt;br/&gt;Â Â Â Â Log4jLogEvent.BuilderÂ builderÂ =Â &lt;span&gt;new&lt;/span&gt;Â Log4jLogEvent.Builder(event);&lt;br/&gt;Â Â Â Â builder.setIncludeLocation(includeLocation);&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â åˆ›å»ºæ—¥å¿—å¿«ç…§ï¼Œé¿å…è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â Log4jLogEventÂ mementoÂ =Â builder.build();&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â ...Â ä»¥ä¸‹éƒ¨åˆ†å¿½ç•¥Â ...&lt;/span&gt;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å¯¹äºAsyncLoggerConfigåœºæ™¯æ¥è¯´ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨éReusableLogEventFactoryç±»å‹çš„LogEventFactoryæ¥è§„é¿è¯¥é—®é¢˜ï¼Œé™¤æ­¤ä¹‹å¤–ä¹Ÿå¯ä»¥è€ƒè™‘æ¢ç”¨LoggerConfigæ¥é¿å…è¯¥é—®é¢˜ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;2.&lt;/strong&gt; &lt;strong&gt;ç¦ç”¨JVMåå°„è°ƒç”¨ä¼˜åŒ–&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;è°ƒå¤§inflationThresholdï¼ˆ&lt;/span&gt;&lt;span&gt;å…¶ç±»å‹ä¸º int&lt;/span&gt;&lt;span&gt;ï¼‰å€¼åˆ°intæœ€å¤§å€¼ï¼Œå¦‚æ­¤ï¼Œè™½ç„¶ä¸€å®šèŒƒå›´å†…ï¼ˆ&lt;/span&gt;&lt;span&gt;åå°„è°ƒç”¨æ¬¡æ•°ä¸è¶…è¿‡intæœ€å¤§å€¼æ—¶&lt;/span&gt;&lt;span&gt;ï¼‰é¿å…äº†ç±»åŠ è½½Blocké—®é¢˜ï¼Œä½†æŸå¤±äº†åå°„è°ƒç”¨æ€§èƒ½ï¼Œé¡¾æ­¤å¤±å½¼ï¼Œä¸”æ— æ³•æ ¹æ²»ã€‚å¦å¤–ï¼Œå¯¹äºéåå°„ç±»é—®é¢˜ä»ç„¶æ— æ³•è§£å†³ï¼Œå¦‚ä¸Šæ–‡æ‰€è¿°çš„Lambdaè¡¨è¾¾å¼é—®é¢˜ç­‰ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;3.&lt;/strong&gt; &lt;strong&gt;å‡çº§JDKç‰ˆæœ¬ä¿®å¤Lambdaç±»Bug&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å‡çº§JDKç‰ˆæœ¬çš„ç¡®å¯ä»¥è§£å†³Lambdaè¡¨è¾¾å¼é—®é¢˜ï¼Œä½†å¹¶ä¸èƒ½å½»åº•è§£å†³çº¿ç¨‹Blocké—®é¢˜ï¼Œå¦‚ä¸Šæ–‡æ‰€è¿°çš„åå°„è°ƒç”¨ç­‰ã€‚&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;4.2.2 å…¥é˜Ÿæ—¶é¿å…çº¿ç¨‹Block&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;ç»“åˆä¸Šæ–‡åˆ†æçš„â€œæ—¥å¿—é˜Ÿåˆ—æ»¡å¯¼è‡´çº¿ç¨‹Blockâ€æ¡ˆä¾‹ï¼Œæ—¥å¿—äº‹ä»¶å…¥é˜Ÿæ—¶é¿å…çº¿ç¨‹Blockçš„è§£å†³æ–¹æ¡ˆå¯ä»å¦‚ä¸‹å‡ æ–¹é¢è€ƒè™‘ï¼š&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æ—¥å¿—é˜Ÿåˆ—æ»¡æ—¶ï¼ŒAppenderå¿½ç•¥è¯¥æ—¥å¿—ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;Appenderä½¿ç”¨è‡ªå®šä¹‰çš„ErrorHandlerå®ç°å¤„ç†æ—¥å¿—ã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å…³é—­StatusConfigListeneræ—¥å¿—è¾“å‡ºã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;å…ˆè¯´æ–¹æ¡ˆç»“è®ºï¼š&lt;strong&gt;è‡ªå®šä¹‰Appenderå®ç°ï¼Œæ—¥å¿—äº‹ä»¶å…¥é˜Ÿå¤±è´¥æ—¶å¿½ç•¥é”™è¯¯æ—¥å¿—ï¼Œç¾å›¢å†…éƒ¨Scribe-Logæä¾›çš„AsyncScribeAppenderå³æ˜¯å¦‚æ­¤&lt;/strong&gt;ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¸‹é¢å…·ä½“åˆ†ææ–¹æ¡ˆå¯è¡Œæ€§ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;1.&lt;/strong&gt; &lt;strong&gt;æ—¥å¿—é˜Ÿåˆ—æ»¡æ—¶Appenderå¿½ç•¥è¯¥æ—¥å¿—&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—é˜Ÿåˆ—æ»¡ï¼ŒæŸç§ç¨‹åº¦ä¸Šè¯´æ˜æ—¥å¿—çº¿ç¨‹çš„å¤„ç†èƒ½åŠ›ä¸è¶³ï¼Œåœ¨ç°æœ‰æœºå™¨èµ„æºä¸å˜çš„æƒ…å†µä¸‹éœ€è¦åšä¸€å®šå–èˆï¼Œå¦‚æœæ—¥å¿—ä¸æ˜¯ç‰¹åˆ«é‡è¦é€šå¸¸å¯ä¸¢å¼ƒè¯¥æ—¥å¿—ï¼Œæ­¤æ—¶ï¼š&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.scribe.appender.AsyncScribeAppender&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;append&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ logEvent)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;//Â ...Â ä»¥ä¸Šéƒ¨åˆ†å¿½ç•¥Â ...&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!transfer(memento))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (blocking)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â delegateÂ toÂ theÂ eventÂ routerÂ (whichÂ mayÂ discard,Â enqueueÂ andÂ block,Â orÂ logÂ inÂ currentÂ thread)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â EventRouteAsyncScribeÂ routeÂ =Â asyncScribeQueueFullPolicy.getRoute(processingThread.getId(),Â memento.getLevel());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â route.logMessage(&lt;span&gt;this&lt;/span&gt;,Â memento);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â è‡ªå®šä¹‰printDebugInfoå‚æ•°ï¼Œæ§åˆ¶æ˜¯å¦è¾“å‡ºerrorä¿¡æ¯ï¼Œé»˜è®¤ä¸ºfalse&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (printDebugInfo)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â error(&lt;span&gt;&quot;AppenderÂ &quot;&lt;/span&gt;Â +Â getName()Â +Â &lt;span&gt;&quot;Â isÂ unableÂ toÂ writeÂ primaryÂ appenders.Â queueÂ isÂ full&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â logToErrorAppenderIfNecessary(&lt;span&gt;false&lt;/span&gt;,Â memento);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â &lt;span&gt;//Â ...Â ä»¥ä¸‹éƒ¨åˆ†å¿½ç•¥Â ...&lt;/span&gt;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;2.&lt;/strong&gt; &lt;strong&gt;Appenderä½¿ç”¨è‡ªå®šä¹‰çš„ErrorHandlerå®ç°å¤„ç†æ—¥å¿—&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;è‡ªå®šä¹‰ErrorHandlerï¼ŒAppenderå†…è®¾ç½®handlerä¸ºè‡ªå®šä¹‰ErrorHandlerå®ä¾‹å³å¯ï¼Œä½†è¯¥æ–¹å¼ä»…é€‚ç”¨äºé€šè¿‡Log4j2 APIæ–¹å¼åˆ›å»ºçš„Loggerï¼Œä¸æ”¯æŒæ—¥å¿—é…ç½®æ–‡ä»¶çš„ä½¿ç”¨æ–¹å¼ã€‚ç”±äºå¤§å¤šæ•°ç”¨æˆ·éƒ½ä½¿ç”¨é…ç½®æ–‡ä»¶æ–¹å¼ï¼Œæ‰€ä»¥è¯¥æ–¹æ¡ˆä½¿ç”¨åœºæ™¯æœ‰é™ï¼Œä¸è¿‡å¯ä»¥æœŸå¾…åç»­æ—¥å¿—æ¡†æ¶æ”¯æŒé…ç½®æ–‡ä»¶è‡ªå®šä¹‰ErrorHandlerï¼Œå·²æœ‰ç›¸å…³&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2927&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;Issue: ErrorHandlers on Appenders cannot be configured&lt;/span&gt;&lt;/a&gt;&lt;span&gt;åé¦ˆç»™ç¤¾åŒºã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;3.&lt;/strong&gt; &lt;strong&gt;å…³é—­StatusConfigListeneræ—¥å¿—è¾“å‡º&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;4.2.3 å‡ºé˜Ÿåé¿å…çº¿ç¨‹Block&lt;/span&gt;&lt;/h4&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—äº‹ä»¶å‡ºé˜Ÿåä¼šæŒ‰ç…§ç”¨æˆ·é…ç½®çš„è¾“å‡ºæ ·å¼ï¼Œå¯¹æ—¥å¿—å†…å®¹è¿›è¡Œæ ¼å¼åŒ–è½¬æ¢ï¼Œæ­¤æ—¶ä»ç„¶å¯èƒ½è§¦å‘è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ã€‚å› æ­¤ï¼Œæ—¥å¿—å‡ºé˜Ÿåé¿å…çº¿ç¨‹Blockçš„æ ¹æœ¬è§£å†³æ–¹æ³•æ˜¯åœ¨å¼‚å¸¸æ ¼å¼åŒ–è½¬æ¢æ—¶é¿å…è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å…ˆè¯´æ–¹æ¡ˆç»“è®ºï¼š&lt;strong&gt;æ˜¾å¼é…ç½®æ—¥å¿—è¾“å‡ºæ ·å¼%exæ¥ä»£æ›¿é»˜è®¤çš„%xExï¼Œé¿å…å¯¹æ—¥å¿—å†…å®¹æ ¼å¼åŒ–æ—¶è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»&lt;/strong&gt;ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¸‹é¢é€šè¿‡åˆ†ææ—¥å¿—å†…å®¹æ ¼å¼åŒ–å¤„ç†æµç¨‹æ¥ä»‹ç»è§£å†³æ–¹æ¡ˆã€‚ä»¥PatternLayoutä¸ºä¾‹ï¼Œæ—¥å¿—å†…å®¹æ ¼å¼åŒ–è½¬æ¢æµç¨‹é“¾è·¯ä¸ºï¼šLayout-&amp;gt;PatternFormatter-&amp;gt;LogEventPatternConverterã€‚å…¶ä¸­LogEventPatternConverteræ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œæœ‰ä¸¤ä¸ªå¤„ç†å¼‚å¸¸çš„æ ¼å¼åŒ–è½¬æ¢å…·ä½“å®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯ThrowablePatternConverterå’ŒExtendedThrowablePatternConverterã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.layout.PatternLayout&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â å°†Â LogEventÂ è½¬æ¢ä¸ºå¯ä»¥è¾“å‡ºçš„Â String&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â StringÂ &lt;span&gt;toSerializable&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â &lt;span&gt;//Â ç”±Â PatternSerializerÂ å¯¹æ—¥å¿—äº‹ä»¶æ ¼å¼åŒ–å¤„ç†&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â eventSerializer.toSerializable(event);&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.layout.PatternLayout.PatternSerializer&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â StringÂ &lt;span&gt;toSerializable&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ sbÂ =Â getStringBuilder();&lt;br/&gt;Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â toSerializable(event,Â sb).toString();&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;finally&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â trimToMaxSize(sb);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â StringBuilderÂ &lt;span&gt;toSerializable&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event,Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ buffer)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â lenÂ =Â formatters.length;&lt;br/&gt;Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (&lt;span&gt;int&lt;/span&gt;Â iÂ =Â &lt;span&gt;0&lt;/span&gt;;Â iÂ &amp;lt;Â len;Â i++)Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;//Â ç”±Â PatternFormatterÂ å¯¹æ—¥å¿—äº‹ä»¶æ ¼å¼åŒ–å¤„ç†&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â formatters[i].format(event,Â buffer);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (replaceÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {Â &lt;span&gt;//Â createsÂ temporaryÂ objects&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â StringÂ strÂ =Â buffer.toString();&lt;br/&gt;Â Â Â Â Â Â Â Â strÂ =Â replace.format(str);&lt;br/&gt;Â Â Â Â Â Â Â Â buffer.setLength(&lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â buffer.append(str);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â buffer;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.pattern.PatternFormatter&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;format&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event,Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ buf)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (skipFormattingInfo)Â {&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â ç”±Â LogEventPatternConverterÂ å¯¹æ—¥å¿—äº‹ä»¶è¿›è¡Œæ ¼å¼åŒ–å¤„ç†&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â converter.format(event,Â buf);&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â formatWithInfo(event,Â buf);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;formatWithInfo&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event,Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ buf)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â startFieldÂ =Â buf.length();&lt;br/&gt;Â Â Â &lt;span&gt;//Â ç”±Â LogEventPatternConverterÂ å¯¹æ—¥å¿—äº‹ä»¶è¿›è¡Œæ ¼å¼åŒ–å¤„ç†&lt;/span&gt;&lt;br/&gt;Â Â Â Â converter.format(event,Â buf);&lt;br/&gt;Â Â Â Â field.format(startField,Â buf);&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.pattern.LogEventPatternConverter&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;abstract&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;LogEventPatternConverter&lt;/span&gt;Â &lt;span&gt;extends&lt;/span&gt;Â &lt;span&gt;AbstractPatternConverter&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;/**&lt;br/&gt;Â Â Â Â Â *Â å°†æ—¥å¿—äº‹ä»¶Â LogEventÂ è½¬æ¢ä¸ºÂ String&lt;br/&gt;Â Â Â Â Â *Â FormatsÂ anÂ eventÂ intoÂ aÂ stringÂ buffer.&lt;br/&gt;Â Â Â Â Â *&lt;br/&gt;Â Â Â Â Â *Â &lt;span&gt;@param&lt;/span&gt;Â eventÂ Â Â Â Â Â eventÂ toÂ format,Â mayÂ notÂ beÂ null.&lt;br/&gt;Â Â Â Â Â *Â &lt;span&gt;@param&lt;/span&gt;Â toAppendToÂ stringÂ bufferÂ toÂ whichÂ theÂ formattedÂ eventÂ willÂ beÂ appended.Â Â MayÂ notÂ beÂ null.&lt;br/&gt;Â Â Â Â Â */&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;abstract&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;format&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event,Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ toAppendTo)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;æ—¥å¿—æ¡†æ¶å¯¹å¼‚å¸¸è¿›è¡Œæ ¼å¼åŒ–è½¬æ¢æ—¶ï¼Œæœ‰å¦‚ä¸‹ä¸¤ä¸ªé…ç½®é¡¹å¯å‚è€ƒï¼Œé»˜è®¤é…ç½®æ˜¯%xExã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;1.&lt;/strong&gt; &lt;strong&gt;%exï¼Œä»…è¾“å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œä¸è·å–æ‰©å±•ä¿¡æ¯ï¼ˆJARæ–‡ä»¶åç§°å’Œç‰ˆæœ¬ä¿¡æ¯ï¼‰&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å¯¹åº”çš„æ ¼å¼è½¬åŒ–ç±»æ˜¯ThrowablePatternConverterï¼Œåœ¨formatæ–¹æ³•å†…éƒ¨å¹¶æ²¡æœ‰è·å–ThrowableProxyå¯¹è±¡ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.pattern.ThrowablePatternConverter&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Plugin&lt;/span&gt;(nameÂ =Â &lt;span&gt;&quot;ThrowablePatternConverter&quot;&lt;/span&gt;,Â categoryÂ =Â PatternConverter.CATEGORY)&lt;br/&gt;&lt;span&gt;@ConverterKeys&lt;/span&gt;({Â &lt;span&gt;&quot;ex&quot;&lt;/span&gt;,Â &lt;span&gt;&quot;throwable&quot;&lt;/span&gt;,Â &lt;span&gt;&quot;exception&quot;&lt;/span&gt;Â })&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;ThrowablePatternConverter&lt;/span&gt;Â &lt;span&gt;extends&lt;/span&gt;Â &lt;span&gt;LogEventPatternConverter&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;/**&lt;br/&gt;Â Â Â Â Â *Â {&lt;span&gt;@inheritDoc&lt;/span&gt;}&lt;br/&gt;Â Â Â Â Â */&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;format&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event,Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ buffer)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â ThrowableÂ tÂ =Â event.getThrown();&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (isSubShortOption())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â formatSubShortOption(t,Â getSuffix(event),Â buffer);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (tÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â options.anyLines())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â formatOption(t,Â getSuffix(event),Â buffer);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â &lt;span&gt;isSubShortOption&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â ThrowableFormatOptions.MESSAGE.equalsIgnoreCase(rawOption)Â ||&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ThrowableFormatOptions.LOCALIZED_MESSAGE.equalsIgnoreCase(rawOption)Â ||&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ThrowableFormatOptions.FILE_NAME.equalsIgnoreCase(rawOption)Â ||&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ThrowableFormatOptions.LINE_NUMBER.equalsIgnoreCase(rawOption)Â ||&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ThrowableFormatOptions.METHOD_NAME.equalsIgnoreCase(rawOption)Â ||&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ThrowableFormatOptions.CLASS_NAME.equalsIgnoreCase(rawOption);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;formatSubShortOption&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â ThrowableÂ t,Â &lt;span&gt;final&lt;/span&gt;Â StringÂ suffix,Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ buffer)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â StackTraceElement[]Â trace;&lt;br/&gt;Â Â Â Â Â Â Â Â StackTraceElementÂ throwingMethodÂ =Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â len;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (tÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â traceÂ =Â t.getStackTrace();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (traceÂ !=&lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â trace.lengthÂ &amp;gt;Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â throwingMethodÂ =Â trace[&lt;span&gt;0&lt;/span&gt;];&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (tÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â throwingMethodÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â StringÂ toAppendÂ =Â Strings.EMPTY;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (ThrowableFormatOptions.CLASS_NAME.equalsIgnoreCase(rawOption))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â toAppendÂ =Â throwingMethod.getClassName();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (ThrowableFormatOptions.METHOD_NAME.equalsIgnoreCase(rawOption))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â toAppendÂ =Â throwingMethod.getMethodName();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (ThrowableFormatOptions.LINE_NUMBER.equalsIgnoreCase(rawOption))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â toAppendÂ =Â String.valueOf(throwingMethod.getLineNumber());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (ThrowableFormatOptions.MESSAGE.equalsIgnoreCase(rawOption))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â toAppendÂ =Â t.getMessage();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (ThrowableFormatOptions.LOCALIZED_MESSAGE.equalsIgnoreCase(rawOption))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â toAppendÂ =Â t.getLocalizedMessage();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (ThrowableFormatOptions.FILE_NAME.equalsIgnoreCase(rawOption))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â toAppendÂ =Â throwingMethod.getFileName();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â lenÂ =Â buffer.length();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (lenÂ &amp;gt;Â &lt;span&gt;0&lt;/span&gt;Â &amp;amp;&amp;amp;Â !Character.isWhitespace(buffer.charAt(lenÂ -Â &lt;span&gt;1&lt;/span&gt;)))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â buffer.append(&lt;span&gt;&#x27;Â &#x27;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â buffer.append(toAppend);&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (Strings.isNotBlank(suffix))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â buffer.append(&lt;span&gt;&#x27;Â &#x27;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â buffer.append(suffix);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;formatOption&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â ThrowableÂ throwable,Â &lt;span&gt;final&lt;/span&gt;Â StringÂ suffix,Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ buffer)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringWriterÂ wÂ =Â &lt;span&gt;new&lt;/span&gt;Â StringWriter();&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â throwable.printStackTrace(&lt;span&gt;new&lt;/span&gt;Â PrintWriter(w));&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â lenÂ =Â buffer.length();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (lenÂ &amp;gt;Â &lt;span&gt;0&lt;/span&gt;Â &amp;amp;&amp;amp;Â !Character.isWhitespace(buffer.charAt(lenÂ -Â &lt;span&gt;1&lt;/span&gt;)))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â buffer.append(&lt;span&gt;&#x27;Â &#x27;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (!options.allLines()Â ||Â !Strings.LINE_SEPARATOR.equals(options.getSeparator())Â ||Â Strings.isNotBlank(suffix))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ sbÂ =Â &lt;span&gt;new&lt;/span&gt;Â StringBuilder();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â String[]Â arrayÂ =Â w.toString().split(Strings.LINE_SEPARATOR);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â limitÂ =Â options.minLines(array.length)Â -Â &lt;span&gt;1&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â suffixNotBlankÂ =Â Strings.isNotBlank(suffix);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (&lt;span&gt;int&lt;/span&gt;Â iÂ =Â &lt;span&gt;0&lt;/span&gt;;Â iÂ &amp;lt;=Â limit;Â ++i)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sb.append(array[i]);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (suffixNotBlank)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sb.append(&lt;span&gt;&#x27;Â &#x27;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sb.append(suffix);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (iÂ &amp;lt;Â limit)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sb.append(options.getSeparator());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â buffer.append(sb.toString());&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â buffer.append(w.toString());&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;/**&lt;br/&gt;Â Â Â Â Â *Â ThisÂ converterÂ obviouslyÂ handlesÂ throwables.&lt;br/&gt;Â Â Â Â Â *&lt;br/&gt;Â Â Â Â Â *Â &lt;span&gt;@return&lt;/span&gt;Â true.&lt;br/&gt;Â Â Â Â Â */&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;boolean&lt;/span&gt;Â &lt;span&gt;handlesThrowable&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;true&lt;/span&gt;;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;protected&lt;/span&gt;Â StringÂ &lt;span&gt;getSuffix&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//noinspectionÂ ForLoopReplaceableByForEach&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ toAppendToÂ =Â &lt;span&gt;new&lt;/span&gt;Â StringBuilder();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (&lt;span&gt;int&lt;/span&gt;Â iÂ =Â &lt;span&gt;0&lt;/span&gt;,Â sizeÂ =Â formatters.size();Â iÂ &amp;lt;Â Â size;Â i++)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â formatters.get(i).format(event,Â toAppendTo);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â toAppendTo.toString();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â ThrowableFormatOptionsÂ &lt;span&gt;getOptions&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â options;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;2.&lt;/strong&gt; &lt;strong&gt;%xExï¼Œä¸ä»…è¾“å‡ºå¼‚å¸¸ä¿¡æ¯ï¼ŒåŒæ—¶è·å–æ‰©å±•ä¿¡æ¯&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å¯¹åº”çš„æ ¼å¼è½¬åŒ–ç±»æ˜¯ExtendedThrowablePatternConverterï¼Œåœ¨formatæ–¹æ³•å†…éƒ¨è·å–äº†ThrowableProxyå¯¹è±¡ï¼Œæ­¤æ—¶ä¸€å®šä¼šè§¦å‘è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»ã€‚&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;//Â org.apache.logging.log4j.core.pattern.ExtendedThrowablePatternConverter&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Plugin&lt;/span&gt;(nameÂ =Â &lt;span&gt;&quot;ExtendedThrowablePatternConverter&quot;&lt;/span&gt;,Â categoryÂ =Â PatternConverter.CATEGORY)&lt;br/&gt;&lt;span&gt;@ConverterKeys&lt;/span&gt;({Â &lt;span&gt;&quot;xEx&quot;&lt;/span&gt;,Â &lt;span&gt;&quot;xThrowable&quot;&lt;/span&gt;,Â &lt;span&gt;&quot;xException&quot;&lt;/span&gt;Â })&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;ExtendedThrowablePatternConverter&lt;/span&gt;Â &lt;span&gt;extends&lt;/span&gt;Â &lt;span&gt;ThrowablePatternConverter&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;/**&lt;br/&gt;Â Â Â Â Â *Â {&lt;span&gt;@inheritDoc&lt;/span&gt;}&lt;br/&gt;Â Â Â Â Â */&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;format&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â LogEventÂ event,Â &lt;span&gt;final&lt;/span&gt;Â StringBuilderÂ toAppendTo)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;//Â è·å–Â ThrowableProxyÂ å¯¹è±¡ï¼Œè§¦å‘è§£æã€åŠ è½½å¼‚å¸¸å †æ ˆç±»&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â ThrowableProxyÂ proxyÂ =Â event.getThrownProxy();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â ThrowableÂ throwableÂ =Â event.getThrown();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â ((throwableÂ !=Â &lt;span&gt;null&lt;/span&gt;Â ||Â proxyÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â &amp;amp;&amp;amp;Â options.anyLines())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (proxyÂ ==Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;super&lt;/span&gt;.format(event,Â toAppendTo);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringÂ extStackTraceÂ =Â proxy.getExtendedStackTraceAsString(options.getIgnorePackages(),&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â options.getTextRenderer(),Â getSuffix(event),Â options.getSeparator());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â lenÂ =Â toAppendTo.length();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (lenÂ &amp;gt;Â &lt;span&gt;0&lt;/span&gt;Â &amp;amp;&amp;amp;Â !Character.isWhitespace(toAppendTo.charAt(lenÂ -Â &lt;span&gt;1&lt;/span&gt;)))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â toAppendTo.append(&lt;span&gt;&#x27;Â &#x27;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â toAppendTo.append(extStackTrace);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;}&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;5. æœ€ä½³å®è·µ&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;æœ¬ç« èŠ‚ä¸»è¦ç»“åˆé¡¹ç›®åœ¨æ—¥å¿—ä½¿ç”¨æ–¹é¢çš„ä¸€ç³»åˆ—è¸©å‘ç»å†å’Œå®è·µç»éªŒï¼Œæ€»ç»“äº†ä¸€ä»½å…³äºæ—¥å¿—é…ç½®çš„æœ€ä½³å®è·µï¼Œä¾›å¤§å®¶å‚è€ƒã€‚&lt;/span&gt;&lt;/section&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å»ºè®®æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­å¯¹æ‰€æœ‰Appenderçš„PatternLayoutéƒ½å¢åŠ %exé…ç½®ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰æ˜¾å¼é…ç½®%exï¼Œåˆ™å¼‚å¸¸æ ¼å¼åŒ–è¾“å‡ºçš„é»˜è®¤é…ç½®æ˜¯%xExï¼Œæ­¤æ—¶ä¼šæ‰“å°å¼‚å¸¸çš„æ‰©å±•ä¿¡æ¯ï¼ˆ&lt;/span&gt;&lt;span&gt;JARåç§°å’Œç‰ˆæœ¬&lt;/span&gt;&lt;span&gt;ï¼‰ï¼Œå¯èƒ½å¯¼è‡´ä¸šåŠ¡çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ä¸å»ºè®®æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨AsyncAppenderï¼Œå»ºè®®è‡ªå®šä¹‰Appenderå®ç°ï¼Œå› ä¸ºAsyncAppenderæ˜¯æ—¥å¿—æ¡†æ¶é»˜è®¤æä¾›çš„ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸­ä»ç„¶å­˜åœ¨æ—¥å¿—äº‹ä»¶å…¥é˜Ÿå‰å°±è§¦å‘åŠ è½½å¼‚å¸¸å †æ ˆç±»çš„é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´ä¸šåŠ¡çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ConsoleAppenderï¼Œå› ä¸ºè¾“å‡ºæ—¥å¿—åˆ°Consoleæ—¶æœ‰synchronizedåŒæ­¥æ“ä½œï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹éå¸¸å®¹æ˜“å¯¼è‡´ä¸šåŠ¡çº¿ç¨‹Blockã€‚&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;ä¸å»ºè®®åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨&amp;lt;AsyncLogger&amp;gt;æ ‡ç­¾ï¼Œå› ä¸ºæ—¥å¿—äº‹ä»¶å…ƒç´ åœ¨å…¥é˜Ÿå‰å°±ä¼šè§¦å‘åŠ è½½å¼‚å¸¸å †æ ˆç±»ï¼Œå¯èƒ½å¯¼è‡´ä¸šåŠ¡çº¿ç¨‹Blockã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨Log4j2æä¾›çš„å¼‚æ­¥æ—¥å¿—AsyncLoggerï¼Œå»ºè®®é…ç½®Log4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelectorå‚æ•°ï¼Œå¼€å¯å¼‚æ­¥æ—¥å¿—ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section&gt;&lt;span&gt;ä¸‹é¢æä¾›ä¸€ä»½log4j2.xmlé…ç½®ç¤ºä¾‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&amp;lt;&lt;span&gt;configuration&lt;/span&gt;Â &lt;span&gt;status&lt;/span&gt;=&lt;span&gt;&quot;warn&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;appenders&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;Console&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;Console&quot;&lt;/span&gt;Â &lt;span&gt;target&lt;/span&gt;=&lt;span&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;Â &lt;span&gt;follow&lt;/span&gt;=&lt;span&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;PatternLayout&lt;/span&gt;Â &lt;span&gt;pattern&lt;/span&gt;=&lt;span&gt;&quot;%d{yyyy/MM/ddÂ HH:mm:ss.SSS}Â %tÂ [%p]Â %c{1}Â (%F:%L)Â %msg%nÂ %ex&quot;&lt;/span&gt;Â /&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;Console&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;XMDFile&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;ShepherdLog&quot;&lt;/span&gt;Â &lt;span&gt;fileName&lt;/span&gt;=&lt;span&gt;&quot;shepherd.log&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;PatternLayout&lt;/span&gt;Â &lt;span&gt;pattern&lt;/span&gt;=&lt;span&gt;&quot;%d{yyyy/MM/ddÂ HH:mm:ss.SSS}Â %tÂ [%p]Â %c{1}Â (%F:%L)Â %msg%nÂ %ex&quot;&lt;/span&gt;Â /&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;XMDFile&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--XMDFileå¼‚æ­¥ç£ç›˜æ—¥å¿—é…ç½®ç¤ºä¾‹--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--é»˜è®¤æŒ‰å¤©&amp;amp;æŒ‰512Mæ–‡ä»¶å¤§å°åˆ‡åˆ†æ—¥å¿—ï¼Œé»˜è®¤æœ€å¤šä¿ç•™30ä¸ªæ—¥å¿—æ–‡ä»¶ã€‚--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--æ³¨æ„ï¼šfileNameå‰ä¼šè‡ªåŠ¨å¢åŠ æ–‡ä»¶è·¯å¾„ï¼Œåªé…ç½®æ–‡ä»¶åå³å¯--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;XMDFile&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;LocalServiceLog&quot;&lt;/span&gt;Â &lt;span&gt;fileName&lt;/span&gt;=&lt;span&gt;&quot;request.log&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;PatternLayout&lt;/span&gt;Â &lt;span&gt;pattern&lt;/span&gt;=&lt;span&gt;&quot;%d{yyyy/MM/ddÂ HH:mm:ss.SSS}Â %tÂ [%p]Â %c{1}Â (%F:%L)Â %msg%nÂ %ex&quot;&lt;/span&gt;Â /&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;XMDFile&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â &lt;br/&gt;Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--Â ä½¿ç”¨è‡ªå®šä¹‰çš„AsyncScribeAppenderä»£æ›¿åŸæœ‰çš„AsycncAppenderÂ --&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;AsyncScribe&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;LogCenterAsync&quot;&lt;/span&gt;Â &lt;span&gt;blocking&lt;/span&gt;=&lt;span&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--Â åœ¨æŒ‡å®šæ—¥å¿—åæ–¹é¢ï¼ŒscribeCategory å’Œ appkey ä¸¤è€…è‡³å°‘å­˜åœ¨ä¸€ç§ï¼Œä¸” scribeCategory é«˜äº appkeyã€‚--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--Â &amp;lt;PropertyÂ name=&quot;scribeCategory&quot;&amp;gt;data_update_test_lc&amp;lt;/Property&amp;gt;Â --&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;LcLayout&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;AsyncScribe&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;appenders&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;loggers&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;logger&lt;/span&gt;Â &lt;span&gt;name&lt;/span&gt;=&lt;span&gt;&quot;com.sankuai.shepherd&quot;&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;info&quot;&lt;/span&gt;Â &lt;span&gt;additivity&lt;/span&gt;=&lt;span&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;AppenderRef&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;ShepherdLog&quot;&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;warn&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;AppenderRef&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;LogCenterAsync&quot;&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;info&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;logger&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;root&lt;/span&gt;Â &lt;span&gt;level&lt;/span&gt;=&lt;span&gt;&quot;info&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--Consoleæ—¥å¿—æ˜¯åŒæ­¥ã€é˜»å¡çš„ï¼Œæ¨èåªåœ¨æœ¬åœ°è°ƒè¯•æ—¶ä½¿ç”¨ï¼Œçº¿ä¸Šå°†è¯¥é…ç½®å»æ‰--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;!--appender-refÂ ref=&quot;Console&quot;Â /--&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;appender-ref&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;LocalServiceLog&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;&lt;span&gt;appender-ref&lt;/span&gt;Â &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;LogCenterAsync&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;root&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&amp;lt;/&lt;span&gt;loggers&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&amp;lt;/&lt;span&gt;configuration&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;6. ä½œè€…ç®€ä»‹&lt;/span&gt;&lt;/h2&gt;&lt;section&gt;&lt;span&gt;å¿—æ´‹ã€é™ˆè¶…ã€ææ•ã€å‡¯æ™–ã€æ®·ç¦ç­‰ï¼Œå‡æ¥è‡ªç¾å›¢åŸºç¡€æŠ€æœ¯éƒ¨-åº”ç”¨ä¸­é—´ä»¶å›¢é˜Ÿã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;----------Â  ENDÂ  ----------&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;æ‹›è˜ä¿¡æ¯&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section data-source=&quot;bj.96weixin.com&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;span&gt;ç¾å›¢åŸºç¡€æŠ€æœ¯éƒ¨-åŸºç¡€æ¶æ„å›¢é˜Ÿè¯šæ‹›é«˜çº§ã€èµ„æ·±æŠ€æœ¯ä¸“å®¶ï¼ŒBaseåŒ—äº¬ã€ä¸Šæµ·ã€‚æˆ‘ä»¬è‡´åŠ›äºå»ºè®¾ç¾å›¢å…¨å…¬å¸ç»Ÿä¸€çš„é«˜å¹¶å‘é«˜æ€§èƒ½åˆ†å¸ƒå¼åŸºç¡€æ¶æ„å¹³å°ï¼Œæ¶µç›–æ•°æ®åº“ã€åˆ†å¸ƒå¼ç›‘æ§ã€æœåŠ¡æ²»ç†ã€é«˜æ€§èƒ½é€šä¿¡ã€æ¶ˆæ¯ä¸­é—´ä»¶ã€åŸºç¡€å­˜å‚¨ã€å®¹å™¨åŒ–ã€é›†ç¾¤è°ƒåº¦ç­‰åŸºç¡€æ¶æ„ä¸»è¦çš„æŠ€æœ¯é¢†åŸŸã€‚æ¬¢è¿æœ‰å…´è¶£çš„åŒå­¦æŠ•é€ç®€å†è‡³ï¼š&lt;/span&gt;&lt;span&gt;edp.itu.zhaopin@meituan.com&lt;/span&gt;&lt;span&gt;ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;ä¹Ÿè®¸ä½ è¿˜æƒ³çœ‹&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;Â  |Â &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651770155&amp;amp;idx=1&amp;amp;sn=03437e5e67bb971f96cd698139c71fcf&amp;amp;chksm=bd1214668a659d7079bdcaabef696bcfd0f17add2f71303e7a7fce76997631eba2629e9a669c&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;å¯è§†åŒ–å…¨é“¾è·¯æ—¥å¿—è¿½è¸ª&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;/&gt;&lt;/strong&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651770155&amp;amp;idx=1&amp;amp;sn=03437e5e67bb971f96cd698139c71fcf&amp;amp;chksm=bd1214668a659d7079bdcaabef696bcfd0f17add2f71303e7a7fce76997631eba2629e9a669c&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;å¯è§†åŒ–å…¨é“¾è·¯æ—¥å¿—è¿½è¸ª&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;å¯è§†åŒ–å…¨é“¾è·¯æ—¥å¿—è¿½è¸ª&lt;/a&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;Â  |&lt;/strong&gt;&lt;/span&gt;Â &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651764878&amp;amp;idx=1&amp;amp;sn=47d0a950bacdbd062e544251e4d2c4d5&amp;amp;chksm=bd1261c38a65e8d59395c62f565067c8c1dad2e71e9a864dd782b111a43234c24154799a9db5&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;å¦‚ä½•ä¼˜é›…åœ°è®°å½•æ“ä½œæ—¥å¿—ï¼Ÿ&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;å¦‚ä½•ä¼˜é›…åœ°è®°å½•æ“ä½œæ—¥å¿—ï¼Ÿ&lt;/a&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;Â  |&lt;/strong&gt;Â &lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651751273&amp;amp;idx=1&amp;amp;sn=388f666fd1bce3413d8564662b120b71&amp;amp;chksm=bd125a248a65d332417c729d9e434157236a41c380fb5ca5b2b3efa7bf6e980273cc544757a9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;ç¾å›¢å¼€æºLogan Webï¼šå‰ç«¯æ—¥å¿—åœ¨Webç«¯çš„å®ç°&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;å‰ç«¯æ—¥å¿—åœ¨Webç«¯çš„å®ç°&lt;/a&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;é˜…è¯»æ›´å¤š&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;---&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651765958&amp;amp;idx=1&amp;amp;sn=8201546812e5a95a2bee9dffc6d12f00&amp;amp;chksm=bd12658b8a65ec9de2f5be1e96796dfb3c8f1a374d4b7bd91266072f557caf8118d4ddb72b07&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;å‰â€ç«¯&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;å‰ç«¯&lt;/span&gt;&lt;/a&gt;&lt;span&gt;&lt;strong&gt;Â |&lt;/strong&gt;&lt;/span&gt;&lt;a target=&quot;_blank&quot; href=&quot;https://t.1yb.co/jo7v&quot; textvalue=&quot;Â å®‰å…¨&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;&lt;strong&gt;Â &lt;/strong&gt;Â &lt;/span&gt;&lt;/a&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651765981&amp;amp;idx=1&amp;amp;sn=c2dd86f15dee2cbbc89e27677d985060&amp;amp;chksm=bd1265908a65ec86d4d08f7600d1518b61c90f6453074f9b308c96861c045712280a73751c73&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;ç®—â€æ³•&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;ç®—æ³•&lt;/span&gt;&lt;/a&gt;&lt;span&gt;&lt;strong&gt;Â |&lt;/strong&gt;Â &lt;/span&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651765982&amp;amp;idx=1&amp;amp;sn=231b41f653ac7959f3e3b8213dcec2b0&amp;amp;chksm=bd1265938a65ec85630c546169444d56377bc2f11401d251da7ca50e5d07e353aa01580c7216&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;åâ€ç«¯&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;åç«¯&lt;/span&gt;&lt;/a&gt;&lt;span&gt;&lt;strong&gt;Â |Â &lt;/strong&gt;&lt;/span&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651765964&amp;amp;idx=1&amp;amp;sn=ab6d8db147234fe57f27dd46eec40fef&amp;amp;chksm=bd1265818a65ec9749246dd1a2eb3bf7798772cc4d5b4283b15eae2f80bc6db63a1471a9e61e&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;æ•°â€æ®&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;æ•°æ®&lt;/span&gt;&lt;/a&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651765965&amp;amp;idx=1&amp;amp;sn=37e0c56c8b080146ce5249243bfd84d8&amp;amp;chksm=bd1265808a65ec96d3a2b2c87c6e27c910d49cb6b149970fb2db8bf88045a0a85fed2e6a0b84&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;å®‰â€å…¨&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;å®‰å…¨&lt;/span&gt;&lt;/a&gt;&lt;span&gt;&lt;strong&gt;Â |Â &lt;/strong&gt;&lt;/span&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651765972&amp;amp;idx=1&amp;amp;sn=afe02ec92762c1ce18740d03324c4ac3&amp;amp;chksm=bd1265998a65ec8f10d5f58d0f3681ddfc5325137218e568e1cda3a50e427749edb5c6a7dcf5&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;Andâ€roid&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;Android&lt;/span&gt;&lt;/a&gt;&lt;span&gt;&lt;strong&gt;Â |&lt;/strong&gt;Â &lt;/span&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651765973&amp;amp;idx=1&amp;amp;sn=32a23bf1d278dda0398f993ab60a697e&amp;amp;chksm=bd1265988a65ec8e630ef4d24b4946ab6bd7e66702c1d712481cf3c471468a059c470a14c30d&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;iOâ€S&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;iOS&lt;/span&gt;&lt;/a&gt;&lt;span&gt;Â &lt;strong&gt;Â |&lt;/strong&gt;Â &lt;/span&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651765963&amp;amp;idx=1&amp;amp;sn=a3de9ef267d07d94118c1611776a4b28&amp;amp;chksm=bd1265868a65ec906592d25ad65f2a8516338d07ec3217059e6975fc131fc0107d66a8cd2612&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;è¿â€ç»´&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;è¿ç»´&lt;/span&gt;&lt;/a&gt;&lt;span&gt;&lt;strong&gt;Â |Â &lt;/strong&gt;&lt;/span&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651765974&amp;amp;idx=1&amp;amp;sn=763c1e37d04acffd0142a2852ecfb000&amp;amp;chksm=bd12659b8a65ec8dfcfeb2028ef287fae7c38f134a665375ba420556ce5d2e4cf398147bd12e&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;æµ‹â€è¯•&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; tab=&quot;outerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;æµ‹è¯•&lt;/span&gt;&lt;/a&gt;&lt;/section&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MjM5NjQ5MTI5OA==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/hEx03cFgUsVGibnsaEib3aNlqF0tOrA2RGEmNSbia2nnohE4Tpf95UyTiaSjDVbHRfY8WNBeTuLLTaVdSckkNyEx1Q/0?wx_fmt=png&quot; data-nickname=&quot;ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ&quot; data-alias=&quot;meituantech&quot; data-signature=&quot;10000+å·¥ç¨‹å¸ˆï¼Œå¦‚ä½•æ”¯æ’‘ä¸­å›½é¢†å…ˆçš„ç”Ÿæ´»æœåŠ¡ç”µå­å•†åŠ¡å¹³å°ï¼Ÿæ•°äº¿æ¶ˆè´¹è€…ã€æ•°ç™¾ä¸‡å•†æˆ·ã€2000å¤šä¸ªè¡Œä¸šã€å‡ åƒäº¿äº¤æ˜“é¢èƒŒåæ˜¯å“ªäº›æŠ€æœ¯åœ¨æ”¯æ’‘ï¼Ÿè¿™é‡Œæ˜¯ç¾å›¢ã€å¤§ä¼—ç‚¹è¯„ã€ç¾å›¢å¤–å–ã€ç¾å›¢é…é€ã€ç¾å›¢ä¼˜é€‰ç­‰æŠ€æœ¯å›¢é˜Ÿçš„å¯¹å¤–çª—å£ã€‚&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;
          &lt;/div&gt;

          

          



           
                                
                    
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>b128a369165d86c178ac26d6b194174a</guid>
<title>é˜¿é‡Œäº‘å®˜æ–¹ Redis å¼€å‘è§„èŒƒï¼</title>
<link>https://toutiao.io/k/2fqcbfi</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.6573208722741433&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TwDLiaiaWVWJILbpcFk8iaYKHEpKlmD7krfWCzRvtA8hP2HovZAxh4om2Ssz8UqFz9JS0bISLrNSD1YA/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;png&quot; data-w=&quot;3210&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;JavaGuideåœ¨çº¿ç½‘ç«™ï¼šjavaguide.cn&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;æ¥æºï¼šhttps://developer.aliyun.com/article/531067&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ˜¨æ™šåœ¨é˜¿é‡Œäº‘ç¤¾åŒºçœ‹åˆ°ä¸€ä»½é˜¿é‡Œäº‘å®˜æ–¹ Redis å¼€å‘è§„èŒƒï¼Œæ˜¯ä¸€ä½é˜¿é‡Œäº‘æ•°æ®åº“æŠ€æœ¯ä¸“å®¶(Redisæ–¹å‘)å†™çš„ï¼Œæ„Ÿè§‰æœ‰å¾ˆå¤šåœ°æ–¹å€¼å¾—å‚è€ƒã€‚æˆ‘å¯¹åŸæ–‡æ’ç‰ˆå’Œå†…å®¹è¿›è¡Œäº†ç®€å•å®Œå–„ï¼Œè¿™é‡Œåˆ†äº«ä¸€ä¸‹ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ä¸€ã€é”®å€¼è®¾è®¡&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;1. key åè®¾è®¡&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;(1)ã€å»ºè®®ã€‘: å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»¥ä¸šåŠ¡å(æˆ–æ•°æ®åº“å)ä¸ºå‰ç¼€(é˜²æ­¢ key å†²çª)ï¼Œç”¨å†’å·åˆ†éš”ï¼Œæ¯”å¦‚ä¸šåŠ¡å:è¡¨å:id&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;ugc:video:1&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;(2)ã€å»ºè®®ã€‘ï¼šç®€æ´æ€§&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¿è¯è¯­ä¹‰çš„å‰æä¸‹ï¼Œæ§åˆ¶ key çš„é•¿åº¦ï¼Œå½“ key è¾ƒå¤šæ—¶ï¼Œå†…å­˜å ç”¨ä¹Ÿä¸å®¹å¿½è§†ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;user:{uid}:friends:messages:{mid}ç®€åŒ–ä¸ºu:{uid}:fr:m:{mid}ã€‚&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;(3)ã€å¼ºåˆ¶ã€‘ï¼šä¸è¦åŒ…å«ç‰¹æ®Šå­—ç¬¦&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åä¾‹ï¼šåŒ…å«ç©ºæ ¼ã€æ¢è¡Œã€å•åŒå¼•å·ä»¥åŠå…¶ä»–è½¬ä¹‰å­—ç¬¦&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯¦ç»†è§£æï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s?spm=a2c6h.12873639.article-detail.7.753b1feeTX187Q&amp;amp;__biz=Mzg2NTEyNzE0OA==&amp;amp;mid=2247483663&amp;amp;idx=1&amp;amp;sn=7c4ad441eaec6f0ff38d1c6a097b1fa4&amp;amp;chksm=ce5f9e8cf928179a2c74227da95bec575bdebc682e8630b5b1bb2071c0a1b4be6f98d67c37ca&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;Redis å¼€å‘è§„èŒƒè§£æ(ä¸€)--é”®åè®¾è®¡&lt;/a&gt; ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2. value è®¾è®¡&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;(1)ã€å¼ºåˆ¶ã€‘ï¼šæ‹’ç» bigkey(é˜²æ­¢ç½‘å¡æµé‡ã€æ…¢æŸ¥è¯¢)&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;string ç±»å‹æ§åˆ¶åœ¨ 10KB ä»¥å†…ï¼Œhashã€listã€setã€zset å…ƒç´ ä¸ªæ•°ä¸è¦è¶…è¿‡ 5000ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åä¾‹ï¼šä¸€ä¸ªåŒ…å« 200 ä¸‡ä¸ªå…ƒç´ çš„ listã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;éå­—ç¬¦ä¸²çš„ bigkeyï¼Œä¸è¦ä½¿ç”¨ del åˆ é™¤ï¼Œä½¿ç”¨ hscanã€sscanã€zscan æ–¹å¼æ¸è¿›å¼åˆ é™¤ï¼ŒåŒæ—¶è¦æ³¨æ„é˜²æ­¢ bigkey è¿‡æœŸæ—¶é—´è‡ªåŠ¨åˆ é™¤é—®é¢˜(ä¾‹å¦‚ä¸€ä¸ª 200 ä¸‡çš„ zset è®¾ç½® 1 å°æ—¶è¿‡æœŸï¼Œä¼šè§¦å‘ del æ“ä½œï¼Œé€ æˆé˜»å¡ï¼Œè€Œä¸”è¯¥æ“ä½œä¸ä¼šä¸å‡ºç°åœ¨æ…¢æŸ¥è¯¢ä¸­(latency å¯æŸ¥))ï¼Œ&lt;span&gt;æŸ¥æ‰¾æ–¹æ³•&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;å’Œ&lt;span&gt;åˆ é™¤æ–¹æ³•&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt; ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯¦ç»†è§£æï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s?spm=a2c6h.12873639.article-detail.10.753b1feeTX187Q&amp;amp;__biz=Mzg2NTEyNzE0OA==&amp;amp;mid=2247483677&amp;amp;idx=1&amp;amp;sn=5c320b46f0e06ce9369a29909d62b401&amp;amp;chksm=ce5f9e9ef928178834021b6f9b939550ac400abae5c31e1933bafca2f16b23d028cc51813aec&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;Redis å¼€å‘è§„èŒƒè§£æ(äºŒ)--è€ç”Ÿå¸¸è°ˆ bigkey&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;(2)ã€æ¨èã€‘ï¼šé€‰æ‹©é€‚åˆçš„æ•°æ®ç±»å‹ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¾‹å¦‚ï¼šå®ä½“ç±»å‹(è¦åˆç†æ§åˆ¶å’Œä½¿ç”¨æ•°æ®ç»“æ„å†…å­˜ç¼–ç ä¼˜åŒ–é…ç½®,ä¾‹å¦‚ ziplistï¼Œä½†ä¹Ÿè¦æ³¨æ„èŠ‚çœå†…å­˜å’Œæ€§èƒ½ä¹‹é—´çš„å¹³è¡¡)&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åä¾‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;set&lt;/span&gt;Â user:1:nameÂ tom&lt;br/&gt;&lt;span&gt;set&lt;/span&gt;Â user:1:ageÂ 19&lt;br/&gt;&lt;span&gt;set&lt;/span&gt;Â user:1:favorÂ football&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ­£ä¾‹:&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;hmsetÂ user:1Â nameÂ tomÂ ageÂ 19Â favorÂ football&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.ã€æ¨èã€‘ï¼šæ§åˆ¶ key çš„ç”Ÿå‘½å‘¨æœŸï¼Œredis ä¸æ˜¯åƒåœ¾æ¡¶ã€‚&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å»ºè®®ä½¿ç”¨ expire è®¾ç½®è¿‡æœŸæ—¶é—´(æ¡ä»¶å…è®¸å¯ä»¥æ‰“æ•£è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢é›†ä¸­è¿‡æœŸ)ï¼Œä¸è¿‡æœŸçš„æ•°æ®é‡ç‚¹å…³æ³¨ idletimeã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;amp;mid=2247525881&amp;amp;idx=1&amp;amp;sn=33d4565668cff95f5ee239c6e1d660fe&amp;amp;chksm=cea12a32f9d6a324432c964bf536181f2d55ee50afba9a53d9b09fa0e1a7126a03bb1dde4c60&amp;amp;token=698289097&amp;amp;lang=zh_CN&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹&lt;/a&gt;æ¥å•¦ï¼è¿™æ˜¯ä¸€ä»½æ•™ä½ å¦‚ä½•æ›´é«˜æ•ˆåœ°å‡†å¤‡é¢è¯•çš„å°å†Œï¼Œæ¶µç›–å¸¸è§å…«è‚¡æ–‡ï¼ˆç³»ç»Ÿè®¾è®¡ã€å¸¸è§æ¡†æ¶ã€åˆ†å¸ƒå¼ã€é«˜å¹¶å‘ ......ï¼‰ã€ä¼˜è´¨é¢ç»ç­‰å†…å®¹ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;äºŒã€å‘½ä»¤ä½¿ç”¨&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;1.ã€æ¨èã€‘ O(N)å‘½ä»¤å…³æ³¨ N çš„æ•°é‡&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¾‹å¦‚ hgetallã€lrangeã€smembersã€zrangeã€sinter ç­‰å¹¶éä¸èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦æ˜ç¡® N çš„å€¼ã€‚æœ‰éå†çš„éœ€æ±‚å¯ä»¥ä½¿ç”¨ hscanã€sscanã€zscan ä»£æ›¿ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.ã€æ¨èã€‘ï¼šç¦ç”¨å‘½ä»¤&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¦æ­¢çº¿ä¸Šä½¿ç”¨ keysã€flushallã€flushdb ç­‰ï¼Œé€šè¿‡ redis çš„ rename æœºåˆ¶ç¦æ‰å‘½ä»¤ï¼Œæˆ–è€…ä½¿ç”¨ scan çš„æ–¹å¼æ¸è¿›å¼å¤„ç†ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.ã€æ¨èã€‘åˆç†ä½¿ç”¨ select&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;redis çš„å¤šæ•°æ®åº“è¾ƒå¼±ï¼Œä½¿ç”¨æ•°å­—è¿›è¡ŒåŒºåˆ†ï¼Œå¾ˆå¤šå®¢æˆ·ç«¯æ”¯æŒè¾ƒå·®ï¼ŒåŒæ—¶å¤šä¸šåŠ¡ç”¨å¤šæ•°æ®åº“å®é™…è¿˜æ˜¯å•çº¿ç¨‹å¤„ç†ï¼Œä¼šæœ‰å¹²æ‰°ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;4.ã€æ¨èã€‘ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;åŸç”Ÿå‘½ä»¤ï¼šä¾‹å¦‚ mgetã€msetã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;éåŸç”Ÿå‘½ä»¤ï¼šå¯ä»¥ä½¿ç”¨ pipeline æé«˜æ•ˆç‡ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†è¦æ³¨æ„æ§åˆ¶ä¸€æ¬¡æ‰¹é‡æ“ä½œçš„ &lt;strong&gt;å…ƒç´ ä¸ªæ•°&lt;/strong&gt;(ä¾‹å¦‚ 500 ä»¥å†…ï¼Œå®é™…ä¹Ÿå’Œå…ƒç´ å­—èŠ‚æ•°æœ‰å…³)ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ³¨æ„ä¸¤è€…ä¸åŒï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;åŸç”Ÿæ˜¯åŸå­æ“ä½œï¼Œpipeline æ˜¯éåŸå­æ“ä½œã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;pipeline å¯ä»¥æ‰“åŒ…ä¸åŒçš„å‘½ä»¤ï¼ŒåŸç”Ÿåšä¸åˆ°&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;pipeline éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶æ”¯æŒã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;5.ã€å»ºè®®ã€‘Redis äº‹åŠ¡åŠŸèƒ½è¾ƒå¼±ï¼Œä¸å»ºè®®è¿‡å¤šä½¿ç”¨&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Redis çš„äº‹åŠ¡åŠŸèƒ½è¾ƒå¼±(ä¸æ”¯æŒå›æ»š)ï¼Œè€Œä¸”é›†ç¾¤ç‰ˆæœ¬(è‡ªç ”å’Œå®˜æ–¹)è¦æ±‚ä¸€æ¬¡äº‹åŠ¡æ“ä½œçš„ key å¿…é¡»åœ¨ä¸€ä¸ª slot ä¸Š(å¯ä»¥ä½¿ç”¨ hashtag åŠŸèƒ½è§£å†³)&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;6.ã€å»ºè®®ã€‘Redis é›†ç¾¤ç‰ˆæœ¬åœ¨ä½¿ç”¨ Lua ä¸Šæœ‰ç‰¹æ®Šè¦æ±‚ï¼š&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;æ‰€æœ‰ key éƒ½åº”è¯¥ç”± KEYS æ•°ç»„æ¥ä¼ é€’ï¼Œredis.call/pcall é‡Œé¢è°ƒç”¨çš„ redis å‘½ä»¤ï¼Œkey çš„ä½ç½®ï¼Œå¿…é¡»æ˜¯ KEYS array, å¦åˆ™ç›´æ¥è¿”å› errorï¼Œ&quot;-ERR bad lua script for redis cluster, all the keys that the script uses should be passed using the KEYS array&quot;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ‰€æœ‰ keyï¼Œå¿…é¡»åœ¨ 1 ä¸ª slot ä¸Šï¼Œå¦åˆ™ç›´æ¥è¿”å› error, &quot;-ERR eval/evalsha command keys must in same slot&quot;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;7.ã€å»ºè®®ã€‘å¿…è¦æƒ…å†µä¸‹ä½¿ç”¨ monitor å‘½ä»¤æ—¶ï¼Œè¦æ³¨æ„ä¸è¦é•¿æ—¶é—´ä½¿ç”¨ã€‚&lt;span/&gt;&lt;/h3&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ä¸‰ã€å®¢æˆ·ç«¯ä½¿ç”¨&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;1.ã€æ¨èã€‘é¿å…å¤šä¸ªåº”ç”¨ä½¿ç”¨ä¸€ä¸ª Redis å®ä¾‹&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ­£ä¾‹ï¼šä¸ç›¸å¹²çš„ä¸šåŠ¡æ‹†åˆ†ï¼Œå…¬å…±æ•°æ®åšæœåŠ¡åŒ–ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.ã€æ¨èã€‘ä½¿ç”¨å¸¦æœ‰è¿æ¥æ± çš„æ•°æ®åº“&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½¿ç”¨å¸¦æœ‰è¿æ¥æ± çš„æ•°æ®åº“ï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶è¿æ¥ï¼ŒåŒæ—¶æé«˜æ•ˆç‡ï¼Œæ ‡å‡†ä½¿ç”¨æ–¹å¼ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š&lt;br/&gt;JedisÂ jedisÂ =Â null;&lt;br/&gt;tryÂ {&lt;br/&gt;Â Â Â Â jedisÂ =Â jedisPool.getResource();&lt;br/&gt;Â Â Â Â //å…·ä½“çš„å‘½ä»¤&lt;br/&gt;Â Â Â Â jedis.executeCommand()&lt;br/&gt;}Â catchÂ (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â logger.error(&lt;span&gt;&quot;opÂ keyÂ {}Â error:Â &quot;&lt;/span&gt;Â +Â e.getMessage(),Â key,Â e);&lt;br/&gt;}Â finallyÂ {&lt;br/&gt;Â Â Â Â //æ³¨æ„è¿™é‡Œä¸æ˜¯å…³é—­è¿æ¥ï¼Œåœ¨JedisPoolæ¨¡å¼ä¸‹ï¼ŒJedisä¼šè¢«å½’è¿˜ç»™èµ„æºæ± ã€‚&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (jedisÂ !=Â null)&lt;br/&gt;Â Â Â Â Â Â Â Â jedis.close();&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸‹é¢æ˜¯ JedisPool ä¼˜åŒ–æ–¹æ³•çš„æ–‡ç« :&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;Jedis å¸¸è§å¼‚å¸¸æ±‡æ€»&lt;/span&gt;&lt;sup&gt;[3]&lt;/sup&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;JedisPool èµ„æºæ± ä¼˜åŒ–&lt;/span&gt;&lt;sup&gt;[4]&lt;/sup&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.ã€å»ºè®®ã€‘é«˜å¹¶å‘ä¸‹å»ºè®®å®¢æˆ·ç«¯æ·»åŠ ç†”æ–­åŠŸèƒ½(ä¾‹å¦‚ netflix hystrix)&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨é€šè¿‡ Redis å®¢æˆ·ç«¯æ“ä½œ Redis ä¸­çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨å…¶ä¸­åŠ å…¥ç†”æ–­å™¨çš„é€»è¾‘ã€‚æ¯”å¦‚ï¼Œå½“èŠ‚ç‚¹å¤„äºç†”æ–­çŠ¶æ€æ—¶ï¼Œç›´æ¥è¿”å›ç©ºå€¼ä»¥åŠç†”æ–­å™¨ä¸‰ç§çŠ¶æ€ä¹‹é—´çš„è½¬æ¢ï¼Œå…·ä½“çš„ç¤ºä¾‹ä»£ç åƒä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™æ ·ï¼Œå½“æŸä¸€ä¸ª Redis èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼ŒRedis å®¢æˆ·ç«¯ä¸­çš„ç†”æ–­å™¨å°±ä¼šå®æ—¶ç›‘æµ‹åˆ°ï¼Œå¹¶ä¸”ä¸å†è¯·æ±‚æœ‰é—®é¢˜çš„ Redis èŠ‚ç‚¹ï¼Œé¿å…å•ä¸ªèŠ‚ç‚¹çš„æ•…éšœå¯¼è‡´æ•´ä½“ç³»ç»Ÿçš„é›ªå´©ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;4.ã€æ¨èã€‘ç¡®ä¿ç™»å½•å®‰å…¨&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è®¾ç½®åˆç†çš„å¯†ç ï¼Œå¦‚æœ‰å¿…è¦å¯ä»¥ä½¿ç”¨ SSL åŠ å¯†è®¿é—®ï¼ˆé˜¿é‡Œäº‘ Redis æ”¯æŒï¼‰&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;5.ã€å»ºè®®ã€‘é€‰æ‹©åˆé€‚çš„å†…å­˜æ·˜æ±°ç­–ç•¥&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ ¹æ®è‡ªèº«ä¸šåŠ¡ç±»å‹ï¼Œé€‰å¥½ maxmemory-policy(æœ€å¤§å†…å­˜æ·˜æ±°ç­–ç•¥)ï¼Œè®¾ç½®å¥½è¿‡æœŸæ—¶é—´ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é»˜è®¤ç­–ç•¥æ˜¯ volatile-lruï¼Œå³è¶…è¿‡æœ€å¤§å†…å­˜åï¼Œåœ¨è¿‡æœŸé”®ä¸­ä½¿ç”¨ lru ç®—æ³•è¿›è¡Œ key çš„å‰”é™¤ï¼Œä¿è¯ä¸è¿‡æœŸæ•°æ®ä¸è¢«åˆ é™¤ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç° OOM é—®é¢˜ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;å…¶ä»–ç­–ç•¥å¦‚ä¸‹&lt;/strong&gt; ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;allkeys-lruï¼šæ ¹æ® LRU ç®—æ³•åˆ é™¤é”®ï¼Œä¸ç®¡æ•°æ®æœ‰æ²¡æœ‰è®¾ç½®è¶…æ—¶å±æ€§ï¼Œç›´åˆ°è…¾å‡ºè¶³å¤Ÿç©ºé—´ä¸ºæ­¢ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;allkeys-randomï¼šéšæœºåˆ é™¤æ‰€æœ‰é”®ï¼Œç›´åˆ°è…¾å‡ºè¶³å¤Ÿç©ºé—´ä¸ºæ­¢ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;volatile-random:éšæœºåˆ é™¤è¿‡æœŸé”®ï¼Œç›´åˆ°è…¾å‡ºè¶³å¤Ÿç©ºé—´ä¸ºæ­¢ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;volatile-ttlï¼šæ ¹æ®é”®å€¼å¯¹è±¡çš„ ttl å±æ€§ï¼Œåˆ é™¤æœ€è¿‘å°†è¦è¿‡æœŸæ•°æ®ã€‚å¦‚æœæ²¡æœ‰ï¼Œå›é€€åˆ° noeviction ç­–ç•¥ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;noevictionï¼šä¸ä¼šå‰”é™¤ä»»ä½•æ•°æ®ï¼Œæ‹’ç»æ‰€æœ‰å†™å…¥æ“ä½œå¹¶è¿”å›å®¢æˆ·ç«¯é”™è¯¯ä¿¡æ¯&quot;(error) OOM command not allowed when used memory&quot;ï¼Œæ­¤æ—¶ Redis åªå“åº”è¯»æ“ä½œã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;amp;mid=2247525881&amp;amp;idx=1&amp;amp;sn=33d4565668cff95f5ee239c6e1d660fe&amp;amp;chksm=cea12a32f9d6a324432c964bf536181f2d55ee50afba9a53d9b09fa0e1a7126a03bb1dde4c60&amp;amp;token=698289097&amp;amp;lang=zh_CN&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹&lt;/a&gt;æ¥å•¦ï¼è¿™æ˜¯ä¸€ä»½æ•™ä½ å¦‚ä½•æ›´é«˜æ•ˆåœ°å‡†å¤‡é¢è¯•çš„å°å†Œï¼Œæ¶µç›–å¸¸è§å…«è‚¡æ–‡ï¼ˆç³»ç»Ÿè®¾è®¡ã€å¸¸è§æ¡†æ¶ã€åˆ†å¸ƒå¼ã€é«˜å¹¶å‘ ......ï¼‰ã€ä¼˜è´¨é¢ç»ç­‰å†…å®¹ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å››ã€ç›¸å…³å·¥å…·&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;1.ã€æ¨èã€‘ï¼šæ•°æ®åŒæ­¥&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;redis é—´æ•°æ®åŒæ­¥å¯ä»¥ä½¿ç”¨ï¼šredis-port&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.ã€æ¨èã€‘ï¼šbig key æœç´¢&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;amp;mid=2247499195&amp;amp;idx=2&amp;amp;sn=13fe477aac7cbb8cd03d91511ea98ba0&amp;amp;chksm=cea1b270f9d63b667b72c142321dfccdb64deb11f4fd082e1cfedf7d45768e125a9db7fa6918&amp;amp;token=973133388&amp;amp;lang=zh_CN&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;Redis ä¸ºä»€ä¹ˆå˜æ…¢äº†ï¼Ÿä¸€æ–‡è®²é€å¦‚ä½•æ’æŸ¥ Redis æ€§èƒ½é—®é¢˜ | ä¸‡å­—é•¿æ–‡&lt;/a&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.ã€æ¨èã€‘ï¼šçƒ­ç‚¹ key å¯»æ‰¾&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;äº¬ä¸œå¼€æºçš„ &lt;span&gt;hotkey&lt;/span&gt;&lt;sup&gt;[5]&lt;/sup&gt; æ”¯æŒæ¯«ç§’çº§æ¢æµ‹çƒ­ç‚¹æ•°æ®ï¼Œæ¯«ç§’çº§æ¨é€è‡³æœåŠ¡å™¨é›†ç¾¤å†…å­˜ï¼Œå¤§å¹…é™ä½çƒ­ key å¯¹æ•°æ®å±‚æŸ¥è¯¢å‹åŠ›ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;äº” é™„å½•ï¼šåˆ é™¤ bigkey&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸‹é¢æ“ä½œå¯ä»¥ä½¿ç”¨ pipeline åŠ é€Ÿã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;redis 4.0 å·²ç»æ”¯æŒ key çš„å¼‚æ­¥åˆ é™¤ï¼Œæ¬¢è¿ä½¿ç”¨ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;1. Hash åˆ é™¤: hscan + hdel&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;delBigHash&lt;/span&gt;&lt;span&gt;(StringÂ host,Â &lt;span&gt;int&lt;/span&gt;Â port,Â StringÂ password,Â StringÂ bigHashKey)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â JedisÂ jedisÂ =Â &lt;span&gt;new&lt;/span&gt;Â Jedis(host,Â port);&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (passwordÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â !&lt;span&gt;&quot;&quot;&lt;/span&gt;.equals(password))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â jedis.auth(password);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â ScanParamsÂ scanParamsÂ =Â &lt;span&gt;new&lt;/span&gt;Â ScanParams().count(&lt;span&gt;100&lt;/span&gt;);&lt;br/&gt;Â Â Â Â StringÂ cursorÂ =Â &lt;span&gt;&quot;0&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;do&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â ScanResult&amp;lt;Entry&amp;lt;String,Â String&amp;gt;&amp;gt;Â scanResultÂ =Â jedis.hscan(bigHashKey,Â cursor,Â scanParams);&lt;br/&gt;Â Â Â Â Â Â Â Â List&amp;lt;Entry&amp;lt;String,Â String&amp;gt;&amp;gt;Â entryListÂ =Â scanResult.getResult();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (entryListÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â !entryList.isEmpty())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (Entry&amp;lt;String,Â String&amp;gt;Â entryÂ :Â entryList)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â jedis.hdel(bigHashKey,Â entry.getKey());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â cursorÂ =Â scanResult.getStringCursor();&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;while&lt;/span&gt;Â (!&lt;span&gt;&quot;0&quot;&lt;/span&gt;.equals(cursor));&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//åˆ é™¤bigkey&lt;/span&gt;&lt;br/&gt;Â Â Â Â jedis.del(bigHashKey);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2. List åˆ é™¤: ltrim&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;delBigList&lt;/span&gt;&lt;span&gt;(StringÂ host,Â &lt;span&gt;int&lt;/span&gt;Â port,Â StringÂ password,Â StringÂ bigListKey)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â JedisÂ jedisÂ =Â &lt;span&gt;new&lt;/span&gt;Â Jedis(host,Â port);&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (passwordÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â !&lt;span&gt;&quot;&quot;&lt;/span&gt;.equals(password))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â jedis.auth(password);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;long&lt;/span&gt;Â llenÂ =Â jedis.llen(bigListKey);&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â counterÂ =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â leftÂ =Â &lt;span&gt;100&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;while&lt;/span&gt;Â (counterÂ &amp;lt;Â llen)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//æ¯æ¬¡ä»å·¦ä¾§æˆªæ‰100ä¸ª&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â jedis.ltrim(bigListKey,Â left,Â llen);&lt;br/&gt;Â Â Â Â Â Â Â Â counterÂ +=Â left;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;//æœ€ç»ˆåˆ é™¤key&lt;/span&gt;&lt;br/&gt;Â Â Â Â jedis.del(bigListKey);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3. Set åˆ é™¤: sscan + srem&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;publicÂ voidÂ delBigSet(StringÂ host,Â intÂ port,Â StringÂ password,Â StringÂ bigSetKey)Â {&lt;br/&gt;Â Â Â Â JedisÂ jedisÂ =Â newÂ Jedis(host,Â port);&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (passwordÂ !=Â nullÂ &amp;amp;&amp;amp;Â !&lt;span&gt;&quot;&quot;&lt;/span&gt;.equals(password))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â jedis.auth(password);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â ScanParamsÂ scanParamsÂ =Â newÂ ScanParams().count(100);&lt;br/&gt;Â Â Â Â StringÂ cursorÂ =Â &lt;span&gt;&quot;0&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;do&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â ScanResult&amp;lt;String&amp;gt;Â scanResultÂ =Â jedis.sscan(bigSetKey,Â cursor,Â scanParams);&lt;br/&gt;Â Â Â Â Â Â Â Â List&amp;lt;String&amp;gt;Â memberListÂ =Â scanResult.getResult();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (memberListÂ !=Â nullÂ &amp;amp;&amp;amp;Â !memberList.isEmpty())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (StringÂ memberÂ :Â memberList)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â jedis.srem(bigSetKey,Â member);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â cursorÂ =Â scanResult.getStringCursor();&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;while&lt;/span&gt;Â (!&lt;span&gt;&quot;0&quot;&lt;/span&gt;.equals(cursor));&lt;br/&gt;&lt;br/&gt;Â Â Â Â //åˆ é™¤bigkey&lt;br/&gt;Â Â Â Â jedis.del(bigSetKey);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;4. SortedSet åˆ é™¤: zscan + zrem&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;delBigZset&lt;/span&gt;&lt;span&gt;(StringÂ host,Â &lt;span&gt;int&lt;/span&gt;Â port,Â StringÂ password,Â StringÂ bigZsetKey)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â JedisÂ jedisÂ =Â &lt;span&gt;new&lt;/span&gt;Â Jedis(host,Â port);&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (passwordÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â !&lt;span&gt;&quot;&quot;&lt;/span&gt;.equals(password))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â jedis.auth(password);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â ScanParamsÂ scanParamsÂ =Â &lt;span&gt;new&lt;/span&gt;Â ScanParams().count(&lt;span&gt;100&lt;/span&gt;);&lt;br/&gt;Â Â Â Â StringÂ cursorÂ =Â &lt;span&gt;&quot;0&quot;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;do&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â ScanResult&amp;lt;Tuple&amp;gt;Â scanResultÂ =Â jedis.zscan(bigZsetKey,Â cursor,Â scanParams);&lt;br/&gt;Â Â Â Â Â Â Â Â List&amp;lt;Tuple&amp;gt;Â tupleListÂ =Â scanResult.getResult();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (tupleListÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â !tupleList.isEmpty())Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (TupleÂ tupleÂ :Â tupleList)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â jedis.zrem(bigZsetKey,Â tuple.getElement());&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â cursorÂ =Â scanResult.getStringCursor();&lt;br/&gt;Â Â Â Â }Â &lt;span&gt;while&lt;/span&gt;Â (!&lt;span&gt;&quot;0&quot;&lt;/span&gt;.equals(cursor));&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//åˆ é™¤bigkey&lt;/span&gt;&lt;br/&gt;Â Â Â Â jedis.del(bigZsetKey);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;å‚è€ƒèµ„æ–™&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;[1]&lt;/span&gt;&lt;p&gt;æŸ¥æ‰¾æ–¹æ³•: &lt;em&gt;https://developer.aliyun.com/article/531067#cc1&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2]&lt;/span&gt;&lt;p&gt;åˆ é™¤æ–¹æ³•: &lt;em&gt;https://developer.aliyun.com/article/531067#cc2&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[3]&lt;/span&gt;&lt;p&gt;Jedis å¸¸è§å¼‚å¸¸æ±‡æ€»: &lt;em&gt;https://yq.aliyun.com/articles/236384?spm=a2c6h.12873639.article-detail.11.753b1feeTX187Q&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[4]&lt;/span&gt;&lt;p&gt;JedisPool èµ„æºæ± ä¼˜åŒ–: &lt;em&gt;https://yq.aliyun.com/articles/236383?spm=a2c6h.12873639.article-detail.12.753b1feeTX187Q&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[5]&lt;/span&gt;&lt;p&gt;hotkey: &lt;em&gt;https://gitee.com/jd-platform-opensource/hotkey&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>961fb0f6736a16e6175368bd320e40d4</guid>
<title>ä¸ºä»€ä¹ˆæ¸¸æˆè¡Œä¸šå–œæ¬¢ç”¨PolarDB</title>
<link>https://toutiao.io/k/ligtpt2</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content                                       &quot; id=&quot;js_content&quot;&gt;
            &lt;h3&gt;&lt;strong&gt;æ¸¸æˆè¡Œä¸šç—›ç‚¹&lt;/strong&gt;&lt;br/&gt;&lt;/h3&gt;&lt;p&gt;åœ¨ç¬”è€…çœ‹æ¥, ä¸åŒè¡Œä¸šå¯¹æ•°æ®åº“ä½¿ç”¨æœ‰å·¨å¤§çš„å·®åˆ«. æ¯”å¦‚æ¸¸æˆè¡Œä¸šæ²¡æœ‰å¤æ‚çš„äº‹åŠ¡äº¤æ˜“åœºæ™¯, ä»–æœ‰ä¸€ä¸ªéå¸¸å¤§çš„blob å­—æ®µç”¨äºå­˜å‚¨è§’è‰²çš„è£…å¤‡ä¿¡æ¯, é‚£ä¹ˆå¤§Blob å­—æ®µçš„æ›´æ–°å°±ä¼šæˆä¸ºæ•°æ®åº“çš„ç“¶é¢ˆ, æ¯”å¦‚åœ¨çº¿æ•™è‚²è¡Œä¸šéœ€è¦æœ‰æŠ¢è¯¾çš„éœ€æ±‚, å› æ­¤ä¼šæœ‰çƒ­ç‚¹è¡Œæ›´æ–°çš„åœºæ™¯, å¯¹çƒ­ç‚¹è¡Œå¦‚ä½•å¤„ç†ä¼šæˆä¸ºæ•°æ®åº“çš„ç“¶é¢ˆ, æ¯”å¦‚SaaS è¡Œä¸š, æ¯ä¸€ä¸ªå®¢æˆ·æœ‰ä¸€ä¸ªDatabase, å› æ­¤ä¼šæœ‰éå¸¸å¤šçš„Table, é‚£ä¹ˆæ•°æ®åº“å°±éœ€è¦å¯¹å¤šè¡¨æœ‰å¾ˆå¥½çš„æ”¯æŒèƒ½åŠ›.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;æ¸¸æˆè¡Œä¸šå’Œå…¶ä»–è¡Œä¸šå¯¹æ•°æ®åº“çš„ä½¿ç”¨è¦æ±‚æ˜¯ä¸ä¸€æ ·çš„.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;æ‰€ä»¥åœ¨æ”¯æ’‘äº†å¤§é‡æ¸¸æˆä¸šåŠ¡ä¹‹å, æˆ‘ç†è§£æ¸¸æˆè¡Œä¸šåœ¨ä½¿ç”¨è‡ªå»ºMySQL çš„æ—¶å€™æœ‰3ä¸ªæ¯”è¾ƒå¤§çš„ç—›ç‚¹&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;1.å¯¹å¤‡ä»½æ¢å¤çš„éœ€æ±‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;2.å¯¹å†™å…¥æ€§èƒ½çš„è¦æ±‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;3.å¯¹è·¨region å®¹ç¾çš„éœ€æ±‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;æ¥ä¸‹æ¥ä¼šåˆ†åˆ«è®²è¿°è¿™ä¸‰ä¸ªç—›ç‚¹PolarDB æ˜¯å¦‚ä½•è§£å†³çš„.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;å¤‡ä»½æ¢å¤&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;ç¬”è€…å’Œå¤§é‡æ¸¸æˆå¼€å‘è€…æ²Ÿé€šä¸­, æ¸¸æˆè¡Œä¸šå¯¹å¤‡ä»½æ¢å¤çš„éœ€æ±‚æ˜¯æå…¶å¼ºçƒˆçš„. æ¯”å¦‚åœ¨ç”µå•†è¡Œä¸š, æ˜¯ä¸å¯èƒ½å­˜åœ¨å°†æ•´ä¸ªæ•°æ®åº“å®ä¾‹è¿›è¡Œå›æ»šåˆ°ä¸€å¤©ä¹‹å‰çš„æ•°æ®, è¿™æ ·æ‰€æœ‰çš„ç”¨æˆ·çš„è´­ä¹°äº¤æ˜“ä¿¡æ¯éƒ½ä¸¢å¤±äº†.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ä½†æ˜¯, åœ¨æ¸¸æˆè¡Œä¸šä¸­, è¿™ç§åœºæ™¯ç¡®å®å­˜åœ¨çš„, æ¯”å¦‚åœ¨å‘ç‰ˆçš„æ—¶å€™, æ¸¸æˆè¡Œä¸šæ˜¯æœ‰å¯èƒ½å‘ç‰ˆå¤±è´¥, è¿™ä¸ªåœ¨å…¶ä»–è¡Œä¸šå‡ºç°æ¦‚ç‡éå¸¸ä½, å¦‚æœå‘ç‰ˆå¤±è´¥, é‚£ä¹ˆæ•´ä¸ªå®ä¾‹å°±éœ€è¦å›æ»šåˆ°ç‰ˆæœ¬ä¹‹å‰. å› æ­¤æ¯æ¬¡å‘ç‰ˆçš„æ—¶å€™éƒ½éœ€è¦å¯¹æ•°æ®åº“å®ä¾‹è¿›è¡Œå¤‡ä»½. å› æ­¤å½“æˆ‘ä»¬ç©æ¸¸æˆçš„æ—¶å€™, çœ‹åˆ°å¤§ç‰ˆæœ¬éœ€è¦åœæœæ›´æ–°, é‚£ä¹ˆå°±æœ‰å¯èƒ½æ˜¯å› ä¸ºåå°éœ€è¦å¤‡ä»½æ•°æ®ç­‰ç­‰ä¸€ç³»åˆ—æ“ä½œäº†.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;è¿˜æœ‰ä¸€ç§åœºæ™¯, å½“å‘ç”Ÿå› ä¸ºå¤–æŒ‚, æ¼æ´, å‚æ•°é…ç½®é”™è¯¯ç­‰ç­‰åœºæ™¯ä¸‹, è¿™ç§ç´§æ€¥æƒ…å†µæ¸¸æˆå°±éœ€è¦å›æ»šåˆ°å‡ºé—®é¢˜å‰çš„ç‰ˆæœ¬, è¿™æ ·å°±éœ€è¦å¯¹æ•´ä¸ªå®ä¾‹è¿›è¡Œå›æ»š.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.103030303030303&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/y7l9KJ42n2yyhy0EzXVHEGPK6GK15YvdyeOshdBrFwDBDdNDAlSWs4MsJ94utu9oIoP4YB0tIb2FA4k9mMfrjg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;png&quot; data-w=&quot;990&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;å®˜æ–¹MySQL ç”±äºæ˜¯å•æœºæ¶æ„, é‚£ä¹ˆå¸¸è§çš„å¤‡ä»½æ–¹æ³•æ˜¯é€šè¿‡Xtrabackup å·¥å…·, å°†æ•°æ®å¤‡ä»½åˆ°æœ¬åœ°ä»¥å, å¦‚æœæœ¬åœ°ç©ºé—´ä¸å¤Ÿ, å°±éœ€è¦ä¸Šä¼ åˆ°OSS ç­‰è¿œç«¯å­˜å‚¨ä¸­. é€šå¸¸é€šè¿‡Xtrabackup å¤‡ä»½å·¥å…·éƒ½éœ€è¦1h å·¦å³, å¦‚æœéœ€è¦å°†æ•°æ®ä¸Šä¼ åˆ°è¿œç«¯é‚£ä¹ˆæ—¶é—´å°±æ›´é•¿äº†.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;PolarDB æ˜¯å¤©ç„¶çš„è®¡å­˜åˆ†ç¦»çš„æ¶æ„, é‚£ä¹ˆå¤‡ä»½çš„æ—¶å€™é€šè¿‡åº•ä¸‹åˆ†å¸ƒå¼å­˜å‚¨çš„å¿«ç…§èƒ½åŠ›, å¤‡ä»½å¯ä»¥ä¸è¶…è¿‡30s, å°†å¤‡ä»½æ—¶é—´å¤§å¤§ç¼©çŸ­äº†.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;æ ¸å¿ƒæ€è·¯æ˜¯é‡‡ç”¨Redirect-on-Write æœºåˆ¶, æ¯æ¬¡åˆ›å»ºå¿«ç…§å¹¶æ²¡æœ‰çœŸæ­£Copyæ•°æ®, åªæœ‰å»ºç«‹å¿«ç…§ç´¢å¼•, å½“æ•°æ®å—åæœŸæœ‰ä¿®æ”¹(Write)æ—¶æ‰æŠŠå†å²ç‰ˆæœ¬ä¿ç•™ç»™Snapshot, ç„¶åç”Ÿæˆæ–°çš„æ•°æ®å—, è¢«åŸæ•°æ®å¼•ç”¨(Redirect).&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;å¦å¤–ä¸€ç§åœºæ™¯æ˜¯, åœ¨æ¸¸æˆè¡Œä¸šä¸­, æœ‰å¯èƒ½æŸä¸€ä¸ªç©å®¶çš„è£…å¤‡è¢«ç›—å·äº†, é‚£ä¹ˆç©å®¶å°±ä¼šæ‰¾æ¸¸æˆçš„è¿è¥äººå‘˜æŠ•è¯‰, è¿è¥äººå‘˜ä¼šæ‰¾åˆ°æ¸¸æˆè¿ç»´äººå‘˜, å¸®å¿™æŸ¥è¯¢ç©å®¶çš„å†å²æ•°æ®.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ç¬”è€…ä¹‹å‰å°±é‡åˆ°æŸè‘—åæ¸¸æˆå¤šä¸ªç©å®¶è¢«ç›—å·, ç„¶åè¿ç»´äººå‘˜ç»å¸¸éœ€è¦é€šè¿‡PolarDB æŒ‰æ—¶é—´çš„è¿˜åŸçš„èƒ½åŠ›æ¢å¤å‡ºæŸå¤šä¸ªä¸åŒæ—¶é—´ç‚¹çš„å®ä¾‹, ç”¨æ¥æŸ¥è¯¢è¿™ä¸ªç©å®¶çš„å…·ä½“è£…å¤‡ä¿¡æ¯, åŒæ—¶ç”±äºç©å®¶å¯¹ç›—å·çš„æ—¶é—´ä¹Ÿä¸å‡†ç¡®, ç»å¸¸æœ‰æ—¶å€™éœ€è¦è¿˜åŸå‡ºå¤šä¸ªå®ä¾‹æ‰å¯ä»¥.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;é’ˆå¯¹è¿™æ ·çš„åœºæ™¯, PolarDB æ¨å‡ºäº†Flashback Query, å°±å¯ä»¥åœ¨å½“å‰å®ä¾‹æŸ¥è¯¢å‡ºä»»æ„æ—¶é—´ç‚¹çš„å†å²æ•°æ®. å…·ä½“åŸç†è§æ–‡ç«  Flashback Query&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.3859964093357271&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/y7l9KJ42n2yyhy0EzXVHEGPK6GK15Yvdru5WTGZPF1Cco4LFks5Ag4N86ZBP1ibicnxYl2E1Xgf4g4G7TGbX3jow/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;png&quot; data-w=&quot;1114&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;æ•´ä½“è€Œè¨€, PolarDB å»ºç«‹äº†ä¸€å¥—éå¸¸å®Œå–„çš„å¤‡ä»½æ¢å¤èƒ½åŠ›, ä»åº“=&amp;gt;è¡¨=&amp;gt;è¡Œä¸‰ä¸ªç»´åº¦æ»¡è¶³çš„æ¸¸æˆè¡Œä¸šå¯¹å¤‡ä»½æ¢å¤çš„éœ€æ±‚.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.5993485342019544&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/y7l9KJ42n2yyhy0EzXVHEGPK6GK15YvdmM5r2ibK5ibTplyhgrYodcpjJ6icsZiaMqoEp8xMOSaOQM337tImg2gUHg/640?wx_fmt=png&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot; data-type=&quot;png&quot; data-w=&quot;1228&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;å†™å…¥æ€§èƒ½&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;æ¸¸æˆè¡Œä¸šä½¿ç”¨æ•°æ®åº“çš„æ–¹å¼ä¹Ÿä¸å…¶ä»–è¡Œä¸šæœ‰è¾ƒå¤§åŒºåˆ«, æ˜¯ä¸€ç§éå¸¸å¼±Schema çš„ä½¿ç”¨æ–¹å¼, å…¶ä»–è¡Œä¸šé€šå¸¸å¯¹ä¸šåŠ¡ç»å¸¸æŠ½è±¡, å»ºç«‹è¡¨ç»“æ„, æ¯ä¸ªå­—æ®µå°½å¯èƒ½å°, ä¸å»ºè®®æœ‰å¤§å­—æ®µ, æœ‰å¤§å­—æ®µå°½å¯èƒ½è¿›è¡Œæ‹†å°ç­‰ç­‰.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ä½†æ˜¯åœ¨æ¸¸æˆè¡Œä¸šä¸­, ç”±äºéœ€è¦æ»¡è¶³æ¸¸æˆå¿«é€Ÿè¿­ä»£å‘å±•çš„éœ€æ±‚, ç©å®¶çš„è£…å¤‡ä¿¡æ¯ç»“æ„éå¸¸å¤æ‚, å› æ­¤å¸¸è§çš„åšæ³•æ˜¯å°†ç©å®¶è£…å¤‡ç­‰çº§ä¿¡æ¯ä¿å­˜åœ¨ä¸€ä¸ªå¤§çš„blobå­—æ®µä¸­, è¿™ä¸ªblobå­—æ®µé€šè¿‡proto_buf æˆ–è€… json è¿›è¡Œç¼–è§£ç , æ¯æ¬¡åœ¨è·å¾—è£…å¤‡æˆ–è€…å‡çº§ä»¥å, å°±è¿›è¡Œæ•´ä¸ªå­—æ®µæ›´æ–°, Â åœ¨æ¸¸æˆå¼€æœåˆæœŸç©å®¶æ•°æ®é•¿åº¦è¾ƒçŸ­, è€Œéšç€æ¸¸æˆç‰ˆæœ¬æ›´æ–°ç‰ˆæœ¬, æ¸¸æˆå‰§æƒ…, è¿è¥æ´»åŠ¨çš„å¢å¤š, ç›¸å¯¹äºæ¸¸æˆå¼€æœåˆæœŸçš„æ•°KB, blobå­—æ®µçš„é•¿åº¦å¯èƒ½ä¼šè†¨èƒ€åˆ°æ•°ç™¾KB, ç”šè‡³è¾¾åˆ°MBçº§åˆ«, å› æ­¤å¯èƒ½åªæ˜¯è·å¾—ä¸€ä¸ªè£…å¤‡, å°±éœ€è¦å‘æ•°æ®åº“å†™å…¥æ•°ç™¾KB å¤§å°çš„æ•°æ®, è¿™æ ·çš„å†™æ”¾å¤§å…¶å®éå¸¸ä¸åˆç†.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ç›®å‰ä¹Ÿæœ‰åƒMongoDB è¿™æ ·çš„æ–‡æ¡£æ•°æ®åº“, è®©ç”¨æˆ·å†™å…¥çš„æ—¶å€™ä»…ä»…æ›´æ–°æŸä¸ªå­—æ®µ, ä»è€Œå‡å°‘å†™æ”¾å¤§. ä½†æ˜¯è¿™æ ·å½±å“äº†ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯, éœ€è¦ç”¨æˆ·åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šè¿›è¡Œä¿®æ”¹, è¿™æ˜¯å¿«é€Ÿå‘å±•çš„æ¸¸æˆè¡Œä¸šæ‰€ä¸èƒ½æ¥å—çš„, æ‰€ä»¥ç¬”è€…çœ‹åˆ°å°½ç®¡æœ‰å®¢æˆ·å› ä¸ºå†™å…¥é—®é¢˜è½¬å‘äº†MongoDB, ä½†æ˜¯å…¶å®ä¸å¤š.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;PolarDB é’ˆå¯¹è¿™æ ·çš„æƒ…å†µå°½å¯èƒ½æ»¡è¶³ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯, åœ¨æ•°æ®åº“å†…æ ¸å±‚é¢ä¼˜åŒ–æ•°æ®åº“çš„å†™å…¥èƒ½åŠ›. é€šè¿‡ partition redo log, redo log cache, undo log readahead, Â early lock release, no blob latch ç­‰ç­‰èƒ½åŠ›å°†å†™å…¥èƒ½åŠ›å……åˆ†ä¼˜åŒ–. å…·ä½“åŸç†å¯ä»¥å‚è€ƒæˆ‘ä»¬å†…æ ¸æœˆæŠ¥ å’Œä¹‹å‰çš„æ–‡ç« PolarDB-cloudjump é’ˆå¯¹æ¸¸æˆåœºæ™¯, æˆ‘ä»¬ä¿®æ”¹äº† sysbench å·¥å…·, æ¨¡æ‹Ÿæ¸¸æˆè¡Œä¸šä¸­å¤§Blob æ›´æ–°çš„workload, æ”¾åœ¨ game-sysbench å·¥å…·ä¸­, åç»­æˆ‘ä»¬è¿˜ä¼šå°†æ›´å¤šè¡Œä¸šæ¯”å¦‚Saas, ç”µå•†ç­‰ç­‰è¡Œä¸šçš„workload æ”¾åœ¨è¿™ä¸ªå·¥å…·ä¸­.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;åœ¨game_blob_update workload ä¸­, å¦‚æœç©å®¶çš„å¹³å‡è£…å¤‡ä¿¡æ¯æ˜¯ 300kb, æˆ‘ä»¬å¯¹æ¯”äº†PolarDB VS aurora VS è‡ªå»ºMySQL çš„æ•°æ®&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;PolarDB 8.0 ç›¸å¯¹æœ‰æœ€é«˜çš„QPS 1877.44, å³°å€¼QPSæœ€é«˜å¯ä»¥åˆ°2000, CPU boundåœºæ™¯PolarDBçš„æ€§èƒ½å¤§æ¦‚æ˜¯Auroraçš„5.7å€, æ˜¯è‡ªå»º MySQL æœ¬åœ°ç›˜çš„3å€. IO boundåœºæ™¯PolarDBçš„æ€§èƒ½æ˜¯Auroraçš„15å€.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;CPU boundåœºæ™¯ï¼š&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;DB&lt;/th&gt;&lt;th&gt;å¹¶å‘æ•°æ®&lt;/th&gt;&lt;th&gt;QPS&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;PolarDB 8.0&lt;/td&gt;&lt;td&gt;5&lt;/td&gt;&lt;td&gt;1877.44&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;MySQL 8.0 æœ¬åœ°ç›˜&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;&lt;td&gt;600.22&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Aurora 8.0&lt;/td&gt;&lt;td&gt;200&lt;/td&gt;&lt;td&gt;328.47&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;IO boundåœºæ™¯ï¼š&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;DB&lt;/th&gt;&lt;th&gt;å¹¶å‘æ•°æ®&lt;/th&gt;&lt;th&gt;QPS&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;PolarDB 8.0&lt;/td&gt;&lt;td&gt;200&lt;/td&gt;&lt;td&gt;1035.30&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;MySQL 8.0 æœ¬åœ°ç›˜&lt;/td&gt;&lt;td&gt;200&lt;/td&gt;&lt;td&gt;610&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Aurora 8.0&lt;/td&gt;&lt;td&gt;200&lt;/td&gt;&lt;td&gt;69.15&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;è·¨region å®¹ç¾&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;ç›®å‰æ¸¸æˆè¡Œä¸šçº·çº·å‡ºæµ·, åŒ…å«äº†æ¸¸æˆæœå’Œå¹³å°æœ. ç”¨æˆ·åœ¨è‡ªå»ºMySQL/RDS çš„åœºæ™¯ä¸­, Â ç”¨æˆ·å¯èƒ½éœ€è¦åœ¨å¦å¤–ä¸€ä¸ªregion å»ºç«‹ä¸€ä¸ªæ–°çš„å®ä¾‹, ç„¶åé€šè¿‡åŒæ­¥å·¥å…·æˆ–è€…DTS è¿›è¡Œè·¨region å¤‡ä»½. ç”¨æˆ·éœ€è¦å¤„ç†region é”™è¯¯åœºæ™¯å¦‚ä½•è¿›è¡Œåˆ‡æ¢ç­‰ç­‰.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ç¬”è€…è®¤ä¸ºå¯¹æ•°æ®åº“è€Œè¨€, ç¨³å®šæ€§ &amp;gt; æ˜“ç”¨æ€§ &amp;gt; æ€§èƒ½.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;åœ¨è¿™ä¸ªåœºæ™¯ä¸­, ç”¨æˆ·å¦‚æœä½¿ç”¨äº‘å‚å•†çš„è¯, ä½¿ç”¨çš„æ˜¯äº‘å‚å•†æä¾›çš„åŸå­èƒ½åŠ›, è‡ªå·±é€šè¿‡ç»„è£…è¿™äº›åŸå­èƒ½åŠ›å®ç°å®¹ç¾çš„éœ€æ±‚, è€ŒPolarDB é’ˆå¯¹è¿™æ ·åœºæ™¯æå‡ºæ¥PolarDB GlobalDataba çš„è§£å†³æ–¹æ¡ˆ, å°†è·¨region çš„å®¹ç¾æ”¾åœ¨è§£å†³æ–¹æ¡ˆä¸­, æä¾›äº†ä¸€ä¸ªæ›´åŠ æ˜“å®¹çš„è§£å†³æ–¹æ¡ˆ, ä»è€Œç”¨æˆ·å¯ä»¥å…³æ³¨è‡ªèº«çš„ä¸šåŠ¡é€»è¾‘, è€Œä¸éœ€è¦å¤„ç†è¿™äº›å®¹ç¾çš„åœºæ™¯.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;åœ¨å…·ä½“è·¨region çš„åŒæ­¥åœºæ™¯æ–¹æ¡ˆä¸­, PolarDB æ˜¯é€šè¿‡å¤šé€šé“ç‰©ç†å¤åˆ¶èƒ½åŠ›, ä»è€Œä¿è¯è·¨region çš„å®¹ç¾åœ¨1s ä»¥å†….&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;Links:&lt;/p&gt;&lt;p&gt;game-sysbench:Â https://github.com/baotiao/game-sysbench&lt;/p&gt;&lt;p&gt;PolarDB-cloudjump:Â https://zhuanlan.zhihu.com/p/535426034&lt;/p&gt;&lt;p&gt;Flashback-Query:Â https://zhuanlan.zhihu.com/p/434466612&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;å‚è€ƒé˜…è¯»ï¼š&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;p&gt;&lt;span&gt;æœ¬æ–‡ç”±é«˜å¯ç”¨æ¶æ„è½¬è½½ã€‚æŠ€æœ¯åŸåˆ›åŠæ¶æ„å®è·µæ–‡ç« ï¼Œæ¬¢è¿é€šè¿‡å…¬ä¼—å·èœå•ã€Œè”ç³»æˆ‘ä»¬ã€è¿›è¡ŒæŠ•ç¨¿ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;â€&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzAwMDU1MTE1OQ==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapONl06YmHad4csRU93kcbJ76JIWzEAmOSVooibFHHkzfWzzkc7dpU4H06Wp9F6Z687vIghdawxvl47A/0?wx_fmt=png&quot; data-nickname=&quot;é«˜å¯ç”¨æ¶æ„&quot; data-alias=&quot;ArchNotes&quot; data-signature=&quot;é«˜å¯ç”¨æ¶æ„å…¬ä¼—å·ã€‚&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;â€&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;â€&lt;/span&gt;&lt;/p&gt;
          &lt;/div&gt;

          

          



           
                                
                    
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>e41226234125f97244c368afa2f04c56</guid>
<title>å…³äºHTTPåè®®é‚£äº›äº‹</title>
<link>https://toutiao.io/k/xvdtkbe</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h5 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ä½œè€…ç®€ä»‹&lt;span/&gt;&lt;/h5&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;å¼ å€©ï¼šçˆ±ç”Ÿæ´»ï¼Œçˆ±ç¾é£Ÿï¼Œç«‹å¿—æˆä¸ºä¸€æšå®‰é™ä¼˜é›…å°åƒè´§&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span&gt;å‰è¨€&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯´åˆ°httpåè®®ï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½ä¸é™Œç”Ÿã€‚æ¯•ç«Ÿæ˜¯è·Ÿå·¥ä½œæ¯æ¯ç›¸å…³çš„ï¼Œæƒ³ç€å¥½å¥½æ·±å…¥ä¸€ä¸‹ï¼Œæ­£å¥½çœ‹åˆ°äº†ç½—è€å¸ˆçš„ã€Šé€è§†HTTPåè®®ã€‹ï¼Œä¹Ÿç®—æ˜¯è¯´é€äº†æ‰ç¢äº†ï¼Œè®²çš„æ˜æ˜ç™½ç™½ã€‚ä¸‹é¢å°±é‡Œé¢çš„å†…å®¹åšäº†è¿™ç¯‡å­¦ä¹ æ€»ç»“&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.2195121951219512&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmA0xs3aNMDscdicB7ayZGCNcZjFE5oeoIxoCwtSIeqM7PnayCZxhynI8g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1640&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¼€å§‹ä¹‹å‰å…ˆæŠ›å‡ºå‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;æ˜¯ä»€ä¹ˆåœ¨ä¿ƒè¿›HTTPçš„å‘å±•ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;postè¯·æ±‚æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç¼“å­˜åœ¨æµè§ˆå™¨networkä¸­çš„ä½“ç°ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;HTTPçš„å¤§æ–‡ä»¶ä¼ è¾“ï¼Ÿä¸€åˆ‡éƒ½åœ¨å‘å±•ï¼Œæƒ³æƒ³æ›´å¥½çš„æ–¹æ¡ˆ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;HTTPåè®®è·ŸTCP/IPåè®®æ ˆçš„å…³ç³»&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸‹é¢å°±å¼€å§‹å” äº†ï½ï½ï½&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span&gt;HTTP å‘å±•å²&lt;/span&gt;&lt;/h2&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5078468298807282&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAQewOXxcPLPoUxYMmzPxZveVUrFhGSfBcJicBzQsqrZ0BSsRw0AnlMZg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1593&quot;/&gt;&lt;figcaption&gt;httpå‘å±•å²&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;HTTP çš„å‘å±•å†ç¨‹&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;HTTP/0.9ï¼ˆ90å¹´ä»£åˆï¼‰&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å—é™äºå½“æ—¶çš„å¤§ç¯å¢ƒï¼Œåªæ”¯æŒgetçš„çº¯æ–‡æœ¬ä¼ è¾“ï¼Œåå®šä¹‰ä¸ºHTTP/0.9 --- æ˜¯å°èŒƒå›´çš„è¯•ç‚¼&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;HTTP/1.0(93å¹´)&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¾—ç›ŠäºjpegåŠmp3ç­‰æ•°æ®æ ¼å¼çš„é—®ä¸–ï¼Œç”¨æˆ·æœŸå¾…å›¾æ–‡å¹¶èŒ‚çš„ç½‘é¡µ --- å°æœ‰æˆå°±&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;å¢åŠ äº† HEADã€POST ç­‰æ–°æ–¹æ³•ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¢åŠ äº†å“åº”çŠ¶æ€ç ï¼Œæ ‡è®°å¯èƒ½çš„é”™è¯¯åŸå› ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¼•å…¥äº†åè®®ç‰ˆæœ¬å·æ¦‚å¿µï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¼•å…¥äº† HTTP Headerï¼ˆå¤´éƒ¨ï¼‰çš„æ¦‚å¿µï¼Œè®© HTTP å¤„ç†è¯·æ±‚å’Œå“åº”æ›´åŠ çµæ´»ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä¼ è¾“çš„æ•°æ®ä¸å†ä»…é™äºæ–‡æœ¬ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;HTTP/1.1ï¼ˆ99å¹´ï¼‰&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç»å†äº†ç¬¬ä¸€æ¬¡æµè§ˆå™¨å¤§æˆ˜çš„HTTP/1.0æ‰›ä½å‹åŠ›ï¼Œæ¨åŠ¨äº†httpçš„è¿›ä¸€æ­¥å®Œå–„ã€‚--- ç ´èŒ§æˆè¶ï¼Œæ­£å¼æˆä¸ºæ ‡å‡†ï¼ˆRFC 2616ï¼‰&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;å¢åŠ äº† PUTã€DELETE ç­‰æ–°çš„æ–¹æ³•ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¢åŠ äº†ç¼“å­˜ç®¡ç†å’Œæ§åˆ¶ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ˜ç¡®äº†è¿æ¥ç®¡ç†ï¼Œå…è®¸æŒä¹…è¿æ¥ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å…è®¸å“åº”æ•°æ®åˆ†å—ï¼ˆchunkedï¼‰ï¼Œåˆ©äºä¼ è¾“å¤§æ–‡ä»¶ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¼ºåˆ¶è¦æ±‚ Host å¤´ï¼Œè®©äº’è”ç½‘ä¸»æœºæ‰˜ç®¡æˆä¸ºå¯èƒ½ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸è¿‡ç”±äº HTTP/1.1 å¤ªè¿‡åºå¤§å’Œå¤æ‚ï¼Œæ‰€ä»¥åœ¨ 2014 å¹´åˆåšäº†ä¸€æ¬¡ä¿®è®¢ï¼ŒåŸæ¥çš„ä¸€ä¸ªå¤§æ–‡æ¡£è¢«æ‹†åˆ†æˆäº†å…­ä»½è¾ƒå°çš„æ–‡æ¡£ï¼Œç¼–å·ä¸º 7230-7235ï¼Œä¼˜åŒ–äº†ä¸€äº›ç»†èŠ‚ï¼Œä½†æ­¤å¤–æ²¡æœ‰ä»»ä½•å®è´¨æ€§çš„æ”¹åŠ¨ã€‚&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;æ›´ä¸Šä¸€å±‚æ¥¼ï¼ŒHTTP/2ï¼ˆ2015å¹´ï¼‰&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;â€œæŒŸç”¨æˆ·ä»¥å·ä»¤å¤©ä¸‹â€ï¼ŒGoogle å€Ÿæ­¤é¡ºåŠ¿æŠŠ SPDY æ¨ä¸Šäº†æ ‡å‡†çš„å®åº§ï¼Œäº’è”ç½‘æ ‡å‡†åŒ–ç»„ç»‡ä»¥ SPDY ä¸ºåŸºç¡€å¼€å§‹åˆ¶å®šæ–°ç‰ˆæœ¬çš„ HTTP åè®®ï¼Œæœ€ç»ˆåœ¨ 2015 å¹´å‘å¸ƒäº† HTTP/2ï¼ŒRFC ç¼–å· 7540ã€‚&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;äºŒè¿›åˆ¶åè®®ï¼Œä¸å†æ˜¯çº¯æ–‡æœ¬ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¯å‘èµ·å¤šä¸ªè¯·æ±‚ï¼ŒåºŸå¼ƒäº† 1.1 é‡Œçš„ç®¡é“ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä½¿ç”¨ä¸“ç”¨ç®—æ³•å‹ç¼©å¤´éƒ¨ï¼Œå‡å°‘æ•°æ®ä¼ è¾“é‡ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å…è®¸æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¢å¼ºäº†å®‰å…¨æ€§ï¼Œâ€œäº‹å®ä¸Šâ€è¦æ±‚åŠ å¯†é€šä¿¡ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;è¿½æ±‚æè‡´ï¼ŒHTTP/3&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸€æ¬¡è¿˜æ˜¯Googleï¼Œè€Œä¸”å®ƒè¦â€œé©è‡ªå·±çš„å‘½â€ã€‚2018 å¹´ï¼Œäº’è”ç½‘æ ‡å‡†åŒ–ç»„ç»‡ IETF æè®®å°†â€œHTTP over QUICâ€æ›´åä¸ºâ€œHTTP/3â€å¹¶è·å¾—æ‰¹å‡†ï¼ŒHTTP/3 æ­£å¼è¿›å…¥äº†æ ‡å‡†åŒ–åˆ¶è®¢é˜¶æ®µã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ç»“åˆå‘å±•å²çš„æ€»ç»“&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;ä»æ— åˆ°æœ‰&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä»ç®€å•åˆ°å¤æ‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä»å®ç°åˆ°ä¸æ–­çš„ä¼˜åŒ–æ‰©å±•&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä»æ— äººçŸ¥æ™“åˆ°æ— äººä¸æ™“&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è¿½æ±‚å®‰å…¨ã€é«˜é€Ÿã€ä¾¿æ·çš„ä¼ è¾“&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ç»¼ä¸Šï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸‹ç¬¬ä¸€ä¸ªé—®é¢˜äº†ï¼Œä½ è§‰å¾—å‘¢?
æœ‰å…´è¶£çš„å¯ä»¥å»çœ‹å‚è€ƒèµ„æ–™é‡Œçš„åè®®è¯¦è§£ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;3&lt;/span&gt;&lt;/span&gt;&lt;span&gt;HTTP çš„æŠ¥æ–‡&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å®¢æˆ·ç«¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3997050147492625&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAQWlwiaefJOsae4oqSWHGicIOnZE43y9SGaMdyUiaSdHzUvpHL37ibG0lbw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1356&quot;/&gt;&lt;figcaption&gt;è¯·æ±‚è¡Œ GET / HTTP/1.1&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;æœåŠ¡ç«¯&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.42668621700879766&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmA8LBUNCibDXicb4cMQXlo5u2RPxqnNp00MaQXELVblUuZk2w2shZXe9dg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1364&quot;/&gt;&lt;figcaption&gt;çŠ¶æ€è¡Œ HTTP/1.1 200 OK&lt;/figcaption&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å…³äºå¤´å­—æ®µ&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;HTTP åè®®è§„å®šäº†éå¸¸å¤šçš„å¤´éƒ¨å­—æ®µï¼Œå®ç°å„ç§å„æ ·çš„åŠŸèƒ½ï¼Œä½†åŸºæœ¬ä¸Šå¯ä»¥åˆ†ä¸ºå››å¤§ç±»ï¼š&lt;/p&gt;&lt;/blockquote&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;é€šç”¨å­—æ®µï¼šåœ¨è¯·æ±‚å¤´å’Œå“åº”å¤´é‡Œéƒ½å¯ä»¥å‡ºç°ï¼›Date Cache-Controlï¼Œ Connectionï¼ŒDateï¼ŒPragmaï¼ŒTransfer-Encodingï¼ŒUpgrade&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è¯·æ±‚å­—æ®µï¼šä»…èƒ½å‡ºç°åœ¨è¯·æ±‚å¤´é‡Œï¼Œè¿›ä¸€æ­¥è¯´æ˜è¯·æ±‚ä¿¡æ¯æˆ–è€…é¢å¤–çš„é™„åŠ æ¡ä»¶ï¼›Hostï¼ŒUser-Agent,Referer Accept Accept-Charset Accept-Encoding Accept-Language, Authorization,Expect,From,If-Match,If-Modified-Since,If-None-Match,If-Range,If-Unmodified-Since,Max-Forwards, Rangeç­‰&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å“åº”å­—æ®µï¼šä»…èƒ½å‡ºç°åœ¨å“åº”å¤´é‡Œï¼Œè¡¥å……è¯´æ˜å“åº”æŠ¥æ–‡çš„ä¿¡æ¯ï¼›Accept-Ranges,Ageï¼ŒETagï¼ŒLocationï¼ŒProxy-Authenticateï¼ŒRetry-Afterï¼ŒServerï¼ŒVaryç­‰&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å®ä½“å­—æ®µï¼šå®ƒå®é™…ä¸Šå±äºé€šç”¨å­—æ®µï¼Œä½†ä¸“é—¨æè¿° body çš„é¢å¤–ä¿¡æ¯ã€‚Content-Lengthï¼ŒAllowï¼ŒContent-Encodingï¼ŒContent-Languageï¼Œ Content-Lengthï¼ŒContent-Locationï¼ŒContent-MD5ï¼ŒContent-Rangeï¼ŒContent-Typeï¼ŒExpiresï¼ŒLast-Modified&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;æ³¨æ„ï¼š1ï¼Œè¯·æ±‚å¤´çš„é™åˆ¶ï¼šå„ä¸ªwebæœåŠ¡å™¨éƒ½ä¸å…è®¸è¿‡å¤§çš„è¯·æ±‚å¤´ï¼Œå› ä¸ºå¤´éƒ¨å¤ªå¤§å¯èƒ½ä¼šå ç”¨å¤§é‡çš„æœåŠ¡å™¨èµ„æºï¼Œå½±å“è¿è¡Œæ•ˆç‡ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;apache2æ¥è¯´ï¼Œå®ƒé»˜è®¤å€¼æ˜¯8kï¼›Apacheé‡Œï¼Œå¯æŒ‰ä¸‹é¢æ–¹å¼è°ƒæ•´ï¼šLimitRequestLine è¯·æ±‚è¡Œçš„å­—èŠ‚æ•°
LimitRequestFields Â è¯·æ±‚å¤´åŸŸçš„ä¸ªæ•° é»˜è®¤å€¼100
LimitRequestFieldSize é…ç½®å…è®¸çš„è¯·æ±‚å¤´å­—èŠ‚å¤§å° é»˜è®¤å€¼æ˜¯8190
nginxé»˜è®¤çš„headeré•¿åº¦ä¸Šé™æ˜¯4kï¼Œä¹Ÿå¯æ ¹æ®æƒ…å†µé…ç½®ï¼Œå¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼šclient_header_buffer_size 16k;
large_client_header_buffers 4 16k;&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;2ï¼Œå¦‚æœheaderå¤´ä¿¡æ¯è¯·æ±‚è¶…è¿‡äº†ï¼Œnginxä¼šç›´æ¥è¿”å›400é”™è¯¯
3ï¼Œå…³äºå¤´å­—æ®µå¤§å°å†™ï¼Œå°½é‡é¦–å­—æ¯å¤§å†™
4ï¼Œå­—æ®µåé‡Œä¸å…è®¸å‡ºç°ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨è¿å­—ç¬¦â€œ-â€ï¼Œä½†ä¸èƒ½ä½¿ç”¨ä¸‹åˆ’çº¿â€œ_â€ Â ã€‚å¦åˆ™å“åº” ï¼ˆ400 Bad Requestï¼‰&lt;/p&gt;&lt;/blockquote&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ç»¼ä¸Šï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸‹ç¬¬äºŒä¸ªé—®é¢˜äº†ï¼Œpostè¯·æ±‚æ˜¯éœ€è¦å‘æœåŠ¡ç«¯æäº¤æ•°æ®çš„ï¼Œå¯è¦ç»“åˆå®ä½“å­—æ®µï½
æœ‰å…´è¶£çš„åœ¨è·Ÿåç«¯è”è°ƒæ—¶æŠ“åŒ…çœ‹çœ‹å§&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;4&lt;/span&gt;&lt;/span&gt;&lt;span&gt;HTTP çš„ç¼“å­˜æœºåˆ¶&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;HTTP/1.0æä¾›äº†PragmaåŠExpiresçš„ç¼“å­˜å­—æ®µï¼Œåˆ°HTTP/1.1æ‰©å±•äº†æ›´å¤šå¤´å­—æ®µCache-Controlã€Last-Modified / If-Modified-Sinceï¼Œ Etag / If-None-Matchç­‰ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ä¸ºä»€ä¹ˆç”¨ç¼“å­˜&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨ä¼ è¾“ä¸­é—´æœ‰å…¶ä»–å¤‡ä»½ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å»æœåŠ¡å™¨è¯·æ±‚ï¼Œé“¾è·¯æ›´çŸ­å“åº”æ›´è¿…é€Ÿã€‚ä¹Ÿå°±æ˜¯ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;å‡å°‘äº†å†—ä½™çš„æ•°æ®ä¼ è¾“ï¼ŒèŠ‚çœäº†ç½‘è´¹ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç¼“è§£äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œ å¤§å¤§æé«˜äº†ç½‘ç«™çš„æ€§èƒ½&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;åŠ å¿«äº†å®¢æˆ·ç«¯åŠ è½½ç½‘é¡µçš„é€Ÿåº¦&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;æ€ä¹ˆç¼“å­˜çš„&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;httpç¼“å­˜éƒ½æ˜¯ä»ç¬¬äºŒæ¬¡è¯·æ±‚å¼€å§‹çš„ã€‚ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æºæ—¶ï¼ŒæœåŠ¡å™¨è¿”å›èµ„æºï¼Œå¹¶åœ¨respone headerå¤´ä¸­å›ä¼ èµ„æºçš„ç¼“å­˜å‚æ•°ï¼›ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨åˆ¤æ–­è¿™äº›è¯·æ±‚å‚æ•°ï¼Œå‘½ä¸­å¼ºç¼“å­˜å°±ç›´æ¥200ï¼Œå¦åˆ™å°±æŠŠè¯·æ±‚å‚æ•°åŠ åˆ°request headerå¤´ä¸­ä¼ ç»™æœåŠ¡å™¨ï¼Œçœ‹æ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼Œå‘½ä¸­åˆ™è¿”å›304ï¼Œå¦åˆ™æœåŠ¡å™¨ä¼šè¿”å›æ–°çš„èµ„æºã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ä»ç½‘ä¸ŠæŠ“äº†å¼ å›¾ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;/blockquote&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.1015873015873017&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAb3ZuKqjCf1V87Eico0wyWRlw8nQQaKX9KtZEefm9aCia9d9pXI0WKBaA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1260&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦ä¸€å¼ å›¾ï¼Œä¸ä¿¡ä½ è¿˜ä¸æ‡‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6037514654161782&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/l7qvliaicFcd6SypgIYmFXotucODES1wmACd7iajRPJUkeH2PuQyyFuboWj6ICCNsy6Gs8tSzsrjLb0XyPDw3RlBA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1706&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å¼ºç¼“å­˜ä¸åå•†ç¼“å­˜&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.432520325203252&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAibiaEc6cxJ3PBkUxKicJ7u1jWg58D8MTTEQlholleRHsYlUOr6yFjV3aA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1230&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;chromeæµè§ˆå™¨ï¼š&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;200 from memory cache ä¸è®¿é—®æœåŠ¡å™¨ï¼Œç›´æ¥è¯»ç¼“å­˜ï¼Œä»å†…å­˜ä¸­è¯»å–ç¼“å­˜ã€‚æ­¤æ—¶çš„æ•°æ®æ˜¯ç¼“å­˜åˆ°å†…å­˜ä¸­çš„ï¼Œå½“killè¿›ç¨‹åï¼Œæ•°æ®å°†ä¸å­˜åœ¨
200 from disk cache ä¸è®¿é—®æœåŠ¡å™¨ï¼Œç›´æ¥è¯»ç¼“å­˜ï¼Œä»ç£ç›˜ä¸­è¯»å–ç¼“å­˜ï¼Œå½“killè¿›ç¨‹æ—¶ï¼Œæ•°æ®è¿˜æ˜¯å­˜åœ¨ã€‚304 Not Modified è®¿é—®æœåŠ¡å™¨ï¼Œå‘ç°æ•°æ®æ²¡æœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨è¿”å›æ­¤çŠ¶æ€ç ã€‚ç„¶åä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‘½ä¸­å¼ºåˆ¶ç¼“å­˜æ—¶ï¼Œèµ„æºä¼šæ˜¾ç¤ºfrom memory cacheÂ orÂ from disk cache&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ç¼“å­˜ç›¸å…³çš„å¤´å­—æ®µ&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;é€šç”¨é¦–éƒ¨å­—æ®µ&lt;span/&gt;&lt;/h4&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;å­—æ®µåç§°&lt;/th&gt;&lt;th&gt;è¯´æ˜&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Pragma&lt;/td&gt;&lt;td&gt;&quot;no-cache&quot;è¡¨ç¤ºç¦ç”¨ç¼“å­˜ (HTTP/1.0)å·²åºŸå¼ƒ&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Cache-Control&lt;/td&gt;&lt;td&gt;no-store no-cache max-ageç­‰ï¼Œè¯·æ±‚å“åº”çš„å€¼é¡µæœ‰åŒºåˆ«&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;è¯·æ±‚é¦–éƒ¨å­—æ®µ&lt;span/&gt;&lt;/h4&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;å­—æ®µåç§°&lt;/th&gt;&lt;th&gt;è¯´æ˜&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;If-Modified-Since&lt;/td&gt;&lt;td&gt;æ¯”è¾ƒèµ„æºæœ€åçš„æ›´æ–°æ—¶é—´æ˜¯å¦ä¸€è‡´&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;If-Unmodified-Since&lt;/td&gt;&lt;td&gt;æ¯”è¾ƒèµ„æºæœ€åçš„æ›´æ–°æ—¶é—´æ˜¯å¦ä¸ä¸€è‡´&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;If-Match&lt;/td&gt;&lt;td&gt;æ¯”è¾ƒ ETag æ˜¯å¦ä¸€è‡´&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;If-None-Match&lt;/td&gt;&lt;td&gt;æ¯”è¾ƒ ETag æ˜¯å¦ä¸€è‡´&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å“åº”é¦–éƒ¨å­—æ®µ&lt;span/&gt;&lt;/h4&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;å­—æ®µåç§°&lt;/th&gt;&lt;th&gt;è¯´æ˜&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;ETag&lt;/td&gt;&lt;td&gt;èµ„æºçš„åŒ¹é…ä¿¡æ¯ï¼ˆé€šè¿‡å¼ºæ¯”è¾ƒç®—æ³•ç”Ÿæˆå€¼ï¼‰&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å®ä½“é¦–éƒ¨å­—æ®µ&lt;span/&gt;&lt;/h4&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;å­—æ®µåç§°&lt;/th&gt;&lt;th&gt;è¯´æ˜&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Expires&lt;/td&gt;&lt;td&gt;èµ„æºçš„è¿‡æœŸæ—¶é—´(HTTP/1.0)ï¼Œæœ‰å¼Šç«¯&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Last-Modified&lt;/td&gt;&lt;td&gt;èµ„æºçš„æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å…³äºCache-Control&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç½‘ä¸Šæ‰¾äº†å¼ å›¾ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ï½&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9100294985250738&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/l7qvliaicFcd6SypgIYmFXotucODES1wmAtsOx6TfzV2UU24t5ZuLBsJ21O1ANRiaOjhqQWgQb8dtzmTvLIl9nn8w/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1356&quot;/&gt;&lt;/figure&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ç»¼ä¸Šï¼Œå¤§å®¶å·¥ä½œçš„è¿‡ç¨‹ä¸­ä¹Ÿç•™æ„ä¸‹chromeçš„networkï¼Œç»“åˆæ€è€ƒä¸‹ï½&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;5&lt;/span&gt;&lt;/span&gt;&lt;span&gt;HTTP çš„å¤§æ–‡ä»¶ä¼ è¾“&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚ä½•åœ¨æœ‰é™çš„å¸¦å®½ä¸‹å¿«æ·çš„ä¼ è¾“å¤§æ–‡ä»¶å‘¢ï¼Ÿæ›´æœ‰æ•ˆçš„èŠ‚çœå†…å­˜ã€å¸¦å®½ç­‰èµ„æºã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;æ•°æ®å‹ç¼©ï¼ˆæŠŠå¤§æ–‡ä»¶æ•´ä½“å˜å°ï¼‰&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å®¢æˆ·ç«¯è¯·æ±‚æ—¶å¸¦ä¸ŠAccept-Encodingï¼ˆæ”¯æŒçš„å‹ç¼©æ–¹å¼ï¼‰ï¼Œå“åº”æ—¶æŒ‡å®šContent-Encodingï¼ˆæ­¤å“åº”çš„å‹ç¼©æ–¹å¼ï¼‰ï¼ŒæŒ‰æ­¤å‹ç¼©åå‘ç»™å®¢æˆ·ç«¯ã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;gzip ç­‰å‹ç¼©ç®—æ³•é€šå¸¸åªå¯¹æ–‡æœ¬æ–‡ä»¶æœ‰è¾ƒå¥½çš„å‹ç¼©ç‡ï¼Œè€Œå›¾ç‰‡ã€éŸ³é¢‘è§†é¢‘ç­‰å¤šåª’ä½“æ•°æ®æœ¬èº«å°±å·²ç»æ˜¯é«˜åº¦å‹ç¼©çš„ï¼Œæ•ˆæœä¸å¥½ã€‚åœ¨ Nginx é‡Œå°±ä¼šä½¿ç”¨â€œgzip onâ€æŒ‡ä»¤ï¼Œå¯ç”¨å¯¹â€œtext/htmlâ€çš„å‹ç¼©ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;åˆ†å—ä¼ è¾“&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;å¦‚æœå¤§æ–‡ä»¶æ•´ä½“ä¸èƒ½å˜å°ï¼Œé‚£å°±æŠŠå®ƒâ€œæ‹†å¼€â€ï¼Œåˆ†è§£æˆå¤šä¸ªå°å—ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;HTTPåè®®1.1ç‰ˆæœ¬æä¾›äº†åˆ†å¼€ä¼ è¾“æœºåˆ¶ï¼ˆChunked transfer encodingï¼‰ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯çš„â€åŒ–æ•´ä¸ºé›¶â€œï¼Œå³æŠŠå¤§æ–‡ä»¶æ‹†å¼€ï¼Œåˆ†æˆå¤šä¸ªå°å—æ¥ä¼ è¾“ã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;æ³¨æ„ï¼šHTTP/2 ä¸­å·²ç»ä¸æ”¯æŒ chunked è¿™ä¸€æ ¼å¼äº†ï¼Œå› ä¸ºå…¶æœ¬èº«æä¾›äº†æ›´åŠ é«˜çº§çš„æµæœºåˆ¶æ¥å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Transfer-Encoding&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ªå“åº”å¤´æœ‰ä¸‹é¢å‡ ä¸ªå€¼ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;chunkedï¼šæ•°æ®åˆ†å—å‘é€ã€‚æ­¤æ—¶åº”ç¼ºçœ Content-Length å“åº”å¤´ã€‚æ„æ€æ˜¯æŠ¥æ–‡é‡Œçš„ body éƒ¨åˆ†ä¸æ˜¯ä¸€æ¬¡æ€§å‘è¿‡æ¥çš„ï¼Œè€Œæ˜¯åˆ†æˆäº†è®¸å¤šçš„å—ï¼ˆchunkï¼‰é€ä¸ªå‘é€ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;compressï¼šä½¿ç”¨ Lempel-Ziv-Welch ç®—æ³•è¿›è¡Œä¼ è¾“çš„æ ¼å¼ï¼Œç›®å‰æ²¡æœ‰æµè§ˆå™¨åœ¨æ”¯æŒã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;deflateï¼šä½¿ç”¨ deflate å‹ç¼©ç®—æ³• zlib ç»“æ„ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;gzipï¼šä½¿ç”¨ Lempel-Ziv coding ç¼–ç çš„å‹ç¼©æ ¼å¼ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;identityï¼šæ ‡è¯†èº«ä»½å‡½æ•°ï¼ˆe.g. no compression, nor modificationï¼‰ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ä¹Ÿå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªå€¼ï¼Œç”¨é€—å·åˆ†éš”ï¼Œåƒè¿™æ ·ï¼šTransfer-Encoding: gzip, chunkedã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.56&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAZNLZhAbFsgpdRH6ibNtWaryxCTa3UNQyicZ6wJwhib0Ric7loicvIymMFQA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2000&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.56&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAhNGNcpAZiaW33uVpQWFsYVpjjYZmZuq8B5JnYysiaQqM1yic86tX7SlWA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2000&quot;/&gt;&lt;/figure&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.56&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmACeL7dlGqcudNE3HVq868KmDWBrAsjSrgsPEsxz5SX8E89QNGBSsNZw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2000&quot;/&gt;&lt;/figure&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;â€œTransfer-Encoding: chunkedâ€å’Œâ€œContent-Lengthâ€è¿™ä¸¤ä¸ªå­—æ®µæ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å“åº”æŠ¥æ–‡é‡Œè¿™ä¸¤ä¸ªå­—æ®µä¸èƒ½åŒæ—¶å‡ºç°ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;èŒƒå›´è¯·æ±‚&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;HTTPåè®®è¿˜æå‡ºäº†èŒƒå›´è¯·æ±‚ï¼ˆrange requestsï¼‰çš„æ¦‚å¿µã€‚å…è®¸å®¢æˆ·ç«¯åœ¨è¯·æ±‚å¤´é‡Œä½¿ç”¨ä¸“ç”¨å­—æ®µæ¥è¡¨ç¤ºåªè·å–æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œç›¸å½“äºæ˜¯å®¢æˆ·ç«¯çš„â€œåŒ–æ•´ä¸ºé›¶â€ã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;è¯•æƒ³ä½ æ­£åœ¨è¿½å‰§ï¼Œæƒ³æ‹–ç€çœ‹ï¼Œè¿™å®é™…ä¸Šæ˜¯æƒ³è·å–ä¸€ä¸ªå¤§æ–‡ä»¶å…¶ä¸­çš„ç‰‡æ®µæ•°æ®ï¼Œè€Œè¿™æ—¶å°±ç”¨åˆ°èŒƒå›´è¯·æ±‚äº†ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ç›¸å…³å¤´å­—æ®µ&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯·æ±‚å¤´Rangeæ˜¯ HTTP èŒƒå›´è¯·æ±‚çš„ä¸“ç”¨å­—æ®µï¼Œæ ¼å¼æ˜¯â€œbytes=x-yâ€ï¼Œå…¶ä¸­çš„ x å’Œ y æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„æ•°æ®èŒƒå›´ï¼›å“åº”å¤´é‡Œæœ‰â€œAccept-Ranges: bytesâ€æ ‡è¯†æœåŠ¡ç«¯æ”¯æŒèŒƒå›´è¯·æ±‚çš„ã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;è¯·æ±‚&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;bytes=x-y&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;è¡¨ç¤ºç¬¬äºŒä¸ª500å­—èŠ‚ï¼šbytes=500-999&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è¡¨ç¤ºæœ€å500ä¸ªå­—èŠ‚ï¼šbytes=-500&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è¡¨ç¤º500å­—èŠ‚ä»¥åçš„èŒƒå›´ï¼šbytes=500-&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå­—èŠ‚ï¼šbytes=0-0,-1&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;åŒæ—¶æŒ‡å®šå‡ ä¸ªèŒƒå›´ï¼šbytes=500-600,601-999&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;è¯·æ±‚æŠ¥æ–‡&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;GET /test HTTP/1.1&lt;br/&gt;&lt;br/&gt;Host: www.test.com&lt;br/&gt;&lt;br/&gt;Range: bytes=0-31&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;å“åº”æŠ¥æ–‡&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;HTTP/1.1 206 Partial Content&lt;br/&gt;&lt;br/&gt;Content-Length: 32&lt;br/&gt;&lt;br/&gt;Accept-Ranges: bytes&lt;br/&gt;&lt;br/&gt;Content-Range: bytes 0-31/96&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…ˆå‘ä¸ª HEADï¼Œçœ‹æœåŠ¡å™¨æ˜¯å¦æ”¯æŒèŒƒå›´è¯·æ±‚ï¼ŒåŒæ—¶è·å–æ–‡ä»¶çš„å¤§å°ï¼›å¼€ N ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä½¿ç”¨ Range å­—æ®µåˆ’åˆ†å‡ºå„è‡ªè´Ÿè´£ä¸‹è½½çš„ç‰‡æ®µï¼Œå‘è¯·æ±‚ä¼ è¾“æ•°æ®ï¼›ä¸‹è½½æ„å¤–ä¸­æ–­ä¹Ÿä¸æ€•ï¼Œä¸å¿…é‡å¤´å†æ¥ä¸€éï¼Œåªè¦æ ¹æ®ä¸Šæ¬¡çš„ä¸‹è½½è®°å½•ï¼Œç”¨ Range è¯·æ±‚å‰©ä¸‹çš„é‚£ä¸€éƒ¨åˆ†å°±å¯ä»¥äº†ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;èŒƒå›´è¯·æ±‚-å¤šæ®µæ•°æ®&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;åˆšæ‰è¯´çš„èŒƒå›´è¯·æ±‚ä¸€æ¬¡åªè·å–ä¸€ä¸ªç‰‡æ®µï¼Œå…¶å®å®ƒè¿˜æ”¯æŒåœ¨ Range å¤´é‡Œä½¿ç”¨å¤šä¸ªâ€œx-yâ€ï¼Œä¸€æ¬¡æ€§è·å–å¤šä¸ªç‰‡æ®µæ•°æ®ã€‚è¯·æ±‚å¤´RangeåŒæ—¶æŒ‡å®šå‡ ä¸ªèŒƒå›´ï¼šbytes=500-600,601-999&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç‰¹æ®Šçš„ MIME ç±»å‹ï¼šâ€œmultipart/byterangesâ€ï¼Œè¡¨ç¤ºæŠ¥æ–‡çš„ body æ˜¯ç”±å¤šæ®µå­—èŠ‚åºåˆ—ç»„æˆçš„ï¼Œå¹¶ä¸”è¿˜è¦ç”¨ä¸€ä¸ªå‚æ•°â€œboundary=xxxâ€æ¥åˆ†éš”æ®µã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;å¤šæ®µæ•°æ®çš„æ ¼å¼ä¸åˆ†å—ä¼ è¾“ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼Œä½†å®ƒéœ€è¦ç”¨åˆ†éš”æ ‡è®° boundary æ¥åŒºåˆ†ä¸åŒçš„ç‰‡æ®µï¼Œå¯ä»¥é€šè¿‡å›¾æ¥å¯¹æ¯”ä¸€ä¸‹ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.56&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAqlrrZaN8CY0069Jdml8NjTLD7Wqgw0lH8YNI37bQiaic4zN0aW6I6Lkw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2000&quot;/&gt;&lt;/figure&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;æ¯ä¸€ä¸ªåˆ†æ®µå¿…é¡»ä»¥â€œ- -boundaryâ€å¼€å§‹ï¼ˆå‰é¢åŠ ä¸¤ä¸ªâ€œ-â€ï¼‰ï¼Œä¹‹åè¦ç”¨â€œContent-Typeâ€å’Œâ€œContent-Rangeâ€æ ‡è®°è¿™æ®µæ•°æ®çš„ç±»å‹å’Œæ‰€åœ¨èŒƒå›´ï¼Œç„¶åå°±åƒæ™®é€šçš„å“åº”å¤´ä¸€æ ·ä»¥å›è½¦æ¢è¡Œç»“æŸï¼Œå†åŠ ä¸Šåˆ†æ®µæ•°æ®ï¼Œæœ€åç”¨ä¸€ä¸ªâ€œ- -boundary- -â€ï¼ˆå‰åå„æœ‰ä¸¤ä¸ªâ€œ-â€ï¼‰è¡¨ç¤ºæ‰€æœ‰çš„åˆ†æ®µç»“æŸã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¾‹å¦‚ï¼ŒTelnet å‘å‡ºæœ‰ä¸¤ä¸ªèŒƒå›´çš„è¯·æ±‚ï¼š&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;è¯·æ±‚æŠ¥æ–‡&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;GET /test2 HTTP/1.1&lt;br/&gt;&lt;br/&gt;Host: www.test.com&lt;br/&gt;&lt;br/&gt;Range: bytes=0-9, 20-29&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;å“åº”æŠ¥æ–‡&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;HTTP/1.1 206 Partial Content&lt;br/&gt;&lt;br/&gt;Content-Type: multipart/byteranges; boundary=00000000001&lt;br/&gt;&lt;br/&gt;Content-Length: 189&lt;br/&gt;&lt;br/&gt;Connection: keep-alive&lt;br/&gt;&lt;br/&gt;Accept-Ranges: bytes&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;--00000000001&lt;br/&gt;&lt;br/&gt;Content-Type: text/plain&lt;br/&gt;&lt;br/&gt;Content-Range: bytes 0-9/96&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;// this is&lt;br/&gt;&lt;br/&gt;--00000000001&lt;br/&gt;&lt;br/&gt;Content-Type: text/plain&lt;br/&gt;&lt;br/&gt;Content-Range: bytes 20-29/96&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;ext json d&lt;br/&gt;&lt;br/&gt;--00000000001--&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å¤§æ–‡ä»¶ä¼ è¾“çš„æ€»ç»“&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;å‹ç¼© HTML ç­‰æ–‡æœ¬æ–‡ä»¶æ˜¯ä¼ è¾“å¤§æ–‡ä»¶æœ€åŸºæœ¬çš„æ–¹æ³•ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;åˆ†å—ä¼ è¾“å¯ä»¥æµå¼æ”¶å‘æ•°æ®ï¼ŒèŠ‚çº¦å†…å­˜å’Œå¸¦å®½ï¼Œä½¿ç”¨å“åº”å¤´å­—æ®µâ€œTransfer-Encoding: chunkedâ€æ¥è¡¨ç¤ºï¼Œåˆ†å—çš„æ ¼å¼æ˜¯ 16 è¿›åˆ¶é•¿åº¦å¤´ + æ•°æ®å—ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;èŒƒå›´è¯·æ±‚å¯ä»¥åªè·å–éƒ¨åˆ†æ•°æ®ï¼Œå³â€œåˆ†å—è¯·æ±‚â€ï¼Œå®ç°è§†é¢‘æ‹–æ‹½æˆ–è€…æ–­ç‚¹ç»­ä¼ ï¼Œä½¿ç”¨è¯·æ±‚å¤´å­—æ®µâ€œRangeâ€å’Œå“åº”å¤´å­—æ®µ â€œContent-Rangeâ€ï¼Œå“åº”çŠ¶æ€ç å¿…é¡»æ˜¯ 206ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä¹Ÿå¯ä»¥ä¸€æ¬¡è¯·æ±‚å¤šä¸ªèŒƒå›´ï¼Œè¿™æ—¶å€™å“åº”æŠ¥æ–‡çš„æ•°æ®ç±»å‹æ˜¯â€œmultipart/byterangesâ€ï¼Œbody é‡Œçš„å¤šä¸ªéƒ¨åˆ†ä¼šç”¨ boundary å­—ç¬¦ä¸²åˆ†éš”ã€‚è¦æ³¨æ„è¿™å››ç§æ–¹æ³•ä¸æ˜¯äº’æ–¥çš„ï¼Œè€Œæ˜¯å¯ä»¥æ··åˆèµ·æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚å‹ç¼©åå†åˆ†å—ä¼ è¾“ï¼Œæˆ–è€…åˆ†æ®µåå†åˆ†å—ï¼Œå®éªŒç¯å¢ƒçš„ URIâ€œ/16-3â€å°±æ¨¡æ‹Ÿäº†åä¸€ç§çš„æƒ…å½¢ï¼Œä½ å¯ä»¥è‡ªå·±ç”¨ Telnet è¯•ä¸€ä¸‹ã€‚ã€‹ç»¼ä¸Šï¼Œå¤§å®¶ä¹Ÿæ€è€ƒä¸‹æ–°æ—¶ä»£é‡Œå¤§æ–‡ä»¶ä¼ è¾“çš„æ–¹å¼ã€‚äº”ã€ç›¸å…³çš„åè®®&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;6&lt;/span&gt;&lt;/span&gt;&lt;span&gt;ç›¸å…³çš„åè®®&lt;/span&gt;&lt;/h2&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.47868453105968334&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmA7fQNBNYzxrRSyA3H1PqSY85dicfzvYeaxh8xxm0I7pp7vrHibiafIAr7g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1642&quot;/&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;TCP/IPä¼ è¾“åè®®ï¼Œå³ä¼ è¾“æ§åˆ¶/ç½‘ç»œåè®®ï¼Œä¹Ÿå«ä½œç½‘ç»œé€šè®¯åè®®ã€‚å®ƒæ˜¯åœ¨ç½‘ç»œçš„ä½¿ç”¨ä¸­çš„æœ€åŸºæœ¬çš„é€šä¿¡åè®®ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;åº”ç”¨å±‚çš„ä¸»è¦åè®®æœ‰HTTPã€Telnetã€FTPã€SMTPç­‰ï¼Œæ˜¯ç”¨æ¥æ¥æ”¶æ¥è‡ªä¼ è¾“å±‚çš„æ•°æ®æˆ–è€…æŒ‰ä¸åŒåº”ç”¨è¦æ±‚ä¸æ–¹å¼å°†æ•°æ®ä¼ è¾“è‡³ä¼ è¾“å±‚ï¼›ä¼ è¾“å±‚çš„ä¸»è¦åè®®æœ‰UDPã€TCPï¼Œæ˜¯ä½¿ç”¨è€…ä½¿ç”¨å¹³å°å’Œè®¡ç®—æœºä¿¡æ¯ç½‘å†…éƒ¨æ•°æ®ç»“åˆçš„é€šé“ï¼Œå¯ä»¥å®ç°æ•°æ®ä¼ è¾“ä¸æ•°æ®å…±äº«ï¼›ç½‘ç»œå±‚çš„ä¸»è¦åè®®æœ‰ICMPã€IPã€IGMPï¼Œä¸»è¦è´Ÿè´£ç½‘ç»œä¸­æ•°æ®åŒ…çš„ä¼ é€ç­‰ï¼›è€Œç½‘ç»œè®¿é—®å±‚ï¼Œä¹Ÿå«ç½‘è·¯æ¥å£å±‚æˆ–æ•°æ®é“¾è·¯å±‚ï¼Œä¸»è¦åè®®æœ‰ARPã€RARPï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›é“¾è·¯ç®¡ç†é”™è¯¯æ£€æµ‹ã€å¯¹ä¸åŒé€šä¿¡åª’ä»‹æœ‰å…³ä¿¡æ¯ç»†èŠ‚é—®é¢˜è¿›è¡Œæœ‰æ•ˆå¤„ç†ç­‰ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸‹é¢æ˜¯wireshakeçš„æŠ“åŒ…ï¼Œè®¿é—®&lt;code&gt;http://127.0.0.1/&lt;/code&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.660958904109589&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAUparRQtcYiaribkm9LvB0IdLykdibaCoa8EIk9c5mj85DHytGHehfjFJQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1168&quot;/&gt;&lt;figcaption&gt;å›¾ç‰‡æ¥æºï¼šç½—è€å¸ˆçš„é€æhttpåè®®&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Wireshark é‡Œå°±ä¼šæœ‰æ•è·çš„æ•°æ®åŒ…ï¼ˆåŸŸåè®¿é—®çš„è¯è¿˜ä¼šæœ‰dnsè§£æï¼‰&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.8037974683544304&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAjQLH96YCDffI9sHP1ia10nfplOZ60D88u6T3ewrTSfnLgCI1vxPt4Qg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;316&quot;/&gt;&lt;figcaption&gt;å›¾ç‰‡æ¥æºï¼šç½—è€å¸ˆçš„é€æhttpåè®®&lt;/figcaption&gt;&lt;/figure&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;æµè§ˆå™¨ä»åœ°å€æ çš„è¾“å…¥ä¸­è·å¾—æœåŠ¡å™¨çš„ IP åœ°å€å’Œç«¯å£å·ï¼›æµè§ˆå™¨ç”¨ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼›æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€æ‹¼å¥½çš„æŠ¥æ–‡ï¼›æœåŠ¡å™¨æ”¶åˆ°æŠ¥æ–‡åå¤„ç†è¯·æ±‚ï¼ŒåŒæ ·æ‹¼å¥½æŠ¥æ–‡å†å‘ç»™æµè§ˆå™¨ï¼›æµè§ˆå™¨è§£ææŠ¥æ–‡ï¼Œæ¸²æŸ“è¾“å‡ºé¡µé¢ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šé¢æ˜¯æç®€æƒ…å†µä¸‹ï¼Œç°åœ¨çš„å¤§å¤šæ•°åœºæ™¯æ›´å¤æ‚ï¼Œå¦‚ä¸‹å›¾ï¼šNSFileHandle_3.png&lt;img data-ratio=&quot;0.44175824175824174&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/l7qvliaicFcd6SypgIYmFXotucODES1wmAsw5w0fCe9VkLVibg15sFibzFquBvjLl9vwXGUgalQ8M4Y0mrx3vuRvWw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;455&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç»¼ä¸Š ï¼Œæœ€åä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆä¹Ÿæ­æ™“äº†&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ã€å‚è€ƒèµ„æ–™ã€‘&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;[1] ç½—å‰‘é”‹ï¼ˆChronoï¼‰ã€Šé€è§†HTTPåè®®ã€‹(æ·±å…¥ç†è§£HTTPåè®®æœ¬è´¨ä¸åº”ç”¨)&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;[2] IETF RFC Hypertext Transfer Protocol åè®®ç›¸å…³RFC&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;[3] IETF RFC2616 (ç»ˆäºæˆä¸ºäº†æ ‡å‡†)&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>