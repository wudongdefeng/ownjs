<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>27c6babdfc822d2dd646d5e5224cd423</guid>
<title>我是如何使用 Docusaurus 来搭建网站的</title>
<link>https://toutiao.io/k/276oer7</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div id=&quot;__blog-post-container&quot; class=&quot;markdown&quot; itemprop=&quot;articleBody&quot;&gt;&lt;p&gt;在使用 &lt;a href=&quot;https://www.docusaurus.cn/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Docusaurus&lt;/a&gt; 过程中，我逐步摸索出一些不常用但是很实用的特性，有些是通过一些简单的配置，有的则需要增加或修改一些代码来实现。&lt;/p&gt;&lt;h3 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;1-设置草稿状态&quot;&gt;1. 设置草稿状态&lt;a href=&quot;#1-设置草稿状态&quot; class=&quot;hash-link&quot; aria-label=&quot;1. 设置草稿状态的直接链接&quot; title=&quot;1. 设置草稿状态的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;未撰写好的博客，在打包的时候不希望显示在博客列表中，可设置该篇博客为草稿状态，默认未设置 &lt;code&gt;draft&lt;/code&gt; 为发布状态。&lt;/p&gt;&lt;div class=&quot;language-mdx codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-mdx codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;---&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;title: 我是如何使用 Docusaurus 来搭建我的网站的&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;slug: how-to-use-docusaurus&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;authors:&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  - name: Timfan&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    title: 高级前端开发&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    url: https://github.com/fantingsheng&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    image_url: https://spacexcode.com/img/avatar.png&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    email: fants0230@sina.com&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;tags: [使用指南]&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;hide_table_of_contents: false&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;draft: true&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;---&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;h3 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;2-列表中博客显示摘要&quot;&gt;2. 列表中博客显示摘要&lt;a href=&quot;#2-列表中博客显示摘要&quot; class=&quot;hash-link&quot; aria-label=&quot;2. 列表中博客显示摘要的直接链接&quot; title=&quot;2. 列表中博客显示摘要的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;博客列表中默认是显示文章全部内容的，列表页一般是为了快速预览有哪些文章，这个时候只需要关注标题和简介即可，而看文章的详情则可以进入文章详情页进行预览。
我们根据文章内容的具体设定，将 &lt;code&gt;&amp;lt;!--truncate--&amp;gt;&lt;/code&gt; 代码放置在合适的位置，它前面的内容即为摘要的内容。&lt;/p&gt;&lt;div class=&quot;language-mdx codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-mdx codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;博客正文。。。&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;&amp;lt;!--truncate--&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;博客正文。。。&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;h3 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;3-文章详情页添加自定义模块&quot;&gt;3. 文章详情页添加自定义模块&lt;a href=&quot;#3-文章详情页添加自定义模块&quot; class=&quot;hash-link&quot; aria-label=&quot;3. 文章详情页添加自定义模块的直接链接&quot; title=&quot;3. 文章详情页添加自定义模块的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;如果你想要在每篇博客的底部增加这样一个显示个人微信公众号的卡片，这是无法直接通过配置来实现的，需要我们添加一些代码，修改原有的博客页面布局。&lt;/p&gt;&lt;p&gt;我们首先在 &lt;code&gt;src/components&lt;/code&gt; 目录下新建 &lt;code&gt;WechatFollowCard&lt;/code&gt; 全局组件，组件代码如下：&lt;/p&gt;&lt;div class=&quot;language-jsx codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-jsx codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports maybe-class-name&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;react&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports&quot;&gt;clsx&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;clsx&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports&quot;&gt;styles&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;./styles.module.css&quot;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;export&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function maybe-class-name&quot;&gt;WeChatFollowCard&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; wechatTitle &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;太空编程&quot;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript function&quot;&gt;clsx&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript string&quot;&gt;&#x27;avatar&#x27;&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript&quot;&gt; styles&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript property-access&quot;&gt;qrcard&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;img&lt;/span&gt;&lt;span class=&quot;token tag&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript&quot;&gt;styles&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript property-access&quot;&gt;qrcodeImg&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript string&quot;&gt;&#x27;@site/static/img/qrcode.png&#x27;&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript keyword module&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token tag attr-value punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag attr-value punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token tag attr-value&quot;&gt;avatar__intro&lt;/span&gt;&lt;span class=&quot;token tag attr-value punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token tag attr-value punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag attr-value punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token tag attr-value&quot;&gt;avatar__name&lt;/span&gt;&lt;span class=&quot;token tag attr-value punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; wechatTitle &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;small&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token tag attr-value punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag attr-value punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token tag attr-value&quot;&gt;avatar__subtitle&lt;/span&gt;&lt;span class=&quot;token tag attr-value punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;          分享硬核的前端编程知识。&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;br&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;想及时了解前端相关资讯，请关注作者公众号&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;          “&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript literal-property property&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag script language-javascript string&quot;&gt;&#x27;red&#x27;&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;太空编程&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;”，回复关键字，获取丰富的学习资料。&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;small&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;这里我们要使用 &lt;a href=&quot;https://www.docusaurus.cn/docs/swizzling&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Swizzle&lt;/a&gt; 来完成自定义布局&lt;/p&gt;&lt;p&gt;首先，我们将主题下面的博客内容组件 &lt;code&gt;BlogPostItem&lt;/code&gt; 安装到目录 &lt;code&gt;src/theme&lt;/code&gt; 下&lt;/p&gt;&lt;div class=&quot;codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-text codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;npm run swizzle @docusaurus/theme-classic BlogPostItem -- --wrap&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;然后修改里面的代码，将前面封装的带有微信公众号卡片信息的组件引入进来：&lt;/p&gt;&lt;div class=&quot;language-jsx codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-jsx codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports maybe-class-name&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;react&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports maybe-class-name&quot;&gt;BlogPostItem&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;@theme-original/BlogPostItem&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token imports&quot;&gt; useBlogPost &lt;/span&gt;&lt;span class=&quot;token imports punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;@docusaurus/theme-common/internal&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports maybe-class-name&quot;&gt;WeChatFollowCard&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;@site/src/components/WeChatFollowCard&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports&quot;&gt;useIsBrowser&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;@docusaurus/useIsBrowser&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;export&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function maybe-class-name&quot;&gt;BlogPostItemWrapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; isBlogPostPage &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useBlogPost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; isBrowser &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useIsBrowser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; frontMatter &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; metadata&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; enableComments &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; frontMatter&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag class-name&quot;&gt;BlogPostItem&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag spread punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag spread operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token tag spread&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token tag spread punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;        isBlogPostPage &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag class-name&quot;&gt;WeChatFollowCard&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;h3 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;1-将某个文档定义为内部文件&quot;&gt;1. 将某个文档定义为内部文件&lt;a href=&quot;#1-将某个文档定义为内部文件&quot; class=&quot;hash-link&quot; aria-label=&quot;1. 将某个文档定义为内部文件的直接链接&quot; title=&quot;1. 将某个文档定义为内部文件的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;我们知道所有 &lt;code&gt;docs&lt;/code&gt; 下面的 &lt;code&gt;.md&lt;/code&gt; 或 &lt;code&gt;.mdx&lt;/code&gt; 后缀的文件都将作为文档里面的页面显示出来，如果某个文档只是被其它的文档所引用，我们只需将该文档的命名前面加上 &lt;code&gt;_&lt;/code&gt; 的前缀，
就好比我们命名私有变量一样。&lt;/p&gt;&lt;h2 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;mdx&quot;&gt;MDX&lt;a href=&quot;#mdx&quot; class=&quot;hash-link&quot; aria-label=&quot;MDX的直接链接&quot; title=&quot;MDX的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h2&gt;&lt;h3 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;1-代码块中行高亮&quot;&gt;1. 代码块中行高亮&lt;a href=&quot;#1-代码块中行高亮&quot; class=&quot;hash-link&quot; aria-label=&quot;1. 代码块中行高亮的直接链接&quot; title=&quot;1. 代码块中行高亮的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;代码块中将某一行设置为高亮，只需将 &lt;code&gt;// highlight-next-line&lt;/code&gt; 这段代码放置在它的上面；如果要设置多行，则将 &lt;code&gt;// highlight-start&lt;/code&gt; 和 &lt;code&gt;// highlight-end&lt;/code&gt;
分别放置在它的前一行和后一行，包裹起来。&lt;/p&gt;&lt;div class=&quot;codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-text codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;function HighlightSomeText(highlight) {&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  if (highlight) {&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    // highlight-next-line&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    return &#x27;这行被高亮了！&#x27;;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  }&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  return &#x27;这里不会&#x27;;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;function HighlightMoreText(highlight) {&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  // highlight-start&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  if (highlight) {&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    return &#x27;这块被高亮了！&#x27;;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  }&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  // highlight-end&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  return &#x27;这里不会&#x27;;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;实际效果为：&lt;/p&gt;&lt;div class=&quot;language-js codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-js codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function maybe-class-name&quot;&gt;HighlightSomeText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;highlight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;highlight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;这行被高亮了！&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;这里不会&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function maybe-class-name&quot;&gt;HighlightMoreText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;highlight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;highlight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;这块被高亮了！&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;这里不会&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;除了以上说的两种方式外，还可以使用元数据指定高亮行的方式，在代码块第一行标注语言种类后空一格 &lt;code&gt;jsx {1,4-6,11}&lt;/code&gt;，高亮多行内容，请使用英文半角逗号来分隔行号，
或使用范围语法来选择多行代码块以高亮。&lt;/p&gt;&lt;div class=&quot;language-jsx codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-jsx codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports maybe-class-name&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;react&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function maybe-class-name&quot;&gt;MyComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token property-access&quot;&gt;isBar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Bar&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;export&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token maybe-class-name&quot;&gt;MyComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;h3 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;2-代码设置行号&quot;&gt;2. 代码设置行号&lt;a href=&quot;#2-代码设置行号&quot; class=&quot;hash-link&quot; aria-label=&quot;2. 代码设置行号的直接链接&quot; title=&quot;2. 代码设置行号的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;默认代码块是不显示行号的，只需要在第一行符号标签上添加 &lt;code&gt;showLineNumbers&lt;/code&gt; 即可&lt;/p&gt;&lt;div class=&quot;codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-text codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;``` jsx {1,4-6,11} showLineNumbers&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;language-jsx codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-jsx codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm&quot;&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports maybe-class-name&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;react&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function maybe-class-name&quot;&gt;MyComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token property-access&quot;&gt;isBar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Bar&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line codeLine_lJS_&quot;&gt;&lt;span class=&quot;codeLineNumber_Tfdd&quot;/&gt;&lt;span class=&quot;codeLineContent_feaV&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;export&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token maybe-class-name&quot;&gt;MyComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;h3 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;3-在-mdx-文档中插入标题目录&quot;&gt;3. 在 mdx 文档中插入标题目录&lt;a href=&quot;#3-在-mdx-文档中插入标题目录&quot; class=&quot;hash-link&quot; aria-label=&quot;3. 在 mdx 文档中插入标题目录的直接链接&quot; title=&quot;3. 在 mdx 文档中插入标题目录的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;默认博客和文档右侧会自动生成带标题的树状目录结构，这个可以通过配置项 &lt;code&gt;hide_table_of_contents: false&lt;/code&gt; 来进行设置。&lt;/p&gt;&lt;p&gt;显示的标题层级，默认只显示 h2 和 h3，如果要改变显示的标题层级，只需要设置最大和最小的标题层级即可：&lt;/p&gt;&lt;div class=&quot;language-mdx codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-mdx codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;---&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;# 显示 h2 到 h5 标题&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;toc_min_heading_level: 2&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;toc_max_heading_level: 5&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;---&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;如果要想在某个 MDX 文档正文中也显示内联标题目录怎么办？只需添加如下代码：&lt;/p&gt;&lt;div class=&quot;language-jsx codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-jsx codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports maybe-class-name&quot;&gt;TOCInline&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;@theme/TOCInline&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag class-name&quot;&gt;TOCInline&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;toc&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript&quot;&gt;toc&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;minHeadingLevel&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot;&gt;maxHeadingLevel&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;传给参数 &lt;code&gt;toc&lt;/code&gt; 的变量是可以从任何一个 MDX 文档中直接获取到的，它是一个包含id, value, level属性的值的对象数组。当然你也可以通过参数 &lt;code&gt;minHeadingLevel&lt;/code&gt; 和
&lt;code&gt;maxHeadingLevel&lt;/code&gt; 来控制显示的标题层级。&lt;/p&gt;&lt;p&gt;下面是文中引入标题目录的实际效果：&lt;/p&gt;&lt;h3 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;4-实现交互式代码区&quot;&gt;4. 实现交互式代码区&lt;a href=&quot;#4-实现交互式代码区&quot; class=&quot;hash-link&quot; aria-label=&quot;4. 实现交互式代码区的直接链接&quot; title=&quot;4. 实现交互式代码区的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;有时我们需要在博客或者文档里展示一些代码的实际运行效果，常见的行为是给个链接跳转到第三方在线代码运行器里，比如“&lt;a href=&quot;https://code.juejin.cn/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;码上掘金&lt;/a&gt;”或者“&lt;a href=&quot;https://codepen.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CODEPEN&lt;/a&gt;”等，
这样可能觉得不够专注，还可以将实时展示代码运行结果的功能集成进来。&lt;/p&gt;&lt;p&gt;利用 &lt;code&gt;@docusaurus/theme-live-codeblock&lt;/code&gt; 这个官方插件就可以实现，首先安装插件到项目里：&lt;/p&gt;&lt;div class=&quot;tabs-container tabList__CuJ&quot;&gt;&lt;div class=&quot;margin-top--md&quot;&gt;&lt;div role=&quot;tabpanel&quot; class=&quot;tabItem_Ymn6&quot;&gt;&lt;div class=&quot;language-shell codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-shell codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; --save @docusaurus/theme-live-codeblock&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div role=&quot;tabpanel&quot; class=&quot;tabItem_Ymn6&quot; hidden=&quot;&quot;&gt;&lt;div class=&quot;language-shell codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-shell codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; @docusaurus/theme-live-codeblock&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div role=&quot;tabpanel&quot; class=&quot;tabItem_Ymn6&quot; hidden=&quot;&quot;&gt;&lt;div class=&quot;language-shell codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-shell codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token function&quot;&gt;pnpm&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; @docusaurus/theme-live-codeblock&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;然后需要到 &lt;code&gt;docusaurus.config.js&lt;/code&gt; 配置文件里添加插件：&lt;/p&gt;&lt;div class=&quot;codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-text codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;module.exports = {&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  // ...&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  themes: [&#x27;@docusaurus/theme-live-codeblock&#x27;],&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  // ...&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;};&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;使用的时候，在代码块标签的后面加上 &lt;code&gt;live&lt;/code&gt; 属性即可，实际效果如下：&lt;/p&gt;&lt;div class=&quot;playgroundContainer_X_Ta&quot;&gt;&lt;p class=&quot;playgroundHeader_dyrN&quot;&gt;实时编辑器&lt;/p&gt;&lt;div class=&quot;playgroundEditor_Q6Y7&quot;&gt;&lt;pre aria-hidden=&quot;true&quot;&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function maybe-class-name&quot;&gt;Clock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;startDate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; setStartDate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; setDate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token arrow operator&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; timerID &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token arrow operator&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;tick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;
&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cleanup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clearInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;timerID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;
&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;tick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setDate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;
&lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token keyword control-flow&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;h4&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;你是在 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;startDate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token method function property-access&quot;&gt;toLocaleTimeString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt; 进入本页的&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;h4&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;h5&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;你已经在本页待了 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token known-class-name class-name&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token method function property-access&quot;&gt;floor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token method function property-access&quot;&gt;getTime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; startDate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token method function property-access&quot;&gt;getTime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt; 秒了&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;h5&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain-text&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;/p&gt;&lt;p class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;playgroundHeader_dyrN&quot;&gt;结果&lt;/p&gt;&lt;/div&gt;&lt;h3 class=&quot;anchor anchorWithStickyNavbar_LWe7&quot; id=&quot;5-在代码区块中引入外部包&quot;&gt;5. 在代码区块中引入外部包&lt;a href=&quot;#5-在代码区块中引入外部包&quot; class=&quot;hash-link&quot; aria-label=&quot;5. 在代码区块中引入外部包的直接链接&quot; title=&quot;5. 在代码区块中引入外部包的直接链接&quot;&gt;​&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;代码块在设置了实时预览模式时，对于除 React 以外的其它组件是无法直接导入使用的。&lt;/p&gt;&lt;p&gt;这时我们需要覆盖（swizzle）主题中相应的组件并调整 &lt;code&gt;react-live&lt;/code&gt; 导入组件的范围：&lt;/p&gt;&lt;div class=&quot;language-shell codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-shell codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; run swizzle @docusaurus/theme-live-codeblock ReactLiveScope -- --eject&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;这时主题目录（theme）下面多了一个 &lt;code&gt;ReactLiveScope&lt;/code&gt; 目录，打开 &lt;code&gt;index.js&lt;/code&gt; 文件，添加需要的外部导入的组件&lt;/p&gt;&lt;div class=&quot;language-js codeBlockContainer_Ckt0 theme-code-block&quot;&gt;&lt;div class=&quot;codeBlockContent_biex&quot;&gt;&lt;pre tabindex=&quot;0&quot; class=&quot;prism-code language-js codeBlock_bY9V thin-scrollbar&quot;&gt;&lt;code class=&quot;codeBlockLines_e6Vv&quot;&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports maybe-class-name&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;react&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token imports&quot;&gt;useMousePosition&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#x27;./useMousePosition&#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token comment&quot;&gt;// Add react-live imports you need here&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token maybe-class-name&quot;&gt;ReactLiveScope&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token maybe-class-name&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token spread operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token maybe-class-name&quot;&gt;React&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line theme-code-block-highlighted-line&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  useMousePosition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;br/&gt;&lt;/span&gt;&lt;span class=&quot;token-line&quot;&gt;&lt;span class=&quot;token plain&quot;/&gt;&lt;span class=&quot;token keyword module&quot;&gt;export&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword module&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token maybe-class-name&quot;&gt;ReactLiveScope&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;后面其它代码区块中可不导入直接使用 &lt;code&gt;useMousePosition&lt;/code&gt; 组件。&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>0e4190c6c4e4cbd2dc9d57536b409e08</guid>
<title>架构师日记 - 从技术角度揭露电商大促备战的奥秘 | 京东云技术团队</title>
<link>https://toutiao.io/k/kzlausu</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;preview&quot;&gt;&lt;h1&gt;一 背景&lt;/h1&gt;

&lt;p&gt;今年的618大促已经如期而至，接下来我会从技术的角度，跟大家聊聊大促备战的底层逻辑和实战方案，希望能够解答大家心中的一些疑惑。&lt;/p&gt;

&lt;p&gt;首先，618大促为什么如此重要呢？先从数据的角度简单做一下分析，以下表格罗列了我们历年大促GMV成绩单：&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;年份&lt;/th&gt;
&lt;th&gt;618销售额（亿元）&lt;/th&gt;
&lt;th&gt;年销售额（亿元）&lt;/th&gt;
&lt;th&gt;618销售额占比&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;2022&lt;/td&gt;
&lt;td&gt;3793&lt;/td&gt;
&lt;td&gt;33155&lt;/td&gt;
&lt;td&gt;11.4%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2021&lt;/td&gt;
&lt;td&gt;3439&lt;/td&gt;
&lt;td&gt;32970&lt;/td&gt;
&lt;td&gt;10.4%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2020&lt;/td&gt;
&lt;td&gt;2694&lt;/td&gt;
&lt;td&gt;26125&lt;/td&gt;
&lt;td&gt;10.3%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2019&lt;/td&gt;
&lt;td&gt;2017&lt;/td&gt;
&lt;td&gt;20854&lt;/td&gt;
&lt;td&gt;9.7%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2018&lt;/td&gt;
&lt;td&gt;1592&lt;/td&gt;
&lt;td&gt;16769&lt;/td&gt;
&lt;td&gt;9.5%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;根据以上数据统计，我们可以得出结论：每年的618大促销售额约占全年销售额的10%左右。以2022年618大促销售额为例，大促期间，每分钟的销售额平均高达1463万元。因此，从技术角度来看，保证服务的稳定性是至关重要的。相信这些数据可以为您在大促期间制定任务优先级和做出决策提供有价值的参考。&lt;/p&gt;

&lt;h1&gt;二 挑战&lt;/h1&gt;

&lt;p&gt;大促期间系统的稳定性对于业务的正常运营如此重要，我们需要探讨以下问题：&lt;/p&gt;

&lt;p&gt;• 影响系统稳定性的因素都有哪些？&lt;/p&gt;

&lt;p&gt;• 稳定性要求与日常对系统的高可用要求有哪些不同之处？&lt;/p&gt;

&lt;p&gt;• 面对各种不稳定因素，我们应该如何应对？&lt;/p&gt;

&lt;p&gt;下面我们一起来分析和探讨这些问题。&lt;/p&gt;

&lt;p&gt;1. 影响系统稳定性的因素有以下几个方面：&lt;/p&gt;

&lt;p&gt;• &lt;strong&gt;流量大小&lt;/strong&gt;：大促期间，流量往往是平常的几倍甚至几十倍，这对系统的稳定性提出了极高的要求，一个小问题，在流量放大后，往往会演变成大问题；&lt;/p&gt;

&lt;p&gt;• &lt;strong&gt;数据量大&lt;/strong&gt;：以2022年的订单为例，订单额达到了3.4万亿，在海量订单数据的场景下，一个简单的查询，都会变得非常具有挑战；&lt;/p&gt;

&lt;p&gt;• &lt;strong&gt;场景复杂&lt;/strong&gt;：各类促销优惠、平台、商家、运营等各种营销玩法的叠加，使订单生产链路始终处于高负荷运算状态；&lt;/p&gt;

&lt;p&gt;• &lt;strong&gt;交付链路长&lt;/strong&gt;：各端的流量分发、促销计算、加车、结算、提单、支付、物流配送、客服、售后等各个流程节点都需要保持稳定。如果一个服务99.9%的可用率，那么100个相关服务节点组合起来，可用率就只能达到99.5%了，而那0.5%的不可用，对应的都是大量的订单流失；&lt;/p&gt;

&lt;p&gt;• &lt;strong&gt;容忍度低&lt;/strong&gt;：消费者要求良好的用户体验，商家需要促销快速生效，平台则要减少错误和资损，保护消费者和商家的利益。更高的期望和关注，带来的是更低的耐心和容忍度；&lt;/p&gt;

&lt;p&gt;2. 在大促期间，对系统的稳定性要求更高，但与平常对系统的高可用性要求不同。这主要体现在以下几个方面：&lt;/p&gt;

&lt;p&gt;• &lt;strong&gt;时间紧迫&lt;/strong&gt;：大促期间需要在短时间内保证服务的稳定性，通常没有时间深入技术细节；&lt;/p&gt;

&lt;p&gt;• &lt;strong&gt;视角不同&lt;/strong&gt;：稳定性注重整体业务效果，而高可用性注重服务响应结果；&lt;/p&gt;

&lt;p&gt;• &lt;strong&gt;维度不同&lt;/strong&gt;：实现业务稳定性保障通常是建立在系统高可用性的基础之上，并配合相关的服务运营策略，以实现更高维度的业务稳定性。&lt;/p&gt;

&lt;p&gt;3. 接下来将重点围绕备战大促的相关思路和经验进行展开，以帮助您应对挑战并确保系统的稳定性。&lt;/p&gt;

&lt;h1&gt;三 稳定性保障&lt;/h1&gt;

&lt;p&gt;以下罗列了今年大促备战的部分措施：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://s3.cn-north-1.jdcloud-oss.com/shendengbucket1/2023-05-30-22-56qAhjlDBKMjjKDBz.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;上图里展示的各种备战项目，有方向性的指导，有流程上的规范，有落地层面的要求。下面我将从更细粒度的系统执行层面出发，提供一些备战策略。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://s3.cn-north-1.jdcloud-oss.com/shendengbucket1/2023-06-07-21-517CZW88tjnC9sqjV.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;正如前文提到的，大促期间的稳定性保障一般属于应急策略。目的是在保证系统稳定性的前提下，对问题的快速响应。我们将从应用、存储、运营三个视角，来探讨系统稳定性保障的应急措施。&lt;/p&gt;

&lt;h2&gt;3.1 应用视角&lt;/h2&gt;

&lt;h3&gt;3.1.1 单元化&lt;/h3&gt;

&lt;p&gt;单元化部署是将应用拆分成多个独立的单元进行独立部署，有以下好处：&lt;/p&gt;

&lt;p&gt;• 降低整个应用因某个单元故障而导致服务中断的风险；&lt;/p&gt;

&lt;p&gt;• 降低故障排查的难度，因为可以快速定位出问题的单元并进行修复；&lt;/p&gt;

&lt;p&gt;• 每个单元都可以独立维护和升级，这样可以降低整个应用因某个单元升级或维护而导致服务中断的风险；&lt;/p&gt;

&lt;p&gt;• 每个单元都可以独立扩展和缩减，这样可以根据实际需求动态调整应用的规模。&lt;/p&gt;

&lt;p&gt;为了保证服务的可靠性，我们需要在备战层面实现异地多活的能力，即要求服务进行异地多机房部署。考虑到异地跨机房调用的网络延时问题（例如北京到上海的往返网络延时大约为12毫秒），黄金交易链路的所有服务都需要本地单元化部署。因此，建议采用本地单元化优先的部署架构，并与其他异地单元化互为灾备。&lt;/p&gt;

&lt;p&gt;另外，也要注意流量负载均衡策略，防止出现分组的调用流量不均衡，造成部分分组因流量倾斜，导致性能表现不佳的情况出现；&lt;/p&gt;

&lt;h3&gt;3.1.2 监控预警&lt;/h3&gt;

&lt;p&gt;预防和发现问题的最直接方式，需要关注以下几个方面：&lt;/p&gt;

&lt;p&gt;• 监控粒度方面：监控按照层级分为底层中间件监控、依赖RPC监控、方法监控、机器监控、系统监控、业务监控、流程监控、整体的大盘监控；&lt;/p&gt;

&lt;p&gt;• 监控的灵敏度问题。灵敏度过低会导致部分问题被延时暴露甚至被隐藏，而灵敏度过高则会造成信息爆炸，难以分辨信息的主次。因此，在实施监控前需要提前做好功课，确定合适的灵敏度；&lt;/p&gt;

&lt;p&gt;• 监控的覆盖度方面：关注监控服务单元、监控指标梳理、监控触达方法。比如：监控需要覆盖容器数、资源指标、运行环境（JVM、线程池）、流量大小、限流值、上下游依赖、超时时长、异常日志、数据容量、模型规模、特征数量等，并可以进行时间维度的纵向对比；&lt;/p&gt;

&lt;p&gt;• 监控的准确性方面：看可用率，需要看上游调用方的，可能200ms响应时长，对与调用方来说，已经属于不可用的区间了。看CPU繁忙程度，不能只盯着利用率，还要结合容器核数和CPU负载来分析；&lt;/p&gt;

&lt;p&gt;• 预警解除方面：接到预警消息，及时排查并处理风险，切不可将小问题演变成大问题。先确认是单机硬件或网络问题，还是集群通用问题，如果是通用问题，能否通过服务调用链追踪技术快速定位问题点，确认好问题原因，才能做好应对预案；&lt;/p&gt;

&lt;h3&gt;3.1.3 日志打印&lt;/h3&gt;

&lt;p&gt;日志格式、日志级别、输出方式，归档策略，序列化方式，traceId策略等都需要进行合理设置，特别要限制重复日志和无效日志的输出，减少日志对机器资源的占用。比如：业务异常堆栈日志不建议直接打印，通过状态码统计结果就可以了；&lt;/p&gt;

&lt;h3&gt;3.1.4 快速失败&lt;/h3&gt;

&lt;p&gt;能够快速地检测和响应故障，帮助服务更快地恢复正常状态，从而提高系统的可用性和稳定性。实现快速失败，常见的技术手段如下：&lt;/p&gt;

&lt;p&gt;• 线程池超时时间的设置，关键系统要拥有动态调整线程池运行参数的能力；&lt;/p&gt;

&lt;p&gt;• 利用好工具已有的能力，比如：JSF，JimDB，JMQ等中间件也都支持超时失败的动态调整能力；&lt;/p&gt;

&lt;p&gt;• 服务限流也是快速失败的一种实现策略，常见的微服务框架和物理网关一般也都支持类似功能；&lt;/p&gt;

&lt;p&gt;总之，快速失败可以保护系统资源的合理分配，避免出现资源调度阻塞甚至全盘崩溃情况发生，是稳定性保证的重要手段。&lt;/p&gt;

&lt;h3&gt;3.1.5 服务限流&lt;/h3&gt;

&lt;p&gt;限流一定是基于系统的承载能力来进行的，整个服务调用链路上，遵循木桶原理，下面给出一些建议：&lt;/p&gt;

&lt;p&gt;• 限流方式和阈值需要经过系统多轮压测验证，以确保数据指标的准确性。&lt;/p&gt;

&lt;p&gt;• 对于业务聚合系统，主要依赖于第三方服务，通常没有存储层，瓶颈往往出现在应用服务本身。这种情况下，单机限流是比较好的方式，因为这种方式对于服务扩容或缩容非常友好。只需保证扩容的容器硬件配置与线上容器保持一致即可。&lt;/p&gt;

&lt;p&gt;• 对于底层基础服务，瓶颈点往往在数据存储层，而存储层的扩容成本相对较高，实现起来也比较困难。在这种情况下，全局集中式限流是一个很好的选择，其目的是优先保证存储层的稳定性。&lt;/p&gt;

&lt;p&gt;• 建议根据调用方的重要程度进行精细化限流运营，确保在极端情况下，具有优先保证核心业务可用性的能力；&lt;/p&gt;

&lt;h3&gt;3.1.6 业务降级&lt;/h3&gt;

&lt;p&gt;通常情况下，降级策略是一种防御性的应对措施，用于应对可预见的风险。这种策略可能会牺牲部分非核心能力，以确保业务的基本可用性。随着业务不断迭代，需要时刻关注之前的降级策略是否仍然适用，特别是在多人协作的系统中。&lt;/p&gt;

&lt;h2&gt;3.2 存储视角&lt;/h2&gt;

&lt;p&gt;下面从存储视角来看看稳定性保障方面的一些思路。&lt;/p&gt;

&lt;h3&gt;3.2.1 数据库&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;主从架构&lt;/strong&gt;：这是最常见的数据库实例部署架构模式，目的是保证核心数据的高可用，防止出现单机故障，导致数据丢失的情况发生；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;读写分离&lt;/strong&gt;：对于大部分实时性要求不高的场景，可以将从库资源充分利用起来的，按照业务场景，实现写主库，读从库的架构模式；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;事务隔离&lt;/strong&gt;：MySQL默认的事务隔离级别是RR，但对于大部分应用场景，特别实在写频繁的场景，将隔离级别设置为RC级别，也能够提高数据库吞吐量；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;分库分表&lt;/strong&gt;：这里不是要求大促前进行数据库架构升级，而是说在大促期间，可以进一步将数据进行更细粒度的迁移，比如启动冷热数据的迁移任务；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;慢查询&lt;/strong&gt;：提前做好索引优化，比较重的查询，提前进行降级屏蔽，做好监控预警；&lt;/p&gt;

&lt;h3&gt;3.2.2 缓存&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;一主多从&lt;/strong&gt;：核心数据需要关注部署架构的合理性，目的是保证核心数据的高可用，防止出现单机故障，导致数据丢失的情况发生；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;能力扩容&lt;/strong&gt;：缓存是否需要扩容，主要考虑两个因素，存储空间上限和IO流量上限。在达到上限之前，及时增加分片来提高容量上限；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;主从双读&lt;/strong&gt;：缓存主从部署架构的模式下，从分片也可以用来承接部分业务压力；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;热点数据&lt;/strong&gt;：热点数据需要及时消灭，否则容易引起节点性能的急剧下降，高版本的缓存客户端已经支持了热点数据的识别，并实现了热点数据进行本地缓存的优化；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;大key问题&lt;/strong&gt;：大key同样会导致集群性能的稳定性问题，核心业务需要考虑风险隔离，避免多条业务线公用一个缓存集群，尽量做到集群隔离；&lt;/p&gt;

&lt;h3&gt;3.2.3 Elasticsearch&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;双集群&lt;/strong&gt;：ES虽然拥有数据容灾的能力，但在压力大的情况下，能够优化的空间有限，另一方面，集群节点故障的时候，分片再平衡也可能会影响可用率，所以重要的业务建议做双集群进行能力冗余互备；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;慢请求&lt;/strong&gt;：有时候慢请求会导致整个集群卡住，类似关系型数据库中出现锁库的场景。那么我们可以通过查询集群中的慢请求任务，若有必要可取消，以释放资源；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;写控速&lt;/strong&gt;：大量的写请求会比较影响查询性能，有时候可以适当的限制写速度，来保证集群查询的稳定性；&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;存储容量&lt;/strong&gt;：集群对存储容量默认有根据不同的水位线进行保护，若超过水位线则无法再提供写入特性。需要监视集群存储占用情况，亦可根据实际服务器存储配置调高水位线；&lt;/p&gt;

&lt;h2&gt;3.3 运营视角&lt;/h2&gt;

&lt;p&gt;千里之行始于足下，再好的预案都需要贯彻执行到位，否则只能事倍功半。下面给出一些运营保障措施。&lt;/p&gt;

&lt;h3&gt;3.3.1 备战小组&lt;/h3&gt;

&lt;p&gt;站在系统或团队内看问题往往是有视野盲区的，还需要有站在更高维度看问题的视角，这就是备战小组。准则就是：及时响应、效率第一。从问题的发现、影响范围的控制、解决方案的推进到流程规范的执行，备战小组都扮演着不可或缺的角色。&lt;/p&gt;

&lt;h3&gt;3.3.2 军演压测&lt;/h3&gt;

&lt;p&gt;这需要协调上下游相关部门，组织协调成本很高，旨在模拟真实线上流量，以进行系统稳定性的压力测试。这是应用维度，稳定性保障预案的数据指标基础，如：监控指标，熔点阈值、限流阈值和机器扩容数等。&lt;/p&gt;

&lt;h3&gt;3.3.3 技术封版&lt;/h3&gt;

&lt;p&gt;上线封版，听起来往往让人难以理解，难道大促期间我们就不上线了吗？据统计，70%的线上问题是由于改动发版导致，大促期间，业务需求让步于系统稳定性保障，也是再三权衡的结果。&lt;/p&gt;

&lt;h3&gt;3.3.4 每日巡检/假期值班&lt;/h3&gt;

&lt;p&gt;作为系统自动巡检的补充，对系统定时定点的进行可用性检查。其目的是及时发现问题，降低异常影响范围。&lt;/p&gt;

&lt;h3&gt;3.3.5 应急预案&lt;/h3&gt;

&lt;p&gt;这是出现问题后的备用计划，备战是为了避免问题的发生，但如果问题真的出现了，应急预案将成为我们最后一道防线。关于应急预案相关的要求和操作，参照下图：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://s3.cn-north-1.jdcloud-oss.com/shendengbucket1/2023-06-05-16-36rnyyO33VklNmuSko.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h1&gt;四 总结&lt;/h1&gt;

&lt;p&gt;本文从技术角度深入分析了大促备战的背景和重要性，重点介绍了备战期间稳定性保障的相关措施，包括具体的指导方向和落地细节。本文旨在回顾和梳理备战期间的关键步骤，以帮助我们更加从容的应对系统稳定性的挑战。虽然大促备战是一场紧急行动，但备战的效果离不开平时的协作共识和技术积累，过往的经验和教训，在此刻将得到充分验证。&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;作者：京东零售  刘慧卿&lt;/p&gt;

&lt;p&gt;内容来源：京东云开发者社区&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
  &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f8a32fe7507f6d55fdadd293e94f673a</guid>
<title>基于 nacos/springcloud/k8s 的不停机服务更新[graceful shutdown]</title>
<link>https://toutiao.io/k/bd1nosd</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;article-entry&quot; itemprop=&quot;articleBody&quot;&gt;
      
        &lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;/&gt;背景&lt;/h2&gt;&lt;p&gt;我们的 SpringCloud 是部署在 k8s 上的, 当通过 k8s 进行滚动升级时, 会有请求 500 的情况, 不利于用户体验, 严重的可能造成数据错误的问题&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;k8s 滚动更新策略介绍&lt;br/&gt;假设我们要升级的微服务在环境上为3个副本的集群, 升级应用时, 会先启动1个新版本的副本, 然后下线一个旧版本的副本, 之后再启动1个新版本的副本, 一次类推,直到所有旧副本都替换新副本.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;通过链路追踪分析, 报错的原因分别由以下两种情况&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;SpringCloud 中的微服务在升级过程中, 当旧的微服务中还有没有处理完成的请求时, 就开始关闭动作, 造成请求中断&lt;/li&gt;
&lt;li&gt;当旧应用执行关闭动作时, 已经开始拒绝请求, 但是 nacos 中的路由并没有及时更新, 造成 gateway/openfeign 在路由时仍会命中正在关闭的应用, 造成请求报错&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;为了解决这个问题, 我们将利用 springboot 的 graceful shutdown 功能和 nacos 的主动下线功能来解决这个问题. 具体思路如下:&lt;/p&gt;
&lt;p&gt;比如当我们执行订单微服务(3个副本)滚动更新时&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先启动一个新版本&lt;code&gt;副本4&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;然后准备关闭&lt;code&gt;副本1&lt;/code&gt;, 在关闭之前先通知 nacos 订单服务的&lt;code&gt;副本1&lt;/code&gt;下线, 然后由 nacos 通知给其他应用(nacos2.x 是grpc, 所以通知速度比较快), 这样, 订单服务的&lt;code&gt;副本1&lt;/code&gt;就不会再接收到请求, 然后执行 graceful shutdown(springboot 原生支持, 启用方法可以看后面代码), 所有请求处理完成后关闭应用. 这样就完成了 &lt;code&gt;副本1&lt;/code&gt; 的关闭&lt;/li&gt;
&lt;li&gt;启动新版本&lt;code&gt;副本5&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;再优雅关闭&lt;code&gt;副本2&lt;/code&gt;(参考第2点&lt;code&gt;副本1&lt;/code&gt;的流程)&lt;/li&gt;
&lt;li&gt;然后启动新版本&lt;code&gt;副本6&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;再优雅关闭&lt;code&gt;副本3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;完成了服务不中断的应用升级&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;实现关键点&quot;&gt;&lt;a href=&quot;#实现关键点&quot; class=&quot;headerlink&quot; title=&quot;实现关键点&quot;/&gt;实现关键点&lt;/h2&gt;&lt;p&gt;为了实现上面背景中提到的思路, 主要从一下几个方面入手&lt;/p&gt;
&lt;h3 id=&quot;创建从-nacos-中下线副本的API&quot;&gt;&lt;a href=&quot;#创建从-nacos-中下线副本的API&quot; class=&quot;headerlink&quot; title=&quot;创建从 nacos 中下线副本的API&quot;/&gt;创建从 nacos 中下线副本的API&lt;/h3&gt;&lt;p&gt;我们通过创建自定义名为 &lt;code&gt;deregister&lt;/code&gt; 的 &lt;code&gt;endpoint&lt;/code&gt; 来通知 &lt;code&gt;nacos&lt;/code&gt; 下线副&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;java&quot;&gt;import com.alibaba.cloud.nacos.NacosDiscoveryProperties;
import com.alibaba.cloud.nacos.registry.NacosRegistration;
import com.alibaba.cloud.nacos.registry.NacosServiceRegistry;
import lombok.extern.log4j.Log4j2;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.actuate.endpoint.annotation.Endpoint;
import org.springframework.boot.actuate.endpoint.annotation.ReadOperation;
import org.springframework.stereotype.Component;

@Component
@Endpoint(id = &quot;deregister&quot;)
@Log4j2
public class LemesNacosServiceDeregisterEndpoint {

    @Autowired
    private NacosDiscoveryProperties nacosDiscoveryProperties;

    @Autowired
    private NacosRegistration nacosRegistration;

    @Autowired
    private NacosServiceRegistry nacosServiceRegistry;

    /**
     * 从 nacos 中主动下线，用于 k8s 滚动更新时，提前下线分流流量
     *
     * @param
     * @return com.lenovo.lemes.framework.core.util.ResultData&amp;lt;java.lang.String&amp;gt;
     * @author Yujie Yang
     * @date 4/6/22 2:57 PM
     */
    @ReadOperation
    public String endpoint() {
        String serviceName = nacosDiscoveryProperties.getService();
        String groupName = nacosDiscoveryProperties.getGroup();
        String clusterName = nacosDiscoveryProperties.getClusterName();
        String ip = nacosDiscoveryProperties.getIp();
        int port = nacosDiscoveryProperties.getPort();

        log.info(&quot;deregister from nacos, serviceName:{}, groupName:{}, clusterName:{}, ip:{}, port:{}&quot;, serviceName, groupName, clusterName, ip, port);

        // 设置服务下线
        nacosServiceRegistry.setStatus(nacosRegistration, &quot;DOWN&quot;);

        return &quot;success&quot;;
    }

}&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;支持-Graceful-Shutdown&quot;&gt;&lt;a href=&quot;#支持-Graceful-Shutdown&quot; class=&quot;headerlink&quot; title=&quot;支持 Graceful Shutdown&quot;/&gt;支持 Graceful Shutdown&lt;/h3&gt;&lt;p&gt;由于 springboot 原生支持, 我们只需要在 &lt;code&gt;bootstrap.yaml&lt;/code&gt; 中添加一下配置即可&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;yaml&quot;&gt;server:
  # 开启优雅下线
  shutdown: graceful

spring:
  lifecycle:
    # 优雅下线超时时间
    timeout-per-shutdown-phase: 5m
# 暴露 shutdown 接口
management:
  endpoint:
    shutdown:
      enabled: true
  endpoints:
    web:
      exposure:
        include: shutdown&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;K8s-配置&quot;&gt;&lt;a href=&quot;#K8s-配置&quot; class=&quot;headerlink&quot; title=&quot;K8s 配置&quot;/&gt;K8s 配置&lt;/h3&gt;&lt;p&gt;有了上面两个 API, 接下来就配置到 k8s 上&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;terminationGracePeriodSeconds 如果关闭应用的时间超过 10 分钟, 则向容器发送 TERM 信号, 防止应用长时间下线不了&lt;/li&gt;
&lt;li&gt;preStop 先执行下线操作, 等待30s, 留够通知到其他应用的时间, 然后执行 graceful shutdown 关闭应用&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&quot;yaml&quot;&gt;---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lemes-service-common
  labels:
    app: lemes-service-common
spec:
  replicas: 2
  selector:
    matchLabels:
      app: lemes-service-common
#  strategy:
#    type: RollingUpdate
#    rollingUpdate:
##     replicas - maxUnavailable &amp;lt; running num  &amp;lt; replicas + maxSurge
#      maxUnavailable: 1
#      maxSurge: 1
  template:
    metadata:
      labels:
        app: lemes-service-common
    spec:
#      容器重启策略 Never Always OnFailure
#      restartPolicy: Never
#     如果关闭时间超过10分钟， 则向容器发送 TERM 信号
      terminationGracePeriodSeconds: 600
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                topologyKey: &quot;kubernetes.io/hostname&quot;
                labelSelector:
                  matchExpressions:
                    - key: app
                      operator: In
                      values:
                        - lemes-service-common
              weight: 100
#          requiredDuringSchedulingIgnoredDuringExecution:
#            - labelSelector:
#                matchExpressions:
#                  - key: app
#                    operator: In
#                    values:
#                      - lemes-service-common
#              topologyKey: &quot;kubernetes.io/hostname&quot;
      volumes:
        - name: lemes-host-path
          hostPath:
            path: /data/logs
            type: DirectoryOrCreate
        - name: sidecar
          emptyDir: { }
      containers:
        - name: lemes-service-common
          image: 10.176.66.20:5000/lemes-cloud/lemes-service-common-server:v0.1
          imagePullPolicy: Always
          volumeMounts:
            - name: lemes-host-path
              mountPath: /data/logs
            - name: sidecar
              mountPath: /sidecar
          ports:
            - containerPort: 80
          resources:
#           资源通常情况下的占用
            requests:
              memory: &#x27;2048Mi&#x27;
#           资源占用上限
            limits:
              memory: &#x27;4096Mi&#x27;
          livenessProbe:
            httpGet:
              path: /actuator/health/liveness
              port: 80
            initialDelaySeconds: 5
#           探针可以连续失败的次数
            failureThreshold: 10
#           探针超时时间
            timeoutSeconds: 10
#           多久执行一次探针查询
            periodSeconds: 10
          startupProbe:
            httpGet:
              path: /actuator/health/liveness
              port: 80
            failureThreshold: 30
            timeoutSeconds: 10
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /actuator/health/readiness
              port: 80
            initialDelaySeconds: 5
            timeoutSeconds: 10
            periodSeconds: 10
          lifecycle:
            preStop:
              exec:
#               应用关闭操作：1. 从 nacos 下线，2. 等待30s, 保证 nacos 通知到其他应用 2.触发 springboot 的 graceful shutdown
                command:
                  - sh
                  - -c
                  - curl http://127.0.0.1/actuator/deregister;sleep 30;curl -X POST http://127.0.0.1/actuator/shutdown;&lt;/code&gt;&lt;/pre&gt;

      
       &lt;hr/&gt;&lt;span&gt; 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 jaytp@qq.com &lt;/span&gt;
    &lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>0b5d604a63e8256e60e0b60e660efb91</guid>
<title>实战分布式事务【Seata+Spring Cloud】</title>
<link>https://toutiao.io/k/z1gumqq</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大家好，我是田哥&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;上一篇文章我们使用Atomikos实现了分布式事务：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但是里面有个问题：可能会对同一个表生成两份mapper相关的内容。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;于是，我们继续探索其他分布式事务组件。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.34868421052631576&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/07BicZywOVtkibJ1RzJYUvNBBjKPWJYWMElhUDjx8ogOQdRUqqbNFP0icuCOvh3EweK9TYjnOlDY5fZUZdcf6kNzQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;760&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;常见分布式事务组件：Seata 、Atomikos、bitronix、Narayana等&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;常见分布式事务组件&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下面是它们的优缺点和适用场景：&lt;/p&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Seata&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;优点：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;支持多种分布式事务模型，包括 AT、TCC、SAGA 和 XA。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;具有高可用性和高可靠性，支持多种注册中心和存储模式。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;支持多种语言和框架，适用于各种应用场景。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;缺点：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;对于一些复杂的事务场景，需要进行一定的配置和调试。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;目前社区还比较小，文档和案例不是很丰富。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;适用场景：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;高并发、高可用的分布式系统。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;支持多种分布式事务模型的业务系统。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Atomikos&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;优点：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;支持 JTA 和非 JTA 事务。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;支持多种资源管理器和数据库。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;具有高性能和高可靠性。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;缺点：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;对于一些复杂的事务场景，需要进行一定的配置和调试。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;需要付费使用。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;适用场景：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;对于需要支持 JTA 的业务系统。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;对于需要高可靠性和高性能的业务系统。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;bitronix&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;优点：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;支持 JTA 和非 JTA 事务。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;具有高性能和高可靠性。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;免费使用。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;缺点：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;对于一些复杂的事务场景，需要进行一定的配置和调试。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;文档和案例相对较少。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;适用场景：&lt;/p&gt;&lt;ol data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;对于需要支持 JTA 的业务系统。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;对于需要高可靠性和高性能的业务系统。&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;还有Narayana也能实现分布式事务，一种开源的Java事务管理器，支持XA协议和非XA事务管理，也支持TCC和Saga事务管理。&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;什么是分布式事务&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;分布式事务是指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分布式系统的不同节点之上。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;什么场景会导致分布式事务？&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;1、典型的场景就是微服务架构 微服务之间通过远程调用完成事务操作。比如：订单微服务和库存微服务，下单的同时订单微服务请求库存微服务减库存。简言之：跨JVM进程产生分布式事务。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;2、单体系统访问多个数据库实例 当单体系统需要访问多个数据库（实例）时就会产生分布式事务。比如：用户信息和订单信息分别在两个MySQL实例存储，用户管理系统删除用户信息，需要分别删除用户信息及用户的订单信息，由于数据分布在不同的数据实例，需要通过不同的数据库链接去操作数据，此时产生分布式事务。简言之：跨数据库实例产生分布式事务。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;3、多服务访问同一个数据库实例 比如：订单微服务和库存微服务即使访问同一个数据库也会产生分布式事务，原因就是跨JVM进程，两个微服务持有了不同的数据库链接进行数据库操作，此时产生分布式事务。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;Seata 是什么？&lt;span/&gt;&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;Seata 是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务。在 Seata 开源之前，其内部版本在阿里系内部一直扮演着应用架构层数据一致性的中间件角色，帮助经济体平稳的度过历年的双11，对上层业务进行了有力的技术支撑。经过多年沉淀与积累，其商业化产品先后在阿里云、金融云上售卖。2019.1 为了打造更加完善的技术生态和普惠技术成果，Seata 正式宣布对外开源，未来 Seata 将以社区共建的形式帮助用户快速落地分布式事务解决方案。&lt;/p&gt;&lt;p&gt;Seata 是一款阿里巴巴开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务。&lt;/p&gt;&lt;p&gt;目前已支持Dubbo、Spring Cloud、Sofa-RPC、Motan 和 gRPC 等RPC框架，其他框架持续集成中&lt;/p&gt;&lt;p&gt;--------来自官网&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;四种事务模式&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;XA：强一致性，基于数据库隔离，无代码侵入，在一阶段不提交事务&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;AT：默认模式，基于全局锁隔离，无代码侵入，一阶段提交事务，在提交事务前，会记录undolog日志，性能比XA模式好，二阶段TC通知回滚，则根据undolog回滚，通知提交，则删除undolog日志。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;TCC:性能最好，不需要依赖关系型数据库，但代码入侵读高。Try:冻结可用数据，Confirm:确认提交数据，删除冻结数据  Canel:恢复数据，将冻结数据恢复&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Seaga: 用于长事务，例如A项目调另外一个公司的项目接口。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;分布式事务常见解决方案&lt;/h3&gt;&lt;section&gt;&lt;span&gt;在分布式系统中要实现分布式事务，常见的解决方案有&lt;strong&gt;两段提交(2PC)&lt;/strong&gt;、&lt;strong&gt;三段提交(3PC)&lt;/strong&gt;、&lt;strong&gt;事务补偿(TCC)&lt;/strong&gt;、&lt;strong&gt;本地消息表(异步确保)&lt;/strong&gt;、&lt;strong&gt;MQ事务方案(可靠消息事务)&lt;/strong&gt;、&lt;strong&gt;最大努力通知&lt;/strong&gt;和&lt;strong&gt;Saga事务&lt;/strong&gt;。 &lt;/span&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;安装&lt;span/&gt;&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;本案例使用Nacos作为服务注册中心和分布式配置中心，请先准备好Nacos环境。&lt;/p&gt;&lt;p&gt;seata-server为release版本1.4.2，demo采用本地单机部署&lt;/p&gt;&lt;p&gt;本文采用seata的默认模式：AT模式&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Seata下载地址：https://github.com/seata/seata/releases&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;下载到本地后解压，接着修改相关配置：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;第一步：&lt;code&gt;conf/registry.conf&lt;/code&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;registry&lt;/span&gt; &lt;span&gt;{&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;type&lt;/span&gt; &lt;span&gt;=&lt;/span&gt; &lt;span&gt;&quot;nacos&quot;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;  &lt;span&gt;nacos&lt;/span&gt; &lt;span&gt;{&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;serverAddr&lt;/span&gt; &lt;span&gt;=&lt;/span&gt; &lt;span&gt;&quot;127.0.0.1&quot;&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;=&lt;/span&gt; &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;cluster&lt;/span&gt; &lt;span&gt;=&lt;/span&gt; &lt;span&gt;&quot;default&quot;&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span&gt;config&lt;/span&gt; &lt;span&gt;{&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;type&lt;/span&gt; &lt;span&gt;=&lt;/span&gt; &lt;span&gt;&quot;nacos&quot;&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;nacos&lt;/span&gt; &lt;span&gt;{&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;serverAddr&lt;/span&gt; &lt;span&gt;=&lt;/span&gt; &lt;span&gt;&quot;127.0.0.1&quot;&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;namespace&lt;/span&gt; &lt;span&gt;=&lt;/span&gt; &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;cluster&lt;/span&gt; &lt;span&gt;=&lt;/span&gt; &lt;span&gt;&quot;default&quot;&lt;/span&gt;&lt;br/&gt;  &lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;不想相关的都删掉。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;第二步：在conf目录仙剑文件：config.txt，内容：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;transport.type=TCP&lt;br/&gt;transport.server=NIO&lt;br/&gt;transport.heartbeat=true&lt;br/&gt;transport.enableTmClientBatchSendRequest=false&lt;br/&gt;transport.enableRmClientBatchSendRequest=true&lt;br/&gt;transport.enableTcServerBatchSendResponse=false&lt;br/&gt;transport.rpcRmRequestTimeout=30000&lt;br/&gt;transport.rpcTmRequestTimeout=30000&lt;br/&gt;transport.rpcTcRequestTimeout=30000&lt;br/&gt;transport.threadFactory.bossThreadPrefix=NettyBoss&lt;br/&gt;transport.threadFactory.workerThreadPrefix=NettyServerNIOWorker&lt;br/&gt;transport.threadFactory.serverExecutorThreadPrefix=NettyServerBizHandler&lt;br/&gt;transport.threadFactory.shareBossWorker=false&lt;br/&gt;transport.threadFactory.clientSelectorThreadPrefix=NettyClientSelector&lt;br/&gt;transport.threadFactory.clientSelectorThreadSize=1&lt;br/&gt;transport.threadFactory.clientWorkerThreadPrefix=NettyClientWorkerThread&lt;br/&gt;transport.threadFactory.bossThreadSize=1&lt;br/&gt;transport.threadFactory.workerThreadSize=default&lt;br/&gt;transport.shutdown.wait=3&lt;br/&gt;transport.serialization=seata&lt;br/&gt;transport.compressor=none&lt;br/&gt;#service.vgroupMapping.order-service-group=default&lt;br/&gt;service.default.grouplist=127.0.0.1:8091&lt;br/&gt;service.enableDegrade=false&lt;br/&gt;service.disableGlobalTransaction=false&lt;br/&gt;client.rm.asyncCommitBufferLimit=10000&lt;br/&gt;client.rm.lock.retryInterval=10&lt;br/&gt;client.rm.lock.retryTimes=30&lt;br/&gt;client.rm.lock.retryPolicyBranchRollbackOnConflict=true&lt;br/&gt;client.rm.reportRetryCount=5&lt;br/&gt;client.rm.tableMetaCheckEnable=true&lt;br/&gt;client.rm.tableMetaCheckerInterval=60000&lt;br/&gt;client.rm.sqlParserType=druid&lt;br/&gt;client.rm.reportSuccessEnable=false&lt;br/&gt;client.rm.sagaBranchRegisterEnable=false&lt;br/&gt;client.rm.sagaJsonParser=fastjson&lt;br/&gt;client.rm.tccActionInterceptorOrder=-2147482648&lt;br/&gt;client.tm.commitRetryCount=5&lt;br/&gt;client.tm.rollbackRetryCount=5&lt;br/&gt;client.tm.defaultGlobalTransactionTimeout=60000&lt;br/&gt;client.tm.degradeCheck=false&lt;br/&gt;client.tm.degradeCheckAllowTimes=10&lt;br/&gt;client.tm.degradeCheckPeriod=2000&lt;br/&gt;client.tm.interceptorOrder=-2147482648&lt;br/&gt;client.undo.dataValidation=true&lt;br/&gt;client.undo.logSerialization=jackson&lt;br/&gt;client.undo.onlyCareUpdateColumns=true&lt;br/&gt;server.undo.logSaveDays=7&lt;br/&gt;server.undo.logDeletePeriod=86400000&lt;br/&gt;client.undo.logTable=undo_log&lt;br/&gt;client.undo.compress.enable=true&lt;br/&gt;client.undo.compress.type=zip&lt;br/&gt;client.undo.compress.threshold=64k&lt;br/&gt;tcc.fence.logTableName=tcc_fence_log&lt;br/&gt;tcc.fence.cleanPeriod=1h&lt;br/&gt;log.exceptionRate=100&lt;br/&gt;store.mode=file&lt;br/&gt;store.lock.mode=file&lt;br/&gt;store.session.mode=file&lt;br/&gt;store.publicKey=&lt;br/&gt;store.file.dir=file_store/data&lt;br/&gt;store.file.maxBranchSessionSize=16384&lt;br/&gt;store.file.maxGlobalSessionSize=512&lt;br/&gt;store.file.fileWriteBufferCacheSize=16384&lt;br/&gt;store.file.flushDiskMode=async&lt;br/&gt;store.file.sessionReloadReadSize=100&lt;br/&gt;store.db.datasource=druid&lt;br/&gt;store.db.dbType=mysql&lt;br/&gt;store.db.driverClassName=com.mysql.jdbc.Driver&lt;br/&gt;store.db.url=jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;amp;rewriteBatchedStatements=true&lt;br/&gt;store.db.user=root&lt;br/&gt;store.db.password=123456&lt;br/&gt;store.db.minConn=5&lt;br/&gt;store.db.maxConn=30&lt;br/&gt;store.db.globalTable=global_table&lt;br/&gt;store.db.branchTable=branch_table&lt;br/&gt;store.db.distributedLockTable=distributed_lock&lt;br/&gt;store.db.queryLimit=100&lt;br/&gt;store.db.lockTable=lock_table&lt;br/&gt;store.db.maxWait=5000#&lt;br/&gt;store.redis.mode=single&lt;br/&gt;store.redis.single.host=127.0.0.1&lt;br/&gt;store.redis.single.port=6379&lt;br/&gt;store.redis.sentinel.masterName=&lt;br/&gt;store.redis.sentinel.sentinelHosts=&lt;br/&gt;store.redis.maxConn=10&lt;br/&gt;store.redis.minConn=1&lt;br/&gt;store.redis.maxTotal=100&lt;br/&gt;store.redis.database=0&lt;br/&gt;store.redis.password=&lt;br/&gt;store.redis.queryLimit=100&lt;br/&gt;server.recovery.committingRetryPeriod=1000&lt;br/&gt;server.recovery.asynCommittingRetryPeriod=1000&lt;br/&gt;server.recovery.rollbackingRetryPeriod=1000&lt;br/&gt;server.recovery.timeoutRetryPeriod=1000&lt;br/&gt;server.maxCommitRetryTimeout=-1&lt;br/&gt;server.maxRollbackRetryTimeout=-1&lt;br/&gt;server.rollbackRetryTimeoutUnlockEnable=false&lt;br/&gt;server.distributedLockExpireTime=10000&lt;br/&gt;server.xaerNotaRetryTimeout=60000&lt;br/&gt;server.session.branchAsyncQueueSize=5000&lt;br/&gt;server.session.enableBranchAsyncRemove=false&lt;br/&gt;server.enableParallelRequestHandle=false#Metrics configuration, only for the server&lt;br/&gt;metrics.enabled=false&lt;br/&gt;metrics.registryType=compact&lt;br/&gt;metrics.exporterList=prometheus&lt;br/&gt;metrics.exporterPrometheusPort=9898&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;注意把这个配置文件汇总的mysql相关配置改成你的mysql相关的配置。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里的seata数据库包含三张表：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;DROP&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;IF&lt;/span&gt; &lt;span&gt;EXISTS&lt;/span&gt; &lt;span&gt;`branch_table`&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;`branch_table`&lt;/span&gt; (&lt;br/&gt;  &lt;span&gt;`branch_id`&lt;/span&gt; &lt;span&gt;bigint&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`xid`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;128&lt;/span&gt;) &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`transaction_id`&lt;/span&gt; &lt;span&gt;bigint&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`resource_group_id`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;32&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`resource_id`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;256&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`lock_key`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;128&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`branch_type`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;8&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`status`&lt;/span&gt; &lt;span&gt;tinyint&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`client_id`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;64&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`application_data`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;2000&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`gmt_create`&lt;/span&gt; datetime &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`gmt_modified`&lt;/span&gt; datetime &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  PRIMARY &lt;span&gt;KEY&lt;/span&gt; (&lt;span&gt;`branch_id`&lt;/span&gt;),&lt;br/&gt;  &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`idx_xid`&lt;/span&gt; (&lt;span&gt;`xid`&lt;/span&gt;)&lt;br/&gt;) &lt;span&gt;ENGINE&lt;/span&gt;=&lt;span&gt;InnoDB&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CHARSET&lt;/span&gt;=utf8mb4 &lt;span&gt;COLLATE&lt;/span&gt;=utf8mb4_0900_ai_ci;&lt;br/&gt;&lt;span&gt;DROP&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;IF&lt;/span&gt; &lt;span&gt;EXISTS&lt;/span&gt; &lt;span&gt;`global_table`&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;`global_table`&lt;/span&gt; (&lt;br/&gt;  &lt;span&gt;`xid`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;128&lt;/span&gt;) &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`transaction_id`&lt;/span&gt; &lt;span&gt;bigint&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`status`&lt;/span&gt; &lt;span&gt;tinyint&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`application_id`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;64&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`transaction_service_group`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;64&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`transaction_name`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;64&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`timeout`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`begin_time`&lt;/span&gt; &lt;span&gt;bigint&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`application_data`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;2000&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`gmt_create`&lt;/span&gt; datetime &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`gmt_modified`&lt;/span&gt; datetime &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  PRIMARY &lt;span&gt;KEY&lt;/span&gt; (&lt;span&gt;`xid`&lt;/span&gt;),&lt;br/&gt;  &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`idx_gmt_modified_status`&lt;/span&gt; (&lt;span&gt;`gmt_modified`&lt;/span&gt;,&lt;span&gt;`status`&lt;/span&gt;),&lt;br/&gt;  &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`idx_transaction_id`&lt;/span&gt; (&lt;span&gt;`transaction_id`&lt;/span&gt;)&lt;br/&gt;) &lt;span&gt;ENGINE&lt;/span&gt;=&lt;span&gt;InnoDB&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CHARSET&lt;/span&gt;=utf8mb4 &lt;span&gt;COLLATE&lt;/span&gt;=utf8mb4_0900_ai_ci;&lt;br/&gt;&lt;span&gt;DROP&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;IF&lt;/span&gt; &lt;span&gt;EXISTS&lt;/span&gt; &lt;span&gt;`lock_table`&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;`lock_table`&lt;/span&gt; (&lt;br/&gt;  &lt;span&gt;`row_key`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;128&lt;/span&gt;) &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`xid`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;96&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`transaction_id`&lt;/span&gt; mediumtext,&lt;br/&gt;  &lt;span&gt;`branch_id`&lt;/span&gt; mediumtext,&lt;br/&gt;  &lt;span&gt;`resource_id`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;256&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`table_name`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;32&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`pk`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;32&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`gmt_create`&lt;/span&gt; datetime &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`gmt_modified`&lt;/span&gt; datetime &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  PRIMARY &lt;span&gt;KEY&lt;/span&gt; (&lt;span&gt;`row_key`&lt;/span&gt;)&lt;br/&gt;) &lt;span&gt;ENGINE&lt;/span&gt;=&lt;span&gt;InnoDB&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CHARSET&lt;/span&gt;=utf8mb4 &lt;span&gt;COLLATE&lt;/span&gt;=utf8mb4_0900_ai_ci;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;第四步：修改conf配置文件，&lt;code&gt;file.conf&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;修改：&lt;code&gt;mode = &quot;db&quot;&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再把数据库相关配置项修改为自己数据库的配置信息。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;第五步：在Nacos上添加配置：&lt;/p&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;Data Id=seataServer.properties&lt;/p&gt;&lt;p&gt;Group=SEATA_GROUP&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;配置内容：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;store.publicKey=123456&lt;br/&gt;store.db.datasource=druid&lt;br/&gt;store.db.dbType=mysql&lt;br/&gt;store.db.driverClassName=com.mysql.cj.jdbc.Driver&lt;br/&gt;store.db.url=jdbc:mysql://localhost:3306/seata?characterEncoding=utf8&amp;amp;useSSL=false&amp;amp;serverTimezone=GMT%2B8&amp;amp;allowPublicKeyRetrieval=true&lt;br/&gt;store.db.user=root&lt;br/&gt;store.db.password=123456&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;记得选properties文件类型。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;第六步：项目中配置resources目录下创建&lt;code&gt;registry.conf&lt;/code&gt;文件。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;文件内容：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;registry {&lt;br/&gt;  type = &quot;nacos&quot;&lt;br/&gt;&lt;br/&gt;  nacos {&lt;br/&gt;application = &quot;seata-server&quot;&lt;br/&gt;    serverAddr = &quot;127.0.0.1:8848&quot;&lt;br/&gt;    group = &quot;SEATA_GROUP&quot;&lt;br/&gt;    namespace = &quot;&quot;&lt;br/&gt;    cluster = &quot;default&quot;&lt;br/&gt;    username = &quot;nacos&quot;&lt;br/&gt;    password = &quot;nacos&quot;&lt;br/&gt;  }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;config {&lt;br/&gt;  type = &quot;nacos&quot;&lt;br/&gt;&lt;br/&gt;  nacos {&lt;br/&gt;    serverAddr = &quot;127.0.0.1:8848&quot;&lt;br/&gt;    namespace = &quot;&quot;&lt;br/&gt;    group = &quot;SEATA_GROUP&quot;&lt;br/&gt;    username = &quot;nacos&quot;&lt;br/&gt;    password = &quot;nacos&quot;&lt;br/&gt;    dataId = &quot;seataServer.properties&quot;&lt;br/&gt;  }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;注意：这里面的group、dataId对应Nacos中的分布式配置。&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;第七步：在&lt;code&gt;application.properties&lt;/code&gt;配置文件中。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;# Nacos 注册中心地址&lt;br/&gt;spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848&lt;br/&gt;# seata 服务分组，要与服务端nacos-config.txt中service.vgroup_mapping的后缀对应&lt;br/&gt;seata.tx-service-group=stock-service-group&lt;br/&gt;seata.service.vgroup-mapping.stock-service-group=default&lt;br/&gt;logging.level.io.seata=debug&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;第八步，启动&lt;code&gt;seata&lt;/code&gt;。双击&lt;code&gt;seata-server-1.4.2/bin&lt;/code&gt;下面的&lt;code&gt;seata-server.bat&lt;/code&gt;。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.631578947368421&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/07BicZywOVtkibJ1RzJYUvNBBjKPWJYWMEnV7Sic8DLVSs0TLnbYrLibXGVzXtfueQnz56tx82GAXPwnVlDViakPF1g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;665&quot;/&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;业务场景&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;用户下单：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;扣除库存--库存表中库存数量减少&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;生成订单--订单表新增一条订单数据&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;项目核心代码&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;stock-service 服务&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;service&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Transactional&lt;/span&gt;(rollbackFor = Exception&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;deduct&lt;/span&gt;(&lt;span&gt;String&lt;/span&gt; &lt;span&gt;commodityCode&lt;/span&gt;, &lt;span&gt;int&lt;/span&gt; &lt;span&gt;count&lt;/span&gt;) &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;if&lt;/span&gt; (commodityCode.equals(&lt;span&gt;&quot;product-2&quot;&lt;/span&gt;)) {&lt;br/&gt;        &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RuntimeException(&lt;span&gt;&quot;异常:模拟业务异常:stock branch exception&quot;&lt;/span&gt;);&lt;br/&gt;    }&lt;br/&gt;&lt;br/&gt;    QueryWrapper&amp;lt;Stock&amp;gt; wrapper = &lt;span&gt;new&lt;/span&gt; QueryWrapper&amp;lt;&amp;gt;();&lt;br/&gt;    wrapper.setEntity(&lt;span&gt;new&lt;/span&gt; Stock().setCommodityCode(commodityCode));&lt;br/&gt;    Stock stock = stockDAO.selectOne(wrapper);&lt;br/&gt;    stock.setCount(stock.getCount() - count);&lt;br/&gt;&lt;br/&gt;    stockDAO.updateById(stock);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;controller&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@RestController&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@RequestMapping&lt;/span&gt;(&lt;span&gt;&quot;stock&quot;&lt;/span&gt;)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;StockController&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;@Resource&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; StockService stockService;&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;/**&lt;br/&gt;     * 减库存&lt;br/&gt;     *&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; commodityCode 商品代码&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; count         数量&lt;br/&gt;     * &lt;span&gt;@return&lt;/span&gt;&lt;br/&gt;     */&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;@RequestMapping&lt;/span&gt;(path = &lt;span&gt;&quot;/deduct&quot;&lt;/span&gt;)&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Boolean &lt;span&gt;deduct&lt;/span&gt;&lt;span&gt;(String commodityCode, Integer count)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        stockService.deduct(commodityCode, count);&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;;&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;strong&gt;order-service服务&lt;/strong&gt;：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@FeignClient&lt;/span&gt;(name = &lt;span&gt;&quot;stock-service&quot;&lt;/span&gt;)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;interface&lt;/span&gt; &lt;span&gt;StockFeignClient&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;@GetMapping&lt;/span&gt;(&lt;span&gt;&quot;stock/deduct&quot;&lt;/span&gt;)&lt;br/&gt;    &lt;span&gt;Boolean &lt;span&gt;deduct&lt;/span&gt;&lt;span&gt;(@RequestParam(&lt;span&gt;&quot;commodityCode&quot;&lt;/span&gt;)&lt;/span&gt; String commodityCode, @&lt;span&gt;RequestParam&lt;/span&gt;&lt;span&gt;(&lt;span&gt;&quot;count&quot;&lt;/span&gt;)&lt;/span&gt; Integer count)&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;OrderService&lt;/span&gt; &lt;/span&gt;{ &lt;br/&gt;    &lt;span&gt;@Resource&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; StockFeignClient stockFeignClient;&lt;br/&gt;    &lt;span&gt;@Resource&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; OrderDAO orderDAO;&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;/**&lt;br/&gt;     * 下单：创建订单、减库存，涉及到两个服务&lt;br/&gt;     *&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; userId&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; commodityCode&lt;br/&gt;     * &lt;span&gt;@param&lt;/span&gt; count&lt;br/&gt;     */&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;@GlobalTransactional&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;@Transactional&lt;/span&gt;(rollbackFor = Exception&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;)&lt;br/&gt;    &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;placeOrder&lt;/span&gt;(&lt;span&gt;String&lt;/span&gt; &lt;span&gt;userId&lt;/span&gt;, &lt;span&gt;String&lt;/span&gt; &lt;span&gt;commodityCode&lt;/span&gt;, &lt;span&gt;Integer&lt;/span&gt; &lt;span&gt;count&lt;/span&gt;) &lt;/span&gt;{&lt;br/&gt;        BigDecimal orderMoney = &lt;span&gt;new&lt;/span&gt; BigDecimal(count).multiply(&lt;span&gt;new&lt;/span&gt; BigDecimal(&lt;span&gt;5&lt;/span&gt;));&lt;br/&gt;        Order order = &lt;span&gt;new&lt;/span&gt; Order().setUserId(userId).setCommodityCode(commodityCode).setCount(count).setMoney(&lt;br/&gt;            orderMoney);&lt;br/&gt;        orderDAO.insert(order);&lt;br/&gt;        stockFeignClient.deduct(commodityCode, count);&lt;br/&gt;&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;p&gt;&lt;code&gt;@GlobalTransactional&lt;/code&gt;   我们在业务代码部分，只需要关注这个注解就行，在你需要实现分布式事务的地方加上。&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Slf&lt;/span&gt;4j&lt;br/&gt;&lt;span&gt;@RestController&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@RequestMapping&lt;/span&gt;(&lt;span&gt;&quot;/order&quot;&lt;/span&gt;)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;OrderController&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;@Resource&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; OrderService orderService;&lt;br/&gt;    &lt;span&gt;@Resource&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; StockFeignClient stockFeignClient;&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;/**&lt;br/&gt;     * 下单：插入订单表、扣减库存，模拟回滚 &lt;br/&gt;     */&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;@RequestMapping&lt;/span&gt;(&lt;span&gt;&quot;/placeOrder/commit&quot;&lt;/span&gt;)&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Boolean &lt;span&gt;placeOrderCommit&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        orderService.placeOrder(&lt;span&gt;&quot;1&quot;&lt;/span&gt;, &lt;span&gt;&quot;product-1&quot;&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;;&lt;br/&gt;    }&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;/**&lt;br/&gt;     * 下单：插入订单表、扣减库存，模拟回滚 &lt;br/&gt;     */&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;@RequestMapping&lt;/span&gt;(&lt;span&gt;&quot;/placeOrder/rollback&quot;&lt;/span&gt;)&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; Boolean &lt;span&gt;placeOrderRollback&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;// product-2 扣库存时模拟了一个业务异常,&lt;/span&gt;&lt;br/&gt;        &lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;            orderService.placeOrder(&lt;span&gt;&quot;1&quot;&lt;/span&gt;, &lt;span&gt;&quot;product-2&quot;&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;        }&lt;span&gt;catch&lt;/span&gt; (Exception ex){&lt;br/&gt;            log.error(&lt;span&gt;&quot;----------&quot;&lt;/span&gt;,ex);&lt;br/&gt;        }&lt;br/&gt;        &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;;&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;每个数据库都必须见一张表：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;`undo_log`&lt;/span&gt; (&lt;br/&gt;  &lt;span&gt;`id`&lt;/span&gt; &lt;span&gt;bigint&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; AUTO_INCREMENT,&lt;br/&gt;  &lt;span&gt;`branch_id`&lt;/span&gt; &lt;span&gt;bigint&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`xid`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;100&lt;/span&gt;) &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`context`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;128&lt;/span&gt;) &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`rollback_info`&lt;/span&gt; longblob &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`log_status`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`log_created`&lt;/span&gt; datetime &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`log_modified`&lt;/span&gt; datetime &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`ext`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;100&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  PRIMARY &lt;span&gt;KEY&lt;/span&gt; (&lt;span&gt;`id`&lt;/span&gt;),&lt;br/&gt;  &lt;span&gt;UNIQUE&lt;/span&gt; &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`ux_undo_log`&lt;/span&gt; (&lt;span&gt;`xid`&lt;/span&gt;,&lt;span&gt;`branch_id`&lt;/span&gt;)&lt;br/&gt;) &lt;span&gt;ENGINE&lt;/span&gt;=&lt;span&gt;InnoDB&lt;/span&gt; AUTO_INCREMENT=&lt;span&gt;10&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CHARSET&lt;/span&gt;=utf8;&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;3.0886699507389164&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/07BicZywOVtkibJ1RzJYUvNBBjKPWJYWMEjCH0I4PbZjNHFLoY56QGBH9kXV6vYSMpZXqPHWDdpdMyia85NOHdtfA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;203&quot;/&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;figcaption&gt;&lt;br/&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其他的两个表：&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;`stock_tbl`&lt;/span&gt; (&lt;br/&gt;  &lt;span&gt;`id`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; AUTO_INCREMENT,&lt;br/&gt;  &lt;span&gt;`commodity_code`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;255&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`count`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;&#x27;0&#x27;&lt;/span&gt;,&lt;br/&gt;  PRIMARY &lt;span&gt;KEY&lt;/span&gt; (&lt;span&gt;`id`&lt;/span&gt;),&lt;br/&gt;  &lt;span&gt;UNIQUE&lt;/span&gt; &lt;span&gt;KEY&lt;/span&gt; &lt;span&gt;`commodity_code`&lt;/span&gt; (&lt;span&gt;`commodity_code`&lt;/span&gt;)&lt;br/&gt;) &lt;span&gt;ENGINE&lt;/span&gt;=&lt;span&gt;InnoDB&lt;/span&gt; AUTO_INCREMENT=&lt;span&gt;3&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CHARSET&lt;/span&gt;=utf8;&lt;br/&gt;&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;`order_tbl`&lt;/span&gt; (&lt;br/&gt;  &lt;span&gt;`id`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt; AUTO_INCREMENT,&lt;br/&gt;  &lt;span&gt;`user_id`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;255&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`commodity_code`&lt;/span&gt; &lt;span&gt;varchar&lt;/span&gt;(&lt;span&gt;255&lt;/span&gt;) &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;NULL&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`count`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;&#x27;0&#x27;&lt;/span&gt;,&lt;br/&gt;  &lt;span&gt;`money`&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;&#x27;0&#x27;&lt;/span&gt;,&lt;br/&gt;  PRIMARY &lt;span&gt;KEY&lt;/span&gt; (&lt;span&gt;`id`&lt;/span&gt;)&lt;br/&gt;) &lt;span&gt;ENGINE&lt;/span&gt;=&lt;span&gt;InnoDB&lt;/span&gt; AUTO_INCREMENT=&lt;span&gt;22&lt;/span&gt; &lt;span&gt;DEFAULT&lt;/span&gt; &lt;span&gt;CHARSET&lt;/span&gt;=utf8;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;库存：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.22884012539184953&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/07BicZywOVtkibJ1RzJYUvNBBjKPWJYWMEBBCZ2npPcpb1PN7bsKr670U1QKOSibcHiaVvM2AmQ2vEMPZBw8cGAvBw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;319&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;然后我们启动项目，测试；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;访问正常：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;GET&lt;span&gt; http://localhost:9091/order/placeOrder/commit&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;订单库数据库订单表插入成功：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.30493273542600896&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/07BicZywOVtkibJ1RzJYUvNBBjKPWJYWME64RMIZDwxKfeXiadmxA3ibgJOvHFWjexyyeR5qSD01MAun2Fj1IqUoWg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;446&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;库存扣除成功：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.42391304347826086&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/07BicZywOVtkibJ1RzJYUvNBBjKPWJYWMEhtNbBPTAVA4ycT3oPxHSYeEfic4Gn6Y4HicfrQIV5r9dh7uarM7DwRhA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;368&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再来掉一个模仿失败的场景，然数据库回滚；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;GET &lt;span&gt;http://localhost:9091/order/placeOrder/rollback&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.287962962962963&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/07BicZywOVtkibJ1RzJYUvNBBjKPWJYWMEyjFywdOCg9D1liaTe8UTfB9PCW0npAERMRUC79ic9rQGia5bmfvgmnSrQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;再去查订单表和库存表完全没有变化。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;到此，咱们使用seata实现的分布式事务就这么“&lt;strong&gt;轻松的&lt;/strong&gt;”完成了。&lt;img data-src=&quot;https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/Lol.png&quot; data-ratio=&quot;1&quot; data-w=&quot;128&quot;/&gt;，实话实说真不轻松，不行你按照官网文档试试。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;后记&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为什么要聊分布式事务？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;其实，我们在面试中多多少少都会问到相关的问题，不熟悉的减分，能回答出理论的加分但是不多，有实战项目的加分。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;另外，我最近在搞充&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247515880&amp;amp;idx=1&amp;amp;sn=502da2fa657cc56103c20d51bc9627f2&amp;amp;chksm=fd551603ca229f15e4be9131f35512546206ee94a8c85178d791254c055dbe5e2da82204f43b&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;电桩项目&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;strong&gt;电桩项目&lt;/strong&gt;&lt;/a&gt;时，因为整个项目规划分成多个子系统，数据库也拆分，在开发中遇到一个问题：用户采用积分兑换优惠券。积分在用户服务、优惠券在营销服务。这就需要同时操作两个数据库，并且要保证用户积分足够、优惠券数量足够。所以，思来想去还是使用seata来实现分布式事务。&lt;span/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247515880&amp;amp;idx=1&amp;amp;sn=502da2fa657cc56103c20d51bc9627f2&amp;amp;chksm=fd551603ca229f15e4be9131f35512546206ee94a8c85178d791254c055dbe5e2da82204f43b&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;手把手项目实战，搞完，直接写在简历上！&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;手把手项目实战，搞完，直接写在简历上！&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;如果有需要&lt;/span&gt;&lt;span&gt;简历修改、简历优化、简历包装、面试辅导、模拟面试、技术辅导、技术支持等，&lt;/span&gt;&lt;span&gt;欢迎加我微&lt;/span&gt;&lt;span&gt;（&lt;strong&gt;tj20120622&lt;/strong&gt;）&lt;/span&gt;。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;个人技术博客可刷题：&lt;span&gt;http://woaijava.cc/&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;回复&lt;span&gt;&lt;strong&gt;77&lt;/strong&gt;&lt;/span&gt; ，获取&lt;span&gt;《面试小抄2.0版》&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;回复&lt;span&gt;&lt;strong&gt;电子书&lt;/strong&gt;&lt;/span&gt;，获取后端必读的200本电子书籍。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;文章推荐&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247515734&amp;amp;idx=1&amp;amp;sn=90750e063f5123a6780e3f211e96ac46&amp;amp;chksm=fd5516bdca229fab80c04a331079e7db3f62ba0495865d1bd5a096d61ed493948925a5be227d&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;中厂，面试就问了4道题，凉了！&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;中厂，面试就问了4道题，凉了！&lt;/a&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247515726&amp;amp;idx=1&amp;amp;sn=14f786bf3cf3e7f8e9d48b071fa3a465&amp;amp;chksm=fd5516a5ca229fb3d8b87319d35275b711c3eebe320ebf92547dc69ac1a507872e74c5c9bcd6&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;分布式问题，你知道几个？&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;分布式问题，你知道几个？&lt;/a&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247515620&amp;amp;idx=1&amp;amp;sn=5145b9f4253762e323e78882d820e53a&amp;amp;chksm=fd55150fca229c19dae4afd01f7ebb69b511508c6bb3739ff869c426f06c5f8f578e24a118f9&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;应届生，实力已超6年，太卷了！&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;应届生，实力已超6年，太卷了！&lt;/a&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247515476&amp;amp;idx=1&amp;amp;sn=b173e42edc85b8568a8ba68e642a032a&amp;amp;chksm=fd5515bfca229ca94283d6f221c7d4ee09b85a55126dae861f5c385707fc7c1d0b3085e36081&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;手把手教你写简历，包装、优化！&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;手把手教你写简历，包装、优化！&lt;/a&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU4MDM3MDgyMA==&amp;amp;mid=2247515464&amp;amp;idx=1&amp;amp;sn=8520adec75fa5a027e52ae6a09e5400a&amp;amp;chksm=fd5515a3ca229cb54ddf6790be46bd4a7293025bd8b1dc64bf4632d432106af5d51224f1a03a&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;面试不问java，问MySQL，如何破局？&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;面试不问java，问MySQL，如何破局？&lt;/a&gt;&lt;/section&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>cb8fddfedaa841dba0f0225cea1f257a</guid>
<title>ChatGPT 讲的笑话原来都是重复的？研究人员这样说！</title>
<link>https://toutiao.io/k/duqhxar</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content&amp;#10;                       autoTypeSetting24psection&amp;#10;            &quot; id=&quot;js_content&quot;&gt;&lt;figure&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/t8lpVibticjQ7aemVOjcbwdTbffWKkkc8cYxK3VvibY4Ejy9KOcERR9ogicksbY3134yd1JQF3FrntVagWZmfia1rPQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;760&quot; title=&quot;null&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;德国研究人员Sophie Jentzsch和Kristian Kersting对OpenAI的ChatGPT-3.5进行了一项研究，他们检查了这款AI理解和生成幽默的能力。他们发现，这款AI对笑话的了解相当有限。在一次测试运行中，1,008个生成的笑话中有90%都是同样的25个笑话。这使他们得出结论，这些回应很可能是在AI模型的训练过程中学习和记忆的，而不是新生成的。&lt;/p&gt;&lt;p&gt;研究人员进行了一系列关于笑话生成、解释和检测的实验。他们让ChatGPT讲了一千次笑话，并发现所有的回应都在语法上是正确的，几乎所有的输出都只包含一个笑话。提示的变化没有任何明显的效果。&lt;/p&gt;&lt;p&gt;最常生成的前10个笑话是：&lt;/p&gt;&lt;p&gt;Q: Why did the scarecrow win an award? (140)&lt;br/&gt;&lt;span&gt;A: Because he was outstanding in his field.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;Q: Why did the tomato turn red? (122)&lt;br/&gt;A: Because it saw the salad dressing.&lt;/p&gt;&lt;p&gt;Q: Why was the math book sad? (121)&lt;br/&gt;A: Because it had too many problems.&lt;/p&gt;&lt;p&gt;Q: Why don&#x27;t scientists trust atoms? (119)&lt;br/&gt;A: Because they make up everything.&lt;/p&gt;&lt;p&gt;Q: Why did the cookie go to the doctor? (79)&lt;br/&gt;A: Because it was feeling crumbly.&lt;/p&gt;&lt;p&gt;Q: Why couldn&#x27;t the bicycle stand up by itself? (52)&lt;br/&gt;A: Because it was two-tired.&lt;/p&gt;&lt;p&gt;Q: Why did the frog call his insurance company? (36)&lt;br/&gt;A: He had a jump in his car.&lt;/p&gt;&lt;p&gt;Q: Why did the chicken cross the playground? (33)&lt;br/&gt;A: To get to the other slide.&lt;/p&gt;&lt;p&gt;Q: Why was the computer cold? (23)&lt;br/&gt;A: Because it left its Windows open.&lt;/p&gt;&lt;p&gt;Q: Why did the hipster burn his tongue? (21)&lt;br/&gt;A: He drank his coffee before it was cool.&lt;/p&gt;&lt;p&gt;尽管存在这些限制，研究人员指出，ChatGPT在幽默中对内容和含义的关注表明了朝着更全面的研究语言模型中的幽默理解的进步。他们计划继续研究大型语言模型中的幽默，特别是在未来评估OpenAI的GPT-4。根据我们的经验，他们可能会发现GPT-4也喜欢讲关于番茄的笑话。&lt;/p&gt;&lt;p&gt;&lt;span&gt;https://arstechnica.com/information-technology/2023/06/researchers-discover-that-chatgpt-prefers-repeating-25-jokes-over-and-over/&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;mp-style-type data-value=&quot;3&quot;/&gt;&lt;/p&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>