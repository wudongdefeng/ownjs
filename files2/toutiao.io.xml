<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>3950a01f9cc280144bf7955f12a573a2</guid>
<title>é†’é†’å§ï¼Œæœªæ¥ä¸ä¼šæœ‰ Go2 äº†ï¼</title>
<link>https://toutiao.io/k/d6zkan1</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content             autoTypeSetting24psection&amp;#10;            &quot; id=&quot;js_content&quot;&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç…é±¼ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é©¬ä¸Šæ˜¥èŠ‚äº†ï¼ŒèŠ‚å‰æœ€åä¸€æ›´ã€‚æå‰é¢„ç¥å¤§å®¶æ˜¥èŠ‚å¿«ä¹ï¼&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ¬å‘¨æœ«åœ¨å­¦ä¹ çš„æ—¶å€™ï¼Œçœ‹åˆ° Go å›¢é˜Ÿå¤§å½“å®¶ Russ Coxï¼ˆä¸‹ç§°ï¼šrscï¼‰åœ¨è¿‘æœŸåˆ†äº«çš„ã€Š&lt;span&gt;GopherCon 2022: Russ Cox - Compatibility: How Go Programs Keep Working&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;ã€‹ï¼Œè®²çš„æ˜¯ Go åœ¨å…¼å®¹æ€§æ–¹é¢çš„ç°æœ‰é—®é¢˜å’Œæ€è€ƒï¼Œè¿˜åŸ‹äº†ä¸ªæ–°é¢„æœŸã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.668693009118541&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/KVl0giak5ib4jtSWQDZX6Za6wCpMuV2KqiaGeMayMCUFgKsR79T9fjGNUcAxt3HGeWAxF4GgvVsBUHhjbud0qJ88Q/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1974&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»–æå‡ºäº†ä¸€ä¸ªæ–°çš„ Sloganï¼šâ€œGo is boring, and that&#x27;s good.ï¼ˆGo å¾ˆæ— èŠï¼Œè¿™å¾ˆå¥½ï¼‰â€ï¼ŒåŸå› åœ¨äºæ— èŠä»£è¡¨ç¨³å®šçš„ã€‚æ— èŠæ„å‘³ç€ä½ èƒ½å¤Ÿä¸“æ³¨äºä½ çš„å·¥ä½œï¼Œè€Œä¸æ˜¯æˆ‘ä»¬çš„å·¥ä½œã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5620360551431601&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/KVl0giak5ib4jtSWQDZX6Za6wCpMuV2KqiaH37qk8ZFmAcUxpsJiaopdia4CxWUkzwW1nyaMZWtvKOuVBlAIL5SeQ2Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1886&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ ¸å¿ƒæ¥è®²ï¼ŒGo å›¢é˜Ÿå¸Œæœ› Go è¶³å¤Ÿç®€æ´ï¼ŒGopher ä¸è¦æ•´å¤©å· Go çš„å„ç§å¥‡æ€å¦™è®¡ï¼Œè¦æŠŠç²¾åŠ›éƒ½å…³æ³¨åˆ°è‡ªå·±çš„å·¥ä½œä¸Šï¼Œä¸è¦å…³æ³¨ä»–ä»¬ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä¸€å¼€å§‹å¬èµ·æ¥å¤šå°‘æœ‰ç‚¹é“ç†å’Œè‡ªå·±çš„æƒ³æ³•ï¼Œå¬ç€å¬ç€è¿™ä¸ªè½¦å°±åˆ¹ä¸ä½äº†ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨æœ€åçš„æœ€åï¼Œrsc å†·ä¸ä¸çš„æ­£å¼å®˜å®£ï¼š&lt;strong&gt;ä¸ä¼šæœ‰ Go2 äº†ï¼Œä¼šä¸€ç›´ä¿æŒ Go1ï¼Œå°†ä¼šåŠ å€æŠ•å…¥å¯¹ Go1 å…¼å®¹æ€§çš„å»ºè®¾ï¼Œè¿™å°†éå¸¸æœ‰ä»·å€¼&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5630965005302226&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/KVl0giak5ib4jtSWQDZX6Za6wCpMuV2KqiazyXYMjjND86wmqiaXt38VibVYOtXSF5r2ic5NQBHxBl9aZo46xXDxwmAA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1886&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“ç„¶ï¼Œä»–ä¹Ÿè®²äº†ï¼Œç‹­ä¹‰é‡Œçš„ Go2 å¯èƒ½å·²ç»å‘ç”Ÿäº†ï¼Œåªæ˜¯æ…¢æ…¢è½¬ä¸ºäº† Go1 çš„æ–°ç‰¹æ€§èå…¥åˆ°äº† Go ä¹‹ä¸­ã€‚ï¼ˆæˆ‘å¾ˆæƒ³è¯´ï¼Œç‰ˆæœ¬å·ä¹Ÿè¿˜æ˜¯ Go1ï¼Œå¥½ä¸€ä¸ªæ„è¯†...ï¼‰&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ€é‡è¦çš„ï¼Œé‚£äº›æ²¡æ³•å…¼å®¹çš„ â€œæ–°â€ ä¸œè¥¿æ€ä¹ˆåŠï¼Ÿå¤§æ–¹å‘çš„å¤§æ‹›å·²ç»åœ¨å‰æ–‡ã€Š&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzUxMDI4MDc1NA==&amp;amp;mid=2247497881&amp;amp;idx=1&amp;amp;sn=91ab6e1c034d80621be301d2ae89b3e4&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;åŠ å¤§åŠ›åº¦ï¼Go å°†ä¼šå¢å¼º Go1 å‘åå…¼å®¹æ€§&lt;/a&gt;ã€‹æœ‰ä»‹ç»è¿‡ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ ¸å¿ƒä¹‹ä¸€ï¼š&lt;strong&gt;ä½¿ç”¨ Go å·¥ç¨‹ä¸­çš„ go.mod æ–‡ä»¶å†…çš„ go ç‰ˆæœ¬å·æ¥æ§åˆ¶ç¼–è¯‘&lt;/strong&gt;çš„é€‰æ‹©ï¼Œå†³å®šå„ä¸ªåº“åœ¨ä¸åŒ Go ç‰ˆæœ¬ä¸‹ä»¥ä¸åŒçš„è¡¨ç°æ¥åº”ç”¨å…¶ç‰¹æ€§ï¼Œå°†ä¼šå½±å“ç¼–è¯‘æ—¶çš„å†³å®šã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5616438356164384&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/KVl0giak5ib4jtSWQDZX6Za6wCpMuV2KqiacLU2XPFqabbA6brrkFw6vpX1DCYE8u5C3h2RAgQfreojJzub53C50g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1898&quot;/&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;ä¸»æ¨¡å—ï¼ˆmain module)ï¼šå£°æ˜ go ç‰ˆæœ¬æ˜¯ 1.19ï¼Œä»–å¯ä»¥ä½¿ç”¨æ³›å‹å’Œå¸¦ä¸‹åˆ’çº¿çš„æ•°å­—ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ¨¡å— A v1.0.0ï¼šå£°æ˜ go ç‰ˆæœ¬æ˜¯ 1.17ï¼Œæ¨¡å— A é‡Œçš„åŒ…ä¸å¯ä»¥ä½¿ç”¨æ³›å‹ï¼ˆ1.18 æ‰å¼€å§‹æ”¯æŒï¼‰ï¼Œå¸¦ä¸‹åˆ’çº¿çš„æ•°å­—å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ¨¡å— B v1.2.1ï¼šå£°æ˜ go ç‰ˆæœ¬æ˜¯ 1.12ï¼Œä¸¤è€…éƒ½ä¸èƒ½ç”¨ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨ä¸Šè¿°è¯´æ˜ä¸­ï¼Œä¸»æ¨¡å—ã€æ¨¡å— Aã€æ¨¡å— Bï¼Œåˆ†åˆ«æ ¹æ® go.mod å†…çš„ go ç‰ˆæœ¬å·ï¼Œåº”ç”¨åˆ°äº†ä¸åŒçš„å¯ç”¨ç‰¹æ€§ï¼ˆæœ‰çš„å¯ä»¥ç”¨æ³›å‹ï¼Œæœ‰çš„ä¸å¯ä»¥ç”¨å¸¦ä¸‹åˆ’çº¿çš„æ•°å­—ï¼Œæœ‰çš„éƒ½ä¸èƒ½ç”¨ç­‰ï¼‰ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™æœ¬è´¨æ˜¯ç»“åˆ Go modules åŸæœ¬çš„ä¾èµ–ç®¡ç†é€»è¾‘ï¼Œå†å¤ç”¨ go.mod çš„ go ç‰ˆæœ¬å·ç»™ä¸åŒç‰ˆæœ¬çš„ä¸åŒç‰¹æ€§æ¥åšå¥½ç¼–è¯‘çš„æ§åˆ¶é€»è¾‘ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœªæ¥å°†ä¸ä¼šæœ‰ Go2ï¼Œéƒ½ä¼šæ˜¯ Go1.xã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å·²ç»æ‰¾åˆ°èƒ½å¾€é‡Œå„ç§å¡çš„å§¿åŠ¿äº†ã€‚&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;æ¨èé˜…è¯»&lt;span/&gt;&lt;/h4&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;å‚è€ƒèµ„æ–™&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;[1]&lt;/span&gt;&lt;p&gt;GopherCon 2022: Russ Cox - Compatibility: How Go Programs Keep Working:&lt;em&gt;https://www.youtube.com/watch?v=v24wrd3RwGo&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;å…³æ³¨å’ŒåŠ ç…é±¼å¾®ä¿¡ï¼Œ&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;ä¸€æ‰‹æ¶ˆæ¯å’ŒçŸ¥è¯†ï¼Œæ‹‰ä½ è¿›æŠ€æœ¯äº¤æµç¾¤&lt;span&gt;&lt;span&gt;ğŸ‘‡&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9988738738738738&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/KVl0giak5ib4jVkzHVvaqjo3O0BIqDRJKkEyib7SJsryxHBFGsvek0FkdiczfJP6AdbWnK25DvlX3dY8wRObPbVJQg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;888&quot;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;section data-mpa-template=&quot;t&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;section data-mid=&quot;&quot; mpa-from-tpl=&quot;t&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.07106598984771574&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/486RHs1WbcgGib6o96dHbvGUGGwPicd8wusUGH1cXR29tM4bO0lNzialzkQhvU6m5ZUdaKibmcF2OQayjMe9Bia6iaXQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;394&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;ä½ å¥½ï¼Œæˆ‘æ˜¯ç…é±¼ï¼Œ&lt;span&gt;å‡ºç‰ˆè¿‡ Go ç•…é”€ä¹¦ã€ŠGo è¯­è¨€ç¼–ç¨‹ä¹‹æ—…ã€‹ï¼Œå†åˆ°è·å¾— GOPï¼ˆGo é¢†åŸŸæœ€æœ‰è§‚ç‚¹ä¸“å®¶ï¼‰è£èª‰ï¼Œ&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzUxMDI4MDc1NA==&amp;amp;mid=2247483854&amp;amp;idx=1&amp;amp;sn=ec422fbf4d846975f2930ddeb5e81373&amp;amp;chksm=f9041493ce739d85a4b987eece14da627206cdad798f645cc770868312e4a22b6df24804f186&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;ç‚¹å‡»è“å­—æŸ¥çœ‹æˆ‘çš„å‡ºä¹¦ä¹‹è·¯&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;ç‚¹å‡»è“å­—æŸ¥çœ‹æˆ‘çš„å‡ºä¹¦ä¹‹è·¯&lt;/a&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;ã€‚&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;æ—¥å¸¸åˆ†äº«é«˜è´¨é‡æ–‡ç« ï¼Œè¾“å‡º Go é¢è¯•ã€å·¥ä½œç»éªŒã€æ¶æ„è®¾è®¡ï¼Œ&lt;span&gt;åŠ å¾®ä¿¡æ‹‰è¯»è€…äº¤æµç¾¤ï¼Œå’Œå¤§å®¶äº¤æµï¼&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;mp-style-type data-value=&quot;3&quot;/&gt;&lt;/p&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>9bf2746ce8c4d352ba9ef917c7983649</guid>
<title>Web 3D ä»å…¥é—¨åˆ°è·‘è·¯</title>
<link>https://toutiao.io/k/ww8p4f5</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ¬æ–‡ä¸ºæ¥è‡ª &lt;strong&gt;å­—èŠ‚è·³åŠ¨-ä¸šåŠ¡ä¸­å°-å‰ç«¯å›¢é˜Ÿ&lt;/strong&gt; æˆå‘˜çš„æ–‡ç« ï¼Œå·²æˆæƒ ELab å‘å¸ƒã€‚&lt;/p&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å‰æƒ…æ¦‚è¦&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½œä¸ºåœ¨è¯¥é¢†åŸŸå°ç™½çš„æˆ‘ï¼Œåœ¨å‡†å¤‡è¯¥ä¸»é¢˜åˆ†äº«ä¹‹å‰ï¼Œæˆ‘ä¿¡å¿ƒæ»¡æ»¡çš„å»çŸ¥ä¹æŸ¥äº†ä¸‹ï¼Œå¦‚ä½•å­¦ä¹  WebGLï¼Ÿ&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;&lt;span&gt;å¦‚ä½•å…¥æ‰‹webGlä»¥åŠthree.jså‘¢? - çŸ¥ä¹&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;å‰ç«¯å¼€å‘è€…åº”è¯¥å¦‚ä½•å­¦ä¹ è®¡ç®—æœºå›¾å½¢å­¦ç›¸å…³çš„çŸ¥è¯†? - çŸ¥ä¹&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;å¤§ä¸‰è®¡ç®—æœºï¼Œæƒ³æ¥è§¦å›¾å½¢å­¦æ–¹é¢çš„çŸ¥è¯†ï¼Œç›´æ¥å­¦WebGLè¿˜æ˜¯OpenGL ? - çŸ¥ä¹&lt;/span&gt;&lt;sup&gt;[3]&lt;/sup&gt; ç­‰ .......&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ‘˜å–è‡ªçŸ¥ä¹å›å¤ï¼šå›¾å½¢ + æ•°å­¦ + ä½“ç³»ç»“æ„ + æ“ä½œç³»ç»Ÿ + è½¯ä»¶å·¥ç¨‹ + è®¾è®¡æ¨¡å¼ + ç¼–è¯‘åŸç† + (C++åŠŸåŠ›) â‰ˆ æ›´å¥½çš„3D è½¯ä»¶å·¥ç¨‹å¸ˆã€‚(ç„¶è€Œæˆ‘ä¸æƒ³æˆä¸ºæ›´å¥½çš„3D è½¯ä»¶å·¥ç¨‹å¸ˆ)&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åŒæ—¶ä¹Ÿçœ‹äº†å¾ˆå¤šå¤§ä½¬åˆ†äº«å­¦ä¹ è·¯å¾„ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;å›¾å½¢å­¦ å’Œ æ•°å­¦ æ‰“å¥½åŸºç¡€ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ç½‘å‹è¯´ï¼šæ¨èçœ‹3dæ•°å­¦åŸºç¡€è¿™æœ¬ä¹¦ï¼Œå­¦å¥½çº¿æ€§ä»£æ•°ï¼Œæ¥å£æœ¬è´¨å°±æ˜¯æ•°å­¦å’Œç‰©ç†ï¼Œæ¶‰åŠå¤§é‡çŸ©é˜µå˜æ¢...&lt;/p&gt;&lt;/blockquote&gt;&lt;ol start=&quot;2&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;é€‰æ‹©ä¸€ä¸ªé¢†åŸŸï¼ŒWeb (WebGLã€Threejs)ã€3Då¼•æ“ã€æ¸¸æˆ (Unity) .....&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ç½‘å‹è¯´ï¼šè¯­è¨€æ˜¯ä»¥ç¡¬ä»¶ä¸ºåŸºç¡€çš„ï¼Œå¦‚æœä½ äº†è§£CPUï¼Œå­¦ä¹ Cè¯­è¨€å¾ˆéšæ„ï¼ŒåŒæ ·ç€è‰²å™¨è¯­è¨€GLSLæ˜¯ç±»ä¼¼Cè¯­è¨€çš„é«˜çº§è¯­è¨€åœ¨GPUä¸Šæ‰§è¡Œçš„è¯­è¨€ï¼Œå­¦ä¹  WebGL APIå’Œç€è‰²å™¨è¯­è¨€æœ€å¥½å»äº†è§£GPUçš„æ¸²æŸ“ç®¡çº¿ã€å¯ç¼–ç¨‹ç€è‰²å™¨ã€‚è¯­è¨€å’Œç¡¬ä»¶åˆæ˜¯éš”ç¦»çš„ï¼Œæ²¡æœ‰å¿…è¦æ·±å…¥äº†è§£ç¡¬ä»¶ï¼ŒçŸ¥é“ä¸€ä¸ªå¤§æ¦‚å°è±¡å°±è¡Œã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;ol start=&quot;3&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;å¹²ï¼šä¸æ–­å­¦ä¹ ã€ä¸æ–­å®è·µã€ç›´åˆ°å¯ä»¥é€ è½®å­ï¼Œå†å¾ªç¯ ......&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;çœ‹äº†æ¯”è¾ƒå¤šçš„çŸ¥ä¹å›å¤åï¼Œæˆ‘å‘ç°è¿™ç©æ„å­¦ä¹ è·¯å¾„å’Œé—¨æ§›éƒ½æ¯”è¾ƒé«˜çš„ï¼Œéƒ½æ˜¯å’Œåº•å±‚ã€æ•°å­¦å¼ºç›¸å…³çš„ã€‚è€Œä¸” WebGL æŠ€æœ¯å’Œ Web å‰ç«¯æŠ€æœ¯è¿˜æ˜¯æœ‰æ¯”è¾ƒå¤§åŒºåˆ«ï¼Œæ„Ÿè§‰é™¤äº†åªæ˜¯å«&lt;code&gt;Web&lt;/code&gt;å¤–æ²¡åˆ«çš„ç›¸åŒå•¦ã€‚é€Ÿæˆæ˜¯ä¸å¯èƒ½çš„ï¼Œæœ‰å°¤å…¶åœ¨è¯¥é¢†åŸŸæˆ‘æ˜¯ä¸ªå°ç™½ï¼Œæ‰€ä»¥æœ¬æ¬¡åˆ†äº« (åˆ°æ­¤ç»“æŸ)ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1.048780487804878&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a80PcicPiaVteejHHrMRKRsIYshZeXogNFSZOVvfJibadibHxN9kKEocUxHw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;984&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ¬æ¬¡åˆ†äº«ï¼Œå¤§è‡´åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;æ¦‚å¿µç¯‡ï¼šæµ…æµ…äº†è§£è®¡ç®—æœºå›¾å½¢ç›¸å…³çŸ¥è¯†ã€‚å…ˆäº†è§£ OpenGLã€WebGLç­‰åº“æˆ–è¯­è¨€éƒ½æ˜¯å¹²ä»€ä¹ˆçš„ï¼›æ— è®ºæ˜¯åº“è¿˜æ˜¯è¯­è¨€ï¼Œæ ¸å¿ƒéƒ½æ˜¯ä¸ºäº†GPU æœåŠ¡çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç†è§£ GPU è®¾è®¡æ¨¡å‹ å’Œ å›¾å½¢æ¸²æŸ“ç®¡çº¿ï¼›ä»¥ä¸Šï¼Œæˆ‘ä»¬æ‰èƒ½å°†æŠ€èƒ½ç‚¹ä¸²èµ·æ¥ï¼ŒçŸ¥é“åç»­å‘åŠ›æ–¹å‘ å’Œ å¦‚ä½•å®è·µã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å®è·µç¯‡ï¼šå…ˆé€šè¿‡ Three.js å…¥ä¸ªé—¨ï¼Œå†çœ‹åç»­æ˜¯ æ·±å…¥å­¦ä¹  è¿˜æ˜¯ è·‘è·¯æ”¾å¼ƒã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;æ¦‚å¿µç¯‡ï¼šè®¡ç®—æœºå›¾å½¢ç›¸å…³çŸ¥è¯†&lt;/h1&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;Three.js? GLSL? WebGL? OpenGL?&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4029574861367837&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8ZHveZobH3J1RyVWaicJ9zNspspsXMVchlbOIibkqo9TAZqtib9Ts8ZX0Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1082&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‚è€ƒï¼š&lt;span&gt;WebGLï¼ŒOpenGLå’ŒOpenGL ESä¸‰è€…çš„å…³ç³»&lt;/span&gt;&lt;sup&gt;[4]&lt;/sup&gt; å›¾&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;OpenGL&lt;/strong&gt; (Open Graphics Library)&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;&lt;span&gt;OpenGL&lt;/span&gt;&lt;sup&gt;[5]&lt;/sup&gt; is a cross-language, cross-platform application programming interface (API) for rendering 2D and 3D vector graphics. The API is typically used to interact with a graphics processing unit (GPU), to achieve hardware-accelerated rendering.&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;OpenGL æ˜¯API ã€æ˜¯è§„èŒƒã€‚GPU ç¡¬ä»¶å‚å•†éœ€è¦æ»¡è¶³ç»Ÿä¸€OpenGLè§„èŒƒã€‚è€Œ OpenGL ES (Open Graphics Library for Embedded Systems) æ˜¯ OpenGL å­é›†ï¼Œä¸“é—¨é’ˆå¯¹æ‰‹æœºç­‰åµŒå…¥å¼è®¾å¤‡è€Œè®¾è®¡çš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;äººè¯ç‰ˆæœ¬æ˜¯ï¼šå‘åŠ¨æœº(GPU) é©±åŠ¨æ˜¯æ–¹å‘ç›˜ã€ç¦»åˆå™¨ç­‰ç­‰ï¼ŒOpenGL å®šä¹‰æ“çºµ å‘åŠ¨æœº(GPU) å‘åŠ¨è§„èŒƒï¼ŒOpenGL ä¸å…³å¿ƒæ–¹å‘ç›˜æ˜¯åœ†çš„è¿˜æ˜¯æ–¹çš„ï¼Œé©±åŠ¨ å‘åŠ¨æœº(GPU) å¹²æ´»å•¦ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;ç”¨æ–¹å‘ç›˜ (é©±åŠ¨å™¨) -&amp;gt; ä¾ç…§è°ƒç”¨æ ‡å‡†ä½¿ç”¨ (&lt;/strong&gt; &lt;strong&gt;OpenGL&lt;/strong&gt; &lt;strong&gt;) -&amp;gt; æŒ‡æŒ¥å‘åŠ¨æœº (&lt;/strong&gt; &lt;strong&gt;GPU&lt;/strong&gt; &lt;strong&gt;) å¹²æ´»&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;WebGL&lt;/strong&gt; (Web Graphics Library)&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;&lt;span&gt;WebGL&lt;/span&gt;&lt;sup&gt;[6]&lt;/sup&gt; is a cross-platform, royalty-free open web standard for a low-level 3D graphics API based on OpenGL ES, exposed to ECMAScript via the HTML5 Canvas element.&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;WebGL æ˜¯åœ¨ OpenGL ES åŸºç¡€ä¸Šå»ºç«‹çš„åœ¨ &lt;strong&gt;æµè§ˆå™¨&lt;/strong&gt; è·‘èµ·æ¥çš„å›¾å½¢å­¦æ ‡å‡†ï¼ŒåŒç†æ˜¯æµè§ˆå™¨å‚å•†è§„èŒƒ â‰ˆ è®©JS æ“ä½œæ¥å£ã€‚å…‰æœ‰è§„èŒƒæ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜è¦ç¨‹åºå‘Šè¯‰ GPU å¦‚ä½•è¿›è¡Œæ¸²æŸ“ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;GLSL&lt;/strong&gt; (OpenGL Shading Language)&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åé¢è®²åˆ°å›¾å½¢æ¸²æŸ“ç®¡çº¿ä¼šè¯´åˆ°ï¼Œè¿™é‡Œæµ…æµ…å…ˆé€šè¿‡ä¾‹å­æ„Ÿå—ä¸‹ &lt;span&gt;ç«‹æ–¹ä½“ demo&lt;/span&gt;&lt;sup&gt;[7]&lt;/sup&gt;ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;ä»£ç &lt;/span&gt;&lt;sup&gt;[8]&lt;/sup&gt; é˜‰å‰²ç‰ˆï¼šæœ‰ç±»Cè¯­è¨€çš„ç€è‰²å™¨è¯­è¨€ã€æœ‰æˆ‘ä»¬ç†Ÿæ‚‰JSè¯­è¨€ã€æœ‰çŸ©é˜µç›¸ä¹˜ ...&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;Â Â Â Â Â Â &lt;br/&gt;&amp;lt;canvasÂ id=&lt;span&gt;&quot;canvas&quot;&lt;/span&gt;&amp;gt;&amp;lt;/canvas&amp;gt;&lt;br/&gt;&amp;lt;scriptÂ &lt;span&gt;type&lt;/span&gt;=&lt;span&gt;&quot;shader-source&quot;&lt;/span&gt;Â id=&lt;span&gt;&quot;vertexShader&quot;&lt;/span&gt;&amp;gt;&lt;br/&gt;Â Â Â Â Â Â Â Â precisionÂ mediumpÂ &lt;span&gt;float&lt;/span&gt;;Â //Â æ¥æ”¶Â JavaScriptÂ ä¼ é€’è¿‡æ¥çš„ç‚¹çš„åæ ‡ï¼ˆX,Â Y,Â Zï¼‰&lt;br/&gt;Â Â Â Â Â Â Â Â attributeÂ vec3Â a_Position;&lt;br/&gt;Â Â Â Â Â Â Â Â attributeÂ vec4Â a_Color;Â //Â æ¥æ”¶é¡¶ç‚¹é¢œè‰²&lt;br/&gt;Â Â Â Â Â Â Â Â varyingÂ vec4Â v_Color;&lt;br/&gt;Â Â Â Â Â Â Â Â uniformÂ mat4Â u_Matrix;&lt;br/&gt;Â Â Â Â Â Â Â Â voidÂ &lt;span&gt;&lt;span&gt;main&lt;/span&gt;&lt;/span&gt;(){&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â gl_PositionÂ =Â u_MatrixÂ *Â vec4(a_Position,Â 1);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â v_ColorÂ =Â a_Color;Â //Â å°†é¡¶ç‚¹é¢œè‰²æ’å€¼å¤„ç†ä¼ é€’ç»™ç‰‡å…ƒç€è‰²å™¨&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â gl_PointSizeÂ =Â 5.0;&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;&amp;lt;/script&amp;gt;&lt;br/&gt;&amp;lt;scriptÂ &lt;span&gt;type&lt;/span&gt;=&lt;span&gt;&quot;shader-source&quot;&lt;/span&gt;Â id=&lt;span&gt;&quot;fragmentShader&quot;&lt;/span&gt;&amp;gt;&lt;br/&gt;Â Â Â Â Â Â Â Â precisionÂ mediumpÂ &lt;span&gt;float&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â varyingÂ vec4Â v_Color;&lt;br/&gt;Â Â Â Â Â Â Â Â voidÂ &lt;span&gt;&lt;span&gt;main&lt;/span&gt;&lt;/span&gt;(){&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â  gl_FragColor = v_Color;Â Â //Â ç‚¹çš„æœ€ç»ˆé¢œè‰²ã€‚&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;&amp;lt;/script&amp;gt;&lt;br/&gt;&amp;lt;script&amp;gt;Â //è·å–canvasletÂ &lt;br/&gt;Â Â Â Â Â Â Â Â canvasÂ =Â getCanvas(&lt;span&gt;&#x27;#canvas&#x27;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â //ä½¿ç”¨è¯¥ç€è‰²å™¨ç¨‹åº&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;let&lt;/span&gt;Â programÂ =Â createSimpleProgramFromScript(gl,Â &lt;span&gt;&#x27;vertexShader&#x27;&lt;/span&gt;,Â &lt;span&gt;&#x27;fragmentShader&#x27;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â gl.useProgram(program);&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;let&lt;/span&gt;Â positionsÂ =Â [&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â -0.5,Â -0.5,Â 0.5,Â 1,Â 0,Â 0,Â 1,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â 0.5,Â -0.5,Â 0.5,Â 1,Â 0,Â 0,Â 1,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â 0.5,Â 0.5,Â 0.5,Â 1,Â 0,Â 0,Â 1,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â -0.5,Â 0.5,Â 0.5,Â 1,Â 0,Â 0,Â 1,Â .....&lt;br/&gt;Â Â Â Â Â Â Â Â ]&lt;br/&gt;Â Â Â Â Â Â Â Â //Â -----Â çœç•¥ä¸€äº›ä»£ç Â -----&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;function&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;render&lt;/span&gt;&lt;/span&gt;()Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â //å…ˆç»• Y è½´æ—‹è½¬çŸ©é˜µã€‚&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â matrix.rotationY(deg2radians(yAngle),Â dstMatrix);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â //å†ç»•Â XÂ è½´æ—‹è½¬&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â matrix.multiply(dstMatrix,Â matrix.rotationX(deg2radians(xAngle),Â tmpMatrix),Â dstMatrix);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â //æ¨¡å‹æŠ•å½±çŸ©é˜µã€‚&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â matrix.multiply(projectionMatrix,Â dstMatrix,Â dstMatrix)&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â //Â -----Â çœç•¥ä¸€äº›ä»£ç Â -----&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â requestAnimationFrame(render);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â Â Â Â Â Â &lt;br/&gt;Â Â Â Â &amp;lt;/script&amp;gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;Three.js&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;WebGLå­¦ä¹ æœ‰é—¨æ§›ï¼Œ&lt;span&gt;Three.js&lt;/span&gt;&lt;sup&gt;[9]&lt;/sup&gt; ä½œä¸ºæ–¹å‘å…¥é—¨ï¼Œå°±åƒ jQuery ä¸€æ ·çš„å­˜åœ¨ï¼Œå¯ä»¥å¿«é€Ÿçš„åˆ›å»ºå‡ºä¸‰ç»´åœºæ™¯ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5563480741797432&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8IRgUiciaArtCgg5s66lSjyvvXHdGgGQPfwSoZCHDmibtaKWtYoxEX8G3A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2804&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;é˜¶æ®µæ€»ç»“&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè§„èŒƒ/æ¥å£å‘Šè¯‰é©±åŠ¨å¦‚ä½• å’Œ GPU é€šä¿¡ï¼Œè¿™ä¸ªè§„èŒƒ/æ¥å£æ˜¯ OpenGLï¼Œå‘å±•è‡³ä»ŠåµŒå…¥å¼è®¾å¤‡å´›èµ·ï¼ŒOpenGL ES ä¹Ÿåº”è¿è€Œç”Ÿï¼ŒWebGL æ˜¯åŸºäº OpenGL ES å¯ä»¥è®©å…¶åœ¨æµè§ˆå™¨ä¸Šé€šè¿‡Javascript è°ƒç”¨çš„è§„èŒƒ/æ¥å£ï¼Œä½†WebGLé—¨æ§›ä¸ä½ï¼Œè¦å’ŒGPUé€šä¿¡ï¼Œå°±éœ€è¦äº†è§£è®¡ç®—æœºå›¾å½¢å­¦çŸ¥è¯†ï¼Œé‚£è‚¯å®šä¹Ÿéœ€è¦ç”¨åˆ°ç€è‰²å™¨ï¼Œæ‰€ä»¥ Three.js å°è£…å¥½æˆä¸ºä¸‰ç»´å¼•æ“ï¼Œä¹Ÿä¸ç”¨çŸ¥é“é‚£ä¹ˆå¤šåº•å±‚çŸ¥è¯†ï¼Œå°±å¯ä»¥åˆ›å»º Web 3Dã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹å°±å¥½æ¯” æ·±åº¦å­¦ä¹ é¢†åŸŸï¼šTensorflow (xxx.js / Python) éƒ½å¯ä»¥è°ƒè°ƒç°æœ‰æˆç†Ÿæ¨¡å‹ï¼Œçœ‹èµ·æ¥æ˜¯è°ƒå‚æ•°ååˆ†çš„ç®€å•ï¼Œä½†æ˜¯æ¨¡å‹èƒŒåæ˜¯ çº¿æ€§ä»£æ•°ã€é«˜æ•°ã€ç»Ÿè®¡å­¦ ...&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;ç†è§£ GPU è®¾è®¡æ¨¡å‹&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»€ä¹ˆæ˜¯æ¸²æŸ“å‘¢ï¼Ÿç®€å•çš„è¯´å°±æ˜¯ä»è®¡ç®—æœºç¨‹åºæœ€ååˆ°å›¾åƒçš„è¿‡ç¨‹ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¤§å®¶é¢è¯•éƒ½ä¼šè¢«é—®åˆ°ä¸€ä¸ªé—®é¢˜ &lt;code&gt;ä»è¾“å…¥urlåˆ°é¡µé¢æ¸²æŸ“å®Œæˆï¼Œéƒ½ç»å†äº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/code&gt; å¤§éƒ¨åˆ†åŒå­¦éƒ½æ­¢æ­¥äº ....... ç”ŸæˆRender Treeã€‚é‚£åç»­æ˜¯å¦‚ä½•å°†å„ç§ä¿¡æ¯è½¬æ¢ä¸ºå±å¹•ä¸Šçš„åƒç´ å‘¢ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨è¯´æ˜æ¸²æŸ“è¿‡ç¨‹ä¹‹å‰ï¼Œå…ˆæ¥å¤§è‡´çœ‹ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ GPUï¼Ÿ&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;ä¸‹é¢ç»˜åˆ¶å›¾ç‰‡ï¼Œå¼•ç”¨æ¥è‡ªè¯¥æ–‡æ¡£ &lt;span&gt;The Book of Shaders by Patricio Gonzalez Vivo &amp;amp; Jen Lowe&lt;/span&gt;&lt;sup&gt;[10]&lt;/sup&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6589057043073341&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8CBYyBavqQLQuq13eDJ5j343N6sGEd0cmH5j7ibyF3WpN7iaRMHTGpmlw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1718&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¦å¯¹æ¯ä¸ªåƒç´ çš„è®¡ç®—ï¼Œå¦‚æ­¤è®¾è®¡æ¨¡å¼å¯¹CPUå‹åŠ›ä¼šæ¯”è¾ƒå¤§ï¼Œæ•…æœ‰ GPU ç»“æ„å»å¤„ç†è¯¥åœºæ™¯ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3919491525423729&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a84wia0Z7ho7F5hvcY3vnkiczNfckngnxXCLG5b9rLHd81sJy06GpudS5g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1888&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šè¿°è¿™ä¹ˆè®¾è®¡çš„åŸå› æ˜¯ï¼šå¯¹æ¯ä¸ªåƒç´ è¿›è¡Œè®¡ç®—ï¼Œè€Œä¸”æ˜¯ç›¸åŒçš„è¿ç®—ï¼Œè¿™æ ·å¹¶è¡Œè®¡ç®—çš„æ•ˆç‡ä¼šæ›´é«˜ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»¥ä¸Šå¯ä»¥ç†è§£ï¼šGPU è®¡ç®—èƒ½åŠ›ä¸å¦‚ CPUï¼Œä½†æ˜¯ GPU äººå¤šåŠ›é‡å¤§ (ç®¡å­å¤šï¼Œä¸”ç®¡å­åªå¤„ç†å·²çŸ¥ç®€å•ä»»åŠ¡)ï¼Œç±»æ¯”äº å»ºç­‘å·¥ç¨‹å¸ˆ (CPU) è®¾è®¡å‡ºæ¥å»ºç­‘å›¾çº¸å’Œæ¯é¡¹ä»»åŠ¡ï¼Œå·¥äººä»¬ (GPU) æ¬ç –å¹²æ´»ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ğŸ¤” è¿™äº›ç ´ç®¡å­éƒ½å¹²äº†äº›å•¥ï¼Ÿç€è‰²å™¨åˆæ˜¯ä»€ä¹ˆï¼Ÿå¿…é¡»æµ…æµ…äº†è§£ä¸‹ å›¾å½¢æ¸²æŸ“ç®¡çº¿ Render Pipelineã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.39113428943937417&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8Z4YdQUQI1mGRVT38tLDMbHsRfYvjL5eqLp5caEtiastuf4ia91ibvv9AA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1534&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;äº†è§£ å›¾å½¢æ¸²æŸ“ç®¡çº¿&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9147424511545293&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8GZpOtiaPiaFUuyQeleZd18JTtYJfoAdRroCgz3ke9afUlfgiaHGxBgEXA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;563&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å›é¡¾ä½ çš„å­¦ä¹ ç”Ÿæ¶¯ï¼Œåˆä¸­æ•°å­¦è®¡ç®—ç«‹æ–¹ä½“é¢ç§¯ï¼Œè€å¸ˆåœ¨ 2D é»‘æ¿ä¸Šç”»äº†XYZ è½´ï¼Œå¹¶éª—ä½ è¿™æ˜¯ä¸ª 3Dç«‹æ–¹ä½“(è§†è§‰ä¸Š)ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»»ä½•ç”¨3Dç©ºé—´ä¸­è¡¨ç¤ºçš„äº‹ç‰©ï¼Œåœ¨ ğŸ–¥ ä¸­éƒ½æ˜¯2Dåƒç´ æ•°ç»„ï¼Œè€ŒWebGL/OpenGL å¤§éƒ¨åˆ†å·¥ä½œä¹Ÿæ˜¯æŠŠ3Dåæ ‡è½¬æ¢ä¸º2Dåƒç´ ã€‚è¿™ä¸ªè¿‡ç¨‹å«åš &lt;strong&gt;å›¾å½¢æ¸²æŸ“ç®¡çº¿ Render&lt;/strong&gt; &lt;strong&gt;Pipeline&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç»“åˆä¸Šé¢é‚£äº›ä¸ªGPU æ¨¡å‹é‡Œçš„ç ´ç®¡å­ï¼Œæœ‰ä¸€å †åŸå§‹å›¾å½¢æ•°æ® ç»è¿‡ ä¸€ä¸ª ç ´ç®¡å­åï¼Œæœ€ç»ˆè¾“å‡ºè‡³å±å¹•ä¸­çš„è¿‡ç¨‹å°±æ˜¯ å›¾å½¢æ¸²æŸ“ç®¡çº¿ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å›¾å½¢æ¸²æŸ“ç®¡çº¿ Render Pipeline è¢«åˆ’åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼Œè·Ÿå’±ä»¬çš„ByteCycle æµæ°´çº¿ä¸€æ ·ï¼Œæ¯ä¸ªé˜¶æ®µä¼šæŠŠä¸Šä¸ªé˜¶æ®µçš„è¾“å‡ºä½œä¸ºè¾“å…¥ï¼Œä¹Ÿå¯ä»¥ç†è§£æ˜¯å‡½æ•°å¼ç¼–ç¨‹ pipeline æ¨¡å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸“é—¨çš„å‡½æ•° / å°ç¨‹åºå»å¤„ç†ï¼Œå‡½æ•° / å°ç¨‹åº â‰ˆ &lt;strong&gt;ç€è‰²å™¨ (Shader)&lt;/strong&gt; ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5004812319538018&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8GTvKffVoOhbP9vh6RF2moYhHOxicKibaMZxNznGOTicc5bFdumsTBiazJw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;2078&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;CPU å’Œ GPU æ˜¯é€šåŠ›åˆä½œçš„å…³ç³»æ¥æ¸²æŸ“å›¾åƒ&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.43818849449204406&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a87RyLzGkC2cic3DvficRCwys2dUGOv2QscShjPhIglMqSh2tC1Swrhlicw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1634&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¸²æŸ“ç®¡çº¿æŠ½è±¡æµç¨‹&lt;/p&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;strong&gt;é¡¶ç‚¹ç€è‰²å™¨&lt;/strong&gt;&lt;/th&gt;&lt;th&gt;3Dåæ ‡ è½¬ä¸º å¦ä¸€ç§3Dåæ ‡(åé¢ä¼šè§£é‡Š ä»å±€éƒ¨åˆ°ä¸–ç•Œåæ ‡ç³»)ï¼Œå¹¶å¯¹é¡¶ç‚¹å±æ€§è¿›è¡Œå¤„ç†ã€‚&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;å›¾å…ƒçš„è£…é…&lt;/td&gt;&lt;td&gt;å°† é¡¶ç‚¹ç€è‰²å™¨ è¾“å‡ºçš„ç‚¹ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç»˜åˆ¶æˆå›¾å…ƒå½¢çŠ¶ã€‚&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;å‡ ä½•ç€è‰²å™¨&lt;/td&gt;&lt;td&gt;å°† å›¾å…ƒå½¢çŠ¶ æ„é€ æˆæ–°çš„å›¾å…ƒ æˆ– å…¶ä»–å½¢çŠ¶ã€‚&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;å…‰æ …åŒ–è¿‡ç¨‹&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;æŠŠ å›¾å…ƒ æ˜ å°„ä¸º æœ€ç»ˆå±å¹•ä¸Šç›¸åº”çš„ åƒç´ ã€‚&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;ç‰‡æ®µç€è‰²å™¨&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;è®¡ç®—ä¸€ä¸ªåƒç´ çš„æœ€ç»ˆé¢œè‰²ã€‚ä¾‹å¦‚ä¸€ä¸ªç«‹æ–¹ä½“åœ¨ç¯å…‰ç…§å°„ä¸‹ä¼šæœ‰é˜´å½±ï¼Œè¿™é‡Œä¹Ÿä¼šå°†å…¶å¤„ç†ã€‚&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;æµ‹è¯•ä¸æ··åˆ&lt;/td&gt;&lt;td&gt;ä¾‹å¦‚ æœ‰3Dé®æŒ¡åœºæ™¯ æˆ– ç‰©ä½“æ˜¯é€æ˜ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å°±éœ€è¦åˆ¤æ–­æ˜¯å¦åœ¨è¯¥å¸§è¢«ä¸¢å¼ƒã€‚&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3843612334801762&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8wtRFrzAibcKsbHKI7uvIhicDwmjGkPR0PwDicib8reNJXdIEtLBIFf3Ricg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1816&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç®€å•äº†è§£ä¸‹GLSL è¯­è¨€ï¼Œç±»ä¼¼Cè¯­è¨€ï¼Œä»¥ä¸‹æ˜¯é¡¶ç‚¹ç€è‰²å™¨çš„ä¾‹å­ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;Â &lt;span&gt;#versionÂ 300Â esÂ Â #å£°æ˜äº†ç€è‰²å™¨ç‰ˆæœ¬å·Â 300Â ä»£è¡¨æ˜¯Â 3.0Â ä¹‹åç‰ˆæœ¬&lt;/span&gt;&lt;br/&gt;&lt;span&gt;in&lt;/span&gt;Â vec4Â aPosÂ ;&lt;br/&gt;&lt;span&gt;#Â inÂ =Â è¾“å…¥å˜é‡Â æµ®ç‚¹å‹å‘é‡vec4Â å˜é‡åç§°Â aPos&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#Â eg:Â aPosÂ =Â {1.0,Â 1.0,Â 1.0,Â 1.0}&lt;/span&gt;&lt;br/&gt;voidÂ &lt;span&gt;&lt;span&gt;main&lt;/span&gt;&lt;/span&gt;()&lt;br/&gt;{&lt;br/&gt;Â Â Â Â gl_PositionÂ =Â aPosÂ ;&lt;br/&gt;Â Â Â Â &lt;span&gt;#Â é¡¶ç‚¹ç€è‰²å™¨çš„å†…ç½®è¾“å‡ºå˜é‡&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;é˜¶æ®µæ€»ç»“&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åŸºäºæµè§ˆå™¨ï¼Œé€šè¿‡Javascript æ¥å®ç°ç¼–ç¨‹æŠ€æœ¯ï¼Œèƒ½åœ¨ 2Då±å¹• ä¸Šçœ‹åˆ° 3Dæ•ˆæœã€‚&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;åŸºç¡€èƒ½åŠ›ï¼šæ•°å­¦ã€ç‰©ç† ....&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;èƒ½åŠ›æ”¯æŒï¼šåŸºäº GPU å›¾å½¢æ¸²æŸ“ç®¡çº¿æ¶æ„è®¾è®¡ï¼Œåœ¨ Webç«¯ é€šè¿‡ WebGL (-&amp;gt; OpenGL ES -&amp;gt; OpenGL) å’Œ ç€è‰²å™¨ (ç€è‰²å™¨GLSL è¯­è¨€å®ç°)ï¼Œå®ç°é©±åŠ¨èƒ½åŠ›ã€‚(ä»»ä½•è¯­è¨€å®ç°éƒ½æ˜¯ä»¥ç¡¬ä»¶ä¸ºåŸºç¡€)&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼Œå¦‚ä½•è®© 3Dç©ºé—´ç‚¹åæ ‡ è½¬ä¸º å±å¹• 2DäºŒç»´ç‚¹åæ ‡ï¼Ÿ&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;æµ…çœ‹ 3Dç©ºé—´ç‚¹ to å±å¹• 2DäºŒç»´ç‚¹&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5595595595595596&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8PyqwM2ib1erLXGOAVETOHxpfJEeBH2VcibNrhqqicqUyW30jvhYPmPsLg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1998&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸€ä¸ªå¤æ‚åœºæ™¯ä¸­ï¼Œç‰©ä½“å¦‚ ğŸ¦– ã€å‘¨è¾¹ğŸŒ¸ğŸŒ¸ğŸŒ±ğŸŒ¿ ç­‰ï¼Œéƒ½éœ€è¦è½¯ä»¶å»ºæ¨¡ï¼Œå»ºæ¨¡å¥½åå†å°†å…¶æ”¾ç½®åˆ°è¯¥åœºæ™¯ä¸­ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“å¯¹æ¯ä¸ªç‰©ä½“ğŸ¦– å»ºæ¨¡çš„æ—¶å€™ï¼Œç‰©ä½“æœ¬èº«æ˜¯æœ‰è‡ªå·±çš„ç‹¬ç«‹åæ ‡ç³» &lt;strong&gt;[1] å±€éƒ¨åæ ‡ç³» Local Space&lt;/strong&gt;ï¼Œä½† ğŸ¦– ğŸŒ¸ğŸŒ¸ğŸŒ±ğŸŒ¿ æ”¾åˆ°åœºæ™¯ä¸­å°±æœ‰ä¸åŒæ”¾ç½®ä½ç½®ï¼Œæ‰€æœ‰ç‰©ä½“å…±äº«åŒä¸€ä¸ªåæ ‡ç³»ï¼Œå« &lt;strong&gt;[2] ä¸–ç•Œåæ ‡ç³» World Space&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨ä¸–ç•Œåæ ‡ç³»åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä»æ­£é¢æŸä¸ªä½ç½®å»è§‚å¯Ÿ ğŸ¦–ï¼Œå¦‚æœè§†è§’å˜åŒ–è‡³æ²¿ç€Zè½´è´Ÿæ–¹å‘çœ‹å‘¢ï¼Ÿåˆæ˜¯å¦å¤–ä¸€ä¸ªç”»é¢ï¼Œå«åš &lt;strong&gt;[3] è§†è§‰åæ ‡ç³» View Space&lt;/strong&gt;ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3256059009483667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8aWQsPia1VQstxibwHG78aJs55u5dStEm6dkRiasekibXUoibEXw7BpypkqA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1898&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‰©ä¸‹ä¸¤ä¸ªåæ ‡ç³»è¯´æ˜ï¼š&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;[4] è£å‰ªåæ ‡ç³» Clip Space /&lt;/strong&gt; &lt;strong&gt;DNC&lt;/strong&gt;: å½’ä¸€åŒ–å¤„ç†ï¼Œå’Œ éœ€è¦åˆ¤æ–­å“ªä¸ªç‰‡æ®µéœ€è¦å±•ç¤ºåœ¨å±å¹•å†…ã€‚(è¿™é‡Œä¸åšå±•å¼€è·Ÿæœºå™¨å­¦ä¹ å½’ä¸€åŒ–ç›®æ ‡ä¸€è‡´ï¼Œç»Ÿè®¡å­¦ä¸­æ•°æ®æ”¶æ•›ä½œç”¨)&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;[5] å±å¹•åæ ‡ç³» Screen Space&lt;/strong&gt;ï¼šæ ¹æ®è£å‰ªåæ ‡ç³»è®¡ç®—ï¼Œå†è½¬æ¢ä¸ºå±å¹•åæ ‡ã€‚æœ€åå°†æ•°æ®ä¼ åˆ°å…‰æ …å™¨ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;ä»¥ä¸Šç†è§£ç‰ˆ&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;æˆ‘ä»¬æ¯ä¸ªäººéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹ä¸ªä½“éƒ½ä»¥&quot;è‡ªæˆ‘ä¸ºä¸­å¿ƒ&quot; ( [1] å±€éƒ¨åæ ‡ç³»)&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;éšç€æˆ‘ä»¬é•¿å¤§è¦è¿›å…¥ç¤¾ä¼š ([2] ä¸–ç•Œåæ ‡ç³»)ï¼Œå­¦ä¹ ã€å·¥ä½œ ....&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰äººä»°è§†ä½ ï¼Œæœ‰äººä¿¯è§†ä½ ï¼Œä½ å¯ä»¥é€‰æ‹©å¹³è§†ä»–ä»¬ æˆ–è€… åè„‘å‹ºå¯¹ç€ä»–ä»¬ï¼Œæ€»ä¹‹å…¶ä»–äººä¼šç«™åœ¨è‡ªå·±çš„è§’åº¦çœ‹é—®é¢˜ æˆ–è€… çœ‹ä½  ([3] è§†è§‰åæ ‡ç³») ....&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;AnyWayï¼Œè¿‡ç¨‹ä¸­ä½ å¯èƒ½ä¼šç”Ÿæ´»ç£¨å¹³æ£±è§’ ([4] è£å‰ªåæ ‡ç³»)ï¼Œå˜æˆäº†ä½ å°æ—¶å€™æœ€è®¨åŒçš„äººï¼Œ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Butï¼Œä½ å°±æ˜¯ä½ ï¼Œæ˜¯ä¸ä¸€æ ·çš„çƒŸç«ï¼Œ.... è®©è”·è–‡å¼€å‡ºä¸€ç§ç»“æœ ([5] å±å¹•åæ ‡ç³»)&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç†è§£æœ‰äº›æ¦‚å¿µåï¼Œå’±ä»¬å†çœ‹çœ‹è¿™äº›è¿‡ç¨‹é—´è½¬æ¢ï¼Œæ˜¯å¦‚ä½•ç¦»ä¸å¼€ çº¿æ€§ä»£æ•°åŸºç¡€çŸ¥è¯†çš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;[1] å±€éƒ¨ç©ºé—´-&amp;gt; [2] ä¸–ç•Œç©ºé—´&lt;/strong&gt;ï¼Œæ¶‰åŠ &lt;code&gt;çŸ©é˜µçš„å¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¼©æ”¾ï¼šä»£è¡¨å¤šå°‘å€ï¼Œç¼©æ”¾S1ã€S2ã€S3 å€æ•°&lt;/p&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2803532008830022&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8odaic6eibN8J9AvWmRJApnydwV0S2C8OO7kwKsQjNTkdxh4udib8KJdNw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;906&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¹³ç§»ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.30512820512820515&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8HDlPjSk2ib4HvHjkrSzVqHtggH6stHF3fuXibPfPuh84EUEa5YHUz4pw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;780&quot;/&gt;&lt;/figure&gt;&lt;/section&gt;&lt;span data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;section role=&quot;presentation&quot; data-formula=&quot;&quot; data-formula-type=&quot;block-equation&quot;&gt;&lt;span&gt;æ—‹è½¬ï¼šç”± P(x, y, z) å˜ä¸º P&#x27; (x&#x27;, y&#x27;, z&#x27;)ï¼Œæ—‹è½¬ Î¸ è§’åº¦ï¼Œç•¥è¿‡ ... &lt;/span&gt;&lt;span&gt;å˜æ¢ - LearnOpenGL CN&lt;/span&gt;&lt;sup&gt;[11]&lt;/sup&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; role=&quot;img&quot; focusable=&quot;false&quot; viewbox=&quot;0 0 1 0&quot; preserveaspectratio=&quot;xMidYMid slice&quot; aria-hidden=&quot;true&quot;/&gt;&lt;/section&gt;&lt;/span&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;[2] ä¸–ç•Œç©ºé—´ -&amp;gt; [3] è§†è§‰ç©ºé—´&lt;/strong&gt;ï¼Œæ„å»º &lt;code&gt;çº¿æ€§å˜æ¢çŸ©é˜µ&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»»ä½•æ–¹ä½è§‚å¯Ÿåˆ°çš„ç‰©ä½“éƒ½æ˜¯ä¸åŒçš„ï¼Œä»A ä½ç½® å˜æ¢è‡³ B ä½ç½®ï¼Œåªè¦çŸ¥é“ å˜æ¢å‰åçš„&lt;code&gt;åŸºå‘é‡&lt;/code&gt;ï¼Œå°±èƒ½çŸ¥é“ è¿åŠ¨è‡³å“ªé‡Œï¼Œæ–¹æ³•é€šè¿‡ &lt;code&gt;çŸ©é˜µç›¸ä¹˜&lt;/code&gt; (å¯¹å‡ ä½•ç©ºé—´çš„çº¿æ€§å˜åŒ–) ....&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;çŸ©é˜µå‘é‡ä¹˜ç§¯: &lt;code&gt;å˜æ¢åçš„åŸºå‘é‡&lt;/code&gt; * æœªå˜åŒ–å‰çš„ä½ç½® (x, y) = åŸºå‘é‡å˜æ¢åæ–°(x&#x27;, y&#x27;)&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5582120582120582&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8OSoQZANwLG6mSEwkEPKKz76KoRHcmm0HnDAWHCkNK6wk0YVB9kovWg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1924&quot;/&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5196182396606575&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8zqCzPiaY22hxicDBYRUpsOnF9TyRsVCUsZXvfohpR4T6cpm6YpQicicwTg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1886&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;[3] è§†è§‰ç©ºé—´ -&amp;gt; [4] è£å‰ªç©ºé—´ -&amp;gt; [5] å±å¹•ç©ºé—´&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;å°† 3D ç‚¹ è¡¨ç¤ºåˆ° 2D ç‚¹ï¼Œ &lt;code&gt;æŠ•å½±&lt;/code&gt; -&amp;gt; &lt;code&gt;ç‚¹ç§¯&lt;/code&gt; (å®é™…ä¸Šä¼šæ›´å¤æ‚äº›) ....&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å†å°†èƒ½è§†è§‰å±•ç¤ºçš„ç©ºé—´å±•ç¤ºï¼Œä¸èƒ½å±•ç¤ºçš„è¢«å‰ªè£æ‰&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å‰ªè£åç‚¹ä½ï¼Œä¼šå½’ä¸€åŒ–å¤„ç†ï¼Œä¿è¯äº¤ä»˜ç»™å‘å…‰äºŒæç®¡ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;æ€»ä¹‹ï¼Œå­¦å¥½çº¿æ€§ä»£æ•°å¾ˆé‡è¦ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;&lt;span&gt;ã€Šçº¿æ€§ä»£æ•°ã€‹ï¼ˆåŒæµç‰ˆï¼‰â€”â€”æ•™ç§‘ä¹¦ä¸­çš„è€»è¾±æŸ±&lt;/span&gt;&lt;sup&gt;[12]&lt;/sup&gt; è¯¥æ–‡ç«  å¼•èµ·äº†æˆ‘ç›¸å½“å¼ºçƒˆçš„å…±é¸£ (æ²¡å­¦å¥½çœŸä¸æ€¨æˆ‘)&lt;/p&gt;&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5588235294117647&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8XLa5ZsiaHm0icQzN8chpYKglyTw4tq2xCyDGApiaGOKDZowFRA5hib06Yg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1224&quot;/&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8Ikv3SUvsHJJqHBRZTySiafppLEfHj0kS4F2uZModnWD2iaicWLFWYwMyQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;800&quot;/&gt;&lt;/p&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å®è·µç¯‡ï¼šç”¨ Three.js å…¥ä¸ªé—¨&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬å…ˆç”¨ä½æˆæœ¬å­¦ä¹ Three.jsï¼Œå¿«é€Ÿå…¥é—¨ .....&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;3D å»ºæ¨¡æ¦‚å¿µå¿…å¤‡&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä½ æ˜¯ä¸ªå¤§å¯¼æ¼”ï¼Œæœ‰ä¸€å¤©ä½ æƒ³è¯· å®‰çªæ‹‰å¤§å®è´å„¿ æ¥åŒ—äº¬ çŒ®æ­Œä¸€æ›²ï¼Œ&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;è¦æœ‰åœ°ç‚¹ &lt;code&gt;Scene åœºæ™¯&lt;/code&gt; ï¼Œé€‰æ‹© äººæ°‘å¤§ä¼šå ‚ä½œä¸º èˆå°å§ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è¦æœ‰ç¯å…‰ &lt;code&gt;Light ç¯å…‰&lt;/code&gt;, æ‰èƒ½è®©è§‚ä¼—çœ‹åˆ° å®‰çªæ‹‰å¤§å®è´å„¿ å”±æ­Œï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å…³äº å®‰çªæ‹‰å¤§å®è´ ä½œä¸º &lt;code&gt;æ¨¡å‹&lt;/code&gt;ï¼Œæ¥ä¹‹å‰è¦ä¿å…»ä¸€ä¸‹ï¼Œçš®è‚¤çœ‹èµ·æ¥å¹å¼¹å¯ç ´ &lt;code&gt;æè´¨ Material&lt;/code&gt;ï¼›&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;XXX å¤§å“ç‰Œç–¯ç‹‚èµåŠ©ï¼Œå¹¶è¦æ±‚å¥¹ç©¿ä¸Šæ–°ä¸€å­£ æœé¥° å’Œ é…ä¸Šå¦†å‘ &lt;code&gt;è´´å›¾ä¸çº¹ç† Texture&lt;/code&gt;;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼ŒNä¸ªæœºå™¨ &lt;code&gt;Camera ç›¸æœº&lt;/code&gt; 360 åº¦æ— æ­»è§’çš„æ‹æ‘„ï¼Œå¥¹å”± XXXæ­Œæ›²ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½ åˆšåœ¨è„‘æµ·é‡Œæ„å»ºå‡ºæ¥çš„ç”»é¢ â‰ˆ &lt;code&gt;æ¸²æŸ“å™¨ Render&lt;/code&gt;&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4914712153518124&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a86fzicLibQnNyRStlKvhkcRD9DAIJ6I4G6slpe3DGcS25usRpAH3ibbSGQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1876&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;Three.js demo&lt;/span&gt;&lt;sup&gt;[13]&lt;/sup&gt; è‡ªå·±å»å¯¹ç…§ç€æƒ³è±¡è¿™ä¸ªğŸ‘»ï¼Œå°±æ˜¯ å®‰çªæ‹‰å¤§å®è´å„¿ å§&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»¥ä¸Šå‡ ä¸ªå…³é”®è¯æ˜¯ï¼š&lt;code&gt;Scene åœºæ™¯&lt;/code&gt;ã€&lt;code&gt;Light ç¯å…‰&lt;/code&gt;ã€&lt;code&gt;æ¨¡å‹&lt;/code&gt;ã€&lt;code&gt;æè´¨ Material&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ã€&lt;code&gt;Texture&lt;/code&gt;ã€&lt;code&gt;Camera ç›¸æœº&lt;/code&gt;ã€&lt;code&gt;æ¸²æŸ“å™¨ Render&lt;/code&gt;ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç†è§£äº†ä»¥ä¸Šçš„å‡ ä¸ªæ¦‚å¿µåï¼Œå¯¹æˆ‘ä»¬å®è·µä¸Šæ‰‹åº”ç”¨ Three.js éå¸¸çš„å…³é”®ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span/&gt;&lt;span&gt;å®è·µä»£ç èµ°ä¸€æ³¢&lt;/span&gt;&lt;span/&gt;&lt;span&gt; &lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;STEP1: åˆ›å»ºèˆå° å’Œ ç›¸æœºï¼Œå¹¶æ¸²æŸ“è‡³é¡µé¢ä¸Š&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;importÂ *Â asÂ THREEÂ fromÂ &lt;span&gt;&#x27;three&#x27;&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;classÂ ThreeDemoÂ {&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;constructor&lt;/span&gt;&lt;/span&gt;Â ()Â {&lt;br/&gt;Â Â Â Â this.widthÂ =Â window.innerWidth&lt;br/&gt;Â Â Â Â this.heightÂ =Â window.innerHeight&lt;br/&gt;Â Â Â Â this.aspectRatioÂ =Â this.widthÂ /Â this.height&lt;br/&gt;&lt;br/&gt;Â Â Â Â //Â åˆ›å»ºåœºæ™¯&lt;br/&gt;Â Â Â Â this.sceneÂ =Â null&lt;br/&gt;Â Â Â Â //Â åˆ›å»ºç›¸æœº&lt;br/&gt;Â Â Â Â this.cameraÂ =Â null&lt;br/&gt;Â Â Â Â //Â åˆ›å»ºç¯å…‰&lt;br/&gt;Â Â Â Â this.lightÂ =Â null&lt;br/&gt;Â Â Â Â //Â åˆ›å»ºæ¨¡å‹&lt;br/&gt;Â Â Â Â this.modelÂ =Â null&lt;br/&gt;Â Â Â Â //Â åˆ›å»ºæè´¨&lt;br/&gt;Â Â Â Â this.materialÂ =Â null&lt;br/&gt;Â Â Â Â //Â åˆ›å»ºçº¹ç†&lt;br/&gt;Â Â Â Â this.textureÂ =Â null&lt;br/&gt;Â Â Â Â //Â åˆ›å»ºæ¸²æŸ“&lt;br/&gt;Â Â Â Â this.rendererÂ =Â null&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;init&lt;/span&gt;&lt;/span&gt;Â ()Â {&lt;br/&gt;Â Â Â Â this.createScene()Â //Â åˆ›å»ºèˆå°Â å’ŒÂ ç›¸æœº&lt;br/&gt;Â Â Â Â this.createRenderer()Â //Â åˆ›å»ºæ¸²æŸ“&lt;br/&gt;Â Â Â Â document.body.appendChild(this.renderer.domElement)Â //Â æ¸²æŸ“è‡³é¡µé¢ä¸Š&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â constÂ renderÂ =Â ()Â =&amp;gt;Â {&lt;br/&gt;Â Â Â Â Â Â this.renderer.render(this.scene,Â this.camera)Â //Â æ¸²æŸ“åœºæ™¯&lt;br/&gt;Â Â Â Â Â Â requestAnimationFrame(render)&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â render()&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â this.axesHelper()&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;createScene&lt;/span&gt;&lt;/span&gt;Â ()Â {&lt;br/&gt;Â Â Â Â //Â ======Â æ­å»ºä¸ªèˆå°Â ======&lt;br/&gt;Â Â Â Â this.sceneÂ =Â newÂ THREE.Scene()Â &lt;br/&gt;Â Â Â Â this.scene.fogÂ =Â newÂ THREE.Fog(0x090918,Â 1,Â 600)&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â //Â ======Â æ­å»ºç›¸æœºÂ (æ¨¡æ‹Ÿäººè§†è§’å»çœ‹æ™¯è±¡)Â PerspectiveCameraÂ =Â é€è§†ç›¸æœºÂ ======&lt;br/&gt;Â Â Â Â this.cameraÂ =Â newÂ THREE.PerspectiveCamera(&lt;br/&gt;Â Â Â Â Â Â 75,Â //Â è§†è§’&lt;br/&gt;Â Â Â Â Â Â this.aspectRatio,Â //Â çºµæ¨ªæ¯”&lt;br/&gt;Â Â Â Â Â Â 0.1,Â //Â nearPlaneÂ è¿‘å¹³é¢&lt;br/&gt;Â Â Â Â Â Â 2000Â //Â farPlaneÂ è¿œå¹³é¢&lt;br/&gt;Â Â Â Â )&lt;br/&gt;Â Â Â Â //Â è®¾ç½®ç›¸æœºä½ç½®&lt;br/&gt;Â Â Â Â this.camera.position.set(10,Â 10,Â 10)Â //Â x,Â y,Â z&lt;br/&gt;Â Â Â Â //Â æ›´æ–°æ‘„åƒå¤´å®½é«˜æ¯”ä¾‹&lt;br/&gt;Â Â Â Â this.camera.aspectÂ =Â this.aspectRatio&lt;br/&gt;Â Â Â Â //Â æ›´æ–°æ‘„åƒå¤´çš„çŸ©é˜µ&lt;br/&gt;Â Â Â Â this.camera.updateProjectionMatrix()&lt;br/&gt;&lt;br/&gt;Â Â Â Â //Â å°†ç›¸æœºæ”¾åˆ°èˆå°ä¸Š&lt;br/&gt;Â Â Â Â this.scene.add(this.camera)&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;createRenderer&lt;/span&gt;&lt;/span&gt;Â ()Â {&lt;br/&gt;Â Â Â Â this.rendererÂ =Â newÂ THREE.WebGLRenderer({Â antialias:Â &lt;span&gt;true&lt;/span&gt;Â })&lt;br/&gt;Â Â Â Â this.renderer.outputEncodingÂ =Â THREE.sRGBEncoding&lt;br/&gt;Â Â Â Â //Â è®¾ç½®æ¸²æŸ“å™¨å®½é«˜&lt;br/&gt;Â Â Â Â this.renderer.setSize(this.width,Â this.height)&lt;br/&gt;Â Â Â Â this.renderer.setClearColor(this.scene.fog.color)&lt;br/&gt;&lt;br/&gt;Â Â Â Â //Â å±å¹•å˜åŒ–Â æ›´æ–°æ¸²æŸ“Â (ç›¸æœºè§†è§’å˜åŒ–Â å’ŒÂ æ¸²æŸ“å™¨å˜åŒ–)&lt;br/&gt;Â Â Â Â window.addEventListener(&lt;span&gt;&#x27;resize&#x27;&lt;/span&gt;,Â ()Â =&amp;gt;Â {&lt;br/&gt;Â Â Â Â Â Â this.camera.aspectÂ =Â window.innerWidthÂ /Â window.innerHeight&lt;br/&gt;Â Â Â Â Â Â this.camera.updateProjectionMatrix()&lt;br/&gt;Â Â Â Â Â Â this.renderer.setSize(window.innerWidth,Â window.innerHeight)&lt;br/&gt;Â Â Â Â })&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;br/&gt;Â Â //Â è¾…åŠ©åæ ‡ç³»&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;axesHelper&lt;/span&gt;&lt;/span&gt;Â ()Â {&lt;br/&gt;Â Â Â Â constÂ axesHelperÂ =Â newÂ THREE.AxesHelper(5)&lt;br/&gt;Â Â Â Â this.scene.add(axesHelper)&lt;br/&gt;Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;constÂ instanceÂ =Â newÂ ThreeDemo()&lt;br/&gt;instance.init()&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;this.camera.position.set(10, 10, 10)&lt;/code&gt; åœ¨è¿™ä¸ªä½ç½®ä¸Šçœ‹&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5420289855072464&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8VicXfbGHdAzGQ4baicV0dkstCUQPcS4Rdum9PLnX7wJJJibiaOHgIlxAAg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1380&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœæˆ‘ä»¬åœ¨&lt;code&gt;this.camera.position.set(0, 0, 5)&lt;/code&gt; è¿™ä¸ªä½ç½®ä¸Šçœ‹&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6502732240437158&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8icKtia1nbQF3oIyDiaWdYeZ6shD2F4eqddRpWUhGJLEdGZSibvlr7Wia0gw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1830&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;STEP2: åŠ æ¨¡å‹ å’Œ ç¯å…‰&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;//Â åŠ å…¥ç¯å¢ƒå…‰&lt;br/&gt;//Â ç¯å¢ƒå…‰ä¼šå‡åŒ€çš„ç…§äº®åœºæ™¯ä¸­çš„æ‰€æœ‰ç‰©ä½“&lt;br/&gt;this.lightÂ =Â newÂ THREE.AmbientLight(0x404040)Â //Â softÂ whiteÂ light&lt;br/&gt;this.scene.add(this.light)&lt;br/&gt;&lt;br/&gt;//Â åœºæ™¯ä¸­æ·»åŠ çƒ&lt;br/&gt;constÂ geometryÂ =Â newÂ THREE.BoxGeometry(2,Â 2,Â 2)&lt;br/&gt;constÂ geometry_materialÂ =Â newÂ THREE.MeshStandardMaterial({Â color:Â 0xaafabbÂ })&lt;br/&gt;instance.scene.add(newÂ THREE.Mesh(geometry,Â geometry_material))&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰å…‰ç…§&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5508571428571428&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a82dC0RuloQmk23xdiaZDFU2u41AEdAJiceFnwkfxQJCJ86ic0OaS4VshKA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1750&quot;/&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.48040638606676345&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8wjncLx3gudric7iad6ibL6tlSgmIFgVjvf6CANSajDpvdUsWu32wkVyEg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1378&quot;/&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ— å…‰ç…§ (æ— ç¯å¢ƒå…‰åŠ å…¥)&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™é‡Œä¸ä»…åŠ å…¥ç¯å¢ƒå…‰ï¼Œè¿˜åŠ å…¥äº†å¹³è¡Œå…‰ï¼Œå³å¹³è¡Œå…‰æ˜¯æ²¿ç€ç‰¹å®šæ–¹å‘å‘å°„çš„å…‰&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;Â Â &lt;span&gt;&lt;span&gt;createLight&lt;/span&gt;&lt;/span&gt;Â ()Â {&lt;br/&gt;Â Â Â Â //Â ç¯å¢ƒå…‰ä¼šå‡åŒ€çš„ç…§äº®åœºæ™¯ä¸­çš„æ‰€æœ‰ç‰©ä½“&lt;br/&gt;Â Â Â Â this.lightÂ =Â newÂ THREE.AmbientLight(0x404040)Â //Â softÂ whiteÂ light&lt;br/&gt;Â Â Â Â this.scene.add(this.light)&lt;br/&gt;&lt;br/&gt;Â Â Â Â //Â å¹³è¡Œå…‰æ˜¯æ²¿ç€ç‰¹å®šæ–¹å‘å‘å°„çš„å…‰&lt;br/&gt;Â Â Â Â this.directionalLightÂ =Â newÂ THREE.DirectionalLight(Â 0xffffff,Â 0.6Â )&lt;br/&gt;Â Â Â Â this.directionalLight.position.set(0,Â 5,Â 5)&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â this.scene.add(this.directionalLight)&lt;br/&gt;Â Â }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5358744394618834&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8ywM6BWAVm1uU0LpsAcMy6RsDoKWZD5m5BNcnOSr6c2ib5jAT6Lq63aw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1784&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;STEP3: è´´è†œ (æè´¨å’Œçº¹ç†)&lt;/strong&gt;&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;https://www.poliigon.com/ åœ¨è¿™ä¸ªç½‘ç«™ä¸Šå»æ‰¾ä¸€äº›è´´å›¾&lt;/p&gt;&lt;/blockquote&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;//Â åœºæ™¯ä¸­æ·»åŠ ç«‹æ–¹ä½“&lt;br/&gt;constÂ geometryÂ =Â newÂ THREE.BoxGeometry(2,Â 2,Â 2)&lt;br/&gt;constÂ geometry_materialÂ =Â newÂ THREE.MeshStandardMaterial({Â &lt;br/&gt;Â Â map:Â textureLoader.load(&lt;span&gt;&#x27;../public/textures/RoofTilesTerracotta004/RoofTilesTerracotta004_COL_1K.jpg&#x27;&lt;/span&gt;),&lt;br/&gt;Â Â aoMap:Â textureLoader.load(&lt;span&gt;&#x27;../public/textures/RoofTilesTerracotta004/RoofTilesTerracotta004_AO_1K.jpg&#x27;&lt;/span&gt;),&lt;br/&gt;Â Â alphaMap:Â textureLoader.load(&lt;span&gt;&#x27;../public/textures/RoofTilesTerracotta004/RoofTilesTerracotta004_AO_1K.jpg&#x27;&lt;/span&gt;),&lt;br/&gt;Â Â normalMap:Â textureLoader.load(&lt;span&gt;&#x27;../public/textures/RoofTilesTerracotta004/RoofTilesTerracotta004_NRM_1K.png&#x27;&lt;/span&gt;),&lt;br/&gt;Â Â transparent:Â &lt;span&gt;true&lt;/span&gt;,&lt;br/&gt;Â Â roughness:Â 0,&lt;br/&gt;})&lt;br/&gt;constÂ modelÂ =Â newÂ THREE.Mesh(geometry,Â geometry_material)&lt;br/&gt;instance.scene.add(model)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5686145764937623&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqpIVrX62SgKOmvK0FPc3a8k2ia63UGrtib5ZUHjECSxIeE3VOCbQIXSn0gyiahzao1RiaC4r05WW4VNg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;3046&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;Step Xï¼šä»¥ä¸Šå°ç»“&lt;/strong&gt;&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;å…ˆå°† &lt;code&gt;Scene åœºæ™¯&lt;/code&gt;ã€&lt;code&gt;Light ç¯å…‰&lt;/code&gt;ã€&lt;code&gt;Camera ç›¸æœº&lt;/code&gt; è®¾ç½®å¥½ï¼Œå¹¶å°†å…¶é€šè¿‡&lt;code&gt;æ¸²æŸ“å™¨ Render&lt;/code&gt; æ¸²æŸ“è‡³é¡µé¢ä¸Š&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;ol start=&quot;2&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;ç¡®å®šå¥½ &lt;code&gt;æ¨¡å‹&lt;/code&gt; ç©¿ä¸Š &lt;code&gt;æè´¨ Material&lt;/code&gt; å’Œ &lt;code&gt;è´´å›¾ Texture&lt;/code&gt; åï¼Œå¹¶è®¾å®šå¥½è¯¥æ¨¡å‹ä½ç½®ï¼Œå†æ·»åŠ è‡³åœºæ™¯&lt;code&gt;Scene åœºæ™¯&lt;/code&gt; ä¸­ï¼Œå³å¯å¾—åˆ°3Dç‰©ä½“å•¦ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;æœ€åæ€»ç»“&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä½ æ²¡æœ‰ç³»ç»Ÿçš„æ¥è§¦è¿‡è¯¥æ–¹å‘ï¼Œé‚£å¯ä»¥å…ˆä»Three.js å…¥æ‰‹ï¼Œå…´è¶£æ˜¯æœ€å¥½çš„è€å¸ˆï¼Œé€šè¿‡ç†è§£åœºæ™¯ã€ç¯å…‰ã€ç›¸æœº ... ç­‰å¤§æ¦‚çŸ¥é“ä¸€äº›æ¦‚å¿µã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å›¾å½¢å­¦è™½ç„¶æ°´å¾ˆæ·±ï¼Œä½†å†æ·±ä¹Ÿæœ‰åº•ï¼Œæ·±å…¥ WebGL + ç€è‰²å™¨ (GLSLè¯­è¨€) -&amp;gt; ç¡¬ä»¶ä¸Šè¿ä½œæœºåˆ¶ &lt;strong&gt;ç­‰ç­‰ç­‰&lt;/strong&gt; ...&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;å‚è€ƒèµ„æ–™&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;[1]&lt;/span&gt;&lt;p&gt;å¦‚ä½•å…¥æ‰‹webGlä»¥åŠthree.jså‘¢? - çŸ¥ä¹: &lt;em&gt;https://www.zhihu.com/question/383398859/answer/1121471144&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2]&lt;/span&gt;&lt;p&gt;å‰ç«¯å¼€å‘è€…åº”è¯¥å¦‚ä½•å­¦ä¹ è®¡ç®—æœºå›¾å½¢å­¦ç›¸å…³çš„çŸ¥è¯†? - çŸ¥ä¹: &lt;em&gt;https://www.zhihu.com/question/24351718&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[3]&lt;/span&gt;&lt;p&gt;å¤§ä¸‰è®¡ç®—æœºï¼Œæƒ³æ¥è§¦å›¾å½¢å­¦æ–¹é¢çš„çŸ¥è¯†ï¼Œç›´æ¥å­¦WebGLè¿˜æ˜¯OpenGL ? - çŸ¥ä¹: &lt;em&gt;https://www.zhihu.com/question/422713076&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[4]&lt;/span&gt;&lt;p&gt;WebGLï¼ŒOpenGLå’ŒOpenGL ESä¸‰è€…çš„å…³ç³»: &lt;em&gt;https://blog.csdn.net/qq_23034515/article/details/108283747&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[5]&lt;/span&gt;&lt;p&gt;OpenGL: &lt;em&gt;https://en.wikipedia.org/wiki/OpenGL&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[6]&lt;/span&gt;&lt;p&gt;WebGL: &lt;em&gt;https://www.khronos.org/webgl/&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[7]&lt;/span&gt;&lt;p&gt;ç«‹æ–¹ä½“ demo: &lt;em&gt;http://ifanqi.top/webgl/pages/lesson12.html&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[8]&lt;/span&gt;&lt;p&gt;ä»£ç : &lt;em&gt;https://github.com/lucefer/webgl/blob/master/pages/lesson12.html&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[9]&lt;/span&gt;&lt;p&gt;Three.js: &lt;em&gt;https://threejs.org/&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[10]&lt;/span&gt;&lt;p&gt;The Book of Shaders by Patricio Gonzalez Vivo &amp;amp; Jen Lowe: &lt;em&gt;https://thebookofshaders.com/01/?lan=ch&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[11]&lt;/span&gt;&lt;p&gt;å˜æ¢ - LearnOpenGL CN: &lt;em&gt;https://learnopengl-cn.github.io/01%20Getting%20started/07%20Transformations/#_18&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[12]&lt;/span&gt;&lt;p&gt;ã€Šçº¿æ€§ä»£æ•°ã€‹ï¼ˆåŒæµç‰ˆï¼‰â€”â€”æ•™ç§‘ä¹¦ä¸­çš„è€»è¾±æŸ±: &lt;em&gt;https://zhuanlan.zhihu.com/p/199665495&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[13]&lt;/span&gt;&lt;p&gt;Three.js demo: &lt;em&gt;https://threejs.org/examples/#webgl_animation_skinning_additive_blending&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;span&gt;- END -&lt;/span&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;â¤ï¸ è°¢è°¢æ”¯æŒ&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»¥ä¸Šä¾¿æ˜¯æœ¬æ¬¡åˆ†äº«çš„å…¨éƒ¨å†…å®¹ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©^_^&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å–œæ¬¢çš„è¯åˆ«å¿˜äº†Â &lt;strong&gt;åˆ†äº«ã€ç‚¹èµã€æ”¶è—&lt;/strong&gt;Â ä¸‰è¿å“¦~ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¬¢è¿å…³æ³¨å…¬ä¼—å·Â &lt;strong&gt;ELabå›¢é˜Ÿ&lt;/strong&gt;Â æ”¶è´§å¤§å‚ä¸€æ‰‹å¥½æ–‡ç« &lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span data-raw-text=&quot;å­—&quot; data-textnode-index=&quot;346&quot; data-index=&quot;7804&quot;&gt;&lt;span data-raw-text=&quot;èŠ‚&quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12090&quot;&gt;å­—èŠ‚&lt;/span&gt;&lt;span data-raw-text=&quot;è·³&quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12091&quot;&gt;è·³&lt;/span&gt;&lt;span data-raw-text=&quot;åŠ¨&quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12092&quot;&gt;åŠ¨&lt;/span&gt;&lt;span data-raw-text=&quot;æ ¡&quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12093&quot;&gt;æ ¡&lt;/span&gt;&lt;span data-raw-text=&quot;/&quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12094&quot;&gt;/&lt;/span&gt;&lt;span data-raw-text=&quot;ç¤¾&quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12095&quot;&gt;ç¤¾&lt;/span&gt;&lt;span data-raw-text=&quot;æ‹›&quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12096&quot;&gt;æ‹›&lt;/span&gt;&lt;span data-raw-text=&quot;å†…&quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12097&quot;&gt;å†…&lt;/span&gt;&lt;span data-raw-text=&quot;æ¨&quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12098&quot;&gt;æ¨&lt;/span&gt;&lt;span data-raw-text=&quot;ç &quot; data-textnode-index-1642080622978=&quot;991&quot; data-index-1642080622978=&quot;12099&quot;&gt;ç &lt;/span&gt;&lt;/span&gt;&lt;span data-raw-text=&quot;:&quot; data-textnode-index-1642080622978=&quot;992&quot; data-index-1642080622978=&quot;12100&quot;&gt;:&lt;/span&gt;&lt;span data-raw-text=&quot;Â &quot; data-textnode-index-1642080622978=&quot;992&quot; data-index-1642080622978=&quot;12101&quot;&gt;Â &lt;/span&gt;&lt;span&gt;W7HD8A6&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span data-raw-text=&quot;æŠ•&quot; data-textnode-index=&quot;348&quot; data-index=&quot;7823&quot;&gt;&lt;span data-raw-text=&quot;æŠ•&quot; data-textnode-index-1642080622978=&quot;994&quot; data-index-1642080622978=&quot;12109&quot;&gt;æŠ•&lt;/span&gt;&lt;/span&gt;&lt;span data-raw-text=&quot;é€’&quot; data-textnode-index=&quot;348&quot; data-index=&quot;7824&quot;&gt;&lt;span data-raw-text=&quot;é€’&quot; data-textnode-index-1642080622978=&quot;995&quot; data-index-1642080622978=&quot;12110&quot;&gt;é€’&lt;/span&gt;&lt;/span&gt;&lt;span data-raw-text=&quot;é“¾&quot; data-textnode-index=&quot;348&quot; data-index=&quot;7825&quot;&gt;&lt;span data-raw-text=&quot;é“¾&quot; data-textnode-index-1642080622978=&quot;996&quot; data-index-1642080622978=&quot;12111&quot;&gt;é“¾&lt;/span&gt;&lt;/span&gt;&lt;span data-raw-text=&quot;æ¥&quot; data-textnode-index=&quot;348&quot; data-index=&quot;7826&quot;&gt;&lt;span data-raw-text=&quot;æ¥&quot; data-textnode-index-1642080622978=&quot;997&quot; data-index-1642080622978=&quot;12112&quot;&gt;æ¥&lt;/span&gt;&lt;/span&gt;&lt;span data-raw-text=&quot;:&quot; data-textnode-index=&quot;348&quot; data-index=&quot;7827&quot;&gt;&lt;span data-raw-text=&quot;:&quot; data-textnode-index-1642080622978=&quot;998&quot; data-index-1642080622978=&quot;12113&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;span data-raw-text=&quot; &quot; data-textnode-index=&quot;348&quot; data-index=&quot;7828&quot;&gt;&lt;span data-raw-text=&quot;Â &quot; data-textnode-index-1642080622978=&quot;999&quot; data-index-1642080622978=&quot;12114&quot;&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span data-raw-text=&quot;h&quot; data-textnode-index-1642080622978=&quot;1000&quot; data-index-1642080622978=&quot;12115&quot;/&gt;https://job.toutiao.com/s/6stp6SM&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>3ed385a9a9c7667f0a021658e450859b</guid>
<title>è·³è·ƒè¡¨æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æ</title>
<link>https://toutiao.io/k/p70xexq</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;preview&quot;&gt;&lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šäº¬ä¸œç‰©æµ çºªå“å¿—&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç›®å‰å¸‚é¢ä¸Šå……æ–¥ç€å¤§é‡å…³äºè·³è·ƒè¡¨ç»“æ„ä¸Redisçš„æºç è§£æï¼Œä½†æ˜¯ç»è¿‡é•¿æœŸè§‚å¯Ÿåå‘ç°å¤§éƒ½åªæ˜¯åœ¨åœç•™åœ¨ä»£ç çš„è¡¨é¢ï¼Œè€Œæ²¡æœ‰ç³»ç»Ÿæ€§åœ°ä»‹ç»è·³è·ƒè¡¨çš„ç”±æ¥ä»¥åŠå„ç§å¸¸é‡çš„ç”±æ¥ã€‚ä½œä¸ºä¸€ç§æ¦‚ç‡æ•°æ®ç»“æ„ï¼Œç†è§£å„ç§å¸¸é‡çš„ç”±æ¥å¯ä»¥æ›´å¥½åœ°è¿›è¡Œå˜åŒ–å¹¶åº”ç”¨åˆ°é«˜æ€§èƒ½åŠŸèƒ½å¼€å‘ä¸­ã€‚æœ¬æ–‡æ²¡æœ‰é‡å¤åœ°ä»¥å¯¹ç°æœ‰ä¼˜ç§€å®ç°è¿›è¡Œä»£ç åˆ†æï¼Œè€Œæ˜¯é€šè¿‡å¯¹è·³è·ƒè¡¨è¿›è¡Œäº†ç³»ç»Ÿæ€§åœ°ä»‹ç»ä¸å½¢å¼åŒ–åˆ†æï¼Œå¹¶ç»™å‡ºäº†åœ¨ç‰¹å®šåœºæ™¯ä¸‹çš„è·³è·ƒè¡¨æ‰©å±•æ–¹å¼ï¼Œæ–¹ä¾¿è¯»è€…æ›´å¥½åœ°ç†è§£è·³è·ƒè¡¨æ•°æ®ç»“æ„ã€‚&lt;/p&gt;

&lt;p&gt;è·³è·ƒè¡¨[1,2,3]æ˜¯ä¸€ç§ç”¨äºåœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­å–ä»£å¹³è¡¡æ ‘çš„æ¦‚ç‡æ•°æ®ç»“æ„ã€‚è·³è·ƒè¡¨æ‹¥æœ‰ä¸å¹³è¡¡æ ‘ç›¸åŒçš„æœŸæœ›æ—¶é—´ä¸Šç•Œï¼Œå¹¶ä¸”æ›´ç®€å•ã€æ›´å¿«ã€æ˜¯ç”¨æ›´å°‘çš„ç©ºé—´ã€‚åœ¨æŸ¥æ‰¾ä¸åˆ—è¡¨çš„çº¿æ€§æ“ä½œä¸Šï¼Œæ¯”å¹³è¡¡æ ‘æ›´å¿«ï¼Œå¹¶ä¸”æ›´ç®€å•ã€‚&lt;/p&gt;

&lt;p&gt;æ¦‚ç‡å¹³è¡¡ä¹Ÿå¯ä»¥è¢«ç”¨åœ¨åŸºäºæ ‘çš„æ•°æ®ç»“æ„[4]ä¸Šï¼Œä¾‹å¦‚æ ‘å †ï¼ˆTreapï¼‰ã€‚ä¸å¹³è¡¡äºŒå‰æ ‘ç›¸åŒï¼Œè·³è·ƒè¡¨ä¹Ÿå®ç°äº†ä»¥ä¸‹ä¸¤ç§æ“ä½œ&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt; é€šè¿‡æœç´¢å¼•ç”¨[5]ï¼Œå¯ä»¥ä¿è¯ä»ä»»æ„å…ƒç´ å¼€å§‹ï¼Œæœç´¢åˆ°åœ¨åˆ—è¡¨ä¸­é—´éš”ä¸ºkçš„å…ƒç´ çš„ä»»æ„æœŸæœ›æ—¶é—´æ˜¯O(logk)&lt;/li&gt;
&lt;li&gt; å®ç°çº¿æ€§è¡¨çš„å¸¸è§„æ“ä½œï¼ˆä¾‹å¦‚&lt;em&gt;å°†å…ƒç´ æ’å…¥åˆ°åˆ—è¡¨ç¬¬kä¸ªå…ƒç´ åé¢&lt;/em&gt;ï¼‰&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è¿™å‡ ç§æ“ä½œåœ¨å¹³è¡¡æ ‘ä¸­ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯åœ¨è·³è·ƒè¡¨ä¸­å®ç°èµ·æ¥æ›´ç®€å•è€Œä¸”éå¸¸çš„å¿«ï¼Œå¹¶ä¸”é€šå¸¸æƒ…å†µä¸‹å¾ˆéš¾åœ¨å¹³è¡¡æ ‘ä¸­ç›´æ¥å®ç°ï¼ˆæ ‘çš„çº¿ç´¢åŒ–å¯ä»¥å®ç°ä¸é“¾è¡¨ç›¸åŒçš„æ•ˆæœï¼Œä½†æ˜¯è¿™ä½¿å¾—å®ç°å˜å¾—æ›´åŠ å¤æ‚[6]ï¼‰&lt;/p&gt;

&lt;h1&gt;é¢„è§ˆ&lt;/h1&gt;

&lt;p&gt;æœ€ç®€å•çš„æ”¯æŒæŸ¥æ‰¾çš„æ•°æ®ç»“æ„å¯èƒ½å°±æ˜¯é“¾è¡¨ã€‚Figure.1æ˜¯ä¸€ä¸ªç®€å•çš„é“¾è¡¨ã€‚åœ¨é“¾è¡¨ä¸­æ‰§è¡Œä¸€æ¬¡æŸ¥æ‰¾çš„æ—¶é—´æ­£æ¯”äºå¿…é¡»è€ƒæŸ¥çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œè¿™ä¸ªä¸ªæ•°æœ€å¤šæ˜¯Nã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p26.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/7337ee2947384843afb802a44e4a961e%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.1 Linked List&lt;/p&gt;

&lt;p&gt;Figure.2è¡¨ç¤ºä¸€ä¸ªé“¾è¡¨ï¼Œåœ¨è¯¥é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªä¸€ä¸ªèŠ‚ç‚¹å°±æœ‰ä¸€ä¸ªé™„åŠ çš„æŒ‡é’ˆæŒ‡å‘å®ƒåœ¨è¡¨ä¸­çš„å‰ä¸¤ä¸ªä½ç½®ä¸Šçš„èŠ‚ç‚¹ã€‚æ­£å› ä¸ºè¿™ä¸ªå‰å‘æŒ‡é’ˆï¼Œåœ¨æœ€åæƒ…å†µä¸‹æœ€å¤šè€ƒæŸ¥âŒˆN/2âŒ‰+1ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p26.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/cb16d6e936494bfc963ce171ce70ff06%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.2 Linked List with fingers to the 2nd forward elements&lt;/p&gt;

&lt;p&gt;Figure.3å°†è¿™ç§æƒ³æ³•æ‰©å±•ï¼Œæ¯ä¸ªåºæ•°æ˜¯4çš„å€æ•°çš„èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªåºæ•°ä¸º4çš„å€æ•°çš„èŠ‚ç‚¹ã€‚åªæœ‰âŒˆN/4âŒ‰+2ä¸ªèŠ‚ç‚¹è¢«è€ƒæŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p9.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/0022157f67e34b5eae2f6ea3aa7e9903%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.3 Linked List with fingers to the 4th forward elements&lt;/p&gt;

&lt;p&gt;è¿™ç§è·³è·ƒå¹…åº¦çš„ä¸€èˆ¬æƒ…å†µå¦‚Figure.4æ‰€ç¤ºã€‚æ¯ä¸ª2ièŠ‚ç‚¹å°±æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ª2ièŠ‚ç‚¹ï¼Œå‰å‘æŒ‡é’ˆçš„é—´éš”æœ€å¤§ä¸ºN/2ã€‚å¯ä»¥è¯æ˜æ€»çš„æŒ‡é’ˆæœ€å¤§ä¸ä¼šè¶…è¿‡2Nï¼ˆè§ç©ºé—´å¤æ‚åº¦åˆ†æï¼‰ï¼Œä½†ç°åœ¨åœ¨ä¸€æ¬¡æŸ¥æ‰¾ä¸­æœ€å¤šè€ƒæŸ¥âŒˆlogNâŒ‰ä¸ªèŠ‚ç‚¹ã€‚è¿™æ„å‘³ç€ä¸€æ¬¡æŸ¥æ‰¾ä¸­æ€»çš„æ—¶é—´æ¶ˆè€—ä¸ºO(logN)ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ç§æ•°æ®ç»“æ„ä¸­çš„æŸ¥æ‰¾åŸºæœ¬ç­‰åŒäºäºŒåˆ†æŸ¥æ‰¾ï¼ˆbinary searchï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p3.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/7ee1456a098b4afdb3df44a8e769cb4a%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.4 Linked List with fingers to the 2ith forward elements&lt;/p&gt;

&lt;p&gt;åœ¨è¿™ç§æ•°æ®ç»“æ„ä¸­ï¼Œæ¯ä¸ªå…ƒç´ éƒ½ç”±ä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤ºã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªé«˜åº¦ï¼ˆheightï¼‰æˆ–çº§åˆ«ï¼ˆlevelï¼‰ï¼Œè¡¨ç¤ºèŠ‚ç‚¹æ‰€æ‹¥æœ‰çš„å‰å‘æŒ‡é’ˆæ•°é‡ã€‚æ¯ä¸ªèŠ‚ç‚¹çš„ç¬¬iä¸ªå‰å‘æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªçº§åˆ«ä¸ºiæˆ–æ›´é«˜çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å‰é¢æè¿°çš„æ•°æ®ç»“æ„ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„çº§åˆ«éƒ½æ˜¯ä¸å…ƒç´ æ•°é‡æœ‰å…³çš„ï¼Œå½“æ’å…¥æˆ–åˆ é™¤æ—¶éœ€è¦å¯¹æ•°æ®ç»“æ„è¿›è¡Œè°ƒæ•´æ¥æ»¡è¶³è¿™æ ·çš„çº¦æŸï¼Œè¿™æ˜¯å¾ˆå‘†æ¿ä¸”ä½æ•ˆçš„ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥&lt;em&gt;å°†æ¯ä¸ª2ièŠ‚ç‚¹å°±æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ª2ièŠ‚ç‚¹&lt;/em&gt;çš„é™åˆ¶å»æ‰ï¼Œå½“æ–°å…ƒç´ æ’å…¥æ—¶ä¸ºæ¯ä¸ªæ–°èŠ‚ç‚¹åˆ†é…ä¸€ä¸ªéšæœºçš„çº§åˆ«è€Œä¸ç”¨è€ƒè™‘æ•°æ®ç»“æ„çš„å…ƒç´ æ•°é‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-be29b8a8d0ea6ddb359667541720c692fa2.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p9.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/a627efa51d1d4cf89e83400649686226%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.5 Skip List&lt;/p&gt;

&lt;h1&gt;æ•°æ®ç»“æ„&lt;/h1&gt;

&lt;p&gt;åˆ°æ­¤ä¸ºæ­¢ï¼Œå·²ç»å¾—åˆ°äº†æ‰€æœ‰è®©é“¾è¡¨æ”¯æŒå¿«é€ŸæŸ¥æ‰¾çš„å……è¦æ¡ä»¶ï¼Œè€Œè¿™ç§å½¢å¼çš„æ•°æ®ç»“æ„å°±æ˜¯è·³è·ƒè¡¨ã€‚æ¥ä¸‹æ¥å°†ä¼šä½¿ç”¨æ›´æ­£è§„çš„æ–¹å¼æ¥å®šä¹‰è·³è·ƒè¡¨&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt; æ‰€æœ‰å…ƒç´ åœ¨è·³è·ƒè¡¨ä¸­éƒ½æ˜¯ç”±ä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤ºã€‚&lt;/li&gt;
&lt;li&gt; æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªé«˜åº¦æˆ–çº§åˆ«ï¼Œæœ‰æ—¶å€™ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºé˜¶ï¼ˆstepï¼‰ï¼ŒèŠ‚ç‚¹çš„çº§åˆ«æ˜¯ä¸€ä¸ªä¸å…ƒç´ æ€»æ•°æ— å…³çš„éšæœºæ•°ã€‚è§„å®šNULLçš„çº§åˆ«æ˜¯âˆã€‚&lt;/li&gt;
&lt;li&gt; æ¯ä¸ªçº§åˆ«ä¸ºkçš„èŠ‚ç‚¹éƒ½æœ‰kä¸ªå‰å‘æŒ‡é’ˆï¼Œä¸”ç¬¬iä¸ªå‰å‘æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªçº§åˆ«ä¸ºiæˆ–æ›´é«˜çš„èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt; æ¯ä¸ªèŠ‚ç‚¹çš„çº§åˆ«éƒ½ä¸ä¼šè¶…è¿‡ä¸€ä¸ªæ˜ç¡®çš„å¸¸é‡MaxLevelã€‚æ•´ä¸ªè·³è·ƒè¡¨çš„çº§åˆ«æ˜¯æ‰€æœ‰èŠ‚ç‚¹çš„çº§åˆ«çš„æœ€é«˜å€¼ã€‚å¦‚æœè·³è·ƒè¡¨æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆè·³è·ƒè¡¨çš„çº§åˆ«å°±æ˜¯1ã€‚&lt;/li&gt;
&lt;li&gt; å­˜åœ¨ä¸€ä¸ªå¤´èŠ‚ç‚¹headï¼Œå®ƒçš„çº§åˆ«æ˜¯MaxLevelï¼Œæ‰€æœ‰é«˜äºè·³è·ƒè¡¨çš„çº§åˆ«çš„å‰å‘æŒ‡é’ˆéƒ½æŒ‡å‘NULLã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç¨åå°†ä¼šæåˆ°ï¼ŒèŠ‚ç‚¹çš„æŸ¥æ‰¾è¿‡ç¨‹æ˜¯åœ¨å¤´èŠ‚ç‚¹ä»æœ€é«˜çº§åˆ«çš„æŒ‡é’ˆå¼€å§‹ï¼Œæ²¿ç€è¿™ä¸ªçº§åˆ«ä¸€ç›´èµ°ï¼Œç›´åˆ°æ‰¾åˆ°å¤§äºæ­£åœ¨å¯»æ‰¾çš„èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæˆ–è€…æ˜¯NULLï¼‰ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­é™¤äº†å¤´èŠ‚ç‚¹å¤–å¹¶æ²¡æœ‰ä½¿ç”¨åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„çº§åˆ«ï¼Œå› æ­¤&lt;strong&gt;æ¯ä¸ªèŠ‚ç‚¹æ— éœ€å­˜å‚¨èŠ‚ç‚¹çš„çº§åˆ«&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨è·³è·ƒè¡¨ä¸­ï¼Œçº§åˆ«ä¸º1çš„å‰å‘æŒ‡é’ˆä¸åŸå§‹çš„é“¾è¡¨ç»“æ„ä¸­nextæŒ‡é’ˆçš„ä½œç”¨å®Œå…¨ç›¸åŒï¼Œå› æ­¤è·³è·ƒè¡¨æ”¯æŒæ‰€æœ‰é“¾è¡¨æ”¯æŒçš„ç®—æ³•ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹åº”åˆ°é«˜çº§è¯­è¨€ä¸­çš„ç»“æ„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼ˆåç»­æ‰€æœ‰ä»£ç ç¤ºä¾‹éƒ½å°†ä½¿ç”¨Cè¯­è¨€æè¿°ï¼‰&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#define SKIP_LIST_KEY_TYPE     int
#define SKIP_LIST_VALUE_TYPE   int
#define SKIP_LIST_MAX_LEVEL    32
#define SKIP_LIST_P            0.5

struct Node {
  SKIP_LIST_KEY_TYPE    key;
  SKIP_LIST_VALUE_TYPE  value;
  struct Node          *forwards[]; // flexible array member
};

struct SkipList {
  struct Node *head;
  int          level;
};

struct Node *CreateNode(int level) {
  struct Node *node;
  assert(level &amp;gt; 0);
  node = malloc(sizeof(struct Node) + sizeof(struct Node *) * level);
  return node;
}

struct SkipList *CreateSkipList() {
  struct SkipList *list;
  struct Node     *head;
  int              i;

  list = malloc(sizeof(struct SkipList));
  head = CreateNode(SKIP_LIST_MAX_LEVEL);
  for (i = 0; i &amp;lt; SKIP_LIST_MAX_LEVEL; i++) {
    head-&amp;gt;forwards[i] = NULL;
  }
  list-&amp;gt;head = head;
  list-&amp;gt;level = 1;

  return list;
}


&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»å‰é¢çš„é¢„è§ˆç« èŠ‚ä¸­ï¼Œä¸éš¾çœ‹å‡ºMaxLevelçš„é€‰å€¼å½±å“ç€è·³è·ƒè¡¨çš„æŸ¥è¯¢æ€§èƒ½ï¼Œå…³äºMaxLevelçš„é€‰å€¼å°†ä¼šåœ¨åç»­ç« èŠ‚ä¸­è¿›è¡Œä»‹ç»ã€‚åœ¨æ­¤å…ˆå°†MaxLevelå®šä¹‰ä¸º32ï¼Œè¿™å¯¹äº232ä¸ªå…ƒç´ çš„è·³è·ƒè¡¨æ˜¯è¶³å¤Ÿçš„ã€‚å»¶ç»­é¢„è§ˆç« èŠ‚ä¸­çš„æè¿°ï¼Œè·³è·ƒè¡¨çš„æ¦‚ç‡è¢«å®šä¹‰ä¸º0.5ï¼Œå…³äºè¿™ä¸ªå€¼çš„é€‰å–é—®é¢˜å°†ä¼šåœ¨åç»­ç« èŠ‚ä¸­è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;

&lt;h1&gt;ç®—æ³•&lt;/h1&gt;

&lt;h2&gt;æœç´¢&lt;/h2&gt;

&lt;p&gt;åœ¨è·³è·ƒè¡¨ä¸­è¿›è¡Œæœç´¢çš„è¿‡ç¨‹ï¼Œæ˜¯é€šè¿‡Zå­—å½¢éå†æ‰€æœ‰æ²¡æœ‰è¶…è¿‡è¦å¯»æ‰¾çš„ç›®æ ‡å…ƒç´ çš„å‰å‘æŒ‡é’ˆæ¥å®Œæˆçš„ã€‚åœ¨å½“å‰çº§åˆ«æ²¡æœ‰å¯ä»¥ç§»åŠ¨çš„å‰å‘æŒ‡é’ˆæ—¶ï¼Œå°†ä¼šç§»åŠ¨åˆ°ä¸‹ä¸€çº§åˆ«è¿›è¡Œæœç´¢ã€‚ç›´åˆ°åœ¨çº§åˆ«ä¸º1çš„æ—¶å€™ä¸”æ²¡æœ‰å¯ä»¥ç§»åŠ¨çš„å‰å‘æŒ‡é’ˆæ—¶åœæ­¢æœç´¢ï¼Œæ­¤æ—¶ç›´æ¥æŒ‡å‘çš„èŠ‚ç‚¹ï¼ˆçº§åˆ«ä¸º1çš„å‰å‘æŒ‡é’ˆï¼‰å°±æ˜¯åŒ…å«ç›®æ ‡å…ƒç´ çš„èŠ‚ç‚¹ï¼ˆå¦‚æœç›®æ ‡å…ƒç´ åœ¨åˆ—è¡¨ä¸­çš„è¯ï¼‰ã€‚åœ¨Figure.6ä¸­å±•ç¤ºäº†åœ¨è·³è·ƒè¡¨ä¸­æœç´¢å…ƒç´ 17çš„è¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p3.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/627bbc0cc2484c78b06f2bcb57e860f7%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.6 A search path to find element 17 in Skip List&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªè¿‡ç¨‹çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œå› ä¸ºé«˜çº§è¯­è¨€ä¸­çš„æ•°ç»„ä¸‹æ ‡ä»0å¼€å§‹ï¼Œå› æ­¤forwards[0]è¡¨ç¤ºèŠ‚ç‚¹çš„çº§åˆ«ä¸º1çš„å‰å‘æŒ‡é’ˆï¼Œä¾æ­¤ç±»æ¨&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;struct Node *SkipListSearch(struct SkipList *list, SKIP_LIST_KEY_TYPE target) {
  struct Node *current;
  int          i;

  current = list-&amp;gt;head;
  for (i = list-&amp;gt;level - 1; i &amp;gt;= 0; i--) {
    while (current-&amp;gt;forwards[i] &amp;amp;&amp;amp; current-&amp;gt;forwards[i]-&amp;gt;key &amp;lt; target) {
      current = current-&amp;gt;forwards[i];
    }
  }

  current = current-&amp;gt;forwards[0];
  if (current-&amp;gt;key == target) {
    return current;
  } else {
    return NULL;
  }
}


&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;æ’å…¥å’Œåˆ é™¤&lt;/h2&gt;

&lt;p&gt;åœ¨æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ‰§è¡Œå’Œæœç´¢ç›¸åŒçš„é€»è¾‘ã€‚åœ¨æœç´¢çš„åŸºç¡€ä¸Šï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªåä¸ºupdateçš„å‘é‡ï¼Œå®ƒç»´æŠ¤çš„æ˜¯æœç´¢è¿‡ç¨‹ä¸­è·³è·ƒè¡¨æ¯ä¸ªçº§åˆ«ä¸Šéå†åˆ°çš„æœ€å³ä¾§çš„å€¼ï¼Œè¡¨ç¤ºæ’å…¥æˆ–åˆ é™¤çš„èŠ‚ç‚¹çš„å·¦ä¾§ç›´æ¥ç›´æ¥æŒ‡å‘å®ƒçš„èŠ‚ç‚¹ï¼Œç”¨äºåœ¨æ’å…¥æˆ–åˆ é™¤åè°ƒæ•´èŠ‚ç‚¹æ‰€åœ¨æ‰€æœ‰çº§åˆ«çš„å‰å‘æŒ‡é’ˆï¼ˆä¸æœ´ç´ çš„é“¾è¡¨èŠ‚ç‚¹æ’å…¥æˆ–åˆ é™¤çš„è¿‡ç¨‹ç›¸åŒï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å½“æ–°æ’å…¥èŠ‚ç‚¹çš„çº§åˆ«è¶…è¿‡å½“å‰è·³è·ƒè¡¨çš„çº§åˆ«æ—¶ï¼Œéœ€è¦å¢åŠ è·³è·ƒè¡¨çš„çº§åˆ«å¹¶å°†updateå‘é‡ä¸­å¯¹åº”çº§åˆ«çš„èŠ‚ç‚¹ä¿®æ”¹ä¸ºheadèŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;Figure.7å’ŒFigure.8å±•ç¤ºäº†åœ¨è·³è·ƒè¡¨ä¸­æ’å…¥å…ƒç´ 16çš„è¿‡ç¨‹ã€‚é¦–å…ˆï¼Œåœ¨Figure.7ä¸­æ‰§è¡Œä¸æœç´¢ç›¸åŒçš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œåœ¨æ¯ä¸ªçº§åˆ«éå†åˆ°çš„æœ€åä¸€ä¸ªå…ƒç´ åœ¨å¯¹åº”å±‚çº§çš„å‰å‘æŒ‡é’ˆè¢«æ ‡è®°ä¸ºç°è‰²ï¼Œè¡¨ç¤ºç¨åå°†ä¼šå¯¹é½è¿›è¡Œè°ƒæ•´ã€‚æ¥ä¸‹æ¥åœ¨Figure.8ä¸­ï¼Œåœ¨å…ƒç´ ä¸º13çš„èŠ‚ç‚¹åæ’å…¥å…ƒç´ 16ï¼Œå…ƒç´ 16å¯¹åº”çš„èŠ‚ç‚¹çš„çº§åˆ«æ˜¯5ï¼Œè¿™æ¯”è·³è·ƒè¡¨å½“å‰çº§åˆ«è¦é«˜ï¼Œå› æ­¤éœ€è¦å¢åŠ è·³è·ƒè¡¨çš„çº§åˆ«åˆ°5ï¼Œå¹¶å°†headèŠ‚ç‚¹å¯¹åº”çº§åˆ«çš„å‰å‘æŒ‡é’ˆæ ‡è®°ä¸ºç°è‰²ã€‚Figure.8ä¸­æ‰€æœ‰è™šçº¿éƒ¨åˆ†éƒ½è¡¨ç¤ºè°ƒæ•´åçš„æ•ˆæœã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p26.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/b92b6b8f8800457090faa983ca774af5%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.7 Search path for inserting element 16&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p9.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/36df4081c5864e56855785f612b1de9d%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.8 Insert element 16 and adjust forward pointers&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;struct Node *SkipListInsert(struct SkipList *list, SKIP_LIST_KEY_TYPE key, SKIP_LIST_VALUE_TYPE value) {
  struct Node *update[SKIP_LIST_MAX_LEVEL];
  struct Node *current;
  int          i;
  int          level;

  current = list-&amp;gt;head;
  for (i = list-&amp;gt;level - 1; i &amp;gt;= 0; i--) {
    while (current-&amp;gt;forwards[i] &amp;amp;&amp;amp; current-&amp;gt;forwards[i]-&amp;gt;key &amp;lt; target) {
      current = current-&amp;gt;forwards[i];
    }
    update[i] = current;
  }

  current = current-&amp;gt;forwards[0];
  if (current-&amp;gt;key == target) {
    current-&amp;gt;value = value;
    return current;
  }

  level = SkipListRandomLevel();
  if (level &amp;gt; list-&amp;gt;level) {
    for (i = list-&amp;gt;level; i &amp;lt; level; i++) {
      update[i] = list-&amp;gt;header;
    }
  }

  current = CreateNode(level);
  current-&amp;gt;key = key;
  current-&amp;gt;value = value;

  for (i = 0; i &amp;lt; level; i++) {
    current-&amp;gt;forwards[i] = update[i]-&amp;gt;forwards[i];
    update[i]-&amp;gt;forwards[i] = current;
  }

  return current;
}


&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨åˆ é™¤èŠ‚ç‚¹åï¼Œå¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ˜¯è·³è·ƒè¡¨ä¸­çº§åˆ«æœ€å¤§çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆéœ€è¦é™ä½è·³è·ƒè¡¨çš„çº§åˆ«ã€‚&lt;/p&gt;

&lt;p&gt;Figure.9å’ŒFigure.10å±•ç¤ºäº†åœ¨è·³è·ƒè¡¨ä¸­åˆ é™¤å…ƒç´ 19çš„è¿‡ç¨‹ã€‚é¦–å…ˆï¼Œåœ¨Figure.9ä¸­æ‰§è¡Œä¸æœç´¢ç›¸åŒçš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œåœ¨æ¯ä¸ªçº§åˆ«éå†åˆ°çš„æœ€åä¸€ä¸ªå…ƒç´ åœ¨å¯¹åº”å±‚çº§çš„å‰å‘æŒ‡é’ˆè¢«æ ‡è®°ä¸ºç°è‰²ï¼Œè¡¨ç¤ºç¨åå°†ä¼šå¯¹é½è¿›è¡Œè°ƒæ•´ã€‚æ¥ä¸‹æ¥åœ¨Figure.10ä¸­ï¼Œé¦–å…ˆé€šè¿‡è°ƒæ•´å‰å‘æŒ‡é’ˆå°†å…ƒç´ 19å¯¹åº”çš„èŠ‚ç‚¹ä»è·³è·ƒè¡¨ä¸­å¸è½½ï¼Œå› ä¸ºå…ƒç´ 19å¯¹åº”çš„èŠ‚ç‚¹æ˜¯çº§åˆ«æœ€é«˜çš„èŠ‚ç‚¹ï¼Œå› æ­¤å°†å…¶ä»è·³è·ƒè¡¨ä¸­ç§»é™¤åéœ€è¦è°ƒæ•´è·³è·ƒè¡¨çš„çº§åˆ«ã€‚Figure.10ä¸­æ‰€æœ‰è™šçº¿éƒ¨åˆ†éƒ½è¡¨ç¤ºè°ƒæ•´åçš„æ•ˆæœã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p3.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/8a1e9ac011ef4660b33fcbaae714e268%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.9 Search path for deleting element 19&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p26.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/438c95d4d2ab4ab99c16a9d4531c2970%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.10 Delete element 19 and adjust forward pointers&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;struct Node *SkipListDelete(struct SkipList *list, SKIP_LIST_KEY_TYPE key) {
  struct Node *update[SKIP_LIST_MAX_LEVEL];
  struct Node *current;
  int          i;

  current = list-&amp;gt;head;
  for (i = list-&amp;gt;level - 1; i &amp;gt;= 0; i--) {
    while (current-&amp;gt;forwards[i] &amp;amp;&amp;amp; current-&amp;gt;forwards[i]-&amp;gt;key &amp;lt; key) {
      current = current-&amp;gt;forwards[i];
    }
    update[i] = current;
  }

  current = current-&amp;gt;forwards[0];
  if (current &amp;amp;&amp;amp; current-&amp;gt;key == key) {
    for (i = 0; i &amp;lt; list-&amp;gt;level; i++) {
      if (update[i]-&amp;gt;forwards[i] == current) {
        update[i]-&amp;gt;forwards[i] = current-&amp;gt;forwards[i];
      } else {
        break;
      }
    }

    while (list-&amp;gt;level &amp;gt; 1 &amp;amp;&amp;amp; list-&amp;gt;head-&amp;gt;forwards[list-&amp;gt;level - 1] == NULL) {
      list-&amp;gt;level--;
    }
  }

  return current;
}


&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;ç”Ÿæˆéšæœºçº§åˆ«&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-58336d231b4cc6f269e879e9c6a39785562.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;int SkipListRandomLevel() {
  int level;
  level = 1;
  while (random() &amp;lt; RAND_MAX * SKIP_LIST_P &amp;amp;&amp;amp; level &amp;lt;= SKIP_LIST_MAX_LEVEL) {
    level++;
  }
  return level;
}


&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»¥ä¸‹è¡¨æ ¼ä¸ºæŒ‰ä¸Šé¢ç®—æ³•æ‰§è¡Œ232æ¬¡åï¼Œæ‰€ç”Ÿæˆçš„éšæœºçº§åˆ«çš„åˆ†å¸ƒæƒ…å†µã€‚&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;1&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;2&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;3&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;4&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;5&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;6&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;7&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;8&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;2147540777&lt;/td&gt;
&lt;td&gt;1073690199&lt;/td&gt;
&lt;td&gt;536842769&lt;/td&gt;
&lt;td&gt;268443025&lt;/td&gt;
&lt;td&gt;134218607&lt;/td&gt;
&lt;td&gt;67116853&lt;/td&gt;
&lt;td&gt;33563644&lt;/td&gt;
&lt;td&gt;16774262&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;9&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;10&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;11&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;12&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;13&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;14&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;15&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;16&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8387857&lt;/td&gt;
&lt;td&gt;4193114&lt;/td&gt;
&lt;td&gt;2098160&lt;/td&gt;
&lt;td&gt;1049903&lt;/td&gt;
&lt;td&gt;523316&lt;/td&gt;
&lt;td&gt;262056&lt;/td&gt;
&lt;td&gt;131455&lt;/td&gt;
&lt;td&gt;65943&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;17&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;18&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;19&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;20&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;21&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;22&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;23&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;24&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;32611&lt;/td&gt;
&lt;td&gt;16396&lt;/td&gt;
&lt;td&gt;8227&lt;/td&gt;
&lt;td&gt;4053&lt;/td&gt;
&lt;td&gt;2046&lt;/td&gt;
&lt;td&gt;1036&lt;/td&gt;
&lt;td&gt;492&lt;/td&gt;
&lt;td&gt;249&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;25&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;26&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;27&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;28&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;29&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;30&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;31&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;32&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;121&lt;/td&gt;
&lt;td&gt;55&lt;/td&gt;
&lt;td&gt;34&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;h2&gt;MaxLevelçš„é€‰æ‹©&lt;/h2&gt;

&lt;p&gt;åœ¨Figure.4ä¸­æ›¾ç»™å‡ºè¿‡å¯¹äº10ä¸ªå…ƒç´ çš„è·³è·ƒè¡¨æœ€ç†æƒ³çš„åˆ†å¸ƒæƒ…å†µï¼Œå…¶ä¸­5ä¸ªèŠ‚ç‚¹çš„çº§åˆ«æ˜¯1ï¼Œ3ä¸ªèŠ‚ç‚¹çš„çº§åˆ«æ˜¯2ï¼Œ1ä¸ªèŠ‚ç‚¹çš„çº§åˆ«æ˜¯3ï¼Œ1ä¸ªèŠ‚ç‚¹çš„çº§åˆ«æ˜¯4ã€‚&lt;/p&gt;

&lt;p&gt;è¿™å¼•ç”³å‡ºä¸€ä¸ªé—®é¢˜ï¼š&lt;em&gt;æ—¢ç„¶ç›¸åŒå…ƒç´ æ•°é‡ä¸‹ï¼Œè·³è·ƒè¡¨çš„çº§åˆ«ä¸åŒä¼šæœ‰ä¸åŒçš„æ€§èƒ½ï¼Œé‚£ä¹ˆè·³è·ƒè¡¨çš„çº§åˆ«ä¸ºå¤šå°‘æ‰åˆé€‚ï¼Ÿ&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-064125296e0a61b0fdffbc8b903fa8e9e86.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h1&gt;åˆ†æ&lt;/h1&gt;

&lt;h2&gt;ç©ºé—´å¤æ‚åº¦åˆ†æ&lt;/h2&gt;

&lt;p&gt;å‰é¢æåˆ°è¿‡ï¼Œ&lt;em&gt;åˆ†æ•°pä»£è¡¨èŠ‚ç‚¹åŒæ—¶å¸¦æœ‰ç¬¬iå±‚å‰å‘æŒ‡é’ˆå’Œç¬¬i+1å±‚å‰å‘æŒ‡é’ˆçš„æ¦‚ç‡&lt;/em&gt;ï¼Œè€Œæ¯ä¸ªèŠ‚ç‚¹çš„çº§åˆ«æœ€å°‘æ˜¯1ï¼Œå› æ­¤çº§åˆ«ä¸ºiçš„å‰å‘æŒ‡é’ˆæ•°ä¸ºnpiâˆ’1ã€‚å®šä¹‰S(n)è¡¨ç¤ºæ‰€æœ‰å‰å‘æŒ‡é’ˆçš„æ€»é‡ï¼Œç”±ç­‰æ¯”æ•°åˆ—æ±‚å’Œå…¬å¼å¯å¾—&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-d28539b4e6ab715c414455cb69d52e651ed.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;å¯¹S(n)æ±‚æé™ï¼Œæœ‰&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-70df67c8afb43d87ad89b7dc3c0f7dc27d8.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;æ˜“è¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³äºpçš„å•è°ƒé€’å¢å‡½æ•°ï¼Œå› æ­¤pçš„å€¼è¶Šå¤§ï¼Œè·³è·ƒè¡¨ä¸­å‰å‘æŒ‡é’ˆçš„æ€»æ•°è¶Šå¤šã€‚å› ä¸º1âˆ’pæ˜¯å·²çŸ¥çš„å¸¸æ•°ï¼Œæ‰€ä»¥è¯´è·³è·ƒè¡¨çš„ç©ºé—´å¤æ‚åº¦æ˜¯O(n)ã€‚&lt;/p&gt;

&lt;h2&gt;æ—¶é—´å¤æ‚åº¦åˆ†æ&lt;/h2&gt;

&lt;h3&gt;éå½¢å¼åŒ–åˆ†æ&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-11d736681aa7893e093c3bf134245c54fe4.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h3&gt;å½¢å¼åŒ–åˆ†æ&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-653effa3a5c4294cac2c1b9017dfcda72ba.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;å»¶ç»­&lt;em&gt;åˆ†æ•°pä»£è¡¨èŠ‚ç‚¹åŒæ—¶å¸¦æœ‰ç¬¬iå±‚å‰å‘æŒ‡é’ˆå’Œç¬¬i+1å±‚å‰å‘æŒ‡é’ˆçš„æ¦‚ç‡&lt;/em&gt;çš„å®šä¹‰ï¼Œè€ƒè™‘åæ–¹å‘åˆ†ææœç´¢è·¯å¾„ã€‚&lt;/p&gt;

&lt;p&gt;æœç´¢çš„è·¯å¾„æ€»æ˜¯å°äºå¿…é¡»æ‰§è¡Œçš„æ¯”è¾ƒçš„æ¬¡æ•°çš„ã€‚é¦–å…ˆéœ€è¦è€ƒæŸ¥ä»çº§åˆ«1ï¼ˆåœ¨æœç´¢åˆ°å…ƒç´ å‰éå†çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼‰çˆ¬å‡åˆ°çº§åˆ«L(n)æ‰€éœ€è¦åå‘è·Ÿè¸ªçš„æŒ‡é’ˆæ•°é‡ã€‚è™½ç„¶åœ¨æœç´¢æ—¶å¯ä»¥ç¡®å®šæ¯ä¸ªèŠ‚ç‚¹çš„çº§åˆ«éƒ½æ˜¯å·²çŸ¥ä¸”ç¡®å®šçš„ï¼Œåœ¨è¿™é‡Œä»è®¤ä¸ºåªæœ‰å½“æ•´ä¸ªæœç´¢è·¯å¾„éƒ½è¢«åå‘è¿½è¸ªåæ‰èƒ½è¢«ç¡®å®šï¼Œå¹¶ä¸”åœ¨çˆ¬å‡åˆ°çº§åˆ«L(n)ä¹‹å‰éƒ½ä¸ä¼šæ¥è§¦åˆ°headèŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨çˆ¬å‡è¿‡ç¨‹ä¸­ä»»ä½•ç‰¹å®šçš„ç‚¹ï¼Œéƒ½è®¤ä¸ºæ˜¯åœ¨å…ƒç´ xçš„ç¬¬iä¸ªå‰å‘æŒ‡é’ˆï¼Œå¹¶ä¸”ä¸çŸ¥é“å…ƒç´ xå·¦ä¾§æ‰€æœ‰å…ƒç´ çš„çº§åˆ«æˆ–å…ƒç´ xçš„çº§åˆ«ï¼Œä½†æ˜¯å¯ä»¥çŸ¥é“å…ƒç´ xçš„çº§åˆ«è‡³å°‘æ˜¯iã€‚å…ƒç´ xçš„çº§åˆ«å¤§äºiçš„æ¦‚ç‡æ˜¯pï¼Œå¯ä»¥é€šè¿‡è€ƒè™‘è§†è®¤ä¸ºè¿™ä¸ªåå‘çˆ¬å‡çš„è¿‡ç¨‹æ˜¯ä¸€ç³»åˆ—ç”±æˆåŠŸçš„çˆ¬å‡åˆ°æ›´é«˜çº§åˆ«æˆ–å¤±è´¥åœ°å‘å·¦ç§»åŠ¨çš„éšæœºç‹¬ç«‹å®éªŒã€‚&lt;/p&gt;

&lt;p&gt;åœ¨çˆ¬å‡åˆ°çº§åˆ«L(n)è¿‡ç¨‹ä¸­ï¼Œå‘å·¦ç§»åŠ¨çš„æ¬¡æ•°ç­‰äºåœ¨è¿ç»­éšæœºè¯•éªŒä¸­ç¬¬L(n)âˆ’1æ¬¡æˆåŠŸå‰çš„å¤±è´¥çš„æ¬¡æ•°ï¼Œè¿™ç¬¦åˆè´ŸäºŒé¡¹åˆ†å¸ƒã€‚æœŸæœ›çš„å‘ä¸Šç§»åŠ¨æ¬¡æ•°ä¸€å®šæ˜¯L(n)âˆ’1ã€‚å› æ­¤å¯ä»¥å¾—åˆ°æ— é™åˆ—è¡¨ä¸­çˆ¬å‡åˆ°L(n)çš„ä»£ä»·C C=prob(L(n)âˆ’1)+NB(L(n)âˆ’1,p) åˆ—è¡¨é•¿åº¦æ— é™å¤§æ˜¯ä¸€ä¸ªæ‚²è§‚çš„å‡è®¾ã€‚å½“åå‘çˆ¬å‡çš„è¿‡ç¨‹ä¸­æ¥è§¦åˆ°headèŠ‚ç‚¹æ—¶ï¼Œå¯ä»¥ç›´æ¥å‘ä¸Šçˆ¬å‡è€Œä¸éœ€è¦ä»»ä½•å‘å·¦ç§»åŠ¨ã€‚å› æ­¤å¯ä»¥å¾—åˆ°nä¸ªå…ƒç´ åˆ—è¡¨ä¸­çˆ¬å‡åˆ°L(n)çš„ä»£ä»·C(n)&lt;/p&gt;

&lt;p&gt;C(n)â‰¤probC=prob(L(n)âˆ’1)+NB(L(n)âˆ’1,p)&lt;/p&gt;

&lt;p&gt;å› æ­¤nä¸ªå…ƒç´ åˆ—è¡¨ä¸­çˆ¬å‡åˆ°L(n)çš„ä»£ä»·C(n)çš„æ•°å­¦æœŸæœ›å’Œæ–¹å·®ä¸º&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p9.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/8c386243c4da4ac38ca27393e88965d9%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;å› ä¸º1/pæ˜¯å·²çŸ¥å¸¸æ•°ï¼Œå› æ­¤è·³è·ƒè¡¨çš„æœç´¢ã€æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(logn)ã€‚&lt;/p&gt;

&lt;h3&gt;Pçš„é€‰æ‹©&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-b1da641bb3fe4cff0ce56c7788dd5a8e9b9.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://p9.toutiaoimg.com/img/tos-cn-i-qvj2lq49k0/f2c647b63c8c4bc4a4fd4d3caadc96d5%7Etplv-tt-shrink:640:0.image&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Figure.11 Normalized search times&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-1a1c6af3269691d434f8a03fd3fc8219d1e.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h1&gt;æ‰©å±•&lt;/h1&gt;

&lt;h2&gt;å¿«é€Ÿéšæœºè®¿é—®&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-4380db2d43d5a82b129493dfffe9935d18a.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#define SKIP_LIST_KEY_TYPE     int
#define SKIP_LIST_VALUE_TYPE   int
#define SKIP_LIST_MAX_LEVEL    32
#define SKIP_LIST_P            0.5

struct Node; // forward definition

struct Forward {
  struct Node *forward;
  int          span;
}

struct Node {
  SKIP_LIST_KEY_TYPE    key;
  SKIP_LIST_VALUE_TYPE  value;
  struct Forward        forwards[]; // flexible array member
};

struct SkipList {
  struct Node *head;
  int          level;
  int          length;
};

struct Node *CreateNode(int level) {
  struct Node *node;
  assert(level &amp;gt; 0);
  node = malloc(sizeof(struct Node) + sizeof(struct Forward) * level);
  return node;
}

struct SkipList *CreateSkipList() {
  struct SkipList *list;
  struct Node     *head;
  int              i;

  list = malloc(sizeof(struct SkipList));
  head = CreateNode(SKIP_LIST_MAX_LEVEL);
  for (i = 0; i &amp;lt; SKIP_LIST_MAX_LEVEL; i++) {
    head-&amp;gt;forwards[i].forward = NULL;
    head-&amp;gt;forwards[i].span = 0;
  }

  list-&amp;gt;head = head;
  list-&amp;gt;level = 1;

  return list;
}


&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¥ä¸‹æ¥éœ€è¦ä¿®æ”¹æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œæ¥ä¿è¯åœ¨è·³è·ƒè¡¨ä¿®æ”¹åè·¨åº¦çš„æ•°æ®å®Œæ•´æ€§ã€‚&lt;/p&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ’å…¥è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨indicesè®°å½•åœ¨æ¯ä¸ªå±‚çº§éå†åˆ°çš„æœ€åä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œè¿™æ ·é€šè¿‡åšç®€å•çš„å‡æ³•æ“ä½œå°±å¯ä»¥çŸ¥é“æ¯ä¸ªå±‚çº§éå†åˆ°çš„æœ€åä¸€ä¸ªå…ƒç´ åˆ°æ–°æ’å…¥èŠ‚ç‚¹çš„è·¨åº¦ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;struct Node *SkipListInsert(struct SkipList *list, SKIP_LIST_KEY_TYPE key, SKIP_LIST_VALUE_TYPE value) {
  struct Node *update[SKIP_LIST_MAX_LEVEL];
  struct Node *current;
  int          indices[SKIP_LIST_MAX_LEVEL];
  int          i;
  int          level;

  current = list-&amp;gt;head;
  for (i = list-&amp;gt;level - 1; i &amp;gt;= 0; i--) {
    if (i == list-&amp;gt;level - 1) {
      indices[i] = 0;
    } else {
      indices[i] = indices[i + 1];
    }

    while (current-&amp;gt;forwards[i].forward &amp;amp;&amp;amp; current-&amp;gt;forwards[i].forward-&amp;gt;key &amp;lt; target) {
      indices[i] += current-&amp;gt;forwards[i].span;
      current = current-&amp;gt;forwards[i].forward;
    }
    update[i] = current;
  }

  current = current-&amp;gt;forwards[0].forward;
  if (current-&amp;gt;key == target) {
    current-&amp;gt;value = value;
    return current;
  }

  level = SkipListRandomLevel();
  if (level &amp;gt; list-&amp;gt;level) {
    for (i = list-&amp;gt;level; i &amp;lt; level; i++) {
      indices[i] = 0;
      update[i] = list-&amp;gt;header;
      update[i]-&amp;gt;forwards[i].span = list-&amp;gt;length;
    }
  }

  current = CreateNode(level);
  current-&amp;gt;key = key;
  current-&amp;gt;value = value;

  for (i = 0; i &amp;lt; level; i++) {
    current-&amp;gt;forwards[i].forward = update[i]-&amp;gt;forwards[i].forward;
    update[i]-&amp;gt;forwards[i].forward = current;
    current-&amp;gt;forwards[i].span = update[i]-&amp;gt;forwards[i].span - (indices[0] - indices[i]);
    update[i]-&amp;gt;forwards[i].span = (indices[0] - indices[i]) + 1;
  }

  list.length++;

  return current;
}


&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;struct Node *SkipListDelete(struct SkipList *list, SKIP_LIST_KEY_TYPE key) {
  struct Node *update[SKIP_LIST_MAX_LEVEL];
  struct Node *current;
  int          i;

  current = list-&amp;gt;head;
  for (i = list-&amp;gt;level - 1; i &amp;gt;= 0; i--) {
    while (current-&amp;gt;forwards[i].forward &amp;amp;&amp;amp; current-&amp;gt;forwards[i].forward-&amp;gt;key &amp;lt; key) {
      current = current-&amp;gt;forwards[i].forward;
    }
    update[i] = current;
  }

  current = current-&amp;gt;forwards[0].forward;
  if (current &amp;amp;&amp;amp; current-&amp;gt;key == key) {
    for (i = 0; i &amp;lt; list-&amp;gt;level; i++) {
      if (update[i]-&amp;gt;forwards[i].forward == current) {
        update[i]-&amp;gt;forwards[i].forward = current-&amp;gt;forwards[i];
        update[i]-&amp;gt;forwards[i].span += current-&amp;gt;forwards[i].span - 1;
      } else {
        break;
      }
    }

    while (list-&amp;gt;level &amp;gt; 1 &amp;amp;&amp;amp; list-&amp;gt;head-&amp;gt;forwards[list-&amp;gt;level - 1] == NULL) {
      list-&amp;gt;level--;
    }
  }

  return current;
}


&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“å®ç°äº†å¿«é€Ÿéšæœºè®¿é—®ä¹‹åï¼Œé€šè¿‡ç®€å•çš„æŒ‡é’ˆæ“ä½œå³å¯å®ç°åŒºé—´æŸ¥è¯¢åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;h1&gt;å‚è€ƒæ–‡çŒ®&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt; Pugh, W. (1989). A skip list cookbook. Tech. Rep. CS-TR-2286.1, Dept. of Computer Science, Univ. of Maryland, College Park, MD [July 1989]&lt;/li&gt;
&lt;li&gt; Pugh, W. (1989). Skip lists: A probabilistic alternative to balanced trees. Lecture Notes in Computer Science, 437â€“449. &lt;a href=&quot;https://doi.org/10.1007/3-540-51542-9_36&quot;&gt;https://doi.org/10.1007/3-540-51542-9_36&lt;/a&gt;&lt;/li&gt;
&lt;li&gt; Weiss, M. A. (1996).&lt;em&gt;Data Structures and Algorithm Analysis in C (2nd Edition)&lt;/em&gt;(2nd ed.). Pearson.&lt;/li&gt;
&lt;li&gt; Aragon, Cecilia &amp;amp; Seidel, Raimund. (1989). Randomized Search Trees. 540-545. 10.1109/SFCS.1989.63531.&lt;/li&gt;
&lt;li&gt; Wikipedia contributors. (2022b, November 22).&lt;em&gt;Finger search&lt;/em&gt;. Wikipedia. &lt;a href=&quot;https://en.wikipedia.org/wiki/Finger_search&quot;&gt;https://en.wikipedia.org/wiki/Finger_search&lt;/a&gt;&lt;/li&gt;
&lt;li&gt; Wikipedia contributors. (2022a, October 24).&lt;em&gt;Threaded binary tree&lt;/em&gt;. Wikipedia. &lt;a href=&quot;https://en.wikipedia.org/wiki/Threaded_binary_tree&quot;&gt;https://en.wikipedia.org/wiki/Threaded_binary_tree&lt;/a&gt;&lt;/li&gt;
&lt;li&gt; Wikipedia contributors. (2023, January 4).&lt;em&gt;Negative binomial distribution&lt;/em&gt;. Wikipedia. &lt;a href=&quot;https://en.wikipedia.org/wiki/Negative_binomial_distribution&quot;&gt;https://en.wikipedia.org/wiki/Negative_binomial_distribution&lt;/a&gt;&lt;/li&gt;
&lt;li&gt; Redis contributors.&lt;em&gt;Redis ordered set implementation&lt;/em&gt;. GitHub. &lt;a href=&quot;https://github.com/redis/redis&quot;&gt;https://github.com/redis/redis&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h1&gt;åç»­å·¥ä½œ&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt; ç¡®å®šæ€§è·³è·ƒè¡¨&lt;/li&gt;
&lt;li&gt; æ— é”å¹¶å‘å®‰å…¨è·³è·ƒè¡¨&lt;/li&gt;
&lt;/ol&gt;

&lt;h3&gt;å› æ–‡ç« å±•ç¤ºå®Œæ•´æ€§éœ€è¦ï¼Œæ‰€ä»¥éƒ¨åˆ†å…¬å¼å†…å®¹é‡‡ç”¨æˆªå›¾ä¸Šä¼ ï¼Œæ’ç‰ˆä¸å½“ä¹‹å¤„è¿˜æœ›åŒ…æ¶µã€‚&lt;/h3&gt;
&lt;/div&gt;
  &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>d475e021bd5777212e4c6914371726c9</guid>
<title>40 ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå¸¦ä½ ç†è§£ RocketMQ è®¾è®¡ç²¾é«“</title>
<link>https://toutiao.io/k/qzcxdmf</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;section&gt;&lt;mp-common-profile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-weui-theme=&quot;light&quot; data-id=&quot;MzU2NTEyNjIzMw==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicd8cjqsZ9HP3aatIrg6qmFeibZXoF4kIvQaib8Sb6Wg4IicH2uZNurWvYxjIHQo3ATRcfTroRrKknd2dQ/0?wx_fmt=png&quot; data-nickname=&quot;å›å“¥èŠæŠ€æœ¯&quot; data-alias=&quot;&quot; data-signature=&quot;åç«¯æ¶æ„å¸ˆï¼Œå®šæœŸåˆ†äº«æŠ€æœ¯å¹²è´§ï¼ŒåŒ…æ‹¬åç«¯å¼€å‘ã€åˆ†å¸ƒå¼ã€ä¸­é—´ä»¶ã€äº‘åŸç”Ÿç­‰ã€‚åŒæ—¶ä¹Ÿä¼šåˆ†äº«èŒåœºå¿ƒå¾—ã€ç¨‹åºäººç”Ÿã€‚å…³æ³¨æˆ‘ï¼Œä¸€èµ·è¿›é˜¶ã€‚&quot; data-from=&quot;0&quot; data-is_biz_ban=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å›å“¥ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»Šå¤©æ¥åˆ†äº« RocketMQ çš„å®šæ—¶ä»»åŠ¡ã€‚é€šè¿‡è¿™äº›å®šæ—¶ä»»åŠ¡ï¼Œèƒ½è®©æˆ‘ä»¬æ›´åŠ ç†è§£ RocketMQ çš„æ¶ˆæ¯å¤„ç†æœºåˆ¶å’Œè®¾è®¡ç†å¿µã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä» RocketMQ 4.9.4 çš„æºä»£ç ä¸Šçœ‹ï¼ŒRocketMQ çš„å®šæ—¶ä»»åŠ¡æœ‰å¾ˆå¤šï¼Œä»Šå¤©ä¸»è¦è®²è§£ä¸€äº›æ ¸å¿ƒçš„å®šæ—¶ä»»åŠ¡ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;1 æ¶æ„å›é¡¾&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¦–å…ˆå†æ¥å›é¡¾ä¸€ä¸‹ RocketMQ çš„æ¶æ„å›¾ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5809379727685325&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicd8diaKQCynPCP4t87lEu3dWKHfUHibpUVrmPgpXoFRfk93leQae6sBBIzGAafL7bxOWqG9NaptHd5KQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;661&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Name Server é›†ç¾¤éƒ¨ç½²ï¼Œä½†æ˜¯èŠ‚ç‚¹ä¹‹é—´å¹¶ä¸ä¼šåŒæ­¥æ•°æ®ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šä¿å­˜å®Œæ•´çš„æ•°æ®ã€‚å› æ­¤å•ä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œå¹¶ä¸ä¼šå¯¹é›†ç¾¤äº§ç”Ÿå½±å“ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker å¯ä»¥é‡‡ç”¨ä¸»ä»é›†ç¾¤éƒ¨ç½²ï¼Œå®ç°å¤šå‰¯æœ¬å­˜å‚¨å’Œé«˜å¯ç”¨ã€‚æ¯ä¸ª Broker èŠ‚ç‚¹éƒ½è¦è·Ÿæ‰€æœ‰çš„ Name Server èŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šä¹‰æ³¨å†Œ Topic è·¯ç”±ä¿¡æ¯å’Œå‘é€å¿ƒè·³ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Producer å’Œ Consumer è·Ÿ Name Server çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä» Name Server æ‹‰å– Topic è·¯ç”±ä¿¡æ¯ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;2 Producer å’Œ Consumer&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.1 è·å– NameServer åœ°å€&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Producer å’Œ Consumer è¦è·Ÿ Name Server å»ºç«‹è¿æ¥ï¼Œå°±å¿…é¡»é¦–å…ˆè·å– Name Server åœ°å€ã€‚Producer å’Œ Consumer é‡‡ç”¨å®šæ—¶ä»»åŠ¡æ¯ä¸¤åˆ†é’Ÿè·å– Name Server åœ°å€å¹¶æ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//MQClientInstanceç±»&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â MQClientInstance.&lt;span&gt;this&lt;/span&gt;.mQClientAPIImpl.fetchNameServerAddr();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ScheduledTaskÂ fetchNameServerAddrÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;60&lt;/span&gt;Â *Â &lt;span&gt;2&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.2 æ›´æ–°è·¯ç”±ä¿¡æ¯&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Producer å’Œ Consumer ä¼šå®šæ—¶ä» Name Server è·å–å®šæ—¶è®¢é˜…ä¿¡æ¯ï¼Œæ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œé»˜è®¤é—´éš”æ˜¯ 30sï¼ˆå¯ä»¥é…ç½®ï¼‰ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//MQClientInstanceç±»&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â MQClientInstance.&lt;span&gt;this&lt;/span&gt;.updateTopicRouteInfoFromNameServer();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ScheduledTaskÂ updateTopicRouteInfoFromNameServerÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;this&lt;/span&gt;.clientConfig.getPollNameServerInterval(),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.3 å‘ Broker å‘é€å¿ƒè·³&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Producer å’Œ Consumer ä¼šä»æœ¬åœ°ç¼“å­˜çš„ Broker åˆ—è¡¨ä¸­å®šæ—¶æ¸…é™¤ç¦»çº¿çš„ Brokerï¼Œå¹¶ä¸”å‘ Broker å‘é€å¿ƒè·³ï¼Œé»˜è®¤é—´éš”æ˜¯ 30sï¼ˆå¯ä»¥é…ç½®ï¼‰ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//MQClientInstanceç±»&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â MQClientInstance.&lt;span&gt;this&lt;/span&gt;.cleanOfflineBroker();&lt;br/&gt;Â Â Â MQClientInstance.&lt;span&gt;this&lt;/span&gt;.sendHeartbeatToAllBrokerWithLock();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ScheduledTaskÂ sendHeartbeatToAllBrokerÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;,Â &lt;span&gt;this&lt;/span&gt;.clientConfig.getHeartbeatBrokerInterval(),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.4 æŒä¹…åŒ– Offset&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¶ˆè´¹è€…éœ€è¦å®šæ—¶æŒä¹…åŒ– MessageQueue çš„åç§»é‡ï¼Œé»˜è®¤æ¯ 5s æ›´æ–°ä¸€æ¬¡ï¼ˆå¯ä»¥é…ç½®ï¼‰ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;strong&gt;æ³¨æ„ï¼šé›†ç¾¤æ¨¡å¼éœ€è¦å‘ Broker å‘é€æŒä¹…åŒ–æ¶ˆæ¯ï¼Œå› ä¸ºé›†ç¾¤æ¨¡å¼åç§»é‡ä¿å­˜åœ¨ Broker ç«¯ï¼Œè€Œå¹¿æ’­æ¨¡å¼åªéœ€è¦æŠŠåç§»é‡ä¿å­˜åœ¨æ¶ˆè´¹è€…æœ¬åœ°æ–‡ä»¶ã€‚&lt;/strong&gt;&lt;/span&gt;ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//MQClientInstanceç±»&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â MQClientInstance.&lt;span&gt;this&lt;/span&gt;.persistAllConsumerOffset();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ScheduledTaskÂ persistAllConsumerOffsetÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;this&lt;/span&gt;.clientConfig.getPersistConsumerOffsetInterval(),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.5 è°ƒæ•´æ ¸å¿ƒçº¿ç¨‹æ•°&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯¹äºæ¶ˆè´¹è€…é‡‡ç”¨æ¨æ¨¡å¼çš„æƒ…å†µï¼Œæ¶ˆè´¹è€…ä¼šæ ¹æ®æœªæ¶ˆè´¹çš„æ¶ˆæ¯æ•°é‡ï¼Œå®šæœŸæ›´æ–°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé»˜è®¤æ¯ 1m ä¸€æ¬¡ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;strong&gt;æ³¨æ„ï¼šåœ¨ 4.9.4 è¿™ä¸ªç‰ˆæœ¬ï¼Œæ›´æ–°æ ¸å¿ƒçº¿ç¨‹æ•°çš„ä»£ç å¹¶æ²¡æœ‰å®ç°ï¼Œåªæ˜¯é¢„ç•™äº†æ¥å£ã€‚&lt;/strong&gt;&lt;/span&gt;ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//MQClientInstanceç±»&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â MQClientInstance.&lt;span&gt;this&lt;/span&gt;.adjustThreadPool();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ScheduledTaskÂ adjustThreadPoolÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1&lt;/span&gt;,Â &lt;span&gt;1&lt;/span&gt;,Â TimeUnit.MINUTES);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.6 å¤±æ•ˆè¿‡æœŸè¯·æ±‚&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Producer å’Œ Consumer ä¼šå®šæ—¶æ‰«æç¼“å­˜åœ¨æœ¬åœ°çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚å¼€å§‹æ—¶é—´åŠ è¶…æ—¶æ—¶é—´ï¼ˆå†åŠ  1sï¼‰å°äºå½“å‰æ—¶é—´ï¼Œåˆ™è¿™ä¸ªè¯·æ±‚è¿‡æœŸã€‚é€šè¿‡å®šæ—¶ä»»åŠ¡ï¼ˆ3s ä¸€æ¬¡ï¼‰è®©è¿‡æœŸè¯·æ±‚å¤±æ•ˆï¼Œå¹¶ä¸”è§¦å‘å›è°ƒå‡½æ•°ã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//NettyRemotingClient.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.timer.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â TimerTask()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â NettyRemotingClient.&lt;span&gt;this&lt;/span&gt;.scanResponseTable();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scanResponseTableÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;3&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.7 ç”Ÿäº§è€…&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.7.1 æ€§èƒ½è®°å½•&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œä¼šå¯¹æˆåŠŸå¤±è´¥çš„çŠ¶æ€ã€èŠ±è´¹æ—¶é—´è¿›è¡Œè®°å½•ï¼Œä»¥æ­¤æ¥è®¡ç®—ååé‡ TPSï¼Œå“åº”æ—¶é—´ RTï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//Producer.java&lt;/span&gt;&lt;br/&gt;executorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â TimerTask()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â snapshotList.addLast(statsBenchmark.createSnapshot());&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (snapshotList.size()Â &amp;gt;Â &lt;span&gt;10&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â snapshotList.removeFirst();&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;br/&gt;executorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â TimerTask()Â {&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;printStats&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (snapshotList.size()Â &amp;gt;=Â &lt;span&gt;10&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â doPrintStats(snapshotList,Â Â statsBenchmark,Â &lt;span&gt;false&lt;/span&gt;);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;this&lt;/span&gt;.printStats();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â e.printStackTrace();&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;10000&lt;/span&gt;,Â &lt;span&gt;10000&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.8 æ¶ˆè´¹è€…&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.8.1 MessageQueue åŠ é”&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯¹äºé¡ºåºæ¶ˆæ¯ï¼Œè¦ä¿è¯åŒä¸€ä¸ª MessageQueue åªèƒ½è¢«åŒä¸€ä¸ª Consumer æ¶ˆè´¹ã€‚æ¶ˆè´¹è€…åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ï¼ˆé»˜è®¤ 20sï¼Œå¯ä»¥é…ç½®ï¼‰åœ°å‘ Broker å‘é€é”å®šæ¶ˆæ¯ï¼ŒBroker æ”¶åˆ°è¯·æ±‚åï¼Œå°±ä¼šæŠŠ MessageQueueã€group å’Œ clientId è¿›è¡Œç»‘å®šï¼Œè¿™æ ·å…¶ä»–å®¢æˆ·ç«¯å°±ä¸èƒ½ä»è¿™ä¸ª MessageQueue æ‹‰å–æ¶ˆæ¯ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//ConsumeMessageOrderlyService.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â ConsumeMessageOrderlyService.&lt;span&gt;this&lt;/span&gt;.lockMQPeriodically();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scheduleAtFixedRateÂ lockMQPeriodicallyÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;1&lt;/span&gt;,Â ProcessQueue.REBALANCE_LOCK_INTERVAL,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ³¨æ„ï¼šBroker çš„åŠ é”æ˜¯æœ‰æ—¶æ•ˆçš„ï¼ˆé»˜è®¤ 60sï¼Œå¯ä»¥é…ç½®ï¼‰ï¼Œè¿‡æœŸåï¼Œæœ‰å¯èƒ½è¢«å…¶ä»– Consumer è¿›è¡Œæ¶ˆè´¹ã€‚&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.8.2 æ€§èƒ½å¿«ç…§&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Consumer æ¯ç§’ä¼šè®°å½•ä¸€æ¬¡æ€§èƒ½å¿«ç…§ï¼Œæ¯”å¦‚æ¶ˆæ¯ä»åˆ›å»ºåˆ°æ¶ˆè´¹èŠ±è´¹çš„æ—¶é—´ï¼Œæ¶ˆæ¯ä»ä¿å­˜åˆ°æ¶ˆè´¹èŠ±è´¹çš„æ—¶é—´ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯çš„æ€»æ•°é‡ï¼Œå¤±è´¥æ€»æ•°é‡ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//Consumer.java&lt;/span&gt;&lt;br/&gt;executorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â TimerTask()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â snapshotList.addLast(statsBenchmarkConsumer.createSnapshot());&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (snapshotList.size()Â &amp;gt;Â &lt;span&gt;10&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â snapshotList.removeFirst();&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šé¢è®°å½•äº†æ€§èƒ½å¿«ç…§åï¼ŒConsumer ä¼šæ¯éš” 10s è¿›è¡Œæ€§èƒ½å‚æ•°è®¡ç®—å’Œæ‰“å°ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//Consumer.java&lt;/span&gt;&lt;br/&gt;executorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â TimerTask()Â {&lt;br/&gt;&lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;printStats&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â &lt;span&gt;if&lt;/span&gt;Â (snapshotList.size()Â &amp;gt;=Â &lt;span&gt;10&lt;/span&gt;)Â {&lt;br/&gt;Â Â Long[]Â beginÂ =Â snapshotList.getFirst();&lt;br/&gt;Â Â Long[]Â endÂ =Â snapshotList.getLast();&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â consumeTpsÂ =&lt;br/&gt;Â Â Â (&lt;span&gt;long&lt;/span&gt;)Â (((end[&lt;span&gt;1&lt;/span&gt;]Â -Â begin[&lt;span&gt;1&lt;/span&gt;])Â /Â (&lt;span&gt;double&lt;/span&gt;)Â (end[&lt;span&gt;0&lt;/span&gt;]Â -Â begin[&lt;span&gt;0&lt;/span&gt;]))Â *Â &lt;span&gt;1000L&lt;/span&gt;);&lt;br/&gt;Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;double&lt;/span&gt;Â averageB2CRTÂ =Â (end[&lt;span&gt;2&lt;/span&gt;]Â -Â begin[&lt;span&gt;2&lt;/span&gt;])Â /Â (&lt;span&gt;double&lt;/span&gt;)Â (end[&lt;span&gt;1&lt;/span&gt;]Â -Â begin[&lt;span&gt;1&lt;/span&gt;]);&lt;br/&gt;Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;double&lt;/span&gt;Â averageS2CRTÂ =Â (end[&lt;span&gt;3&lt;/span&gt;]Â -Â begin[&lt;span&gt;3&lt;/span&gt;])Â /Â (&lt;span&gt;double&lt;/span&gt;)Â (end[&lt;span&gt;1&lt;/span&gt;]Â -Â begin[&lt;span&gt;1&lt;/span&gt;]);&lt;br/&gt;Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â failCountÂ =Â end[&lt;span&gt;4&lt;/span&gt;]Â -Â begin[&lt;span&gt;4&lt;/span&gt;];&lt;br/&gt;Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â b2cMaxÂ =Â statsBenchmarkConsumer.getBorn2ConsumerMaxRT().get();&lt;br/&gt;Â Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â s2cMaxÂ =Â statsBenchmarkConsumer.getStore2ConsumerMaxRT().get();&lt;br/&gt;&lt;br/&gt;Â Â statsBenchmarkConsumer.getBorn2ConsumerMaxRT().set(&lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;Â Â statsBenchmarkConsumer.getStore2ConsumerMaxRT().set(&lt;span&gt;0&lt;/span&gt;);&lt;br/&gt;&lt;br/&gt;Â Â System.out.printf(&lt;span&gt;&quot;CurrentÂ Time:Â %sÂ TPS:Â %dÂ FAIL:Â %dÂ AVG(B2C)Â RT(ms):Â %7.3fÂ AVG(S2C)Â RT(ms):Â %7.3fÂ MAX(B2C)Â RT(ms):Â %dÂ MAX(S2C)Â RT(ms):Â %d%n&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â System.currentTimeMillis(),Â consumeTps,Â failCount,Â averageB2CRT,Â averageS2CRT,Â b2cMax,Â s2cMax&lt;br/&gt;Â Â );&lt;br/&gt;Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é€šè¿‡æ€§èƒ½å‚æ•°çš„æ—¥å¿—è¾“å‡ºï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯¹ RocketMQ çš„æ¶ˆè´¹è€…è¿›è¡Œç›‘æ§ã€‚&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.8.3 æ¸…é™¤è¿‡æœŸæ¶ˆæ¯&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¶ˆè´¹è€…ä¼šå®šæœŸæ£€æŸ¥æœ¬åœ°æ‹‰å–çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œå¦‚æœåˆ—è¡¨ä¸­çš„æ¶ˆæ¯å·²ç»è¿‡æœŸï¼ˆé»˜è®¤ 15 åˆ†é’Ÿè¿‡æœŸï¼Œå¯ä»¥é…ç½®ï¼‰ï¼Œåˆ™æŠŠè¿‡æœŸæ¶ˆæ¯å†æ¬¡å‘é€ç»™ Brokerï¼Œç„¶åä»æœ¬åœ°æ¶ˆæ¯åˆ—è¡¨åˆ é™¤ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//ConsumeMessageConcurrentlyService.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.cleanExpireMsgExecutors.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â cleanExpireMsg();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scheduleAtFixedRateÂ cleanExpireMsgÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;&lt;br/&gt;},Â &lt;span&gt;this&lt;/span&gt;.defaultMQPushConsumer.getConsumeTimeout(),Â &lt;span&gt;this&lt;/span&gt;.defaultMQPushConsumer.getConsumeTimeout(),Â TimeUnit.MINUTES);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;2.8.4 æ¸…é™¤è¿‡æœŸæ¶ˆæ¯&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¶ˆè´¹è€…ä¼šæ¯éš” 30s å‘ NameServer æ‹‰å– MessageQueue ä¿¡æ¯ï¼Œç„¶åè·Ÿæœ¬åœ°ä¿å­˜çš„è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ›´æ–°æœ¬åœ°ç¼“å­˜ä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//DefaultLitePullConsumerImpl.java&lt;/span&gt;&lt;br/&gt;scheduledExecutorService.scheduleAtFixedRate(&lt;br/&gt;&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â fetchTopicMessageQueuesAndCompare();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ScheduledTaskÂ fetchMessageQueuesAndCompareÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;this&lt;/span&gt;.getDefaultLitePullConsumer().getTopicMetadataCheckIntervalMillis(),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;3 Broker&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.1 çŠ¶æ€é‡‡æ ·&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ç«¯ä¼šå¯¹çŠ¶æ€è¿›è¡Œé‡‡ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ª Topicã€MessageQueueã€Group æ€»å…±å‘é€äº†å¤šå°‘æ¡æ¶ˆæ¯ï¼ŒTopic æ€»å…±å‘é€çš„æ¶ˆæ¯å¤§å°ã€‚Broker ä¼šå¯¹è¿™äº›çŠ¶æ€æŒ‰ç…§ç§’ã€åˆ†é’Ÿã€å°æ—¶ä¸ºå•ä½è¿›è¡Œé‡‡æ ·å¹¶ä¸”å®šæ—¶æ‰“å°ï¼Œè¿™é‡Œä¸€å…±æœ‰ 6 ä¸ªå®šæ—¶ä»»åŠ¡ã€‚æ¯”å¦‚ä¸‹é¢æ˜¯æŒ‰ç…§ç§’è¿›è¡Œé‡‡æ ·çš„å®šæ—¶ä»»åŠ¡ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//StatsItemSet.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â samplingInSeconds();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ ignored)Â {&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;0&lt;/span&gt;,Â &lt;span&gt;10&lt;/span&gt;,Â TimeUnit.SECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.2 è®°å½•æ¶ˆæ¯å»¶æ—¶&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker è¯»å–æ¶ˆæ¯æ—¶ä¼šè®°å½•æ¶ˆæ¯ä»ä¿å­˜ç£ç›˜åˆ°è¢«è¯»å–çš„æ—¶é—´å·®å¹¶å®šæ—¶æ‰“å°ã€‚å®šæ—¶ä»»åŠ¡ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//MomentStatsItemSet.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â printAtMinutes();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ ignored)Â {&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â Math.abs(UtilAll.computeNextMinutesTimeMillis()Â -Â System.currentTimeMillis()),Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;60&lt;/span&gt;Â *Â &lt;span&gt;5&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.3 æŒä¹…åŒ–æ•°æ®&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šå®šæ—¶æŒä¹…åŒ–æ¶ˆè´¹åç§»é‡ã€Topic é…ç½®ã€å®šé˜…ç»„é…ç½®ç­‰ï¼Œé»˜è®¤ 10s ä¸€æ¬¡ï¼ˆå¯ä»¥é…ç½®ï¼‰ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//ScheduleMessageService.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.deliverExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â (started.get())Â {&lt;br/&gt;Â Â Â Â ScheduleMessageService.&lt;span&gt;this&lt;/span&gt;.persist();&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scheduleAtFixedRateÂ flushÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;10000&lt;/span&gt;,Â &lt;span&gt;this&lt;/span&gt;.defaultMessageStore.getMessageStoreConfig().getFlushDelayOffsetInterval(),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.4 å¤±æ•ˆè¿‡æœŸè¯·æ±‚&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šå®šæ—¶æ‰«æç¼“å­˜åœ¨æœ¬åœ°çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚å¼€å§‹æ—¶é—´åŠ è¶…æ—¶æ—¶é—´ï¼ˆå†åŠ  1sï¼‰å°äºå½“å‰æ—¶é—´ï¼Œåˆ™è¿™ä¸ªè¯·æ±‚è¿‡æœŸã€‚é€šè¿‡å®šæ—¶ä»»åŠ¡ï¼ˆ3s ä¸€æ¬¡ï¼‰è®©è¿‡æœŸè¯·æ±‚å¤±æ•ˆï¼Œå¹¶ä¸”è§¦å‘å›è°ƒå‡½æ•°ã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//NettyRemotingServer.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.timer.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â TimerTask()Â {&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â NettyRemotingServer.&lt;span&gt;this&lt;/span&gt;.scanResponseTable();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scanResponseTableÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;3&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.5 è¿‡æ»¤æœåŠ¡&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¶ˆè´¹è€…å¯èƒ½ä¼šå‘ Broker æ³¨å†Œ filterClass ç”¨æ¥è¿‡æ»¤æ¶ˆæ¯ã€‚Broker æ”¶åˆ°æ¶ˆè´¹è€…æ³¨å†Œçš„ filterClass åä¼šç”¨å®šæ—¶ä»»åŠ¡æ¥åˆ›å»º FilterServerã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//FilterServerManager.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â FilterServerManager.&lt;span&gt;this&lt;/span&gt;.createFilterServer();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;5&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;30&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™æ ·æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯æ—¶é¦–å…ˆä» FilterServer æ‹‰å–æ¶ˆæ¯ï¼ŒFilterServer ä» Broker æ‹‰å–æ¶ˆæ¯åè¿›è¡Œè¿‡æ»¤ï¼ŒåªæŠŠæ¶ˆè´¹è€…æ„Ÿå…´è¶£çš„æ¶ˆæ¯è¿”å›ç»™æ¶ˆè´¹è€…ã€‚ä¸€ä¸ª Broker å¯ä»¥æœ‰å¤šä¸ª FilterServerã€‚å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.51338199513382&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicd8diaKQCynPCP4t87lEu3dWKDB5cTQ1JazK9wicP2WhjXM7Q0wibhyyvicYEr0XibOp4K1j7cFZiaZq2QXQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;411&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.6 è®°å½•æ¶ˆæ¯æ€»é‡&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker æ¯å¤©ä¼šè®°å½•å‰ä¸€å¤©æ”¶å‘æ¶ˆæ¯çš„æ€»æ•°é‡ï¼Œå®šæ—¶ä»»åŠ¡å¦‚ä¸‹ï¼ˆperiod æ˜¯ 1 å¤©ï¼‰ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â BrokerController.&lt;span&gt;this&lt;/span&gt;.getBrokerStats().record();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scheduleÂ recordÂ error.&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â initialDelay,Â period,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.7 æŒä¹…åŒ– Offset&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker é»˜è®¤æ¯éš” 5sï¼ˆå¯ä»¥é…ç½®ï¼‰ ä¼šæŒä¹…åŒ–ä¸€æ¬¡æ¶ˆæ¯çš„ Offsetï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â BrokerController.&lt;span&gt;this&lt;/span&gt;.consumerOffsetManager.persist();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scheduleÂ persistÂ consumerOffsetÂ error.&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;this&lt;/span&gt;.brokerConfig.getFlushConsumerOffsetInterval(),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.8 æŒä¹…åŒ–è¿‡æ»¤å‚æ•°&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šé¢æåˆ°è¿‡ï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¼šå‘ Broker æ³¨å†Œ filterClassï¼ŒBroker è§£ææ¶ˆè´¹è€…æ³¨å†Œçš„ filterClass åï¼Œä¼šæŠŠè§£æåçš„ FilterData æŒä¹…åŒ–åˆ°æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â BrokerController.&lt;span&gt;this&lt;/span&gt;.consumerFilterManager.persist();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scheduleÂ persistÂ consumerÂ filterÂ error.&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.9 Broker è‡ªæˆ‘ä¿æŠ¤&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“æ¶ˆè´¹è€…è¯»å–æ¶ˆæ¯ç¼“æ…¢æ—¶ï¼ŒBroker ä¸ºäº†ä¿æŠ¤è‡ªå·±ï¼Œä¼šæŠŠè¿™ä¸ªæ¶ˆè´¹è€…è®¾ç½®ä¸ºä¸å…è®¸è¯»å–çš„çŠ¶æ€ï¼Œè¿™æ ·è¿™ä¸ªæ¶ˆè´¹ç»„å°±ä¸èƒ½å†æ‹‰å–æ¶ˆæ¯äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â BrokerController.&lt;span&gt;this&lt;/span&gt;.protectBroker();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;protectBrokerÂ error.&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;3&lt;/span&gt;,Â &lt;span&gt;3&lt;/span&gt;,Â TimeUnit.MINUTES);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.10 Broker æ‰“å°æ°´ä½&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šæ¯éš” 1s æ‰“å°ä¸€æ¬¡æ°´ä½ï¼ŒåŒ…æ‹¬å‘é€æ¶ˆæ¯çš„å»¶è¿Ÿã€æ¥æ”¶æ¶ˆæ¯çš„å»¶è¿Ÿã€äº‹åŠ¡æ¶ˆæ¯çš„å»¶è¿Ÿã€æŸ¥è¯¢æ¶ˆæ¯çš„å»¶è¿Ÿï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â BrokerController.&lt;span&gt;this&lt;/span&gt;.printWaterMark();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;printWaterMarkÂ error.&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;1&lt;/span&gt;,Â TimeUnit.SECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.11 Broker æ‰“å°Â OffsetÂ å·®&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šå®šæ—¶æ‰“å°æœ€æ–°çš„æ¶ˆæ¯ Offset å’Œå·²ç»åˆ†å‘ç»™ MessageQueue å’Œ Index ç´¢å¼•çš„ Offset å·®è·ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â log.info(&lt;span&gt;&quot;dispatchÂ behindÂ commitÂ logÂ {}Â bytes&quot;&lt;/span&gt;,Â BrokerController.&lt;span&gt;this&lt;/span&gt;.getMessageStore().dispatchBehindBytes());&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scheduleÂ dispatchBehindBytesÂ error.&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;60&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.12 è·å– NameServer åœ°å€&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šå®šæœŸè·å– NameServer çš„åœ°å€ï¼Œå¹¶æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â BrokerController.&lt;span&gt;this&lt;/span&gt;.brokerOuterAPI.fetchNameServerAddr();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ScheduledTaskÂ fetchNameServerAddrÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;60&lt;/span&gt;Â *Â &lt;span&gt;2&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.13 æ‰“å°ä¸»ä»åç§»é‡å·®è·&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šå®šæ—¶æ‰“å° master èŠ‚ç‚¹å’Œ slave èŠ‚ç‚¹æ¶ˆæ¯ Offset çš„å·®è·ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â BrokerController.&lt;span&gt;this&lt;/span&gt;.printMasterAndSlaveDiff();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scheduleÂ printMasterAndSlaveDiffÂ error.&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;60&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.14 å‘ NameServer æ³¨å†Œ&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šå®šæ—¶å‘ï¼ˆé»˜è®¤ 30sï¼Œå¯é…ç½®ï¼Œæœ€é«˜ä¸è¶…è¿‡ 60sï¼‰æ‰€æœ‰ NameServer å‘é€æ³¨å†Œæ¶ˆæ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â BrokerController.&lt;span&gt;this&lt;/span&gt;.registerBrokerAll(&lt;span&gt;true&lt;/span&gt;,Â &lt;span&gt;false&lt;/span&gt;,Â brokerConfig.isForceRegister());&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;registerBrokerAllÂ Exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â Math.max(&lt;span&gt;10000&lt;/span&gt;,Â Math.min(brokerConfig.getRegisterNameServerPeriod(),Â &lt;span&gt;60000&lt;/span&gt;)),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.15 åŒæ­¥ Slave&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker çš„ Master èŠ‚ç‚¹ä¼šæ¯é—´éš” 10s å‘ Slave èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼ŒåŒ…æ‹¬ Topic é…ç½®ã€æ¶ˆè´¹åç§»é‡ã€å»¶è¿Ÿåç§»é‡ã€æ¶ˆè´¹ç»„é…ç½®ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//BrokerController.java&lt;/span&gt;&lt;br/&gt;slaveSyncFutureÂ =Â &lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â BrokerController.&lt;span&gt;this&lt;/span&gt;.slaveSynchronize.syncAll();&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ScheduledTaskÂ SlaveSynchronizeÂ syncAllÂ error.&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;3&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.16 åˆ é™¤è¿‡æœŸæ–‡ä»¶&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šå‘¨æœŸæ€§ï¼ˆé»˜è®¤ 10sï¼Œå¯ä»¥é…ç½®ï¼‰åœ°æ‰§è¡Œåˆ é™¤ä»»åŠ¡ï¼Œåˆ é™¤è¿‡æœŸçš„ CommitLog æ–‡ä»¶å’Œ ConsumeQueue æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//DefaultMessageStore.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â DefaultMessageStore.&lt;span&gt;this&lt;/span&gt;.cleanFilesPeriodically();&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;60&lt;/span&gt;,Â &lt;span&gt;this&lt;/span&gt;.messageStoreConfig.getCleanResourceInterval(),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.17 æ–‡ä»¶å¤§å°æ£€æŸ¥&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šæ¯éš” 10 åˆ†é’Ÿæ£€æŸ¥ CommitLog æ–‡ä»¶å’Œ ConsumeQueue æ–‡ä»¶ï¼Œç”¨å½“å‰æ–‡ä»¶çš„æœ€å°ï¼ˆèµ·å§‹ï¼‰ Offset å‡å»ä¸Šä¸€ä¸ªæ–‡ä»¶æœ€å°ï¼ˆèµ·å§‹ï¼‰ Offsetï¼Œå¦‚æœä¸ç­‰äºä¸€ä¸ªæ–‡ä»¶çš„å¤§å°ï¼Œå°±è¯´æ˜æ–‡ä»¶å­˜åœ¨é—®é¢˜ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//DefaultMessageStore.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â DefaultMessageStore.&lt;span&gt;this&lt;/span&gt;.checkSelf();&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1&lt;/span&gt;,Â &lt;span&gt;10&lt;/span&gt;,Â TimeUnit.MINUTES);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.18 ä¿å­˜å †æ ˆæ˜ å°„&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šæ¯éš” 1s è®°å½•æ‰€æœ‰å­˜æ´»çº¿ç¨‹çš„å †æ ˆæ˜ å°„ä¿¡æ¯ï¼Œå‰ææ˜¯ debugLockEnable å¼€å…³é…ç½®æ˜¯æ‰“å¼€çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//DefaultMessageStore.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (DefaultMessageStore.&lt;span&gt;this&lt;/span&gt;.getMessageStoreConfig().isDebugLockEnable())Â {&lt;br/&gt;Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (DefaultMessageStore.&lt;span&gt;this&lt;/span&gt;.commitLog.getBeginTimeInLock()Â !=Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â &lt;span&gt;long&lt;/span&gt;Â lockTimeÂ =Â System.currentTimeMillis()Â -Â DefaultMessageStore.&lt;span&gt;this&lt;/span&gt;.commitLog.getBeginTimeInLock();&lt;br/&gt;Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (lockTimeÂ &amp;gt;Â &lt;span&gt;1000&lt;/span&gt;Â &amp;amp;&amp;amp;Â lockTimeÂ &amp;lt;Â &lt;span&gt;10000000&lt;/span&gt;)Â {&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â StringÂ stackÂ =Â UtilAll.jstack();&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;final&lt;/span&gt;Â StringÂ fileNameÂ =Â System.getProperty(&lt;span&gt;&quot;user.home&quot;&lt;/span&gt;)Â +Â File.separatorÂ +Â &lt;span&gt;&quot;debug/lock/stack-&quot;&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â +Â DefaultMessageStore.&lt;span&gt;this&lt;/span&gt;.commitLog.getBeginTimeInLock()Â +Â &lt;span&gt;&quot;-&quot;&lt;/span&gt;Â +Â lockTime;&lt;br/&gt;Â Â Â Â Â Â MixAll.string2FileNotSafe(stack,Â fileName);&lt;br/&gt;Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1&lt;/span&gt;,Â &lt;span&gt;1&lt;/span&gt;,Â TimeUnit.SECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.19 æ£€æŸ¥ç‰©ç†ç£ç›˜&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šæ¯éš” 10s æ£€æŸ¥ä¿å­˜ CommitLog çš„ç£ç›˜ç©ºé—´æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼Œå¦‚æœè¾¾åˆ°ï¼Œä¼šæ‰“å° error çº§åˆ«çš„æ—¥å¿—ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//DefaultMessageStore.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.diskCheckScheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â DefaultMessageStore.&lt;span&gt;this&lt;/span&gt;.cleanCommitLogService.isSpaceFull();&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000L&lt;/span&gt;,Â &lt;span&gt;10000L&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.20 æŒä¹…åŒ–å»¶æ—¶æ¶ˆæ¯åç§»é‡&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;RocketMQ çš„å»¶æ—¶æ¶ˆè´¹åˆ†ä¸º 18 ä¸ªçº§åˆ«ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//ScheduleMessageService.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;private&lt;/span&gt;Â StringÂ messageDelayLevelÂ =Â &lt;span&gt;&quot;1sÂ 5sÂ 10sÂ 30sÂ 1mÂ 2mÂ 3mÂ 4mÂ 5mÂ 6mÂ 7mÂ 8mÂ 9mÂ 10mÂ 20mÂ 30mÂ 1hÂ 2h&quot;&lt;/span&gt;;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;RocketMQ ä¼šä¸ºæ¯ä¸ªå»¶æ—¶çº§åˆ«å®šä¹‰è¦ç»™ ConsumeQueueï¼Œæ¯éš” ConsumeQueue éƒ½ä¼šæœ‰ä¸€ä¸ª Offsetï¼Œé€šè¿‡ offsetTable(ConcurrentMap) æ¥è®°å½•ä¸åŒå»¶æ—¶çº§åˆ«å¯¹åº”çš„ Offsetã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;RocketMQ ä¼šå‘¨æœŸæ€§åœ°ï¼ˆé»˜è®¤ 10sï¼Œå¯ä»¥é…ç½®ï¼‰æŠŠ offsetTable ä¸­ä¿å­˜çš„ Offset æŒä¹…åŒ–åˆ°æ–‡ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//DefaultMessageStore.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.deliverExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â &lt;span&gt;if&lt;/span&gt;Â (started.get())Â {&lt;br/&gt;Â Â Â Â ScheduleMessageService.&lt;span&gt;this&lt;/span&gt;.persist();&lt;br/&gt;Â Â Â }&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;scheduleAtFixedRateÂ flushÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;10000&lt;/span&gt;,Â &lt;span&gt;this&lt;/span&gt;.defaultMessageStore.getMessageStoreConfig().getFlushDelayOffsetInterval(),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.21 å…³é—­å¼‚å¸¸è¿æ¥&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Broker ä¼šå®šæ—¶æ‰«ææ‰€æœ‰çš„é•¿è¿æ¥ï¼Œä¸»è¦åŒ…æ‹¬ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œ FilterServerï¼Œå¦‚æœè¿æ¥ä¸æ´»è·ƒï¼Œåˆ™å…³é—­è¯¥è¿æ¥ï¼Œå¹¶ä»æœ¬åœ°è¿æ¥åˆ—è¡¨ä¸­ç§»é™¤ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//ClientHousekeepingService.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â ClientHousekeepingService.&lt;span&gt;this&lt;/span&gt;.scanExceptionChannel();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ThrowableÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ErrorÂ occurredÂ whenÂ scanÂ notÂ activeÂ clientÂ channels.&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.22 æ¸…ç†è¿‡æœŸæ¶ˆæ¯&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœ Broker é…ç½®äº†å…è®¸å¿«é€Ÿå¤±è´¥ï¼ˆbrokerFastFailureEnableï¼‰ï¼Œåˆ™ä¼šæ¯éš” 10ms å®šæ—¶æ¸…ç†è¿‡æœŸè¯·æ±‚ï¼ŒåŒ…æ‹¬è¦å‘é€çš„æ¶ˆæ¯ã€æ¥æ”¶çš„æ¶ˆæ¯ã€å¿ƒè·³æ¶ˆæ¯ã€è¦ç»“æŸçš„äº‹åŠ¡æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;scheduledExecutorService.scheduleAtFixedRate(&lt;br/&gt;&lt;span&gt;new&lt;/span&gt;Â Runnable()Â {&lt;br/&gt;Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;run&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â fetchTopicMessageQueuesAndCompare();&lt;br/&gt;Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â log.error(&lt;span&gt;&quot;ScheduledTaskÂ fetchMessageQueuesAndCompareÂ exception&quot;&lt;/span&gt;,Â e);&lt;br/&gt;Â Â }&lt;br/&gt;Â }&lt;br/&gt;},Â &lt;span&gt;1000&lt;/span&gt;Â *Â &lt;span&gt;10&lt;/span&gt;,Â &lt;span&gt;this&lt;/span&gt;.getDefaultLitePullConsumer().getTopicMetadataCheckIntervalMillis(),Â TimeUnit.MILLISECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;&lt;span&gt;æ³¨æ„ï¼šæ¸…ç†æ¶ˆæ¯å‰ä¼šåˆ¤æ–­æ˜¯å¦ç³»ç»Ÿç¹å¿™ï¼Œå¦‚æœç³»ç»Ÿç¹å¿™ï¼Œä¼šç»™å‘é€é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ç›´æ¥è¿”å›ç³»ç»Ÿç¹å¿™ï¼Œæš‚æ—¶ä¸åšè¿‡æœŸæ¶ˆæ¯æ¸…ç†ã€‚&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;4 NameServer&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;4.1 æ£€æŸ¥è¿‡æœŸ Broker&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨ 3.14 èŠ‚ä¸­è®²è¿‡ï¼ŒBroker ä¼šè·Ÿ NameServer å»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶å‘ NameServer å‘é€æ³¨å†Œæ¶ˆæ¯ã€‚NameServer ä¼šåœ¨æœ¬åœ°ç»´æŠ¤ä¸€ä¸ª Broker åˆ—è¡¨ï¼Œå®šæ—¶ä»»åŠ¡ä¼šè½®è¯¢æœ¬åœ°ä¿å­˜çš„ Broker åˆ—è¡¨ï¼Œæ£€æŸ¥æ³¨å†Œæ¶ˆæ¯æ˜¯å¦è¿‡æœŸï¼ˆè¶…è¿‡ 120sï¼‰ï¼Œå¦‚æœæ³¨å†Œæ¶ˆæ¯è¿‡æœŸï¼Œåˆ™å…³é—­é•¿è¿æ¥ï¼Œä»æœ¬åœ°ç¼“å­˜åˆ é™¤è¿™ä¸ª Brokerã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//NamesrvController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(NamesrvController.&lt;span&gt;this&lt;/span&gt;.routeInfoManager::scanNotActiveBroker,Â &lt;span&gt;5&lt;/span&gt;,Â &lt;span&gt;10&lt;/span&gt;,Â TimeUnit.SECONDS);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;4.2 æ‰“å°é…ç½®&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;NameServer å¯åŠ¨æ—¶ï¼Œä¼šåŠ è½½ KV æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ° configTable è¿™ä¸ªå˜é‡ï¼ŒNameServer å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å‘é€ä¸€ä¸ª KV é…ç½®è¯·æ±‚ç»™ NameServerï¼ŒNameServer æ”¶åˆ°è¯·æ±‚åä¹Ÿä¼šä¿å­˜åˆ° configTableã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;NameServer ä¼šå®šæ—¶æ‰“å° configTable ä¸­çš„é…ç½®ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//NamesrvController.java&lt;/span&gt;&lt;br/&gt;&lt;span&gt;this&lt;/span&gt;.scheduledExecutorService.scheduleAtFixedRate(NamesrvController.&lt;span&gt;this&lt;/span&gt;.kvConfigManager::printAllPeriodically,Â &lt;span&gt;1&lt;/span&gt;,Â &lt;span&gt;10&lt;/span&gt;,Â TimeUnit.MINUTES);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;5 æ€»ç»“&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;RocketMQ çš„å®šæ—¶ä»»åŠ¡å¾ˆå¤šï¼Œè¿™äº›å®šæ—¶ä»»åŠ¡çš„åŠ å…¥è®© RocketMQ çš„è®¾è®¡æ›´åŠ å®Œå¤‡ï¼ŒåŒ…æ‹¬ä¸šåŠ¡å¤„ç†ã€ç›‘æ§æ—¥å¿—ã€å¿ƒè·³ã€æ¸…ç†ä»»åŠ¡ã€å…³é—­è¿æ¥ã€æŒä¹…åŒ–æ•°æ®ç­‰ã€‚é€šè¿‡å¯¹å®šæ—¶ä»»åŠ¡çš„ç†è§£ï¼Œèƒ½å¤Ÿæ›´æ·±å…¥åœ°ç†è§£ RocketMQ çš„è®¾è®¡ç†å¿µã€‚&lt;/p&gt;&lt;section&gt;&lt;mp-common-profile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-weui-theme=&quot;light&quot; data-id=&quot;MzU2NTEyNjIzMw==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicd8cjqsZ9HP3aatIrg6qmFeibZXoF4kIvQaib8Sb6Wg4IicH2uZNurWvYxjIHQo3ATRcfTroRrKknd2dQ/0?wx_fmt=png&quot; data-nickname=&quot;å›å“¥èŠæŠ€æœ¯&quot; data-alias=&quot;&quot; data-signature=&quot;åç«¯æ¶æ„å¸ˆï¼Œå®šæœŸåˆ†äº«æŠ€æœ¯å¹²è´§ï¼ŒåŒ…æ‹¬åç«¯å¼€å‘ã€åˆ†å¸ƒå¼ã€ä¸­é—´ä»¶ã€äº‘åŸç”Ÿç­‰ã€‚åŒæ—¶ä¹Ÿä¼šåˆ†äº«èŒåœºå¿ƒå¾—ã€ç¨‹åºäººç”Ÿã€‚å…³æ³¨æˆ‘ï¼Œä¸€èµ·è¿›é˜¶ã€‚&quot; data-from=&quot;0&quot; data-is_biz_ban=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p&gt;æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·&lt;span&gt;&lt;strong&gt;ç‚¹èµå’Œå†çœ‹&lt;/strong&gt;&lt;/span&gt;ã€‚æ¬¢è¿åŠ æˆ‘å¾®ä¿¡ï¼šzhujinjun86ã€‚&lt;/p&gt;&lt;section&gt;&lt;span&gt;å·å†…å›å¤Â &lt;span&gt;&lt;strong&gt;seata&lt;/strong&gt;&lt;/span&gt;ï¼Œä¸‹è½½ã€Šé˜¿é‡Œåˆ†å¸ƒå¼ä¸­é—´ä»¶Seataä»å…¥é—¨åˆ°ç²¾é€šã€‹&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å·å†…å›å¤Â &lt;strong&gt;&lt;span&gt;beijing&lt;/span&gt;&lt;/strong&gt;ï¼Œä¸‹è½½æˆ‘æ€»ç»“çš„åŒ—äº¬ä¸Šç™¾å®¶çŸ¥åç§‘æŠ€å…¬å¸&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å·å†…å›å¤Â &lt;strong&gt;&lt;span&gt;aqs&lt;/span&gt;&lt;/strong&gt;ï¼Œä¸‹è½½ã€Š40å¼ å›¾ç²¾é€šJava AQSã€‹&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>a61b9bfd6b475d3b85592780befa46e1</guid>
<title>ç”¨ PowerMock å†™ Java å•å…ƒ/é›†æˆæµ‹è¯•</title>
<link>https://toutiao.io/k/hutsdyo</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;RichText ztext Post-RichText css-1g0fqss&quot; options=&quot;[object Object]&quot;&gt;&lt;p data-first-child=&quot;&quot; data-pid=&quot;_-fwnsDE&quot;&gt;â€‹æœ€è¿‘ä¸€ç›´åœ¨é‡æ„å…¬å¸çš„Javaä»£ç ï¼Œç”±äºåŸæ¥å¹¶æ²¡æœ‰ç›¸å…³çš„æµ‹è¯•ï¼Œæ‰€ä»¥åœ¨é‡æ„ä¹‹å‰å…ˆåŠ ä¸Šå•å…ƒæµ‹è¯•å¯ä»¥å¯¹é‡æ„ä»£ç çš„æ­£ç¡®æ€§æœ‰ä¸€å®šçš„ä¿éšœä½œç”¨ï¼Œç ”ç©¶äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨PowerMockå†™æµ‹è¯•ä»£ç ï¼ˆå•å…ƒæµ‹è¯•+é›†æˆæµ‹è¯•ï¼‰&lt;/p&gt;&lt;p data-pid=&quot;thfyljkL&quot;&gt;â€‹&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/powermock/powermock&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PowerMock&lt;/a&gt;åŸºäº&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//site.mockito.org/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Mockito&lt;/a&gt;åšäº†éƒ¨åˆ†æ”¹è¿›ï¼Œä¸»è¦æ˜¯åŠ å…¥äº†protectedä»¥åŠstaticæ–¹æ³•çš„Mockï¼Œæš‚æ—¶è¿˜ä¸æ”¯æŒå¯¹äº privateæ–¹æ³•è¿›è¡ŒMockï¼Œå› ä¸ºè®¤ä¸ºprivateæ–¹æ³•æœ¬èº«ä¸åº”è¯¥å•ç‹¬è¢«æ‹¿å‡ºæ¥åšUnitTestï¼Œè¿™é‡Œå¯¹è¿™ä¸ªé—®é¢˜æš‚æ—¶ä¸å±•å¼€è®¨è®º&lt;/p&gt;&lt;h2&gt;å¼€å§‹é…ç½®&lt;/h2&gt;&lt;p data-pid=&quot;gv87OKjB&quot;&gt;é¡¹ç›®ç”¨çš„æ˜¯Mavenï¼Œå¦‚æœæ˜¯ç”¨Gradleçš„ç¨å¾®å˜ä¸‹æ ¼å¼å°±å¯ä»¥äº†ï¼Œè¿™é‡Œæˆ‘ç”¨çš„æ˜¯2.0.9ç‰ˆæœ¬&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;08Yzm0NI&quot;&gt;å…¶åå¼€å§‹æ·»åŠ ä¼šç”¨åˆ°çš„ä¾èµ–åº“&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;org&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;junit4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;org&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;api&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mockito2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;net&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bytebuddy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buddy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;net&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bytebuddy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buddy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;junit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;junit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;org&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;junit4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rule&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;org&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;classloading&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xstream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powermock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;v8cb0G5R&quot;&gt;powermock-module-junit4-rule-agent/powermock-classloading-xstreamè¿™ä¸ªä¸¤ä¸ªåº“æ˜¯ç”¨äºé›†æˆæµ‹è¯•çš„ï¼Œç„¶åå…¶å®æˆ‘æ˜¯æƒ³ç”¨JUnit5çš„ï¼Œä¸è¿‡ç”±äºç›®å‰PowerMockåªæ”¯æŒJUnit4ï¼Œæ‰€ä»¥ä¸‹éƒ¨åˆ†æ³¨è§£å¿…é¡»ä½¿ç”¨JUnit4çš„åº“&lt;/p&gt;&lt;ul&gt;&lt;li data-pid=&quot;YiMNREVJ&quot;&gt;@RunWithæ³¨è§£ï¼šåœ¨JUnit5ä¸­ï¼Œ@RunWithè¢«@ExtendWithå–ä»£ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªä½¿ç”¨@RunWithï¼Œåœ¨é›†æˆæµ‹è¯•ä¸­@RunWithéœ€è¦æ­é…SpringJUnit4ClassRunner.classä½¿ç”¨ï¼Œå³&lt;/li&gt;&lt;/ul&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SpringJUnit4ClassRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.junit.Test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;JUnit4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;h18UuLua&quot;&gt;è€Œé&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.junit.jupiter.api.Test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;      &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;JUnit5&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&lt;li data-pid=&quot;GcKSeiUk&quot;&gt;@Beforeä»¥åŠ@Afterï¼šå¿…é¡»ä½¿ç”¨JUint4&lt;/li&gt;&lt;/ul&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.junit.After&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.junit.Before&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;pmbI8zqw&quot;&gt;Assertionså¯ä»¥ä½¿ç”¨JUnit5çš„ï¼Œæˆ‘å°±ç›´æ¥ä½¿ç”¨äº†JUnit5çš„Assertions&lt;/p&gt;&lt;h2&gt;ç›®å½•åŠç›¸å…³å‘½åè§„èŒƒ&lt;/h2&gt;&lt;p data-pid=&quot;bl-C_vUM&quot;&gt;â€‹    ç”±äºå¯è§çš„åé¢ç»„å†…å…¶ä»–æˆå‘˜ä¹Ÿéœ€è¦ç¼–å†™TestCaseæ‰€ä»¥è¿™é‡Œéœ€è¦çº¦å®šä¸€ä¸‹ç›¸å…³çš„è§„èŒƒï¼Œè€ƒè™‘åˆ°å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•éœ€è¦åŒæ—¶å­˜åœ¨ï¼Œæ‰€ä»¥ç›®å‰æˆ‘è§‰å¾—ä»¥ä¸‹çš„ç»“æ„å¯ä»¥æš‚æ—¶æ»¡è¶³æˆ‘ç°åœ¨çš„éœ€è¦ï¼Œæˆ‘æŠŠå…¬å¸é¡¹ç›®åç”¨myprojectæ¥æ›¿æ¢ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼ˆç”»çš„ä¸å¤ªå¥½å‡‘åˆçœ‹ä¸‹ï¼‰&lt;/p&gt;&lt;p data-pid=&quot;8zYDQ7Hd&quot;&gt;src&lt;/p&gt;&lt;p data-pid=&quot;ZFPAUDbY&quot;&gt;â”œâ”€â”€ main&lt;/p&gt;&lt;p data-pid=&quot;KroB1S8n&quot;&gt;â”‚ â””â”€â”€ java&lt;/p&gt;&lt;p data-pid=&quot;Z1_KX1My&quot;&gt;â”‚ â””â”€â”€ com.myproject&lt;/p&gt;&lt;p data-pid=&quot;OJy1Q36D&quot;&gt;â”‚ â””â”€â”€ service&lt;/p&gt;&lt;p data-pid=&quot;X0_cOh15&quot;&gt;â”‚ â”‚ â”œâ”€â”€ impl&lt;/p&gt;&lt;p data-pid=&quot;pWy6w8qH&quot;&gt;â”‚ â”‚ â”‚ |  â”€â”€  AService.java&lt;/p&gt;&lt;p data-pid=&quot;Su1L62yd&quot;&gt;â””â”€â”€ test&lt;/p&gt;&lt;p data-pid=&quot;QMgKMcRP&quot;&gt;â”‚ â””â”€â”€ java&lt;/p&gt;&lt;p data-pid=&quot;Q0qxdgPI&quot;&gt;â”‚ â””â”€â”€ com.myproject&lt;/p&gt;&lt;p data-pid=&quot;Jd5rP_fQ&quot;&gt;â”‚ â”œâ”€â”€ service&lt;/p&gt;&lt;p data-pid=&quot;TkGdJiex&quot;&gt;â”‚ â”‚  â”‚ â”œâ”€â”€ impl&lt;/p&gt;&lt;p data-pid=&quot;fm6BELAZ&quot;&gt;â”‚ â”‚  â”‚ â”‚ â”œâ”€â”€ AServiceUnitTest.java AService.javaçš„å•å…ƒæµ‹è¯•å…¥å£&lt;/p&gt;&lt;p data-pid=&quot;81FeKsTF&quot;&gt;â”‚ â”‚  â”‚ â”‚ â”œâ”€â”€ AServiceIntegrationTest.java  AService.javaçš„é›†æˆæµ‹è¯•å…¥å£&lt;/p&gt;&lt;p data-pid=&quot;ogsfz2f7&quot;&gt;â”‚ â”œâ”€â”€ CommonTools.java   é€šç”¨çš„Fakeæ•°æ®å¯ä»¥æ”¾è¿™é‡Œç”Ÿæˆ&lt;/p&gt;&lt;p data-pid=&quot;y65ttbJs&quot;&gt;UnitTestä»¥åŠIntegrationTeståšæ–‡ä»¶åç¼€å¯ä»¥ç”¨äºåŒºåˆ†å•å…ƒæµ‹è¯•åŠé›†æˆæµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨IntelliJ IDEAä¸­JUnitçš„Patternæ–¹æ³•åˆ†åˆ«å¯¹é›†æˆæµ‹è¯•å’Œå•å…ƒæµ‹è¯•è¿›è¡Œåˆ†ç»„ï¼Œè¿™æ ·å¯ä»¥ä¸€æ¬¡æ€§è¿è¡Œæ‰€æœ‰çš„é›†æˆ/å•å…ƒæµ‹è¯•ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•é…ç½®&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;n&quot;&gt;æ–°å»ºJUnité…ç½®å&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;åœ¨Build&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runä¸­é€‰æ‹©Patternæ¨¡å¼&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;å‚æ•°å¦‚ä¸‹&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¼š&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;å•å…ƒæµ‹è¯•é…ç½®&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¼š&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UnitTest&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;é›†æˆæµ‹è¯•é…ç½®&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¼š&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IntegrationTest&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;jMMYPRRl&quot;&gt;ç„¶åå°±å¯ä»¥æ‰¹é‡è¿›è¡Œé›†æˆ/å•å…ƒæµ‹è¯•äº†&lt;/p&gt;&lt;p data-pid=&quot;avzNm1Ld&quot;&gt;å…³äºæµ‹è¯•å‡½æ•°çš„å‘½åï¼Œæˆ‘ä¸ªäººå€¾å‘äºä»æ–¹æ³•åå°±èƒ½å¯¹TestCaseæœ‰ä¸ªå¤§è‡´çš„æ¦‚å¿µï¼Œæ¯”å¦‚è¿è¡Œåè·å–ä¸€æ¬¡æ¶ˆæ¯ä»¥åå¤±è´¥ï¼Œå‡½æ•°åå¯èƒ½å°±é•¿è¿™æ ·&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;exec_GotOnce_Then_Failed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//test code
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;AFdWC-8V&quot;&gt;ç„¶åå¯¹äºå¤šä¸ªè¢«æµ‹å‡½æ•°çš„å¤šä¸ªTestCaseï¼Œåº”è¯¥åˆ†å¼€åœ¨å¤šä¸ªå‡½æ•°ä¸­æ¥æµ‹è¯•ï¼Œå¤šä¸ªTestCaseåˆ†å¼€åˆ°ä¸åŒå‡½æ•°åï¼Œæµ‹è¯•æ•°æ®çš„æ„å»ºå¯ä»¥ä½¿ç”¨@Beforeä»¥åŠ@Afterè¿›è¡Œåˆå§‹åŒ–å’Œæ¸…é™¤ã€‚è¿™æ ·çš„éš”ç¦»ï¼Œä»æ ¹æœ¬ä¸Šæœç»äº†ç›¸åŒå‡½æ•°ä¸åŒæµ‹è¯•æµç¨‹ä¹‹é—´çŠ¶æ€è¢«æ±¡æŸ“çš„é—®é¢˜ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å…³äºæ³¨è§£&lt;/b&gt;&lt;/h2&gt;&lt;h3&gt;å¯åŠ¨æ³¨è§£&lt;/h3&gt;&lt;p data-pid=&quot;CV9wbWuc&quot;&gt;å½“æˆ‘ä»¬åšå•å…ƒæµ‹è¯•æ—¶ï¼ŒåŸºæœ¬æ˜¯ä¸éœ€è¦åŠ è½½ä¸‰æ–¹åº“æˆ–è€…å…¶ä»–æœåŠ¡çš„ï¼Œä¸ºäº†èŠ‚çœå•å…ƒæµ‹è¯•çš„å¯åŠ¨æ—¶é—´ï¼Œå¯¹äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æˆ‘ä»¬ä¼šé‡‡ç”¨ä¸åŒçš„æ³¨è§£&lt;/p&gt;&lt;h3&gt;&lt;b&gt;å•å…ƒæµ‹è¯•&lt;/b&gt;&lt;/h3&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PowerMockRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@MockitoSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strictness&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Strictness&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENIENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PrepareForTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DbkdOrderStatusCallbackService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IPrintService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AbstractExpressOrderService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3&gt;&lt;b&gt;é›†æˆæµ‹è¯•&lt;/b&gt;&lt;/h3&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@SpringBootTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;classes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MyProject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//MyProjectå¯ä»¥æ›¿æ¢ä¸ºä½ è‡ªå·±çš„é¡¹ç›®å…¥å£ç±»
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SpringJUnit4ClassRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PrepareForTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;   
&lt;span class=&quot;nd&quot;&gt;@PowerMockIgnore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;org.slf4j.Logger.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;org.slf4j.LoggerFactory.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;javax.management.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;javax.crypto.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;javax.security.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;javax.script.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;org.w3c.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;javax.xml.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;com.thoughtworks.xstream.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;org.powermock.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;org.powermock.classloading.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;org.mockito.*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&lt;li data-pid=&quot;kzNWgX9P&quot;&gt;@PrepareForTestï¼šç”¨äºå‘ŠçŸ¥PowerMockè¢«æµ‹è¯•çš„ç±»ï¼Œè¢«Mockçš„ç±»éƒ½éœ€è¦æ·»åŠ åœ¨è¿™é‡Œ&lt;/li&gt;&lt;li data-pid=&quot;CAsIz5ED&quot;&gt;@RunWithï¼šå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ç›´æ¥ä½¿ç”¨ç›¸åº”çš„é…ç½®å³å¯&lt;/li&gt;&lt;li data-pid=&quot;3tejTByp&quot;&gt;@MockitoSettingsï¼šç”¨äºé…ç½®PowerMock/Mockitoå¯¹äºè¢«mockæ–¹æ³•æ£€æµ‹çš„ä¸¥æ ¼ç¨‹åº¦ï¼ŒStrictness.LENIENTæ˜¯ä¸€ä¸ªå®½æ¾çš„é…ç½®ï¼Œå¦‚æœæŸä¸ªmockæ–¹æ³•åœ¨æŸä¸ªTestCaseä¸­æœªè¢«ç”¨åˆ°ï¼Œé»˜è®¤çš„é…ç½®åˆ™ä¼šæŠ¥é”™ï¼Œå®½æ¾çš„é…ç½®åˆ™ä¼šè®©æµ‹è¯•è½»æ¾ä¸€ç‚¹ï¼ˆå½“ç„¶å¹¶ä¸ä»£è¡¨å¾ˆå¤šçš„å†—ä½™mockæ–¹æ³•å¯ä»¥è¢«æ¥å—ï¼‰&lt;/li&gt;&lt;li data-pid=&quot;zLIq3PTn&quot;&gt;@PowerMockIgnoreï¼šä¸è¿›è¡Œmockçš„ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘è¿™é‡Œåˆ—å‡ºçš„é…ç½®åˆ—è¡¨ï¼Œå¦‚æœå‘ç°æœ‰é—®é¢˜å¯å†è‡ªè¡Œæ·»åŠ ï¼Œä¸åŠ çš„è¯å¯èƒ½åœ¨é›†æˆæµ‹è¯•å¯åŠ¨æ—¶ä¼šæŠ¥é”™&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Mockä»¥åŠè¢«æµ‹è¯•å¯¹è±¡&lt;/h3&gt;&lt;h3&gt;å•å…ƒæµ‹è¯•&lt;/h3&gt;&lt;p data-pid=&quot;gVXJNLQ4&quot;&gt;å¯¹äºè¢«æµ‹è¯•çš„å¯¹è±¡ä¸€èˆ¬ä½¿ç”¨ä»¥ä¸‹æ³¨è§£&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;d86jerLb&quot;&gt;å¯¹äºFuncServiceå†…éœ€è¦è¢«Mockçš„æœåŠ¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ³¨è§£&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@org.mockito.Mock&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3&gt;é›†æˆæµ‹è¯•&lt;/h3&gt;&lt;p data-pid=&quot;PstzLIJH&quot;&gt;ç”±äºé›†æˆæµ‹è¯•ä¸€äº›æœåŠ¡ä¸èƒ½è¢«Mockï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ Autowiredæ³¨è§£&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;å…³äºå•å…ƒ/é›†æˆæµ‹è¯•çš„è¾¹ç•Œ&lt;/h2&gt;&lt;p data-pid=&quot;AUgfNMer&quot;&gt;è¾¹ç•Œçš„ç¡®å®šä¸»è¦æ˜¯ä¸ºäº†ç»„é‡Œçš„æ–°äººèƒ½åœ¨ç¼–å†™æ—¶ç¡®å®šåº”è¯¥å¯¹å“ªäº›éƒ¨åˆ†è¿›è¡ŒMockï¼Œæ‰€ä»¥è¿™é‡Œçš„è¾¹ç•Œæˆ‘æ˜¯æŒ‰ä¸ªäººçš„ç†è§£æ¥å®šçš„&lt;/p&gt;&lt;h3&gt;&lt;b&gt;å•å…ƒæµ‹è¯•çš„è¾¹ç•Œ&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;B20l9Hpd&quot;&gt;å…³æ³¨äºå•ä¸ªå‡½æ•°çš„é€»è¾‘ï¼Œå¯¹äºå¤–éƒ¨è°ƒç”¨éœ€è¦è¿›è¡ŒMockæ›¿æ¢ï¼Œæµ‹è¯•ç”¨ä¾‹ä¿è¯å‡½æ•°å†…éƒ¨æµç¨‹çš„å…¨è¦†ç›–&lt;/p&gt;&lt;h3&gt;&lt;b&gt;é›†æˆæµ‹è¯•çš„è¾¹ç•Œ&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;3ryHNYH6&quot;&gt;å…³æ³¨äºæŸä¸ªä¸šåŠ¡æµç¨‹ï¼Œå¯¹äºå¤–éƒ¨è°ƒç”¨è¿›è¡Œæœ‰é€‰æ‹©çš„Mockï¼ˆæ¯”å¦‚å¯¹DubboæœåŠ¡è¿›è¡ŒMockï¼‰ï¼Œæµ‹è¯•ç”¨ä¾‹å°½å¯èƒ½çš„è¦†ç›–è¢«æµ‹ä¸šåŠ¡æµç¨‹å„åˆ†æ”¯ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å…ˆå¯¹é›†æˆæµ‹è¯•éœ€è¦è¢«mockçš„æ¨¡å—è¿›è¡Œå®šä¹‰&lt;/p&gt;&lt;ul&gt;&lt;li data-pid=&quot;17_fWK5s&quot;&gt;ä¾èµ–äºç¬¬ä¸‰æ–¹çš„æœåŠ¡ï¼Œæ¯”å¦‚è°ƒç”¨å‘é€çŸ­ä¿¡&lt;/li&gt;&lt;li data-pid=&quot;vWCDD6Jd&quot;&gt;æ¯”è¾ƒå¤æ‚ä½†åˆå¯¹å½“å‰æµ‹è¯•å½±å“ä¸å¤§çš„æœåŠ¡ï¼Œæ¯”å¦‚é‰´æƒ&lt;/li&gt;&lt;/ul&gt;&lt;p data-pid=&quot;75ZQXU4T&quot;&gt;ä¸éœ€è¦è¿›è¡ŒMockçš„æ¨¡å—&lt;/p&gt;&lt;p data-pid=&quot;SORT19m_&quot;&gt;ä¸»è¦æ˜¯æˆ‘ä¸ªäººè§‰å¾—æ•°æ®å…¥åº“ä¹Ÿæ˜¯é›†æˆæµ‹è¯•çš„ä¸€ç¯ï¼Œå…¶ä»–è§†æƒ…å†µè€Œå®šï¼Œä¸»è¦åŸåˆ™ä¸ºå°½å¯èƒ½æµ‹è¯•ä¸šåŠ¡æµç¨‹ä¸­çš„æ¯ä¸ªä¸€å…³é”®èŠ‚ç‚¹ï¼Œå°½å¯èƒ½å°‘çš„å¯¹æ¨¡å—è¿›è¡ŒMock&lt;/p&gt;&lt;h2&gt;å¼€å§‹ç¼–å†™æµ‹è¯•&lt;/h2&gt;&lt;p data-pid=&quot;JEQBfKb3&quot;&gt;ä¸‹é¢æˆ‘ä¼šä¸¾ä¾‹ä¸€äº›æˆ‘è‡ªå·±æ¯”è¾ƒå¸¸ç”¨çš„æµ‹è¯•ä»£ç ç¼–å†™ï¼Œå¦‚æœæœ‰æ²¡æœ‰è¦†ç›–åˆ°çš„æƒ…å†µæˆ–è€…æœ‰æ›´å¥½çš„å†™æ³•å¯ä»¥è¯„è®ºå›å¤æŒ‡ç‚¹æˆ‘ä¸€ä¸‹&lt;/p&gt;&lt;h3&gt;&lt;b&gt;æµ‹è¯•ä¸€ä¸ªpublic/protectedå‡½æ•°&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;8HNJVzQa&quot;&gt;æœ€åŸºç¡€çš„ç”¨æ³•ï¼Œç°åœ¨ä½ æœ‰ä¸€ä¸ªç±»FuncService&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncService&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;funcA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;funcB&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;dHqwT2O4&quot;&gt;æ–°å»ºä¸€ä¸ªFuncServiceUnitTest.javaçš„æ–‡ä»¶&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PowerMockRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@MockitoSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strictness&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Strictness&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENIENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PrepareForTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PowerMockIgnore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//çœç•¥
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncServiceUnitTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;funcA_returnAdmin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//public methodç›´æ¥è°ƒç”¨å³å¯
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;funcA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//ç”¨äºè°ƒç”¨protected method
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Whitebox&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;invokeMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;funcB&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3&gt;&lt;b&gt;å½“å‡½æ•°é‡Œæœ‰å…¶ä»–å‡½æ•°è°ƒç”¨çš„æ—¶å€™&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;n5AQpCZV&quot;&gt;ç±»FuncServiceä¸­çš„userCharacterä¼šè°ƒç”¨åŒä¸€ä¸ªç±»ä¸­çš„isRootåˆ¤æ–­æ–¹æ³•&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isRoot&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;3opY-yb7&quot;&gt;æˆ‘ä»¬æƒ³è¦mockå‡½æ•°isRootï¼Œè¿”å›ä¸€äº›æˆ‘ä»¬é¢„è®¾çš„å€¼ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘ä»¬mockåè¿”å›true&lt;/p&gt;&lt;p data-pid=&quot;FjZXtwAT&quot;&gt;æµ‹è¯•ç”¨ä¾‹è¿˜æ˜¯å¯ä»¥å’Œä¹‹å‰ä¸€æ ·å†™&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PowerMockRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@MockitoSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strictness&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Strictness&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENIENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PrepareForTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PowerMockIgnore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//çœç•¥
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncServiceUnitTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mockfuncB_when_call_funcA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å› ä¸ºfuncBä¸ºprotected methodæ‰€ä»¥éœ€è¦ä½¿ç”¨PowerMockito
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;doReturn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;isRoot&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyLong&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;4JRpWVng&quot;&gt;å‡å¦‚ç°åœ¨isRootè¿ç§»åˆ°äº†å•ç‹¬çš„æœåŠ¡ï¼Œæ¯”å¦‚æ–°æ¥å£ä¸ºIUserServiceï¼Œæä¾›äº†ä¸€ä¸ªisRootçš„æœåŠ¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;ZNvZoKOl&quot;&gt;ç„¶åæˆ‘ä»¬åœ¨userCharacteré‡Œè¿›è¡Œäº†è°ƒç”¨&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isRoot&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;CAp1r-QE&quot;&gt;æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨æµ‹è¯•ç”¨ä¾‹é‡ŒMockè¿™ä¸ªæ¥å£å¹¶è¿›è¡Œåˆå§‹åŒ–&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PowerMockRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@MockitoSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strictness&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Strictness&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENIENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PrepareForTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PowerMockIgnore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//çœç•¥
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

      &lt;span class=&quot;c1&quot;&gt;//å¦‚æœä¸ä½¿ç”¨Mockito.mockæŠ¥é”™çš„è¯å¯ä»¥è¯•è¯•è¿™æ ·åˆå§‹åŒ–
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;    &lt;span class=&quot;nd&quot;&gt;@org.mockito.Mock&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mockIsRoot_when_call_funcA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;doReturn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;isRoot&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyLong&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// æµ‹è¯•è¿”å›å€¼ä¸ºfalseçš„æƒ…å†µ
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;PnOesw8i&quot;&gt;å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹IUserServiceè¿›è¡Œmockï¼Œé‚£ä¹ˆ@PrepareForTestéœ€è¦åŠ ä¸Šè¯¥ç±»&lt;/p&gt;&lt;h3&gt;&lt;b&gt;å¦‚æœç¢°åˆ°äº†æ“ä½œæ•°æ®åº“æ€ä¹ˆåŠï¼Ÿ&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;VxGg0db6&quot;&gt;è¿™æ¬¡FuncServiceè°ƒç”¨isRootéœ€è¦ä»æ•°æ®åº“ä¸­è¯»å–ä¿¡æ¯æ¥è¿”å›ç”¨æˆ·çš„è§’è‰² ï¼ŒuserCharacteré€šè¿‡ç”¨æˆ·idæ¥è·å–ç”¨æˆ·åï¼Œå•å…ƒæµ‹è¯•æ—¶æˆ‘ä»¬éœ€è¦Mockæ‰æ•°æ®åº“çš„éƒ¨åˆ†æ“ä½œ&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserDao&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userORMDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;selectUserCharacterById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;awQdD9BW&quot;&gt;ç„¶åæˆ‘ä»¬æƒ³mockä¸€ä¸‹è¿™ä¸ªselectUserCharacterByIdï¼Œè®©ä»–è¿”å›&quot;user&quot;&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PowerMockRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@MockitoSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strictness&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Strictness&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENIENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PrepareForTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PowerMockIgnore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//çœç•¥
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@org.mockito.Mock&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserORMDao&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userORMDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mockUserDao_when_call_userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// public æ–¹æ³•å¯ä»¥ç›´æ¥ä½¿ç”¨Mockitoè¿›è¡Œmock
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;doReturn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userORMDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;selectUserCharacterById&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyLong&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;Avoz_EnI&quot;&gt;ä¸è¿‡è¿™é‡Œå†™æ­»è¿”å›&quot;user&quot;å¯èƒ½å¹¶ä¸å¤ªå¥½ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ ¹æ®å‡½æ•°å…¥å‚æ¥è¿›è¡Œä¸åŒå€¼çš„è¿”å›ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹PowerMockitoçš„mockæ–¹æ³•è¿›è¡Œä¸€ä¸‹æ”¹è¿›&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PowerMockRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@MockitoSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strictness&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Strictness&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENIENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PrepareForTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PowerMockIgnore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//çœç•¥
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

      &lt;span class=&quot;c1&quot;&gt;//è¿™é‡Œæˆ‘ä»¬éœ€è¦å…ˆmockè¿™ä¸ªæ¥å£
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;    &lt;span class=&quot;nd&quot;&gt;@org.mockito.Mock&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserORMDao&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userORMDao&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¼›&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mockUserDao_when_call_userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ä¿®æ”¹ä¸ºdoAnswerï¼Œç„¶åæ ¹æ®å‚æ•°è¿›è¡Œä¸åŒçš„è¿”å›
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;doAnswer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;invocation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;invocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getArgument&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userORMDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;selectUserCharacterById&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyLong&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ä¼ å…¥1ä¸ºuser
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ä¼ å…¥0ä¸ºroot
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;uxseZfsX&quot;&gt;å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å°†mockå‚æ•°çš„Mockito.anyLong()æ›¿æ¢æˆä»»ä½•ä½ æƒ³æµ‹è¯•çš„å€¼ï¼Œæ¯”å¦‚anyString()ï¼ŒanyInt()ï¼Œå¦‚æœå‚æ•°æ˜¯å¯¹è±¡ï¼Œæ¯”å¦‚BigDecimalï¼Œåˆ™å¯ä»¥ä½¿ç”¨Mockito.any(BigDecimal.class)&lt;/p&gt;&lt;h3&gt;&lt;b&gt;å¦‚æœæƒ³è¦æµ‹è¯•å¼‚å¸¸å‘¢ï¼Ÿ&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;1IOGG3Tc&quot;&gt;æˆ‘ä»¬å†³å®šå¯¹userIdçš„æŸäº›è¾¹ç•Œæƒ…å†µè¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ˆæ¯”å¦‚userIdå¿…é¡»å¤§äº0ï¼Œä¸ç„¶å°±æŠ›å‡ºå¼‚å¸¸ï¼‰&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserDao&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EXCEPTION_USER_ID_INVALID&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;userId should be positive&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å‡è®¾userIdå¿…é¡»å¤§äº0ï¼Œå¦åˆ™æˆ‘ä»¬æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXCEPTION_USER_ID_INVALID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;selectUserCharacterById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;YM9W-eFU&quot;&gt;è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ç”¨åˆ°Assertions.assertThrowsæ–¹æ³•&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PowerMockRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@MockitoSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strictness&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Strictness&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENIENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PrepareForTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PowerMockIgnore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//çœç•¥
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@org.mockito.Mock&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserORMDao&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userORMDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mockException_when_userId_is_negative&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//æˆ‘ä»¬è¦æµ‹è¯•è¿™ä¸ªæŠ›å‡ºçš„å¼‚å¸¸
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertThrows&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// åˆ¤æ–­æ˜¯å¦æ˜¯æˆ‘ä»¬éœ€è¦çš„å¼‚å¸¸
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXCEPTION_USER_ID_INVALID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3&gt;&lt;b&gt;å¦‚æœæˆ‘æƒ³çŸ¥é“æŸä¸ªå‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°æ€ä¹ˆåŠï¼Ÿ&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;pQL5ZHH8&quot;&gt;æœ‰æ—¶å€™åœ¨è¢«æµ‹è¯•å‡½æ•°ä¸­ï¼Œä¼šè°ƒç”¨å…¶ä»–çš„å‡½æ•°ï¼Œå¯¹äºUnitTestæ¥è¯´ï¼Œå¦‚æœè¯¥å‡½æ•°æœ‰è¿”å›å€¼æˆ‘ä»¬ä¼šåƒä¹‹å‰ä¸€æ ·mockè¯¥å‡½æ•°ï¼Œå¹¶è¿”å›æˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œä½†å¯¹äºæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“æ˜¯å¦è¢«è°ƒç”¨å°±å¯ä»¥äº†ï¼Œç°åœ¨æˆ‘ä»¬æƒ³è¦åœ¨userIdæœ‰å¼‚å¸¸æ—¶è°ƒç”¨ä¸€æ¬¡æ¶ˆæ¯æ¨é€æœåŠ¡ï¼Œè®©ç›¸å…³çš„äººçŸ¥é“è¿™é‡Œå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œæ¶ˆæ¯æ¨é€æœåŠ¡å¦‚ä¸‹&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IMessageService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tellSomeOneUserIdIsException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MessageNotifyService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;implments&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IMessageService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tellSomeOneUserIdIsException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//blablabla
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;Npw712tB&quot;&gt;æ¶ˆæ¯æ¨é€çš„ä»£ç å°±ä¸å†™äº†ï¼Œç„¶ååœ¨userCharacterä¸­ä¼šè°ƒç”¨æ¶ˆæ¯æ¨é€&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IMessageService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;messageService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ServiceException&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// userId&amp;lt;0ï¼Œæˆ‘ä»¬è°ƒç”¨æ¶ˆæ¯æ¨é€
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;messageService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;tellSomeOneUserIdIsException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXCEPTION_USER_ID_INVALID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userORMDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;selectUserCharacterById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;character&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;S2HdttVH&quot;&gt;æˆ‘ä»¬éœ€è¦mockè¿™é‡Œçš„tellSomeOneUserIdIsExceptionæ–¹æ³•ï¼Œæˆ‘ä»¬è¿™é‡Œçš„æµ‹è¯•ä»£ç å¯ä»¥è¿™æ ·å†™&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PowerMockRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@MockitoSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strictness&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Strictness&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENIENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PrepareForTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PowerMockIgnore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;//çœç•¥
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@org.mockito.Mock&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserORMDao&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userORMDao&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IUserORMDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@org.mockito.Mock&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IMessageService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;messageService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IMessageService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mockMessage_when_call_userCharater_and_count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// mock messageService
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;doNothing&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;messageService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tellSomeOneUserIdIsException&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyLong&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// mock UserDao
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;doReturn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userORMDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;selectUserCharacterById&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyLong&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertThrows&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXCEPTION_USER_ID_INVALID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;//å…ˆè°ƒç”¨ï¼Œç„¶åè¿›è¡Œè°ƒç”¨æ¬¡æ•°ç»Ÿè®¡
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;
        &lt;span class=&quot;c1&quot;&gt;// public methodçš„ç»Ÿè®¡ç›´æ¥ä½¿ç”¨Mockitoå°±å¯ä»¥äº†
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;messageService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;times&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;tellSomeOneUserIdIsException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyLong&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;OC3SU_PG&quot;&gt;å¦‚æœåœ¨åŒä¸€æ®µä»£ç é‡Œæœ‰å¤šæ¬¡å¯¹äºåŒä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨è®¡æ•°æ–­è¨€ï¼Œåˆ™å¿…é¡»è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè®¡æ•°æ¸…é›¶ï¼Œå¦åˆ™ä¼šå¯¼è‡´è®¡æ•°æ–­è¨€å‡ºé”™&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;clearInvocations&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;corpBalanceAccountDao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3&gt;&lt;b&gt;å¦‚ä½•å¯¹é™æ€æ–¹æ³•è¿›è¡ŒMock&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;Zs33eq8L&quot;&gt;å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé…ç½®è·å–çš„æ–¹æ³•&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;ConstService.getValue(&quot;project&quot;, &quot;key&quot;);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;LxL06X1c&quot;&gt;getValueæ˜¯ä¸ªstatic methodï¼Œé‚£å¦‚ä½•å¯¹static methodè¿›è¡Œmockå‘¢ï¼Œå‡è®¾ç°åœ¨FuncServiceä¸­çš„funcCä¼šè°ƒç”¨getValueè·å–ä¸€ä¸ªé…ç½®å€¼&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@Service&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IFuncServcie&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;funcC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// userId=0ï¼Œæˆ‘ä»¬è·å–é…ç½®å€¼
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ConstService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;project&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;mqGOEfJ_&quot;&gt;ç°åœ¨æˆ‘ä»¬æ”¹è¿›ä¸€ä¸‹æµ‹è¯•ä»£ç &lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IFuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;funcCUT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;VALUE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//å£°æ˜æˆ‘ä»¬éœ€è¦mockçš„ç±»
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mockStatic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConstService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;doReturn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VALUE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConstService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;getValue&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;VALUE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;PrivateAccessor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;funcC&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;oE71f6iq&quot;&gt;è¿™é‡Œå¹¶ä¸å…³å¿ƒgetValueçš„å…¥å‚ï¼Œå¦‚æœä½ å¸Œæœ›æŒ‡å®šå‚æ•°ï¼Œåˆ™å¯ä»¥ä¿®æ”¹Mockito.anyString()ä¸ºä½ æŒ‡å®šçš„å‚æ•°ï¼Œå¦‚æœéœ€è¦é’ˆå¯¹ä¸åŒçš„å…¥å‚è¿›è¡Œä¸åŒçš„è¿”å›ï¼Œå¯ä»¥ä½¿ç”¨doAnswerè¿›è¡Œå¤„ç†ï¼Œç„¶åè®°å¾—è¦åœ¨PrepareForTeståŠ å…¥è¢«mockçš„ç±»&lt;/p&gt;&lt;h3&gt;&lt;b&gt;å¦‚ä½•å¯¹Abstract Classè¿›è¡Œæµ‹è¯•&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;qQCsOdLr&quot;&gt;å› ä¸ºAbstract Classéœ€è¦æœ‰ä¸€ä¸ªç»§æ‰¿çš„å®ç°ç±»æ¥ç”Ÿæˆå®ä½“ï¼Œå‡è®¾æœ‰å¦‚ä¸‹çš„Abstract Class&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AbstractUserService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;T-IpHaaw&quot;&gt;å‡è®¾æœ‰ä¸€ä¸ªå®ç°ç±»ä¸ºEnterpriseUserService&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;EnterpriseUserSerivce&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;implments&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AbstractUserService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;JRUhWrGr&quot;&gt;å‡å¦‚æˆ‘ä»¬æƒ³è¦æµ‹è¯•AbstractUserService::userNameå‡½æ•°åˆ™æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AbstractUserServiceTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;    
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AbstractUserService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;abstractUserService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EnterpriseUserSerivce&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userName_when_userId_is_invalid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å¯¹userNameè¿›è¡Œæµ‹è¯•
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3&gt;&lt;b&gt;å¦‚ä½•å¯¹åªæœ‰æ¥å£çš„æœåŠ¡è¿›è¡ŒMock&lt;/b&gt;&lt;/h3&gt;&lt;p data-pid=&quot;camFMVVp&quot;&gt;å‡è®¾ç°åœ¨isRootçš„æœåŠ¡åªæœ‰æ¥å£æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰å®ç°ä»£ç ï¼ˆæ¯”å¦‚æˆ‘å¸çš„DubboæœåŠ¡ï¼‰&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IUserServiceV1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Resource&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserServiceV1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userServiceV1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;c1&quot;/&gt;        &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isRoot&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userServiceV1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p data-pid=&quot;23-jxHUk&quot;&gt;å› ä¸ºé¡¹ç›®ä¸­æ²¡æœ‰è¯¥æ¥å£çš„å®ç°ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ç›´æ¥å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œç»§æ‰¿å¹¶å®ç°å…¶æ–¹æ³•å°±å¯ä»¥äº†&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FuncTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Spy&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@InjectMocks&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PowerMockito&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;spy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FuncService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UserServiceV1Profider&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IUserServiceV1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isRoot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;test_if_user_is_root&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Assertions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertEquals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;s&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;funcService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;userCharacter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;&lt;b&gt;å¼€å§‹ç¼–å†™é›†æˆæµ‹è¯•&lt;/b&gt;&lt;/h2&gt;&lt;p data-pid=&quot;rsVxEwe4&quot;&gt;é›†æˆæµ‹è¯•çš„å¤§åˆ†éƒ¨å®è·µå’Œå•å…ƒæµ‹è¯•æ¯”è¾ƒç±»ä¼¼ï¼Œä¸è¿‡é›†æˆæµ‹è¯•ç›¸æ¯”å•å…ƒæµ‹è¯•çš„æ‰§è¡Œç¯å¢ƒä¼šæ›´çœŸå®ï¼Œå¤æ‚åº¦ä¼šæœ‰æ‰€å¢åŠ ï¼ˆä¸»è¦æ˜¯ï¼‰ï¼ŒæŒ‰æˆ‘ç›®å‰ä¸ºæ­¢çš„ç»éªŒï¼Œé›†æˆæµ‹è¯•ä¸»æµç¨‹å¯ä»¥æŒ‰ä»¥ä¸‹æµç¨‹æ¥ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li data-pid=&quot;_Sn8VWyv&quot;&gt;åˆå§‹åŒ–é€šç”¨çš„mockæ¨¡å—ï¼Œä¸€èˆ¬ä½¿ç”¨@Beforeè¿›è¡Œåˆå§‹åŒ–ï¼ˆæ¯”å¦‚ç¬¬ä¸‰æ–¹æœåŠ¡çš„mockï¼‰&lt;/li&gt;&lt;li data-pid=&quot;d3k2AxvO&quot;&gt;æ¸…é™¤å¯èƒ½å­˜åœ¨çš„ä¸Šä¸€è½®æ¨¡æ‹Ÿæ•°æ®ï¼ˆä¸»è¦æ˜¯æ•°æ®åº“ä¸­çš„æ•°æ®ï¼‰ï¼Œé¿å…å¯¹æµ‹è¯•ç»“æœé€ æˆæ±¡æŸ“&lt;/li&gt;&lt;li data-pid=&quot;lnR6pxdp&quot;&gt;åˆå§‹åŒ–é›†æˆæµ‹è¯•æ‰€éœ€çš„æ¨¡æ‹Ÿæ•°æ®&lt;/li&gt;&lt;li data-pid=&quot;zSIg7SOC&quot;&gt;è¿›è¡Œæµ‹è¯•&lt;/li&gt;&lt;li data-pid=&quot;ZJagSNLI&quot;&gt;æ¸…ç†æ¨¡æ‹Ÿæ•°æ®ï¼Œä¸€èˆ¬ä½¿ç”¨@Afterè¿›è¡Œæ¸…ç†&lt;/li&gt;&lt;/ol&gt;&lt;p data-pid=&quot;_c0g6sG7&quot;&gt;è¿™é‡Œå°±æ˜¯ä¸æ˜¯éœ€è¦Mockæ•°æ®åº“æ“ä½œï¼Œæˆ‘å’ŒåŒäº‹æœ‰äº›åˆ†æ­§ï¼Œä»–è®¤ä¸ºé›†æˆæµ‹è¯•çš„æ•°æ®åº“æ“ä½œå¦‚æœMockåå¯ä»¥çœç•¥è®¸å¤šæ•°æ®åº“çš„åˆå§‹å’Œæ¸…ç†å·¥ä½œï¼Œå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åæ¥ä»”ç»†æ€è€ƒäº†ä¸€ä¸‹ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºé›†æˆæµ‹è¯•å¯¹æ•°æ®åº“æ“ä½œä¸Mockå¯èƒ½ä¼šæ›´å¥½ä¸€ç‚¹ã€‚å¦‚æœé›†æˆæµ‹è¯•æœ¬èº«å°±æ˜¯ç”±å¼€å‘è‡ªå·±æ¥ç¼–å†™çš„è¯ï¼Œå…¶å®è¿™é‡Œæ˜¯å¦Mockæ•°æ®åº“ï¼Œå¯¹äºæµ‹è¯•å·¥ä½œé‡å¹¶ä¸èƒ½æœ‰å¾ˆç›´è§‚çš„æ„Ÿå—ï¼Œå› ä¸ºä½ èƒ½å¾ˆå®¹æ˜“çš„çŸ¥é“å¦‚ä½•å»Mockæ•°æ®åº“è¿”å›çš„æ•°æ®ï¼Œä½†å¦‚æœè¿™ä¸ªå·¥ä½œæ˜¯ç”±æµ‹è¯•äººå‘˜æ¥åšçš„è¯ï¼Œé™¤éä»–éå¸¸ç†Ÿæ‚‰ä»£ç ï¼Œå¦åˆ™ä»–å¯¹äºå¦‚ä½•Mockæ•°æ®åº“è¿”å›å€¼å…¶å®æ˜¯æœ‰éš¾åº¦çš„ï¼Œå¦‚æœåªæ˜¯æ“ä½œæ•°æ®åº“çš„è¯ç›¸å¯¹æ¥è¯´ä¼šç®€å•ä¸€äº›ï¼Œå¼€å‘ä¹Ÿå¯ä»¥ååŠ©å¼€å‘ä¸€äº›æ•°æ®åº“åˆå§‹åŒ–/æ¸…é™¤çš„æµ‹è¯•æ¥å£æˆ–è€…å·¥å…·ï¼Œè¿›ä¸€æ­¥ç®€åŒ–æ•°æ®å‡†å¤‡/æ¸…ç†æµç¨‹ã€‚&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>