<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>93558c72d8cb89efc710398988c42bed</guid>
<title>Java çº¿ç¨‹æ± æ€»ç»“</title>
<link>https://toutiao.io/k/4z3o5gw</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p&gt;&lt;span&gt;&lt;strong&gt;èƒŒæ™¯&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;Javaçº¿ç¨‹æ± çš„å†™æ³•å’Œå‚æ•°æ˜¯é¢è¯•ä¸­å‡ºç°é¢‘ç‡å¾ˆé«˜çš„åŸºç¡€é¢˜ã€‚è¶Šæ˜¯åŸºç¡€çš„ä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯å¯¹é«˜é˜¶èŒä½çš„é¢è¯•è€…ï¼Œéœ€è¦å›ç­”çš„ç¬¦åˆè‡ªå·±é¢è¯•çš„èŒä½ç­‰çº§ã€‚&lt;br/&gt;&lt;/section&gt;&lt;section&gt;è¿™é‡Œä¹Ÿä¸èƒ½è¯´æ˜¯ä¸€ä¸ªå¤šä¹ˆå¥½çš„ç­”æ¡ˆï¼Œåªæ˜¯è¯´å¦‚æœæ˜¯æˆ‘ï¼Œæˆ‘æ€ä¹ˆå›ç­”ï¼Œä»…ä¾›å‚è€ƒã€‚ä»¥ä¸‹å›ç­”å¯æƒ³è±¡ä¸ºé¢è¯•å®˜çš„é—®é¢˜æ˜¯ï¼šè°ˆè°ˆçº¿ç¨‹æ± ã€‚&lt;/section&gt;&lt;section&gt;ä¸»è¦çš„æ€è·¯æ˜¯ä½œä¸ºä¸€ä¸ªå®½æ³›çš„é—®é¢˜ï¼Œå›ç­”éœ€è¦ä½“ç°ç»“æ„åŒ–çš„æ€ç»´ï¼Œè¿™æ˜¯å¿…é€‰é¡¹ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯ä»¥ä½“ç°æ·±åº¦ï¼Œè¿™æ˜¯åŠ åˆ†é¡¹ã€‚&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;å›ç­”&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;çº¿ç¨‹æ± è®¾è®¡ç›®æ ‡&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;Javaçš„çº¿ç¨‹ä¸»æµå®ç°éƒ½æ˜¯é‡‡ç”¨&lt;span&gt;&lt;strong&gt;å†…æ ¸çº§çº¿ç¨‹&lt;/strong&gt;&lt;/span&gt;å®ç°ï¼Œåˆ›å»ºçº¿ç¨‹è¦è¿›è¡Œæ“ä½œç³»ç»ŸçŠ¶æ€åˆ‡æ¢ã€‚ä¸ºäº†é¿å…èµ„æºè¿‡åº¦æ¶ˆè€—éœ€è¦è®¾æ³•é‡ç”¨çº¿ç¨‹æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚çº¿ç¨‹æ± å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ç¼“å­˜ï¼Œè´Ÿè´£å¯¹çº¿ç¨‹è¿›è¡Œç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜ä¸ç›‘æ§ã€‚&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;çº¿ç¨‹æ± å®ç°&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.3477406679764244&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRl8eRqdxL261ptdgllN1sRBnzvrVJ4UQibWWKxm5Uv2cnS5hUKVtkj67aWnIqaiaxweqycnNhzsYJvTA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1527&quot;/&gt;&lt;/p&gt;&lt;section&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œçº¿ç¨‹æ± çš„Javaå®ç°éƒ½æ˜¯ç»§æ‰¿äºJUC(java.util.concurrent)çš„Executoræ¥å£ã€‚è¿™ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªexecuteæ–¹æ³•ï¼Œä»£è¡¨äº†å…¶è¡Œä¸ºã€‚ExecutorServiceæ¥å£ç»§æ‰¿Executorï¼ŒåŠ ä¸Šäº†ç”Ÿå‘½å‘¨æœŸçš„å¤„ç†æ–¹æ³•ã€‚å…¶å¸¸ç”¨å®ç°ç±»å¦‚ï¼šThreadPoolExecutorã€ScheduledThreadPoolExecutorã€ForkJoinPoolçš„é»˜è®¤å‚æ•°æ„é€ ç±»éƒ½æœ‰åœ¨Executorsè¿™ä¸ªå·¥å…·ç±»é‡Œç›´æ¥å®ä¾‹åŒ–ã€‚&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;ä½†æ˜¯é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œä¸æ¨èä½¿ç”¨Executorsè¿™ä¸ªå·¥å…·ç±»ã€‚&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.2966360856269113&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRl8eRqdxL261ptdgllN1sRBnx35gicziapBjKRiagEsicicpboyZrODspibicib5ic7HYCMiboBQp0pZnQC0iarjA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;981&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;äºæ˜¯ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±äº†è§£ThreadPoolExecutoråˆå§‹åŒ–å‚æ•°çš„å«ä¹‰å’Œä½¿ç”¨æ–¹æ³•ã€‚&lt;/section&gt;&lt;pre&gt;&lt;span&gt;/**&lt;br/&gt; * Creates a new {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;ThreadPoolExecutor} with the given initial&lt;br/&gt; * parameters and default rejected execution handler.&lt;br/&gt; *&lt;br/&gt; * &lt;/span&gt;&lt;span&gt;@param &lt;/span&gt;&lt;span&gt;corePoolSize &lt;/span&gt;&lt;span&gt;the number of threads to keep in the pool, even&lt;br/&gt; *        if they are idle, unless {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;allowCoreThreadTimeOut} is set&lt;br/&gt; * &lt;/span&gt;&lt;span&gt;@param &lt;/span&gt;&lt;span&gt;maximumPoolSize &lt;/span&gt;&lt;span&gt;the maximum number of threads to allow in the&lt;br/&gt; *        pool&lt;br/&gt; * &lt;/span&gt;&lt;span&gt;@param &lt;/span&gt;&lt;span&gt;keepAliveTime &lt;/span&gt;&lt;span&gt;when the number of threads is greater than&lt;br/&gt; *        the core, this is the maximum time that excess idle threads&lt;br/&gt; *        will wait for new tasks before terminating.&lt;br/&gt; * &lt;/span&gt;&lt;span&gt;@param &lt;/span&gt;&lt;span&gt;unit &lt;/span&gt;&lt;span&gt;the time unit for the {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;keepAliveTime} argument&lt;br/&gt; * &lt;/span&gt;&lt;span&gt;@param &lt;/span&gt;&lt;span&gt;workQueue &lt;/span&gt;&lt;span&gt;the queue to use for holding tasks before they are&lt;br/&gt; *        executed.  This queue will hold only the {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;Runnable}&lt;br/&gt; *        tasks submitted by the {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;execute} method.&lt;br/&gt; * &lt;/span&gt;&lt;span&gt;@param &lt;/span&gt;&lt;span&gt;threadFactory &lt;/span&gt;&lt;span&gt;the factory to use when the executor&lt;br/&gt; *        creates a new thread&lt;br/&gt; * &lt;/span&gt;&lt;span&gt;@throws &lt;/span&gt;&lt;span&gt;IllegalArgumentException if one of the following holds:&lt;/span&gt;&lt;span&gt;&amp;lt;br&amp;gt;&lt;br/&gt; &lt;/span&gt;&lt;span&gt;*         {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;corePoolSize &amp;lt; 0}&lt;/span&gt;&lt;span&gt;&amp;lt;br&amp;gt;&lt;br/&gt; &lt;/span&gt;&lt;span&gt;*         {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;keepAliveTime &amp;lt; 0}&lt;/span&gt;&lt;span&gt;&amp;lt;br&amp;gt;&lt;br/&gt; &lt;/span&gt;&lt;span&gt;*         {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;maximumPoolSize &amp;lt;= 0}&lt;/span&gt;&lt;span&gt;&amp;lt;br&amp;gt;&lt;br/&gt; &lt;/span&gt;&lt;span&gt;*         {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;maximumPoolSize &amp;lt; corePoolSize}&lt;br/&gt; * &lt;/span&gt;&lt;span&gt;@throws &lt;/span&gt;&lt;span&gt;NullPointerException if {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;workQueue}&lt;br/&gt; *         or {&lt;/span&gt;&lt;span&gt;@code &lt;/span&gt;&lt;span&gt;threadFactory} is null&lt;br/&gt; */&lt;br/&gt;&lt;/span&gt;&lt;span&gt;public &lt;/span&gt;&lt;span&gt;ThreadPoolExecutor&lt;/span&gt;(&lt;span&gt;int &lt;/span&gt;corePoolSize&lt;span&gt;,&lt;br/&gt;                          int &lt;/span&gt;maximumPoolSize&lt;span&gt;,&lt;br/&gt;                          long &lt;/span&gt;keepAliveTime&lt;span&gt;,&lt;br/&gt;                          &lt;/span&gt;TimeUnit unit&lt;span&gt;,&lt;br/&gt;                          &lt;/span&gt;BlockingQueue&amp;lt;Runnable&amp;gt; workQueue&lt;span&gt;,&lt;br/&gt;                          &lt;/span&gt;ThreadFactory threadFactory) {&lt;br/&gt;    &lt;span&gt;this&lt;/span&gt;(corePoolSize&lt;span&gt;, &lt;/span&gt;maximumPoolSize&lt;span&gt;, &lt;/span&gt;keepAliveTime&lt;span&gt;, &lt;/span&gt;unit&lt;span&gt;, &lt;/span&gt;workQueue&lt;span&gt;,&lt;br/&gt;         &lt;/span&gt;threadFactory&lt;span&gt;, &lt;/span&gt;&lt;span&gt;defaultHandler&lt;/span&gt;)&lt;span&gt;;&lt;br/&gt;&lt;/span&gt;}&lt;br/&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;ThreadPoolExecutoræœ‰6ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœçº¿ç¨‹æ± æ— äº‹å¯åšï¼Œè¿˜æ˜¯ä¼šä¿ç•™è¿™äº›çº¿ç¨‹ã€‚ç¬¬äºŒä¸ªæ˜¯æœ€å¤§çº¿ç¨‹æ•°ï¼Œè¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°çš„éƒ¨åˆ†éƒ½ä¼šåœ¨ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªå‚æ•°åˆèµ·æ¥å†³å®šçš„æœ€é•¿ç©ºé—²å­˜æ´»æ—¶é—´è¶…è¿‡åè¢«å‰”é™¤ã€‚ç¬¬äº”ä¸ªå‚æ•°æ˜¯é˜»å¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹å¿™ä¸è¿‡æ¥è¦å»è¿™é‡Œé¢æ’é˜Ÿã€‚æœ€åä¸€ä¸ªæ˜¯çº¿ç¨‹æ± å·¥å‚ï¼Œä¸»è¦å†³å®šé˜Ÿåˆ—ä¹Ÿè£…ä¸ä¸‹çš„çº¿ç¨‹æ€ä¹ˆå¤„ç†ï¼Œé»˜è®¤ç­–ç•¥æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;çº¿ç¨‹æ± çš„5ç§çŠ¶æ€è®¾è®¡&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.369672131147541&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRl8eRqdxL261ptdgllN1sRBn63JhIzHef1f9QicHHWP1sDOJgfZvGj0icm4ia9SLU9iaibkGjQAm6VUlOow/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1220&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.47711088504577825&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRl8eRqdxL261ptdgllN1sRBnM9d6vLKMnsgy2PRUol8FqaMOdDnM5hia6pBuWNDhO7XJ0erg2iafjYFg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;983&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;çº¿ç¨‹æ± çš„åº•å±‚åŸç†&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;Javaçº¿ç¨‹çš„å®ç°æ˜¯é€šè¿‡è°ƒç”¨nativeæ–¹æ³•è°ƒç”¨æ“ä½œç³»ç»Ÿçš„pthread APIï¼Œç”±å†…æ ¸çº¿ç¨‹ç»Ÿä¸€ç®¡ç†ã€‚ä¸€ä¸ªå®ç°äº†Runnableçš„ç±»åªæ˜¯æ ‡è¯†å¯ç”¨å¤šçº¿ç¨‹è¿è¡Œï¼ŒçœŸæ­£äº§ç”Ÿå¤§å¼€é”€çš„æ˜¯new Thread()æ—¶è¿›è¡Œçš„å†…æ ¸è°ƒç”¨ã€‚è€Œçº¿ç¨‹æ± æŠ€æœ¯å°†workerçº¿ç¨‹ç¼“å­˜ä¸‹æ¥è¿›è¡Œé‡ç”¨ã€‚&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;è¡¥å……é—®ç­”&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;çº¿ç¨‹æ± çš„å…³é—­&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å…³é—­çº¿ç¨‹æ± å¯ä»¥è°ƒç”¨shutdownNowå’Œshutdownä¸¤ä¸ªæ–¹æ³•æ¥å®ç°ã€‚&lt;br/&gt;shutdownNowï¼šå¯¹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å…¨éƒ¨å‘å‡ºinterrupt()ï¼Œåœæ­¢æ‰§è¡Œï¼Œå¯¹è¿˜æœªå¼€å§‹æ‰§è¡Œçš„ä»»åŠ¡å…¨éƒ¨å–æ¶ˆï¼Œå¹¶ä¸”è¿”å›è¿˜æ²¡å¼€å§‹çš„ä»»åŠ¡åˆ—è¡¨ã€‚&lt;br/&gt;shutdownï¼šå½“æˆ‘ä»¬è°ƒç”¨shutdownåï¼Œçº¿ç¨‹æ± å°†ä¸å†æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä½†ä¹Ÿä¸ä¼šå»å¼ºåˆ¶ç»ˆæ­¢å·²ç»æäº¤æˆ–è€…æ­£åœ¨æ‰§è¡Œä¸­çš„ä»»åŠ¡ã€‚&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;çº¿ç¨‹æ± éƒ½æœ‰å“ªå‡ ç§å·¥ä½œé˜Ÿåˆ—&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;1ã€ArrayBlockingQueue&lt;br/&gt;æ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚&lt;br/&gt;2ã€LinkedBlockingQueue&lt;br/&gt;ä¸€ä¸ªåŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰FIFO ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ æ’åºå…ƒç´ ï¼Œååé‡é€šå¸¸è¦é«˜äºArrayBlockingQueueã€‚é™æ€å·¥å‚æ–¹æ³•Executors.newFixedThreadPool()ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—&lt;br/&gt;3ã€SynchronousQueue&lt;br/&gt;ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äºLinkedBlockingQueueï¼Œé™æ€å·¥å‚æ–¹æ³•Executors.newCachedThreadPoolä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚&lt;br/&gt;4ã€PriorityBlockingQueue&lt;br/&gt;ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡é˜Ÿåˆ—ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;ForkJoinPoolçš„åŸç†&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;æœ¬è´¨ä¸Šå°†ä¸€ä¸ªä»»åŠ¡è¿›ä¸€æ­¥ç»†åˆ†ï¼Œå†…éƒ¨ä½¿ç”¨â€œå·¥ä½œçªƒå–â€ç®—æ³•ï¼Œè®©ä»»åŠ¡åœ¨å„ä¸ªCPUä¸Šå°½å¯èƒ½å‡è¡¡ã€‚&lt;/section&gt;&lt;p&gt;ï¼ˆ1ï¼‰æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œé˜Ÿåˆ—WorkQueueï¼›&lt;/p&gt;&lt;p&gt;ï¼ˆ2ï¼‰è¿™æ˜¯ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå®ƒæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼›&lt;/p&gt;&lt;p&gt;ï¼ˆ3ï¼‰ForkJoinTaskä¸­forkçš„å­ä»»åŠ¡ï¼Œå°†æ”¾å…¥è¿è¡Œè¯¥ä»»åŠ¡çš„å·¥ä½œçº¿ç¨‹çš„é˜Ÿå¤´ï¼Œå·¥ä½œçº¿ç¨‹å°†ä»¥LIFOçš„é¡ºåºæ¥å¤„ç†å·¥ä½œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼›&lt;/p&gt;&lt;p&gt;ï¼ˆ4ï¼‰ä¸ºäº†æœ€å¤§åŒ–åœ°åˆ©ç”¨CPUï¼Œç©ºé—²çš„çº¿ç¨‹å°†ä»å…¶å®ƒçº¿ç¨‹çš„é˜Ÿåˆ—ä¸­â€œçªƒå–â€ä»»åŠ¡æ¥æ‰§è¡Œï¼›&lt;/p&gt;&lt;p&gt;ï¼ˆ5ï¼‰ä»å·¥ä½œé˜Ÿåˆ—çš„å°¾éƒ¨çªƒå–ä»»åŠ¡ï¼Œä»¥å‡å°‘ç«äº‰ï¼›&lt;/p&gt;&lt;p&gt;ï¼ˆ6ï¼‰åŒç«¯é˜Ÿåˆ—çš„æ“ä½œï¼špush()/pop()ä»…åœ¨å…¶æ‰€æœ‰è€…å·¥ä½œçº¿ç¨‹ä¸­è°ƒç”¨ï¼Œpoll()æ˜¯ç”±å…¶å®ƒçº¿ç¨‹çªƒå–ä»»åŠ¡æ—¶è°ƒç”¨çš„ï¼›&lt;/p&gt;&lt;p&gt;ï¼ˆ7ï¼‰å½“åªå‰©ä¸‹æœ€åä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ç«äº‰ï¼Œæ˜¯é€šè¿‡CASæ¥å®ç°çš„ï¼›&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;æ€»ç»“&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;section&gt;æœ¬æ–‡çš„å›ç­”éƒ¨åˆ†ä»çº¿ç¨‹æ± å®ç°ç›®æ ‡ã€å®ç°å’Œå…³é”®è®¾è®¡ã€åº•å±‚åŸç†å››ä¸ªæ–¹é¢è¯´æ˜çº¿ç¨‹æ± ï¼Œå…·æœ‰ä¸€å®šçš„ç³»ç»Ÿæ€§ã€‚è¡¥å……é—®ç­”éƒ¨åˆ†ä½œä¸ºé—®é¢˜çš„æ·±å…¥åœ¨é¢è¯•æ—¶è¢«æ·±å…¥æé—®é—®åˆ°æˆ–è€…é¢è¯•å®˜ç¤ºæ„ç»§ç»­æ·±å…¥æ¥è¯´çš„æ—¶å€™ä½¿ç”¨ã€‚&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;æ¨èé˜…è¯»&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>a41e4aa97937778242dac50dea065437</guid>
<title>æœ€è¿‘çš„ä¸€äº› Java é¢è¯•å°ç»“</title>
<link>https://toutiao.io/k/ffm07xa</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å‰è¨€&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‰æ®µæ—¶é—´é™†ç»­é¢è¯•äº†ä¸€äº›å¤§ä¸­å°å…¬å¸ï¼Œè¸©äº†ä¸å°‘å‘ï¼ŒæŒ‚äº†å¾ˆå¤šï¼ŒåŒæ—¶ä¹Ÿæœ‰ä¸å°‘æ„Ÿæ‚Ÿå’Œæ”¶è·ã€‚è¿™é‡Œæƒ³æŠŠé‚£æ®µç»å†è®°å½•ä¸€ä¸‹ï¼Œå¦‚æœèƒ½å¯¹äº²ä»¬æœ‰æ‰€å¸®åŠ©å°±å†å¥½ä¸è¿‡äº†ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¢è¯•çš„è¿‡ç¨‹å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªè‡ªæˆ‘è®¤è¯†å’Œå­¦ä¹ çš„è¿‡ç¨‹ï¼Œå³ä¾¿æš‚æ—¶æ²¡æ‰“ç®—è·³æ§½ï¼Œéš”æ®µæ—¶é—´å‡ºå»é¢ä¸€é¢å¯¹è‡ªå·±è¿˜æ˜¯æœ‰äº›å¥½å¤„çš„ï¼šä¸ä»…å¯ä»¥è¯„ä¼°ä¸€ä¸‹è‡ªå·±åœ¨å¸‚åœºçš„ä»·å€¼å’Œç«äº‰åŠ›ï¼ŒåŒæ—¶ä¹Ÿèƒ½äº†è§£ä¸€äº›æ–°æŠ€æœ¯ã€æ›´æ–°ä¸€ä¸‹è‡ªå·±çš„æŠ€æœ¯æ ˆã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è€Œä¸”åœ¨ä¸€ä¸ªåœ°æ–¹å¾…ä¹…äº†ï¼Œå¯èƒ½ä¸è‡ªè§‰çš„å°±ä¼šé™·å…¥åˆ°ä¸€ç§ã€Œèˆ’é€‚åŒºã€ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œå°±åƒæ¸©æ°´é‡Œçš„é’è›™ï¼Œä¸‡ä¸€å“ªå¤©è¢«â€œä¼˜åŒ–â€äº†å¯èƒ½ä¼šä¸çŸ¥æ‰€æªã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ¬æ–‡ä¸»è¦ä»ã€Œé¡¹ç›®ã€å’Œã€ŒæŠ€æœ¯ã€ä¸¤ä¸ªæ–¹é¢è¿›è¡Œæ€»ç»“ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€äº›æ¯”è¾ƒå¼€æ”¾å¼çš„é—®é¢˜ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…ƒæ—¦è¿‡äº†ï¼Œâ€œé‡‘ä¸‰é“¶å››â€è¿˜ä¼šè¿œå—ï¼Ÿæ˜¥èŠ‚åæœ‰æƒ³æ³•çš„äº²ä»¬ï¼Œå¯ä»¥å—¨èµ·æ¥äº†ï¼&lt;/p&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;é¡¹ç›®&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰äººè¯´ï¼šä¸‰å¹´ä¸€é“åã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯¹äºå·¥ä½œä¸‰å¹´å·¦å³çš„ä¼™ä¼´ä»¬æ¥è¯´ï¼Œã€Œé¡¹ç›®ç»å†ã€å¯è°“é‡ä¸­ä¹‹é‡ï¼Œå¯ä»¥è¯´æ¯”å…·ä½“çš„æŠ€æœ¯ç‚¹æ›´é‡è¦ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æŠ€æœ¯ç‚¹å…¶å®å¤§åŒå°å¼‚ï¼Œæœ‰äº›ä¸´æ—¶åˆ·åˆ·é¢˜å°±èƒ½äº†è§£ä¸ªå¤§æ¦‚ã€‚ä½†é¡¹ç›®ç»å†å¾€å¾€éš¾ä»¥ä¸´æ—¶ç¼–é€ ï¼Œå¦‚æœä¸æ˜¯è‡ªå·±çœŸå®åšè¿‡çš„é¡¹ç›®ã€æˆ–è€…æ²¡æœ‰å……åˆ†çš„å‡†å¤‡ï¼Œä¸€æ—¦é¢è¯•å®˜é—®å¾—ç¨å¾®æ·±å…¥å¾ˆå¯èƒ½ hold ä¸ä½ï¼Œé¢è¯•æ‰£åˆ†ä¸å°‘ã€ç”šè‡³å¯èƒ½ç›´æ¥æŒ‚æ‰ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å› æ­¤ä¸å°‘é¢è¯•å®˜å–œæ¬¢ä»é¡¹ç›®å…¥æ‰‹ï¼ŒæŠ½ä¸å‰¥èŒ§ã€æ­¥æ­¥æ·±å…¥ï¼Œé€šè¿‡é¡¹ç›®æŠŠæŠ€æœ¯ç‚¹ä¸²èµ·æ¥è€ƒå¯Ÿã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸åŒäººçš„é¡¹ç›®åƒå·®ä¸‡åˆ«ï¼Œä½†è¿˜æ˜¯æœ‰ä¸€äº›å…±åŒäº®ç‚¹çš„ï¼šæ¯”å¦‚é«˜å¹¶å‘åœºæ™¯ï¼Œå¤æ‚çš„æ¶æ„è®¾è®¡ï¼ŒJVM è°ƒä¼˜åŠé—®é¢˜æ’æŸ¥ç­‰ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™äº›äº®ç‚¹æœ‰çš„è¯å›ºç„¶æ›´å¥½ï¼Œä½†å¦‚æœå¹³æ—¶ CRUD å±…å¤šã€æ²¡å¤ªå¤šçš„äº®ç‚¹ï¼Œå…¶å®ä¹Ÿä¸å¿…å¤ªæ…Œï¼ŒæŠ€æœ¯äº®ç‚¹ä¸å¤šçš„è¯ï¼Œå¯ä»¥å¤šæ€è€ƒä¸€äº›ä¸šåŠ¡ä¸Šçš„äº®ç‚¹ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ä¸šåŠ¡æ¨¡å‹æ¯”è¾ƒå¤æ‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¯¹ä¸šåŠ¡æ•´ä½“çš„æ¶æ„è®¾è®¡å¾ˆç†Ÿæ‚‰&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä¸šåŠ¡æ¨¡å—æ‹†åˆ†æ¯”è¾ƒåˆç†&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è‡ªå·±åœ¨ä¸šåŠ¡ä¸­åšè¿‡å“ªäº›æ‰©å±•å’Œä¼˜åŒ–ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä¸šåŠ¡æ•°æ®çš„ä¸Šä¸‹æ¸¸æµè½¬æ˜¯æ€æ ·çš„ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³çš„ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç­‰ç­‰&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™äº›å…¶å®ä¹Ÿæ˜¯äº®ç‚¹ï¼Œå¯ä»¥è®©é¢è¯•å®˜çœ‹åˆ°ä½ å¹³æ—¶å¯¹ä¸šåŠ¡æœ‰è‡ªå·±çš„æ€è€ƒå’Œç†è§£ï¼Œè€Œä¸æ˜¯åªå…³æ³¨è‡ªå·±çš„é‚£ä¸€å—ï¼Œä¸åªæ˜¯å†™ä»£ç çš„æœºå™¨ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…¶å®é¢è¯•å®˜å¯¹ä½ çš„é¡¹ç›®æ˜¯ä¸€æ— æ‰€çŸ¥çš„ï¼Œä»–çš„å°è±¡ä»…ä»…åœç•™åœ¨ä½ ç®€å†ä¸Šæè¿°çš„é‚£äº›æ–‡å­—ï¼ˆè€Œä¸”æœ‰äº›é¢è¯•å®˜å¯èƒ½æ˜¯è¢«ä¸´æ—¶æ‹‰è¿‡æ¥çš„ï¼Œåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆçŸ¥é“ğŸ¶ï¼‰ã€‚é¢è¯•å®˜é€šå¸¸çš„å¼€åœºç™½å°±æ˜¯è®©ä½ è‡ªæˆ‘ä»‹ç»ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯ä¸€ä¸ªè€ƒå¯Ÿè¯­è¨€ç»„ç»‡èƒ½åŠ›å’Œå£å¤´è¡¨è¾¾èƒ½åŠ›çš„åœ°æ–¹ã€‚&lt;/p&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;æŠ€æœ¯&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬é¢çš„æ¯•ç«Ÿæ˜¯æŠ€æœ¯å²—ï¼ŒæŠ€æœ¯æœ¬èº«çš„é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æŠ€æœ¯é¢è¯•ä¸­ï¼Œæœ€é‡è¦çš„å¯ä»¥è¯´æ˜¯ã€ŒæŠ€æœ¯ä½“ç³»ã€ã€‚ä¹Ÿå°±æ˜¯ä½ ä¸ä»…è¦æœ‰æŠ€æœ¯çš„æ·±åº¦å’Œå¹¿åº¦ï¼Œæ›´è¦èƒ½æŠŠå®ƒä»¬ä¸²èµ·æ¥ï¼Œå…¶å®æœ‰ä¸å°‘æŠ€æœ¯ç‚¹æ˜¯ç›¸é€šæˆ–ç›¸ä¼¼çš„ï¼Œå¦‚æœé¢è¯•ä¸­èƒ½å¤Ÿè§¦ç±»æ—é€šã€ä¸¾ä¸€åä¸‰ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åŠ åˆ†é¡¹ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Redis çš„ AOF å’Œ MySQL çš„ bin log&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Spring ä¸­çš„ BeanDefinition å’Œ JVM ä¸­ç±»çš„å…ƒä¿¡æ¯&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¸ƒéš†è¿‡æ»¤å™¨å’Œ HashMap&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç­‰ç­‰&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æŠ€æœ¯çš„ç§¯ç´¯è™½ç„¶ä¸»è¦åœ¨å¹³æ—¶ï¼Œä½†åˆ·åˆ·é¢è¯•é¢˜è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œæœ‰ä¸å°‘å…¶å®å°±æ˜¯æ‰€è°“çš„â€œå…«è‚¡æ–‡â€ã€‚è¿™é‡Œä¸»è¦åˆ—å‡ºæœ¬äººé¢è¯•è¿‡ç¨‹ä¸­çœŸå®é‡åˆ°çš„ä¸€äº›é¢è¯•é¢˜ï¼Œä»…ä¾›å‚è€ƒã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;Java&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;çº¿ç¨‹æ± &lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;é”&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;synchronized é”å‡çº§è¿‡ç¨‹&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ReentrantLock&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å®ç°åŸç†ï¼ˆAQSï¼‰&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å…¬å¹³é”å¦‚ä½•å®ç°ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;volatile ç‰¹æ€§&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;HashMap&lt;/strong&gt;&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;HashMap &amp;amp; ConcurrentHashMap å®ç°åŸç†&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ConcurrentHashMap å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;MySQL&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ç´¢å¼•&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;åˆ†ç±»ï¼Ÿä½¿ç”¨åœºæ™¯ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;InnoDB ç´¢å¼•çš„ç»“æ„ï¼ˆB+æ ‘ï¼‰ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ B æ ‘ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦‚ä½•æŸ¥çœ‹ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼ŸExplain å…³æ³¨å“ªäº›å­—æ®µï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;äº‹åŠ¡&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;Redis&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å¸¸ç”¨æ•°æ®ç»“æ„&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¸¸è§ç¼“å­˜é—®é¢˜&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©ã€çƒ­ç‚¹ key&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;æŒä¹…åŒ–ï¼šRDBã€AOFï¼ŒäºŒè€…åŒºåˆ«&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Redis ä¸ºä»€ä¹ˆå¿«ï¼Ÿçº¿ç¨‹æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å†…å­˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿæ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä½¿ç”¨ä»€ä¹ˆé›†ç¾¤æ¡†æ¶ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;Spring&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;IoCã€AOP å®ç°&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;äº‹åŠ¡ä¼ æ’­ç‰¹æ€§ã€å¤±æ•ˆåœºæ™¯&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;JDK &amp;amp; CGLib åŒºåˆ«&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Spring Boot å¯åŠ¨åŸç†&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;Dubbo&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Dubbo æ¶æ„&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è´Ÿè½½å‡è¡¡ç®—æ³•ã€å®¹é”™ç­–ç•¥ã€ç°åº¦æµ‹è¯•&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;SPI æœºåˆ¶&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;RPC è°ƒç”¨è¿‡ç¨‹&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;RPC &amp;amp; HTTP&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;äºŒè€…åŒºåˆ«ä¸è”ç³»&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä¸ºä»€ä¹ˆ Spring Cloud ä½¿ç”¨ HTTP è€Œé RPCï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;JVM&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;è¿è¡Œæ—¶å†…å­˜åˆ’åˆ†&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;åƒåœ¾æ”¶é›†ç®—æ³•&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä¸€ä¸ªå¯¹è±¡çš„å†…å­˜åˆ†é…è¿‡ç¨‹ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;CMS æ”¶é›†å™¨&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;æ”¶é›†è¿‡ç¨‹&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å“ªä¸ªè¿‡ç¨‹ä¼šæœ‰ STWï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦‚ä½•å¤„ç†å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;G1 æ”¶é›†å™¨ç‰¹ç‚¹&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;GC Roots æœ‰å“ªäº›ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;JVM å¸¸ç”¨å‚æ•°é…ç½®æœ‰å“ªäº›ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å†…å­˜å ç”¨è¿‡å¤šï¼Œå¦‚ä½•æ’æŸ¥ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;RocketMQ&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;æ•´ä½“æ¶æ„&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦‚ä½•å®ç°é¡ºåºæ¶ˆæ¯ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ¶ˆè´¹è€…æ¥å£å¹‚ç­‰è®¾è®¡&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;äº‹åŠ¡æ¶ˆæ¯å®ç°&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;åˆ†å¸ƒå¼&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;åˆ†å¸ƒå¼é”&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Redis å¦‚ä½•å®ç°ï¼Ÿå‘½ä»¤ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ZooKeeper å¦‚ä½•å®ç°ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è·å–é”å¤±è´¥æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;åˆ†å¸ƒå¼äº‹åŠ¡&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;2PCï¼šç¼ºç‚¹ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;3PCï¼šè§£å†³äº† 2PC ä»€ä¹ˆé—®é¢˜ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;TCCï¼šç¼ºç‚¹ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æœ€ç»ˆä¸€è‡´æ€§ï¼šMQ å®ç°æµç¨‹&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å®ç°æ¡†æ¶ï¼ˆSeataï¼‰&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;å…¶ä»–&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é™¤äº†ä¸Šé¢çš„ã€Œé¡¹ç›®ã€å’Œã€ŒæŠ€æœ¯ã€ï¼Œå¯èƒ½è¿˜ä¼šé—®åˆ°ä¸€äº›å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚åœºæ™¯è®¾è®¡ä¸åˆ†æã€ç®—æ³•ï¼Œè¿˜å¯èƒ½æœ‰ä¸€äº›æ¯”è¾ƒå¼€æ”¾çš„é—®é¢˜ï¼Œä¸‹é¢ä»‹ç»ä¸‹æˆ‘æ‰€é‡åˆ°çš„ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;åœºæ™¯è®¾è®¡&amp;amp;åˆ†æ&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯”è¾ƒå…¸å‹çš„åœºæ™¯è®¾è®¡ï¼Œç”µå•†ç±»çš„å…¬å¸å¾ˆå¯èƒ½ä¼šé—®åˆ°ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šæ¡ˆä¾‹å’Œæ–‡ç« åˆ†æï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ªåº”è¯¥ä¸æ˜¯çƒ­é—¨ï¼Œæœ¬äººä¹Ÿå°±é‡åˆ°è¿‡ä¸€æ¬¡ï¼Œä¸è¿‡é‚£ä¸€æ¬¡è¢«æå¾—æœ‰ç‚¹æ‡µï¼Œå¯èƒ½æ›´å¤šçš„æ˜¯è€ƒå¯Ÿæ€è·¯ï¼Œå¤§å®¶å¯ä»¥å¤šæ€è€ƒä¸€ä¸‹ã€‚&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;JVM é—®é¢˜æ’æŸ¥ï¼šçº¿ä¸Š JVM å†…å­˜ã€CPU é£™å‡ï¼Œå¦‚ä½•å»æ’æŸ¥ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸»è¦æ¶‰åŠä¸€äº›å¸¸ç”¨çš„ Linux å‘½ä»¤å’Œ JDK è‡ªå¸¦å·¥å…·ï¼Œæ¯”å¦‚ topã€jstackã€jmap ç­‰ï¼Œä»¥åŠé˜¿é‡Œçš„å¼€æºå·¥å…· Arthas ç­‰ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è™½ç„¶åœ¨å®é™…æƒ…å†µä¸­æˆ‘ä»¬å¯èƒ½å¾ˆå°‘æœ‰æœºä¼šæ¥è§¦ï¼ˆå°å°å¼€å‘é€šå¸¸æ²¡æƒé™ï¼Œè¿˜æ˜¯è¦è¿ç»´å¤§ä½¬æ”¯æŒï¼‰ï¼Œä½†è¿™äº›å·¥å…·è¿˜æ˜¯è¦äº†è§£çš„ï¼Œå¯ä»¥åœ¨æœ¬åœ°è·‘ä¸ª Demo å»éªŒè¯ï¼Œä»¥å…åˆ°æ—¶å€™ç­”ä¸ä¸Šæ¥ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‡å¦‚çº¿ä¸Šæ‰€æœ‰æœºå™¨ï¼ˆåŒ…æ‹¬æœåŠ¡å™¨ã€æ•°æ®åº“ã€ç¼“å­˜æœåŠ¡å™¨ï¼‰å…¨éƒ¨å®•æœºï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;PS: è¿™äº›åœºæ™¯è®¾è®¡å’Œåˆ†æçš„é—®é¢˜ï¼Œé€šå¸¸æ¯”è¾ƒç»¼åˆï¼Œä¸€èˆ¬æ˜¯è€ƒå¯Ÿå¯¹ä¸€ä¸ªåœºæ™¯çš„æ•´ä½“è®¾è®¡ï¼Œæˆ–è€…åˆ†æå’Œè§£å†³é—®é¢˜çš„æ€è·¯ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;ç®—æ³•&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;PS: ç®—æ³•é—®é¢˜é‡åˆ°çš„ä¸æ˜¯å¾ˆå¤šï¼Œæœ‰äº›è€ƒå¯Ÿç®—æ³•å¯èƒ½å°±æ˜¯å•çº¯çš„é¢è¯•æµç¨‹ã€‚å½“ç„¶ï¼Œå­—èŠ‚è¿™ç±»çš„å…¬å¸é™¤å¤–ï¼Œæƒ³å»çš„è¯è‚¯å®šè¿˜æ˜¯è¦åˆ·å¾ˆå¤šç®—æ³•çš„ã€‚&lt;/p&gt;&lt;p&gt;ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¤§éƒ¨åˆ†å…¬å¸æ›´æ³¨é‡ã€Œé¡¹ç›®æ·±åº¦ã€å’Œã€ŒæŠ€æœ¯ä½“ç³»ã€ï¼Œæˆ–è€…ç»™å‡ºä¸€äº›å®é™…çš„åœºæ™¯ï¼Œè€ƒå¯Ÿåˆ†æå’Œè§£å†³é—®é¢˜çš„ç»éªŒå’Œæ€è·¯ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;å¼€æ”¾é—®é¢˜&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™äº›é—®é¢˜æ¯”è¾ƒå¼€æ”¾ï¼Œæ²¡æœ‰å›ºå®šçš„ç­”æ¡ˆï¼Œå¯èƒ½å°±æ˜¯é¢è¯•å®˜æƒ³çœ‹ä¸‹ä½ çš„ä¸´åœºå‘æŒ¥å§ã€‚é‡åˆ°çš„å‡ ä¸ªé—®é¢˜å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;æœ‰æ²¡æœ‰å¸¦è¿‡äººï¼Ÿç»å†æ˜¯æ€æ ·çš„ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦‚æœä½ ä½œä¸º PMï¼Œå¦‚ä½•ä»æ•´ä½“åè°ƒä¸€ä¸ªé¡¹ç›®ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦‚æœä½ åœ¨å›¢é˜Ÿæ¨è¡Œ DDDï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä½ æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿä¼˜ç‚¹ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æœªæ¥ä¸‰å¹´çš„èŒä¸šè§„åˆ’ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;åœ¨å…¬å¸ä¸»è¦æœ‰å“ªäº›æˆé•¿ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ä¸Šçº§ã€åŒäº‹å¯¹ä½ çš„è¯„ä»·ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æœ€è¿‘åœ¨çœ‹ä»€ä¹ˆä¹¦ï¼Ÿ&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;æœ«äº†&lt;/span&gt;&lt;/h1&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;é¢è¯•æµç¨‹&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘æ‰€æ¥è§¦çš„é¢è¯•å¤§éƒ¨åˆ†æ˜¯ã€Œä¸‰è½®æŠ€æœ¯é¢ + HR é¢ã€çš„å½¢å¼ï¼Œä¹Ÿæœ‰ä¸€äº›æ˜¯ä¸¤è½®æŠ€æœ¯é¢ï¼Œä¸åŒå…¬å¸å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚ä¸€é¢ä¸€èˆ¬æ˜¯ç”µè¯é¢åˆç­›ï¼Œåé¢äºŒä¸‰è½®æŠ€æœ¯é¢å’Œ HR é¢é€šå¸¸åœ¨ä¸€èµ·ã€‚è¿™æ ·å…¶å®ä¹ŸæŒºå¥½ï¼Œè·‘ä¸€è¶Ÿå°±è¡Œäº†ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;å¿ƒæ€&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¢è¯•çš„å¿ƒæ€ä¹Ÿå¾ˆé‡è¦ã€‚å…¶å®ä½ è·Ÿé¢è¯•å®˜ä¹‹é—´æ˜¯å¹³ç­‰çš„ï¼Œé¢è¯•çš„è¿‡ç¨‹æ˜¯è®©ä»–å¯¹ä½ æ›´åŠ äº†è§£ï¼Œè€Œä¸æ˜¯ä»–å¯¹ä½ çš„è€ƒæ ¸ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;æˆ‘åˆšå¼€å§‹é¢çš„æ—¶å€™ï¼Œ&lt;/span&gt;&lt;span&gt;ç”±äºå¥½ä¹…æ²¡é¢è¯•ï¼Œå†åŠ ä¸Šæœ¬æ¥å°±ä¸å¤ªçˆ±è¯´è¯ï¼Œåˆšå¼€å§‹ç´§å¼ çš„ä¸è¡Œï¼Œåæ¥é¢äº†å‡ æ¬¡ä¹‹åæ‰é€æ¸æœ‰ç‚¹æ„Ÿè§‰ã€‚&lt;/span&gt;&lt;span&gt;å¦‚æœè¾ƒé•¿æ—¶é—´æ²¡é¢è¯•ï¼Œå¯ä»¥å…ˆé¢ä¸€ä¸¤å®¶ç»ƒç»ƒæ‰‹ã€æ‰¾æ‰¾æ„Ÿè§‰ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“ç„¶ï¼Œæ•´ä¸ªé¢è¯•æ—¶é—´ä¹Ÿä¸å»ºè®®æ‹–å¾—å¤ªä¹…ï¼Œå¦åˆ™æ•´ä¸ªè¿‡ç¨‹ä¼šæ¯”è¾ƒç´¯ï¼Œæœ€å¥½è¿˜æ˜¯ä¸€é¼“ä½œæ°”ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å•°é‡Œå•°å—¦ä¸€å †ï¼Œå…¶å®é¢è¯•è¿˜æ˜¯æŒºçœ‹è¿æ°”çš„ï¼Œå¦‚æœè·Ÿé¢è¯•å®˜èŠå¾—æ¯”è¾ƒæŠ•æœºï¼Œå¯¹ä½ çš„è¯„åˆ†è‡ªç„¶ä¹Ÿä¸é”™ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ€åï¼Œé¢„ç¥æƒ³è·³æ§½çš„äº²ä»¬ä¸€è·¯ç»¿ç¯ï¼&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.5555555555555556&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_gif/ophTb90oYCR6eOZrkKMnznEahtiajNrSAicJDk24paw3VDzbZRLXgyibXWEuZ4qhuSgXoeFaqj1gpV96gVpZCHc7g/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;639&quot;/&gt;&lt;/p&gt;&lt;/section&gt;
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>b17c607b2c4ca2393d987c45c92e4f8a</guid>
<title>uni-app ä½¿ç”¨å‰çš„è°ƒç ”å’Œå¼€å‘å¿ƒå¾—</title>
<link>https://toutiao.io/k/wyg3rez</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p&gt;&lt;strong&gt;èƒŒæ™¯&lt;/strong&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;/p&gt;&lt;p line=&quot;CTTC&quot;&gt;&lt;span&gt;ä¹‹å‰çš„å·¥æ—¶ç³»ç»Ÿæ˜¯åŸç”Ÿçš„å°ç¨‹åºå®ç°ï¼Œç”±äºäº§å“é€»è¾‘éœ€è¦ä¼˜åŒ–ï¼Œä»£ç æ··ä¹±åˆä»…é™å¾®ä¿¡å¹³å°ä½¿ç”¨ï¼Œå…¬å¸è‡´åŠ›äºæƒ³ç»™å·¥æ—¶ç³»ç»Ÿé‡æ„åæ”¯æŒå¤šå¹³å°ï¼Œå¹¶å¯¹å¤–å¼€æ”¾ä½¿ç”¨ï¼Œä½¿ä¹‹æˆä¸ºä¸€æ¬¾çœŸæ­£çš„å•†ä¸šäº§å“ã€‚ç»è¿‡å‰æœŸè°ƒç ”åï¼Œuni-appå¯¹äºå¤šå¹³å°çš„æ”¯æŒæœ€å¥½ï¼Œä¸”æ˜“äºä¸Šæ‰‹ï¼Œäºæ˜¯é‡‡ç”¨è¯¥æ¡†æ¶å¯¹å·¥æ—¶ç³»ç»Ÿè¿›è¡Œæ”¹é€ ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;Hspc&quot;&gt;Â &lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;strong&gt;uni-appä»‹ç»&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p line=&quot;OuC6&quot;&gt;&lt;span&gt;uniï¼Œè¯» you niï¼Œæ˜¯ç»Ÿä¸€çš„æ„æ€ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;NS7n&quot;&gt;&lt;span&gt;å¾ˆå¤šäººä»¥ä¸ºå°ç¨‹åºæ˜¯å¾®ä¿¡å…ˆæ¨å‡ºçš„ï¼Œå…¶å®ï¼ŒDCloudæ‰æ˜¯è¿™ä¸ªè¡Œä¸šçš„å¼€åˆ›è€…ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;h9un&quot;&gt;&lt;span&gt;DCloudäº2012å¹´å¼€å§‹ç ”å‘å°ç¨‹åºæŠ€æœ¯ï¼Œä¼˜åŒ–webviewçš„åŠŸèƒ½å’Œæ€§èƒ½ï¼Œå¹¶åŠ å…¥W3Cå’ŒHTML5ä¸­å›½äº§ä¸šè”ç›Ÿï¼Œæ¨å‡ºäº†HBuilderå¼€å‘å·¥å…·ï¼Œä¸ºåç»­äº§ä¸šåŒ–åšå‡†å¤‡ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;07qC&quot;&gt;&lt;span&gt;2015å¹´ï¼ŒDCloudæ­£å¼å•†ç”¨äº†è‡ªå·±çš„å°ç¨‹åºï¼Œäº§å“åä¸ºâ€œæµåº”ç”¨â€ï¼Œå®ƒä¸æ˜¯B/Sæ¨¡å¼çš„è½»åº”ç”¨ï¼Œè€Œæ˜¯èƒ½æ¥è¿‘åŸç”ŸåŠŸèƒ½ã€æ€§èƒ½çš„åŠ¨æ€Appï¼Œå¹¶ä¸”å³ç‚¹å³ç”¨ã€‚ä¸ºå°†è¯¥æŠ€æœ¯å‘æ‰¬å…‰å¤§ï¼ŒDCloudå°†æŠ€æœ¯æ ‡å‡†æçŒ®ç»™å·¥ä¿¡éƒ¨æ——ä¸‹çš„HTML5ä¸­å›½äº§ä¸šè”ç›Ÿï¼Œå¹¶æ¨è¿›å„å®¶æµé‡å·¨å¤´æ¥å…¥è¯¥æ ‡å‡†ï¼Œå¼€å±•å°ç¨‹åºä¸šåŠ¡ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;wRSo&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;bPZM&quot;&gt;&lt;span&gt;åœ¨2015å¹´9æœˆï¼ŒDCloudæ¨è¿›å¾®ä¿¡å›¢é˜Ÿå¼€å±•å°ç¨‹åºä¸šåŠ¡ï¼Œæ¼”ç¤ºäº†æµåº”ç”¨çš„ç§’å¼€åº”ç”¨ã€æ‰«ç è·å–åº”ç”¨ã€åˆ†äº«é“¾æ¥è·å–åº”ç”¨ç­‰ä¼—å¤šåœºæ™¯æ¡ˆä¾‹ï¼Œä»¥åŠåˆ†äº«äº†webviewä½“éªŒä¼˜åŒ–çš„ç»éªŒã€‚å¾®ä¿¡å›¢é˜Ÿç»è¿‡åˆ†æï¼Œäº2016å¹´åˆå†³å®šä¸Šçº¿å°ç¨‹åºä¸šåŠ¡ï¼Œä½†å…¶æ²¡æœ‰æ¥å…¥è”ç›Ÿæ ‡å‡†ï¼Œè€Œæ˜¯è®¢åˆ¶äº†è‡ªå·±çš„æ ‡å‡†ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;EtWW&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;Xq53&quot;&gt;&lt;span&gt;DCloudæŒç»­åœ¨ä¸šå†…æ™®åŠå°ç¨‹åºç†å¿µï¼Œæ¨è¿›å„å¤§æµé‡å·¨å¤´ï¼ŒåŒ…æ‹¬æ‰‹æœºå‚å•†ï¼Œé™†ç»­ä¸Šçº¿ç±»ä¼¼å°ç¨‹åº/å¿«åº”ç”¨ç­‰ä¸šåŠ¡ã€‚éƒ¨åˆ†å…¬å¸æ¥å…¥äº†è”ç›Ÿæ ‡å‡†ï¼Œä½†æ›´å¤šå…¬å¸å› åˆ©ç›Šçº·äº‰ä¸¥é‡ï¼Œæ ‡å‡†éš¾ä»¥ç»Ÿä¸€ã€‚æŠ€æœ¯æ˜¯çº¯ç²¹çš„ï¼Œä¸åº”è¯¥å› ä¸ºå•†ä¸šåˆ©ç›Šè€Œåˆ†è£‚ã€‚å¼€å‘è€…é¢å¯¹å¦‚æ­¤å¤šçš„ç§æœ‰æ ‡å‡†ä¸æ˜¯ä¸€ä»¶æ­£ç¡®çš„äº‹æƒ…ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;Xq53&quot;&gt;&lt;/p&gt;&lt;p line=&quot;Mmyx&quot;&gt;&lt;span&gt;æ—¢ç„¶å„å·¨å¤´æ— æ³•åœ¨æ ‡å‡†ä¸Šè¾¾æˆä¸€è‡´ï¼Œé‚£ä¹ˆå°±é€šè¿‡è¿™ä¸ªæ¡†æ¶ä¸ºå¼€å‘è€…æŠ¹å¹³å„å¹³å°å·®å¼‚ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;IHSX&quot;&gt;&lt;span&gt;è¿™ï¼Œå°±æ˜¯uni-appçš„ç”±æ¥ã€‚&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å› ä¸ºå¤šå¹´ç§¯ç´¯ï¼Œæ‰€ä»¥DCloudæ‹¥æœ‰300å¤šä¸‡å¼€å‘è€…ï¼Œå¹¶ä¸æ„å¤–&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å› ä¸ºDCloudä¸€ç›´éƒ½æœ‰å°ç¨‹åºçš„iOSã€Androidå¼•æ“ï¼Œæ‰€ä»¥uni-appçš„Appç«¯å’Œå°ç¨‹åºç«¯ä¿æŒé«˜åº¦ä¸€è‡´ï¼Œå¹¶ä¸æ„å¤–&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å› ä¸ºDCloudåœ¨å¼•æ“ä¸Šçš„æŒç»­æŠ•å…¥ï¼Œæ‰€ä»¥uni-appçš„Appç«¯åŠŸèƒ½ã€æ€§èƒ½æ¯”å¤§å¤šæ•°å°ç¨‹åºå¼•æ“éƒ½ä¼˜ç§€ï¼Œå¹¶ä¸æ„å¤–&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å› ä¸ºDCloudå¯¹å„å®¶å°ç¨‹åºå¤ªäº†è§£äº†ï¼Œæ‰€ä»¥åšå¥½æŠ¹å¹³å„ç«¯å·®å¼‚çš„è·¨ç«¯æ¡†æ¶ï¼Œå¹¶ä¸æ„å¤–&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p line=&quot;D7Fs&quot;&gt;&lt;span&gt;ç°åœ¨ï¼Œuni-appå·²ç»æ˜¯ä¸šå†…æœ€é£é¡çš„åº”ç”¨æ¡†æ¶ï¼Œæ”¯æ’‘ç€6äº¿æ‰‹æœºç”¨æˆ·çš„åºå¤§ç”Ÿæ€ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;INsn&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;strong&gt;è¾ƒå…¶å®ƒè·¨å¹³å°æ¡†æ¶çš„ä¼˜åŠ¿&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;è·¨ç«¯æ•°é‡æ›´å¤š&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å¹³å°èƒ½åŠ›ä¸å—é™&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;æ€§èƒ½ä½“éªŒæ›´ä¼˜ç§€&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å‘¨è¾¹ç”Ÿæ€ä¸°å¯Œ&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å­¦ä¹ æˆæœ¬ä½&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å¼€å‘æˆæœ¬ä½&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p line=&quot;N3lu&quot;&gt;&lt;span&gt;å‡ å¤§è·¨å¹³å°å¼€å‘æ¡†æ¶æ€§èƒ½å’Œå…¼å®¹æ€§å¯¹æ¯”ï¼šå¾®ä¿¡åŸç”Ÿç‰ˆã€wepyç‰ˆã€mpvueç‰ˆã€taroç‰ˆã€uni-appç‰ˆã€chalemeonç‰ˆ https://github.com/dcloudio/test-framework&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;akqU&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;strong&gt;å‰ç½®æ¡ä»¶&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p line=&quot;iR4u&quot;&gt;&lt;span&gt;åŸºæœ¬ä¸Šæ˜¯&lt;span&gt;Vue&lt;/span&gt;å’Œ&lt;span&gt;å¾®ä¿¡å°ç¨‹åº&lt;/span&gt;çš„ç»“åˆï¼Œçœ‹äº†uni-appçš„ä»‹ç»å’ŒèƒŒæ™¯ï¼Œå°±çŸ¥é“ä¸ºä»€ä¹ˆå°ç¨‹åºçš„æ¥å£ç»„ä»¶å‘½åå’Œuni-appå‡ ä¹ä¸€æ ·äº†&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;BjgV&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;å¼€å‘å·¥å…·&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p line=&quot;dVmT&quot;&gt;&lt;span&gt;HBuilderXÂ ï¼ˆè½»å¦‚ç¼–è¾‘å™¨ï¼Œå¼ºå¦‚IDEï¼‰ï¼Œå®˜æ–¹IDEä¸‹è½½åœ°å€&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;å¯è§†åŒ–çš„æ–¹å¼æ¯”è¾ƒç®€å•ï¼ŒHBuilderXÂ å†…ç½®ç›¸å…³ç¯å¢ƒï¼Œå¼€ç®±å³ç”¨ï¼Œæ— éœ€é…ç½®nodeÂ ï¼Œå†…ç½®æµè§ˆå™¨åŠæ—¶é¢„è§ˆï¼Œæ›´å¤šåŠŸèƒ½å¯é€šè¿‡æ’ä»¶å®ç°&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å¦‚æœä½ ä¹‹å‰ä¹ æƒ¯äº†ä½¿ç”¨å…¶å®ƒçš„å¦‚VS codeã€Sublime Textç¼–è¾‘å™¨ï¼Œåœ¨å·¥å…·æ é‡Œå¯ä»¥é€‰æ‹©é¢„è®¾å¿«æ·é”®æ–¹æ¡ˆåˆ‡æ¢é‡Œé€‰æ‹©å¯¹åº”çš„å·¥å…·ç±»å‹ï¼Œå‡ ä¹æ— æˆæœ¬å°±ä¸Šæ‰‹äº†&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å·¥å…·é‡Œå†…åµŒäº†å¼ºå¤§çš„ä»£ç å—åŠŸèƒ½ï¼Œé€šè¿‡é¢„è®¾çš„å˜é‡ç”ŸæˆæŸä¸€æ®µä»£ç ï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ä»£ç å—æ•™ç¨‹å­¦ä¹ å¦‚ä½•ç”Ÿæˆä½ è‡ªå·±çš„ä»£ç å—ï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šçš„æ—¶é—´&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;åˆ›å»ºé¡¹ç›®æ—¶å¯ä»¥é€‰æ‹©ä½ çš„åº”ç”¨ç±»å‹ï¼Œç”Ÿæˆé»˜è®¤æ¨¡ç‰ˆ&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œåœ¨å·¥å…·æ çš„è¿è¡Œ&lt;span&gt;-&amp;gt; è¿è¡Œåˆ°å°ç¨‹åºæ¨¡æ‹Ÿå™¨ -&amp;gt; å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œé¦–æ¬¡éœ€è¦é…ç½®å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„å®‰è£…è·¯å¾„ï¼Œç„¶åç‚¹å‡»è¿è¡Œå³å¯è°ƒèµ·å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼ˆ&lt;/span&gt;&lt;span&gt;å¦‚æœå‡ºç°è°ƒä¸èµ·æ¥çš„æƒ…å†µï¼Œè¯·åˆ°å¾®ä¿¡å¼€å‘è€…å·¥å…·è®¾ç½®èœå•-&amp;gt;å®‰å…¨è®¾ç½®é‡ŒæŠŠæœåŠ¡ç«¯å£å¼€å¯&lt;/span&gt;&lt;span&gt;ï¼‰ï¼›æ–°å»ºé¡¹ç›®ç›®å½•ä¸æ˜¯é€‰æ‹©uni-appçš„é¡¹ç›®æ ¹ç›®å½•ï¼Œé€‰æ‹©çš„æ˜¯æ ¹ç›®å½•ä¸‹é¢çš„unpackage-&amp;gt;dist-&amp;gt;dev-&amp;gt;mp-weixinï¼Œè¿è¡Œçš„æ˜¯ç¼–è¯‘åçš„ä»£ç &lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å»ºè®®å¹³æ—¶å¼€å‘é€‰æ‹©å†…åµŒæµè§ˆå™¨è¿›è¡ŒåŠæ—¶é¢„è§ˆï¼Œä¿®æ”¹åŠç”Ÿæ•ˆï¼Œè¿˜å¯ä»¥é€šè¿‡æ‰«æåœ°å€æ ä¸Šæ–¹çš„äºŒç»´ç åœ¨æ‰‹æœºä¸Šé¢„è§ˆï¼ˆå¿…é¡»è¿çš„æ˜¯åŒä¸€ä¸ªå±€åŸŸç½‘ï¼‰ï¼Œè°ƒè¯•å’Œæµè§ˆå™¨ä¸€æ ·æ‰“å¼€å®¡æŸ¥å…ƒç´ &lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p line=&quot;QG1a&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;å¼ºå¤§çš„å¼€å‘è€…ç”Ÿæ€&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p line=&quot;ulDD&quot;&gt;&lt;span&gt;uni-appæ‹¥æœ‰ä¸°å¯Œçš„æ’ä»¶å¸‚åœºï¼Œè¿™é‡Œéƒ½æ˜¯å¼€å‘è€…è´¡çŒ®çš„æ’ä»¶ï¼Œè®©å¼€å‘æ›´é«˜æ•ˆï¼Œä¸å¿…é‡å¤é€ è½®å­ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ºå¼€æºè´¡çŒ®å‚ä¸å…¶ä¸­ï¼Œè¯¦æƒ…è§æ’ä»¶å¼€å‘æŒ‡å—ï¼ŒåŒæ—¶&lt;span&gt;å…¼å®¹ NPM åŒ…ç®¡ç†ç³»ç»Ÿ uni-appå®Œæ•´æ”¯æŒ NPM ï¼Œ&lt;/span&gt;æ´»è·ƒçš„ç¤¾åŒºæ°›å›´ï¼Œæœ‰é—®é¢˜æˆ–è€…äº¤æµå¯ä»¥å»ç¤¾åŒºå‘å¸–&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;1PD2&quot;&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;å¦‚ä½•å®ç°ä¼˜é›…çš„è·¨ç«¯&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p line=&quot;X4Fi&quot;&gt;&lt;span&gt;ä¸åŒå¹³å°ç‰¹æœ‰çš„APIæ”¯æŒæ¡ä»¶ç¼–è¯‘ï¼Œåœ¨ C è¯­è¨€ä¸­ï¼Œé€šè¿‡ #ifdefã€#ifndef çš„æ–¹å¼ï¼Œä¸º windowsã€mac ç­‰ä¸åŒ os ç¼–è¯‘ä¸åŒçš„ä»£ç ï¼Œuni-app å‚è€ƒè¿™ä¸ªæ€è·¯ï¼Œä¸º uni-app æä¾›äº†æ¡ä»¶ç¼–è¯‘æ‰‹æ®µï¼Œåœ¨ä¸€ä¸ªå·¥ç¨‹é‡Œä¼˜é›…çš„å®Œæˆäº†å¹³å°ä¸ªæ€§åŒ–å®ç° ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;saM0&quot;&gt;&lt;span&gt;æ¡ä»¶ç¼–è¯‘æ˜¯åˆ©ç”¨æ³¨é‡Šå®ç°çš„ï¼Œåœ¨ä¸åŒè¯­æ³•é‡Œæ³¨é‡Šå†™æ³•ä¸ä¸€æ ·ï¼š&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;3X3V&quot;&gt;&lt;span&gt;jsä½¿ç”¨Â &lt;span&gt;// æ³¨é‡Š&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;nWy5&quot;&gt;&lt;span&gt;css ä½¿ç”¨Â &lt;span&gt;/* æ³¨é‡Š */&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;B6Ta&quot;&gt;&lt;span&gt;vue/nvue æ¨¡æ¿é‡Œä½¿ç”¨Â &lt;span&gt;&amp;lt;!-- æ³¨é‡Š --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;r4k7&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;rulU&quot;&gt;&lt;span&gt;&lt;strong&gt;uni-appä¹Ÿæ˜¯æ”¯æŒé’‰é’‰å°ç¨‹åºçš„ï¼Œè°ƒè¯•å·¥å…·ç”¨çš„æ˜¯æ”¯ä»˜å®å¼€å‘è€…å·¥å…·ï¼Œåœ¨è¿è¡Œèœå•é‡ŒåŸæœ¬æ²¡æœ‰é’‰é’‰è¿™ä¸€é¡¹ï¼Œéœ€è¦å¢åŠ æ‹“å±•ï¼Œæ–¹æ³•å‚è§&lt;/strong&gt;https://ask.dcloud.net.cn/article/36353&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;1RFB&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;uni-appå¼€å‘è¾ƒåŸç”Ÿå¼€å‘å¯¹æ¯”&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p line=&quot;HBGP&quot;&gt;&lt;span&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;ç›®å½•ç»“æ„æ¸…æ™°ï¼Œé¡µé¢æ–‡ä»¶ç”±åŸæ¥çš„wxmlï¼Œwxssï¼Œjsonï¼Œjså››ä¸ªæ–‡ä»¶å˜æˆç°åœ¨çš„ä¸€ä¸ªvueæ–‡ä»¶&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ”¯æŒscsså’Œlesså†™æ³•ï¼Œé€šè¿‡å®ƒçš„å˜é‡ã€ç»§æ‰¿ã€åµŒå¥—ã€è¿ç®—ç­‰ç‰¹æ€§å’Œå‡½æ•°å¢åŠ csså¼€å‘æ•ˆç‡ï¼Œå‡å°‘ä»£ç é‡&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;åœ¨uni-appä¸­å¯ä»¥é€šè¿‡vuexæ’ä»¶æ¥å…¨å±€ç®¡ç†æ•°æ®&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p line=&quot;FW0L&quot;&gt;&lt;span&gt;&lt;strong&gt;åŠ£åŠ¿&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;ç¼–è¯‘è°ƒè¯•æ¯”è¾ƒéº»çƒ¦ï¼Œç¼–è¯‘æ—¶é—´é•¿ï¼Œç¼–è¯‘ä¸€æ¬¡æœ¬åœ°ç¼“å­˜æ•°æ®è¢«æ¸…é™¤ï¼Œéœ€è¦ç™»é™†å’Œç¼“å­˜çš„è¿‡ç¨‹å¯¹äºè°ƒè¯•å¢åŠ äº†æ—¶é—´æˆæœ¬&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å¤šå¹³å°å‘å¸ƒéœ€è¦å¤šå†™ä¸€äº›æ¡ä»¶ç¼–è¯‘ä»£ç ï¼Œè¦äº†è§£å„å¹³å°çš„å·®å¼‚æ€§&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;åŸç”Ÿå¼€å‘å®šä¹‰å…¨å±€å˜é‡å’Œæ–¹æ³•å¯åœ¨app.jsä¸­ç›´æ¥å®šä¹‰ï¼Œå…¨å±€å˜é‡ä¸€èˆ¬ç”¨globalDataè¡¨ç¤ºï¼Œuni-appä¸­å‡ ç§å¸¸è§çš„å®ç°æ–¹å¼æœ‰ï¼š&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p line=&quot;k8Ov&quot;&gt;&lt;strong&gt;&lt;span&gt;å…¬ç”¨æ¨¡å—&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p line=&quot;k8Ov&quot;&gt;&lt;/p&gt;&lt;p line=&quot;yDCN&quot;&gt;&lt;span&gt;å®šä¹‰ä¸€ä¸ªå…¬ç”¨çš„æ¨¡å—ï¼Œç”¨æ¥ç»„ç»‡å’Œç®¡ç†è¿™äº›å…¨å±€çš„å˜é‡ï¼Œåœ¨éœ€è¦çš„é¡µé¢å¼•å…¥ï¼Œä¸€èˆ¬æ”¾åœ¨æ ¹ç›®å½•ä¸‹commonç›®å½•é‡Œï¼Œç„¶åç”¨çš„æ—¶å€™åœ¨é¡µé¢ä¸­å¼•å…¥è¯¥æ¨¡å—ï¼Œè¿™ç§æ–¹å¼ç»´æŠ¤èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯ç”¨çš„æ—¶å€™æ¯æ¬¡éƒ½å¾—å¼•å…¥&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;Scfr&quot;&gt;&lt;span&gt;&lt;strong&gt;æŒ‚è½½åˆ°Vue.prototype&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;cuDl&quot;&gt;&lt;span&gt;åœ¨main.jsä¸­æŒ‚è½½å±æ€§/æ–¹æ³•&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;javascript&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;import req from &#x27;./api/index&#x27;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;import util from &#x27;./utils/util&#x27;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;Vue.prototype.api = &#x27;http://uniapp.dcloud.io&#x27;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;Vue.prototype.now = Date.now || function () {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  return new Date().getTime();&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;};&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;Vue.prototype.$api = req&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;Vue.prototype.$util = util&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;pre&gt;&lt;br/&gt;&lt;/pre&gt;&lt;p line=&quot;ARrh&quot;&gt;&lt;span&gt;å¼•ç”¨çš„æ—¶å€™&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;script&amp;gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  export default {  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    data() {  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        return {};  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    },  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    onLoad(){&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        console.log(&#x27;now:&#x27; + this.now());&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    },  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    methods: {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;      getProjectWorktime(userId, workDay) {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    this.$api.wktime.getWktimeStatus(userId,&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;          {workDay: workDay}).then(res =&amp;gt; {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;            console.log(res)&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;          })&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;      }&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    }&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;pre&gt;&lt;br/&gt;&lt;/pre&gt;&lt;p line=&quot;Dlmt&quot; linespacing=&quot;115&quot;&gt;&lt;span&gt;&lt;strong&gt;globalDataå®šä¹‰å…¨å±€å˜é‡&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;Dlmt&quot; linespacing=&quot;115&quot;&gt;&lt;/p&gt;&lt;p line=&quot;PuQB&quot;&gt;&lt;span&gt;å°ç¨‹åºä¸­æœ‰ä¸ªglobalDataæ¦‚å¿µï¼Œå¯ä»¥åœ¨ App ä¸Šå£°æ˜å…¨å±€å˜é‡ã€‚Vue ä¹‹å‰æ˜¯æ²¡æœ‰è¿™ç±»æ¦‚å¿µçš„ï¼Œä½† uni-app å¼•å…¥äº†globalDataæ¦‚å¿µï¼Œå¹¶ä¸”åœ¨åŒ…æ‹¬H5ã€Appç­‰å¹³å°éƒ½å®ç°äº†ã€‚åœ¨ App.vue å¯ä»¥å®šä¹‰ globalData ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ API è¯»å†™è¿™ä¸ªå€¼ã€‚&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;script&amp;gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  export default {  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    globalData: {  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;        text: &#x27;text&#x27;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    }&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  }  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;pre&gt;&lt;br/&gt;&lt;/pre&gt;&lt;p line=&quot;OhNR&quot;&gt;&lt;span&gt;åœ¨å…¶å®ƒé¡µé¢ä¸­å–å€¼çš„æ–¹å¼&lt;/span&gt;&lt;/p&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;css&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;getApp().globalData.text&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p line=&quot;kNAz&quot;&gt;&lt;span&gt;&lt;strong&gt;uni-appçš„æœ¬åœ°å­˜å‚¨&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;kNAz&quot;&gt;&lt;/p&gt;&lt;p line=&quot;VliU&quot;&gt;&lt;span&gt;uni.storageçš„é”®å€¼å¯¹å­˜å‚¨ï¼Œè¿™ä¸ªæ˜¯å…¨ç«¯æ”¯æŒçš„ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;95Tz&quot;&gt;&lt;span&gt;uni-appçš„Storageåœ¨ä¸åŒç«¯çš„å®ç°ä¸åŒï¼Œuni.storageåœ¨appä¾§ï¼Œæ˜ å°„ä¸ºplus.storageï¼›h5ä¾§æ˜ å°„ä¸ºlocalstorageï¼›å„ä¸ªå°ç¨‹åºå¹³å°æ˜ å°„ä¸ºå…¶è‡ªå¸¦çš„storageé”®å€¼å¯¹å­˜å‚¨ï¼š&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;H5ç«¯ä¸ºlocalStorageï¼Œæµè§ˆå™¨é™åˆ¶5Må¤§å°ï¼Œæ˜¯ç¼“å­˜æ¦‚å¿µï¼Œå¯èƒ½ä¼šè¢«æ¸…ç†&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Appç«¯ä¸ºåŸç”Ÿçš„plus.storageï¼Œæ— å¤§å°é™åˆ¶ï¼Œä¸æ˜¯ç¼“å­˜ï¼ŒæŒä¹…åŒ–&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å„ä¸ªå°ç¨‹åºç«¯ä¸ºå…¶è‡ªå¸¦çš„storage apiï¼Œæ•°æ®å­˜å‚¨ç”Ÿå‘½å‘¨æœŸè·Ÿå°ç¨‹åºæœ¬èº«ä¸€è‡´ï¼Œå³é™¤ç”¨æˆ·ä¸»åŠ¨åˆ é™¤æˆ–è¶…è¿‡ä¸€å®šæ—¶é—´è¢«è‡ªåŠ¨æ¸…ç†ï¼Œå¦åˆ™æ•°æ®éƒ½ä¸€ç›´å¯ç”¨ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;å¾®ä¿¡å°ç¨‹åºå•ä¸ª key å…è®¸å­˜å‚¨çš„æœ€å¤§æ•°æ®é•¿åº¦ä¸º 1MBï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨ä¸Šé™ä¸º 10MBã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ”¯ä»˜å®å°ç¨‹åºå•æ¡æ•°æ®è½¬æ¢æˆå­—ç¬¦ä¸²åï¼Œå­—ç¬¦ä¸²é•¿åº¦æœ€å¤§200*1024ã€‚åŒä¸€ä¸ªæ”¯ä»˜å®ç”¨æˆ·ï¼ŒåŒä¸€ä¸ªå°ç¨‹åºç¼“å­˜æ€»ä¸Šé™ä¸º10MBã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;ç™¾åº¦ã€å¤´æ¡å°ç¨‹åºæ–‡æ¡£æœªè¯´æ˜å¤§å°é™åˆ¶&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p line=&quot;wOZ7&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;span&gt;å¸¸è§çš„å¹³å°å·®å¼‚å¤„ç†ï¼ˆç›®å‰ä»…å¯¹å¾®ä¿¡å°ç¨‹åºå’ŒH5ï¼‰&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;H5é¡µé¢åº•éƒ¨èœå•æ˜¯åŒ…å«åœ¨é¡µé¢é«˜åº¦å†…çš„ï¼Œå¦‚æœpostionç½®ä¸ºfixedçš„è¯ï¼Œ&lt;span&gt;bottom: 0;Â &lt;/span&gt;&lt;span&gt;éœ€è¦å†™æˆ&lt;/span&gt;&lt;span&gt;bottom: var(--window-bottom);&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ç™»é™†é€»è¾‘éœ€è¦ç”¨åœ¨æ¨¡ç‰ˆé‡Œæ’å…¥æ¡ä»¶ç¼–è¯‘ï¼Œé€»è¾‘é‡Œéœ€è¦æ³¨å…¥ä¸åŒçš„ç™»é™†æ–¹æ³•&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;!-- #ifdef H5 --&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;H5ç™»é™†&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;!-- #endif --&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;!-- #ifndef H5 --&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;å…¶å®ƒå¹³å°ç™»é™†&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;!-- #endif --&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;pre&gt;&lt;br/&gt;&lt;/pre&gt;&lt;ol start=&quot;3&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;éH5ç«¯é»˜è®¤å¹¶æœªå¯ç”¨ scopedï¼Œå¦‚éœ€è¦éš”ç¦»ç»„ä»¶æ ·å¼å¯ä»¥åœ¨ style æ ‡ç­¾å¢åŠ  scoped å±æ€§ï¼ŒH5ç«¯ä¸ºäº†éš”ç¦»é¡µé¢é—´çš„æ ·å¼é»˜è®¤å¯ç”¨äº† scoped&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;åœ¨æ‰€æœ‰çš„tabbaré¡µé¢è·³è½¬éƒ½è¦ç”¨navigateto,æ¥ç¡®ä¿tabbarçš„listä¸å‘ç”Ÿä»»ä½•æ”¹å˜ï¼Œè€Œå°ç¨‹åºä¸å—å½±å“ï¼ˆ&lt;/span&gt;&lt;span&gt;å‡ºç°çš„å¼‚å¸¸æ˜¯åœ¨h5ä¸­tabbaré¡µé¢ç”¨redirectè·³è½¬åˆ°étabbaré¡µé¢ï¼Œåº•éƒ¨èœå•ä»å­˜åœ¨&lt;/span&gt;&lt;span&gt;ï¼‰&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p line=&quot;zODt&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;å‘å¸ƒæ³¨æ„äº‹é¡¹&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p line=&quot;TWZR&quot;&gt;&lt;span&gt;uni-appå„ç«¯èƒ½è¿è¡Œçš„æ˜¯ç¼–è¯‘åçš„ä»£ç ï¼Œæ–‡ä»¶ä½äºæ ¹ç›®å½•ä¸‹unpackage-&amp;gt;dist-&amp;gt;build/devï¼Œbuildç›®å½•æ˜¯å‘å¸ƒçš„ä»£ç ï¼Œdevæ˜¯æœ¬åœ°é¢„è§ˆçš„ä»£ç &lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;bz7C&quot;&gt;&lt;span&gt;&lt;strong&gt;H5ç«¯å‘å¸ƒï¼š&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;ç‚¹å‡»å‘è¡Œ-&amp;gt;ç½‘ç«™-H5æ‰‹æœºç‰ˆï¼Œéœ€è¦é…ç½®ç½‘ç«™åŸŸåï¼Œç¼–è¯‘åˆ°ä»£ç ä¸­è§£å†³æ¥å£è¯·æ±‚è·¨åŸŸçš„é—®é¢˜&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;æ ¹ç›®å½•ä¸‹manifest.jsonæ–‡ä»¶å…³äºh5é…ç½®ï¼Œæ³¨æ„é€‰æ‹©è·¯ç”±æ¨¡å¼ï¼Œhashå’Œhistoryï¼Œè¿è¡Œçš„åŸºç¡€è·¯å¾„ï¼Œå°±æ˜¯åŸŸåè§£æå¯¹åº”çš„æœåŠ¡å™¨ä¸Šé¡¹ç›®çš„ç›®å½•&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p line=&quot;re2C&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;&lt;h2/&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;æ€è€ƒåŠæ„Ÿæƒ³&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p line=&quot;OsYs&quot;&gt;&lt;span&gt;ä¹‹å‰å¬è¿‡ä¸€ä¸ªå¤§ä½¬çš„ä¸€å¥è¯ï¼šå¦‚æœæˆ‘åªèƒ½ç»™å…¶ä»–ç¨‹åºå‘˜ä¸€ä¸ªå»ºè®®ï¼Œé‚£å°±æ˜¯ç¼–å†™å°çš„ä»£ç å—ï¼Œä½ è¦å¤šå†™å°æ–¹æ³•ã€å°åŠŸèƒ½ã€å°ç¨‹åºã€‚å†™å®Œä¸æ–­æ€è€ƒå¦‚ä½•ç²¾ç®€ä½ çš„ä»£ç ï¼Œå¦‚ä½•å®Œå–„ä½ çš„é€»è¾‘ï¼Œåªæœ‰åŸºæœ¬åŠŸæ‰å®äº†ï¼Œä½ æ‰èƒ½åœ¨å¤§çš„ç³»ç»Ÿå’Œç¨‹åºé‡Œæ¸¸åˆƒæœ‰ä½™ã€‚&lt;/span&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>42bc75cd64241cbc794bf5403b6e3c09</guid>
<title>[è¯‘] ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç”¨æ•°æ®åº“ç”Ÿæˆ IDï¼Ÿ</title>
<link>https://toutiao.io/k/v3hruzg</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p&gt;&lt;strong&gt;å…ˆä»‹ç»ä¸€ä¸‹èƒŒæ™¯Â ğŸ”­&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;å›¢é˜Ÿæ­£åœ¨ä¸€ä¸ªä¸º SQL Server æ„å»ºæ•°æ®ç›®å½•é¡¹ç›®çš„å†ç¨‹ä¸­ï¼Œæˆ‘ä»¬&lt;strong&gt;ä¼˜åŒ–ç³»ç»Ÿä»¥å®ç°è§£è€¦&lt;/strong&gt;ã€‚è¿™å¯¹æˆ‘ä»¬æ¥è¯´éå¸¸é‡è¦ï¼Œä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼Œæˆ‘å½’ç»“ä¸ºä¸¤ä¸ªæ ¸å¿ƒåŸåˆ™ï¼Œå¸Œæœ›æ¯ä¸ªè½¯ä»¶ä¸“ä¸šäººå‘˜éƒ½èƒ½è®¤åŒï¼š&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ä¸‹é¢æ˜¯ protoactor-go å¼€æºé¡¹ç›®é‡Œçš„ä¸€å¥è¯ â€œsoftware should be composed, not builtâ€ï¼Œä¸æˆ‘è¦åœ¨æœ¬æ–‡é™ˆè¿°çš„è§‚ç‚¹éå¸¸ç›¸ä¼¼ï¼š&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.6776429809358753&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/8XkvNnTiapOPic8xZ6eSB2CCoNIUrBPVMM8XsiafXfgc6K1EqrLF71ibMqcKC2Ffbwa6vxZ4c2tj2rtqrwP2wDhLRQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1154&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;å¯¹æŒä¹…åŒ–æœ‰ä½•å½±å“ï¼ŸğŸ¤”&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;è€ƒè™‘åˆ°å‰é¢æ€»ä½“åŸåˆ™ï¼Œæˆ‘ä»¬ä¸æƒ³æŠŠè‡ªå·±çš„çŠ¶æ€æŒä¹…åŒ–è€¦åˆåˆ°ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“å¼•æ“ä¸Šã€‚ä»å®é™…æƒ…å†µæ¥çœ‹ï¼Œå°±æ˜¯è¯´ä¸å°†æŒä¹…åŒ–çš„å…·ä½“å…³æ³¨ç‚¹ä¼ é€’åˆ°é¢†åŸŸå±‚ã€‚ä¹‹æ‰€ä»¥è¦å®ç°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬ä»Šå¤©å¯¹è§„åˆ™çš„è®¤çŸ¥å¯èƒ½ä¼šè®©æˆ‘ä»¬ä¾èµ–æŸç§å…·ä½“æ•°æ®åº“æŠ€æœ¯ï¼Œæ¯”å¦‚ SQL Serverï¼Œä½†å¹¶ä¸èƒ½ç¡®ä¿å®ƒèƒ½æ»¡è¶³æœªæ¥çš„èƒ½åŠ›éœ€æ±‚ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;æœ‰äº†è¿™ä¸ªå…·ä½“çš„è¦æ±‚ï¼ŒæŒä¹…åŒ–å°±éœ€è¦å‡ºç°åœ¨åŸŸäº‹ä»¶è€Œä¸æ˜¯å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œè¿™ä¹Ÿå¯¼è‡´ä¸åŒçš„å­˜å‚¨éœ€æ±‚ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€äº›å¹¿ä¸ºäººçŸ¥çš„ã€ç»è¿‡å®æˆ˜æ£€éªŒçš„æ¨¡å¼å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚ç»“åˆ CQRS é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸­çš„èšåˆè®¾è®¡ç­‰ã€‚å› æ­¤è¿™é‡Œçš„å‡è®¾æ˜¯ï¼Œå®ç°ç†æƒ³çŠ¶æ€å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä½æˆæœ¬çš„ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;ä»£ç ç”Ÿæˆ ID è¿˜æ˜¯æ•°æ®åº“ç”Ÿæˆ ID ğŸ”¬&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;è®¸å¤šæ•°æ®å­˜å‚¨ç³»ç»Ÿï¼ˆå¦‚ SQL Serverï¼‰éƒ½å…·å¤‡ä¸ºæ¯æ¡è®°å½•ï¼ˆå¦‚è¡Œã€æ–‡æ¡£ç­‰ï¼‰ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦çš„æ–¹æ³•ã€‚å½“å°†æ–°è®°å½•æ’å…¥è¡¨ä¸­æ—¶ï¼Œä½¿ç”¨è‡ªåŠ¨å¢é‡é”®å¯ä»¥ç”Ÿæˆå”¯ä¸€ç¼–å·ã€‚å½“æˆ‘ä»¬è¦æ’å…¥ä¸€æ¡æ–°è®°å½•æ—¶ï¼Œæ•°æ®åº“å¼•æ“å°±è‡ªåŠ¨å®Œæˆè‡ªå¢ä¸»é”®ï¼Œå¹¶ä¸”å¯ä»¥ç¡®ä¿è¯¥é”®å¯¹äºè¡¨æ˜¯å”¯ä¸€çš„ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;ä½†æ˜¯å¦‚æœä¾èµ–æ•°æ®åº“æ¥ä¸ºæˆ‘ä»¬ä¸šåŠ¡åŸŸç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè¿™å°†è®©&lt;strong&gt;ä¸šåŠ¡å±‚ä¸æ•°æ®å­˜å‚¨ç³»ç»Ÿè€¦åˆåœ¨ä¸€èµ·&lt;/strong&gt;ã€‚å¦‚æœæˆ‘ä»¬æƒ³åˆ‡æ¢ä¸€ä¸ªä¸æ”¯æŒç”Ÿæˆè‡ªåŠ¨å¢é‡ä¸»é”®çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œé‚£å°±ä¸èƒ½ç®€å•æ›´æ¢ã€‚è€Œä¸”ï¼Œæ¯ä¸ªæ•°æ®å­˜å‚¨ç³»ç»Ÿç”Ÿæˆæ ‡è¯†ç¬¦çš„æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬æœ€ç»ˆä½¿ç”¨ä¸åŒçš„ä¸»é”®ç±»å‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™äº›ç±»å‹çš„ç”Ÿæˆæ–¹å¼å¯èƒ½ä¸é€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬åœ¨ SQL Server æ•°æ®åº“ä¸­æ‹¥æœ‰ä¸€ä¸ªç”Ÿæˆä¸»é”®çš„è¡¨æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­æ°´å¹³æ‰©å±•è¿™ä¸ªè¡¨ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;é€šè¿‡è®©ä¸šåŠ¡åŸŸçš„æ¶ˆè´¹è€…ï¼ˆå³é€šè¿‡å‘½ä»¤å’ŒæŸ¥è¯¢ä¸åŸŸé€šä¿¡çš„ä¼ è¾“å±‚ï¼‰è´Ÿè´£å”¯ä¸€é”®çš„æ ‡è¯†ç¬¦ç”Ÿæˆ&lt;/strong&gt;ï¼Œå°±å¯ä»¥å…‹æœè¿™äº›é—®é¢˜ã€‚å®ƒå‡å°‘å¯¹ç¯å¢ƒçš„ä¾èµ–æ€§ï¼Œåˆåè¿‡æ¥è®©æˆ‘ä»¬ä¸ç”¨ä¾èµ–æ•°æ®åº“æ¥ç”Ÿæˆ Idã€‚è¿™ç§æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼šå®ƒå¯ä»¥æ”¯æŒåˆ†å¸ƒå¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªè¡¨åˆ†åŒºåˆ°ä¸¤ä¸ªç‰©ç† SQL Serverä¸Šï¼Œå¹¶åˆ†æ‹…æŸ¥è¯¢çš„è¯·æ±‚ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè‡ªåŠ¨å¢é‡çš„å­—æ®µï¼Œè¿™åœ¨ SQL Server ä¸Šå°±ä¸è¡Œäº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;æˆ‘ä»¬å†³å®šåšä»€ä¹ˆï¼ŸğŸš€&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;åŸºäºè¿™äº›äº‹å®ï¼Œæˆ‘ä»¬å†³å®šè®©ä¸šåŠ¡åŸŸå±‚æ¥ç”ŸæˆåŸŸé›†åˆçš„æ ‡è¯†ç¬¦ã€‚æˆ‘ä»¬åœ¨åŸŸå±‚å†…å°†è¿™äº›æ ‡è¯†ç¬¦è¡¨ç¤ºä¸º 64 ä½æ— ç¬¦å·æ•´æ•°ã€‚åŸŸæ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸Šä¸‹æ–‡è‡ªç”±å†³å®šåº”è¯¥ç”¨ä»€ä¹ˆè¡¨ç¤ºæ–¹å¼ï¼ˆä¾‹å¦‚ASP.NET Core MVC å¯ä»¥å°†æ ‡è¯†ç¬¦åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œä»¥ä¾¿äºå…¶å®¢æˆ·ç«¯æ¶ˆè´¹èµ„æºå¯¹è±¡ç­‰ï¼‰ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆè¦ 64 ä½æ•´å‹ï¼Œè€Œä¸æ˜¯ UUIDï¼Ÿ&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;æœ€åï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆä½¿ç”¨64ä½æ•´æ•°ã€‚æ­¤å¤„çš„ä¸»è¦ç›®çš„æ˜¯ä½¿æˆ‘ä»¬èƒ½å¤Ÿç”šè‡³è·¨èšåˆæ ¹ç”Ÿæˆå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚&lt;span&gt;è€ƒè™‘åˆ°å‡ ä¹æ¯ä¸ªå¹³å°éƒ½æœ‰å¯¹åº”çš„ APIï¼ŒUUID æ˜¯éå¸¸æ–¹ä¾¿çš„è°ƒç”¨æ–¹å¼ï¼ˆä¾‹å¦‚ .NET ä¸­ Guid.NewGuid() ç­‰ï¼‰ã€‚&lt;/span&gt;&lt;strong&gt;&lt;span&gt;UUID æœ€å¤§çš„é—®é¢˜æ˜¯å­˜å‚¨å’Œç´¢å¼•æ–¹é¢çš„æˆæœ¬ä¸å¼€é”€&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;ï¼Œè™½ç„¶å¯¹æˆ‘ä»¬æ¥è¯´ä¸æ˜¯å¤§é—®é¢˜ã€‚ä¸è¿‡ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå·²ç»æœ‰ä¸€äº›æˆç†Ÿçš„æ–¹æ³•æ¥ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ä½œä¸ºæ›´é«˜æ•ˆçš„ä¸»é”®ç±»å‹ï¼Œæ¯”å¦‚ä½¿ç”¨ 64 ä½æ•´æ•°ã€‚Twitter Snowflake (1) ç®—æ³•å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œè¿™è®©æˆ‘ä»¬é€‰æ‹©äº† 64 ä½æ•´æ•°è€Œä¸æ˜¯ UUIDã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Rob Janssen çš„å¼€æº IdGen (2) åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€‚ç”¨äº .NET çš„ Twitter Snowflake ç±»å‹çš„ ID ç”Ÿæˆå™¨ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;(1)Â https://developer.twitter.com/en/docs/basics/twitter-ids.html&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;(2) https://github.com/RobThree/IdGen&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;è‹±æ–‡åŸæ–‡ï¼š&lt;/p&gt;&lt;p&gt;&lt;span&gt;https://medium.com/ingeniouslysimple/why-did-we-shift-away-from-database-generated-ids-7e0e54a49bb3&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;å‚è€ƒé˜…è¯»ï¼š&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;æœ¬æ–‡ç”±é«˜å¯ç”¨æ¶æ„ç¿»è¯‘ï¼ŒæŠ€æœ¯åŸåˆ›åŠæ¶æ„å®è·µæ–‡ç« ï¼Œæ¬¢è¿é€šè¿‡å…¬ä¼—å·èœå•ã€Œè”ç³»æˆ‘ä»¬ã€è¿›è¡ŒæŠ•ç¨¿ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;é«˜å¯ç”¨æ¶æ„&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;æ”¹å˜äº’è”ç½‘çš„æ„å»ºæ–¹å¼&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;img data-w=&quot;200&quot; data-type=&quot;jpeg&quot; data-s=&quot;300,640&quot; data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/8XkvNnTiapOPOK9rQud9XibGhPOPsA3gA8Wr4CEnzmhfZQzSGu0Q09GOuk18S9icZtuVnQewvyqZtOWyDnJPBDn1A/640?wx_fmt=jpeg&quot;/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>1bd682e484ac1e882ceebfa2b9d1c779</guid>
<title>Go å¹¶å‘ç¼–ç¨‹ï¼ˆä¹ï¼‰ï¼šæ·±å…¥ç†è§£ Context</title>
<link>https://toutiao.io/k/h3qtyq7</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;markdown-body&quot;&gt;&lt;blockquote&gt;&lt;p&gt;æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 id=&quot;æ¥”å­&quot;&gt;&lt;a href=&quot;#æ¥”å­&quot; class=&quot;headerlink&quot; title=&quot;æ¥”å­&quot;/&gt;æ¥”å­&lt;/h2&gt;&lt;p&gt;åœ¨ &lt;a href=&quot;https://lailin.xyz/post/go-training-week3-waitgroup.html&quot;&gt;Week03: Go å¹¶å‘ç¼–ç¨‹(å…­) æ·±å…¥ç†è§£ WaitGroup&lt;/a&gt; ã€ &lt;a href=&quot;https://lailin.xyz/post/go-training-week3-errgroup.html&quot;&gt;Week03: Go å¹¶å‘ç¼–ç¨‹(ä¸ƒ) æ·±å…¥ç†è§£ errgroup&lt;/a&gt; ä¸­æˆ‘ä»¬æåˆ°äº†ç­‰å¾…å¤šä¸ª goroutine åä½œçš„æ–¹å¼ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨æƒ³ä¸€ä¸‹è¿™ä¹ˆä¸€ä¸ªå¸¸è§çš„åœºæ™¯ã€‚ç°åœ¨æœ‰ä¸€ä¸ª Server æœåŠ¡åœ¨æ‰§è¡Œï¼Œå½“è¯·æ±‚æ¥çš„æ—¶å€™æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª goroutine å»å¤„ç†ï¼Œç„¶ååœ¨è¿™ä¸ª goroutine å½“ä¸­æœ‰å¯¹ä¸‹æ¸¸æœåŠ¡çš„ rpc è°ƒç”¨ï¼Œä¹Ÿä¼šå»è¯·æ±‚æ•°æ®åº“è·å–ä¸€äº›æ•°æ®ï¼Œè¿™æ—¶å€™å¦‚æœä¸‹æ¸¸ä¾èµ–çš„æœåŠ¡æ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯åˆæ²¡æŒ‚ï¼Œåªæ˜¯å¾ˆæ…¢ï¼Œå¯èƒ½ä¸€æ¬¡è°ƒç”¨è¦ 1min æ‰èƒ½è¿”å›ç»“æœï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ&lt;/p&gt;&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé¦–å…ˆå‡è®¾æˆ‘ä»¬ä½¿ç”¨ WaitGroup è¿›è¡Œæ§åˆ¶ï¼Œç­‰å¾…æ‰€æœ‰çš„ goroutine å¤„ç†å®Œæˆä¹‹åè¿”å›ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å®é™…çš„è€—æ—¶è¿œè¿œå¤§äºäº†ç”¨æˆ·å¯ä»¥å®¹å¿çš„æ—¶é—´ã€‚&lt;br/&gt;&lt;img src=&quot;https://lailin.xyz/images/1610027116078-2e1368bf-015e-4459-8517-73dc858ed083.svg&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;02_Goè¿›é˜¶03_blog_context.drawio.svg&quot;/&gt;&lt;br/&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå†è€ƒè™‘ä¸€ä¸ªå¸¸è§çš„åœºæ™¯ï¼Œä¸‡ä¸€ä¸Šé¢çš„ rpc goroutine å¾ˆæ—©å°±æŠ¥é”™äº†ï¼Œä½†æ˜¯ ä¸‹é¢çš„ db goroutine åˆæ‰§è¡Œäº†å¾ˆä¹…ï¼Œæˆ‘ä»¬æœ€åè¦è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¾ˆæ˜æ˜¾åé¢ db goroutine æ‰§è¡Œçš„è¿™æ®µæ—¶é—´éƒ½æ˜¯åœ¨ç™½ç™½çš„æµªè´¹ç”¨æˆ·çš„æ—¶é—´ã€‚&lt;br/&gt;&lt;img src=&quot;https://lailin.xyz/images/1610027303842-4272e9a1-af9c-4804-a779-f72c1f82a1a0.svg&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;02_Goè¿›é˜¶03_blog_context.drawio.svg&quot;/&gt;&lt;/p&gt;&lt;p&gt;è¿™æ—¶å€™å°±åº”è¯¥è¯·å‡º context åŒ…äº†ï¼Œ&lt;strong&gt;context ä¸»è¦å°±æ˜¯ç”¨æ¥åœ¨å¤šä¸ª goroutine ä¸­è®¾ç½®æˆªæ­¢æ—¥æœŸã€åŒæ­¥ä¿¡å·ï¼Œä¼ é€’è¯·æ±‚ç›¸å…³å€¼ã€‚&lt;/strong&gt;&lt;br/&gt;&lt;strong&gt;æ¯ä¸€æ¬¡ context éƒ½ä¼šä»é¡¶å±‚ä¸€å±‚ä¸€å±‚çš„ä¼ é€’åˆ°ä¸‹é¢ä¸€å±‚çš„ goroutine å½“ä¸Šé¢çš„ context å–æ¶ˆçš„æ—¶å€™ï¼Œä¸‹é¢æ‰€æœ‰çš„ context ä¹Ÿä¼šéšä¹‹å–æ¶ˆã€‚&lt;/strong&gt;&lt;br/&gt;**&lt;br/&gt;ä¸Šé¢çš„ä¾‹å­å½“ä¸­ï¼Œå¦‚æœå¼•å…¥ context åå°±ä¼šæ˜¯è¿™æ ·ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œcontext ä¼šç±»ä¼¼ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ä¸€æ ·ä¾é™„åœ¨æ¯ä¸ª goroutine ä¸Šï¼Œå½“ä¸Šå±‚çš„ req goroutine çš„ context è¶…æ—¶ä¹‹åå°±ä¼šå°†å–æ¶ˆä¿¡å·åŒæ­¥åˆ°ä¸‹é¢çš„æ‰€æœ‰ goroutine ä¸Šä¸€èµ·è¿”å›ï¼Œä»è€Œè¾¾åˆ°è¶…æ—¶æ§åˆ¶çš„ä½œç”¨&lt;br/&gt;&lt;img src=&quot;https://lailin.xyz/images/1610027726018-4ff7389e-ec4a-4107-99ac-493f587f2a88.svg&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;02_Goè¿›é˜¶03_blog_context.drawio.svg&quot;/&gt;&lt;br/&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“ rpc è°ƒç”¨å¤±è´¥ä¹‹åï¼Œä¼šå‡ºå‘ context å–æ¶ˆï¼Œç„¶åè¿™ä¸ªå–æ¶ˆä¿¡å·å°±ä¼šåŒæ­¥åˆ°å…¶ä»–çš„ goroutine å½“ä¸­&lt;br/&gt;&lt;img src=&quot;https://lailin.xyz/images/1610027762059-43c810a8-619e-4f8d-ad74-7a2767635aa0.svg&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;02_Goè¿›é˜¶03_blog_context.drawio.svg&quot;/&gt;&lt;/p&gt;&lt;h2 id=&quot;package-context&quot;&gt;&lt;a href=&quot;#package-context&quot; class=&quot;headerlink&quot; title=&quot;package context&quot;/&gt;package context&lt;/h2&gt;&lt;h3 id=&quot;ä½¿ç”¨è¯´æ˜&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨è¯´æ˜&quot;/&gt;ä½¿ç”¨è¯´æ˜&lt;/h3&gt;&lt;p&gt;åœ¨ä½¿ç”¨ä¸€ä¸ªæ–°çš„åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦å…ˆçœ‹å®ƒçš„å®˜æ–¹è¯´æ˜ï¼Œå¾—ç›Šäº godoc çš„çº¦æŸï¼Œæ‰€ä»¥æ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹åº“çš„æ–‡æ¡£éƒ½å¯ä»¥é€šè¿‡ &lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://pkg.go.dev&quot;&gt;pkg.go.dev&lt;/a&gt; è¿›è¡Œæœç´¢æŸ¥è¯¢&lt;/p&gt;&lt;h4 id=&quot;ä½¿ç”¨å‡†åˆ™&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨å‡†åˆ™&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨å‡†åˆ™&quot;/&gt;ä½¿ç”¨å‡†åˆ™&lt;/h4&gt;&lt;p&gt;context åŒ…ä¸€å¼€å§‹å°±å‘Šè¯‰äº†æˆ‘ä»¬åº”è¯¥æ€ä¹ˆç”¨ï¼Œä¸åº”è¯¥æ€ä¹ˆç”¨ï¼Œè¿™æ˜¯åº”è¯¥è¢«å…±åŒéµå®ˆçš„çº¦å®šã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å¯¹ server åº”ç”¨è€Œè¨€ï¼Œä¼ å…¥çš„è¯·æ±‚åº”è¯¥åˆ›å»ºä¸€ä¸ª contextï¼Œæ¥å—&lt;/li&gt;&lt;li&gt;é€šè¿‡ &lt;code&gt;WithCancel&lt;/code&gt; , &lt;code&gt;WithDeadline&lt;/code&gt; , &lt;code&gt;WithTimeout&lt;/code&gt; åˆ›å»ºçš„ Context ä¼šåŒæ—¶è¿”å›ä¸€ä¸ª cancel æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¿…é¡»è¦è¢«æ‰§è¡Œï¼Œä¸ç„¶ä¼šå¯¼è‡´ context æ³„æ¼ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡æ‰§è¡Œ &lt;code&gt;go vet&lt;/code&gt; å‘½ä»¤è¿›è¡Œæ£€æŸ¥&lt;/li&gt;&lt;li&gt;åº”è¯¥å°† &lt;code&gt;context.Context&lt;/code&gt; ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°è¿›è¡Œä¼ é€’ï¼Œå‚æ•°å‘½åä¸€èˆ¬ä¸º &lt;code&gt;ctx&lt;/code&gt; ä¸åº”è¯¥å°† Context ä½œä¸ºå­—æ®µæ”¾åœ¨ç»“æ„ä½“ä¸­ã€‚&lt;/li&gt;&lt;li&gt;ä¸è¦ç»™ context ä¼ é€’ nilï¼Œå¦‚æœä½ ä¸çŸ¥é“åº”è¯¥ä¼ ä»€ä¹ˆçš„æ—¶å€™å°±ä¼ é€’ &lt;code&gt;context.TODO()&lt;/code&gt;&lt;/li&gt;&lt;li&gt;ä¸è¦å°†å‡½æ•°çš„å¯é€‰å‚æ•°æ”¾åœ¨ context å½“ä¸­ï¼Œcontext ä¸­ä¸€èˆ¬åªæ”¾ä¸€äº›å…¨å±€é€šç”¨çš„ metadata æ•°æ®ï¼Œä¾‹å¦‚ tracing id ç­‰ç­‰&lt;/li&gt;&lt;li&gt;context æ˜¯å¹¶å‘å®‰å…¨çš„å¯ä»¥åœ¨å¤šä¸ª goroutine ä¸­å¹¶å‘è°ƒç”¨&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;å‡½æ•°ç­¾å&quot;&gt;&lt;a href=&quot;#å‡½æ•°ç­¾å&quot; class=&quot;headerlink&quot; title=&quot;å‡½æ•°ç­¾å&quot;/&gt;å‡½æ•°ç­¾å&lt;/h4&gt;&lt;p&gt;context åŒ…æš´éœ²çš„æ–¹æ³•ä¸å¤šï¼Œçœ‹ä¸‹æ–¹è¯´æ˜å³å¯&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ–°çš„ Done channel çš„ contextï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå–æ¶ˆçš„æ–¹æ³•&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WithCancel&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(ctx Context, cancel CancelFunc)&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// åˆ›å»ºä¸€ä¸ªå…·æœ‰æˆªæ­¢æ—¶é—´çš„ context&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// æˆªæ­¢æ—¶é—´æ˜¯ d å’Œ parent(å¦‚æœæœ‰æˆªæ­¢æ—¶é—´çš„è¯) çš„æˆªæ­¢æ—¶é—´ä¸­æ›´æ—©çš„é‚£ä¸€ä¸ª&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// å½“ parent æ‰§è¡Œå®Œæ¯•ï¼Œæˆ– cancel è¢«è°ƒç”¨ æˆ–è€… æˆªæ­¢æ—¶é—´åˆ°äº†çš„æ—¶å€™ï¼Œè¿™ä¸ª context done æ‰&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WithDeadline&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context, d time.Time)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(Context, CancelFunc)&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// å…¶å®å°±æ˜¯è°ƒç”¨çš„ WithDeadline&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WithTimeout&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context, timeout time.Duration)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(Context, CancelFunc)&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; CancelFunc&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; Context&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// ä¸€èˆ¬ç”¨äºåˆ›å»º root contextï¼Œè¿™ä¸ª context æ°¸è¿œä¹Ÿä¸ä¼šè¢«å–æ¶ˆï¼Œæˆ–è€…æ˜¯ done&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Background&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Context&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// åº•å±‚å’Œ Background ä¸€è‡´ï¼Œä½†æ˜¯å«ä¹‰ä¸åŒï¼Œå½“ä¸æ¸…æ¥šç”¨ä»€ä¹ˆçš„æ—¶å€™æˆ–è€…æ˜¯è¿˜æ²¡å‡†å¤‡å¥½çš„æ—¶å€™å¯ä»¥ç”¨å®ƒ&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;TODO&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Context&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// ä¸º context é™„åŠ å€¼&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// key åº”è¯¥å…·æœ‰å¯æ¯”æ€§ï¼Œä¸€èˆ¬ä¸åº”è¯¥æ˜¯ string int è¿™ç§é»˜è®¤ç±»å‹ï¼Œåº”è¯¥è‡ªå·±åˆ›å»ºä¸€ä¸ªç±»å‹&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// é¿å…å‡ºç°å†²çªï¼Œä¸€èˆ¬ key ä¸åº”è¯¥å¯¼å‡ºï¼Œå¦‚æœè¦å¯¼å‡ºçš„è¯åº”è¯¥æ˜¯ä¸€ä¸ªæ¥å£æˆ–è€…æ˜¯æŒ‡é’ˆ&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WithValue&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context, key, val &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{})&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Context&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;æºç åˆ†æ&quot;&gt;&lt;a href=&quot;#æºç åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;æºç åˆ†æ&quot;/&gt;æºç åˆ†æ&lt;/h3&gt;&lt;h4 id=&quot;context-Context-æ¥å£&quot;&gt;&lt;a href=&quot;#context-Context-æ¥å£&quot; class=&quot;headerlink&quot; title=&quot;context.Context æ¥å£&quot;/&gt;context.Context æ¥å£&lt;/h4&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; Context &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt; {&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// è¿”å›å½“å‰ context çš„ç»“æŸæ—¶é—´ï¼Œå¦‚æœ ok = false è¯´æ˜å½“å‰ context æ²¡æœ‰è®¾ç½®ç»“æŸæ—¶é—´&lt;/span&gt;&lt;br/&gt;Deadline() (deadline time.Time, ok &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;)&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// è¿”å›ä¸€ä¸ª channelï¼Œç”¨äºåˆ¤æ–­ context æ˜¯å¦ç»“æŸï¼Œå¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ª context done æ–¹æ³•ä¼šè¿”å›ç›¸åŒçš„ channel&lt;/span&gt;&lt;br/&gt;Done() &amp;lt;-&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{}&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// å½“ context ç»“æŸæ—¶æ‰ä¼šè¿”å›é”™è¯¯ï¼Œæœ‰ä¸¤ç§æƒ…å†µ&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// context è¢«ä¸»åŠ¨è°ƒç”¨ cancel æ–¹æ³•å–æ¶ˆï¼šCanceled&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// context è¶…æ—¶å–æ¶ˆ: DeadlineExceeded&lt;/span&gt;&lt;br/&gt;Err() error&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// ç”¨äºè¿”å› context ä¸­ä¿å­˜çš„å€¼, å¦‚ä½•æŸ¥æ‰¾ï¼Œè¿™ä¸ªåé¢ä¼šè®²åˆ°&lt;/span&gt;&lt;br/&gt;Value(key &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{}) &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{}&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&quot;é»˜è®¤ä¸Šä¸‹æ–‡-context-Backgroud&quot;&gt;&lt;a href=&quot;#é»˜è®¤ä¸Šä¸‹æ–‡-context-Backgroud&quot; class=&quot;headerlink&quot; title=&quot;é»˜è®¤ä¸Šä¸‹æ–‡: context.Backgroud&quot;/&gt;é»˜è®¤ä¸Šä¸‹æ–‡: context.Backgroud&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;Backgroud()ï¼Œ&lt;/strong&gt;åœ¨å‰é¢æœ‰è®²åˆ°ï¼Œ ä¸€èˆ¬ç”¨äºåˆ›å»º root contextï¼Œè¿™ä¸ª context æ°¸è¿œä¹Ÿä¸ä¼šè¢«å–æ¶ˆï¼Œæˆ–è¶…æ—¶&lt;br/&gt;&lt;strong&gt;TODO()ï¼Œ &lt;/strong&gt;åº•å±‚å’Œ Background ä¸€è‡´ï¼Œä½†æ˜¯å«ä¹‰ä¸åŒï¼Œå½“ä¸æ¸…æ¥šç”¨ä»€ä¹ˆçš„æ—¶å€™æˆ–è€…æ˜¯è¿˜æ²¡å‡†å¤‡å¥½çš„æ—¶å€™å¯ä»¥ç”¨å®ƒ&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; (&lt;br/&gt;background = &lt;span class=&quot;hljs-built_in&quot;&gt;new&lt;/span&gt;(emptyCtx)&lt;br/&gt;todo       = &lt;span class=&quot;hljs-built_in&quot;&gt;new&lt;/span&gt;(emptyCtx)&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Background&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Context&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; background&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;TODO&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Context&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; todo&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æŸ¥çœ‹æºç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œbackground å’Œ todo éƒ½æ˜¯å®ä¾‹åŒ–äº†ä¸€ä¸ª emptyCtx&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; emptyCtx &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*emptyCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Deadline&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(deadline time.Time, ok &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*emptyCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &amp;lt;-&lt;span class=&quot;hljs-title&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;struct&lt;/span&gt;&lt;/span&gt;{} {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*emptyCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*emptyCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(key &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{})&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;interface&lt;/span&gt;&lt;/span&gt;{} {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;emptyCtx å°±å¦‚åŒä»–çš„åå­—ä¸€æ ·ï¼Œå…¨éƒ½è¿”å›ç©ºå€¼&lt;/p&gt;&lt;h4 id=&quot;å¦‚ä½•å–æ¶ˆ-context-WithCancel&quot;&gt;&lt;a href=&quot;#å¦‚ä½•å–æ¶ˆ-context-WithCancel&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•å–æ¶ˆ context : WithCancel&quot;/&gt;å¦‚ä½•å–æ¶ˆ context : WithCancel&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;WithCancel(),&lt;/strong&gt; æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªå¯ä»¥å–æ¶ˆçš„ context&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WithCancel&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(ctx Context, cancel CancelFunc)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; parent == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;cannot create context from nil parent&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// åŒ…è£…å‡ºæ–°çš„ cancelContext&lt;/span&gt;&lt;br/&gt;c := newCancelCtx(parent)&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// æ„å»ºçˆ¶å­ä¸Šä¸‹æ–‡çš„è”ç³»ï¼Œç¡®ä¿å½“çˆ¶ Context å–æ¶ˆçš„æ—¶å€™ï¼Œå­ Context ä¹Ÿä¼šè¢«å–æ¶ˆ&lt;/span&gt;&lt;br/&gt;propagateCancel(parent, &amp;amp;c)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;c, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; { c.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;, Canceled) }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;ä¸æ­¢ WithCancel æ–¹æ³•ï¼Œå…¶ä»–çš„ WithXXX æ–¹æ³•ä¹Ÿä¸å…è®¸ä¼ å…¥ä¸€ä¸ª nil å€¼çš„çˆ¶ context&lt;br/&gt;&lt;code&gt;newCancelCtx&lt;/code&gt; åªæ˜¯ä¸€ä¸ªç®€å•çš„åŒ…è£…å°±ä¸å±•å¼€äº†ï¼Œ &lt;code&gt;propagateCancel&lt;/code&gt; æ¯”è¾ƒæœ‰æ„æ€ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;propagateCancel&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context, child canceler)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// é¦–å…ˆåˆ¤æ–­ parent èƒ½ä¸èƒ½è¢«å–æ¶ˆ&lt;/span&gt;&lt;br/&gt;    done := parent.Done()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; done == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-comment&quot;&gt;// parent is never canceled&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// å¦‚æœå¯ä»¥ï¼Œçœ‹ä¸€ä¸‹ parent æ˜¯ä¸æ˜¯å·²ç»è¢«å–æ¶ˆäº†ï¼Œå·²ç»è¢«å–æ¶ˆçš„æƒ…å†µä¸‹ç›´æ¥å–æ¶ˆ å­ context&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-done:&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// parent is already canceled&lt;/span&gt;&lt;br/&gt;child.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;, parent.Err())&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;default&lt;/span&gt;:&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œæ˜¯å‘ä¸ŠæŸ¥æ‰¾å¯ä»¥è¢«å–æ¶ˆçš„ parent context&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; p, ok := parentCancelCtx(parent); ok {&lt;br/&gt;        &lt;span class=&quot;hljs-comment&quot;&gt;// å¦‚æœæ‰¾åˆ°äº†å¹¶ä¸”æ²¡æœ‰è¢«å–æ¶ˆçš„è¯å°±æŠŠè¿™ä¸ªå­ context æŒ‚è½½åˆ°è¿™ä¸ª parent context ä¸Š&lt;/span&gt;&lt;br/&gt;        &lt;span class=&quot;hljs-comment&quot;&gt;// è¿™æ ·åªè¦ parent context å–æ¶ˆäº†å­ context ä¹Ÿä¼šè·Ÿç€è¢«å–æ¶ˆ&lt;/span&gt;&lt;br/&gt;p.mu.Lock()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; p.err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// parent has already been canceled&lt;/span&gt;&lt;br/&gt;child.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;, p.err)&lt;br/&gt;} &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; p.children == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;p.children = &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;map&lt;/span&gt;[canceler]&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{})&lt;br/&gt;}&lt;br/&gt;p.children[child] = &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{}{}&lt;br/&gt;}&lt;br/&gt;p.mu.Unlock()&lt;br/&gt;} &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; {&lt;br/&gt;        &lt;span class=&quot;hljs-comment&quot;&gt;// å¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯å°±ä¼šå¯åŠ¨ä¸€ä¸ª goroutine å»ç›‘å¬ parent context çš„å–æ¶ˆ channel&lt;/span&gt;&lt;br/&gt;        &lt;span class=&quot;hljs-comment&quot;&gt;// æ”¶åˆ°å–æ¶ˆä¿¡å·ä¹‹åå†å»è°ƒç”¨ å­ context çš„ cancel æ–¹æ³•&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-parent.Done():&lt;br/&gt;child.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;, parent.Err())&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-child.Done():&lt;br/&gt;}&lt;br/&gt;}()&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹ cancelCtx é•¿å•¥æ ·&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; cancelCtx &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;Context &lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œä¿å­˜çš„æ˜¯çˆ¶ Context&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;mu       sync.Mutex            &lt;span class=&quot;hljs-comment&quot;&gt;// äº’æ–¥é”&lt;/span&gt;&lt;br/&gt;done     &lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{}         &lt;span class=&quot;hljs-comment&quot;&gt;// å…³é—­ä¿¡å·&lt;/span&gt;&lt;br/&gt;children &lt;span class=&quot;hljs-keyword&quot;&gt;map&lt;/span&gt;[canceler]&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{} &lt;span class=&quot;hljs-comment&quot;&gt;// ä¿å­˜æ‰€æœ‰çš„å­ contextï¼Œå½“å–æ¶ˆçš„æ—¶å€™ä¼šè¢«è®¾ç½®ä¸º nil&lt;/span&gt;&lt;br/&gt;err      error&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;åœ¨ Done æ–¹æ³•è¿™é‡Œé‡‡ç”¨äº† æ‡’æ±‰å¼åŠ è½½çš„æ–¹å¼ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™æ‰ä¼šå»åˆ›å»ºè¿™ä¸ª channel&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(c *cancelCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &amp;lt;-&lt;span class=&quot;hljs-title&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;struct&lt;/span&gt;&lt;/span&gt;{} {&lt;br/&gt;c.mu.Lock()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; c.done == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;c.done = &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{})&lt;br/&gt;}&lt;br/&gt;d := c.done&lt;br/&gt;c.mu.Unlock()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; d&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;Value æ–¹æ³•å¾ˆæœ‰æ„æ€ï¼Œè¿™é‡Œç›¸å½“äºæ˜¯å†…éƒ¨ &lt;code&gt;cancelCtxKey&lt;/code&gt; è¿™ä¸ªå˜é‡çš„åœ°å€ä½œä¸ºäº†ä¸€ä¸ªç‰¹æ®Šçš„ keyï¼Œå½“æŸ¥è¯¢è¿™ä¸ª key çš„æ—¶å€™å°±ä¼šè¿”å›å½“å‰ context å¦‚æœä¸æ˜¯è¿™ä¸ª key å°±ä¼šå‘ä¸Šé€’å½’çš„å»è°ƒç”¨ parent context çš„ Value æ–¹æ³•æŸ¥æ‰¾æœ‰æ²¡æœ‰å¯¹åº”çš„å€¼&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(c *cancelCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(key &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{})&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;interface&lt;/span&gt;&lt;/span&gt;{} {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; key == &amp;amp;cancelCtxKey {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c.Context.Value(key)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;åœ¨å‰é¢è®²åˆ°æ„å»ºçˆ¶å­ä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³ç³»çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå»æŸ¥æ‰¾å¯ä»¥è¢«å–æ¶ˆçš„çˆ¶ context çš„æ–¹æ³• &lt;code&gt;parentCancelCtx&lt;/code&gt; å°±ç”¨åˆ°äº†è¿™ä¸ªç‰¹æ®Š value&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;parentCancelCtx&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(*cancelCtx, &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œå…ˆåˆ¤æ–­ä¼ å…¥çš„ parent æ˜¯ä¸æ˜¯æ°¸è¿œä¸å¯å–æ¶ˆçš„ï¼Œå¦‚æœæ˜¯å°±ç›´æ¥è¿”å›äº†&lt;/span&gt;&lt;br/&gt;done := parent.Done()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; done == closedchan || done == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œåˆ©ç”¨äº† context.Value ä¸æ–­å‘ä¸ŠæŸ¥è¯¢å€¼çš„ç‰¹ç‚¹ï¼Œåªè¦å‡ºç°ç¬¬ä¸€ä¸ªå¯ä»¥å–æ¶ˆçš„ context çš„æ—¶å€™å°±ä¼šè¿”å›&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// å¦‚æœæ²¡æœ‰çš„è¯ï¼Œè¿™æ—¶å€™ ok å°±ä¼šç­‰äº false&lt;/span&gt;&lt;br/&gt;p, ok := parent.Value(&amp;amp;cancelCtxKey).(*cancelCtx)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; !ok {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œå»åˆ¤æ–­è¿”å›çš„ parent çš„ channel å’Œä¼ å…¥çš„ parent æ˜¯ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ˜¯çš„è¯å°±è¿”å›è¿™ä¸ª parent&lt;/span&gt;&lt;br/&gt;p.mu.Lock()&lt;br/&gt;ok = p.done == done&lt;br/&gt;p.mu.Unlock()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; !ok {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;, &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; p, &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹æœ€é‡è¦çš„è¿™ä¸ª cancel æ–¹æ³•ï¼Œcancel æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ŒremoveFromParent ç”¨äºç¡®è®¤æ˜¯ä¸æ˜¯æŠŠè‡ªå·±ä» parent context ä¸­ç§»é™¤ï¼Œerr æ˜¯ ctx.Err() æœ€åè¿”å›çš„é”™è¯¯ä¿¡æ¯&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(c *cancelCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(removeFromParent &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;, err error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;context: internal error: missing cancel error&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;c.mu.Lock()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; c.err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;c.mu.Unlock()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-comment&quot;&gt;// already canceled&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;c.err = err&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// ç”±äº cancel context çš„ done æ˜¯æ‡’åŠ è½½çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½å­˜åœ¨è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„æƒ…å†µ&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; c.done == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;c.done = closedchan&lt;br/&gt;} &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;close&lt;/span&gt;(c.done)&lt;br/&gt;}&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// å¾ªç¯çš„å°†æ‰€æœ‰çš„å­ context å–æ¶ˆæ‰&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; child := &lt;span class=&quot;hljs-keyword&quot;&gt;range&lt;/span&gt; c.children {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// &lt;span class=&quot;hljs-doctag&quot;&gt;NOTE:&lt;/span&gt; acquiring the child&#x27;s lock while holding parent&#x27;s lock.&lt;/span&gt;&lt;br/&gt;child.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;, err)&lt;br/&gt;}&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// å°†æ‰€æœ‰çš„å­ context å’Œå½“å‰ context å…³ç³»è§£é™¤&lt;/span&gt;&lt;br/&gt;c.children = &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;c.mu.Unlock()&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// å¦‚æœéœ€è¦å°†å½“å‰ context ä» parent context ç§»é™¤ï¼Œå°±ç§»é™¤æ‰&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; removeFromParent {&lt;br/&gt;removeChild(c.Context, c)&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&quot;è¶…æ—¶è‡ªåŠ¨å–æ¶ˆå¦‚ä½•å®ç°-WithDeadline-WithTimeout&quot;&gt;&lt;a href=&quot;#è¶…æ—¶è‡ªåŠ¨å–æ¶ˆå¦‚ä½•å®ç°-WithDeadline-WithTimeout&quot; class=&quot;headerlink&quot; title=&quot;è¶…æ—¶è‡ªåŠ¨å–æ¶ˆå¦‚ä½•å®ç°: WithDeadline, WithTimeout&quot;/&gt;è¶…æ—¶è‡ªåŠ¨å–æ¶ˆå¦‚ä½•å®ç°: WithDeadline, WithTimeout&lt;/h4&gt;&lt;p&gt;æˆ‘ä»¬å…ˆçœ‹çœ‹æ¯”è¾ƒå¸¸ç”¨çš„ WithTimeout, å¯ä»¥å‘ç° WithTimeout å…¶å®å°±æ˜¯è°ƒç”¨äº† WithDeadline ç„¶åå†ä¼ å…¥çš„å‚æ•°ä¸Šç”¨å½“å‰æ—¶é—´åŠ ä¸Šäº† timeout çš„æ—¶é—´&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WithTimeout&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context, timeout time.Duration)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(Context, CancelFunc)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; WithDeadline(parent, time.Now().Add(timeout))&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;å†æ¥çœ‹ä¸€ä¸‹å®ç°è¶…æ—¶çš„ timerCtxï¼ŒWithDeadline æˆ‘ä»¬æ”¾åˆ°åé¢ä¸€ç‚¹ç‚¹&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; timerCtx &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;cancelCtx &lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œå¤ç”¨äº† cancelCtx&lt;/span&gt;&lt;br/&gt;timer *time.Timer &lt;span class=&quot;hljs-comment&quot;&gt;// Under cancelCtx.mu.&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;deadline time.Time &lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œä¿å­˜äº†å¿«åˆ°æœŸçš„æ—¶é—´&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;code&gt;Deadline()&lt;/code&gt; å°±æ˜¯è¿”å›äº†ç»“æ„ä½“ä¸­ä¿å­˜çš„è¿‡æœŸæ—¶é—´&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(c *timerCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Deadline&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(deadline time.Time, ok &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c.deadline, &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;code&gt;cancel&lt;/code&gt; å…¶å®å°±æ˜¯å¤ç”¨äº† cancelCtx ä¸­çš„å–æ¶ˆæ–¹æ³•ï¼Œå”¯ä¸€åŒºåˆ«çš„åœ°æ–¹å°±æ˜¯åœ¨åé¢åŠ ä¸Šäº†å¯¹ timer çš„åˆ¤æ–­ï¼Œå¦‚æœ timer æ²¡æœ‰ç»“æŸä¸»åŠ¨ç»“æŸ timer&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(c *timerCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(removeFromParent &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;, err error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;c.cancelCtx.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;, err)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; removeFromParent {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Remove this timerCtx from its parent cancelCtx&#x27;s children.&lt;/span&gt;&lt;br/&gt;removeChild(c.cancelCtx.Context, c)&lt;br/&gt;}&lt;br/&gt;c.mu.Lock()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; c.timer != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;c.timer.Stop()&lt;br/&gt;c.timer = &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;c.mu.Unlock()&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;timerCtx å¹¶æ²¡æœ‰é‡æ–°å®ç° Done() å’Œ Value æ–¹æ³•ï¼Œç›´æ¥å¤ç”¨äº† cancelCtx çš„ç›¸å…³æ–¹æ³•&lt;/p&gt;&lt;p&gt;æœ€åæˆ‘ä»¬å†çœ‹çœ‹è¿™ä¸ªæœ€é‡è¦çš„ WithDeadline æ–¹æ³•&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WithDeadline&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context, d time.Time)&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(Context, CancelFunc)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; parent == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;cannot create context from nil parent&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;   &lt;span class=&quot;hljs-comment&quot;&gt;// ä¼šå…ˆåˆ¤æ–­ parent context çš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœè¿‡æœŸæ—¶é—´æ¯”å½“å‰ä¼ å…¥çš„æ—¶é—´è¦æ—©çš„è¯ï¼Œå°±æ²¡æœ‰å¿…è¦å†è®¾ç½®è¿‡æœŸæ—¶é—´äº†&lt;/span&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// åªéœ€è¦è¿”å› WithCancel å°±å¯ä»¥äº†ï¼Œå› ä¸ºåœ¨ parent è¿‡æœŸçš„æ—¶å€™ï¼Œå­ context ä¹Ÿä¼šè¢«å–æ¶ˆæ‰&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; cur, ok := parent.Deadline(); ok &amp;amp;&amp;amp; cur.Before(d) {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// The current deadline is already sooner than the new one.&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; WithCancel(parent)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// æ„é€ ç›¸å…³ç»“æ„ä½“&lt;/span&gt;&lt;br/&gt;c := &amp;amp;timerCtx{&lt;br/&gt;cancelCtx: newCancelCtx(parent),&lt;br/&gt;deadline:  d,&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// å’Œ WithCancel ä¸­çš„é€»è¾‘ç›¸åŒï¼Œæ„å»ºä¸Šä¸‹æ–‡å…³ç³»&lt;/span&gt;&lt;br/&gt;propagateCancel(parent, c)&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// åˆ¤æ–­ä¼ å…¥çš„æ—¶é—´æ˜¯ä¸æ˜¯å·²ç»è¿‡æœŸï¼Œå¦‚æœå·²ç»è¿‡æœŸäº†å°± cancel æ‰ç„¶åå†è¿”å›&lt;/span&gt;&lt;br/&gt;dur := time.Until(d)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; dur &amp;lt;= &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt; {&lt;br/&gt;c.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;, DeadlineExceeded) &lt;span class=&quot;hljs-comment&quot;&gt;// deadline has already passed&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; { c.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;, Canceled) }&lt;br/&gt;}&lt;br/&gt;c.mu.Lock()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defer&lt;/span&gt; c.mu.Unlock()&lt;br/&gt;&lt;br/&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œæ˜¯è¶…æ—¶å–æ¶ˆçš„é€»è¾‘ï¼Œå¯åŠ¨ timer æ—¶é—´åˆ°äº†ä¹‹åå°±ä¼šè°ƒç”¨å–æ¶ˆæ–¹æ³•&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; c.err == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;c.timer = time.AfterFunc(dur, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;c.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;, DeadlineExceeded)&lt;br/&gt;})&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; { c.cancel(&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;, Canceled) }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;å¯ä»¥å‘ç°è¶…æ—¶æ§åˆ¶å…¶å®å°±æ˜¯åœ¨å¤ç”¨ cancelCtx çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†ä¸€ä¸ª timer æ¥åšå®šæ—¶å–æ¶ˆ&lt;/p&gt;&lt;h4 id=&quot;å¦‚ä½•ä¸º-Context-é™„åŠ ä¸€äº›å€¼-WithValue&quot;&gt;&lt;a href=&quot;#å¦‚ä½•ä¸º-Context-é™„åŠ ä¸€äº›å€¼-WithValue&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•ä¸º Context é™„åŠ ä¸€äº›å€¼: WithValue&quot;/&gt;å¦‚ä½•ä¸º Context é™„åŠ ä¸€äº›å€¼: WithValue&lt;/h4&gt;&lt;p&gt;WithValue ç›¸å¯¹ç®€å•ä¸€ç‚¹ï¼Œä¸»è¦å°±æ˜¯æ ¡éªŒäº†ä¸€ä¸‹ Key æ˜¯ä¸æ˜¯å¯æ¯”è¾ƒçš„ï¼Œç„¶åæ„é€ å‡ºä¸€ä¸ª valueCtx çš„ç»“æ„&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WithValue&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(parent Context, key, val &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{})&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Context&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; parent == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;cannot create context from nil parent&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; key == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;nil key&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; !reflectlite.TypeOf(key).Comparable() {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;key is not comparable&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;valueCtx{parent, key, val}&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;valueCtx ä¸»è¦å°±æ˜¯åµŒå…¥äº† parent context ç„¶åé™„åŠ äº†ä¸€ä¸ª key val&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; valueCtx &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;Context&lt;br/&gt;key, val &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{}&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;Value çš„æŸ¥æ‰¾å’Œä¹‹å‰ cancelCtx ç±»ä¼¼ï¼Œéƒ½æ˜¯å…ˆåˆ¤æ–­å½“å‰æœ‰æ²¡æœ‰ï¼Œæ²¡æœ‰å°±å‘ä¸Šé€’å½’ï¼Œåªæ˜¯åœ¨ cancelCtx å½“ä¸­ key æ˜¯ä¸€ä¸ªå›ºå®šçš„ key è€Œå·²&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(c *valueCtx)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(key &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{})&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;interface&lt;/span&gt;&lt;/span&gt;{} {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; c.key == key {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c.val&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c.Context.Value(key)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;Value å°±æ²¡æœ‰å®ç° Context æ¥å£çš„å…¶ä»–æ–¹æ³•äº†ï¼Œå…¶ä»–çš„æ–¹æ³•å…¨éƒ½æ˜¯å¤ç”¨çš„ parent context çš„æ–¹æ³•&lt;/p&gt;&lt;h3 id=&quot;ä½¿ç”¨åœºæ™¯&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨åœºæ™¯&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨åœºæ™¯&quot;/&gt;ä½¿ç”¨åœºæ™¯&lt;/h3&gt;&lt;h4 id=&quot;è¶…æ—¶æ§åˆ¶&quot;&gt;&lt;a href=&quot;#è¶…æ—¶æ§åˆ¶&quot; class=&quot;headerlink&quot; title=&quot;è¶…æ—¶æ§åˆ¶&quot;/&gt;è¶…æ—¶æ§åˆ¶&lt;/h4&gt;&lt;p&gt;è¿™å°±æ˜¯æ–‡ç« å¼€å§‹æ—¶å€™ç¬¬ä¸€ä¸ªåœºæ™¯ä¸‹çš„ä¸€ä¸ªä¾‹å­&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; main&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; (&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;time&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// æ¨¡æ‹Ÿä¸€ä¸ªè€—æ—¶çš„æ“ä½œ&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;rpc&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;, error)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;time.Sleep(&lt;span class=&quot;hljs-number&quot;&gt;100&lt;/span&gt; * time.Millisecond)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;rpc done&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; result &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {&lt;br/&gt;data &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;&lt;br/&gt;err  error&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context, ms &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;ctx, cancel := context.WithTimeout(ctx, time.Duration(ms)*time.Millisecond)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defer&lt;/span&gt; cancel()&lt;br/&gt;&lt;br/&gt;r := &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; result)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;data, err := rpc()&lt;br/&gt;r &amp;lt;- result{data: data, err: err}&lt;br/&gt;}()&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-ctx.Done():&lt;br/&gt;fmt.Printf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;timeout: %d ms, context exit: %+v\n&quot;&lt;/span&gt;, ms, ctx.Err())&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; res := &amp;lt;-r:&lt;br/&gt;fmt.Printf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;result: %s, err: %+v\n&quot;&lt;/span&gt;, res.data, res.err)&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œæ¨¡æ‹Ÿæ¥å—è¯·æ±‚ï¼Œå¯åŠ¨ä¸€ä¸ªåç¨‹å»å‘èµ·è¯·æ±‚&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; i := &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;; i++ {&lt;br/&gt;time.Sleep(&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; * time.Second)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; handle(context.Background(), i*&lt;span class=&quot;hljs-number&quot;&gt;50&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// for test, hang&lt;/span&gt;&lt;br/&gt;time.Sleep(time.Second)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æ‰§è¡Œç»“æœ&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;â–¶ &lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; run *.&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;&lt;br/&gt;timeout: &lt;span class=&quot;hljs-number&quot;&gt;50&lt;/span&gt; ms, context exit: context deadline exceeded&lt;br/&gt;result: rpc done, err: &amp;lt;&lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&amp;gt;&lt;br/&gt;result: rpc done, err: &amp;lt;&lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&amp;gt;&lt;br/&gt;result: rpc done, err: &amp;lt;&lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&amp;gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ä¼ å…¥çš„è¶…æ—¶æ—¶é—´ 50ms ç¨‹åºè¶…æ—¶ç›´æ¥é€€å‡ºäº†ï¼Œä½†æ˜¯åé¢è¶…è¿‡ 50ms çš„æ—¶å€™å‡è¿”å›äº†ç»“æœã€‚&lt;/p&gt;&lt;h4 id=&quot;é”™è¯¯å–æ¶ˆ&quot;&gt;&lt;a href=&quot;#é”™è¯¯å–æ¶ˆ&quot; class=&quot;headerlink&quot; title=&quot;é”™è¯¯å–æ¶ˆ&quot;/&gt;é”™è¯¯å–æ¶ˆ&lt;/h4&gt;&lt;p&gt;è¿™æ˜¯ç¬¬äºŒä¸ªåœºæ™¯çš„ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬åœ¨ main ä¸­å¹¶å‘è°ƒç”¨äº† &lt;code&gt;f1&lt;/code&gt; &lt;code&gt;f2&lt;/code&gt; ä¸¤ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ &lt;code&gt;f1&lt;/code&gt; å¾ˆå¿«å°±è¿”å›äº†ï¼Œä½†æ˜¯ &lt;code&gt;f2&lt;/code&gt; è¿˜åœ¨é˜»å¡&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; main&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; (&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;context&quot;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;sync&quot;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;time&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;f1&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-ctx.Done():&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; fmt.Errorf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;f1: %w&quot;&lt;/span&gt;, ctx.Err())&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-time.After(time.Millisecond): &lt;span class=&quot;hljs-comment&quot;&gt;// æ¨¡æ‹ŸçŸ­æ—¶é—´æŠ¥é”™&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; fmt.Errorf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;f1 err in 1ms&quot;&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;f2&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-ctx.Done():&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; fmt.Errorf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;f2: %w&quot;&lt;/span&gt;, ctx.Err())&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-time.After(time.Hour): &lt;span class=&quot;hljs-comment&quot;&gt;// æ¨¡æ‹Ÿä¸€ä¸ªè€—æ—¶æ“ä½œ&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;ctx, cancel := context.WithTimeout(context.Background(), time.Second)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defer&lt;/span&gt; cancel()&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; wg sync.WaitGroup&lt;br/&gt;wg.Add(&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defer&lt;/span&gt; wg.Done()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := f1(ctx); err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;fmt.Println(err)&lt;br/&gt;cancel()&lt;br/&gt;}&lt;br/&gt;}()&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defer&lt;/span&gt; wg.Done()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := f2(ctx); err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;fmt.Println(err)&lt;br/&gt;cancel()&lt;br/&gt;}&lt;br/&gt;}()&lt;br/&gt;&lt;br/&gt;wg.Wait()&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æ‰§è¡Œç»“æœï¼Œå¯ä»¥çœ‹åˆ° f1 è¿”å›ä¹‹å f2 ç«‹å³å°±è¿”å›äº†ï¼Œå¹¶ä¸”æŠ¥é”™ context è¢«å–æ¶ˆ&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;â–¶ &lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; run *.&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;&lt;br/&gt;f1 err in &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;ms&lt;br/&gt;f2: context canceled&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;ç»†å¿ƒçš„åŒå­¦å¯èƒ½å‘ç°äº†ï¼Œè¿™ä¸ªä¾‹å­ä¸å°±æ˜¯ errgroup çš„é€»è¾‘ä¹ˆï¼Œæ˜¯çš„å®ƒå°±æ˜¯ç±»ä¼¼ errgroup çš„ç®€å•é€»è¾‘ï¼Œè¿™æ—¶å€™å†åè¿‡æ¥å»çœ‹ä¸€ä¸‹ ã€Š&lt;a href=&quot;https://lailin.xyz/post/go-training-week3-errgroup.html&quot;&gt;Week03: Go å¹¶å‘ç¼–ç¨‹(ä¸ƒ) æ·±å…¥ç†è§£ errgroup - Mohuishou&lt;/a&gt;ã€‹è¿™ç¯‡æ–‡ç« å¯èƒ½ä¼šæœ‰ä¸ä¸€æ ·çš„ä½“ä¼š&lt;/p&gt;&lt;h4 id=&quot;ä¼ é€’å…±äº«æ•°æ®&quot;&gt;&lt;a href=&quot;#ä¼ é€’å…±äº«æ•°æ®&quot; class=&quot;headerlink&quot; title=&quot;ä¼ é€’å…±äº«æ•°æ®&quot;/&gt;ä¼ é€’å…±äº«æ•°æ®&lt;/h4&gt;&lt;p&gt;ä¸€èˆ¬ä¼šç”¨æ¥ä¼ é€’ tracing id, request id è¿™ç§æ•°æ®ï¼Œä¸è¦ç”¨æ¥ä¼ é€’å¯é€‰å‚æ•°ï¼Œè¿™é‡Œå€Ÿç”¨ä¸€ä¸‹é¥¶å¤§çš„ä¸€ä¸ªä¾‹å­ï¼Œåœ¨å®é™…çš„ç”Ÿäº§æ¡ˆä¾‹ä¸­æˆ‘ä»¬ä»£ç ä¹Ÿæ˜¯è¿™æ ·å¤§åŒå°å¼‚&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;const&lt;/span&gt; requestIDKey &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; = &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;WithRequestID&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(next http.Handler)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;http&lt;/span&gt;.&lt;span class=&quot;hljs-title&quot;&gt;Handler&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; http.HandlerFunc(&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(rw http.ResponseWriter, req *http.Request)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// ä» header ä¸­æå– request-id&lt;/span&gt;&lt;br/&gt;reqID := req.Header.Get(&lt;span class=&quot;hljs-string&quot;&gt;&quot;X-Request-ID&quot;&lt;/span&gt;)&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// åˆ›å»º valueCtxã€‚ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»å‹ï¼Œä¸å®¹æ˜“å†²çª&lt;/span&gt;&lt;br/&gt;ctx := context.WithValue(&lt;br/&gt;req.Context(), requestIDKey, reqID)&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// åˆ›å»ºæ–°çš„è¯·æ±‚&lt;/span&gt;&lt;br/&gt;req = req.WithContext(ctx)&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è°ƒç”¨ HTTP å¤„ç†å‡½æ•°&lt;/span&gt;&lt;br/&gt;next.ServeHTTP(rw, req)&lt;br/&gt;}&lt;br/&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è·å– request-id&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;GetRequestID&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;string&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;ctx.Value(requestIDKey).(&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(rw http.ResponseWriter, req *http.Request)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// æ‹¿åˆ° reqIdï¼Œåé¢å¯ä»¥è®°å½•æ—¥å¿—ç­‰ç­‰&lt;/span&gt;&lt;br/&gt;reqID := GetRequestID(req.Context())&lt;br/&gt;...&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;handler := WithRequestID(http.HandlerFunc(Handle))&lt;br/&gt;http.ListenAndServe(&lt;span class=&quot;hljs-string&quot;&gt;&quot;/&quot;&lt;/span&gt;, handler)&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&quot;åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç”¨æ¥é˜²æ­¢-goroutine-æ³„æ¼&quot;&gt;&lt;a href=&quot;#åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç”¨æ¥é˜²æ­¢-goroutine-æ³„æ¼&quot; class=&quot;headerlink&quot; title=&quot;åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç”¨æ¥é˜²æ­¢ goroutine æ³„æ¼&quot;/&gt;åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç”¨æ¥é˜²æ­¢ goroutine æ³„æ¼&lt;/h4&gt;&lt;p&gt;æˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£çš„è¿™ä¸ªä¾‹å­, è¿™é‡Œé¢ gen è¿™ä¸ªå‡½æ•°ä¸­å¦‚æœä¸ä½¿ç”¨ context done æ¥æ§åˆ¶çš„è¯å°±ä¼šå¯¼è‡´ goroutine æ³„æ¼ï¼Œå› ä¸ºè¿™é‡Œé¢çš„ for æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œæ²¡æœ‰ ctx å°±æ²¡æœ‰ç›¸å…³çš„é€€å‡ºæœºåˆ¶&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// gen generates integers in a separate goroutine and&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// sends them to the returned channel.&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// The callers of gen need to cancel the context once&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// they are done consuming generated integers not to leak&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// the internal goroutine started by gen.&lt;/span&gt;&lt;br/&gt;gen := &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ctx context.Context)&lt;/span&gt; &amp;lt;-&lt;span class=&quot;hljs-title&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;int&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;dst := &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt;)&lt;br/&gt;n := &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-ctx.Done():&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-comment&quot;&gt;// returning not to leak the goroutine&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; dst &amp;lt;- n:&lt;br/&gt;n++&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;}()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; dst&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;ctx, cancel := context.WithCancel(context.Background())&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defer&lt;/span&gt; cancel() &lt;span class=&quot;hljs-comment&quot;&gt;// cancel when we are finished consuming integers&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; n := &lt;span class=&quot;hljs-keyword&quot;&gt;range&lt;/span&gt; gen(ctx) {&lt;br/&gt;fmt.Println(n)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; n == &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;break&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h2 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;/&gt;æ€»ç»“&lt;/h2&gt;&lt;h3 id=&quot;ä½¿ç”¨å‡†åˆ™-1&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨å‡†åˆ™-1&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨å‡†åˆ™&quot;/&gt;ä½¿ç”¨å‡†åˆ™&lt;/h3&gt;&lt;p&gt;context åŒ…ä¸€å¼€å§‹å°±å‘Šè¯‰äº†æˆ‘ä»¬åº”è¯¥æ€ä¹ˆç”¨ï¼Œä¸åº”è¯¥æ€ä¹ˆç”¨ï¼Œè¿™æ˜¯åº”è¯¥è¢«å…±åŒéµå®ˆçš„çº¦å®šã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å¯¹ server åº”ç”¨è€Œè¨€ï¼Œä¼ å…¥çš„è¯·æ±‚åº”è¯¥åˆ›å»ºä¸€ä¸ª contextï¼Œæ¥å—&lt;/li&gt;&lt;li&gt;é€šè¿‡ &lt;code&gt;WithCancel&lt;/code&gt; , &lt;code&gt;WithDeadline&lt;/code&gt; , &lt;code&gt;WithTimeout&lt;/code&gt; åˆ›å»ºçš„ Context ä¼šåŒæ—¶è¿”å›ä¸€ä¸ª cancel æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¿…é¡»è¦è¢«æ‰§è¡Œï¼Œä¸ç„¶ä¼šå¯¼è‡´ context æ³„æ¼ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡æ‰§è¡Œ &lt;code&gt;go vet&lt;/code&gt; å‘½ä»¤è¿›è¡Œæ£€æŸ¥&lt;/li&gt;&lt;li&gt;åº”è¯¥å°† &lt;code&gt;context.Context&lt;/code&gt; ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°è¿›è¡Œä¼ é€’ï¼Œå‚æ•°å‘½åä¸€èˆ¬ä¸º &lt;code&gt;ctx&lt;/code&gt; ä¸åº”è¯¥å°† Context ä½œä¸ºå­—æ®µæ”¾åœ¨ç»“æ„ä½“ä¸­ã€‚&lt;/li&gt;&lt;li&gt;ä¸è¦ç»™ context ä¼ é€’ nilï¼Œå¦‚æœä½ ä¸çŸ¥é“åº”è¯¥ä¼ ä»€ä¹ˆçš„æ—¶å€™å°±ä¼ é€’ &lt;code&gt;context.TODO()&lt;/code&gt;&lt;/li&gt;&lt;li&gt;ä¸è¦å°†å‡½æ•°çš„å¯é€‰å‚æ•°æ”¾åœ¨ context å½“ä¸­ï¼Œcontext ä¸­ä¸€èˆ¬åªæ”¾ä¸€äº›å…¨å±€é€šç”¨çš„ metadata æ•°æ®ï¼Œä¾‹å¦‚ tracing id ç­‰ç­‰&lt;/li&gt;&lt;li&gt;context æ˜¯å¹¶å‘å®‰å…¨çš„å¯ä»¥åœ¨å¤šä¸ª goroutine ä¸­å¹¶å‘è°ƒç”¨&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;ä½¿ç”¨åœºæ™¯-1&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨åœºæ™¯-1&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨åœºæ™¯&quot;/&gt;ä½¿ç”¨åœºæ™¯&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;è¶…æ—¶æ§åˆ¶&lt;/li&gt;&lt;li&gt;é”™è¯¯å–æ¶ˆ&lt;/li&gt;&lt;li&gt;è·¨ goroutine æ•°æ®åŒæ­¥&lt;/li&gt;&lt;li&gt;é˜²æ­¢ goroutine æ³„æ¼&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;ç¼ºç‚¹&quot;&gt;&lt;a href=&quot;#ç¼ºç‚¹&quot; class=&quot;headerlink&quot; title=&quot;ç¼ºç‚¹&quot;/&gt;ç¼ºç‚¹&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;æœ€æ˜¾è‘—çš„ä¸€ä¸ªå°±æ˜¯ context å¼•å…¥éœ€è¦ä¿®æ”¹å‡½æ•°ç­¾åï¼Œå¹¶ä¸”ä¼šç—…æ¯’çš„å¼çš„æ‰©æ•£åˆ°æ¯ä¸ªå‡½æ•°ä¸Šé¢ï¼Œä¸è¿‡è¿™ä¸ªè§ä»è§æ™ºï¼Œæˆ‘çœ‹ç€å…¶å®è¿˜å¥½&lt;/li&gt;&lt;li&gt;æŸäº›æƒ…å†µä¸‹è™½ç„¶æ˜¯å¯ä»¥åšåˆ°è¶…æ—¶è¿”å›æé«˜ç”¨æˆ·ä½“éªŒï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯ä¸ä¼šé€€å‡ºç›¸å…³ goroutine çš„ï¼Œè¿™æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´ goroutine çš„æ³„æ¼ï¼Œé’ˆå¯¹è¿™ä¸ªæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†åº“çš„ timeout handler æ¥å®ç°è¶…æ—¶æ§åˆ¶ï¼Œåº•å±‚æ˜¯é€šè¿‡ context æ¥å®ç°çš„ã€‚æˆ‘ä»¬è®¾ç½®äº†è¶…æ—¶æ—¶é—´ä¸º 1ms å¹¶ä¸”åœ¨ handler ä¸­æ¨¡æ‹Ÿé˜»å¡ 1000s ä¸æ–­çš„è¯·æ±‚ï¼Œç„¶åçœ‹ pprof çš„ goroutine æ•°æ®&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; main&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; (&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http&quot;&lt;/span&gt;&lt;br/&gt;_ &lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http/pprof&quot;&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;time&quot;&lt;/span&gt;&lt;br/&gt;)&lt;br/&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;mux := http.NewServeMux()&lt;br/&gt;mux.HandleFunc(&lt;span class=&quot;hljs-string&quot;&gt;&quot;/&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(rw http.ResponseWriter, r *http.Request)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œé˜»å¡ä½ï¼Œgoroutine ä¸ä¼šé‡Šæ”¾çš„&lt;/span&gt;&lt;br/&gt;time.Sleep(&lt;span class=&quot;hljs-number&quot;&gt;1000&lt;/span&gt; * time.Second)&lt;br/&gt;rw.Write([]&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;hello&quot;&lt;/span&gt;))&lt;br/&gt;})&lt;br/&gt;handler := http.TimeoutHandler(mux, time.Millisecond, &lt;span class=&quot;hljs-string&quot;&gt;&quot;xxx&quot;&lt;/span&gt;)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := http.ListenAndServe(&lt;span class=&quot;hljs-string&quot;&gt;&quot;0.0.0.0:8066&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;); err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(err)&lt;br/&gt;}&lt;br/&gt;}()&lt;br/&gt;http.ListenAndServe(&lt;span class=&quot;hljs-string&quot;&gt;&quot;:8080&quot;&lt;/span&gt;, handler)&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æŸ¥çœ‹æ•°æ®æˆ‘ä»¬å¯ä»¥å‘ç°è¯·æ±‚è¿”å›åï¼Œ goroutine å…¶å®å¹¶æœªå›æ”¶ï¼Œä½†æ˜¯å¦‚æœä¸é˜»å¡çš„è¯æ˜¯ä¼šç«‹å³å›æ”¶çš„&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;goroutine profile: total &lt;span class=&quot;hljs-number&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-number&quot;&gt;24&lt;/span&gt; @ &lt;span class=&quot;hljs-number&quot;&gt;0x103b125&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x106cc9f&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x1374110&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x12b9584&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x12bb4ad&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x12c7fbf&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x106fd01&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æºç ï¼Œè¶…æ—¶æ§åˆ¶ä¸»è¦åœ¨ ServeHTTP ä¸­å®ç°ï¼Œæˆ‘åˆ æ‰äº†éƒ¨åˆ†ä¸å…³é”®çš„æ•°æ®ï¼Œ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡½æ•°å†…éƒ¨å¯åŠ¨äº†ä¸€ä¸ª goroutine å»å¤„ç†è¯·æ±‚é€»è¾‘ï¼Œç„¶åå†å¤–é¢ç­‰å¾…ï¼Œä½†æ˜¯è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œå½“ context è¶…æ—¶ä¹‹å ServeHTTP è¿™ä¸ªå‡½æ•°å°±ç›´æ¥è¿”å›äº†ï¼Œåœ¨è¿™é‡Œé¢å¯åŠ¨çš„è¿™ä¸ª goroutine å°±æ²¡äººç®¡äº†&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(h *timeoutHandler)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ServeHTTP&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(w ResponseWriter, r *Request)&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;ctx := h.testContext&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; ctx == &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; cancelCtx context.CancelFunc&lt;br/&gt;ctx, cancelCtx = context.WithTimeout(r.Context(), h.dt)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defer&lt;/span&gt; cancelCtx()&lt;br/&gt;}&lt;br/&gt;r = r.WithContext(ctx)&lt;br/&gt;done := &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{})&lt;br/&gt;tw := &amp;amp;timeoutWriter{&lt;br/&gt;w:   w,&lt;br/&gt;h:   &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(Header),&lt;br/&gt;req: r,&lt;br/&gt;}&lt;br/&gt;panicChan := &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;interface&lt;/span&gt;{}, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; p := &lt;span class=&quot;hljs-built_in&quot;&gt;recover&lt;/span&gt;(); p != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {&lt;br/&gt;panicChan &amp;lt;- p&lt;br/&gt;}&lt;br/&gt;}()&lt;br/&gt;h.handler.ServeHTTP(tw, r)&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;close&lt;/span&gt;(done)&lt;br/&gt;}()&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; {&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; p := &amp;lt;-panicChan:&lt;br/&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;panic&lt;/span&gt;(p)&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-done:&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// ...&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &amp;lt;-ctx.Done():&lt;br/&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// ...&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;æ€»ç»“-1&quot;&gt;&lt;a href=&quot;#æ€»ç»“-1&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;/&gt;æ€»ç»“&lt;/h3&gt;&lt;p&gt;context æ˜¯ä¸€ä¸ªä¼˜ç¼ºç‚¹éƒ½ååˆ†æ˜æ˜¾çš„åŒ…ï¼Œè¿™ä¸ªåŒ…ç›®å‰åŸºæœ¬ä¸Šå·²ç»æˆä¸ºäº†åœ¨ go ä¸­åšè¶…æ—¶æ§åˆ¶é”™è¯¯å–æ¶ˆçš„æ ‡å‡†åšæ³•ï¼Œä½†æ˜¯ä¸ºäº†æ·»åŠ è¶…æ—¶å–æ¶ˆæˆ‘ä»¬éœ€è¦å»ä¿®æ”¹æ‰€æœ‰çš„å‡½æ•°ç­¾åï¼Œå¯¹ä»£ç çš„ä¾µå…¥æ€§æ¯”è¾ƒå¤§ï¼Œå¦‚æœä¹‹å‰ä¸€ç›´éƒ½æ²¡æœ‰ä½¿ç”¨åç»­å†æ·»åŠ çš„è¯è¿˜æ˜¯ä¼šæœ‰ä¸€äº›æ”¹é€ æˆæœ¬&lt;/p&gt;&lt;h2 id=&quot;å‚è€ƒæ–‡çŒ®&quot;&gt;&lt;a href=&quot;#å‚è€ƒæ–‡çŒ®&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒæ–‡çŒ®&quot;/&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;&lt;ol&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://pkg.go.dev/context&quot;&gt;context Â· pkg.go.dev&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://www.flysnow.org/2017/05/12/go-in-action-go-context.html#%E5%88%9D%E8%AF%86context&quot;&gt;Go è¯­è¨€å®æˆ˜ç¬”è®°ï¼ˆäºŒåï¼‰| Go Context&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-context/&quot;&gt;Go è¯­è¨€å¹¶å‘ç¼–ç¨‹ä¸ Context | Go è¯­è¨€è®¾è®¡ä¸å®ç°&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://qcrao.com/2019/06/12/dive-into-go-context/&quot;&gt;æ·±åº¦è§£å¯† Go è¯­è¨€ä¹‹ context | qcrao&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://blog.golang.org/context&quot;&gt;Go Concurrency Patterns: Context - The Go Blog&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://blog.golang.org/pipelines&quot;&gt;Go Concurrency Patterns: Pipelines and cancellation - The Go Blog&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h2 id=&quot;å…³æ³¨æˆ‘è·å–æ›´æ–°&quot;&gt;&lt;a href=&quot;#å…³æ³¨æˆ‘è·å–æ›´æ–°&quot; class=&quot;headerlink&quot; title=&quot;å…³æ³¨æˆ‘è·å–æ›´æ–°&quot;/&gt;å…³æ³¨æˆ‘è·å–æ›´æ–°&lt;/h2&gt;&lt;p&gt;çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>