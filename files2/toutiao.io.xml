<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>开发者头条</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>b894b22996b1c55e83a306f72982df3c</guid>
<title>这么设计服务的幂等性就对了</title>
<link>https://toutiao.io/k/odpb7yb</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content             autoTypeSetting24psection&amp;#10;            &quot; id=&quot;js_content&quot;&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.425&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/I8SfHxT94hWzMcDiax89miaZV8v6OfSyvWa5NcByxuWBHPST0WLPquoUyVPd565Z5EAzEyvFGEtZz04ZVGUE1rJQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;对于任何有状态（涉及状态修改）的服务，在设计服务、编码时，都必须考虑幂等性。&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;注：&lt;/span&gt;&lt;span&gt;无状态的（&lt;/span&gt;&lt;span&gt;如查询服务）服务，也要考虑幂等性。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;section data-role=&quot;title&quot; data-tools=&quot;135编辑器&quot; data-id=&quot;119028&quot;&gt;&lt;section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section hm_fix=&quot;218:327&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;strong data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;01&lt;/strong&gt;&lt;/section&gt;&lt;section data-width=&quot;100%&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;&gt;&lt;br data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;span&gt;&lt;strong&gt;设计原则&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;一个具有幂等性的服务，要求无论&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;重复请求&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;在多么极端的情况下发生，都要&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;表里如一&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;，此时必须满足：&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;对外&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：返回完全相同的结果&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;对内&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：自身状态不再发生任何改变&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;另，在实现层面：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;重复请求&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;是一个先决条件，我们认为&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;请求中的字段完全一样&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;才是重复请求。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;技术实现上，幂等设计必然要依赖&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;DB事务来进行锁控制&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;，此时牢记事务处理方式：一锁、二判、三更新。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;一定考虑所调用服务的幂等性，同时对幂等结果做处理。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;没有DB的应用在做幂等处理时需要&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;严格依赖&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;有DB应用的幂等服务。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section data-role=&quot;title&quot; data-tools=&quot;135编辑器&quot; data-id=&quot;119028&quot;&gt;&lt;section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section hm_fix=&quot;218:327&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;strong data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;02&lt;/strong&gt;&lt;/section&gt;&lt;section data-width=&quot;100%&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;&gt;&lt;br data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;span&gt;&lt;strong&gt;一些例子&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;正例 ✅&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;某个支付接口，对于多次重复的支付调用，能够返回完全相同的结果（结果字段完全一样），&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;且内部状态不再改变&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;，我们就说该接口满足幂等性。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;反例 ❌&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;某个转账接口，对于多次重复的转账，真的将用的余额转出了多次，预期应该只转出一次。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;某个更新接口，对于多次重复更新，首次更新和之后的更新返回的结果有差异。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;p&gt;&lt;/p&gt;&lt;section data-role=&quot;title&quot; data-tools=&quot;135编辑器&quot; data-id=&quot;119028&quot;&gt;&lt;section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section hm_fix=&quot;218:327&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;strong data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;03&lt;/strong&gt;&lt;/section&gt;&lt;section data-width=&quot;100%&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;&gt;&lt;br data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;span&gt;&lt;strong&gt;最佳实践&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;h2&gt;&lt;strong&gt;&lt;span&gt;case 1：以业务单据表做幂等&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.74296875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/I8SfHxT94hWzMcDiax89miaZV8v6OfSyvWDCgBuJph1Or87mC5ZibAReHve3WBtULr0ibfly9P8dx42v94S0jdInKA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;说明：&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;对于幂等性的控制，一般在&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;事务中&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;进行，且一定要加锁处理&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;只有确认当前操作此前未执行，才可以执行操作（&lt;/span&gt;&lt;span&gt;第一次来&lt;/span&gt;&lt;span&gt;）&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;一旦发现操作在此前已经完成（&lt;/span&gt;&lt;span&gt;被幂等了&lt;/span&gt;&lt;span&gt;），则不能继续做操作，避免重复处理。此时应该检查请求和DB数据的一致性（幂等一致性校验），原则上所有的字段都应该一致，&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;至少要检验关键字段的一致性&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;（如单号，金额，用户等）。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;无论是“第一次来”还是“被幂等了”，最后返回的结果，&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;应该是完全相同的&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;对于调用方需要判断幂等场景，并作相应的处理。&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;h2&gt;&lt;strong&gt;&lt;span&gt;case 2：以业务幂等表做幂等&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.99453125&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/I8SfHxT94hWzMcDiax89miaZV8v6OfSyvWceAAEzfchB9Rf12l0zu39EQDRNurqtepzoR4jT6U2m8ricVzdYgmTGw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;说明：&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;section&gt;&lt;span&gt;首先，所有的操作都应该在事务中完成，并且严格按照：一锁二判三更新实施。&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;section&gt;&lt;span&gt;try-insert是一种处理幂等的模式，通过数据库主键约束和java异常处理完成幂等判断。&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;p&gt;&lt;span&gt;其他的步骤类似case1，这里不再赘述。&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section data-role=&quot;list&quot;&gt;&lt;section&gt;&lt;span&gt;当然，不是所有的代码实现都和上述的情况相同，建议结合代码学习和实践。&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.21466666666666667&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/I8SfHxT94hWzMcDiax89miaZV8v6OfSyvWQItuwCJJcibu8fjuLEdMHafia55m30Vr4DiaRDLXv1DZZ3XTBzc4k2iauA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1500&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;case 1和 case 2的本质区别是什么？&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;case1和case2的主要区别在于业务单据的UK是否与业务幂等规则一致。&lt;/span&gt;&lt;span&gt;直接用业务单做幂等，适合业务比较简单的情况，比如你就一个服务需要幂等。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;什么场景用case 1什么场景用case 2？&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;为什么会有不一致的场景。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;我们遇到的情况是同一张流水表上承载了不同的产品，而不同产品的幂等规则不一致，如果UK全部加到通用流水表上，会对其产生侵入甚至产生互斥，而且UK多了会降低表的插入性能。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;其实不同场景就是把幂等服务和幂等表独立了出来。如果你的系统有多个服务都需要用幂等逻辑，那么这种方式的扩展性会好一点，便于后续的升级和修改。另外，在分库分表的情况下，case2中的幂等表其实还保存了业务单号，此时幂等表还承担了路由表的角色。&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;section data-role=&quot;title&quot; data-tools=&quot;135编辑器&quot; data-id=&quot;119028&quot;&gt;&lt;section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section hm_fix=&quot;218:327&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;strong data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;04&lt;/strong&gt;&lt;/section&gt;&lt;section data-width=&quot;100%&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;&gt;&lt;br data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;strong&gt;举一反三&lt;/strong&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;由同步调用的幂等性，可以引申出：&lt;/span&gt;&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;DB幂等键的设计（唯一索引的设计）&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;消息发送和接收的幂等性处理&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;定时任务的幂等性处理&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;超时任务的幂等性处理&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;全局幂等表的接入和使用&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;分布式事务的幂等处理&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section data-role=&quot;title&quot; data-tools=&quot;135编辑器&quot; data-id=&quot;119028&quot;&gt;&lt;section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section hm_fix=&quot;218:327&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;strong data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;05&lt;/strong&gt;&lt;/section&gt;&lt;section data-width=&quot;100%&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;&gt;&lt;br data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;span&gt;&lt;strong&gt;Notes：幂等处理如何做&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;可以&lt;/span&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;从幂等处理对象操作类型进行分类&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;幂等表也存在一些弊端，就是引入额外的DB操作，以及后续的数据订正和迁移都要比直接用业务表做幂等复杂。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span/&gt;&lt;/p&gt;&lt;section data-role=&quot;title&quot; data-tools=&quot;135编辑器&quot; data-id=&quot;119028&quot;&gt;&lt;section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section hm_fix=&quot;218:327&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot;&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;strong data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;06&lt;/strong&gt;&lt;/section&gt;&lt;section data-width=&quot;100%&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;&gt;&lt;br data-darkmode-bgcolor-16678013048235=&quot;rgb(149, 208, 205)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)|rgb(176, 245, 242)&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-darkmode-bgcolor-16678013048235=&quot;rgb(187, 191, 195)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(255, 255, 255)|rgb(243, 248, 254)&quot; data-darkmode-color-16678013048235=&quot;rgb(6, 84, 234)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(6, 84, 234)&quot;&gt;&lt;span&gt;&lt;strong&gt;总结&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;总之，对于幂等设计，只要记住本文的第一句话就好：&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;无论调用方还是服务方，对于任何有状态（涉及状态修改）的服务，&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span data-style=&quot;background-color: rgb(255, 255, 255); letter-spacing: 1px; color: rgb(0, 128, 255); outline: 0px; max-width: 100%; font-size: 14px; caret-color: red; visibility: visible; font-family: &amp;quot;Tahoma For Number&amp;quot;, &amp;quot;Chinese Quote&amp;quot;, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Roboto, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__37&quot;&gt;在设计服务、编码时，都必须考虑幂等性。&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-role=&quot;outer&quot; label=&quot;edit by 135editor&quot;&gt;&lt;section data-role=&quot;paragraph&quot;&gt;&lt;section data-role=&quot;paragraph&quot;&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot; data-style=&quot;margin-bottom: 0em; outline: 0px; max-width: 100%; box-sizing: border-box; color: rgb(34, 34, 34); letter-spacing: 0.544px; white-space: normal; caret-color: rgb(34, 34, 34); text-size-adjust: inherit; background-color: rgb(255, 255, 255); font-size: 16px; font-family: system-ui, -apple-system, system-ui, &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei UI&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; overflow-wrap: break-word !important;&quot;&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot;&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot;&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot;&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot;&gt;&lt;section data-darkmode-bgcolor-16518176071663=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16518176071663=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-bgcolor-16526830592083=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16526830592083=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16526830592083=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16526830592083=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16532902304850=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16532902304850=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16532902304850=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16532902304850=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16538961289579=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16538961289579=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16538961289579=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16538961289579=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16544970019867=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16544970019867=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16544970019867=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16544970019867=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16569143641019=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16569143641019=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16569143641019=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16569143641019=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16575230563660=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(25, 25, 25)&quot;&gt;&lt;section data-darkmode-bgcolor-16518176071663=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16518176071663=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-bgcolor-16526830592083=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16526830592083=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16526830592083=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16526830592083=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16532902304850=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16532902304850=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16532902304850=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16532902304850=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16538961289579=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16538961289579=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16538961289579=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16538961289579=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16544970019867=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16544970019867=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16544970019867=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16544970019867=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16569143641019=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16569143641019=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16569143641019=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16569143641019=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16575230563660=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(25, 25, 25)&quot;&gt;&lt;svg viewbox=&quot;0 0 1 1&quot; data-darkmode-bgcolor-16518176071663=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16518176071663=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-bgcolor-16526830592083=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16526830592083=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16526830592083=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16526830592083=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16532902304850=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16532902304850=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16532902304850=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16532902304850=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16538961289579=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16538961289579=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16538961289579=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16538961289579=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16544970019867=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16544970019867=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16544970019867=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16544970019867=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16569143641019=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16569143641019=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16569143641019=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16569143641019=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16575230563660=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(25, 25, 25)&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot;&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot;&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot;&gt;&lt;section data-darkmode-bgcolor-16518176071663=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16518176071663=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-bgcolor-16526830592083=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16526830592083=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16526830592083=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16526830592083=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16532902304850=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16532902304850=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16532902304850=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16532902304850=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16538961289579=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16538961289579=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16538961289579=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16538961289579=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16544970019867=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16544970019867=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16544970019867=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16544970019867=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16569143641019=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16569143641019=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16569143641019=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16569143641019=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16575230563660=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(25, 25, 25)&quot;&gt;&lt;section data-darkmode-bgcolor-16518176071663=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16518176071663=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-bgcolor-16526830592083=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16526830592083=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16526830592083=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16526830592083=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16532902304850=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16532902304850=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16532902304850=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16532902304850=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16538961289579=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16538961289579=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16538961289579=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16538961289579=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16544970019867=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16544970019867=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16544970019867=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16544970019867=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16569143641019=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16569143641019=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16569143641019=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16569143641019=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16575230563660=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(25, 25, 25)&quot;&gt;&lt;section data-darkmode-bgcolor-16518176071663=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16518176071663=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-bgcolor-16526830592083=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16526830592083=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16526830592083=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16526830592083=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16532902304850=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16532902304850=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16532902304850=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16532902304850=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16538961289579=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16538961289579=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16538961289579=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16538961289579=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16544970019867=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16544970019867=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16544970019867=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16544970019867=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16569143641019=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16569143641019=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16569143641019=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16569143641019=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16575230563660=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(25, 25, 25)&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.1503267973856209&quot; data-type=&quot;gif&quot; data-w=&quot;306&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_gif/I8SfHxT94hVCpsg0j390w6mNUrLXEicv7IzQCSd37F6kibGnqCe8PGp0iazd8Eo5ichyjuJmC6cWx9KDAJLXpPglDg/640?wx_fmt=gif&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&amp;amp;wx_co=1&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot;&gt;&lt;section data-darkmode-bgcolor-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot;&gt;&lt;section data-darkmode-bgcolor-16518176071663=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16518176071663=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-bgcolor-16526830592083=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16526830592083=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16526830592083=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16526830592083=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16532902304850=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16532902304850=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16532902304850=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16532902304850=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16538961289579=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16538961289579=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16538961289579=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16538961289579=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16544970019867=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16544970019867=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16544970019867=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16544970019867=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16569143641019=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16569143641019=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16569143641019=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16569143641019=&quot;#fff|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16575230563660=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16575230563660=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16575230563660=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16575230563660=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16587294727069=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16587294727069=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16587294727069=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16587294727069=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16593397383442=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16593397383442=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16593397383442=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16593397383442=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16599445342001=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16599445342001=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16599445342001=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16599445342001=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16605471479291=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16605471479291=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16605471479291=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16605471479291=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16665918596777=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(25, 25, 25)&quot;&gt;&lt;br data-darkmode-bgcolor-16665918596777=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)|rgb(109, 103, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)|rgb(25, 25, 25)&quot; data-darkmode-bgcolor-16678013048235=&quot;rgb(109, 103, 255)&quot; data-darkmode-original-bgcolor-16678013048235=&quot;#fff|rgb(109, 103, 255)&quot; data-darkmode-color-16678013048235=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-color-16678013048235=&quot;#fff|rgb(25, 25, 25)&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-darkmode-bgcolor-16665918596777=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16665918596777=&quot;#fff|rgb(255, 255, 255)&quot; data-darkmode-color-16665918596777=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16665918596777=&quot;#fff|rgb(34, 34, 34)&quot; data-style=&quot;margin-top: 8px; margin-bottom: 0em; outline: 0px; max-width: 100%; color: rgb(34, 34, 34); letter-spacing: 0.544px; white-space: normal; text-align: left; caret-color: rgb(34, 34, 34); text-size-adjust: inherit; background-color: rgb(255, 255, 255); font-family: system-ui, -apple-system, system-ui, &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei UI&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot;&gt;&lt;p&gt;&lt;span&gt;更多代码设计内容：&lt;/span&gt;&lt;/p&gt;&lt;section data-tools=&quot;135编辑器&quot; data-id=&quot;87777&quot;&gt;&lt;section&gt;&lt;section hm_fix=&quot;296:436&quot;&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3NzczMDI4Ng==&amp;amp;mid=2247485510&amp;amp;idx=1&amp;amp;sn=3e9a1ec9e472e8db0c6ffc63cca3b300&amp;amp;chksm=fd016bc7ca76e2d1daeeae07906f9d39aca7ed51aed65bbe4b19ce3bd70afcbc97b5865ed107&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;从0到1教你写好系分&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;&lt;span&gt;‍&lt;/span&gt;&lt;/a&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3NzczMDI4Ng==&amp;amp;mid=2247485635&amp;amp;idx=1&amp;amp;sn=1eb844a012e3d68f9b08dcb3bd5d98d2&amp;amp;chksm=fd016b42ca76e2547ab662890e9b50d6ec64060103f62b888cdeaab41b2902ffa2b3f205ef45&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;如何通过代码重构让你的代码赏心悦目？&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;如何通过代码重构让你的代码赏心悦目？&lt;/a&gt;&lt;/section&gt;&lt;section&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3NzczMDI4Ng==&amp;amp;mid=2247485510&amp;amp;idx=1&amp;amp;sn=3e9a1ec9e472e8db0c6ffc63cca3b300&amp;amp;chksm=fd016bc7ca76e2d1daeeae07906f9d39aca7ed51aed65bbe4b19ce3bd70afcbc97b5865ed107&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;从0到1教你写好系分&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;从0到1教你写好系分&lt;/a&gt;&lt;/section&gt;&lt;section data-style=&quot;margin-top: 8px; margin-bottom: 8px; font-size: 14px; color: rgb(34, 34, 34); letter-spacing: 0.544px; outline: 0px; max-width: 100%; text-align: left; caret-color: rgb(34, 34, 34); text-size-adjust: inherit; line-height: 1.75em; font-family: system-ui, -apple-system, system-ui, &amp;quot;Helvetica Neue&amp;quot;, &amp;quot;PingFang SC&amp;quot;, &amp;quot;Hiragino Sans GB&amp;quot;, &amp;quot;Microsoft YaHei UI&amp;quot;, &amp;quot;Microsoft YaHei&amp;quot;, Arial, sans-serif; box-sizing: border-box !important; overflow-wrap: break-word !important;&quot; class=&quot;js_darkmode__333&quot;&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3NzczMDI4Ng==&amp;amp;mid=2247485349&amp;amp;idx=1&amp;amp;sn=bdaf46ea93e2e2b7a4647000d1567e9b&amp;amp;chksm=fd016424ca76ed32f319028608b952bfd7b1eeb65c43c19741d6e66c5c9d3cb94a5c93d523fa&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;设计模式实践&amp;amp;技巧大盘点：帮你打开思路，灵活变通各类应用场景&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;设计模式实践&amp;amp;技巧大盘点：帮你打开思路，灵活变通各类应用场景&lt;/a&gt;&lt;/section&gt;&lt;/section&gt;&lt;section data-style=&quot;margin-top: -3em; max-width: 100%; width: 0.38em; overflow: hidden; float: left; background-color: rgb(254, 254, 254);&quot; class=&quot;js_darkmode__335&quot;&gt;&lt;section data-style=&quot;max-width: 100%; height: 1em; width: 0.4em; background-color: rgb(79, 129, 189); overflow: hidden;&quot; class=&quot;js_darkmode__336&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-style=&quot;margin-top: 0.2em; max-width: 100%; height: 0.5em; width: 0.4em; opacity: 0.8; background-color: rgb(79, 129, 189); overflow: hidden; transform: skewY(-30deg);&quot; class=&quot;js_darkmode__337&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-style=&quot;margin-top: 0.2em; max-width: 100%; height: 0.5em; width: 0.4em; opacity: 0.5; background-color: rgb(79, 129, 189); overflow: hidden; transform: skewY(-30deg);&quot; class=&quot;js_darkmode__338&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;section data-style=&quot;margin-top: 0.2em; max-width: 100%; height: 0.5em; width: 0.4em; opacity: 0.3; background-color: rgb(79, 129, 189); overflow: hidden; transform: skewY(-30deg);&quot; class=&quot;js_darkmode__339&quot;&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mp-common-profile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzU3NzczMDI4Ng==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/sz_mmbiz_png/I8SfHxT94hU6P7Y4EMhbdHr7WDSMZt9wjEZfR28HDTcOac5u4A8ibiaIR2Miad2cCILq1FCH6NHZesEoOXLeuBopA/0?wx_fmt=png&quot; data-nickname=&quot;蚂蚁研发效能&quot; data-alias=&quot;AntLinkE&quot; data-signature=&quot;蚂蚁集团研发效能部有业界领先的工程和学术造诣，致力于为蚂蚁和多家金融企业提供核电级的全生命周期研发产品。&quot; data-from=&quot;0&quot; data-is_biz_ban=&quot;0&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;p&gt;&lt;mp-style-type data-value=&quot;3&quot;/&gt;&lt;/p&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>c66fa55fcbb3900570764cd648f010b5</guid>
<title>Java 注解与原理分析</title>
<link>https://toutiao.io/k/03rb4y1</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content             autoTypeSetting24psection&amp;#10;            &quot; id=&quot;js_content&quot;&gt;&lt;blockquote&gt;&lt;p&gt;使用的太多，被忽略的理所当然；&lt;/p&gt;&lt;/blockquote&gt;&lt;h1&gt;&lt;span&gt;一、注解基础&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;注解即标注与解析，在Java的代码工程中，注解的使用几乎是无处不在，甚至多到被忽视；&lt;/p&gt;&lt;p&gt;无论是在JDK源码或者框架组件，都在使用注解能力完成各种识别和解析动作；在对系统功能封装时，也会依赖注解能力简化各种逻辑的重复实现；&lt;/p&gt;&lt;p&gt;&lt;strong&gt;基础接口&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;在Annotation的源码注释中有说明：所有的注解类型都需要继承该公共接口，本质上看注解是接口，但是代码并没有显式声明继承关系，可以直接查看字节码文件；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;-- &lt;span&gt;1&lt;/span&gt;、声明注解&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;@interface&lt;/span&gt; SystemLog {}&lt;br/&gt;&lt;br/&gt;-- &lt;span&gt;2&lt;/span&gt;、查看指令&lt;br/&gt;javap -v SystemLog&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;-- 3、打印结果&lt;br/&gt;&lt;span&gt;Compiled&lt;/span&gt; &lt;span&gt;from&lt;/span&gt; &quot;&lt;span&gt;SystemLog&lt;/span&gt;.&lt;span&gt;java&lt;/span&gt;&quot;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;interface&lt;/span&gt; &lt;span&gt;com&lt;/span&gt;.&lt;span&gt;base&lt;/span&gt;.&lt;span&gt;test&lt;/span&gt;.&lt;span&gt;SystemLog&lt;/span&gt; &lt;span&gt;extends&lt;/span&gt; &lt;span&gt;java&lt;/span&gt;.&lt;span&gt;lang&lt;/span&gt;.&lt;span&gt;annotation&lt;/span&gt;.&lt;span&gt;Annotation&lt;/span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;元注解&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;声明注解时使用，用来定义注解的作用目标，保留策略等；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Documented&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Inherited&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@Retention&lt;/span&gt;(RetentionPolicy.RUNTIME)&lt;br/&gt;&lt;span&gt;@Target&lt;/span&gt;(ElementType.METHOD)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;@interface&lt;/span&gt; SystemLog { &lt;span&gt;String &lt;span&gt;model&lt;/span&gt; &lt;span&gt;()&lt;/span&gt; &lt;span&gt;default&lt;/span&gt; &quot;&quot; &lt;/span&gt;; }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;Documented：是否被javadoc或类似工具记录在文档中；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Inherited：标识注解是否可以被子类继承；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Target：作用目标，在ElementType枚举中可以看到取值包括类、方法、属性等；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Retention：保留策略，比如编译阶段是否丢弃，运行时保留；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;此处声明一个SystemLog注解，作用范围是在方法上，并且在运行时保留，该注解通常用在服务运行时，结合AOP切面编程实现方法的日志采集；&lt;/p&gt;&lt;h1&gt;&lt;span&gt;二、注解原理&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p&gt;先来看一个简单的注解使用案例，再细致的分析其中原理，案例并不复杂，就是常见的标注与解析两个关键动作；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;LogInfo&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;@SystemLog&lt;/span&gt;(model = &lt;span&gt;&quot;日志模块&quot;&lt;/span&gt;)&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;main&lt;/span&gt;&lt;span&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;// 生成代理文件&lt;/span&gt;&lt;br/&gt;        System.getProperties().put(&lt;span&gt;&quot;sun.misc.ProxyGenerator.saveGeneratedFiles&quot;&lt;/span&gt;, &lt;span&gt;&quot;true&quot;&lt;/span&gt;);&lt;br/&gt;        &lt;span&gt;// 反射机制&lt;/span&gt;&lt;br/&gt;        Method[] methods = LogInfo&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;.&lt;span&gt;getMethods&lt;/span&gt;()&lt;/span&gt;;&lt;br/&gt;        &lt;span&gt;for&lt;/span&gt; (Method method:methods){&lt;br/&gt;            SystemLog systemLog = method.getAnnotation(SystemLog&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;) &lt;/span&gt;;&lt;br/&gt;            &lt;span&gt;if&lt;/span&gt; (systemLog != &lt;span&gt;null&lt;/span&gt;){&lt;br/&gt;                &lt;span&gt;// 动态代理：com.sun.proxy.$Proxy2&lt;/span&gt;&lt;br/&gt;                System.out.println(systemLog.getClass().getName());&lt;br/&gt;                System.out.println(systemLog.model());&lt;br/&gt;            }&lt;br/&gt;        }&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里涉及到两个核心概念：反射机制、动态代理；反射机制可以在程序运行时获取类的完整结构信息，代理模式给目标对象提供一个代理对象，由代理对象持有目标对象的引用；&lt;/p&gt;&lt;p&gt;案例中通过反射机制，在程序运行时进行注解的获取和解析，值得关注的是systemLog对象的类名，输出的是代理类信息；&lt;/p&gt;&lt;p&gt;案例执行完毕后，会在代码工程的目录下生成代理类，可以查看&lt;code&gt;$Proxy2&lt;/code&gt;文件；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; $&lt;span&gt;Proxy2&lt;/span&gt; &lt;span&gt;extends&lt;/span&gt; &lt;span&gt;Proxy&lt;/span&gt; &lt;span&gt;implements&lt;/span&gt; &lt;span&gt;SystemLog&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String &lt;span&gt;model&lt;/span&gt;&lt;span&gt;()&lt;/span&gt; &lt;span&gt;throws&lt;/span&gt;  &lt;/span&gt;{&lt;br/&gt;        &lt;span&gt;try&lt;/span&gt; {&lt;br/&gt;            &lt;span&gt;return&lt;/span&gt; (String)&lt;span&gt;super&lt;/span&gt;.h.invoke(&lt;span&gt;this&lt;/span&gt;, m3, (Object[])&lt;span&gt;null&lt;/span&gt;);&lt;br/&gt;        } &lt;span&gt;catch&lt;/span&gt; (RuntimeException | Error var2) {&lt;br/&gt;            &lt;span&gt;throw&lt;/span&gt; var2;&lt;br/&gt;        } &lt;span&gt;catch&lt;/span&gt; (Throwable var3) {&lt;br/&gt;            &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; UndeclaredThrowableException(var3);&lt;br/&gt;        }&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在对SystemLog解析的过程中，实际上是在使用注解的代理类，&lt;code&gt;$Proxy2&lt;/code&gt;继承了Proxy类并实现了SystemLog接口，并且重写了相关方法；有关反射和代理的逻辑，在之前的内容中有详说，此处不赘述；&lt;/p&gt;&lt;p&gt;值得一看是代理类中invoke方法调用，具体的处理逻辑在AnnotationInvocationHandler类的invoke方法中，会对注解原生方法和自定义方法做判断，并对原生方法提供实现；&lt;/p&gt;&lt;h1&gt;&lt;span&gt;三、常用注解&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span&gt;1、JDK注解&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;在JDK中有多个注解是经常使用的，例如Override、Deprecated、SuppressWarnings等；&lt;/p&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;Override：判断方法是否为重写方法；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Deprecated：标记过时的API，继续使用会警告；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;FunctionalInterface：检验是否为函数式接口；&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;SuppressWarnings：代码的警告会静默处理；&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;这里注意FunctionalInterface注解，从1.8开始引入，检验是否为函数式接口，即接口只能有一个抽象方法，否则编译报错；&lt;/p&gt;&lt;h2&gt;&lt;span&gt;2、Lombok注解&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;在具体的看Lombok组件之前，需要先了解一个概念：代码编译；在open-jdk的描述文档中大致分为三个核心阶段；&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.19609375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvDF4KFjn0ZHMYibiccxkKc7GpBp33Sj0lN42AO5EvZPqIgVG46JicOYUJTnPBuV1W1KxvL7gWPvZ6icVw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;第一步：读取命令行上指定的所有源文件，解析为语法树，进行符号表填充；&lt;/p&gt;&lt;p&gt;第二步：调用注解处理器，如果处理器生成任何新的源文件或类文件，编译会重新启动；&lt;/p&gt;&lt;p&gt;第三步：分析器创建的语法树被分析并转换为类文件；&lt;/p&gt;&lt;p&gt;更多细节说明可以参考openjdk文档中Compiler模块的内容，下面再回到Lombok组件上；&lt;/p&gt;&lt;p&gt;Lombok组件在代码工程中的使用非常频繁，通过注解的方式极大的简化Java中Bean对象的编写，提高了效率并且让源码显得简洁；&lt;/p&gt;&lt;p&gt;这里用一段简单的代码演示其效果，在IdKey的类中通过三个常用的Lombok注解，替代了类中很多基础方法的显式生成，查看编译后的文件实际是存在相关方法的；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Data&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@AllArgsConstructor&lt;/span&gt;&lt;br/&gt;&lt;span&gt;@NoArgsConstructor&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;IdKey&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; Integer id ;&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; String key ;&lt;br/&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;main&lt;/span&gt;&lt;span&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        IdKey idKey01 = &lt;span&gt;new&lt;/span&gt; IdKey(&lt;span&gt;1&lt;/span&gt;,&lt;span&gt;&quot;cicada&quot;&lt;/span&gt;) ;&lt;br/&gt;        System.out.println(idKey01);&lt;br/&gt;        idKey01.setId(&lt;span&gt;2&lt;/span&gt;);&lt;br/&gt;        idKey01.setKey(&lt;span&gt;&quot;smile&quot;&lt;/span&gt;);&lt;br/&gt;        System.out.println(idKey01);&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里需要了解JDK中注解处理器的相关源码，AbstractProcessor作为超类，编译器在编译时会去检查该类的子类，子类中最核心的是process方法；&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.19609375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvDF4KFjn0ZHMYibiccxkKc7GpJwEqrZP2cSDyxWK1sWtQLL8k2bxdcD1aTwial86OuEmjiad79icEsiaAsg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;-- &lt;span&gt;1&lt;/span&gt;、Lombok处理器&lt;br/&gt;&lt;span&gt;@SupportedAnnotationTypes&lt;/span&gt;(&lt;span&gt;&quot;*&quot;&lt;/span&gt;)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;LombokProcessor&lt;/span&gt; &lt;span&gt;extends&lt;/span&gt; &lt;span&gt;AbstractProcessor&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;private&lt;/span&gt; JavacTransformer transformer;&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; &lt;span&gt;process&lt;/span&gt;&lt;span&gt;(Set&amp;lt;? extends TypeElement&amp;gt; annotations, RoundEnvironment roundEnv)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;         transformer.transform(prio, javacProcessingEnv.getContext(), cusForThisRound, cleanup);&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;-- &lt;span&gt;2&lt;/span&gt;、AST抽象树&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;JavacTransformer&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;transform&lt;/span&gt;&lt;span&gt;(&lt;span&gt;long&lt;/span&gt; priority, Context context, List&amp;lt;JCTree.JCCompilationUnit&amp;gt; compilationUnits,&lt;br/&gt;                          CleanupRegistry cleanup)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        JavacAST ast = &lt;span&gt;new&lt;/span&gt; JavacAST(messager, context, unit, cleanup);&lt;br/&gt;        ast.traverse(&lt;span&gt;new&lt;/span&gt; AnnotationVisitor(priority));&lt;br/&gt;        handlers.callASTVisitors(ast, priority);&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;-- &lt;span&gt;3&lt;/span&gt;、注解处理抽象类&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;abstract&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;JavacAnnotationHandler&lt;/span&gt;&amp;lt;&lt;span&gt;T&lt;/span&gt; &lt;span&gt;extends&lt;/span&gt; &lt;span&gt;Annotation&lt;/span&gt;&amp;gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;abstract&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;handle&lt;/span&gt;&lt;span&gt;(AnnotationValues&amp;lt;T&amp;gt; annotation, JCAnnotation ast, JavacNode annotationNode)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;-- &lt;span&gt;4&lt;/span&gt;、Getter注解处理&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;HandleGetter&lt;/span&gt; &lt;span&gt;extends&lt;/span&gt; &lt;span&gt;JavacAnnotationHandler&lt;/span&gt;&amp;lt;&lt;span&gt;Getter&lt;/span&gt;&amp;gt; &lt;/span&gt;{&lt;br/&gt;    &lt;span&gt;@Override&lt;/span&gt; &lt;br/&gt;    &lt;span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; &lt;span&gt;handle&lt;/span&gt;&lt;span&gt;(AnnotationValues&amp;lt;Getter&amp;gt; annotation, JCTree.JCAnnotation ast, JavacNode annotationNode)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;        JavacNode node = annotationNode.up();&lt;br/&gt;        List&amp;lt;JCTree.JCAnnotation&amp;gt; onMethod = unboxAndRemoveAnnotationParameter(ast, &lt;span&gt;&quot;onMethod&quot;&lt;/span&gt;, &lt;span&gt;&quot;@Getter(onMethod&quot;&lt;/span&gt;, annotationNode);&lt;br/&gt;        &lt;span&gt;switch&lt;/span&gt; (node.getKind()) {&lt;br/&gt;            &lt;span&gt;case&lt;/span&gt; FIELD:&lt;br/&gt;                createGetterForFields(level, fields, annotationNode, &lt;span&gt;true&lt;/span&gt;, lazy, onMethod);&lt;br/&gt;                &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;        }&lt;br/&gt;    }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;IdKey类从简洁的源码编译为复杂的字节码文件，通过注解对结构处理时关联一个核心概念，叫AST抽象树，会涉及到很多语法、词法的解析逻辑；&lt;/p&gt;&lt;h1&gt;&lt;span&gt;四、自定义注解&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;p&gt;在系统开发中通过自定义注解可以处理各种麻烦的重复逻辑，其最明显的好处就是可以大量的消除冗余的代码块；&lt;/p&gt;&lt;h2&gt;&lt;span&gt;1、同步控制&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;代码中可能存在很多方法是限制重复请求的，加锁处理是很常用的手段，此时完全可以通过注解结合AOP切面编程简化代码的复杂程度；&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Retention&lt;/span&gt;(RetentionPolicy.RUNTIME)&lt;br/&gt;&lt;span&gt;@Target&lt;/span&gt;(ElementType.METHOD)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;@interface&lt;/span&gt; SyncLock {&lt;br/&gt;    &lt;span&gt;String &lt;span&gt;lockKey&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;/span&gt;;           &lt;span&gt;// 锁的Key&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;int&lt;/span&gt; &lt;span&gt;time&lt;/span&gt; &lt;span&gt;()&lt;/span&gt; &lt;span&gt;default&lt;/span&gt; 3000 &lt;/span&gt;;  &lt;span&gt;// 有效时间&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;&lt;span&gt;int&lt;/span&gt; &lt;span&gt;retryNum&lt;/span&gt; &lt;span&gt;()&lt;/span&gt; &lt;span&gt;default&lt;/span&gt; 3 &lt;/span&gt;; &lt;span&gt;// 重试次数&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;通过注解标记在方法上，可以极大简化同步锁的编码步骤，只是在读取KEY的时候需要设计好解析规则，结合反射原理进行获取即可；&lt;/p&gt;&lt;p&gt;基于相同的原理，也适应与日志采集、系统告警等功能，在之前的内容中都有详细的总结；&lt;/p&gt;&lt;h2&gt;&lt;span&gt;2、类型引擎&lt;/span&gt;&lt;span/&gt;&lt;/h2&gt;&lt;p&gt;在数据处理的逻辑中，经常有这样一种场景，同一份数据要动态推送到多种数据源中存储，比如常见的MySQL表和ES索引双写模式，这就需要对实体对象做不同的解析逻辑；&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.325&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvDF4KFjn0ZHMYibiccxkKc7GpR3iaYwpO795djZpyOHoFnk573eWnujWzrgJQDdviaKX2ibXZ21F6JSE8A/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@Retention&lt;/span&gt;(RetentionPolicy.RUNTIME)&lt;br/&gt;&lt;span&gt;@Target&lt;/span&gt;(ElementType.FIELD)&lt;br/&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;@interface&lt;/span&gt; BizType {&lt;br/&gt;    &lt;span&gt;EsIndexEnum &lt;span&gt;esIndexEnum&lt;/span&gt; &lt;span&gt;()&lt;/span&gt; &lt;/span&gt;;        &lt;span&gt;// ES索引解析适配&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;MySqlTableEnum &lt;span&gt;mySqlTableEnum&lt;/span&gt; &lt;span&gt;()&lt;/span&gt; &lt;/span&gt;;  &lt;span&gt;// MySQL表解析适配&lt;/span&gt;&lt;br/&gt;    &lt;span&gt;ExcelEnum &lt;span&gt;excelEnum&lt;/span&gt; &lt;span&gt;()&lt;/span&gt; &lt;/span&gt;;            &lt;span&gt;// Excel解析适配&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;首先声明一个类型解析的注解，可以标记在实体对象的字段属性上，然后根据各种数据源的类型枚举，去适配不同解析工厂的执行逻辑，比如常用数据类型、格式、或者完全自定义。&lt;/p&gt;&lt;h1&gt;&lt;span&gt;五、参考源码&lt;/span&gt;&lt;span/&gt;&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;编程文档：&lt;br/&gt;https://gitee.com/cicadasmile/butte-java-note&lt;br/&gt;&lt;br/&gt;应用仓库：&lt;br/&gt;https://gitee.com/cicadasmile/butte-flyer-parent&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mp-common-profile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzU4Njg0MzYwNw==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvBj3abVSgCmvm7FIYw55ficInd2se9ia6KSic0ma25AUvrmUtXUwXibjhHmCc7DUawfXBI30QuHBjDnzw/0?wx_fmt=png&quot; data-nickname=&quot;知了一笑&quot; data-alias=&quot;cicada_smile&quot; data-signature=&quot;积累、总结、用心记录。&quot; data-from=&quot;0&quot; data-is_biz_ban=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;mp-style-type data-value=&quot;3&quot;/&gt;&lt;/p&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>b2fe1b4053ec2a417b552060cb7bfa51</guid>
<title>硬核 |  Kafka 如何解决消息不丢失？</title>
<link>https://toutiao.io/k/wc9et5u</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content js_underline_content             &quot; id=&quot;js_content&quot;&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;大家好，我是Tom哥~&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Kafka 消息框架，大家一定不陌生，很多人工作中都有接触。它的核心思路，通过一个高性能的&lt;code&gt;MQ服务&lt;/code&gt;来连接&lt;code&gt;生产&lt;/code&gt;和&lt;code&gt;消费&lt;/code&gt;两个系统，达到系统间的解耦，有很强的扩展性。&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.21565495207667731&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/2KTof9YshwfJHeDicSic4poKsekZn3eJPogic2saHicNwQxRVOAic3XMeLBY9ZubflhH9icZBGl37Xd2VpJ8oNiczZQjw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1252&quot;/&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;你可能会有疑问，如果中间某一个环节断掉了，那怎么办？&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.20593080724876442&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/2KTof9YshwfJHeDicSic4poKsekZn3eJPo4lPD1JK7zOtFnTFpECXQrQicx0icot89ibTn7MlkB3icfTEicQ8F00tQa0Q/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1214&quot;/&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这种情况，我们称之为&lt;code&gt;消息丢失&lt;/code&gt;，会造成系统间的数据不一致。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;那如何解决这个问题？需要从&lt;code&gt;生产端&lt;/code&gt;、&lt;code&gt;MQ服务端&lt;/code&gt;、&lt;code&gt;消费端&lt;/code&gt;，三个维度来处理&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;1、生产端&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;生产端的职责就是，确保生产的消息能到达MQ服务端，这里我们需要有一个响应来判断本次的操作是否成功。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;code&gt;Future&amp;lt;RecordMetadata&amp;gt; send(ProducerRecord&amp;lt;K, V&amp;gt; record, Callback callback)&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;比如，上面的代码就是通过一个&lt;code&gt;Callback&lt;/code&gt;函数，来判断消息是否发送成功，如果失败，我们需要补偿处理。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;另外，为了提升发送时的灵活性，kafka提供了多种参数，供不同业务自己选择&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;1.1 参数 acks&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;该参数表示有多少个分区副本收到消息，才认为本次发送是成功的。&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;acks=0，只要发送消息就认为成功，生产端不等待服务器节点的响应&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;acks=1，表示生产者收到 leader 分区的响应就认为发送成功&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;acks=-1，只有当 ISR 中的副本全部收到消息时，生产端才会认为是成功的。这种配置是最安全的，但由于同步的节点较多，吞吐量会降低。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;1.2 参数 retries&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示生产端的重试次数，如果重试次数用完后，还是失败，会将消息临时存储在本地磁盘，待服务恢复后再重新发送。建议值 &lt;code&gt;retries=3&lt;/code&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;1.3 参数 retry.backoff.m&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;消息发送超时或失败后，间隔的重试时间。一般推荐的设置时间是 300 毫秒。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这里要特别注意一种特殊情况，如果MQ服务没有正常响应，不一定代表&lt;code&gt;消息发送失败&lt;/code&gt;，也有可能是响应时正好赶上网络抖动，响应超时。&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.5182481751824818&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/2KTof9YshwfJHeDicSic4poKsekZn3eJPoSya97EfdAlpibg6icXeSm1Bav0iaS2UH9TByKdymEcicQqwueXGxR7AZEA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;822&quot;/&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;span&gt;&lt;strong&gt;当生产端做完这些，一定能保证消息发送成功了，但可能发送多次，这样就会导致消息重复，这个我们后面再讲解决方案&lt;/strong&gt;&lt;/span&gt;&lt;/section&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong/&gt;&lt;/span&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;2、MQ服务端&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;MQ服务端作为消息的存储介质，也有可能会丢失消息。比如：一个分区突然挂掉，那么怎么保证这个分区的数据不丢失，我们会引入副本概念，通过备份来解决这个问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;具体可设置哪些参数？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;2.1 参数 replication.factor&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示分区副本的个数，&lt;code&gt;replication.factor &amp;gt;1&lt;/code&gt; 当leader 副本挂了，follower副本会被选举为leader继续提供服务。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;2.2 参数 min.insync.replicas&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示 ISR 最少的副本数量，通常设置 &lt;code&gt;min.insync.replicas &amp;gt;1&lt;/code&gt;，这样才有可用的follower副本执行替换，保证消息不丢失&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;2.3 参数 unclean.leader.election.enable&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;是否可以把非 ISR 集合中的副本选举为 leader 副本。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果设置为&lt;code&gt;true&lt;/code&gt;，而follower副本的同步消息进度落后较多，此时被选举为leader，会导致消息丢失，慎用。&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.6079447322970639&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/2KTof9YshwfJHeDicSic4poKsekZn3eJPoVNjWxLlzibPZm7r9f8RyBNkyr5rBjhyXEicVokgpWNzVLRvW7LvblCxA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1158&quot;/&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;3、消费端&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;消费端要做的是把消息完整的消费处理掉。但是这里面有个&lt;code&gt;提交位移&lt;/code&gt;的步骤。&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.42217898832684825&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/2KTof9YshwfJHeDicSic4poKsekZn3eJPoSfEWpBiaOyiaaItnnmIcnz8yuDSd7vklBicwqS2cHibajBmlekykO9FiaBQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1028&quot;/&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;有的同学，考虑到&lt;code&gt;业务处理&lt;/code&gt;消耗时间较长，会单独启动线程拉取消息存储到本地内存队列，然后再搞个线程池并行处理业务逻辑。这样设计有个风险，本地消息如果没有处理完，服务器宕机了，会造成消息丢失。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;正确的做法：拉取消息 ---  业务处理  ---- 提交消费位移&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;关于提交位移，kafka提供了集中参数配置&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;&lt;strong&gt;参数  enable.auto.commit&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;表示消费位移是否自动提交。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果拉取了消息，业务逻辑还没处理完，提交了消费位移但是消费端却挂了，消费端恢复或其他消费端接管该分片再也拉取不到这条消息，会造成消息丢失。所以，我们通常设置 &lt;code&gt;enable.auto.commit=false&lt;/code&gt;，手动提交消费位移。&lt;/p&gt;&lt;pre data-tool=&quot;mdnice编辑器&quot;&gt;&lt;code&gt;List&amp;lt;String&amp;gt; messages = consumer.poll()；&lt;br/&gt;processMsg(messages);&lt;br/&gt;consumer.commitOffset();&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这个方案，会产生另外一个问题，我们来看下这个图&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.3784219001610306&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/2KTof9YshwfJHeDicSic4poKsekZn3eJPoBuxXNL0daZoccpJ9Nt87CJOFa4BxQwcDVBDzzhmSHMU470Q3SDMFug/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1242&quot;/&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;拉取了&lt;code&gt;消息4~消息8&lt;/code&gt;，业务处理后，在提交消费位移时，不凑巧系统宕机了，最后的提交位移并没有保存到MQ 服务端，下次拉取消息时，依然是从&lt;code&gt;消息4&lt;/code&gt;开始拉取，但是这部分消息已经处理过了，这样便会导致重复消费。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;如何解决重复消费，避免引发数据不一致&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;首先，要解决MQ 服务端的重复消息。kafka 在  0.11.0 版本后，每条消息都有唯一的message id, MQ服务采用空间换时间方式，自动对重复消息过滤处理，保证接口的幂等性。&lt;/p&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img js_insertlocalimg&quot; data-ratio=&quot;0.69375&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/2KTof9YshwfJHeDicSic4poKsekZn3eJPoYicvCgIBzmWTECgicdLCsBXKsSAhhCSBBBcxuDNiaT6GaQjnia3m0IibBnw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但这个不能根本上解决消息重复问题，即使MQ服务中存储的消息没有重复，但消费端是采用拉取方式，如果重复拉取，也会导致&lt;code&gt;重复消费&lt;/code&gt;，如何解决这种场景问题？&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;方案一：只拉取一次（&lt;code&gt;消费者拉取消息后，先提交 offset 后再处理消息&lt;/code&gt;），但是如果系统宕机，业务处理没有正常结束，后面再也拉取不到这些消息，会导致数据不一致，该方案很少采用。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;方案二：允许拉取重复消息，但是消费端自己做幂等性控制。保证只&lt;code&gt;成功消费一次&lt;/code&gt;。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;关于幂等技术方案很多，我们可以采用&lt;code&gt;数据表&lt;/code&gt;或&lt;code&gt;Redis缓存&lt;/code&gt;存储处理标识，每次拉取到消息，处理前先校验处理状态，再决定是处理还是丢弃消息。&lt;/p&gt;&lt;pre&gt;&lt;section powered-by=&quot;xiumi.us&quot; data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(230, 230, 230)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(0, 0, 0)&quot;&gt;&lt;p data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(230, 230, 230)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(0, 0, 0)&quot;&gt;&lt;strong data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(230, 230, 230)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(0, 0, 0)&quot;&gt;&lt;span data-style=&quot;caret-color: red; font-size: 15px; color: rgb(0, 122, 170);&quot; class=&quot;js_darkmode__94&quot; data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(21, 189, 255)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(0, 122, 170)&quot;&gt;&lt;img class=&quot;__bg_gif rich_pages wxw-img&quot; data-fileid=&quot;100006471&quot; data-ratio=&quot;0.08658008658008658&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_gif/XVbUB37bCmAE7DFc2slTaY80fZSWeicgEfGFjfdZOReaAHD4m0PwmuiazjEzytmy3KTKs6jDiavlmv9xQ4FfvRqoA/640?wx_fmt=gif&quot; data-type=&quot;gif&quot; data-w=&quot;462&quot;/&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;section powered-by=&quot;xiumi.us&quot; data-style=&quot;margin: 10px 0em; color: rgb(89, 89, 89); letter-spacing: 0.544px;&quot; class=&quot;js_darkmode__95&quot; data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(138, 138, 138)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(89, 89, 89)&quot;&gt;&lt;section data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(138, 138, 138)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(89, 89, 89)&quot;&gt;&lt;section powered-by=&quot;xiumi.us&quot; data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(138, 138, 138)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(89, 89, 89)&quot;&gt;&lt;p data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(106, 104, 111)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(106, 104, 111)&quot;&gt;1.&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1MzE4OTU0OQ==&amp;amp;mid=2247489147&amp;amp;idx=1&amp;amp;sn=51d7ca2857e230d84b477adfdc6afece&amp;amp;chksm=fbf7ffb9cc8076afdac1ecdeb598c816a0b7a4afd65d43a51486b1943d958f903f107263e81f&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot; wah-hotarea=&quot;click&quot;&gt;Mysql完结汇总篇（18W字送给大家），完结撒花&lt;/a&gt;&lt;/p&gt;&lt;p data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(106, 104, 111)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(106, 104, 111)&quot;&gt;2.&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1MzE4OTU0OQ==&amp;amp;mid=2247489013&amp;amp;idx=1&amp;amp;sn=c605a4295d989243b7ed0abe18d11c6a&amp;amp;chksm=fbf7fc37cc807521b0c3965602291350416ccd20e88d31ad53c7e7fd802b11af17a3575fe7db&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;如何啃下JVM这座大山，完结撒花（完结篇）&lt;/a&gt;&lt;/p&gt;&lt;p data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(106, 104, 111)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(106, 104, 111)&quot;&gt;3.&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1MzE4OTU0OQ==&amp;amp;mid=2247489181&amp;amp;idx=1&amp;amp;sn=a28c43eb38cdd912336280b5d7dc130e&amp;amp;chksm=fbf7ff5fcc807649a70958cc440cedf900d91956e7d12f80f0271ef7393bbd244e6fa61d5fe3&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;最全的八股文线程池总结（臭不要脸）&lt;/a&gt;&lt;/p&gt;&lt;p data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(106, 104, 111)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(106, 104, 111)&quot;&gt;4.&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1MzE4OTU0OQ==&amp;amp;mid=2247489702&amp;amp;idx=1&amp;amp;sn=e48e74aa3468a57eac549d7acb9e1071&amp;amp;chksm=fbf7f164cc8078724b9082e9e7d4de4fd7e3c46dfebfd8b834e46b7fc88b85408908cc06f9d6&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;手把手教新人调优&lt;/a&gt;&lt;/p&gt;&lt;p data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(106, 104, 111)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(106, 104, 111)&quot;&gt;5.&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1MzE4OTU0OQ==&amp;amp;mid=2247489742&amp;amp;idx=1&amp;amp;sn=a785f0f8ce5a16a92afc9be3753355ad&amp;amp;chksm=fbf7f10ccc80781a1d62580750328ba088c10cf606342fd7f723cff5ba7b122623a2372b8bf5&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;上班摸鱼学习法&lt;/a&gt;&lt;/p&gt;&lt;p data-darkmode-bgcolor-15923650965579=&quot;rgb(36, 36, 36)&quot; data-darkmode-original-bgcolor-15923650965579=&quot;rgb(255, 255, 255)&quot; data-darkmode-color-15923650965579=&quot;rgb(106, 104, 111)&quot; data-darkmode-original-color-15923650965579=&quot;rgb(106, 104, 111)&quot;&gt;6.&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1MzE4OTU0OQ==&amp;amp;mid=2247489852&amp;amp;idx=1&amp;amp;sn=590d9ca28365d4f26c4e793701507438&amp;amp;chksm=fbf7f0fecc8079e8af5ee263f6379bd4c7edbb10899930a3239952a93cd9a9bef1c02393c413&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot; wah-hotarea=&quot;click&quot; hasload=&quot;1&quot;&gt;阻塞队列yyds&lt;/a&gt;&lt;/p&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzU1MzE4OTU0OQ==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/IJUXwBNpKlg4C0ZCBNbxUJHUC82nmVsFT2Vnxf3Wb2cWyy9tl4ciafSCKcKINW0JVhwyaM5pHQlEdIrnSNDNd0Q/0?wx_fmt=png&quot; data-nickname=&quot;黎杜&quot; data-alias=&quot;LDCldc123095&quot; data-signature=&quot;专注Java技术文章输出100年&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/div&gt;

          
        &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>23ed0f33bbabbc61a3ccefc271e0bd82</guid>
<title>盘点那些 Go 的最佳应用场景</title>
<link>https://toutiao.io/k/1c9kenl</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span&gt;Golang 是一种在开发人员中越来越受欢迎的编程语言。&lt;/span&gt;&lt;span&gt;它是一种编译型语言，与 C/C++ 和 Java 有一些相似之处，与其他语言相比具有多种优势。&lt;/span&gt;&lt;span&gt;Golang 可用于广泛的应用程序，例如 Web 开发、机器学习和系统编程。&lt;/span&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果你正在寻找一种构建可扩展应用程序的有效方法，Golang 是一个很好的选择。此外，它是开源的，这意味着有大量可用的库可以帮助你使应用程序运行得更快、更高效。如果你想知道什么样的应用程序可以使用 Golang，请按照本文了解 Golang 开发的最佳场景。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;1. API 开发&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Golang 开发的最佳场景是 API 开发、云计算和区块链。API 开发是为你的企业构建网站并使其独一无二的好方法。这也是让你的网站快速启动和运行的好方法。云计算是企业按需拥有大量计算能力的一种方式。区块链是一种按需拥有大量计算能力并确保数据安全的方法。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;如果你的公司涉及应用程序和 Web 开发，请考虑使用 Golang 开发服务，因为它具有广泛的应用程序以及它提供的优势，包括大规模扩展和快速计算数据。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;2. Web 开发&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Golang 开发最常见的用途之一是创建 Web 应用。它允许开发人员简单地创建 Web 应用程序，而不必担心扩展它们。它是一种高级开源编程语言，通常用于构建 Web 应用程序。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;很多人使用 Golang 是因为它非常快，而且它可以用来并行运行进程，这样他们就不必互相等待。它内置了对并发的支持，并促进了单个进程中线程和处理器之间的并行性。这可以使你的网站更容易快速加载并为你提供最佳的用户体验。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3. 移动应用开发&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Golang 开发的另一个很好的用例是当你需要创建具有很多特性或功能的应用程序时。它允许他们构建可以处理大量数据的系统，而不会像其他语言那样崩溃或被错误淹没。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;例如，如果你正在开发一个需要与其他系统或数据库连接的应用程序，那么 Golang 可能是最好的选择，因为它可以让你快速编写代码，而不必担心你的每个部分需要多少内存或存储空间。程序在任何给定的时间。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;4. 基于云的应用程序&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;随着 Golang 的流行，许多基于云的应用程序已经使用这种编程语言创建。基于云的应用程序正变得越来越流行，因为它们为开发人员提供了一种从世界任何地方访问他们的程序的方法，而不必担心维护服务器或配置他们自己的系统。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;此外，基于云的应用程序通常比使用传统方法构建的应用程序更快且可扩展性更强，因为它们在已针对性能和可扩展性进行了优化的环境中运行。因此，在开发基于云的应用程序时，Golang 是你的最佳选择。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5. 数据库实现&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Golang 是一种适用于各种用例的出色语言，包括数据库实现。这包括从小型个人数据库到在单个数据库管理系统 (DBMS) 中存储数亿条记录的大型企业系统。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;这种编程语言提供的灵活性允许开发人员为任何类型的数据存储问题创建自定义解决方案，无论是同时存储、检索、管理还是处理来自多个来源的数据。数据库实现需要大量代码，而 Golang 是理想的选择，因为它是一种简单的语言，快速且易于学习。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;6. 网络服务&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;使用 Golang 的另一种常见项目类型是网络服务。它是网络服务的绝佳选择，一些开发人员使用 Golang，因为它是世界上发展最快的编程语言之一。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;它们还需要很少的维护，使它们成为大型项目的理想选择。它是一种开源、跨平台、通用的编程语言，使开发人员可以轻松构建简单、可靠和高效的软件，以提供更快、更高效的网络服务。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;总结&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Golang 开发平台用途广泛且功能强大，这意味着它可以用于广泛的应用程序。这种编程语言的最佳场景是速度和效率是关键因素的地方。这种编程语言在设计时考虑了速度和灵活性，主要用于 Web 和应用程序开发。&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>0e66e583c2bd29c6c08783d7fed0a577</guid>
<title>一言不合就重构</title>
<link>https://toutiao.io/k/degpu57</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdnice编辑器&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;hello，大家好呀，我是小楼。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;前段时间不是在忙么，忙的内容之一就是花了点时间重构了一个&lt;strong&gt;服务的健康检查&lt;/strong&gt;组件，目前已经慢慢在灰度上线，本文就来分享下这次重构之旅，也算作个总结吧。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;背景&lt;/span&gt;&lt;/h1&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;服务健康检查简介&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;服务健康检查是应对分布式应用下某些服务节点不健康问题的一种解法。如下图，消费者调用提供方集群，通常通过注册中心获取提供方的地址，根据负载均衡算法选取某台具体机器发起调用。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.7849246231155779&quot; data-type=&quot;png&quot; data-w=&quot;995&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0RicpAsiaanRNOUNdMEDjJFYvzXJuEExtFvficSfMfia2KBtbicRAQgQPHvhFXzlInnb6vgyFQCNf83iaTw/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;假设某台机器意外宕机，服务消费方不能感知，就会导致流量有损，如果此时有一种检测服务节点健康状态并及时剔除的机制，就能大大增加线上服务的稳定性。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;原服务健康检查实现原理&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们是自研的注册中心，健康检查也算注册中心的一部分，其原理很简单，可分为三个阶段：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;从注册中心获取需要检查的实例（即地址，由ip、port组成）&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;对每个地址发起 TCP 建链请求，建链成功视为健康&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;对判定为不健康的实例进行摘除，对原不健康现在健康的实例进行恢复，摘除恢复通过调用注册中心提供的接口实现&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.12887438825448613&quot; data-type=&quot;png&quot; data-w=&quot;1226&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0RicpAsiaanRNOUNdMEDjJFYv0keQkx16A62XibpkjS23JWricqSFykF61BPe5mUjMDRIHUkiaib1pk7KKA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当然这是大致流程，还有不少细节，例如获取探活实例时一些不需要探活的服务会被排除（如一些基础服务如MySQL、Redis）；为了防止网络抖动导致健康状态判定有误，会增加一些判定策略，如连续 N 次建连失败视为不健康；对不健康实例摘除时也计算了摘除阈值，如一个集群的机器都被判定为不健康，那也不能把它们全摘了，因为此时全摘和不摘差别不大（请求都会报错），甚至全摘还要承担风险，考虑集群容量问题，可以设个阈值，如最多只能摘三分之一的机器。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;原服务健康检查存在的问题&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;1. 容量问题&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;原组件是物理机时代的产物，当时实例数量并不多，所以最初是单机设计，只部署在一台物理机上，随着公司业务发展，实例数量增多，单机达到瓶颈，于是做了一次升级，通过配置文件来指定每个节点的健康检查任务分片。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.41728395061728396&quot; data-type=&quot;png&quot; data-w=&quot;1620&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0RicpAsiaanRNOUNdMEDjJFYvERw4wIqMiblxXkaTxdSQKGCmdtZ0ia3DFriaTtaU6MRp92Wh8peIS2WmQ/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;2. 容灾问题&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;单机就必然存在宕机风险，即使检查任务已经做了分片，但是写在配置中，无法动态调配，当某个节点宕机，则它负责的实例健康检查就会失效。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;3.部署效率问题&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;部署在物理机且分片是写在配置中，无论是扩容还是机器过保置换，都要修改配置，人为操作效率太低，而且容易出错。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;4. 新需求支持效率问题&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;随着云原生时代的迈进，对健康检查提出了一些新的需求，例如只探端口的联通性可能不能代表服务的健康程度，甚至公司内还有一些其他不在注册中心上的服务也想复用这个健康检查组件的能力，日益增长的需求同原组件沉重的历史包袱之间存在着不可调和的矛盾。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;5. 迭代过程中的稳定性问题&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;原组件没有灰度机制，开发了新功能上线是一把梭，如果出问题，就是个大故障，影响面非常广。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;需要解决这么多问题，如果在原基础上改，稳定性和效率都非常令人头疼，于是一个念头油然而生：重构！&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;技术方案调研&lt;/span&gt;&lt;/h1&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;业界常见服务健康检查方案&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在设计新方案前，我们看看业界对于健康检查都是怎么做的，从两个角度展开调研，注册中心的健康检查和非注册中心的健康检查&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;注册中心健康检查&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;方案&lt;/th&gt;&lt;th&gt;代表产品&lt;/th&gt;&lt;th&gt;优点&lt;/th&gt;&lt;th&gt;缺点&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;SDK 心跳上报&lt;/td&gt;&lt;td&gt;Nacos 1.x 临时实例&lt;/td&gt;&lt;td&gt;&lt;br/&gt;&lt;/td&gt;&lt;td&gt;处理心跳消耗资源过多&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;SDK 长连接 + 心跳保持&lt;/td&gt;&lt;td&gt;Nacox 2.x 临时实例、SofaRegistry、Zookeeper&lt;/td&gt;&lt;td&gt;感知快&lt;/td&gt;&lt;td&gt;SDK 实现复杂&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;集中式主动健康检查&lt;/td&gt;&lt;td&gt;Nacos 永久实例&lt;/td&gt;&lt;td&gt;无需SDK参与，可实现语义探活&lt;/td&gt;&lt;td&gt;集中式压力大时，时延增大&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;非注册中心健康检查&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;h4 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;K8S 健康检查 — LivenessProbe&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;与集中式健康检查做对比&lt;/p&gt;&lt;section data-tool=&quot;mdnice编辑器&quot;&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;br/&gt;&lt;/th&gt;&lt;th&gt;LivenessProbe&lt;/th&gt;&lt;th&gt;原健康检查组件&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;实现方式&lt;/td&gt;&lt;td&gt;k8s原生，分布式（sidecar模式）&lt;/td&gt;&lt;td&gt;自研，集中式&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;检查发起者&lt;/td&gt;&lt;td&gt;kubelet，与业务容器在同一物理机&lt;/td&gt;&lt;td&gt;集中部署的服务&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;适用范围&lt;/td&gt;&lt;td&gt;k8s容器（弹性云）&lt;/td&gt;&lt;td&gt;容器、物理机、虚拟机等&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;支持的检查方式&lt;/td&gt;&lt;td&gt;tcp、http、exec、grpc&lt;/td&gt;&lt;td&gt;tcp、http&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;健康检查基本配置&lt;/td&gt;&lt;td&gt;容器启动延时检查时间、检查间隔时间、检查超时时间、最小连续成功数、最小连续失败数&lt;/td&gt;&lt;td&gt;检查超时时间、连续失败次数、最大摘除比例&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;检测不健康时动作&lt;/td&gt;&lt;td&gt;杀死容器，容器再根据重启策略决定是否重启&lt;/td&gt;&lt;td&gt;从注册中心上摘除&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;兜底&lt;/td&gt;&lt;td&gt;无&lt;/td&gt;&lt;td&gt;有，可配摘除比例&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/section&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;结合公司背景进行选型&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们的大背景是技术栈不统一，编程语言有 Java、Go、PHP、C++等，基于成本考虑，我们更倾向&lt;code&gt;瘦SDK&lt;/code&gt;的方案。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;于是注册中心常见的 &lt;code&gt;SDK 长连接+心跳保持&lt;/code&gt;方案被排除，SDK主动上报心跳也不考虑。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;而 K8S 的健康检查方案仅仅使用于 K8S 体系，我们还有物理机，而且 K8S 的 LivenessProbe 并不能做到开箱即用，至少我们不想让节点不健康时被杀死，兜底策略也需要重新开发。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所以最终我们还是选择了与原健康检查组件相同的方案 — 集中式主动健康检查。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;理想态&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;基于原健康检查组件在使用中的种种问题，我们总结出一个好的健康检查组件该有的样子：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;故障自动转移&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;可水平扩容&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;快速支持丰富灵活的需求&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;新需求迭代，本身的稳定性需要有保障&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;设计开发&lt;/span&gt;&lt;/h1&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;总体设计&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;组件由四大模块组成：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;Dispatcher：负责从数据源获取数据，生成并派发任务&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Prober：负责健康检查任务的执行&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Decider：根据健康检查结果决策是否需要变更健康状态&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Performer：根据决策结果执行相应动作&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;各模块对外暴露接口，隐藏内部实现。数据源面向接口编程，可替换。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;服务发现模型&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在详细介绍各个模块的设计之前，先简单介绍一下我们的服务发现模型，有助于后续的表述和理解。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一个服务名在公司内是唯一的，调用时需指定服务名，获取对应的地址。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一个服务又可以包含多个集群，集群可以是物理上的隔离集群，也可以是逻辑上的隔离集群，集群下再包含地址。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.3510226644555003&quot; data-type=&quot;png&quot; data-w=&quot;1809&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0RicpAsiaanRNOUNdMEDjJFYvBqIxYusgJC7GW7T4MI1N1Lal3xFiax7ciaXCVV2rkIfqUyibnTng6QH6g/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;协程模型设计&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;编程语言我们选择的是 Go，原因有二：第一是健康检查这种 IO 密集型任务与 Go 的协程调度比较契合，开发速度，资源占用都还可以；第二是我们组一直用 Go，经验丰富，所以语言选择我们没有太多的考虑。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但在协程模型的设计上，我们做了一些思考。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;数据源的获取，由于服务、集群信息不经常变化，所以缓存在内存中，每分钟进行一次同步，地址数据需要实时拉取。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Dispatcher 先获取所有的服务，然后根据服务获取集群，到这里都是在一个协程内完成，接下来获取地址有网络开销，所以开 N 个协程，每个协程负责一部分集群地址，每个地址都生成一个单独的任务，派发给 Prober。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Prober 负责健康检查，完全是 IO 操作，内部用一个队列存放派发来的任务，然后开很多协程从队列中取任务去做健康检查，检查完成后将结果交给 Decider 做决策。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;Decider 决策时比较重要的是需要算出是否会被兜底，这里有两点需要考虑：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;一是最初获取的实例状态可能不是最新了，需要重新获取一次；&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;二是对于同一个集群不能并发地去决策，决策应该串行才不会导致决策混乱，举个反例，如果一个集群3台机器，最多摘除1台，如果2台同时挂掉，并发决策时，2个协程各自以为能摘，最后结果是摘除了2台，和预期只摘1台不符。这个如何解决？我们最后搞了 N 个队列存放健康检查结果，按服务+集群的哈希值路由到队列，保证每个集群的检测结果都路由到同一个队列，再开 N 个协程，每个协程消费一个队列，这样就做到了顺序执行。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;决策之后的动作执行就是调用更新接口，所以直接共用决策的协程。用一张大图来总结：&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2769635475385194&quot; data-type=&quot;png&quot; data-w=&quot;2661&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0RicpAsiaanRNOUNdMEDjJFYv8vbg6M0mlaKnqFSuHMnoJXWqFqc8gibwicB29QpgjztQ4JibOufw3yqjA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;水平扩容 &amp;amp; 故障自动转移&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;水平扩容与故障自动转移只要能做到动态地数据分片即可，每个健康检查组件在启动时将自己注册到一个中心的协调器（可以是 etcd），并且监听其他节点的在线状态，派发任务时，按服务名哈希，判断该任务是否应该由自己调度，是则执行，否则丢弃。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.4584634603372892&quot; data-type=&quot;png&quot; data-w=&quot;1601&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0RicpAsiaanRNOUNdMEDjJFYvRm6QKB5CbV850Zdc3vXgd6AolcCUIS9WMYBbexIriaXQV6EbV6tUFHA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;当某个节点挂掉或者扩容时，其他节点都能感知到当前集群的变化，自动进行数据分片的重新划分。&lt;/p&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;小流量机制&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;小流量的实现采取部署两个集群的方式，一个正常集群，一个小流量集群，小流量集群负责部分不重要的服务，作为灰度，正常集群负责其他服务的健康检查任务。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;只需要共享一个小流量的配置即可，我们按组织、服务、集群、环境等维度去设计这个配置，基本可以任意粒度配置。&lt;/p&gt;&lt;figure data-tool=&quot;mdnice编辑器&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.6587982832618026&quot; data-type=&quot;png&quot; data-w=&quot;1398&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_png/xacdaKuBM0RicpAsiaanRNOUNdMEDjJFYvRySrWZrNeOibC6lsVJZeGyUEicVgiarLSvJvQKqVqPagJzgMUUPUoAPqA/640?wx_fmt=png&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;可扩展性&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可扩展性也是设计里非常重要的一环，可从数据源、检查方式扩展、过滤器等方面稍微谈一谈。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;数据源可插拔&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;面向接口编程，我们将数据源抽象为读数据源与写数据源，只要符合这两个接口的数据源，就能无缝对接。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;检查方式易扩展&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;健康检查其实就是给定一个地址，再加一堆配置去进行检查，至于怎么检查可以自己实现，目前已实现的有TCP、HTTP方式，未来还可能会实现诸如Dubbo、gRPC、thrift等语义级别的检查方式。&lt;/p&gt;&lt;h3 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;过滤器&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在派发任务时，有一个可能会随时修改的逻辑是过滤掉一些不需要检查的服务、集群、实例，这块用责任链的模式就能很好地实现，后期想增删就只需要插拔链中的一环即可。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;可扩展性是代码层面的内容，所以这里只列举了部分比较典型的例子。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;灰度上线&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;由于我们是重写了一个组件来代替原组件，需要平滑地替换旧系统，为此我们做了2方面的工作：&lt;/p&gt;&lt;ul data-tool=&quot;mdnice编辑器&quot; class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;设计了一个可按组织、服务、集群、环境等维度的降级开关，降级分为3档，不降级、半降级、全降级。不降级很好理解，就是啥正常工作，全降级是虽然检查，但是不摘除也不恢复，相当于空跑，半降级是只恢复健康但不摘除。试想如果健康检查在上线过程中，误摘除，此时降级，岂不是无法恢复健康？所以我们让它保留恢复能力。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;我们利用上述的小流量设计来逐步将服务迁移到新组件上来，灰度的服务新组件负责，非灰度的服务老组件负责，等全部灰度完成，停掉老组件，新组件的灰度集群再切换为正常集群。&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;踩坑调优&lt;/span&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;在灰度过程中，我们发现了一个问题，有的集群机器非常多，超过了1000台，而我们的决策是顺序执行，而且决策有时还会去实时查询实例状态，假设平均每次决策10ms，1000台顺序决策完也得10s，我们期望每轮的检测要在3秒左右完成，光这一个集群就得10秒，显然不能接受。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;为了我们做了第一次的优化：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我们当时在线上环境测试，一个集群有2000多台机器，但大部分机器是禁用的状态，也就是这部分机器其实做健康检查是个无用功，禁用的机器，无论是否健康都不会被消费，所以我们的第一个优化便是在派发任务时过滤掉禁用的机器，这样就解决了线下环境的问题。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;但我们上到生产环境时仍然发现决策很慢，线上一个集群只有少量的机器被禁用，第一次的优化基本就没什么效果了，而且线上机器数量可能更多，任务堆积会很严重，我们发现其他的队列可能比较空闲，只有大集群所在的队列很忙。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;所以我们进行了第二次优化：&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;从业务视角出发，其实需要顺序决策的只有不健康的实例，对于健康的实例决策时不需要考虑兜底，所以我们将按检查结果进行分类，健康的检查结果随机派发到任意队列处理，不健康的检查结果严格按服务+集群路由到特定队列处理，这样既保证了兜底决策时的顺序，也解决了队列负载不均衡的状况。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;总结&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;本文从健康检查的背景，原组件存在的问题，以及我们的理想态出发，调研了业界的方案，结合实际情况，选择了适合的方案，并总结之前系统的问题，设计一个更加合理的新系统，从开发闭环到上线。&lt;/p&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;我觉得系统设计是一个取舍的过程，别人的方案不见得是最优的，适合的才是最好的，而且有时并不是纯技术解决问题，可能从业务角度去思考，可能更加豁然开朗。&lt;/p&gt;&lt;h1 data-tool=&quot;mdnice编辑器&quot;&gt;&lt;span/&gt;&lt;span&gt;推荐阅读&lt;/span&gt;&lt;/h1&gt;&lt;p data-tool=&quot;mdnice编辑器&quot;&gt;与本文相关的文章也顺便推荐给你，如果觉得还不错，记得&lt;code&gt;关注&lt;/code&gt;、&lt;code&gt;点赞&lt;/code&gt;、&lt;code&gt;在看&lt;/code&gt;&lt;/p&gt;&lt;hr data-tool=&quot;mdnice编辑器&quot;/&gt;&lt;blockquote data-tool=&quot;mdnice编辑器&quot;&gt;&lt;ul class=&quot;list-paddingleft-1&quot;&gt;&lt;li&gt;&lt;section&gt;搜索关注微信公众号&quot;捉虫大师&quot;，后端技术分享，架构设计、性能优化、源码阅读、问题排查、踩坑实践。&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;技术交流群加微信「MrRoshi」拉你进群，群里各路大神带你飞&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>