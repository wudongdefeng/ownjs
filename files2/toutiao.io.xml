<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>bc8cc5e07aeb5c4be54119245e8dbe79</guid>
<title>ThreadLocal&amp;MDCå†…å­˜æ³„æ¼é—®é¢˜</title>
<link>https://toutiao.io/k/k98aint</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;p id=&quot;js_tags&quot; class=&quot;article-tag__list single-tag__wrp js_single js_wx_tap_highlight wx_tap_card&quot; data-len=&quot;1&quot; role=&quot;link&quot; aria-labelledby=&quot;js_article-tag-card__left js_a11y_comma js_article-tag-card__right&quot;&gt;
                                            
                                                                                    &lt;span aria-hidden=&quot;true&quot; id=&quot;js_article-tag-card__left&quot; class=&quot;article-tag-card__left&quot;&gt;
                                    &lt;span class=&quot;article-tag-card__title&quot;&gt;æ”¶å½•äºè¯é¢˜&lt;/span&gt;
                                    &lt;span class=&quot;article-tag__item-wrp no-active js_tag&quot; data-url=&quot;https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzNjAxODg4MQ==&amp;amp;action=getalbum&amp;amp;album_id=2176378785174994948#wechat_redirect&quot; data-tag_id=&quot;&quot; data-album_id=&quot;2176378785174994948&quot; data-tag_source=&quot;4&quot;&gt;
                                        &lt;span class=&quot;article-tag__item&quot;&gt;#java&lt;/span&gt;
                                    &lt;/span&gt;
                                &lt;/span&gt;
                                &lt;span aria-hidden=&quot;true&quot; id=&quot;js_article-tag-card__right&quot; class=&quot;article-tag-card__right&quot;&gt;3ä¸ª&lt;/span&gt;
                                                                                        &lt;/p&gt;

                
                                
                
                

                
                                                                

                
                                


                
                
                
                
                                                
                                                                
                                
                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;p&gt;åœ¨&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzUzNjAxODg4MQ==&amp;amp;mid=2247483678&amp;amp;idx=1&amp;amp;sn=2091e0f6b52cd859284fb14baec7565c&amp;amp;chksm=fafdebb0cd8a62a632c71b43bfd92c387520ca9a4c2a7038fab5c667efa935352e7793a6fe5d&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;ã€Šå¤§è¯é«˜å¯ç”¨ã€‹&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;ã€Šå¤§è¯é«˜å¯ç”¨ã€‹&lt;/a&gt;é‡Œï¼Œä¹‹å‰çš„è€å¤§æœ‰è¿‡æ€»ç»“ï¼Œé«˜å¯ç”¨å°±æ˜¯ï¼š&lt;span&gt;åˆ«äººæ­»æˆ‘ä»¬ä¸æ­»ï¼Œè‡ªå·±ä¸ä½œæ­»ï¼Œä¸è¢«åˆ«äººææ­»ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;è¿™æ®µæ—¶é—´ï¼Œç½‘ä¸Šéƒ½åœ¨ä¼ Log4j2çš„lookupè¿œç¨‹æ‰§è¡Œä»£ç æ¼æ´ã€‚è¿™ä¸ªæ¼æ´è¦æƒ³é€ æˆå±å®³ï¼ŒåŸºæœ¬éƒ½æ˜¯è¢«åˆ«äººææ­»çš„ã€‚å› ä¸ºåªæœ‰urlé“¾æ¥æˆ–è€…é¡µé¢è¾“å…¥äº†å¯æ‰§è¡Œè„šæœ¬æ‰ä¼šè§¦å‘ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;æœ€è¿‘åœ¨é‡æ„&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzUzNjAxODg4MQ==&amp;amp;mid=2247484045&amp;amp;idx=2&amp;amp;sn=25cf3c0399cf92edbd57e207f18afea3&amp;amp;chksm=fafde823cd8a61354d12e2355829b78b0a84b422ec4d3569bbbff711cb9b1cb3315eafaef9ac&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;ã€Šç®€æ˜æ—¥å¿—è§„èŒƒã€‹&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;ã€Šç®€æ˜æ—¥å¿—è§„èŒƒã€‹&lt;/a&gt;ï¼Œå°±æ˜¯é‡æ„æˆ‘è‡ªå·±ä¹‹å‰å¼€æºçš„ä¸€ä¸ªç»Ÿä¸€æ—¥å¿—çš„ç»„ä»¶ã€‚å¯¹org.slf4j.MDCä¸æ”¾å¿ƒï¼Œæ€•å¼•å‘å†…å­˜æ³„éœ²ç­‰çº¿ä¸Šé•¿æ—¶é—´è¿è¡Œæ‰äº§ç”Ÿçš„é—®é¢˜ã€‚è¦æ˜¯æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ¯”Log4j2çš„æ¼æ´æ›´ä¸å¯åŸè°…ã€‚å› ä¸ºè¿™çº¯å±è‡ªå·±ä½œæ­»ã€‚æ‰€ä»¥åšäº†ä¸€ä¸ªå°ç ”ç©¶ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;MDCï¼ˆMapped Diagnostic Contextï¼Œæ˜ å°„è°ƒè¯•ä¸Šä¸‹æ–‡ï¼‰æ˜¯æ—¥å¿—ç³»ç»Ÿæä¾›çš„ä¸€ç§æ–¹ä¾¿åœ¨å¤šçº¿ç¨‹æ¡ä»¶ä¸‹è®°å½•æ—¥å¿—çš„åŠŸèƒ½ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå­˜å‚¨å®¹å™¨ï¼ŒåŸç†æ˜¯å°†ä¿¡æ¯å­˜å‚¨åœ¨äº†ThreadLocalé‡Œã€‚ThreadLocalå’Œçº¿ç¨‹ç»‘å®šã€‚ç¨‹åºé‡Œç”¨çš„éƒ½æ˜¯çº¿ç¨‹æ± ï¼Œç†è®ºä¸Šåº”è¯¥ä¸ä¼šå‡ºç°æ— é™è†¨èƒ€çš„æƒ…å†µã€‚æ€»å½’è¿˜æ˜¯ä¸æ”¾å¿ƒã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;åˆ©ç”¨å‘¨æœ«æ—¶é—´è¿›è¡Œäº†æºç ç ”ç©¶å’Œæµ‹è¯•ï¼Œç»ˆäºæ”¾å¿ƒäº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;éªŒè¯&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;é¦–å…ˆè¯»äº†æºç ï¼Œä»MDCè·Ÿåˆ°ThreadLocalï¼Œåå¤çš„æ‰¾ï¼Œæ²¡æœ‰æ‰¾åˆ°å­˜å‚¨ThreadLocalç›¸å…³ä¿¡æ¯çš„å®¹å™¨ã€‚å› ä¸ºè¦æ˜¯æœ‰ï¼Œä¸”é‡Šæ”¾åšçš„ä¸å¥½çš„è¯æ˜¯ä¼šæ— é™è†¨èƒ€çš„ã€‚å…ˆè¿›è¡Œäº†ç²—æµ…çš„ç†è®ºç ”ç©¶ä¹‹åã€‚æµ‹è¯•éªŒè¯ä¸€ä¸‹ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;éªŒè¯ä»£ç å¦‚ä¸‹ï¼Œå®é™…ä¸ŠMDC.putçš„å†…å®¹æˆ‘æ”¾äº†1ä¸‡å­—ï¼Œä¾¿äºç¡®è®¤æ•ˆæœã€‚&lt;/p&gt;&lt;pre&gt;&lt;span&gt;public static void &lt;/span&gt;&lt;span&gt;main&lt;/span&gt;(String[] args) {&lt;br/&gt;    ThreadPoolExecutor threadPoolExecutor = &lt;span&gt;new &lt;/span&gt;ThreadPoolExecutor(&lt;span&gt;2&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;200&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;TimeUnit.&lt;span&gt;DAYS&lt;/span&gt;&lt;span&gt;, new &lt;/span&gt;LinkedTransferQueue&amp;lt;&amp;gt;())&lt;span&gt;;&lt;br/&gt;    for &lt;/span&gt;(&lt;span&gt;long &lt;/span&gt;i = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;; &lt;/span&gt;i &amp;lt; Long.&lt;span&gt;MAX_VALUE&lt;/span&gt;&lt;span&gt;; &lt;/span&gt;i++) {&lt;br/&gt;        threadPoolExecutor.submit(&lt;span&gt;new &lt;/span&gt;Runnable() {&lt;br/&gt;            &lt;span&gt;@Override&lt;br/&gt;            &lt;/span&gt;&lt;span&gt;public void &lt;/span&gt;&lt;span&gt;run&lt;/span&gt;() {&lt;br/&gt;                &lt;span&gt;try &lt;/span&gt;{&lt;br/&gt;                   MDC.&lt;span&gt;put&lt;/span&gt;(&lt;span&gt;&quot;k&quot;&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;Thread.&lt;span&gt;currentThread&lt;/span&gt;().getName())&lt;span&gt;;&lt;br/&gt;                    &lt;/span&gt;Thread.&lt;span&gt;sleep&lt;/span&gt;(&lt;span&gt;100&lt;/span&gt;)&lt;span&gt;;&lt;br/&gt;                &lt;/span&gt;} &lt;span&gt;catch &lt;/span&gt;(Exception e) {&lt;br/&gt;                    e.printStackTrace()&lt;span&gt;;&lt;br/&gt;                &lt;/span&gt;}&lt;br/&gt;&lt;br/&gt;            }&lt;br/&gt;        })&lt;span&gt;;&lt;br/&gt;    &lt;/span&gt;}&lt;br/&gt;}&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;åœºæ™¯1&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;å°†æœ€å¤§çº¿ç¨‹æ•°è°ƒåˆ°1Wï¼Œå†…å­˜å¢é•¿æ ¹æœ¬åœä¸ä¸‹æ¥ï¼Œæˆ‘çš„ç”µè„‘æ˜æ˜¾å¿ƒæœ‰ä½™åŠ›ä¸è¶³ï¼Œæ²¡æœ‰è¾¾åˆ°æ•ˆæœã€‚&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzUzNjAxODg4MQ==&amp;amp;mid=2247485666&amp;amp;idx=1&amp;amp;sn=281374a2c8b286fe9c993e2f4698a261&amp;amp;chksm=fafde24ccd8a6b5ad998f2e893045bb387b3e26b9c7e20802b12b8a2fb2f32dca3db1c2fcf51&amp;amp;scene=21#wechat_redirect&quot; textvalue=&quot;ã€ŠJavaçº¿ç¨‹æ± æ€»ç»“ã€‹&quot; linktype=&quot;text&quot; imgurl=&quot;&quot; imgdata=&quot;null&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;ã€ŠJavaçº¿ç¨‹æ± æ€»ç»“ã€‹&lt;/a&gt;æœ‰å¯¹çº¿ç¨‹æ± å‚æ•°çš„è®²è§£ï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;åœºæ™¯2&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;æ ¸å¿ƒçº¿ç¨‹æ± æ•°10ï¼Œæœ€å¤§çº¿ç¨‹æ•°20ï¼Œåœ¨çº¿ç¨‹æ‰§è¡Œä»£ç çš„ç»“å°¾å¢åŠ MDC.clear()ã€‚å› ä¸ºå¤§å¤šæ•°çš„æœ€ä½³å®è·µæ˜¯ç»“æŸæ—¶éƒ½è¦åŠ ï¼Œé¿å…çº¿ç¨‹å¤ç”¨é€ æˆçš„å–å‡ºæ•°æ®ä¸å‡†ç¡®ã€‚æ—¥å¿—ä¸å‡†ç¡®æ˜¯ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰å†…å­˜æ³„éœ²è¿™ä¹ˆå¯æ€•ã€‚è¿™é‡ŒåŠ å’Œä¸åŠ åšå¯¹æ¯”ï¼ŒéªŒè¯å¦‚æœå¿˜è®°åŠ ä¼šä¸ä¼šå¯¹å†…å­˜é€ æˆå‹åŠ›ã€‚&lt;/p&gt;&lt;p&gt;ç»“æœè¿è¡Œçš„è¿›ç¨‹å 2095.1Mæ—¶è¾¾åˆ°ç¨³å®šã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.8259109311740891&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRliccfY8uUicHoibfkj1TpT97GxLrW69RpydnOyjuKibiclQEQPLheLjzCPeRVolMsDRUIMRggy8FNAQGjw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;988&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;åœºæ™¯3&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;ä¸Šé¢åœºæ™¯ä¸­å»æ‰MDC.clear()ã€‚&lt;/p&gt;&lt;p&gt;ç»“æœè¿è¡Œçš„è¿›ç¨‹å 2045.8Mæ—¶è¾¾åˆ°ç¨³å®šã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.6504320502749411&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz/2tk5ianItRliccfY8uUicHoibfkj1TpT97GxpicVP0aBqmtE4mibCJYMdiauia0L3SINVcq41RHmHYaxsTJsGaA9icPOY2w/640?wx_fmt=bmp&quot; data-type=&quot;bmp&quot; data-w=&quot;1273&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;åœºæ™¯4&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;æ ¸å¿ƒçº¿ç¨‹æ± æ•°1ï¼Œæœ€å¤§çº¿ç¨‹æ•°2ï¼Œåœ¨çº¿ç¨‹æ‰§è¡Œä»£ç çš„ç»“å°¾å¢åŠ MDC.clear()ã€‚&lt;/p&gt;&lt;p&gt;ç»“æœè¿è¡Œçš„è¿›ç¨‹å 2116.7Mæ—¶è¾¾åˆ°ç¨³å®šã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.7638888888888888&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRliccfY8uUicHoibfkj1TpT97GxcTDMibzYlU90Ss4UXpjw8FYnH54XS0zjvgQejXXLicicJJiamDZ3tp89Bw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1152&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;åœºæ™¯5&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;ä¸Šé¢åœºæ™¯ä¸­å»æ‰MDC.clear()ã€‚&lt;/p&gt;&lt;p&gt;ç»“æœè¿è¡Œçš„è¿›ç¨‹å 2109.3Mæ—¶è¾¾åˆ°ç¨³å®šã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.7054195804195804&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRliccfY8uUicHoibfkj1TpT97GxILsl5qz9faRtgTgrowrjxj18iaFB8lEdV3B4QoibcmbSiaBSX4iac0gxTw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1144&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;åœºæ™¯6&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;ä¸Šé¢åœºæ™¯ä¸­ä¿®æ”¹æ ¸å¿ƒçº¿ç¨‹æ± æ•°2ï¼Œæœ€å¤§çº¿ç¨‹æ•°4ã€‚&lt;/p&gt;&lt;p&gt;ç»“æœè¿è¡Œçš„è¿›ç¨‹å 2120.7Mæ—¶è¾¾åˆ°ç¨³å®šã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.7051170858629662&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRliccfY8uUicHoibfkj1TpT97GxhesCeZFmlibdoiar79ZsnteOmxrMjp3x2qdE1rHvLTp4Y00HS8GPJQDA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1153&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;è¯•éªŒç»“è®º&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;æ— è®ºæ˜¯å¦æ‰§è¡ŒMDC.clear()ã€‚æœ€ç»ˆå†…å­˜å ç”¨éƒ½ä¼šè¶‹äºç¨³å®šï¼Œæ— å†…å­˜æ³„éœ²ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;ç†è®ºåˆ†æ&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;è™½ç„¶éªŒè¯äº†ï¼Œè¿˜æ˜¯ä¸æ”¾å¿ƒã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåšäº†è¿™ä¹ˆä¹…çš„é¢è¯•å®˜ï¼Œæˆ‘æ·±çŸ¥ThreadLocalå†…å­˜æ¼æ´é—®é¢˜æ˜¯ä¸€é“ç»å…¸é¢è¯•é¢˜å•Šã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.08095952023988&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRl9s4DWWQHr4AsiasnOOFwuEwQ74jgXqTTCohictCAgFWBnia7QicicNJhkuB8HYAqyLe1OCU0JqTvas5HA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;667&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;br/&gt;MDCæ˜¯åŸºäºThreadLocalåšçš„ï¼ŒThreadLocalæ³„éœ²äº†ï¼ŒMDCå¯ä»¥å¹¸å…å—ï¼Ÿæµ‹è¯•æ²¡æœ‰æ³„éœ²æ˜¯ä¸æ˜¯æµ‹è¯•å§¿åŠ¿ä¸å¯¹ï¼Ÿ&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ä¸ºäº†çŸ¥å…¶ç„¶è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œä»ThreadLocalå†…å­˜æ³„éœ²çš„å…·ä½“æ¡ˆä¾‹å‡ºå‘ï¼Œæ›´åŠ ä»”ç»†çš„ç ”ç©¶äº†æºç ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ä¸‹é¢è¿™æ®µæµ‹è¯•ä»£ç åœ¨å¾ªç¯ä¸­ä¼šå‡ºç°è†¨èƒ€ï¼Œå¾ªç¯è¿‡å¤šä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;public void &lt;/span&gt;test() &lt;span&gt;throws &lt;/span&gt;Exception {&lt;/span&gt;&lt;/p&gt;&lt;span&gt;&lt;span&gt;for &lt;/span&gt;(&lt;span&gt;int &lt;/span&gt;i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; &lt;span&gt;100&lt;/span&gt;; i++) {&lt;br/&gt;        ThreadLocal threadLocal = &lt;span&gt;new &lt;/span&gt;ThreadLocal();&lt;br/&gt;        threadLocal.set(&lt;span&gt;&quot;t1&quot;&lt;/span&gt;+i);&lt;br/&gt;        Thread t = Thread.&lt;span&gt;currentThread&lt;/span&gt;();&lt;br/&gt;        &lt;span&gt;log&lt;/span&gt;.info(t);&lt;br/&gt;    }&lt;br/&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;åŸå› ä»debugç°è±¡æ¥çœ‹ï¼Œéšç€å¾ªç¯æ•°içš„å¢é•¿ï¼Œtä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹çš„threadLocalsæ•°éšä¹‹å¢é•¿ã€‚&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;0.7197149643705463&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRl9s4DWWQHr4AsiasnOOFwuEwR2MmFlKIJ31v3HT36UCZufUsJBtV2CB56veOB0r3gYvDwACAdYAUiag/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;842&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;è·Ÿè¸ªthreadLocal.set(&quot;t1&quot;+i)ä»£ç åˆ°setæ–¹æ³•çš„æºç ï¼š&lt;/p&gt;&lt;pre&gt;&lt;span&gt;&lt;span&gt;public void &lt;/span&gt;set(&lt;span&gt;T &lt;/span&gt;value) {&lt;br/&gt;    Thread t = Thread.&lt;span&gt;currentThread&lt;/span&gt;();&lt;br/&gt;    ThreadLocalMap map = getMap(t);&lt;br/&gt;    &lt;span&gt;if &lt;/span&gt;(map != &lt;span&gt;null&lt;/span&gt;)&lt;br/&gt;        map.set(&lt;span&gt;this&lt;/span&gt;, value);&lt;br/&gt;    &lt;span&gt;else&lt;br/&gt;        &lt;/span&gt;createMap(t, value);&lt;br/&gt;&lt;/span&gt;&lt;p&gt;&lt;span&gt;}&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;è§£é‡Šä¸€ä¸‹ï¼š&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;1&amp;gt;threadLocalè·å–åˆ°å½“å‰çº¿ç¨‹ï¼Œè·å–å½“å‰çº¿ç¨‹çš„ThreadLoca&lt;/span&gt;lMapå¯¹è±¡ã€‚&lt;/p&gt;&lt;p&gt;2&amp;gt;å¦‚æœmapå­˜åœ¨ï¼Œåˆ™å°†å½“å‰&lt;span&gt;threadLocal&lt;/span&gt;å¯¹è±¡ä½œä¸ºkeyè®¾ç½®value=&quot;t1&quot;+i&lt;/p&gt;&lt;p&gt;3&amp;gt;å¦‚æœmapä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªmapï¼Œå¹¶&lt;span&gt;å°†å½“å‰&lt;/span&gt;&lt;span&gt;threadLocal&lt;/span&gt;&lt;span&gt;å¯¹è±¡ä½œä¸ºkeyè®¾ç½®value=&quot;t1&quot;+i&lt;/span&gt;ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;å°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹å”¯ä¸€å¯¹åº”ä¸€ä¸ª&lt;span&gt;ThreadLocalMap&lt;/span&gt;å¯¹è±¡ã€‚&lt;span&gt;threadLocalå¯¹è±¡&lt;/span&gt;æ˜¯&lt;span&gt;ThreadLocalMapè¿™ä¸ªmapä¸­çš„ä¸€ä¸ªkeyã€‚å°†ä¸Šé¢çš„testæµ‹è¯•ç±»ç”¨ä¼ªä»£ç è°ƒæ•´æˆæ­£å¸¸çš„é¡ºåºå¤§å®¶åº”è¯¥å°±èƒ½ç†è§£äº†ï¼š&lt;/span&gt;&lt;/p&gt;&lt;pre&gt;&lt;span&gt;&lt;span&gt;public void &lt;/span&gt;test() &lt;span&gt;throws &lt;/span&gt;Exception {&lt;br/&gt;    Thread t = Thread.&lt;span&gt;currentThread&lt;/span&gt;();&lt;br/&gt;    ThreadLocalMap map = getMap(t);&lt;br/&gt;    &lt;span&gt;for &lt;/span&gt;(&lt;span&gt;int &lt;/span&gt;i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; &lt;span&gt;100&lt;/span&gt;; i++) {&lt;br/&gt;        ThreadLocal threadLocal = &lt;span&gt;new &lt;/span&gt;ThreadLocal();&lt;br/&gt;        map.set(threadLocal,&lt;span&gt;&quot;t1&quot;&lt;/span&gt;+i);&lt;br/&gt;        &lt;span&gt;log&lt;/span&gt;.info(t);&lt;br/&gt;    }&lt;br/&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;&lt;p&gt;æ‰€ä»¥threadLocal çš„å¼•ç”¨ä¸€ç›´åœ¨å½“å‰çº¿ç¨‹çš„ThreadLocalMapæ‰‹é‡Œï¼Œå¹¶ä¸æ˜¯å¾ªç¯ä¸‹ä¸€ä¸ªè¿™ä¸ªå¼•ç”¨å°±ä¸å¯è¾¾äº†ã€‚æ‰€ä»¥ä¼šä¸€ç›´åˆ›å»ºæ–°çš„ä¿å­˜è€çš„ï¼Œç›´åˆ°å†…å­˜æº¢å‡ºï¼Œå¦‚ä¸‹é¢è¿è¡Œæˆªå›¾ï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-galleryid=&quot;&quot; data-ratio=&quot;1.0647709320695102&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/2tk5ianItRl9s4DWWQHr4AsiasnOOFwuEwA35oPJLJ2PPbr0JQwyWPBM18WWLialRcyHyJdYNqFAJL17uAurw3KUg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;633&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;ç®€è€Œè¨€ä¹‹: threadLocalä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šå†…å­˜æ³„éœ²ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;MDCä¸ºä»€ä¹ˆæ— å†…å­˜æ³„éœ²é—®é¢˜&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;è·ŸMDC.put(&quot;k&quot;, Thread.currentThread().getName())åˆ°æºç å‘ç°å…¶å®putçš„çœŸæ­£æ‰¿è½½å®¹å™¨æ˜¯static MDCAdapter mdcAdapterã€‚è¿™æ˜¯ä¸€ä¸ªé™æ€ç±»ï¼Œåœ¨MDCç±»æºç çš„åº•éƒ¨æœ‰mdcAdapterçš„åˆå§‹åŒ–è¿‡ç¨‹staticé™æ€å—ï¼Œè¡¨æ˜äº†æ•´ä¸ªJVMåªæœ‰ä¸€ä»½ã€‚&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;MDCAdapter æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“çš„å®ç°å› ä¸ºè¿™æ˜¯slf4jé—¨é¢ä¸­çš„ã€‚å®ç°ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†logbackç­‰ä¸»æµæ—¥å¿—å®ç°éƒ½æ˜¯newä¸€ä¸ªThreadLocalï¼Œå°†Mapå®¹å™¨ç»‘å®šåˆ°ThreadLocalä¸­ã€‚ä»£ç ç‰‡æ®µæ„Ÿå—ä¸€ä¸‹ï¼š&lt;/p&gt;&lt;pre&gt;&lt;span&gt;public class LogbackMDCAdapter implements MDCAdapter {&lt;br/&gt;    final ThreadLocal&amp;lt;Map&amp;lt;String, String&amp;gt;&amp;gt; copyOnThreadLocal = new ThreadLocal();&lt;/span&gt;&lt;/pre&gt;&lt;pre&gt;&lt;span&gt;public void put(String key, String val) throws IllegalArgumentException {&lt;br/&gt;    if (key == null) {&lt;br/&gt;        throw new IllegalArgumentException(&quot;key cannot be null&quot;);&lt;br/&gt;    } else {&lt;br/&gt;        Map&amp;lt;String, String&amp;gt; oldMap = (Map)this.copyOnThreadLocal.get();&lt;br/&gt;        Integer lastOp = this.getAndSetLastOperation(1);&lt;br/&gt;        if (!this.wasLastOpReadOrNull(lastOp) &amp;amp;&amp;amp; oldMap != null) {&lt;br/&gt;            oldMap.put(key, val);&lt;br/&gt;        } else {&lt;br/&gt;            Map&amp;lt;String, String&amp;gt; newMap = this.duplicateAndInsertNewMap(oldMap);&lt;br/&gt;            newMap.put(key, val);&lt;br/&gt;        }&lt;br/&gt;&lt;br/&gt;    }&lt;br/&gt;&lt;/span&gt;&lt;p&gt;&lt;span&gt;}&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/pre&gt;&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼šä¸€ä¸ªçº¿ç¨‹é¡¶å¤šä¼šåˆ›å»ºä¸€ä¸ªThreadLocalï¼Œæ‰€ä»¥ä¸ä¼šå†…å­˜æ³„éœ²ã€‚&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;æ€»ç»“&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;1ã€ä¸è¦å‡å®šï¼Œè¦è¯æ˜ã€‚è¯æ˜ä¹‹åè¦ç†è§£ï¼Œé€»è¾‘è‡ªæ´½ã€‚&lt;/p&gt;&lt;p&gt;2ã€&lt;span&gt;åˆ«äººæ­»æˆ‘ä»¬ä¸æ­»ï¼Œè‡ªå·±ä¸ä½œæ­»ï¼Œä¸è¢«åˆ«äººææ­»ã€‚&lt;/span&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>baaf901d617cb9d028fdf52f30613716</guid>
<title>ä¸ºä»€ä¹ˆGOLANGçš„TIMERå®ç°ä½¿ç”¨å››å‰å †è€Œä¸æ˜¯äºŒå‰å †</title>
<link>https://toutiao.io/k/i3e1v7i</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;article id=&quot;post-39627&quot; class=&quot;post-content post-39627 post type-post status-publish format-standard hentry category-16 tag-heap tag-timer tag-498 tag-500 tag-497 h-entry h-as-article&quot; itemref=&quot;site-publisher&quot;&gt;
&lt;header class=&quot;entry-header&quot;&gt;
 &lt;/header&gt;

&lt;div class=&quot;entry-content e-content&quot; itemprop=&quot;description articleBody&quot;&gt;
&lt;pre&gt;&lt;code class=&quot;&quot;&gt;ç‰ˆæƒå£°æ˜ æœ¬ç«™åŸåˆ›æ–‡ç«  ç”± èŒå” å‘è¡¨
è½¬è½½è¯·æ³¨æ˜ èŒå” | http://vearne.cc
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;1.å¼•è¨€&lt;/h3&gt;
&lt;p&gt;Golangåœ¨Timer(è®¡æ—¶å™¨)çš„å®ç°ä¸­ä½¿ç”¨äº†å››å‰å †ï¼Œè€Œä¸æ˜¯å¸¸è§çš„äºŒå‰å †ï¼Œè¿™ä¸ªé—®é¢˜å¼•èµ·äº†æˆ‘çš„å…´è¶£ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œç½‘ä¸Šçš„è§£é‡Šæ˜¯è¿™æ ·çš„&lt;br/&gt;
&lt;img src=&quot;http://ut-bucket01.sh1a.qingstor.com/woshiaotian/20211228/59f1eb2e-67a4-11ec-b5b4-1e00da114f95.jpeg&quot; alt=&quot;&quot; data-pagespeed-url-hash=&quot;967164888&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘ä»”ç»†æŸ¥é˜…äº†èµ„æ–™ä»¥åï¼Œæœ‰äº†ç‚¹æœ‰è¶£çš„å‘ç°ã€‚&lt;/p&gt;
&lt;h3&gt;2.è¯´æ˜&lt;/h3&gt;
&lt;p&gt;å‡è®¾: å †ä¸º&lt;code&gt;d&lt;/code&gt;å‰å †ï¼Œå †ä¸­å…±æœ‰&lt;code&gt;n&lt;/code&gt;ä¸ªèŠ‚ç‚¹&lt;br/&gt;
å¤‡æ³¨: æ—¶é—´å¤æ‚åº¦çš„è¯æ˜è§&lt;a href=&quot;https://en.wikipedia.org/wiki/D-ary_heap&quot;&gt;d-ary heap&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Timeræœ€å¸¸è§çš„2ä¸ªæ“ä½œ&lt;/p&gt;

&lt;p&gt;æ·»åŠ ä¸€ä¸ªè®¡æ—¶å™¨ã€‚æ¶‰åŠ &lt;em&gt;sift-up&lt;/em&gt;ï¼ˆä¸Šæ¨ï¼‰æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(log n / log d)&lt;/p&gt;
&lt;p&gt;Pythonä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-python &quot;&gt;import math
result = math.log(n, d)
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;æ—¶é—´æ¶ˆè€—ï¼ˆéœ€è¦äº¤æ¢æˆ–è€…æ¯”è¾ƒçš„æ¬¡æ•°ï¼‰&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;n(æ•°é‡)&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;äºŒå‰å †&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;å››å‰å †&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;å…«å‰å †&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;1w&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;13.3&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;6.64&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;4.43&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;10w&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;16.61&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;8.30&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;5.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;100w&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;19.93&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;9.97&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;6.64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;1000w&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;23.25&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;11.63&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;7.75&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;æŒ‡å®šæ—¶é—´åˆ°è¾¾åï¼Œæ¸…é™¤è®¡æ—¶å™¨ã€‚æ¶‰åŠ &lt;em&gt;sift-down&lt;/em&gt;ï¼ˆä¸‹æ¨ï¼‰æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(d * log n / log d)&lt;/p&gt;
&lt;p&gt;Pythonä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-python &quot;&gt;import math
result = d * math.log(n, d)
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;æ—¶é—´æ¶ˆè€—ï¼ˆéœ€è¦äº¤æ¢æˆ–è€…æ¯”è¾ƒçš„æ¬¡æ•°ï¼‰&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;n(æ•°é‡)&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;äºŒå‰å †&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;å››å‰å †&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;å…«å‰å †&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;1w&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;26.58&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;26.58&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;35.43&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;10w&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;33.33&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;33.33&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;44.29&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;100w&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;39.86&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;39.86&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;53.15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;1000w&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;46.51&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;46.51&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;62.01&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;3. ç»“è®º&lt;/h3&gt;
&lt;p&gt;æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ’å…¥æ“ä½œï¼šå¤šå‰å †æ‰§è¡Œæ€§èƒ½ä¼˜äºäºŒå‰å †; åˆ é™¤æ“ä½œï¼šå¤šå‰å †æ‰§è¡Œæ€§èƒ½å¼±äºäºŒå‰å †ã€‚&lt;br/&gt;
ä½†æ˜¯ç»†å¿ƒçš„æœ‹å‹åº”è¯¥å·²ç»å‘ç°ï¼Œ&lt;strong&gt;å››å‰å †æ’å…¥æ“ä½œçš„è€—æ—¶åªæœ‰äºŒå‰å †çš„ä¸€åŠï¼Œè€Œåˆ é™¤æ“ä½œçš„è€—æ—¶ä¸å››å‰å †å®Œå…¨ç›¸åŒã€‚&lt;/strong&gt; è¿™ä¹ˆä¸€å¯¹æ¯”ï¼Œä¼˜åŠ¿ç¡®å®æ˜¾è‘—ã€‚&lt;/p&gt;
&lt;h3&gt;å‚è€ƒèµ„æ–™&lt;/h3&gt;
&lt;p&gt;1.&lt;a href=&quot;https://en.wikipedia.org/wiki/Heap_(data_structure)&quot;&gt;Heap (data structure)&lt;/a&gt;&lt;br/&gt;
2.&lt;a href=&quot;https://en.wikipedia.org/wiki/Binary_heap&quot;&gt;Binary heap&lt;/a&gt;&lt;br/&gt;
3.&lt;a href=&quot;https://en.wikipedia.org/wiki/D-ary_heap&quot;&gt;d-ary heap&lt;/a&gt;&lt;br/&gt;
4.&lt;a href=&quot;https://www.cyhone.com/articles/analysis-of-golang-timer/&quot;&gt;Golang å®šæ—¶å™¨åº•å±‚å®ç°æ·±åº¦å‰–æ&lt;/a&gt;&lt;br/&gt;
5.&lt;a href=&quot;https://www.jianshu.com/p/6b526aa481b1&quot;&gt;æ•°æ®ç»“æ„ï¼šå †ï¼ˆHeapï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;hr/&gt;
&lt;h4&gt;è¯·æˆ‘å–ç“¶é¥®æ–™&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;http://static.zybuluo.com/woshiaotian/ohw8kvpn5k7hthgbuol4e4aq/WechatIMG29.jpg&quot; alt=&quot;å¾®ä¿¡æ”¯ä»˜ç &quot; data-pagespeed-url-hash=&quot;2495828515&quot;/&gt;&lt;/p&gt;

&lt;p class=&quot;clear&quot;/&gt;
&lt;/div&gt;
&lt;nav class=&quot;navigation post-navigation&quot; role=&quot;navigation&quot; aria-label=&quot;æ–‡ç« &quot;&gt;
&lt;h2 class=&quot;screen-reader-text&quot;&gt;æ–‡ç« å¯¼èˆª&lt;/h2&gt;

&lt;/nav&gt; &lt;p class=&quot;clear&quot;/&gt;

&lt;/article&gt;
&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>0d787e8687548ebeced32906e325ecac</guid>
<title>èŠèŠspringäº‹åŠ¡å¤±æ•ˆçš„12ç§åœºæ™¯ï¼Œå¤ªå‘äº†</title>
<link>https://toutiao.io/k/uf6yk96</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot; data-mpa-powered-by=&quot;yiban.io&quot;&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong data-darkmode-bgcolor-16346154121535=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16346154121535=&quot;#fff|rgb(255, 255, 255)|rgb(255, 255, 255)&quot; data-darkmode-color-16346154121535=&quot;rgb(163, 163, 163)&quot; data-darkmode-original-color-16346154121535=&quot;#fff|rgb(62, 62, 62)|rgb(0, 0, 0)&quot; data-style=&quot;outline: 0px; letter-spacing: 0.544px; text-align: left; white-space: normal; color: rgb(0, 0, 0); font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &amp;quot;PingFang SC&amp;quot;, Cambria, Cochin, Georgia, Times, &amp;quot;Times New Roman&amp;quot;, serif; font-size: 16px; background-color: rgb(255, 255, 255);&quot; class=&quot;js_darkmode__2&quot;&gt;ç‚¹å‡»å…³æ³¨å…¬ä¼—å·ï¼ŒJavaå¹²è´§&lt;/strong&gt;&lt;span data-darkmode-bgcolor-16346154121535=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16346154121535=&quot;#fff|rgb(255, 255, 255)|rgb(255, 255, 255)&quot; data-darkmode-color-16346154121535=&quot;rgb(255, 76, 65)&quot; data-darkmode-original-color-16346154121535=&quot;#fff|rgb(62, 62, 62)|rgb(255, 76, 65)&quot; data-style=&quot;outline: 0px; letter-spacing: 0.544px; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &amp;quot;PingFang SC&amp;quot;, Cambria, Cochin, Georgia, Times, &amp;quot;Times New Roman&amp;quot;, serif; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(255, 76, 65);&quot; class=&quot;js_darkmode__3&quot;&gt;&lt;strong data-darkmode-bgcolor-16346154121535=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16346154121535=&quot;#fff|rgb(255, 255, 255)|rgb(255, 255, 255)&quot; data-darkmode-color-16346154121535=&quot;rgb(255, 76, 65)&quot; data-darkmode-original-color-16346154121535=&quot;#fff|rgb(62, 62, 62)|rgb(255, 76, 65)&quot;&gt;åŠæ—¶é€è¾¾ğŸ‘‡&lt;/strong&gt;&lt;/span&gt;&lt;/h3&gt;&lt;section class=&quot;mp_profile_iframe_wrp&quot;&gt;&lt;mpprofile class=&quot;js_uneditable custom_select_card mp_profile_iframe&quot; data-pluginname=&quot;mpprofile&quot; data-id=&quot;MzU4MDUyMDQyNQ==&quot; data-headimg=&quot;http://mmbiz.qpic.cn/mmbiz_png/knmrNHnmCLEX3M6DvCn5gKuBOaMMVu9lUJAvwH2k66nV9VgGG0cyczd1ryib06P1z5pF72Le3HUr5loicnQx36lg/0?wx_fmt=png&quot; data-nickname=&quot;å°å“ˆå­¦Java&quot; data-alias=&quot;xiaoha_java&quot; data-signature=&quot;ä¸“æ³¨äºJavaé¢†åŸŸå¹²è´§åˆ†äº«ï¼Œä¸é™äºBATé¢è¯•, ç®—æ³•ï¼Œæ•°æ®åº“ï¼ŒSpring Boot, å¾®æœåŠ¡,é«˜å¹¶å‘, JVM, Dockerå®¹å™¨ï¼ŒELKç›¸å…³çŸ¥è¯†ï¼ŒæœŸå¾…ä¸æ‚¨ä¸€åŒè¿›æ­¥ã€‚&quot; data-from=&quot;0&quot;/&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.5645161290322581&quot; data-src=&quot;https://mmbiz.qpic.cn/sz_mmbiz_jpg/knmrNHnmCLHoM2ib2hgLaZr0ruTQZDRYZlAFxVibcicZ18G3Llxx1ibOBNRVRWeex0qMOndOBUfLgh1K72Nm1G31zg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;496&quot;/&gt;&lt;span data-darkmode-bgcolor-16346154121535=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16346154121535=&quot;#fff|rgb(255, 255, 255)|rgb(255, 255, 255)&quot; data-darkmode-color-16346154121535=&quot;rgb(255, 76, 65)&quot; data-darkmode-original-color-16346154121535=&quot;#fff|rgb(62, 62, 62)|rgb(255, 76, 65)&quot; data-style=&quot;outline: 0px; letter-spacing: 0.544px; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &amp;quot;PingFang SC&amp;quot;, Cambria, Cochin, Georgia, Times, &amp;quot;Times New Roman&amp;quot;, serif; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(255, 76, 65);&quot; class=&quot;js_darkmode__3&quot;&gt;&lt;strong data-darkmode-bgcolor-16346154121535=&quot;rgb(25, 25, 25)&quot; data-darkmode-original-bgcolor-16346154121535=&quot;#fff|rgb(255, 255, 255)|rgb(255, 255, 255)&quot; data-darkmode-color-16346154121535=&quot;rgb(255, 76, 65)&quot; data-darkmode-original-color-16346154121535=&quot;#fff|rgb(62, 62, 62)|rgb(255, 76, 65)&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;å‰è¨€&lt;/span&gt;&lt;br/&gt;&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯¹äºä»äº‹javaå¼€å‘å·¥ä½œçš„åŒå­¦æ¥è¯´ï¼Œspringçš„äº‹åŠ¡è‚¯å®šå†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œéœ€è¦åŒæ—¶&lt;span&gt;å†™å…¥&lt;/span&gt;å¤šå¼ è¡¨çš„æ•°æ®ã€‚ä¸ºäº†ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼ˆè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼‰ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šç”¨åˆ°springäº‹åŠ¡ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¡®å®ï¼Œspringäº‹åŠ¡ç”¨èµ·æ¥è´¼çˆ½ï¼Œå°±ç”¨ä¸€ä¸ªç®€å•çš„æ³¨è§£ï¼š&lt;code&gt;@Transactional&lt;/code&gt;ï¼Œå°±èƒ½è½»æ¾æå®šäº‹åŠ¡ã€‚æˆ‘çŒœå¤§éƒ¨åˆ†å°ä¼™ä¼´ä¹Ÿæ˜¯è¿™æ ·ç”¨çš„ï¼Œè€Œä¸”ä¸€ç›´ç”¨ä¸€ç›´çˆ½ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†å¦‚æœä½ ä½¿ç”¨ä¸å½“ï¼Œå®ƒä¹Ÿä¼šå‘ä½ äºæ— å½¢ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»Šå¤©æˆ‘ä»¬å°±ä¸€èµ·èŠèŠï¼Œäº‹åŠ¡å¤±æ•ˆçš„ä¸€äº›åœºæ™¯ï¼Œè¯´ä¸å®šä½ å·²ç»ä¸­æ‹›äº†ã€‚ä¸ä¿¡ï¼Œè®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.9913419913419913&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/uL371281oDFI5ibhP1TXOMnqQtJhfb3XCnTbgmpiab2LDA8VVCmg2jMUoeJd70gAJsj7vL2IB0icYxsbsvnKIu9LQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1386&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ä¸€ äº‹åŠ¡ä¸ç”Ÿæ•ˆ&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;1.è®¿é—®æƒé™é—®é¢˜&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œjavaçš„è®¿é—®æƒé™ä¸»è¦æœ‰å››ç§ï¼šprivateã€defaultã€protectedã€publicï¼Œå®ƒä»¬çš„æƒé™ä»å·¦åˆ°å³ï¼Œä¾æ¬¡å˜å¤§ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†å¦‚æœæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒæŠŠæœ‰æŸäº›äº‹åŠ¡æ–¹æ³•ï¼Œå®šä¹‰äº†é”™è¯¯çš„è®¿é—®æƒé™ï¼Œå°±ä¼šå¯¼è‡´äº‹åŠ¡åŠŸèƒ½å‡ºé—®é¢˜ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â Â saveData(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â Â updateData(userModel);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•çš„è®¿é—®æƒé™è¢«å®šä¹‰æˆäº†&lt;code&gt;private&lt;/code&gt;ï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Œspringè¦æ±‚è¢«ä»£ç†æ–¹æ³•å¿…é¡»æ˜¯&lt;code&gt;public&lt;/code&gt;çš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯´ç™½äº†ï¼Œåœ¨&lt;code&gt;AbstractFallbackTransactionAttributeSource&lt;/code&gt;ç±»çš„&lt;code&gt;computeTransactionAttribute&lt;/code&gt;æ–¹æ³•ä¸­æœ‰ä¸ªåˆ¤æ–­ï¼Œå¦‚æœç›®æ ‡æ–¹æ³•ä¸æ˜¯publicï¼Œåˆ™&lt;code&gt;TransactionAttribute&lt;/code&gt;è¿”å›nullï¼Œå³ä¸æ”¯æŒäº‹åŠ¡ã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;protected&lt;/span&gt;Â TransactionAttributeÂ &lt;span&gt;computeTransactionAttribute&lt;/span&gt;&lt;span&gt;(MethodÂ method,Â @NullableÂ Class&amp;lt;?&amp;gt;Â targetClass)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â Don&#x27;tÂ allowÂ no-publicÂ methodsÂ asÂ required.&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (allowPublicMethodsOnly()Â &amp;amp;&amp;amp;Â !Modifier.isPublic(method.getModifiers()))Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â TheÂ methodÂ mayÂ beÂ onÂ anÂ interface,Â butÂ weÂ needÂ attributesÂ fromÂ theÂ targetÂ class.&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â IfÂ theÂ targetÂ classÂ isÂ null,Â theÂ methodÂ willÂ beÂ unchanged.&lt;/span&gt;&lt;br/&gt;Â Â Â Â MethodÂ specificMethodÂ =Â AopUtils.getMostSpecificMethod(method,Â targetClass);&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â FirstÂ tryÂ isÂ theÂ methodÂ inÂ theÂ targetÂ class.&lt;/span&gt;&lt;br/&gt;Â Â Â Â TransactionAttributeÂ txAttrÂ =Â findTransactionAttribute(specificMethod);&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (txAttrÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â txAttr;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â SecondÂ tryÂ isÂ theÂ transactionÂ attributeÂ onÂ theÂ targetÂ class.&lt;/span&gt;&lt;br/&gt;Â Â Â Â txAttrÂ =Â findTransactionAttribute(specificMethod.getDeclaringClass());&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (txAttrÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â ClassUtils.isUserLevelMethod(method))Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â txAttr;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (specificMethodÂ !=Â method)Â {&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;//Â FallbackÂ isÂ toÂ lookÂ atÂ theÂ originalÂ method.&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â txAttrÂ =Â findTransactionAttribute(method);&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (txAttrÂ !=Â &lt;span&gt;null&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â txAttr;&lt;br/&gt;Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;//Â LastÂ fallbackÂ isÂ theÂ classÂ ofÂ theÂ originalÂ method.&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â txAttrÂ =Â findTransactionAttribute(method.getDeclaringClass());&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (txAttrÂ !=Â &lt;span&gt;null&lt;/span&gt;Â &amp;amp;&amp;amp;Â ClassUtils.isUserLevelMethod(method))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â txAttr;&lt;br/&gt;Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;null&lt;/span&gt;;&lt;br/&gt;Â Â }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰çš„äº‹åŠ¡æ–¹æ³•ï¼ˆå³ç›®æ ‡æ–¹æ³•ï¼‰ï¼Œå®ƒçš„è®¿é—®æƒé™ä¸æ˜¯&lt;code&gt;public&lt;/code&gt;ï¼Œè€Œæ˜¯privateã€defaultæˆ–protectedçš„è¯ï¼Œspringåˆ™ä¸ä¼šæä¾›äº‹åŠ¡åŠŸèƒ½ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;2. æ–¹æ³•ç”¨finalä¿®é¥°&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰æ—¶å€™ï¼ŒæŸä¸ªæ–¹æ³•ä¸æƒ³è¢«å­ç±»é‡æ–°ï¼Œè¿™æ—¶å¯ä»¥å°†è¯¥æ–¹æ³•å®šä¹‰æˆfinalçš„ã€‚æ™®é€šæ–¹æ³•è¿™æ ·å®šä¹‰æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†å¦‚æœå°†äº‹åŠ¡æ–¹æ³•å®šä¹‰æˆfinalï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â saveData(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â updateData(userModel);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•è¢«å®šä¹‰æˆäº†&lt;code&gt;final&lt;/code&gt;çš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ºä»€ä¹ˆï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä½ çœ‹è¿‡springäº‹åŠ¡çš„æºç ï¼Œå¯èƒ½ä¼šçŸ¥é“springäº‹åŠ¡åº•å±‚ä½¿ç”¨äº†aopï¼Œä¹Ÿå°±æ˜¯é€šè¿‡jdkåŠ¨æ€ä»£ç†æˆ–è€…cglibï¼Œå¸®æˆ‘ä»¬ç”Ÿæˆäº†ä»£ç†ç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­å®ç°çš„äº‹åŠ¡åŠŸèƒ½ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†å¦‚æœæŸä¸ªæ–¹æ³•ç”¨finalä¿®é¥°äº†ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„ä»£ç†ç±»ä¸­ï¼Œå°±æ— æ³•é‡å†™è¯¥æ–¹æ³•ï¼Œè€Œæ·»åŠ äº‹åŠ¡åŠŸèƒ½ã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;æ³¨æ„ï¼šå¦‚æœæŸä¸ªæ–¹æ³•æ˜¯staticçš„ï¼ŒåŒæ ·æ— æ³•é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå˜æˆäº‹åŠ¡æ–¹æ³•ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;3.æ–¹æ³•å†…éƒ¨è°ƒç”¨&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æŸä¸ªServiceç±»çš„æŸä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â UserMapperÂ userMapper;&lt;br/&gt;&lt;br/&gt;Â Â &lt;span/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â userMapper.insertUser(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â updateStatus(userModel);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;updateStatus&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â doSameThing();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬çœ‹åˆ°åœ¨äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œç›´æ¥è°ƒç”¨äº‹åŠ¡æ–¹æ³•updateStatusã€‚ä»å‰é¢ä»‹ç»çš„å†…å®¹å¯ä»¥çŸ¥é“ï¼ŒupdateStatusæ–¹æ³•æ‹¥æœ‰äº‹åŠ¡çš„èƒ½åŠ›æ˜¯å› ä¸ºspring aopç”Ÿæˆä»£ç†äº†å¯¹è±¡ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ç›´æ¥è°ƒç”¨äº†thiså¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€ä»¥updateStatusæ–¹æ³•ä¸ä¼šç”Ÿæˆäº‹åŠ¡ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç”±æ­¤å¯è§ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæœ‰äº›åœºæ™¯ï¼Œç¡®å®æƒ³åœ¨åŒä¸€ä¸ªç±»çš„æŸä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨å®ƒè‡ªå·±çš„å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.1 æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ªæ–¹æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦æ–°åŠ ä¸€ä¸ªServiceæ–¹æ³•ï¼ŒæŠŠ@Transactionalæ³¨è§£åŠ åˆ°æ–°Serviceæ–¹æ³•ä¸Šï¼ŒæŠŠéœ€è¦äº‹åŠ¡æ‰§è¡Œçš„ä»£ç ç§»åˆ°æ–°æ–¹æ³•ä¸­ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Servcie&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;ServiceA&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â prvateÂ ServiceBÂ serviceB;&lt;br/&gt;&lt;br/&gt;Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;save&lt;/span&gt;&lt;span&gt;(UserÂ user)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â Â queryData1();&lt;br/&gt;Â Â Â Â Â Â Â Â Â queryData2();&lt;br/&gt;Â Â Â Â Â Â Â Â Â serviceB.doSave(user);&lt;br/&gt;Â Â Â }&lt;br/&gt;Â }&lt;br/&gt;&lt;br/&gt;Â &lt;span&gt;@Servcie&lt;/span&gt;&lt;br/&gt;Â &lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;ServiceB&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;(rollbackFor=Exception&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;)&lt;br/&gt;Â Â Â Â &lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;doSave&lt;/span&gt;(&lt;span&gt;User&lt;/span&gt;Â &lt;span&gt;user&lt;/span&gt;)Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â addData1();&lt;br/&gt;Â Â Â Â Â Â Â updateData2();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.2 åœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä¸æƒ³å†æ–°åŠ ä¸€ä¸ªServiceç±»ï¼Œåœ¨è¯¥Serviceç±»ä¸­æ³¨å…¥è‡ªå·±ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Servcie&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;ServiceA&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â prvateÂ ServiceAÂ serviceA;&lt;br/&gt;&lt;br/&gt;Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;save&lt;/span&gt;&lt;span&gt;(UserÂ user)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â Â queryData1();&lt;br/&gt;Â Â Â Â Â Â Â Â Â queryData2();&lt;br/&gt;Â Â Â Â Â Â Â Â Â serviceA.doSave(user);&lt;br/&gt;Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;(rollbackFor=Exception&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;)&lt;br/&gt;Â Â Â &lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;doSave&lt;/span&gt;(&lt;span&gt;User&lt;/span&gt;Â &lt;span&gt;user&lt;/span&gt;)Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â addData1();&lt;br/&gt;Â Â Â Â Â Â Â updateData2();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯èƒ½æœ‰äº›äººå¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šè¿™ç§åšæ³•ä¼šä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç­”æ¡ˆï¼šä¸ä¼šã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…¶å®spring iocå†…éƒ¨çš„ä¸‰çº§ç¼“å­˜ä¿è¯äº†å®ƒï¼Œä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ã€‚&lt;/p&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;3.3 é€šè¿‡AopContentç±»&lt;span/&gt;&lt;/h4&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨è¯¥Serviceç±»ä¸­ä½¿ç”¨AopContext.currentProxy()è·å–ä»£ç†å¯¹è±¡&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šé¢çš„æ–¹æ³•2ç¡®å®å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä»£ç çœ‹èµ·æ¥å¹¶ä¸ç›´è§‚ï¼Œè¿˜å¯ä»¥é€šè¿‡åœ¨è¯¥Serviceç±»ä¸­ä½¿ç”¨AOPProxyè·å–ä»£ç†å¯¹è±¡ï¼Œå®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Servcie&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;ServiceA&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;save&lt;/span&gt;&lt;span&gt;(UserÂ user)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â Â queryData1();&lt;br/&gt;Â Â Â Â Â Â Â Â Â queryData2();&lt;br/&gt;Â Â Â Â Â Â Â Â Â ((ServiceA)AopContext.currentProxy()).doSave(user);&lt;br/&gt;Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;(rollbackFor=Exception&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;)&lt;br/&gt;Â Â Â &lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;doSave&lt;/span&gt;(&lt;span&gt;User&lt;/span&gt;Â &lt;span&gt;user&lt;/span&gt;)Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â addData1();&lt;br/&gt;Â Â Â Â Â Â Â updateData2();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;4.æœªè¢«springç®¡ç†&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªç»†èŠ‚å¾ˆå®¹æ˜“è¢«å¿½ç•¥ã€‚å³ä½¿ç”¨springäº‹åŠ¡çš„å‰ææ˜¯ï¼šå¯¹è±¡è¦è¢«springç®¡ç†ï¼Œéœ€è¦åˆ›å»ºbeanå®ä¾‹ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡@Controllerã€@Serviceã€@Componentã€@Repositoryç­‰æ³¨è§£ï¼Œå¯ä»¥è‡ªåŠ¨å®ç°beanå®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœæœ‰ä¸€å¤©ï¼Œä½ åŒ†åŒ†å¿™å¿™çš„å¼€å‘äº†ä¸€ä¸ªServiceç±»ï¼Œä½†å¿˜äº†åŠ @Serviceæ³¨è§£ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â Â saveData(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â Â updateData(userModel);&lt;br/&gt;Â Â Â Â }Â Â Â Â &lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°UserServiceç±»æ²¡æœ‰åŠ &lt;code&gt;@Service&lt;/code&gt;æ³¨è§£ï¼Œé‚£ä¹ˆè¯¥ç±»ä¸ä¼šäº¤ç»™springç®¡ç†ï¼Œæ‰€ä»¥å®ƒçš„addæ–¹æ³•ä¹Ÿä¸ä¼šç”Ÿæˆäº‹åŠ¡ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;5.å¤šçº¿ç¨‹è°ƒç”¨&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯è¿˜æ˜¯æŒºå¤šçš„ã€‚å¦‚æœspringäº‹åŠ¡ç”¨åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­ï¼Œä¼šæœ‰é—®é¢˜å—ï¼Ÿ&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Slf&lt;/span&gt;4j&lt;br/&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â UserMapperÂ userMapper;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â RoleServiceÂ roleService;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â ExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â userMapper.insertUser(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;new&lt;/span&gt;Â Thread(()Â -&amp;gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â roleService.doOtherThing();&lt;br/&gt;Â Â Â Â Â Â Â Â }).start();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;RoleService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;doOtherThing&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;ä¿å­˜roleè¡¨æ•°æ®&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº‹åŠ¡æ–¹æ³•addä¸­ï¼Œè°ƒç”¨äº†äº‹åŠ¡æ–¹æ³•doOtherThingï¼Œä½†æ˜¯äº‹åŠ¡æ–¹æ³•doOtherThingæ˜¯åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨çš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™æ ·ä¼šå¯¼è‡´ä¸¤ä¸ªæ–¹æ³•ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè·å–åˆ°çš„æ•°æ®åº“è¿æ¥ä¸ä¸€æ ·ï¼Œä»è€Œæ˜¯ä¸¤ä¸ªä¸åŒçš„äº‹åŠ¡ã€‚å¦‚æœæƒ³doOtherThingæ–¹æ³•ä¸­æŠ›äº†å¼‚å¸¸ï¼Œaddæ–¹æ³•ä¹Ÿå›æ»šæ˜¯ä¸å¯èƒ½çš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœçœ‹è¿‡springäº‹åŠ¡æºç çš„æœ‹å‹ï¼Œå¯èƒ½ä¼šçŸ¥é“springçš„äº‹åŠ¡æ˜¯é€šè¿‡æ•°æ®åº“è¿æ¥æ¥å®ç°çš„ã€‚å½“å‰çº¿ç¨‹ä¸­ä¿å­˜äº†ä¸€ä¸ªmapï¼Œkeyæ˜¯æ•°æ®æºï¼Œvalueæ˜¯æ•°æ®åº“è¿æ¥ã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;final&lt;/span&gt;Â ThreadLocal&amp;lt;Map&amp;lt;Object,Â Object&amp;gt;&amp;gt;Â resourcesÂ =&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;new&lt;/span&gt;Â NamedThreadLocal&amp;lt;&amp;gt;(&lt;span&gt;&quot;TransactionalÂ resources&quot;&lt;/span&gt;);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬è¯´çš„åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå…¶å®æ˜¯æŒ‡åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œåªæœ‰æ‹¥æœ‰åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥æ‰èƒ½åŒæ—¶æäº¤å’Œå›æ»šã€‚å¦‚æœåœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œæ‹¿åˆ°çš„æ•°æ®åº“è¿æ¥è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ˜¯ä¸åŒçš„äº‹åŠ¡ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;6.è¡¨ä¸æ”¯æŒäº‹åŠ¡&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‘¨æ‰€å‘¨çŸ¥ï¼Œåœ¨mysql5ä¹‹å‰ï¼Œé»˜è®¤çš„æ•°æ®åº“å¼•æ“æ˜¯&lt;code&gt;myisam&lt;/code&gt;ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å®ƒçš„å¥½å¤„å°±ä¸ç”¨å¤šè¯´äº†ï¼šç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå¯¹äºæŸ¥å¤šå†™å°‘çš„å•è¡¨æ“ä½œï¼Œæ€§èƒ½æ¯”innodbæ›´å¥½ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰äº›è€é¡¹ç›®ä¸­ï¼Œå¯èƒ½è¿˜åœ¨ç”¨å®ƒã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠ&lt;code&gt;ENGINE&lt;/code&gt;å‚æ•°è®¾ç½®æˆ&lt;code&gt;MyISAM&lt;/code&gt;å³å¯ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;CREATEÂ TABLEÂ `category`Â (&lt;br/&gt;Â Â `id`Â bigintÂ NOTÂ NULLÂ AUTO_INCREMENT,&lt;br/&gt;Â Â `one_category`Â varchar(&lt;span&gt;20&lt;/span&gt;)Â COLLATEÂ utf8mb4_binÂ DEFAULTÂ NULL,&lt;br/&gt;Â Â `two_category`Â varchar(&lt;span&gt;20&lt;/span&gt;)Â COLLATEÂ utf8mb4_binÂ DEFAULTÂ NULL,&lt;br/&gt;Â Â `three_category`Â varchar(&lt;span&gt;20&lt;/span&gt;)Â COLLATEÂ utf8mb4_binÂ DEFAULTÂ NULL,&lt;br/&gt;Â Â `four_category`Â varchar(&lt;span&gt;20&lt;/span&gt;)Â COLLATEÂ utf8mb4_binÂ DEFAULTÂ NULL,&lt;br/&gt;Â Â &lt;span&gt;PRIMARYÂ &lt;span&gt;KEY&lt;/span&gt;Â &lt;span&gt;(`id`)&lt;/span&gt;&lt;br/&gt;)Â ENGINE&lt;/span&gt;=MyISAMÂ AUTO_INCREMENT=&lt;span&gt;4&lt;/span&gt;Â DEFAULTÂ CHARSET=utf8mb4Â COLLATE=utf8mb4_bin&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;myisamå¥½ç”¨ï¼Œä½†æœ‰ä¸ªå¾ˆè‡´å‘½çš„é—®é¢˜æ˜¯ï¼š&lt;code&gt;ä¸æ”¯æŒäº‹åŠ¡&lt;/code&gt;ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœåªæ˜¯å•è¡¨æ“ä½œè¿˜å¥½ï¼Œä¸ä¼šå‡ºç°å¤ªå¤§çš„é—®é¢˜ã€‚ä½†å¦‚æœéœ€è¦è·¨å¤šå¼ è¡¨æ“ä½œï¼Œç”±äºå…¶ä¸æ”¯æŒäº‹åŠ¡ï¼Œæ•°æ®ææœ‰å¯èƒ½ä¼šå‡ºç°ä¸å®Œæ•´çš„æƒ…å†µã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ­¤å¤–ï¼Œmyisamè¿˜ä¸æ”¯æŒè¡Œé”å’Œå¤–é”®ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ‰€ä»¥åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œmyisamä½¿ç”¨çš„å¹¶ä¸å¤šã€‚åœ¨mysql5ä»¥åï¼Œmyisamå·²ç»é€æ¸é€€å‡ºäº†å†å²çš„èˆå°ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯innodbã€‚&lt;/p&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;æœ‰æ—¶å€™æˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æŸå¼ è¡¨çš„äº‹åŠ¡ä¸€ç›´éƒ½æ²¡æœ‰ç”Ÿæ•ˆï¼Œé‚£ä¸ä¸€å®šæ˜¯springäº‹åŠ¡çš„é”…ï¼Œæœ€å¥½ç¡®è®¤ä¸€ä¸‹ä½ ä½¿ç”¨çš„é‚£å¼ è¡¨ï¼Œæ˜¯å¦æ”¯æŒäº‹åŠ¡ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;7.æœªå¼€å¯äº‹åŠ¡&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰æ—¶å€™ï¼Œäº‹åŠ¡æ²¡æœ‰ç”Ÿæ•ˆçš„æ ¹æœ¬åŸå› æ˜¯æ²¡æœ‰å¼€å¯äº‹åŠ¡ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½ çœ‹åˆ°è¿™å¥è¯å¯èƒ½ä¼šè§‰å¾—å¥½ç¬‘ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¼€å¯äº‹åŠ¡ä¸æ˜¯ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæœ€æœ€æœ€åŸºæœ¬çš„åŠŸèƒ½å—ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ºä»€ä¹ˆè¿˜ä¼šæ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ²¡é”™ï¼Œå¦‚æœé¡¹ç›®å·²ç»æ­å»ºå¥½äº†ï¼Œäº‹åŠ¡åŠŸèƒ½è‚¯å®šæ˜¯æœ‰çš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†å¦‚æœä½ æ˜¯åœ¨æ­å»ºé¡¹ç›®demoçš„æ—¶å€™ï¼Œåªæœ‰ä¸€å¼ è¡¨ï¼Œè€Œè¿™å¼ è¡¨çš„äº‹åŠ¡æ²¡æœ‰ç”Ÿæ•ˆã€‚é‚£ä¹ˆä¼šæ˜¯ä»€ä¹ˆåŸå› é€ æˆçš„å‘¢ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“ç„¶åŸå› æœ‰å¾ˆå¤šï¼Œä½†æ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Œè¿™ä¸ªåŸå› æå…¶å®¹æ˜“è¢«å¿½ç•¥ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä½ ä½¿ç”¨çš„æ˜¯springbooté¡¹ç›®ï¼Œé‚£ä¹ˆä½ å¾ˆå¹¸è¿ã€‚å› ä¸ºspringbooté€šè¿‡&lt;code&gt;DataSourceTransactionManagerAutoConfiguration&lt;/code&gt;ç±»ï¼Œå·²ç»é»˜é»˜çš„å¸®ä½ å¼€å¯äº†äº‹åŠ¡ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½ æ‰€è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œåªéœ€è¦é…ç½®&lt;code&gt;spring.datasource&lt;/code&gt;ç›¸å…³å‚æ•°å³å¯ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†å¦‚æœä½ ä½¿ç”¨çš„è¿˜æ˜¯ä¼ ç»Ÿçš„springé¡¹ç›®ï¼Œåˆ™éœ€è¦åœ¨applicationContext.xmlæ–‡ä»¶ä¸­ï¼Œæ‰‹åŠ¨é…ç½®äº‹åŠ¡ç›¸å…³å‚æ•°ã€‚å¦‚æœå¿˜äº†é…ç½®ï¼Œäº‹åŠ¡è‚¯å®šæ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…·ä½“é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;Â Â Â &lt;br/&gt;&amp;lt;!--Â é…ç½®äº‹åŠ¡ç®¡ç†å™¨Â --&amp;gt;Â &lt;br/&gt;&amp;lt;beanÂ &lt;span&gt;&lt;span&gt;class&lt;/span&gt;&lt;/span&gt;=&lt;span&gt;&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&lt;/span&gt;Â id=&lt;span&gt;&quot;transactionManager&quot;&lt;/span&gt;&amp;gt;Â &lt;br/&gt;Â Â Â Â &amp;lt;propertyÂ name=&lt;span&gt;&quot;dataSource&quot;&lt;/span&gt;Â ref=&lt;span&gt;&quot;dataSource&quot;&lt;/span&gt;&amp;gt;&amp;lt;/property&amp;gt;Â &lt;br/&gt;&amp;lt;/bean&amp;gt;Â &lt;br/&gt;&amp;lt;tx:adviceÂ id=&lt;span&gt;&quot;advice&quot;&lt;/span&gt;Â transaction-manager=&lt;span&gt;&quot;transactionManager&quot;&lt;/span&gt;&amp;gt;Â &lt;br/&gt;Â Â Â Â &amp;lt;tx:attributes&amp;gt;Â &lt;br/&gt;Â Â Â Â Â Â Â Â &amp;lt;tx:methodÂ name=&lt;span&gt;&quot;*&quot;&lt;/span&gt;Â propagation=&lt;span&gt;&quot;REQUIRED&quot;&lt;/span&gt;/&amp;gt;&lt;br/&gt;Â Â Â Â &amp;lt;/tx:attributes&amp;gt;Â &lt;br/&gt;&amp;lt;/tx:advice&amp;gt;Â &lt;br/&gt;&amp;lt;!--Â ç”¨åˆ‡ç‚¹æŠŠäº‹åŠ¡åˆ‡è¿›å»Â --&amp;gt;Â &lt;br/&gt;&amp;lt;aop:config&amp;gt;Â &lt;br/&gt;Â Â Â Â &amp;lt;aop:pointcutÂ expression=&lt;span&gt;&quot;execution(*Â com.susan.*.*(..))&quot;&lt;/span&gt;Â id=&lt;span&gt;&quot;pointcut&quot;&lt;/span&gt;/&amp;gt;Â &lt;br/&gt;Â Â Â Â &amp;lt;aop:advisorÂ advice-ref=&lt;span&gt;&quot;advice&quot;&lt;/span&gt;Â pointcut-ref=&lt;span&gt;&quot;pointcut&quot;&lt;/span&gt;/&amp;gt;Â &lt;br/&gt;&amp;lt;/aop:config&amp;gt;Â &lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é»˜é»˜çš„è¯´ä¸€å¥ï¼Œå¦‚æœåœ¨pointcutæ ‡ç­¾ä¸­çš„åˆ‡å…¥ç‚¹åŒ¹é…è§„åˆ™ï¼Œé…é”™äº†çš„è¯ï¼Œæœ‰äº›ç±»çš„äº‹åŠ¡ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;äºŒ äº‹åŠ¡ä¸å›æ»š&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;1.é”™è¯¯çš„ä¼ æ’­ç‰¹æ€§&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…¶å®ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨&lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£æ—¶ï¼Œæ˜¯å¯ä»¥æŒ‡å®š&lt;code&gt;propagation&lt;/code&gt;å‚æ•°çš„ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯¥å‚æ•°çš„ä½œç”¨æ˜¯æŒ‡å®šäº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ï¼Œspringç›®å‰æ”¯æŒ7ç§ä¼ æ’­ç‰¹æ€§ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;REQUIRED&lt;/code&gt; å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œé‚£ä¹ˆåŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ˜¯é»˜è®¤çš„ä¼ æ’­å±æ€§å€¼ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;SUPPORTS&lt;/code&gt; å¦‚æœå½“å‰ä¸Šä¸‹æ–‡å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æ”¯æŒäº‹åŠ¡åŠ å…¥äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä½¿ç”¨éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;MANDATORY&lt;/code&gt; å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;REQUIRES_NEW&lt;/code&gt; æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶ä¸”åŒæ—¶å°†ä¸Šä¸‹æ–‡ä¸­çš„äº‹åŠ¡æŒ‚èµ·ï¼Œæ‰§è¡Œå½“å‰æ–°å»ºäº‹åŠ¡å®Œæˆä»¥åï¼Œä¸Šä¸‹æ–‡äº‹åŠ¡æ¢å¤å†æ‰§è¡Œã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;NOT_SUPPORTED&lt;/code&gt; å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œç„¶åæ–°çš„æ–¹æ³•åœ¨æ²¡æœ‰äº‹åŠ¡çš„ç¯å¢ƒä¸­æ‰§è¡Œã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;NEVER&lt;/code&gt; å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™åœ¨æ— äº‹åŠ¡ç¯å¢ƒä¸Šæ‰§è¡Œä»£ç ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;NESTED&lt;/code&gt; å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åµŒå¥—äº‹åŠ¡æ‰§è¡Œï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æ–°å»ºäº‹åŠ¡ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœæˆ‘ä»¬åœ¨æ‰‹åŠ¨è®¾ç½®propagationå‚æ•°çš„æ—¶å€™ï¼ŒæŠŠä¼ æ’­ç‰¹æ€§è®¾ç½®é”™äº†ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;(propagationÂ =Â Propagation.NEVER)&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â saveData(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â updateData(userModel);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°addæ–¹æ³•çš„äº‹åŠ¡ä¼ æ’­ç‰¹æ€§å®šä¹‰æˆäº†Propagation.NEVERï¼Œè¿™ç§ç±»å‹çš„ä¼ æ’­ç‰¹æ€§ä¸æ”¯æŒäº‹åŠ¡ï¼Œå¦‚æœæœ‰äº‹åŠ¡åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç›®å‰åªæœ‰è¿™ä¸‰ç§ä¼ æ’­ç‰¹æ€§æ‰ä¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼šREQUIREDï¼ŒREQUIRES_NEWï¼ŒNESTEDã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;2.è‡ªå·±åäº†å¼‚å¸¸&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;äº‹åŠ¡ä¸ä¼šå›æ»šï¼Œæœ€å¸¸è§çš„é—®é¢˜æ˜¯ï¼šå¼€å‘è€…åœ¨ä»£ç ä¸­æ‰‹åŠ¨try...catchäº†å¼‚å¸¸ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Slf&lt;/span&gt;4j&lt;br/&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â saveData(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â updateData(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â log.error(e.getMessage(),Â e);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ç§æƒ…å†µä¸‹springäº‹åŠ¡å½“ç„¶ä¸ä¼šå›æ»šï¼Œå› ä¸ºå¼€å‘è€…è‡ªå·±æ•è·äº†å¼‚å¸¸ï¼Œåˆæ²¡æœ‰æ‰‹åŠ¨æŠ›å‡ºï¼Œæ¢å¥è¯è¯´å°±æ˜¯æŠŠå¼‚å¸¸åæ‰äº†ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœæƒ³è¦springäº‹åŠ¡èƒ½å¤Ÿæ­£å¸¸å›æ»šï¼Œå¿…é¡»æŠ›å‡ºå®ƒèƒ½å¤Ÿå¤„ç†çš„å¼‚å¸¸ã€‚å¦‚æœæ²¡æœ‰æŠ›å¼‚å¸¸ï¼Œåˆ™springè®¤ä¸ºç¨‹åºæ˜¯æ­£å¸¸çš„ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;3.æ‰‹åŠ¨æŠ›äº†åˆ«çš„å¼‚å¸¸&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å³ä½¿å¼€å‘è€…æ²¡æœ‰æ‰‹åŠ¨æ•è·å¼‚å¸¸ï¼Œä½†å¦‚æœæŠ›çš„å¼‚å¸¸ä¸æ­£ç¡®ï¼Œspringäº‹åŠ¡ä¹Ÿä¸ä¼šå›æ»šã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Slf&lt;/span&gt;4j&lt;br/&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â ExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â saveData(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â updateData(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â log.error(e.getMessage(),Â e);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;throw&lt;/span&gt;Â &lt;span&gt;new&lt;/span&gt;Â Exception(e);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šé¢çš„è¿™ç§æƒ…å†µï¼Œå¼€å‘äººå‘˜è‡ªå·±æ•è·äº†å¼‚å¸¸ï¼Œåˆæ‰‹åŠ¨æŠ›å‡ºäº†å¼‚å¸¸ï¼šExceptionï¼Œäº‹åŠ¡åŒæ ·ä¸ä¼šå›æ»šã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å› ä¸ºspringäº‹åŠ¡ï¼Œé»˜è®¤æƒ…å†µä¸‹åªä¼šå›æ»š&lt;code&gt;RuntimeException&lt;/code&gt;ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰å’Œ&lt;code&gt;Error&lt;/code&gt;ï¼ˆé”™è¯¯ï¼‰ï¼Œå¯¹äºæ™®é€šçš„Exceptionï¼ˆéè¿è¡Œæ—¶å¼‚å¸¸ï¼‰ï¼Œå®ƒä¸ä¼šå›æ»šã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;4.è‡ªå®šä¹‰äº†å›æ»šå¼‚å¸¸&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨ä½¿ç”¨@Transactionalæ³¨è§£å£°æ˜äº‹åŠ¡æ—¶ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³è‡ªå®šä¹‰å›æ»šçš„å¼‚å¸¸ï¼Œspringä¹Ÿæ˜¯æ”¯æŒçš„ã€‚å¯ä»¥é€šè¿‡è®¾ç½®&lt;code&gt;rollbackFor&lt;/code&gt;å‚æ•°ï¼Œæ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†å¦‚æœè¿™ä¸ªå‚æ•°çš„å€¼è®¾ç½®é”™äº†ï¼Œå°±ä¼šå¼•å‡ºä¸€äº›è«åå…¶å¦™çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Slf&lt;/span&gt;4j&lt;br/&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;(rollbackForÂ =Â BusinessException&lt;span&gt;.&lt;span&gt;class&lt;/span&gt;)&lt;br/&gt;Â Â Â Â &lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;(&lt;span&gt;UserModel&lt;/span&gt;Â &lt;span&gt;userModel&lt;/span&gt;)Â &lt;span&gt;throws&lt;/span&gt;Â &lt;span&gt;Exception&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â saveData(userModel);&lt;br/&gt;Â Â Â Â Â Â Â updateData(userModel);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœåœ¨æ‰§è¡Œä¸Šé¢è¿™æ®µä»£ç ï¼Œä¿å­˜å’Œæ›´æ–°æ•°æ®æ—¶ï¼Œç¨‹åºæŠ¥é”™äº†ï¼ŒæŠ›äº†SqlExceptionã€DuplicateKeyExceptionç­‰å¼‚å¸¸ã€‚è€ŒBusinessExceptionæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸ï¼ŒæŠ¥é”™çš„å¼‚å¸¸ä¸å±äºBusinessExceptionï¼Œæ‰€ä»¥äº‹åŠ¡ä¹Ÿä¸ä¼šå›æ»šã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å³ä½¿rollbackForæœ‰é»˜è®¤å€¼ï¼Œä½†é˜¿é‡Œå·´å·´å¼€å‘è€…è§„èŒƒä¸­ï¼Œè¿˜æ˜¯è¦æ±‚å¼€å‘è€…é‡æ–°æŒ‡å®šè¯¥å‚æ•°ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å› ä¸ºå¦‚æœä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸€æ—¦ç¨‹åºæŠ›å‡ºäº†Exceptionï¼Œäº‹åŠ¡ä¸ä¼šå›æ»šï¼Œè¿™ä¼šå‡ºç°å¾ˆå¤§çš„bugã€‚æ‰€ä»¥ï¼Œå»ºè®®ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†è¯¥å‚æ•°è®¾ç½®æˆï¼šExceptionæˆ–Throwableã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;5.åµŒå¥—äº‹åŠ¡å›æ»šå¤šäº†&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â UserMapperÂ userMapper;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â RoleServiceÂ roleService;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â ExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â userMapper.insertUser(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â roleService.doOtherThing();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;RoleService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;(propagationÂ =Â Propagation.NESTED)&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;doOtherThing&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â System.out.println(&lt;span&gt;&quot;ä¿å­˜roleè¡¨æ•°æ®&quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ç§æƒ…å†µä½¿ç”¨äº†åµŒå¥—çš„å†…éƒ¨äº‹åŠ¡ï¼ŒåŸæœ¬æ˜¯å¸Œæœ›è°ƒç”¨roleService.doOtherThingæ–¹æ³•æ—¶ï¼Œå¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼Œåªå›æ»šdoOtherThingæ–¹æ³•é‡Œçš„å†…å®¹ï¼Œä¸å›æ»š userMapper.insertUseré‡Œçš„å†…å®¹ï¼Œå³å›æ»šä¿å­˜ç‚¹ã€‚ã€‚ä½†äº‹å®æ˜¯ï¼ŒinsertUserä¹Ÿå›æ»šäº†ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;why?&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å› ä¸ºdoOtherThingæ–¹æ³•å‡ºç°äº†å¼‚å¸¸ï¼Œæ²¡æœ‰æ‰‹åŠ¨æ•è·ï¼Œä¼šç»§ç»­å¾€ä¸ŠæŠ›ï¼Œåˆ°å¤–å±‚addæ–¹æ³•çš„ä»£ç†æ–¹æ³•ä¸­æ•è·äº†å¼‚å¸¸ã€‚æ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µæ˜¯ç›´æ¥å›æ»šäº†æ•´ä¸ªäº‹åŠ¡ï¼Œä¸åªå›æ»šå•ä¸ªä¿å­˜ç‚¹ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ€ä¹ˆæ ·æ‰èƒ½åªå›æ»šä¿å­˜ç‚¹å‘¢ï¼Ÿ&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Slf&lt;/span&gt;4j&lt;br/&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â UserMapperÂ userMapper;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â RoleServiceÂ roleService;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â ExceptionÂ &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â userMapper.insertUser(userModel);&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;try&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â roleService.doOtherThing();&lt;br/&gt;Â Â Â Â Â Â Â Â }Â &lt;span&gt;catch&lt;/span&gt;Â (ExceptionÂ e)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â log.error(e.getMessage(),Â e);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯ä»¥å°†å†…éƒ¨åµŒå¥—äº‹åŠ¡æ”¾åœ¨try/catchä¸­ï¼Œå¹¶ä¸”ä¸ç»§ç»­å¾€ä¸ŠæŠ›å¼‚å¸¸ã€‚è¿™æ ·å°±èƒ½ä¿è¯ï¼Œå¦‚æœå†…éƒ¨åµŒå¥—äº‹åŠ¡ä¸­å‡ºç°å¼‚å¸¸ï¼Œåªå›æ»šå†…éƒ¨äº‹åŠ¡ï¼Œè€Œä¸å½±å“å¤–éƒ¨äº‹åŠ¡ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span&gt;ä¸‰ å…¶ä»–&lt;/span&gt;&lt;/h2&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;1 å¤§äº‹åŠ¡é—®é¢˜&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨ä½¿ç”¨springäº‹åŠ¡æ—¶ï¼Œæœ‰ä¸ªè®©äººéå¸¸å¤´ç–¼çš„é—®é¢˜ï¼Œå°±æ˜¯å¤§äº‹åŠ¡é—®é¢˜ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šåœ¨æ–¹æ³•ä¸Š&lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ï¼Œå¡«åŠ äº‹åŠ¡åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;UserService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;Â &lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â RoleServiceÂ roleService;&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;add&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â ExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â query1();&lt;br/&gt;Â Â Â Â Â Â Â query2();&lt;br/&gt;Â Â Â Â Â Â Â query3();&lt;br/&gt;Â Â Â Â Â Â Â roleService.save(userModel);&lt;br/&gt;Â Â Â Â Â Â Â update(userModel);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;@Service&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;RoleService&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;Â &lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â RoleServiceÂ roleService;&lt;br/&gt;Â Â Â Â &lt;br/&gt;Â Â Â Â &lt;span&gt;@Transactional&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;save&lt;/span&gt;&lt;span&gt;(UserModelÂ userModel)&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â ExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â query4();&lt;br/&gt;Â Â Â Â Â Â Â query5();&lt;br/&gt;Â Â Â Â Â Â Â query6();&lt;br/&gt;Â Â Â Â Â Â Â saveData(userModel);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†&lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£ï¼Œå¦‚æœè¢«åŠ åˆ°æ–¹æ³•ä¸Šï¼Œæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯æ•´ä¸ªæ–¹æ³•éƒ½åŒ…å«åœ¨äº‹åŠ¡å½“ä¸­äº†ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨UserServiceç±»ä¸­ï¼Œå…¶å®åªæœ‰è¿™ä¸¤è¡Œæ‰éœ€è¦äº‹åŠ¡ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;roleService.save(userModel);&lt;br/&gt;update(userModel);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨RoleServiceç±»ä¸­ï¼Œåªæœ‰è¿™ä¸€è¡Œéœ€è¦äº‹åŠ¡ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;saveData(userModel);&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç°åœ¨çš„è¿™ç§å†™æ³•ï¼Œä¼šå¯¼è‡´æ‰€æœ‰çš„queryæ–¹æ³•ä¹Ÿè¢«åŒ…å«åœ¨åŒä¸€ä¸ªäº‹åŠ¡å½“ä¸­ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœqueryæ–¹æ³•éå¸¸å¤šï¼Œè°ƒç”¨å±‚çº§å¾ˆæ·±ï¼Œè€Œä¸”æœ‰éƒ¨åˆ†æŸ¥è¯¢æ–¹æ³•æ¯”è¾ƒè€—æ—¶çš„è¯ï¼Œä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡éå¸¸è€—æ—¶ï¼Œè€Œä»é€ æˆå¤§äº‹åŠ¡é—®é¢˜ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img class=&quot;rich_pages wxw-img&quot; data-ratio=&quot;0.2759259259259259&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uL371281oDEBCPPbyDJ73OtgGneSbqS4EPv3uEv9HEcX4hevWFJGDG8gPspHNL0abAiaEvxZoGZbBIkTbBQGfHQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1080&quot;/&gt;&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;span/&gt;&lt;span&gt;2.ç¼–ç¨‹å¼äº‹åŠ¡&lt;/span&gt;&lt;span/&gt;&lt;/h3&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šé¢èŠçš„è¿™äº›å†…å®¹éƒ½æ˜¯åŸºäº&lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£çš„ï¼Œä¸»è¦è¯´çš„æ˜¯å®ƒçš„äº‹åŠ¡é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åšï¼š&lt;code&gt;å£°æ˜å¼äº‹åŠ¡&lt;/code&gt;ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…¶å®ï¼Œspringè¿˜æä¾›äº†å¦å¤–ä¸€ç§åˆ›å»ºäº‹åŠ¡çš„æ–¹å¼ï¼Œå³é€šè¿‡æ‰‹åŠ¨ç¼–å†™ä»£ç å®ç°çš„äº‹åŠ¡ï¼Œ&lt;span&gt;æˆ‘ä»¬æŠŠè¿™ç§äº‹åŠ¡å«åš&lt;/span&gt;ï¼š&lt;code&gt;ç¼–ç¨‹å¼äº‹åŠ¡&lt;/code&gt;ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;br/&gt;Â Â Â &lt;span&gt;@Autowired&lt;/span&gt;&lt;br/&gt;Â Â Â &lt;span&gt;private&lt;/span&gt;Â TransactionTemplateÂ transactionTemplate;&lt;br/&gt;Â Â Â &lt;br/&gt;Â Â Â ...&lt;br/&gt;Â Â Â &lt;br/&gt;Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;save&lt;/span&gt;&lt;span&gt;(&lt;span&gt;final&lt;/span&gt;Â UserÂ user)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â Â queryData1();&lt;br/&gt;Â Â Â Â Â Â Â Â Â queryData2();&lt;br/&gt;Â Â Â Â Â Â Â Â Â transactionTemplate.execute((status)Â =&amp;gt;Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â addData1();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â updateData2();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â Boolean.TRUE;&lt;br/&gt;Â Â Â Â Â Â Â Â Â })&lt;br/&gt;Â Â Â }&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨springä¸­ä¸ºäº†æ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¸“é—¨æä¾›äº†ä¸€ä¸ªç±»ï¼šTransactionTemplateï¼Œåœ¨å®ƒçš„executeæ–¹æ³•ä¸­ï¼Œå°±å®ç°äº†äº‹åŠ¡çš„åŠŸèƒ½ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç›¸è¾ƒäº&lt;code&gt;@Transactional&lt;/code&gt;æ³¨è§£å£°æ˜å¼äº‹åŠ¡ï¼Œæˆ‘æ›´å»ºè®®å¤§å®¶ä½¿ç”¨ï¼ŒåŸºäº&lt;code&gt;TransactionTemplate&lt;/code&gt;çš„ç¼–ç¨‹å¼äº‹åŠ¡ã€‚ä¸»è¦åŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;é¿å…ç”±äºspring aopé—®é¢˜ï¼Œå¯¼è‡´äº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;èƒ½å¤Ÿæ›´å°ç²’åº¦çš„æ§åˆ¶äº‹åŠ¡çš„èŒƒå›´ï¼Œæ›´ç›´è§‚ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ol&gt;&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;p&gt;å»ºè®®åœ¨é¡¹ç›®ä¸­å°‘ä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡ã€‚ä½†å¹¶ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ç”¨å®ƒï¼Œå¦‚æœé¡¹ç›®ä¸­æœ‰äº›ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”ä¸ç»å¸¸å˜åŠ¨ï¼Œä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯äº‹åŠ¡å¼€å¯äº‹åŠ¡ä¹Ÿæ— å¦¨ï¼Œå› ä¸ºå®ƒæ›´ç®€å•ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯åƒä¸‡è¦å°å¿ƒäº‹åŠ¡å¤±æ•ˆçš„é—®é¢˜ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>a9646836ccb4bfcc7eaed8d59362ee2a</guid>
<title>ApacheCN Python è¯‘æ–‡é›†</title>
<link>https://toutiao.io/k/4c56kbq</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;snippet-clipboard-content position-relative overflow-auto&quot; data-snippet-clipboard-copy-content=&quot;docker pull apachecn0/apachecn-python-zh&amp;#10;docker run -tid -p &amp;lt;port&amp;gt;:80 apachecn0/apachecn-python-zh&amp;#10;# è®¿é—® http://localhost:{port} æŸ¥çœ‹æ–‡æ¡£&quot;&gt;&lt;pre&gt;&lt;code&gt;docker pull apachecn0/apachecn-python-zh
docker run -tid -p &amp;lt;port&amp;gt;:80 apachecn0/apachecn-python-zh
# è®¿é—® http://localhost:{port} æŸ¥çœ‹æ–‡æ¡£
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;snippet-clipboard-content position-relative overflow-auto&quot; data-snippet-clipboard-copy-content=&quot;pip install apachecn-python-zh&amp;#10;apachecn-python-zh &amp;lt;port&amp;gt;&amp;#10;# è®¿é—® http://localhost:{port} æŸ¥çœ‹æ–‡æ¡£&quot;&gt;&lt;pre&gt;&lt;code&gt;pip install apachecn-python-zh
apachecn-python-zh &amp;lt;port&amp;gt;
# è®¿é—® http://localhost:{port} æŸ¥çœ‹æ–‡æ¡£
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;snippet-clipboard-content position-relative overflow-auto&quot; data-snippet-clipboard-copy-content=&quot;npm install -g apachecn-python-zh&amp;#10;apachecn-python-zh &amp;lt;port&amp;gt;&amp;#10;# è®¿é—® http://localhost:{port} æŸ¥çœ‹æ–‡æ¡£&quot;&gt;&lt;pre&gt;&lt;code&gt;npm install -g apachecn-python-zh
apachecn-python-zh &amp;lt;port&amp;gt;
# è®¿é—® http://localhost:{port} æŸ¥çœ‹æ–‡æ¡£
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>39d3293365a212b4901a5c2a5a036f86</guid>
<title>Flink Kafka Connector ä¸ Exactly Once å‰–æ</title>
<link>https://toutiao.io/k/qjedev9</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;p class=&quot;original_area_primary&quot;&gt;
                                                                                                &lt;/p&gt;

                    
                                            &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    
                    
                    
                    &lt;section data-role=&quot;outer&quot; label=&quot;Powered by 135editor.com&quot;&gt;&lt;section&gt;&lt;span&gt;Flink Kafka Connector æ˜¯ Flink å†…ç½®çš„ Kafka è¿æ¥å™¨ï¼Œå®ƒåŒ…å«äº†ä» Kafka Topic è¯»å…¥æ•°æ®çš„ Flink Kafka Consumer ä»¥åŠå‘ Kafka Topic å†™å‡ºæ•°æ®çš„ Flink Kafka Producerï¼Œé™¤æ­¤ä¹‹å¤– Flink Kafa Connector åŸºäº Flink Checkpoint æœºåˆ¶æä¾›äº†å®Œå–„çš„å®¹é”™èƒ½åŠ›ã€‚æœ¬æ–‡ä» Flink Kafka Connector çš„åŸºæœ¬ä½¿ç”¨åˆ° Kafka åœ¨ Flink ä¸­ç«¯åˆ°ç«¯çš„å®¹é”™åŸç†å±•å¼€è®¨è®ºã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;_135editor&quot; data-tools=&quot;135ç¼–è¾‘å™¨&quot; data-id=&quot;94679&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section class=&quot;horizontal-tb&quot;&gt;&lt;p&gt;&lt;strong&gt;1.Flink Kafka çš„ä½¿ç”¨&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;åœ¨ Flink ä¸­ä½¿ç”¨ Kafka Connector æ—¶éœ€è¦ä¾èµ– Kafka çš„ç‰ˆæœ¬ï¼ŒFlink é’ˆå¯¹ä¸åŒçš„ Kafka ç‰ˆæœ¬æä¾›äº†å¯¹åº”çš„ Connector å®ç°ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;_135editor&quot; data-tools=&quot;135ç¼–è¾‘å™¨&quot; data-id=&quot;92984&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;1.1Â &lt;/span&gt;&lt;span&gt;ç‰ˆæœ¬ä¾èµ–&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æ—¢ç„¶ Flink å¯¹ä¸åŒç‰ˆæœ¬çš„ Kafka æœ‰ä¸åŒå®ç°ï¼Œåœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„åŒºåˆ†ï¼Œæ ¹æ®ä½¿ç”¨ç¯å¢ƒå¼•å…¥æ­£ç¡®çš„ä¾èµ–å…³ç³»ã€‚&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;output_wrapper&quot;&gt;&lt;pre&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.apache.flink&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;/&lt;span class=&quot;code-snippet__name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;${flink_kafka_connector_version}&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;/&lt;span class=&quot;code-snippet__name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;${flink_version}&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;/&lt;span class=&quot;code-snippet__name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/&lt;span class=&quot;code-snippet__name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;åœ¨ä¸Šé¢çš„ä¾èµ–é…ç½®ä¸­ ${flink_version} æŒ‡ä½¿ç”¨ Flink çš„ç‰ˆæœ¬ï¼Œ${flink_connector_kafka_version} æŒ‡ä¾èµ–çš„ Kafka connector ç‰ˆæœ¬å¯¹åº”çš„ artifactIdã€‚ä¸‹è¡¨æè¿°äº†æˆªæ­¢ç›®å‰ä¸ºæ­¢ Kafka æœåŠ¡ç‰ˆæœ¬ä¸ Flink Connector ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;Flink å®˜ç½‘å†…å®¹ Apache KafkaÂ &lt;/span&gt;&lt;span&gt;Connector ä¸­ä¹Ÿæœ‰è¯¦ç»†çš„è¯´æ˜ã€‚&lt;br/&gt;&lt;br/&gt;&lt;span/&gt;&lt;/span&gt;&lt;/section&gt;&lt;blockquote class=&quot;js_blockquote_wrap&quot; data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;89&quot; data-source-title=&quot;&quot;&gt;&lt;section class=&quot;js_blockquote_digest&quot;&gt;&lt;section&gt;&lt;span&gt;é“¾æ¥ï¼š&lt;br/&gt;&lt;/span&gt;&lt;span&gt;https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/connectors/kafka.html&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.3408333333333333&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXANBq0r47afhfsmxsOmtxZUw0NCibuiaUSK4NV1J212lvC37Crb0Wzqm5g/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä» Flink 1.7 ç‰ˆæœ¬å¼€å§‹ä¸º Kafka 1.0.0 åŠä»¥ä¸Šç‰ˆæœ¬æä¾›äº†å…¨æ–°çš„ Kafka Connector æ”¯æŒï¼Œå¦‚æœä½¿ç”¨çš„ Kafka ç‰ˆæœ¬åœ¨ 1.0.0 åŠä»¥ä¸Šå¯ä»¥å¿½ç•¥å›  Kafka ç‰ˆæœ¬å·®å¼‚å¸¦æ¥çš„ä¾èµ–å˜åŒ–ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;1.2Â &lt;/span&gt;&lt;span&gt;åŸºæœ¬ä½¿ç”¨&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æ˜ç¡®äº†ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬åå°±å¯ä»¥ç¼–å†™ä¸€ä¸ªåŸºäº Flink Kafka è¯»/å†™çš„åº”ç”¨ç¨‹åºã€Œæœ¬æ–‡è®¨è®ºå†…å®¹å…¨éƒ¨åŸºäº Flink 1.7 ç‰ˆæœ¬å’Œ Kafka 1.1.0 ç‰ˆæœ¬ã€ã€‚æ ¹æ®ä¸Šé¢æè¿°çš„å¯¹åº”å…³ç³»åœ¨å·¥ç¨‹ä¸­æ·»åŠ  Kafka Connector ä¾èµ–ã€‚&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;output_wrapper&quot;&gt;&lt;pre&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;xml&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.apache.flink&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;/&lt;span class=&quot;code-snippet__name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;flink-connector-kafka_2.11&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;/&lt;span class=&quot;code-snippet__name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;&lt;span class=&quot;code-snippet__name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;1.7.0&lt;span class=&quot;code-snippet__tag&quot;&gt;&amp;lt;/&lt;span class=&quot;code-snippet__name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&amp;lt;/&lt;span class=&quot;code-snippet__name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ˜¯ä» Kafka Topicã€Œflink_kafka_poc_inputã€ä¸­æ¶ˆè´¹æ•°æ®ï¼Œå†å†™å…¥ Kafka Topicã€Œflink_kafka_poc_outputã€çš„ç®€å•ç¤ºä¾‹ã€‚ç¤ºä¾‹ä¸­é™¤äº†è¯»/å†™ Kafka Topic å¤–ï¼Œæ²¡æœ‰åšå…¶ä»–çš„é€»è¾‘å¤„ç†ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;output_wrapper&quot;&gt;&lt;pre&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;typescript&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-snippet__built_in&quot;&gt;void&lt;/span&gt; main(&lt;span class=&quot;code-snippet__built_in&quot;&gt;String&lt;/span&gt;[] args) {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  Properties consumerConfig = &lt;span class=&quot;code-snippet__keyword&quot;&gt;new&lt;/span&gt; Properties();&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  consumerConfig.setProperty(&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;bootstrap.servers&quot;&lt;/span&gt;, &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;127.0.0.1:9091&quot;&lt;/span&gt;);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  consumerConfig.setProperty(&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;group.id&quot;&lt;/span&gt;, &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;flink_poc_k110_consumer&quot;&lt;/span&gt;);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  FlinkKafkaConsumer&amp;lt;&lt;span class=&quot;code-snippet__built_in&quot;&gt;String&lt;/span&gt;&amp;gt; flinkKafkaConsumer = &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__keyword&quot;&gt;new&lt;/span&gt; FlinkKafkaConsumer&amp;lt;&lt;span class=&quot;code-snippet__built_in&quot;&gt;String&lt;/span&gt;&amp;gt;(&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;      &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;flink_kafka_poc_input&quot;&lt;/span&gt;, &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;      &lt;span class=&quot;code-snippet__keyword&quot;&gt;new&lt;/span&gt; SimpleStringSchema(), &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;      consumerConfig&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    );&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  DataStream&amp;lt;&lt;span class=&quot;code-snippet__built_in&quot;&gt;String&lt;/span&gt;&amp;gt; stream = env.addSource(flinkKafkaConsumer);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  Properties producerConfig = &lt;span class=&quot;code-snippet__keyword&quot;&gt;new&lt;/span&gt; Properties();&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  producerConfig.setProperty(&lt;span class=&quot;code-snippet__string&quot;&gt;&quot;bootstrap.servers&quot;&lt;/span&gt;, &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;127.0.0.1:9091&quot;&lt;/span&gt;);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  FlinkKafkaProducer&amp;lt;&lt;span class=&quot;code-snippet__built_in&quot;&gt;String&lt;/span&gt;&amp;gt; myProducer = &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__keyword&quot;&gt;new&lt;/span&gt; FlinkKafkaProducer&amp;lt;&lt;span class=&quot;code-snippet__built_in&quot;&gt;String&lt;/span&gt;&amp;gt;(&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;      &lt;span class=&quot;code-snippet__string&quot;&gt;&quot;flink_kafka_poc_output&quot;&lt;/span&gt;, &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;      &lt;span class=&quot;code-snippet__keyword&quot;&gt;new&lt;/span&gt; MapSerialization(), &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;      producerConfig&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    );&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  stream.addSink(myProducer);&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  env.execute();&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;br/&gt;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;class&lt;/span&gt; MapSerialization &lt;span class=&quot;code-snippet__keyword&quot;&gt;implements&lt;/span&gt; SerializationSchema&amp;lt;&lt;span class=&quot;code-snippet__built_in&quot;&gt;String&lt;/span&gt;&amp;gt; {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;span class=&quot;code-snippet__keyword&quot;&gt;public&lt;/span&gt; byte[] serialize(&lt;span class=&quot;code-snippet__built_in&quot;&gt;String&lt;/span&gt; element) {&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;    &lt;span class=&quot;code-snippet__keyword&quot;&gt;return&lt;/span&gt; element.getBytes();&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  }&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;br/&gt;&lt;/section&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Flink API ä½¿ç”¨èµ·æ¥ç¡®å®éå¸¸ç®€å•ï¼Œè°ƒç”¨ addSource æ–¹æ³•å’Œ addSink æ–¹æ³•å°±å¯ä»¥å°†åˆå§‹åŒ–å¥½çš„ FlinkKafkaConsumer å’Œ FlinkKafkaProducer åŠ å…¥åˆ°æµå¤„ç†ä¸­ã€‚execute æ‰§è¡Œåï¼ŒKafkaConsumer å’Œ KafkaProducer å°±å¯ä»¥å¼€å§‹æ­£å¸¸å·¥ä½œäº†ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;_135editor&quot; data-tools=&quot;135ç¼–è¾‘å™¨&quot; data-id=&quot;94679&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section class=&quot;horizontal-tb&quot;&gt;&lt;p&gt;&lt;strong&gt;2.Flink Kafka çš„å®¹é”™&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¼—æ‰€å‘¨çŸ¥ï¼ŒFlink æ”¯æŒ Exactly-once semanticsã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿç¿»è¯‘è¿‡æ¥å°±æ˜¯ã€Œæ°å¥½ä¸€æ¬¡è¯­ä¹‰ã€ã€‚æµå¤„ç†ç³»ç»Ÿä¸­ï¼Œæ•°æ®æºæºä¸æ–­çš„æµå…¥åˆ°ç³»ç»Ÿã€è¢«å¤„ç†ã€æœ€åè¾“å‡ºç»“æœã€‚æˆ‘ä»¬éƒ½ä¸å¸Œæœ›ç³»ç»Ÿå› äººä¸ºæˆ–å¤–éƒ¨å› ç´ äº§ç”Ÿä»»ä½•æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚å¯¹äº Exactly-once è¯­ä¹‰è¾¾åˆ°çš„ç›®çš„æ˜¯æŒ‡å³ä½¿ç³»ç»Ÿè¢«äººä¸ºåœæ­¢ã€å› æ•…éšœ shutdownã€æ— æ•…å…³æœºç­‰ä»»ä½•å› ç´ åœæ­¢è¿è¡ŒçŠ¶æ€æ—¶ï¼Œå¯¹äºç³»ç»Ÿä¸­çš„æ¯æ¡æ•°æ®ä¸ä¼šè¢«é‡å¤å¤„ç†ä¹Ÿä¸ä¼šå°‘å¤„ç†ã€‚&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;_135editor&quot; data-tools=&quot;135ç¼–è¾‘å™¨&quot; data-id=&quot;92984&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;2.1 Flink Exactly-once&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Flink å®£ç§°æ”¯æŒ Exactly-once å…¶é’ˆå¯¹çš„æ˜¯ Flink åº”ç”¨å†…éƒ¨çš„æ•°æ®æµå¤„ç†ã€‚ä½† Flink åº”ç”¨å†…éƒ¨è¦æƒ³å¤„ç†æ•°æ®é¦–å…ˆè¦æœ‰æ•°æ®æµå…¥åˆ° Flink åº”ç”¨ï¼Œå…¶æ¬¡ Flink åº”ç”¨å¯¹æ•°æ®å¤„ç†å®Œæ¯•åä¹Ÿç†åº”å¯¹æ•°æ®åšåç»­çš„è¾“å‡ºã€‚åœ¨ Flink ä¸­æ•°æ®çš„æµå…¥ç§°ä¸º Sourceï¼Œæ•°æ®çš„åç»­è¾“å‡ºç§°ä¸º Sinkï¼Œå¯¹äº Source å’Œ Sink å®Œå…¨ä¾é å¤–éƒ¨ç³»ç»Ÿæ”¯æ’‘ï¼ˆæ¯”å¦‚ Kafkaï¼‰ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Flink è‡ªèº«æ˜¯æ— æ³•ä¿è¯å¤–éƒ¨ç³»ç»Ÿçš„ Exactly-once è¯­ä¹‰ã€‚ä½†è¿™æ ·ä¸€æ¥å…¶å®å¹¶ä¸èƒ½ç§°ä¸ºå®Œæ•´çš„ Exactly-onceï¼Œæˆ–è€…è¯´ Flink å¹¶ä¸èƒ½ä¿è¯ç«¯åˆ°ç«¯ Exactly-onceã€‚è€Œå¯¹äºæ•°æ®ç²¾å‡†æ€§è¦æ±‚æé«˜çš„ç³»ç»Ÿå¿…é¡»è¦ä¿è¯ç«¯åˆ°ç«¯çš„ Exactly-onceï¼Œæ‰€è°“ç«¯åˆ°ç«¯æ˜¯æŒ‡ Flink åº”ç”¨ä» Source ä¸€ç«¯å¼€å§‹åˆ° Sink ä¸€ç«¯ç»“æŸï¼Œæ•°æ®å¿…ç»çš„èµ·å§‹å’Œç»“æŸä¸¤ä¸ªç«¯ç‚¹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;é‚£ä¹ˆå¦‚ä½•å®ç°ç«¯åˆ°ç«¯çš„ Exactly-once å‘¢ï¼ŸFlink åº”ç”¨æ‰€ä¾èµ–çš„å¤–éƒ¨ç³»ç»Ÿéœ€è¦æä¾› Exactly-once æ”¯æ’‘ï¼Œå¹¶ç»“åˆ Flink æä¾›çš„ Checkpoint æœºåˆ¶å’Œ Two Phase Commit æ‰èƒ½å®ç° Flink ç«¯åˆ°ç«¯çš„ Exactly-onceã€‚å¯¹äº Source å’Œ Sink çš„å®¹é”™ä¿éšœï¼ŒFlink å®˜æ–¹ç»™å‡ºäº†å…·ä½“è¯´æ˜ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Fault Tolerance Guarantees of Data Sources and Sinksï¼š&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;blockquote class=&quot;js_blockquote_wrap&quot; data-type=&quot;2&quot; data-url=&quot;&quot; data-author-name=&quot;&quot; data-content-utf8-length=&quot;90&quot; data-source-title=&quot;&quot;&gt;&lt;section class=&quot;js_blockquote_digest&quot;&gt;&lt;section&gt;https://ci.apache.org/projects/flink/flink-docs-release-1.7/dev/connectors/guarantees.html&lt;/section&gt;&lt;/section&gt;&lt;/blockquote&gt;&lt;section class=&quot;_135editor&quot; data-tools=&quot;135ç¼–è¾‘å™¨&quot; data-id=&quot;92984&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;2.2Â &lt;/span&gt;&lt;span&gt;Flink Checkpoint&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;åœ¨è®¨è®ºåŸºäº Kafka ç«¯åˆ°ç«¯çš„ Exactly-once ä¹‹å‰å…ˆç®€å•äº†è§£ä¸€ä¸‹ Flink Checkpointã€‚Flink Checkpoint æ˜¯ Flink ç”¨æ¥å®ç°åº”ç”¨ä¸€è‡´æ€§å¿«ç…§çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå½“ Flink å› æ•…éšœæˆ–å…¶ä»–åŸå› é‡å¯åå¯ä»¥é€šè¿‡æœ€åä¸€æ¬¡æˆåŠŸçš„ Checkpoint å°†åº”ç”¨æ¢å¤åˆ°å½“æ—¶çš„çŠ¶æ€ã€‚å¦‚æœåœ¨åº”ç”¨ä¸­å¯ç”¨äº† Checkpointï¼Œä¼šç”± JobManager æŒ‰æŒ‡å®šæ—¶é—´é—´éš”è§¦å‘ Checkpointï¼ŒFlink åº”ç”¨å†…æ‰€æœ‰å¸¦çŠ¶æ€çš„ Operator ä¼šå¤„ç†æ¯ä¸€è½® Checkpoint ç”Ÿå‘½å‘¨æœŸå†…çš„å‡ ä¸ªçŠ¶æ€ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ç”± CheckpointedFunction æ¥å£å®šä¹‰ã€‚Task å¯åŠ¨æ—¶è·å–åº”ç”¨ä¸­æ‰€æœ‰å®ç°äº†CheckpointedFunction çš„ Operatorï¼Œå¹¶è§¦å‘æ‰§è¡Œ initializeState æ–¹æ³•ã€‚åœ¨æ–¹æ³•çš„å®ç°ä¸­ä¸€èˆ¬éƒ½æ˜¯ä»çŠ¶æ€åç«¯å°†å¿«ç…§çŠ¶æ€æ¢å¤ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section/&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;ç”± CheckpointedFunction æ¥å£å®šä¹‰ã€‚JobManager ä¼šå®šæœŸå‘èµ· Checkpointï¼ŒTask æ¥æ”¶åˆ° Checkpoint åè·å–åº”ç”¨ä¸­æ‰€æœ‰å®ç°äº† CheckpointedFunction çš„ Operator å¹¶è§¦å‘æ‰§è¡Œå¯¹åº”çš„ snapshotState æ–¹æ³•ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;JobManager æ¯å‘èµ·ä¸€è½® Checkpoint éƒ½ä¼šæºå¸¦ä¸€ä¸ªè‡ªå¢çš„ checkpointIdï¼Œè¿™ä¸ª checkpointId ä»£è¡¨äº†å¿«ç…§çš„è½®æ¬¡ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;output_wrapper&quot;&gt;&lt;pre&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;java&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;public&lt;/span&gt;Â &lt;span class=&quot;code-snippet__class&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;interface&lt;/span&gt;Â &lt;span class=&quot;code-snippet__title&quot;&gt;CheckpointedFunction&lt;/span&gt;Â &lt;/span&gt;{&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;Â Â &lt;span class=&quot;code-snippet__function&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;void&lt;/span&gt;Â &lt;span class=&quot;code-snippet__title&quot;&gt;snapshotState(FunctionSnapshotContextÂ context)&lt;/span&gt;Â &lt;span class=&quot;code-snippet__keyword&quot;&gt;throws&lt;/span&gt;Â Exception&lt;/span&gt;;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;Â Â &lt;span class=&quot;code-snippet__function&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;void&lt;/span&gt;Â &lt;span class=&quot;code-snippet__title&quot;&gt;initializeState(FunctionInitializationContextÂ context)&lt;/span&gt;Â &lt;span class=&quot;code-snippet__keyword&quot;&gt;throws&lt;/span&gt;Â Exception&lt;/span&gt;;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ç”± CheckpointListener æ¥å£å®šä¹‰ã€‚å½“åŸºäºåŒä¸€ä¸ªè½®æ¬¡(checkpointId ç›¸åŒ)çš„Checkpoint å¿«ç…§å…¨éƒ¨å¤„ç†æˆåŠŸåè·å–åº”ç”¨ä¸­æ‰€æœ‰å®ç°äº† CheckpointListener çš„ Operator å¹¶è§¦å‘æ‰§è¡Œ notifyCheckpointComplete æ–¹æ³•ã€‚è§¦å‘ notifyCheckpointComplete æ–¹æ³•æ—¶æºå¸¦çš„ checkpointId å‚æ•°ç”¨æ¥å‘Šè¯‰ Operator å“ªä¸€è½® Checkpoint å·²ç»å®Œæˆã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section class=&quot;output_wrapper&quot;&gt;&lt;pre&gt;&lt;section class=&quot;code-snippet__fix code-snippet__js&quot;&gt;&lt;pre class=&quot;code-snippet__js&quot; data-lang=&quot;java&quot;&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-snippet__class&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;code-snippet__title&quot;&gt;CheckpointListener&lt;/span&gt; &lt;/span&gt;{&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;  &lt;span class=&quot;code-snippet__function&quot;&gt;&lt;span class=&quot;code-snippet__keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;code-snippet__title&quot;&gt;notifyCheckpointComplete(&lt;span class=&quot;code-snippet__keyword&quot;&gt;long&lt;/span&gt; checkpointId)&lt;/span&gt; &lt;span class=&quot;code-snippet__keyword&quot;&gt;throws&lt;/span&gt; Exception&lt;/span&gt;;&lt;/span&gt;&lt;/code&gt;&lt;code&gt;&lt;span class=&quot;code-snippet_outer&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/pre&gt;&lt;/section&gt;&lt;section class=&quot;_135editor&quot; data-tools=&quot;135ç¼–è¾‘å™¨&quot; data-id=&quot;92984&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;section&gt;&lt;section class=&quot;horizontal-tb&quot;&gt;&lt;p&gt;&lt;strong&gt;3.Â Flink KafkaÂ ç«¯åˆ°ç«¯ Exactly-once&lt;/strong&gt;&lt;/p&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Kafka æ˜¯éå¸¸å—æ¬¢è¿çš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œåœ¨ Flink ä¸­å®ƒå¯ä»¥ä½œä¸º Sourceï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸º Sinkã€‚Kafka 0.11.0 åŠä»¥ä¸Šç‰ˆæœ¬æä¾›äº†å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œè¿™è®© Flink åº”ç”¨æ­è½½ Kafka å®ç°ç«¯åˆ°ç«¯çš„ exactly-once æˆä¸ºäº†å¯èƒ½ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥æ·±å…¥äº†è§£æä¾›äº†äº‹åŠ¡æ”¯æŒçš„ Kafka æ˜¯å¦‚ä½•ä¸ Flink ç»“åˆå®ç°ç«¯åˆ°ç«¯ exactly-once çš„ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æœ¬æ–‡å¿½ç•¥äº† Barrier æœºåˆ¶ï¼Œæ‰€ä»¥ç¤ºä¾‹å’Œå›¾ä¸­éƒ½ä»¥å•çº¿ç¨‹ä¸ºä¾‹ã€‚Barrier åœ¨ã€ŠFlink Checkpoint åŸç†ã€‹æœ‰è¾ƒå¤šè®¨è®ºã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;3.1Â Flink Kafka Consumer&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Kafka è‡ªèº«æä¾›äº†å¯é‡å¤æ¶ˆè´¹æ¶ˆæ¯çš„èƒ½åŠ›ï¼ŒFlink ç»“åˆ Kafka çš„è¿™ä¸ªç‰¹æ€§ä»¥åŠè‡ªèº« Checkpoint æœºåˆ¶ï¼Œå¾—ä»¥å®ç° Flink Kafka Consumer çš„å®¹é”™ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;Flink Kafka Consumer æ˜¯ Flink åº”ç”¨ä» Kafka è·å–æ•°æ®æµæ¶ˆæ¯çš„ä¸€ä¸ªå®ç°ã€‚é™¤äº†æ•°æ®æµè·å–ã€æ•°æ®å‘é€ä¸‹æ¸¸ç®—å­è¿™äº›åŸºæœ¬åŠŸèƒ½å¤–å®ƒè¿˜æä¾›äº†å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚è¿™äº›ç‰¹æ€§ä¾èµ–äº†å…¶å†…éƒ¨çš„ä¸€äº›ç»„ä»¶ä»¥åŠå†…ç½®çš„æ•°æ®ç»“æ„ååŒå¤„ç†å®Œæˆã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£è¿™äº›ç»„ä»¶å’Œå†…ç½®æ•°æ®ç»“æ„çš„èŒè´£ï¼Œå†ç»“åˆ &lt;strong&gt;Flink è¿è¡Œæ—¶&lt;/strong&gt;Â å’ŒÂ &lt;strong&gt;æ•…éšœæ¢å¤æ—¶&lt;/strong&gt;Â ä¸¤ä¸ªä¸åŒçš„å¤„ç†æ—¶æœºæ¥çœ‹ä¸€çœ‹å®ƒä»¬ä¹‹é—´æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä» Kafka æ¶ˆè´¹æ•°æ®çš„å‰ææ˜¯éœ€è¦çŸ¥é“æ¶ˆè´¹å“ªä¸ª topicï¼Œè¿™ä¸ª topic æœ‰å¤šå°‘ä¸ª partitionã€‚ç»„ä»¶ AbstractPartitionDiscoverer è´Ÿè´£è·å¾—æŒ‡å®š topic çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¹¶å°†è·å–åˆ°çš„ topic å…ƒæ•°æ®ä¿¡æ¯å°è£…æˆ KafkaTopicPartition é›†åˆã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;KafkaTopicPartition ç»“æ„ç”¨äºè®°å½• topic ä¸ partition çš„å¯¹åº”å…³ç³»ï¼Œå†…éƒ¨å®šä¹‰äº† String topic å’Œ int partition ä¸¤ä¸ªä¸»è¦å±æ€§ã€‚å‡è®¾ topic A æœ‰ 2 ä¸ªåˆ†åŒºï¼Œé€šè¿‡ç»„ä»¶ AbstractPartitionDiscoverer å¤„ç†åå°†å¾—åˆ°ç”±ä¸¤ä¸ª KafkaTopicPartition å¯¹è±¡ç»„æˆçš„é›†åˆï¼šKafkaTopicPartition(topic:A, partition:0) å’Œ KafkaTopicPartition(topic:A, partition:1)&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä½œä¸º Flink Sourceï¼ŒFlink Kafka Consumer æœ€ä¸»è¦çš„èŒè´£å°±æ˜¯èƒ½ä» Kafka ä¸­è·å–æ•°æ®ï¼Œäº¤ç»™ä¸‹æ¸¸å¤„ç†ã€‚åœ¨ Kafka Consumer ä¸­ AbstractFetcher ç»„ä»¶è´Ÿè´£å®Œæˆè¿™éƒ¨åˆ†åŠŸèƒ½ã€‚é™¤æ­¤ä¹‹å¤– Fetcher è¿˜è´Ÿè´£ offset çš„æäº¤ã€KafkaTopicPartitionState ç»“æ„çš„æ•°æ®ç»´æŠ¤ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;KafkaTopicPartitionState æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼ŒåŸºäºå†…éƒ¨çš„ 4 ä¸ªåŸºæœ¬å±æ€§ï¼ŒFlink Kafka Consumer ç»´æŠ¤äº† topicã€partitionã€å·²æ¶ˆè´¹ offsetã€å¾…æäº¤ offset çš„å…³è”å…³ç³»ã€‚Flink Kafka Consumer çš„å®¹é”™æœºåˆ¶ä¾èµ–äº†è¿™äº›æ•°æ®ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;é™¤äº†è¿™ 4 ä¸ªåŸºæœ¬å±æ€§å¤– KafkaTopicPartitionState è¿˜æœ‰ä¸¤ä¸ªå­ç±»ï¼Œä¸€ä¸ªæ˜¯æ”¯æŒ PunctuatedWatermark çš„å®ç°ï¼Œå¦ä¸€ä¸ªæ˜¯æ”¯æŒ PeriodicWatermark çš„å®ç°ï¼Œè¿™ä¸¤ä¸ªå­ç±»åœ¨åŸæœ‰åŸºç¡€ä¸Šæ‰©å±•äº†å¯¹æ°´å°çš„æ”¯æŒï¼Œæˆ‘ä»¬è¿™é‡Œä¸åšè¿‡å¤šè®¨è®ºã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.28833333333333333&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAicWqAYCqPZF4ibKlam5AOZDPHZuFlVWSD2CibxlzbjLqKBDVYwNcvgDPg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Flink Kafka Consumer çš„å®¹é”™æ€§ä¾é çš„æ˜¯çŠ¶æ€æŒä¹…åŒ–ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºçŠ¶æ€å¿«ç…§ã€‚å¯¹äºFlink Kafka Consumer æ¥è¯´ï¼Œè¿™ä¸ªçŠ¶æ€æŒä¹…åŒ–å…·ä½“æ˜¯å¯¹ topicã€partitionã€å·²æ¶ˆè´¹ offset çš„å¯¹åº”å…³ç³»åšæŒä¹…åŒ–ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;åœ¨å®ç°ä¸­ï¼Œä½¿ç”¨ ListState&amp;lt;Tuple2&amp;lt;KafkaTopicPartition, Long &amp;gt;&amp;gt; å®šä¹‰äº†çŠ¶æ€å­˜å‚¨ç»“æ„ï¼Œåœ¨è¿™é‡Œ Long è¡¨ç¤ºçš„æ˜¯ offset ç±»å‹ï¼Œæ‰€ä»¥å®é™…ä¸Šå°±æ˜¯ä½¿ç”¨ KafkaTopicPartition å’Œ offset ç»„æˆäº†ä¸€ä¸ªå¯¹å„¿ï¼Œå†æ·»åŠ åˆ°çŠ¶æ€åç«¯é›†åˆã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å½“çŠ¶æ€æˆåŠŸæŒä¹…åŒ–åï¼Œä¸€æ—¦åº”ç”¨å‡ºç°æ•…éšœï¼Œå°±å¯ä»¥ç”¨æœ€è¿‘æŒä¹…åŒ–æˆåŠŸçš„å¿«ç…§æ¢å¤åº”ç”¨çŠ¶æ€ã€‚åœ¨å®ç°ä¸­ï¼ŒçŠ¶æ€æ¢å¤æ—¶ä¼šå°†å¿«ç…§æ¢å¤åˆ°ä¸€ä¸ª TreeMap ç»“æ„ä¸­ï¼Œå…¶ä¸­ key æ˜¯ KafkaTopicPartitionï¼Œvalue æ˜¯å¯¹åº”å·²æ¶ˆè´¹çš„ offsetã€‚æ¢å¤æˆåŠŸåï¼Œåº”ç”¨æ¢å¤åˆ°æ•…éšœå‰ Flink Kafka Consumer æ¶ˆè´¹çš„ offsetï¼Œå¹¶ç»§ç»­æ‰§è¡Œä»»åŠ¡ï¼Œå°±å¥½åƒä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿä¸€æ ·ã€‚&lt;/span&gt;&lt;/section&gt;&lt;h5&gt;&lt;br/&gt;&lt;/h5&gt;&lt;h5&gt;&lt;strong&gt;&lt;span&gt;3.1.1Â è¿è¡Œæ—¶&lt;/span&gt;&lt;/strong&gt;&lt;/h5&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;æˆ‘ä»¬å‡è®¾ Flink åº”ç”¨æ­£å¸¸è¿è¡Œï¼ŒFlink Kafka Consumer æ¶ˆè´¹ topic ä¸º Topic-Aï¼ŒTopic-A åªæœ‰ä¸€ä¸ª partitionã€‚åœ¨è¿è¡ŒæœŸé—´ï¼Œä¸»è¦åšäº†è¿™ä¹ˆå‡ ä»¶äº‹:&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;KafkaFetcher ä¸æ–­çš„ä» Kafka æ¶ˆè´¹æ•°æ®ï¼Œæ¶ˆè´¹çš„æ•°æ®ä¼šå‘é€åˆ°ä¸‹æ¸¸ç®—å­å¹¶åœ¨å†…éƒ¨è®°å½•å·²æ¶ˆè´¹è¿‡çš„ offsetã€‚ä¸‹å›¾æè¿°çš„æ˜¯ Flink Kafka Consumer ä»æ¶ˆè´¹ Kafka æ¶ˆæ¯åˆ°å°†æ¶ˆæ¯å‘é€åˆ°ä¸‹æ¸¸ç®—å­çš„ä¸€ä¸ªå¤„ç†è¿‡ç¨‹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.24833333333333332&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAOHHhYBGENpPj1RMm5c9XKjtjpuI2PhH5iaItjHmpDuibqTINugr6NYAw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æ¥ä¸‹æ¥æˆ‘ä»¬å†ç»“åˆæ¶ˆæ¯çœŸæ­£å¼€å§‹å¤„ç†åï¼ŒKafkaTopicPartitionState ç»“æ„ä¸­çš„æ•°æ®å˜åŒ–ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.24833333333333332&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAYubKhF3g1EdzvoUiaq9X6fqzTpGfKk0TWaHjJoAOCSjFlZBAVlAqGsw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å¯ä»¥çœ‹åˆ°ï¼Œéšç€åº”ç”¨çš„è¿è¡Œï¼ŒKafkaTopicPartitionState ä¸­çš„ offset å±æ€§å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œå®ƒè®°å½•äº†å·²ç»å‘é€åˆ°ä¸‹æ¸¸ç®—å­æ¶ˆæ¯åœ¨ Kafka ä¸­çš„ offsetã€‚åœ¨è¿™é‡Œç”±äºæ¶ˆæ¯ P0-C å·²ç»å‘é€åˆ°ä¸‹æ¸¸ç®—å­ï¼Œæ‰€ä»¥ KafkaTopicPartitionState.offset å˜æ›´ä¸º 2ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å¦‚æœ Flink åº”ç”¨å¼€å¯äº† Checkpointï¼ŒJobManager ä¼šå®šæœŸè§¦å‘ Checkpointã€‚FlinkKafkaConsumer å®ç°äº† CheckpointedFunctionï¼Œæ‰€ä»¥å®ƒå…·å¤‡å¿«ç…§çŠ¶æ€(snapshotState)çš„èƒ½åŠ›ã€‚åœ¨å®ç°ä¸­ï¼ŒsnapshotState å…·ä½“å¹²äº†è¿™ä¹ˆä¸¤ä»¶äº‹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¸‹å›¾æè¿°å½“ä¸€è½® Checkpoint å¼€å§‹æ—¶ FlinkKafkaConsumer çš„å¤„ç†è¿‡ç¨‹ã€‚åœ¨ä¾‹å­ä¸­ï¼ŒFlinkKafkaConsumer å·²ç»å°† offset=3 çš„ P0-D æ¶ˆæ¯å‘é€åˆ°ä¸‹æ¸¸ï¼Œå½“checkpoint è§¦å‘æ—¶å°† topic=Topic-Aï¼›partition=0ï¼›offset=3 ä½œä¸ºæœ€åçš„çŠ¶æ€æŒä¹…åŒ–åˆ°å¤–éƒ¨å­˜å‚¨ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;ol class=&quot; list-paddingleft-2&quot;/&gt;&lt;ul class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å°†å½“å‰å¿«ç…§è½®æ¬¡(CheckpointId)ä¸ topicã€partitionã€offset å†™å…¥åˆ°ä¸€ä¸ªå¾…æäº¤ offset çš„ Map é›†åˆï¼Œå…¶ä¸­ key æ˜¯ CheckpointIdã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å°† FlinkKafkaConsumer å½“å‰è¿è¡ŒçŠ¶æ€æŒä¹…åŒ–ï¼Œå³å°† topicã€partitionã€offset æŒä¹…åŒ–ã€‚ä¸€æ—¦å‡ºç°æ•…éšœï¼Œå°±å¯ä»¥æ ¹æ®æœ€æ–°æŒä¹…åŒ–çš„å¿«ç…§è¿›è¡Œæ¢å¤ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¸‹å›¾æè¿°å½“ä¸€è½® Checkpoint å¼€å§‹æ—¶ FlinkKafkaConsumer çš„å¤„ç†è¿‡ç¨‹ã€‚åœ¨ä¾‹å­ä¸­ï¼ŒFlinkKafkaConsumer å·²ç»å°† offset=3 çš„ P0-D æ¶ˆæ¯å‘é€åˆ°ä¸‹æ¸¸ï¼Œå½“ checkpoint è§¦å‘æ—¶å°† topic=Topic-Aï¼›partition=0ï¼›offset=3 ä½œä¸ºæœ€åçš„çŠ¶æ€æŒä¹…åŒ–åˆ°å¤–éƒ¨å­˜å‚¨ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.4008333333333333&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAV1tDaXdMiaMibZm4jQfbRyW8hGROIzeFJyPWJ2RVSDfibibuZicCGLIoIzw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å½“æ‰€æœ‰ç®—å­åŸºäºåŒä¸€è½®æ¬¡å¿«ç…§å¤„ç†ç»“æŸåï¼Œä¼šè°ƒç”¨ CheckpointListener.notifyCheckpointComplete(checkpointId) é€šçŸ¥ç®—å­ Checkpoint å®Œæˆï¼Œå‚æ•° checkpointId æŒ‡æ˜äº†æœ¬æ¬¡é€šçŸ¥æ˜¯åŸºäºå“ªä¸€è½® Checkpointã€‚åœ¨ FlinkKafkaConsumer çš„å®ç°ä¸­ï¼Œæ¥åˆ° Checkpoint å®Œæˆé€šçŸ¥åä¼šå˜æ›´ KafkaTopicPartitionState.commitedOffset å±æ€§å€¼ã€‚æœ€åå†å°†å˜æ›´åçš„ commitedOffset æäº¤åˆ° Kafka brokers æˆ– Zookeeperã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒcommitedOffset å˜æ›´ä¸º 4ï¼Œå› ä¸ºåœ¨å¿«ç…§é˜¶æ®µï¼Œå°† topic=Topic-A;partition=0;offset=3 çš„çŠ¶æ€åšäº†å¿«ç…§ï¼Œåœ¨çœŸæ­£æäº¤ offset æ—¶æ˜¯å°†å¿«ç…§çš„ offset + 1 ä½œä¸ºç»“æœæäº¤çš„ã€‚ã€Œæºä»£ç  KafkaFetcher.java 207 è¡Œ doCommitInternalOffsetsToKafka æ–¹æ³•ã€ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.37416666666666665&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAw7h911TeG7FXLA79lb3FicYIliaez3a5Tziad4TwWBmGbp4LLibuCSzEdA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;h5&gt;&lt;br/&gt;&lt;/h5&gt;&lt;h5&gt;&lt;strong&gt;&lt;span&gt;3.1.2Â æ•…éšœæ¢å¤&lt;/span&gt;&lt;/strong&gt;&lt;/h5&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;Flink åº”ç”¨å´©æºƒåï¼Œå¼€å§‹è¿›å…¥æ¢å¤æ¨¡å¼ã€‚å‡è®¾ Flink Kafka Consumer æœ€åä¸€æ¬¡æˆåŠŸçš„å¿«ç…§çŠ¶æ€æ˜¯ topic=Topic-Aï¼›partition=0ï¼›offset=3ï¼Œåœ¨æ¢å¤æœŸé—´æŒ‰ç…§ä¸‹é¢çš„å…ˆåé¡ºåºæ‰§è¡Œå¤„ç†ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;çŠ¶æ€åˆå§‹åŒ–é˜¶æ®µå°è¯•ä»çŠ¶æ€åç«¯åŠ è½½å‡ºå¯ä»¥ç”¨æ¥æ¢å¤çš„çŠ¶æ€ã€‚å®ƒç”± CheckpointedFunction.initializeState æ¥å£å®šä¹‰ã€‚åœ¨ FlinkKafkaConsumer çš„å®ç°ä¸­ï¼Œä»çŠ¶æ€åç«¯è·å¾—å¿«ç…§å¹¶å†™å…¥åˆ°å†…éƒ¨å­˜å‚¨ç»“æ„ TreeMapï¼Œå…¶ä¸­ key æ˜¯ç”± KafkaTopicPartition è¡¨ç¤ºçš„ topic ä¸ partitionï¼Œvalue ä¸º offsetã€‚ä¸‹å›¾æè¿°çš„æ˜¯æ•…éšœæ¢å¤çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œä»çŠ¶æ€åç«¯è·å¾—å¿«ç…§ï¼Œå¹¶æ¢å¤åˆ°å†…éƒ¨å­˜å‚¨ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.2318668252080856&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAv37VaVXibnuYuSpicRrEKmTWGpVtRwqxmAicIIIRicx96mxtlwNHJSmeqg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;841&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;function åˆå§‹åŒ–é˜¶æ®µé™¤äº†åˆå§‹åŒ– OffsetCommitMode å’Œ partitionDiscoverer å¤–ï¼Œè¿˜ä¼šåˆå§‹åŒ–ä¸€ä¸ª Map ç»“æ„ï¼Œè¯¥ç»“æ„ç”¨æ¥å­˜å‚¨åº”ç”¨å¾…æ¶ˆè´¹ä¿¡æ¯ã€‚å¦‚æœåº”ç”¨éœ€è¦ä»å¿«ç…§æ¢å¤çŠ¶æ€ï¼Œåˆ™ä»å¾…æ¢å¤çŠ¶æ€ä¸­åˆå§‹åŒ–è¿™ä¸ª Map ç»“æ„ã€‚ä¸‹å›¾æ˜¯è¯¥é˜¶æ®µä»å¿«ç…§æ¢å¤çš„å¤„ç†è¿‡ç¨‹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.43844856661045534&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXA2ypBdCN5194icJ0WcLc0D6LaaSxaDnibWqB1PCHKQtDpibCcYOaecJibRw/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;593&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;function åˆå§‹åŒ–é˜¶æ®µå…¼å®¹äº†æ­£å¸¸å¯åŠ¨å’ŒçŠ¶æ€æ¢å¤æ—¶ offset çš„åˆå§‹åŒ–ã€‚å¯¹äºæ­£å¸¸å¯åŠ¨è¿‡ç¨‹ï¼ŒStartupMode çš„è®¾ç½®å†³å®šå¾…æ¶ˆè´¹ä¿¡æ¯ä¸­çš„ç»“æœã€‚è¯¥æ¨¡å¼å…±æœ‰ 5 ç§ï¼Œé»˜è®¤ä¸º StartupMode.GROUP_OFFSETSã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.37583333333333335&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXABicLJt1pZCiak7HWFIatVPbGB2rql9OfnSF4VROBn4PasXsrzvKESPAQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section/&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;åœ¨è¯¥é˜¶æ®µä¸­ï¼Œå°† KafkaFetcher åˆå§‹åŒ–ã€åˆå§‹åŒ–å†…éƒ¨æ¶ˆè´¹çŠ¶æ€ã€å¯åŠ¨æ¶ˆè´¹çº¿ç¨‹ç­‰ç­‰ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†å°† FlinkKafkaConsumer è¿è¡Œèµ·æ¥ï¼Œä¸‹å›¾æè¿°äº†è¿™ä¸ªé˜¶æ®µçš„å¤„ç†æµç¨‹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.3441666666666667&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXApzCNRvW9333ugHKI5qcaV0icAbmibibpsvO7QjRPr3gKia2JDaeQLwT0GA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;è¿™é‡Œå¯¹å›¾ä¸­ä¸¤ä¸ªæ­¥éª¤åšä¸ªæè¿°ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;æ­¥éª¤ 3ï¼Œä½¿ç”¨çŠ¶æ€åç«¯çš„å¿«ç…§ç»“æœ topic=Topic-Aï¼›partition=0ï¼›offset=3 åˆå§‹åŒ– Flink Kafka Consumer å†…éƒ¨ç»´æŠ¤çš„ Kafka å¤„ç†çŠ¶æ€ã€‚å› ä¸ºæ˜¯æ¢å¤æµç¨‹ï¼Œæ‰€ä»¥è¿™ä¸ªå†…éƒ¨ç»´æŠ¤çš„å¤„ç†çŠ¶æ€ä¹Ÿåº”è¯¥éšç€å¿«ç…§æ¢å¤ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;æ­¥éª¤ 4ï¼Œåœ¨çœŸæ­£æ¶ˆè´¹ Kafka æ•°æ®å‰(æŒ‡è°ƒç”¨ KafkaConsumer.poll æ–¹æ³•)ï¼Œä½¿ç”¨Kafka æä¾›çš„ seek æ–¹æ³•å°† offset é‡ç½®åˆ°æŒ‡å®šä½ç½®ï¼Œè€Œè¿™ä¸ª offset å…·ä½“ç®—æ³•å°±æ˜¯çŠ¶æ€åç«¯ offset + 1ã€‚åœ¨ä¾‹å­ä¸­ï¼Œæ¶ˆè´¹ Kafka æ•°æ®å‰å°† offset é‡ç½®ä¸º 4ï¼Œæ‰€ä»¥çŠ¶æ€æ¢å¤å KafkaConsumer æ˜¯ä» offset=4 ä½ç½®å¼€å§‹æ¶ˆè´¹ã€‚ã€Œæºä»£ç  KafkaConsumerThread.java 428 è¡Œã€&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;3.1.3Â æ€»ç»“&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¸Šè¿°çš„ 3 ä¸ªæ­¥éª¤æ˜¯æ¢å¤æœŸé—´ä¸»è¦çš„å¤„ç†æµç¨‹ï¼Œä¸€æ—¦æ¢å¤é€»è¾‘æ‰§è¡ŒæˆåŠŸï¼Œåç»­å¤„ç†æµç¨‹ä¸æ­£å¸¸è¿è¡ŒæœŸé—´ä¸€è‡´ã€‚æœ€åå¯¹ FlinkKafkaConsumer ç”¨ä¸€å¥è¯åšä¸ªæ€»ç»“ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ã€Œå°† offset æäº¤æƒäº¤ç»™ FlinkKafkaConsumerï¼Œå…¶å†…éƒ¨ç»´æŠ¤ Kafka æ¶ˆè´¹åŠæäº¤çš„çŠ¶æ€ã€‚åŸºäº Kafka å¯é‡å¤æ¶ˆè´¹èƒ½åŠ›å¹¶é…åˆ Checkpoint æœºåˆ¶å’ŒçŠ¶æ€åç«¯å­˜å‚¨èƒ½åŠ›ï¼Œå°±èƒ½å®ç° FlinkKafkaConsumer å®¹é”™æ€§ï¼Œå³ Source ç«¯çš„ Exactly-once è¯­ä¹‰ã€ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;3.2Â Flink Kafka Producer&lt;/span&gt;&lt;/strong&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Flink Kafka Producer æ˜¯ Flink åº”ç”¨å‘ Kafka å†™å‡ºæ•°æ®çš„ä¸€ä¸ªå®ç°ã€‚åœ¨ Kafka 0.11.0 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­æä¾›äº†äº‹åŠ¡æ”¯æŒï¼Œè¿™è®© Flink æ­è½½ Kafka çš„äº‹åŠ¡ç‰¹æ€§å¯ä»¥è½»æ¾å®ç° Sink ç«¯çš„ Exactly-once è¯­ä¹‰ã€‚å…³äº Kafka äº‹åŠ¡ç‰¹æ€§åœ¨ã€ŠKafka å¹‚ç­‰ä¸äº‹åŠ¡ã€‹ä¸­åšäº†è¯¦ç»†è®¨è®ºã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;åœ¨ Flink Kafka Producer ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„ä»¶ FlinkKafkaInternalProducerï¼Œè¿™ä¸ªç»„ä»¶ä»£ç†äº† Kafka å®¢æˆ·ç«¯ org.apache.kafka.clients.producer.KafkaProducerï¼Œå®ƒä¸º Flink Kafka Producer æ“ä½œ Kafka æä¾›äº†å¼ºæœ‰åŠ›çš„æ”¯æ’‘ã€‚åœ¨è¿™ä¸ªç»„ä»¶å†…éƒ¨ï¼Œé™¤äº†ä»£ç†æ–¹æ³•å¤–ï¼Œè¿˜æä¾›äº†ä¸€äº›å…³é”®æ“ä½œã€‚ä¸ªäººè®¤ä¸ºï¼ŒFlink Kafka Sink èƒ½å¤Ÿå®ç° Exactly-once è¯­ä¹‰é™¤äº†éœ€è¦ Kafka æ”¯æŒäº‹åŠ¡ç‰¹æ€§å¤–ï¼ŒåŒæ—¶ä¹Ÿç¦»ä¸å¼€&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;FlinkKafkaInternalProducer ç»„ä»¶æä¾›çš„æ”¯æŒï¼Œå°¤å…¶æ˜¯ä¸‹é¢è¿™äº›å…³é”®æ“ä½œï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;äº‹åŠ¡é‡ç½® FlinkKafkaInternalProducer ç»„ä»¶ä¸­æœ€å…³é”®çš„å¤„ç†å½“å±äº‹åŠ¡é‡ç½®ï¼Œäº‹åŠ¡é‡ç½®ç”± resumeTransaction æ–¹æ³•å®ç°ã€Œæºä»£ç  FlinkKafkaInternalProducer.java 144 è¡Œã€ã€‚ç”±äº Kafka å®¢æˆ·ç«¯æœªæš´éœ²é’ˆå¯¹äº‹åŠ¡æ“ä½œçš„ APIï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œå¤§é‡çš„ä½¿ç”¨äº†åå°„ã€‚æ–¹æ³•ä¸­ä½¿ç”¨åå°„è·å¾— KafkaProducer ä¾èµ–çš„ transactionManager å¯¹è±¡ï¼Œå¹¶å°†çŠ¶æ€åç«¯å¿«ç…§çš„å±æ€§å€¼æ¢å¤åˆ° transactionManager å¯¹è±¡ä¸­ï¼Œè¿™æ ·ä»¥è¾¾åˆ°è®© Flink Kafka Producer åº”ç”¨æ¢å¤åˆ°é‡å¯å‰çš„çŠ¶æ€ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¸‹é¢æˆ‘ä»¬ç»“åˆ &lt;strong&gt;Flink è¿è¡Œæ—¶&lt;/strong&gt;Â å’ŒÂ &lt;strong&gt;æ•…éšœæ¢å¤&lt;/strong&gt;Â ä¸¤ä¸ªä¸åŒçš„å¤„ç†æ—¶æœºæ¥äº†è§£ Flink Kafka Producer å†…éƒ¨å¦‚ä½•å·¥ä½œã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;3.2.1Â è¿è¡Œæ—¶&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;æˆ‘ä»¬å‡è®¾ Flink åº”ç”¨æ­£å¸¸è¿è¡Œï¼ŒFlink Kafka Producer æ­£å¸¸æ¥æ”¶ä¸Šæ¸¸æ•°æ®å¹¶å†™åˆ° Topic-B çš„ Topic ä¸­ï¼ŒTopic-B åªæœ‰ä¸€ä¸ª partitionã€‚åœ¨è¿è¡ŒæœŸé—´ï¼Œä¸»è¦åšä»¥ä¸‹å‡ ä»¶äº‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¸Šæ¸¸ç®—å­ä¸æ–­çš„å°†æ•°æ® Sink åˆ° FlinkKafkaProducerï¼ŒFlinkKafkaProducer æ¥åˆ°æ•°æ®åå°è£… ProducerRecord å¯¹è±¡å¹¶è°ƒç”¨ Kafka å®¢æˆ·ç«¯ KafkaProducer.send æ–¹æ³•å°† ProducerRecord å¯¹è±¡å†™å…¥ç¼“å†²ã€Œæºä»£ç  FlinkKafkaProducer.java 616 è¡Œã€ã€‚ä¸‹å›¾æ˜¯è¯¥é˜¶æ®µçš„æè¿°ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.25690276110444177&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAFSOUNXibCibWNafFTCjagNkvcz20tr8B9Yx91xkicQG3Ohongn125SWoQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;833&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;Flink 1.7 åŠä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨ FlinkKafkaProducer ä½œä¸º Kafka Sinkï¼Œå®ƒç»§æ‰¿æŠ½è±¡ç±» TwoPhaseCommitSinkFunctionï¼Œæ ¹æ®åå­—å°±èƒ½çŸ¥é“ï¼Œè¿™ä¸ªæŠ½è±¡ç±»ä¸»è¦å®ç°ä¸¤é˜¶æ®µæäº¤ã€‚ä¸ºäº†é›†æˆ Flink Checkpoint æœºåˆ¶ï¼ŒæŠ½è±¡ç±»å®ç°äº† CheckpointedFunction å’Œ CheckpointListenerï¼Œå› æ­¤å®ƒå…·å¤‡å¿«ç…§çŠ¶æ€(snapshotState)èƒ½åŠ›ã€‚çŠ¶æ€å¿«ç…§å¤„ç†å…·ä½“åšäº†ä¸‹é¢ä¸‰ä»¶äº‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;ul class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;è°ƒç”¨ KafkaProducer å®¢æˆ·ç«¯ flush æ–¹æ³•ï¼Œå°†ç¼“å†²åŒºå†…å…¨éƒ¨è®°å½•å‘é€åˆ° Kafkaï¼Œä½†ä¸æäº¤ã€‚è¿™äº›è®°å½•å†™å…¥åˆ° Topic-Bï¼Œæ­¤æ—¶è¿™äº›æ•°æ®çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º UNCOMMITTEDï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæœ‰ä¸ªæœåŠ¡æ¶ˆè´¹ Topic-Bï¼Œå¹¶ä¸”è®¾ç½®çš„ isolation.level=read_committedï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªæ¶ˆè´¹ç«¯è¿˜æ— æ³• poll åˆ° flush çš„æ•°æ®ï¼Œå› ä¸ºè¿™äº›æ•°æ®å°šæœª commitã€‚ä»€ä¹ˆæ—¶å€™ commit å‘¢ï¼Ÿåœ¨å¿«ç…§ç»“æŸå¤„ç†é˜¶æ®µè¿›è¡Œ commitï¼Œåé¢ä¼šæåˆ°ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;å°†å¿«ç…§è½®æ¬¡ä¸å½“å‰äº‹åŠ¡è®°å½•åˆ°ä¸€ä¸ª Map è¡¨ç¤ºçš„å¾…æäº¤äº‹åŠ¡é›†åˆä¸­ï¼Œkey æ˜¯å½“å‰å¿«ç…§è½®æ¬¡çš„ CheckpointIdï¼Œvalue æ˜¯ç”± TransactionHolder è¡¨ç¤ºçš„äº‹åŠ¡å¯¹è±¡ã€‚TransactionHolder å¯¹è±¡å†…éƒ¨è®°å½•äº† transactionalIdã€producerIdã€epoch ä»¥åŠ Kafka å®¢æˆ·ç«¯ kafkaProducer çš„å¼•ç”¨ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;æŒä¹…åŒ–å½“å‰äº‹åŠ¡å¤„ç†çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯å°†å½“å‰å¤„ç†çš„äº‹åŠ¡è¯¦æƒ…å­˜å…¥çŠ¶æ€åç«¯ï¼Œä¾›åº”ç”¨æ¢å¤æ—¶ä½¿ç”¨ã€‚&lt;/span&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ä¸‹å›¾æ˜¯çŠ¶æ€å¿«ç…§å¤„ç†é˜¶æ®µå¤„ç†è¿‡ç¨‹ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.44333333333333336&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXADoFbfAcbXeESNrfB1IXicYHxeUTFibBt0gYS6hWxgwqs1fTDvgwH2RHg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;TwoPhaseCommitSinkFunction å®ç°äº† CheckpointListenerï¼Œåº”ç”¨ä¸­æ‰€æœ‰ç®—å­çš„å¿«ç…§å¤„ç†æˆåŠŸåä¼šæ”¶åˆ°åŸºäºæŸè½® Checkpoint å®Œæˆçš„é€šçŸ¥ã€‚å½“ FlinkKafkaProducer æ”¶åˆ°é€šçŸ¥åï¼Œä¸»è¦ä»»åŠ¡å°±æ˜¯æäº¤ä¸Šä¸€é˜¶æ®µäº§ç”Ÿçš„äº‹åŠ¡ï¼Œè€Œå…·ä½“è¦æäº¤å“ªäº›äº‹åŠ¡æ˜¯ä»ä¸Šä¸€é˜¶æ®µç”Ÿæˆçš„å¾…æäº¤äº‹åŠ¡é›†åˆä¸­è·å–çš„ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.31583333333333335&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAiacQ2ufdS360EdyMbDkRyxLftUMvIY6kDdq3F3zvbDCOBoeV7Dn8qgA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å›¾ä¸­ç¬¬ 4 æ­¥æ‰§è¡ŒæˆåŠŸåï¼Œflush åˆ° Kafka çš„æ•°æ®ä» UNCOMMITTED å˜æ›´ä¸º COMMITTEDï¼Œè¿™æ„å‘³ç€æ­¤æ—¶æ¶ˆè´¹ç«¯å¯ä»¥ poll åˆ°è¿™æ‰¹æ•°æ®äº†ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;2PC(ä¸¤é˜¶æ®µæäº¤)ç†è®ºçš„ä¸¤ä¸ªé˜¶æ®µåˆ†åˆ«å¯¹åº”äº† FlinkKafkaProducer çš„çŠ¶æ€å¿«ç…§å¤„ç†é˜¶æ®µå’Œå¿«ç…§ç»“æŸå¤„ç†é˜¶æ®µï¼Œå‰è€…æ˜¯é€šè¿‡ Kafka çš„äº‹åŠ¡åˆå§‹åŒ–ã€äº‹åŠ¡å¼€å¯ã€flush ç­‰æ“ä½œé¢„æäº¤äº‹åŠ¡ï¼Œåè€…æ˜¯é€šè¿‡ Kafka çš„ commit æ“ä½œçœŸæ­£æ‰§è¡Œäº‹åŠ¡æäº¤ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;h5&gt;&lt;strong&gt;&lt;span&gt;3.2.2 æ•…éšœæ¢å¤&lt;/span&gt;&lt;/strong&gt;&lt;/h5&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;Flink åº”ç”¨å´©æºƒåï¼ŒFlinkKafkaProducer å¼€å§‹è¿›å…¥æ¢å¤æ¨¡å¼ã€‚ä¸‹å›¾ä¸ºåº”ç”¨å´©æºƒå‰çš„çŠ¶æ€æè¿°ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.4525&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAEyQyOchnibxiawUSdMw6SjV1Tj1SDIpM2MicqWxiahBnZwmSjFwQQQTnvQ/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1200&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;åœ¨æ¢å¤æœŸé—´ä¸»è¦çš„å¤„ç†åœ¨çŠ¶æ€åˆå§‹åŒ–é˜¶æ®µã€‚å½“ Flink ä»»åŠ¡é‡å¯æ—¶ä¼šè§¦å‘çŠ¶æ€åˆå§‹åŒ–ï¼Œæ­¤æ—¶åº”ç”¨ä¸ Kafka å·²ç»æ–­å¼€äº†è¿æ¥ã€‚ä½†åœ¨è¿è¡ŒæœŸé—´å¯èƒ½å­˜åœ¨æ•°æ® flush å°šæœªæäº¤çš„æƒ…å†µã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;å¦‚æœæƒ³é‡æ–°æäº¤è¿™äº›æ•°æ®éœ€è¦ä»çŠ¶æ€åç«¯æ¢å¤å½“æ—¶ KafkaProducer æŒæœ‰çš„äº‹åŠ¡å¯¹è±¡ï¼Œå…·ä½“ä¸€ç‚¹å°±æ˜¯æ¢å¤å½“æ—¶äº‹åŠ¡çš„ transactionalIdã€producerIdã€epochã€‚è¿™ä¸ªæ—¶å€™å°±ç”¨åˆ°äº† FlinkKafkaInternalProducer ç»„ä»¶ä¸­çš„äº‹åŠ¡é‡ç½®ï¼Œåœ¨çŠ¶æ€åˆå§‹åŒ–æ—¶ä»çŠ¶æ€åç«¯è·å¾—è¿™äº›äº‹åŠ¡ä¿¡æ¯ï¼Œå¹¶é‡ç½®åˆ°å½“å‰ KafkaProducer ä¸­ï¼Œå†æ‰§è¡Œ commit æ“ä½œã€‚è¿™æ ·å°±å¯ä»¥æ¢å¤ä»»åŠ¡é‡å¯å‰çš„çŠ¶æ€ï¼ŒTopic-B çš„æ¶ˆè´¹ç«¯ä¾ç„¶å¯ä»¥ poll åˆ°åº”ç”¨æ¢å¤åæäº¤çš„æ•°æ®ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœè¿™ä¸ªé‡ç½®å¹¶æäº¤çš„åŠ¨ä½œå¤±è´¥äº†ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚ä¸‹å›¾æè¿°çš„æ˜¯çŠ¶æ€åˆå§‹åŒ–é˜¶æ®µçš„å¤„ç†æµç¨‹ï¼š&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;img class=&quot;&quot; data-ratio=&quot;0.32713347921225383&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8biaFoWLFLS3ic1JlYyUpibRk5eCqknsVXAx78dJg85GImUCQTfSyMFrAS0tIwMQwAdnAHIzRDTXWOvib5QL0ZWh9g/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;914&quot;/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;strong&gt;&lt;span&gt;3.2.3 æ€»ç»“&lt;/span&gt;&lt;/strong&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;FlinkKafkaProducer æ•…éšœæ¢å¤æœŸé—´ï¼ŒçŠ¶æ€åˆå§‹åŒ–æ˜¯æ¯”è¾ƒé‡è¦çš„å¤„ç†é˜¶æ®µã€‚è¿™ä¸ªé˜¶æ®µåœ¨ Kafka äº‹åŠ¡ç‰¹æ€§çš„å¼ºæœ‰åŠ›æ”¯æ’‘ä¸‹ï¼Œå®ç°äº†äº‹åŠ¡çŠ¶æ€çš„æ¢å¤ï¼Œå¹¶ä¸”ä½¿å¾—çŠ¶æ€å­˜å‚¨å ç”¨ç©ºé—´æœ€å°ã€‚ä¾èµ– Flink æä¾›çš„ TwoPhaseCommitSinkFunction å®ç°ç±»ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥å¯¹ Sink åšæ›´å¤šçš„æ‰©å±•ã€‚&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;# ç›´å‡» Flink Forward Europe #&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;æŸæ—æ—¶é—´ 10 æœˆ 8 æ—¥ï¼ŒFlink Forward æ¬§æ´²ç«™ç››å¤§å¼€å¯ï¼ŒFlink China ç¤¾åŒºç‰¹é‚€ Apache Flink PMC æ¨å…‹ç‰¹ï¼ˆé²å°¼ï¼‰ä¸ Apache Kafka PMC ç§¦æ±Ÿæ°ï¼ˆBecketï¼‰å¸¦ä½ ç›´å‡» Flink Forward æŸæ—ç«™æœ€æ–°æ¶ˆæ¯ï¼Œä»–ä»¬å°†ï¼š&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;ul class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;ç¬¬ä¸€æ—¶é—´è·Ÿä½ åˆ†äº«å¤§ä¼šç²¾å½©å†…å®¹&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å¸®ä½ æ€»ç»“å¤§ä¼šç‹¬å®¶å¹²è´§&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span&gt;å¸¦ä½ ä¸€èµ·æ„Ÿå— Flink å‘æºåœ°çš„å¼€å‘è€…æ°›å›´&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;section/&gt;&lt;section/&gt;&lt;section/&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;é”å®šä»Šæ™š 19:00-20:00 ï¼Œæ¬å¥½å°æ¿å‡³ï¼Œé’‰é’‰æ‰«ç åŠ ç¾¤ï¼Œ&lt;span&gt;å‰æ’çœ‹ç›´&lt;/span&gt;&lt;span&gt;æ’­ï¼&lt;/span&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;&lt;br/&gt;&lt;/span&gt;&lt;/section&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;1.3193548387096774&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu48oSP5m5GR0zZWlCvNR8Or4PBEV6LGUWmQicDnSPQMQJibXDIicVVEalrTQrxMCKUMdjuC7XjVibFVPA/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;620&quot;/&gt;&lt;/p&gt;&lt;section&gt;&lt;span/&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;hr/&gt;&lt;p&gt;&lt;/p&gt;&lt;section powered-by=&quot;xiumi.us&quot;&gt;&lt;section&gt;&lt;section&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;â–¼ Flink ç¤¾åŒºæ¨èÂ &lt;span&gt;â–¼Â &lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span/&gt;&lt;br/&gt;&lt;/section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Apache Flink åŠå¤§æ•°æ®é¢†åŸŸç››ä¼šÂ &lt;span&gt;Flink Forward Asia 2019Â &lt;/span&gt;å°†äºÂ 11æœˆ28-30æ—¥åœ¨åŒ—äº¬å›½å®¶ä¼šè®®ä¸­å¿ƒä¸¾åŠï¼Œ&lt;strong&gt;å¤§ä¼šè®®ç¨‹å·²ä¸Šçº¿ï¼Œå¤åˆ¶ä¸‹æ–¹&lt;/strong&gt;&lt;strong&gt;&lt;span&gt;é“¾æ¥&lt;/span&gt;&lt;/strong&gt;&lt;strong&gt;è‡³æµè§ˆå™¨&lt;/strong&gt;å¯äº†è§£å¤§ä¼šè®®ç¨‹è¯¦æƒ…ã€‚&lt;br/&gt;&lt;/span&gt;&lt;br/&gt;&lt;strong&gt;&lt;span&gt;å¤§ä¼šè®®ç¨‹ï¼š&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;https://developer.aliyun.com/special/ffa2019-conference&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;section&gt;&lt;span&gt;â–¼Â &lt;/span&gt;&lt;span&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&amp;amp;mid=2247484366&amp;amp;idx=1&amp;amp;sn=b0ef7cb8b88f7643547e1226873d3b9d&amp;amp;chksm=fd3b8d8cca4c049a615e01d39a52057359e2de413edfcd9bb5babb99eff32acee72309099e84&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;ä¸å®¹é”™è¿‡ï¼&lt;/a&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&amp;amp;mid=2247484366&amp;amp;idx=1&amp;amp;sn=b0ef7cb8b88f7643547e1226873d3b9d&amp;amp;chksm=fd3b8d8cca4c049a615e01d39a52057359e2de413edfcd9bb5babb99eff32acee72309099e84&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;å²ä¸Šè¶…å¼ºé˜µå®¹ï¼ŒFlink Forward AsiaÂ &lt;span&gt;2019&lt;/span&gt;Â ä½ æŠ¥åäº†å—ï¼Ÿ&lt;/a&gt;&lt;/span&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;â–¼Â &lt;/span&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&amp;amp;mid=2247484585&amp;amp;idx=1&amp;amp;sn=8e844d2eaa8ff8ca5d08121c2f98a506&amp;amp;chksm=fd3b8aebca4c03fd9b6eb87f5466ff847a5b22efbe209afd7fa8ac430536cf0a65107468d451&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;&lt;span&gt;å¼€æºã€å¼€æ”¾ï¼å¤§æ•°æ®é¢†åŸŸé¡¶çº§ç››ä¼šè®®é¢˜å¾é›† ing ï¼&lt;/span&gt;&lt;/a&gt;&lt;/section&gt;&lt;section&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&amp;amp;mid=2247484585&amp;amp;idx=1&amp;amp;sn=8e844d2eaa8ff8ca5d08121c2f98a506&amp;amp;chksm=fd3b8aebca4c03fd9b6eb87f5466ff847a5b22efbe209afd7fa8ac430536cf0a65107468d451&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;&lt;span&gt;â–¼Â &lt;/span&gt;&lt;/a&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&amp;amp;mid=2247484459&amp;amp;idx=1&amp;amp;sn=f7bbedda08e1a2edba1f5d8a5eb1efdf&amp;amp;chksm=fd3b8a69ca4c037f2f2c1f74fae931f3d134ea3c98883c46a07d9df25244f8f1054f5e8bc05d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;&lt;span&gt;ç»å…¸å›é¡¾ï¼&lt;/span&gt;&lt;/a&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&amp;amp;mid=2247484459&amp;amp;idx=1&amp;amp;sn=f7bbedda08e1a2edba1f5d8a5eb1efdf&amp;amp;chksm=fd3b8a69ca4c037f2f2c1f74fae931f3d134ea3c98883c46a07d9df25244f8f1054f5e8bc05d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot; hasload=&quot;1&quot;&gt;&lt;span&gt;FlinkForward China 2018 å…¨åœº PPT å¤§åˆé›†&lt;/span&gt;&lt;/a&gt;&lt;/section&gt;&lt;section&gt;&lt;br/&gt;&lt;/section&gt;&lt;section&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&amp;amp;mid=2247484366&amp;amp;idx=1&amp;amp;sn=b0ef7cb8b88f7643547e1226873d3b9d&amp;amp;chksm=fd3b8d8cca4c049a615e01d39a52057359e2de413edfcd9bb5babb99eff32acee72309099e84&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;1&quot; hasload=&quot;1&quot;&gt;&lt;span class=&quot;js_jump_icon h5_image_link&quot; data-positionback=&quot;static&quot;&gt;&lt;img class=&quot;rich_pages &quot; data-ratio=&quot;0.425&quot; data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6VV9aykcW992MyapNQKf9PCONfAPI0BpN8ARPOSCqfcZDMHhOwWPrDL0yX7KGIM2SP6o0zWicYO1Q/640?wx_fmt=jpeg&quot;/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/section&gt;&lt;/section&gt;&lt;/section&gt;&lt;section&gt;&lt;span&gt;ï¼ˆ&lt;strong&gt;ç‚¹å‡»å›¾ç‰‡å¯æŸ¥çœ‹ Flink Forward Asia 2019 è¯¦æƒ…&lt;/strong&gt;ï¼‰&lt;/span&gt;&lt;/section&gt;&lt;section/&gt;&lt;section&gt;&lt;span&gt;ä½ ä¹Ÿã€Œ&lt;/span&gt;&lt;span&gt;&lt;strong&gt;åœ¨çœ‹&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;ã€å—ï¼Ÿ&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>