<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>b15079191076f98c975bb961389177ce</guid>
<title>[è¯‘] 2021 Go è¶‹åŠ¿æŠ¥å‘Š</title>
<link>https://toutiao.io/k/runaz5c</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;article class=&quot;markdown-body entry-content container-lg&quot; itemprop=&quot;text&quot;&gt;&lt;h1&gt;&lt;a id=&quot;user-content-2021-go-è¶‹åŠ¿æŠ¥å‘Š&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#2021-go-è¶‹åŠ¿æŠ¥å‘Š&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;2021 Go è¶‹åŠ¿æŠ¥å‘Š&lt;/h1&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.jetbrains.com/author/ekaterina-zharovajetbrains-com&quot; rel=&quot;nofollow&quot;&gt;Ekaterina Zharova&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2021.2.3&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨å½“ä»Šæœ€æµè¡Œçš„ç¼–ç¨‹è¯­è¨€åˆ—è¡¨é‡Œï¼ŒGoè¯­è¨€ä¸€ç›´æ˜¯ååˆ—å‰èŒ…ã€‚ä¼—æ‰€å‘¨çŸ¥ Go è¯­è¨€ç°åœ¨å¾ˆç«ï¼Œå†™ Go ä»£ç ä¹Ÿå¾ˆæœ‰æ„æ€ï¼ŒGo åœ¨ç¤¾åŒºä¹Ÿå¾ˆå—ç”¨æˆ·æ¬¢è¿ï¼Œä¸»è¦æ˜¯ Go è¯­è¨€çš„é€Ÿåº¦å—ï¼Œæ•ˆç‡é«˜ã€‚é™¤äº†è¿™äº›ä¼—æ‰€å‘¨çŸ¥çš„ä¼˜ç‚¹ä¹‹å¤–ï¼Œæˆ‘ä»¬æœŸå¾…å‘ç° Go æ›´å¤šä¸ä¸ºäººçŸ¥çš„ä¿¡æ¯ã€‚ä¸ºäº†å‘ç°æ›´å¤šçš„äº‹å®ï¼Œæˆ‘ä»¬åœ¨ç›®å‰Goç°æœ‰ä¿¡æ¯çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†æ·±å…¥ç ”ç©¶ã€‚æˆ‘ä»¬é‚€è¯·äº†Goè¯­è¨€ä¸“å®¶ã€&lt;code&gt;Goland&lt;/code&gt;å¼€å‘å€¡å¯¼è€… &lt;code&gt;Florin PÄƒÈ›an&lt;/code&gt;  æ¥å‘è¡¨ä»–å¯¹Goè¯­è¨€å‘å±•è¶‹åŠ¿çš„çœ‹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/Go_8001611039611515.gif&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/Go_8001611039611515.gif&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;&lt;a id=&quot;user-content-åœ¨å“ªå„¿&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#åœ¨å“ªå„¿&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;åœ¨å“ªå„¿&lt;/h2&gt;
&lt;h3&gt;&lt;a id=&quot;user-content-çº¦110ä¸‡goå¼€å‘è€…&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#çº¦110ä¸‡goå¼€å‘è€…&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;çº¦110ä¸‡Goå¼€å‘è€…&lt;/h3&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œå¤§çº¦æœ‰ &lt;strong&gt;110ä¸‡ä¸“ä¸šçš„ Go å¼€å‘è€…&lt;/strong&gt; ä½¿ç”¨ Go ä½œä¸º&lt;strong&gt;ä¸»è¦å¼€å‘è¯­è¨€&lt;/strong&gt;ã€‚ å¦‚æœæˆ‘ä»¬æŠŠé‚£äº›ä½¿ç”¨å…¶ä»–è¯­è¨€ä½œä¸ºä¸»åŠ›å¼€å‘è¯­è¨€ï¼Œä½†æ˜¯æŠŠGoå½“ä½œä¸šä½™çˆ±å¥½çš„å¼€å‘äººå‘˜ç®—åœ¨å†…çš„è¯ï¼Œè¿™ä¸€æ•°å­—å¯èƒ½æ¥è¿‘&lt;strong&gt;270ä¸‡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å°±å…¨çƒåˆ†å¸ƒè€Œè¨€ï¼Œå±…ä½åœ¨ &lt;strong&gt;äºšæ´²&lt;/strong&gt; çš„ Go å¼€å‘è€…æœ€å¤šï¼Œå¤§çº¦æœ‰57ä¸‡å¼€å‘è€…ä½¿ç”¨ Go ä½œä¸ºä¸»è¦å¼€å‘è¯­è¨€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¹Ÿæ­£æ˜¯æˆ‘æœ€æœŸå¾…çš„ä½¿ç”¨Goå¼€å‘çš„åœ°æ–¹ã€‚å°±Goç”¨æˆ·æ•°é‡è€Œè¨€ï¼Œäºšæ´²é«˜å±…æ¦œé¦–ï¼Œæˆ‘è®¤ä¸ºä¸»è¦åŸå› æ˜¯æœ‰å¤§é‡çš„æ¥è‡ªåƒè…¾è®¯ã€é˜¿é‡Œå·´å·´ã€åä¸ºè¿™äº›å¤§å…¬å¸çš„å¼€å‘è€…ã€‚è¿™äº›å…¬å¸ä¸€èˆ¬éƒ½æœ‰å¾ˆå¤šå¼€å‘äººå‘˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/1-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/1-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;&lt;a id=&quot;user-content-å…·ä½“åœ¨å“ªé‡Œ&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#å…·ä½“åœ¨å“ªé‡Œ&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;å…·ä½“åœ¨å“ªé‡Œ&lt;/h2&gt;
&lt;p&gt;ä¸‹å›¾æ˜¾ç¤ºäº†æˆ‘ä»¬åœ¨ &lt;a href=&quot;https://www.jetbrains.com/lp/devecosystem-2020/go/&quot; rel=&quot;nofollow&quot;&gt;2020å¼€å‘è€…ç”Ÿæ€è°ƒæŸ¥&lt;/a&gt; ä¸­è°ƒæŸ¥çš„æ¯ä¸ªå›½å®¶ä½¿ç”¨Goä½œä¸ºä¸»è¦è¯­è¨€çš„å¼€å‘è€…çš„åˆ†å¸ƒæƒ…å†µï¼ˆå—è®¿è€…æœ€å¤šå¯ä»¥é€‰æ‹©3ç§ä¸»è¦è¯­è¨€ï¼‰ã€‚&lt;strong&gt;ä¸­å›½&lt;/strong&gt; çš„å¼€å‘è€…é›†ä¸­åº¦æœ€é«˜ï¼Œæœ‰16%çš„ä¸­å›½å¼€å‘è€…åœ¨ä½¿ç”¨Goã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°ä¸­å›½æ’åœ¨æ¦œé¦–ï¼Œæˆ‘ä¸€ç‚¹ä¹Ÿä¸æƒŠè®¶ã€‚æˆ‘æœ¬ä»¥ä¸ºä¿„ç½—æ–¯ä¼šæ’åœ¨ç¬¬äºŒï¼Œç¾å›½ä¼šé«˜ä¸€ç‚¹ï¼Œå¤§æ¦‚åœ¨å‰äº”ä½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸­å›½ä¹‹æ‰€ä»¥æ’åœ¨æ¦œé¦–ï¼Œå¯èƒ½æ­£æ˜¯å› ä¸ºä»–ä»¬æ‹¥æœ‰çš„å¼€å‘è€…æ•°é‡æœ€å¤šã€‚è€Œä¸”æˆ‘è®¤è¯†çš„å¾ˆå¤šå…¬å¸ï¼Œæ¯”å¦‚ &lt;code&gt;PingCAP&lt;/code&gt;ã€è…¾è®¯å’Œåä¸ºï¼Œéƒ½æœ‰å¾ˆå¤šå¼€å‘è€…æ¥æ”¯æ’‘å’Œæ„å»ºä»–ä»¬çš„å†…éƒ¨å·¥å…·ã€åŸºç¡€è®¾æ–½å’Œåç«¯æœåŠ¡ï¼Œè¿™äº›æœåŠ¡éƒ½å’Œå¾®æœåŠ¡ç›¸ç»“åˆã€‚è¿™ä¼¼ä¹æ˜¯ä¸­å›½æ’åœ¨æ¦œé¦–å…³é”®åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çŸ¥é“ä¿„ç½—æ–¯çš„ Go ç¤¾åŒºéå¸¸æ£’ï¼Œæ‰€ä»¥ä¹Ÿéš¾æ€ª Go åœ¨é‚£é‡Œå¾ˆå—æ¬¢è¿ã€‚æˆ‘å¯¹æ—¥æœ¬å’Œä¹Œå…‹å…°å¾ˆå¥½å¥‡ï¼Œå› ä¸ºæˆ‘æ²¡æƒ³åˆ°ä»–ä»¬ä¼šè¿™ä¹ˆé«˜ï¼Œæˆ‘ä»¥ä¸ºå¾·å›½å’Œå°åº¦ä¼šæ›´é«˜äº›ã€‚è®°å¾—å››äº”å¹´å‰æˆ‘åœ¨æŸæ—çš„æ—¶å€™ï¼Œæˆ‘è®¤è¯†çš„æ¯ä¸€å®¶åˆ›ä¸šå…¬å¸éƒ½åœ¨ä½¿ç”¨ Go ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/2-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/2-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;&lt;a id=&quot;user-content-è¡Œä¸šæ´å¯Ÿ&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#è¡Œä¸šæ´å¯Ÿ&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;è¡Œä¸šæ´å¯Ÿ&lt;/h2&gt;
&lt;p&gt;Go ä¾ç„¶ä¿æŒç€å¼€å‘è€…ä¸»è¦ä½¿ç”¨è¯­è¨€çš„ &lt;strong&gt;å‰10å&lt;/strong&gt;ï¼Œæ ¹æ®&lt;a href=&quot;https://www.jetbrains.com/lp/devecosystem-2020/go/&quot; rel=&quot;nofollow&quot;&gt;2020å¼€å‘è€…ç”Ÿæ€è°ƒæŸ¥&lt;/a&gt;æ˜¾ç¤º Go çš„ä»½é¢çº¦ä¸º9%ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘è®¤ä¸º Go ä¼šä¸€ç›´å¢é•¿ã€‚äººä»¬é€šå¸¸ä¸ä¼šæŠŠ Go ä½œä¸ºä»–ä»¬å¼€å§‹ç¼–ç¨‹çš„å…¥é—¨è¯­è¨€ï¼Œä½†æ˜¯ä¼šä»å…¶ä»–è¯­è¨€è¿ç§»è¿‡æ¥ï¼Œä¾‹å¦‚ &lt;code&gt;PHP&lt;/code&gt; &lt;code&gt;Ruby&lt;/code&gt;ï¼Œä½†æ®æˆ‘æ‰€çŸ¥ï¼Œä¸»è¦ä» &lt;code&gt;C++&lt;/code&gt; &lt;code&gt;C#&lt;/code&gt; è¿ç§»è¿‡æ¥ã€‚&lt;/p&gt;
&lt;p&gt;Go ç›¸æ¯” PHP çš„ä¼˜åŠ¿æ˜¯ç±»å‹å®‰å…¨ï¼Œå› ä¸º Go æ˜¯ä¸€é—¨é™æ€ç±»å‹è¯­è¨€ï¼Œè€Œ PHP æ˜¯é—¨åŠ¨æ€ç±»å‹è¯­è¨€ã€‚è¿™å°±æ„å‘³ç€ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶åšäº†å¤§é‡çš„å·¥ä½œæ¥ç¡®ä¿ä½ å†™çš„ä»£ç èƒ½å¤Ÿç¼–è¯‘å¹¶ä¸”æ­£å¸¸è¿è¡Œã€‚ç›¸æ¯”äº C++ ï¼ŒGo çš„ä¼˜åŠ¿æ˜¯ç®€å•ã€‚åœ¨ Go é‡Œé¢ï¼Œä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆç®€å•ã€‚&lt;/p&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼ŒGo çš„ç‰¹ç‚¹å°±æ˜¯ä¸ç”Ÿä¿±æ¥çš„é€Ÿåº¦å¿«ï¼Œæ— è®ºæ˜¯å†™ä»£ç è¿˜æ˜¯è¿è¡Œæ—¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ä¸åšä»»ä½•ç‰¹æ®Šä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨ Go è¯­è¨€ä½ å°±èƒ½æé«˜5-10å€çš„æ€§èƒ½ï¼Œè¿™å¯¹å…¬å¸æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç”Ÿäº§ä¼˜åŠ¿ã€‚åŒæ—¶ Go ä¹Ÿæ˜¯ä¸€é—¨ç®€å•çš„è¯­è¨€ï¼Œå¾ˆå®¹æ˜“ä¸Šæ‰‹ï¼Œå¾ˆå®¹æ˜“æ›¿æ¢ç°æœ‰é¡¹ç›®ä¸­çš„å¾®æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;è®¸å¤š IT åŸºç¡€è®¾æ–½å·¥å…·ï¼Œå¦‚ &lt;code&gt;Kubernetes&lt;/code&gt;ã€&lt;code&gt;Docker&lt;/code&gt;å’Œ&lt;code&gt;Vault&lt;/code&gt;ï¼ˆä¸¾å‡ ä¸ªå¤§å‹çš„ä¾‹å­ï¼‰éƒ½æ˜¯ç”¨ Go æ„å»ºçš„ã€‚å› æ­¤è™½ç„¶å¾ˆå¤šå…¬å¸æ˜¯ä½¿ç”¨ Java ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰ä¸€ä¸ªå›¢é˜Ÿä¼šç”¨ Goï¼Œç‰¹åˆ«æ˜¯ä¸ºäº†æ¥ç»´æŠ¤è¿™äº›é¡¹ç›®å’Œç»™è¿™äº›é¡¹ç›®æ‰“è¡¥ä¸ã€‚è¿™å¯èƒ½æ˜¯ Go  é‡‡ç”¨ç‡ä¿æŒå¢é•¿çš„å¦å¤–ä¸€ä¸ªåŸå› ã€‚ è¿™ç§æŠ€æœ¯åœ¨å…¬å…±æŠ€æœ¯è®¾æ–½å’Œéƒ¨ç½²ä¸­ä½¿ç”¨çš„è¶Šå¤šï¼ŒGo å°±å¢é•¿çš„è¶Šå¿«ã€‚æˆ‘è®¤ä¸ºæ¥ä¸‹æ¥å‡ å¹´ä¼šæœ‰è¶Šæ¥è¶Šå¤šçš„äººé‡‡ç”¨Goï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¤§çº¦æœ‰15%-20%çš„å¼€å‘è€…ä¼šä½¿ç”¨ Go ã€‚ç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°å¼€å‘è€…ç”Ÿæ€è°ƒæŸ¥ä¸­é—®çš„ä¸€ä¸ªé—®é¢˜ï¼Œâ€œæ‚¨æ‰“ç®—åœ¨ä»Šå12ä¸ªæœˆå†…é‡‡ç”¨æˆ–è¿ç§»åˆ°å…¶ä»–è¯­è¨€å—ï¼Ÿâ€ï¼Œ13%çš„å—è®¿è€…å›ç­”æ˜¯Goã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/3-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/3-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;&lt;a id=&quot;user-content-goå¼€å‘çš„è½¯ä»¶ç±»å‹&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#goå¼€å‘çš„è½¯ä»¶ç±»å‹&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Goå¼€å‘çš„è½¯ä»¶ç±»å‹&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Web æœåŠ¡&lt;/strong&gt; æ˜¯ä½¿ç”¨ Go Â æœ€å—æ¬¢è¿çš„é¢†åŸŸï¼Œæ ¹æ® &lt;a href=&quot;https://www.jetbrains.com/lp/devecosystem-2020/go/&quot; rel=&quot;nofollow&quot;&gt;2020å¼€å‘è€…ç”Ÿæ€è°ƒæŸ¥&lt;/a&gt; ç»“æœæ˜¾ç¤ºï¼Œå…¶å æœ‰36%ä»½é¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæ˜¯ web æœåŠ¡ï¼Œæˆ‘è®¤ä¸ºä¸»è¦åŸå› æ˜¯æ„å»ºä¸€ä¸ª API æœåŠ¡éå¸¸å¿«ã€‚ä»–ä»¬ä¸éœ€è¦æ¡†æ¶ï¼Œå°±å¯ä»¥ç”¨ Go å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œä¸€ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä¸è®¤ä¸ºè¿™å¼ å›¾åœ¨æœªæ¥ä¼šæœ‰å¾ˆå¤§å˜åŒ–ï¼Œæˆ‘çœŸå¿ƒå¸Œæœ›çœ‹åˆ° web æœåŠ¡å¾—åˆ°æ›´å¤šçš„åˆ†äº«ï¼Œå› ä¸ºç”¨ Go å¼€å§‹ä¸€ä¸ªweb æœåŠ¡ç¡®å®å¾ˆç®€å•ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå®ç”¨å°ç¨‹åºï¼Œæˆ‘è§è¿‡å¾ˆå¤šç±»ä¼¼çš„ï¼Œå› ä¸º Go å¾ˆå®¹æ˜“å¿«é€Ÿå†™ä¸€ä¸ªå°åº”ç”¨æ¥å¸®ä½ å¤„ç†å¤§é‡çš„æ•°æ®ï¼Œå†™ä¸€ä¸ªå°çš„å®ç”¨ç¨‹åºæˆ–éœ€è¦æ¶ˆè€—å¤§é‡èµ„æºçš„ä¸€æ¬¡æ€§ä»»åŠ¡ã€‚è¶Šæ¥è¶Šå¤šçš„äººé‡‡ç”¨&lt;code&gt;Docker&lt;/code&gt; å’Œ&lt;code&gt;Kubernetes&lt;/code&gt;ï¼Œå°±ä¼šæœ‰è¶Šæ¥è¶Šå¤šçš„äººä½¿ç”¨ Go,ä»…ä»…æ˜¯å› ä¸ºä»–ä»¬éƒ½æ˜¯ç”¨ Go å†™çš„ã€‚ä»»ä½•ç±»å‹çš„ DevOps çš„å·¥ä½œéƒ½å¯ä»¥ä» Go ä¸­è·ç›Šï¼Œå› ä¸ºå®ƒæä¾›äº†ç±»å‹å®‰å…¨å’Œé€Ÿåº¦ã€‚ä¸åŸºç¡€è®¾æ–½çš„äº‘ç«¯äº¤äº’å¾ˆå®¹æ˜“ï¼ˆGoogleã€Amazonã€Azureç­‰ï¼‰ï¼Œå› ä¸ºä»–ä»¬éƒ½æœ‰å¾ˆå¥½çš„ SDK ã€‚æˆ‘è®¤ä¸ºæœªæ¥å‡ å¹´ï¼Œå½“æ³›å‹åˆ°æ¥æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æœŸå¾…ä¸‹ â€œLibraries / Frameworksâ€ çš„ä¸€äº›æå‡ã€‚&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿè½¯ä»¶â€”â€”æˆ‘è®¤ä¸ºéšç€è¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹ä½¿ç”¨åƒ Rust è¿™æ ·çš„è¯­è¨€ç¼–å†™ç³»ç»Ÿè½¯ä»¶ï¼Œè¿™ä¸€æ•°å­—å°†ä¼šä¸‹é™ã€‚æ•°æ®åº“ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥è¿™å¤§çº¦6%å¸‚åœºï¼Œåœ¨æœªæ¥è¿™å¯èƒ½ä¼šå˜æˆä¸€ä¸ªå•†æœºã€‚ç¼–ç¨‹å·¥å…·â€”â€”æˆ‘å¾ˆæƒŠè®¶å®ƒåœ¨åˆ—è¡¨ä¸­ä»½é¢è¿™ä¹ˆé«˜ï¼Œæˆ‘éå¸¸æ„Ÿå…´è¶£å»äº†è§£ä¸€ä¸‹ Go æœ‰å“ªäº›ç¼–ç¨‹å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/5-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/5-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;&lt;a id=&quot;user-content-ä½¿ç”¨goçš„é¡¶çº§è¡Œä¸š&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#ä½¿ç”¨goçš„é¡¶çº§è¡Œä¸š&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;ä½¿ç”¨Goçš„é¡¶çº§è¡Œä¸š&lt;/h2&gt;
&lt;p&gt;æ ¹æ® &lt;a href=&quot;https://www.jetbrains.com/lp/devecosystem-2020/go/&quot; rel=&quot;nofollow&quot;&gt;2020å¼€å‘è€…ç”Ÿæ€è°ƒæŸ¥&lt;/a&gt; ï¼ŒGo ç¨‹åºå‘˜ä¸»è¦ä»äº‹ &lt;strong&gt;IT æœåŠ¡&lt;/strong&gt;ï¼Œå…¶æ¬¡æ˜¯ &lt;strong&gt;é‡‘èå’Œé‡‘èç§‘æŠ€&lt;/strong&gt;ã€&lt;strong&gt;äº‘æŠ€æœ¯/äº‘å¹³å°&lt;/strong&gt; å’Œå…¶ä»–è¡Œä¸šã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;é‡‘èå’Œé‡‘èç§‘æŠ€ã€‚è¿™æ˜¯æˆ‘å¸Œæœ›çœ‹åˆ°çš„ï¼Œå› ä¸ºæ®æˆ‘æ‰€çŸ¥æœ‰ç›¸å½“å¤šçš„é“¶è¡Œå·²ç»å¼€å§‹é‡‡ç”¨ Go æˆ–è€…æ­£åœ¨å¹¿æ³›ä½¿ç”¨ Go ä½œä¸ºä»–ä»¬çš„åŸºç¡€è®¾æ–½ã€‚ä¾‹å¦‚ï¼Œ&lt;a href=&quot;https://monzo.com/blog/2016/09/19/building-a-modern-bank-backend&quot; rel=&quot;nofollow&quot;&gt;æ¥è‡ªè‹±å›½çš„Monzoä½¿ç”¨ Go æ„å»ºäº†ä»–ä»¬æ•´ä¸ªé“¶è¡Œç³»ç»Ÿ&lt;/a&gt;ã€‚äº‘è®¡ç®—å’Œäº‘å¹³å°ä¹Ÿå¾ˆæœ‰æ„ä¹‰ï¼Œå› ä¸ºå®ƒä»¬å¯¹äºä½¿ç”¨ Go ç¼–å†™çš„åº”ç”¨æ¥è¯´æ˜¯å¾ˆè‡ªç„¶çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç§»åŠ¨å¼€å‘ï¼Œè¿™æ˜¯æ„æ–™ä¹‹å¤–çš„ã€‚Go å¹¶æ²¡æœ‰å¥½çš„ç§»åŠ¨å¼€å‘å†å²ã€‚å¦‚æœæœ‰ä»€ä¹ˆä¸åŒçš„è¯ï¼Œæˆ‘å¸Œæœ›å¤§å®¶ä½¿ç”¨ Go æ¥ä¸ºç§»åŠ¨ç¨‹åºæä¾›ç½‘ç»œæœåŠ¡æˆ–è€…åç«¯æœåŠ¡ï¼Œä½†ä»…æ­¤è€Œå·²ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å‡ ä¸ªè¡Œä¸šï¼Œæˆ‘ä¸è®¤ä¸º Go çš„ä½¿ç”¨ç‡ä¼šå¾ˆå¿«å¢åŠ ã€‚æ¯”å¦‚ï¼Œä»»ä½•åŸºäºæœºå™¨å­¦ä¹ çš„ä¸œè¥¿ï¼Œå› ä¸ºè¿™ä»ç„¶æ˜¯ Python çš„åœ°ç›˜ã€‚äººä»¬æ­£åœ¨åŠªåŠ›è®©æœºå™¨å­¦ä¹ åœ¨ Go ä¸­å˜å¾—å—æ¬¢è¿å’Œå˜å¾—æ›´å¥½ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºè‡³å°‘è¦å‡ å¹´ä¹‹åæ‰ä¼šæœ‰ä¸€äº›ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/4-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/4-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;&lt;a id=&quot;user-content-go-å·¥å…·&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#go-å·¥å…·&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Go å·¥å…·&lt;/h2&gt;
&lt;h3&gt;&lt;a id=&quot;user-content-åŒ…ç®¡ç†&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#åŒ…ç®¡ç†&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;åŒ…ç®¡ç†&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Go Modules&lt;/strong&gt; æ˜¯ Go å¼€å‘è€…ä¸­æœ€å—æ¬¢è¿çš„åŒ…ç®¡ç†å·¥å…·ã€‚æ ¹æ® &lt;em&gt;2020 å¼€å‘è€…ç”Ÿæ€è°ƒæŸ¥&lt;/em&gt; å…¶ä½¿ç”¨ç‡ä» &lt;a href=&quot;https://www.jetbrains.com/lp/devecosystem-2019/go/&quot; rel=&quot;nofollow&quot;&gt;2019&lt;/a&gt; åˆ°41%ä¸Šå‡åˆ°åˆ° &lt;a href=&quot;https://www.jetbrains.com/lp/devecosystem-2020/go/&quot; rel=&quot;nofollow&quot;&gt;2020&lt;/a&gt; çš„82%ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘è®¤ä¸ºåœ¨æŸç§ç¨‹åº¦ä¸Šæˆ‘ä»¬å¯èƒ½ä¸å¾—ä¸åœæ­¢é—®è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º Go Moduleså·²ç»è¢«è®¾ç½®ä¸ºæ ‡å‡†é»˜è®¤æ¨¡å‹ï¼Œè€Œä¸”Goå›¢é˜Ÿä¹Ÿæƒ³è¦å¼ƒç”¨ &lt;code&gt;GOPATH&lt;/code&gt;ã€‚åˆ°é‚£æ—¶ï¼Œå…¶ä»–çš„æ‰€æœ‰çš„åŒ…ç®¡ç†å·¥å…·éƒ½å°†ä¼šè¢«æ·˜æ±°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/6-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/6-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;&lt;a id=&quot;user-content-go-è·¯ç”±&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#go-è·¯ç”±&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Go è·¯ç”±&lt;/h3&gt;
&lt;p&gt;æ ¹æ® &lt;a href=&quot;https://www.jetbrains.com/lp/devecosystem-2020/go/&quot; rel=&quot;nofollow&quot;&gt;2020&lt;/a&gt; å’Œ &lt;a href=&quot;https://www.jetbrains.com/research/devecosystem-2018/go/&quot; rel=&quot;nofollow&quot;&gt;2018&lt;/a&gt; çš„å¼€å‘è€…ç”Ÿæ€è°ƒæŸ¥æ˜¾ç¤ºï¼Œ&lt;strong&gt;Gorilla / Mux&lt;/strong&gt; å’Œ &lt;strong&gt;æ ‡å‡†åº“&lt;/strong&gt; è‡ª2018å¹´ä»¥æ¥ä¸€ç›´æ˜¯ä½¿ç”¨æœ€å¤šçš„ Go è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æ ‡å‡†åº“ä¹‹æ‰€ä»¥å¦‚æ­¤å—æ¬¢è¿ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ¯å½“ä½ å»Redditã€Slackæˆ–å…¶ä»–åœ°æ–¹ï¼Œäººä»¬é€šå¸¸éƒ½ä¼šå»ºè®®ä½ åšæŒä½¿ç”¨æ ‡å‡†åº“ï¼Œåªæœ‰åœ¨ä½ çœŸæ­£éœ€è¦çš„æ—¶å€™æ‰ä½¿ç”¨å…¶ä»–ä¸œè¥¿ã€‚æˆ‘ä½¿ç”¨&lt;code&gt;gorilla/mux&lt;/code&gt;ï¼Œæ˜¯å› ä¸ºå®ƒåœ¨æ ‡å‡†åº“çš„åŸºç¡€ä¸Šæœ‰æ›´å¤šçš„æŠ½è±¡ï¼Œåˆä¸ä¼šç‰ºç‰²å¤ªå¤šçš„æ€§èƒ½ã€‚ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºå®ƒæ˜¯æœ€æ¥è¿‘æ ‡å‡†åº“çš„ï¼Œè€Œä¸”å®ƒä½¿å¾—ç¼–å†™æœåŠ¡ç«¯æ›´å®¹æ˜“ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™ç§åˆ†å¸ƒå¯èƒ½æ˜¯æˆ‘å¸Œæœ›çœ‹åˆ°çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/7-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/7-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;&lt;a id=&quot;user-content-5å¤§webæ¡†æ¶&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#5å¤§webæ¡†æ¶&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;5å¤§webæ¡†æ¶&lt;/h3&gt;
&lt;p&gt;æ ¹æ® &lt;a href=&quot;https://www.jetbrains.com/lp/devecosystem-2020/go/&quot; rel=&quot;nofollow&quot;&gt;2020&lt;/a&gt; å’Œ &lt;a href=&quot;https://www.jetbrains.com/research/devecosystem-2018/go/&quot; rel=&quot;nofollow&quot;&gt;2018&lt;/a&gt; çš„å¼€å‘è€…ç”Ÿæ€è°ƒæŸ¥æ˜¾ç¤ºï¼Œ&lt;strong&gt;Gin&lt;/strong&gt; çš„ä½¿ç”¨é‡è‡ª2018å¹´ä»¥æ¥å‡ ä¹ç¿»äº†ä¸€å€ï¼Œè€Œå…¶ä»– web æ¡†æ¶åŸºæœ¬ä¿æŒç¨³å®šã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Gin åœ¨ web ä¸Šå¦‚æ­¤å—æ¬¢è¿ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé€Ÿåº¦å¿«çš„æ¡†æ¶ï¼Œè€Œä¸”ä¹Ÿå¾—åˆ°äº†å¾ˆå¥½çš„æ¨èã€‚å®ƒä¹Ÿæ˜¯æœ€å¤è€çš„æ¡†æ¶ä¹‹ä¸€ã€‚å› ä¸ºä¼šæœ‰å¾ˆå¤šæ–‡æ¡£æ‘†åœ¨é‚£å„¿ï¼Œå¾ˆå¤šç”¨æˆ·å·²ç»åœ¨ä½¿ç”¨å®ƒå’Œæ¨èå®ƒã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/8-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/8-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;&lt;a id=&quot;user-content-æµ‹è¯•æ¡†æ¶&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#æµ‹è¯•æ¡†æ¶&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;æµ‹è¯•æ¡†æ¶&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ &lt;strong&gt;å†…ç½®æµ‹è¯•æ¡†æ¶&lt;/strong&gt; çš„æ¯”ä¾‹ä» &lt;a href=&quot;https://www.jetbrains.com/research/devecosystem-2018/go/&quot; rel=&quot;nofollow&quot;&gt;2018&lt;/a&gt; 64%ä¸‹é™åˆ° &lt;a href=&quot;https://www.jetbrains.com/lp/devecosystem-2020/go/&quot; rel=&quot;nofollow&quot;&gt;2020&lt;/a&gt; çš„44%ï¼Œè€Œä½¿ç”¨å…¶ä»–æµ‹è¯•æ¡†æ¶çš„æ¯”ä¾‹ç•¥æœ‰å¢é•¿ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;å†…ç½®çš„æµ‹è¯•æ¡†æ¶æ¯”ä¾‹å¾ˆé«˜æ˜¯å› ä¸º Go æ ‡å‡†åº“æœ‰ä¸€ä¸ªéå¸¸å¥½çš„å¼€ç®±å³ç”¨çš„æµ‹è¯•åº“ã€‚&lt;/p&gt;
&lt;p&gt;å†…ç½®æµ‹è¯•å¯èƒ½ä¼šä¸‹é™ä¸»è¦æ˜¯å› ä¸ºè¶Šæ¥è¶Šå¤šçš„äººä»å…¶ä»–è¯­è¨€(æ¯”å¦‚ PHP )è½¬å‘è¿™é—¨è¯­è¨€ï¼Œä»–ä»¬è¯•å›¾å¤åˆ¶è‡ªå·±å·²æœ‰çš„æµ‹è¯•ä¹ æƒ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/9-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/9-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;&lt;a id=&quot;user-content-è®¨è®ºæœ€å¤šçš„goå·¥å…·å’Œå…¶ä»–è¯­è¨€&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#è®¨è®ºæœ€å¤šçš„goå·¥å…·å’Œå…¶ä»–è¯­è¨€&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;è®¨è®ºæœ€å¤šçš„Goå·¥å…·å’Œå…¶ä»–è¯­è¨€&lt;/h2&gt;
&lt;p&gt;Go ç»å¸¸åœ¨ IT ç¤¾åŒºä¸­è¢«è®¨è®ºï¼ŒStack Overflow å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚æˆ‘ä»¬ä»å…¶ Q&amp;amp;A å•å…ƒè·å–æ•°æ®æ¥æ‰¾å‡ºå“ªäº›æ ‡ç­¾ä¸â€œGoâ€åŒæ—¶å‡ºç°æ¬¡æ•°æœ€å¤šã€‚å…¶ä¸­æœ‰23ç§å·¥å…·å’Œä¸¤ç§è¯­è¨€ï¼ˆ&lt;code&gt;MySQL&lt;/code&gt; å’Œ &lt;code&gt;PostgreSQL&lt;/code&gt;ï¼‰ã€‚é™¤äº†è¿™äº›å·¥å…·ï¼Œè¿˜æœ‰ä¸å…¶ä»–é¡¶çº§è¯­è¨€çš„å…±å­˜ã€‚çºµè½´è¡¨ç¤ºæ ‡ç­¾å‡ºç°çš„æ€»æ¬¡æ•°ï¼Œè€Œæ¨ªè½´è¡¨ç¤ºå¸¦æœ‰â€œGoâ€çš„æ ‡ç­¾çš„æåŠæ¬¡æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä¸“å®¶åˆ†æ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘æ—©æ–™åˆ°&lt;code&gt; JSON&lt;/code&gt; ä¼šæ˜¯ä¸ªé—®é¢˜ï¼ŒæŠŠ Go çš„æ•°æ®ç»“æ„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æˆ&lt;code&gt; JSON&lt;/code&gt;ç¡®å®æ˜¯å¾ˆä¸å®¹æ˜“çš„ï¼Œè¿™å¯èƒ½å°±æ˜¯ &lt;code&gt;JSON&lt;/code&gt;ä¼šå¦‚æ­¤é†’ç›®çš„åŸå› ã€‚æ¥è‡ªå…¶ä»–è¯­è¨€çš„äººé€šå¸¸å¾ˆéš¾ç†è§£&lt;code&gt;struct&lt;/code&gt;ï¼Œé™¤éå®ƒä»¬æ¥è‡ªC++æˆ–Cã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº&lt;code&gt;AWS&lt;/code&gt;æœ¬èº«çš„å—æ¬¢è¿ç¨‹åº¦ï¼Œæˆ‘è®¤ä¸º&lt;code&gt;Amazon Web Services&lt;/code&gt;ä¼šæœ‰å¾ˆå¤šé—®é¢˜ã€‚ç°åœ¨ç°åœ¨ä¸º&lt;code&gt;Google App Engine&lt;/code&gt;å¼€å‘ Go åº”ç”¨ç¨‹åºæ›´ç®€å•äº†ï¼Œä½†ä»¥å‰å¹¶ä¸æ˜¯è¿™æ ·ï¼Œæ‰€ä»¥æ‰ä¼šæœ‰è¿™ä¹ˆå¤šé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼ŒGoç¤¾åŒºæ˜¯ä¸€ä¸ªéå¸¸æœ‰è¶£ä¸”å…·æœ‰åŒ…å®¹æ€§çš„ç¤¾åŒºï¼Œä½ å¯ä»¥æˆä¸ºå…¶ä¸­çš„ä¸€å‘˜ã€‚ä»ä¸æ’æ–¥æ–°äººï¼Œé¼“åŠ±ä»–ä»¬æå‡ºé—®é¢˜ï¼Œæ¢ç´¢è¯­è¨€ã€‚åœ¨ä¸€èˆ¬çš„ä¸»é¢˜æ–¹é¢ï¼Œæ³›å‹ä»¥åŠæŸäº›è¯­è¨€æ”¹è¿›ã€ç¼–è¯‘å™¨æ”¹è¿›ç­‰éƒ½æ˜¯ç»å¸¸è®¨è®ºçš„è¯é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å°¤å…¶æ˜¯æ³›å‹ï¼Œå› ä¸ºå®ƒæ˜¯è¯¥è¯­è¨€æœ€éœ€è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå¹¶ä¸”æœ‰å¤§é‡çš„å·¥ä½œè´Ÿè½½å°†å—ç›Šäºè¯¥ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h2&gt;&lt;a id=&quot;&quot; class=&quot;anchor&quot; aria-hidden=&quot;true&quot; href=&quot;#&quot;&gt;&lt;svg class=&quot;octicon octicon-link&quot; viewbox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;/gocn/translator/blob/master/static/images/w6_the_state_of_Go/11-2x.png&quot;&gt;&lt;img src=&quot;/gocn/translator/raw/master/static/images/w6_the_state_of_Go/11-2x.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;/article&gt;
  &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>baf9d7288663f2179bd7a28c6b6cc940</guid>
<title>Go å·¥ç¨‹åŒ–ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®ç›®å½•ç»“æ„</title>
<link>https://toutiao.io/k/9p2dvmm</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;markdown-body&quot;&gt;&lt;h2 id=&quot;åº&quot;&gt;&lt;a href=&quot;#åº&quot; class=&quot;headerlink&quot; title=&quot;åº&quot;/&gt;åº&lt;/h2&gt;&lt;p&gt;æœ¬ç³»åˆ—ä¸º &lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://u.geekbang.org/subject/go?utm_source=lailin.xyz&amp;amp;utm_medium=lailin.xyz&quot;&gt;Go è¿›é˜¶è®­ç»ƒè¥&lt;/a&gt; ç¬”è®°ï¼Œé¢„è®¡ 2021Q1 å®Œæˆæ›´æ–°ï¼Œè®¿é—® &lt;a href=&quot;https://lailin.xyz/categories/Go%E8%BF%9B%E9%98%B6%E8%AE%AD%E7%BB%83%E8%90%A5/&quot;&gt;åšå®¢: Go è¿›é˜¶è®­ç»ƒè¥&lt;/a&gt; å³å¯æŸ¥çœ‹å½“å‰æ›´æ–°è¿›åº¦ï¼Œéƒ¨åˆ†æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œä½¿ç”¨ PC å¤§å±æµè§ˆä½“éªŒæ›´ä½³&lt;/p&gt;&lt;p&gt;å·¥ç¨‹åŒ–è¿™ä¸€èŠ‚è¯´ç®€å•çœ‹ä¼¼ç®€å•ï¼Œæ— éå°±æ˜¯ç›®å½•ç»“æ„ï¼Œä»£ç åˆ†å±‚ï¼Œä¾èµ–æ³¨å…¥ç­‰ç­‰ã€‚ä½†æ˜¯å…¶ä¸­å¾ˆå¤šå‘å¦‚æœæ²¡è¸©è¿‡æ˜¯ä¸çŸ¥é“è¿™é‡Œé¢çš„ç—›ç‚¹çš„ã€‚é™¤æ­¤ä¹‹å¤–è¿™é‡Œé¢ä¹Ÿä¼šæœ‰å¾ˆå¤šæ¶æ„çš„æ€æƒ³åœ¨é‡Œé¢ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¼šæŠŠæ¶æ„æ•´æ´ä¹‹é“çš„é˜…è¯»ç¬”è®°æ”¾åœ¨ç¬¬ä¸€å°èŠ‚çš„åŸå› ã€‚&lt;/p&gt;&lt;p&gt;æ¥æ¥ä¸‹åŒ…å«è¿™ä¸€ç¯‡æ–‡ç« åœ¨å†…ï¼Œæˆ‘ä¼šå…ˆç”¨å‡ ç¯‡æ–‡ç« ç»“åˆå‚è€ƒææ–™ä»¥åŠä¸ªäººçš„ç†è§£æ•´ç†ä¸€ä¸‹æ¯›è€å¸ˆè¯¾ä¸Šè®²çš„å†…å®¹ã€‚ç„¶åæ°å¥½åœ¨è¿™ä¸ªè¯¾ç¨‹å‰ï¼Œæˆ‘ä¹Ÿåœ¨å¯¹æˆ‘ä»¬ä¹‹å‰çš„ä¸€äº›é¡¹ç›®åšé‡æ„ï¼Œæ‰€ä»¥ä¼šå†ç”¨ä¸€åˆ°ä¸¤ç¯‡æ–‡ç« å¤§æ¦‚è¯´ä¸€äº›æˆ‘æœ€åé€‰æ‹©çš„æ–¹å¼ï¼Œå·²ç»åœ¨å®è·µè¿‡ç¨‹ä¸­çš„ä¸€äº›å–èˆï¼Œå°±å·¥ç¨‹åŒ–è¿™ä¸ªäº‹æƒ…æ¥è¯´å¤§æ¦‚åŸç†ä¸ŠåŸºæœ¬éƒ½æ˜¯ç›¸é€šçš„ï¼Œä½†æ˜¯æ¯ä¸ªå›¢é˜Ÿç”šè‡³æ¯ä¸ªäººæ‰€é¢ä¸´çš„ä¸€äº›é—®é¢˜éƒ½å„ä¸ç›¸åŒï¼Œæ‰€ä»¥æœ€åå‡ºæ¥çš„ä¸œè¥¿è‚¯å®šä¸æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚&lt;/p&gt;&lt;p&gt;æ³¨æ„ï¼Œä½ å¦‚æœæ˜¯åªæ˜¯éœ€è¦å†™ä¸€ä¸ªè„šæœ¬ï¼Œæˆ–è€…æ˜¯åšä¸€äº›ç®€å•çš„ demo å¤§å¯ä¸å¿…åƒæ–‡ç« æ¥ä¸‹æ¥ä»‹ç»çš„è¿™æ ·æçš„è¿™ä¹ˆéº»çƒ¦ï¼Œç›´æ¥ä¸€ä¸ª main.go ç®€å•å¿«æ·æ–¹ä¾¿å³å¯ï¼Œä½†æ˜¯å¦‚æœä½ è¿™æ˜¯ä¸€ä¸ªé•¿æœŸç»´æŠ¤çš„é¡¹ç›®ï¼Œç”šè‡³æ¶‰åŠåˆ°çš„å¤šä¸ªäººä¹‹é—´çš„åˆä½œï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„å‡ ç¯‡æ–‡ç« å°±ä¸èƒ½é”™è¿‡äº†ï¼Œå¯ä»¥ä»”ç»†é˜…è¯»ï¼Œå¸Œæœ›å¯ä»¥å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;&lt;h2 id=&quot;Standard-Go-Project-Layout&quot;&gt;&lt;a href=&quot;#Standard-Go-Project-Layout&quot; class=&quot;headerlink&quot; title=&quot;Standard Go Project Layout&quot;/&gt;Standard Go Project Layout&lt;/h2&gt;&lt;p&gt;è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹ä¸»è¦æ¥è‡ªäº github çš„é«˜æ˜Ÿé¡¹ç›®ï¼š&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/golang-standards/project-layout/blob/master/README_zh.md&quot;&gt;golang-standards/project-layout&lt;/a&gt; é€šè¿‡è¿™ä¸ªæˆ‘ä»¬å¯ä»¥å¤§æ¦‚çš„äº†è§£åˆ°åœ¨ Go ä¸­ä¸€äº›çº¦å®šä¿—æˆçš„ç›®å½•å«ä¹‰ï¼Œè™½ç„¶è¿™äº›ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†æ˜¯å¦‚æœæœ‰å»çœ‹å®˜æ–¹çš„æºç æˆ–è€…æ˜¯ä¸€äº›çŸ¥åçš„é¡¹ç›®å¯ä»¥å‘ç°å¤§å¤šéƒ½æ˜¯è¿™ä¹ˆå‘½åçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½å’Œç¤¾åŒºä¿æŒä¸€è‡´ï¼Œå¤§å®¶ä¿æŒåŒæ ·çš„è¯­è¨€ã€‚&lt;/p&gt;&lt;h3 id=&quot;cmd&quot;&gt;&lt;a href=&quot;#cmd&quot; class=&quot;headerlink&quot; title=&quot;/cmd&quot;/&gt;/cmd&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨ &lt;code&gt;/cmd/[appname]/main.go&lt;/code&gt; çš„å½¢å¼è¿›è¡Œç»„ç»‡&lt;/p&gt;&lt;ul&gt;&lt;li&gt;é¦–å…ˆ cmd ç›®å½•ä¸‹ä¸€èˆ¬æ˜¯é¡¹ç›®çš„ä¸»å¹²ç›®å½•&lt;/li&gt;&lt;li&gt;è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶&lt;strong&gt;ä¸åº”è¯¥æœ‰å¤ªå¤šçš„ä»£ç ï¼Œä¸åº”è¯¥åŒ…å«ä¸šåŠ¡é€»è¾‘&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;main.go å½“ä¸­ä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯è´Ÿè´£ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼ŒæœåŠ¡æ‰€éœ€èµ„æºçš„ä¾èµ–æ³¨å…¥ç­‰ï¼Œå…¶ä¸­ä¾èµ–æ³¨å…¥ä¸€èˆ¬è€Œè¨€æˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œè¿™ä¸ªä¸»è¦çœ‹å¤æ‚ç¨‹åº¦ï¼Œåç»­ä¼šæœ‰ä¸€ç¯‡æ–‡ç« å•ç‹¬ä»‹ç»è¿™ä¸ª&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;internal&quot;&gt;&lt;a href=&quot;#internal&quot; class=&quot;headerlink&quot; title=&quot;/internal&quot;/&gt;/internal&lt;/h3&gt;&lt;p&gt;internal ç›®å½•ä¸‹çš„åŒ…ï¼Œä¸å…è®¸è¢«å…¶ä»–é¡¹ç›®ä¸­è¿›è¡Œå¯¼å…¥ï¼Œè¿™æ˜¯åœ¨ Go 1.4 å½“ä¸­å¼•å…¥çš„ featureï¼Œä¼šåœ¨ç¼–è¯‘æ—¶æ‰§è¡Œ&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠé¡¹ç›®æ–‡ä»¶å¤¹æ”¾ç½®åˆ° internal å½“ä¸­ï¼Œä¾‹å¦‚ &lt;code&gt;/internal/app&lt;/code&gt;&lt;/li&gt;&lt;li&gt;å¦‚æœæ˜¯å¯ä»¥è¢«å…¶ä»–é¡¹ç›®å¯¼å…¥çš„åŒ…æˆ‘ä»¬ä¸€èˆ¬ä¼šæ”¾åˆ° pkg ç›®å½•ä¸‹&lt;/li&gt;&lt;li&gt;å¦‚æœæ˜¯æˆ‘ä»¬é¡¹ç›®å†…éƒ¨è¿›è¡Œå…±äº«çš„åŒ…ï¼Œè€Œä¸æœŸæœ›å¤–éƒ¨å…±äº«ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾åˆ° &lt;code&gt;/internal/pkg&lt;/code&gt; å½“ä¸­&lt;/li&gt;&lt;li&gt;æ³¨æ„ internal ç›®å½•çš„é™åˆ¶å¹¶ä¸å±€é™äºé¡¶çº§ç›®å½•ï¼Œåœ¨ä»»ä½•ç›®å½•å½“ä¸­éƒ½æ˜¯ç”Ÿæ•ˆçš„&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä¸¾ä¸ª ğŸŒ° ä¸‹é¢çš„æ˜¯æˆ‘ä»¬å½“å‰çš„ç›®å½•ç»“æ„ï¼Œå…¶ä¸­çš„ä»£ç å¾ˆç®€å•ï¼Œåœ¨ &lt;code&gt;t.go&lt;/code&gt; å½“ä¸­å¯¼å‡ºäº†ä¸€ä¸ªå˜é‡ &lt;code&gt;I&lt;/code&gt; ç„¶ååœ¨ &lt;code&gt;a/cmd/a/main.go&lt;/code&gt; å’Œ &lt;code&gt;b/cmd/b/main.go&lt;/code&gt; å½“ä¸­åˆ†åˆ«å¯¼å…¥è¾“å‡ºè¿™ä¸ªå˜é‡çš„å€¼&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;â¯ tree&lt;br/&gt;.&lt;br/&gt;â”œâ”€â”€ a&lt;br/&gt;â”‚   â”œâ”€â”€ cmd&lt;br/&gt;â”‚   â”‚   â””â”€â”€ a&lt;br/&gt;â”‚   â”‚       â””â”€â”€ main.&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;&lt;br/&gt;â”‚   â””â”€â”€ internal&lt;br/&gt;â”‚       â””â”€â”€ pkg&lt;br/&gt;â”‚           â””â”€â”€ t&lt;br/&gt;â”‚               â””â”€â”€ t.&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;&lt;br/&gt;â””â”€â”€ b&lt;br/&gt;    â””â”€â”€ cmd&lt;br/&gt;        â””â”€â”€ b&lt;br/&gt;            â””â”€â”€ main.&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ &lt;code&gt;a&lt;/code&gt; ç›®å½•ä¸‹å¯ä»¥ç›´æ¥è¾“å‡º &lt;code&gt;I&lt;/code&gt; çš„å€¼&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;â¯ &lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; run ./a/cmd/a/main.&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;ä½†æ˜¯åœ¨ &lt;code&gt;b&lt;/code&gt; ç›®å½•ä¸‹ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™è¯´å¯¼å…¥äº† &lt;code&gt;a&lt;/code&gt; çš„ç§æœ‰åŒ…&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;â¯ &lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; run ./b/cmd/b/main.&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; command-line-arguments&lt;br/&gt;        b/cmd/b/main.&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;: use of internal &lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; github.com/mohuishou/&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;-training/Week04/blog/&lt;span class=&quot;hljs-number&quot;&gt;02&lt;/span&gt;_project_layout/&lt;span class=&quot;hljs-number&quot;&gt;01&lt;/span&gt;_internal_example/a/internal/pkg/t not allowed&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;pkg&quot;&gt;&lt;a href=&quot;#pkg&quot; class=&quot;headerlink&quot; title=&quot;/pkg&quot;/&gt;/pkg&lt;/h3&gt;&lt;p&gt;ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬åœ¨ pkg ç›®å½•ä¸‹æ”¾ç½®å¯ä»¥è¢«å¤–éƒ¨ç¨‹åºå®‰å…¨å¯¼å…¥çš„åŒ…ï¼Œå¯¹äºä¸åº”è¯¥è¢«å¤–éƒ¨ç¨‹åºä¾èµ–çš„åŒ…æˆ‘ä»¬åº”è¯¥æ”¾ç½®åˆ° &lt;code&gt;internal&lt;/code&gt; ç›®å½•ä¸‹ï¼Œ &lt;code&gt;internal&lt;/code&gt; ç›®å½•ä¼šæœ‰ç¼–è¯‘å™¨è¿›è¡Œå¼ºåˆ¶éªŒè¯&lt;/p&gt;&lt;ul&gt;&lt;li&gt;pkg ç›®å½•ä¸‹çš„åŒ…ä¸€èˆ¬ä¼šæŒ‰ç…§åŠŸèƒ½è¿›è¡ŒåŒºåˆ†ï¼Œä¾‹å¦‚ &lt;code&gt;/pkg/cache&lt;/code&gt; ã€ &lt;code&gt;/pkg/conf&lt;/code&gt; ç­‰&lt;/li&gt;&lt;li&gt;å¦‚æœä½ çš„ç›®å½•ç»“æ„æ¯”è¾ƒç®€å•ï¼Œå†…å®¹ä¹Ÿæ¯”è¾ƒå°‘ï¼Œå…¶å®ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ &lt;code&gt;pkg&lt;/code&gt; ç›®å½•ï¼Œç›´æ¥æŠŠä¸Šé¢çš„è¿™äº›åŒ…æ”¾åœ¨æœ€ä¸Šå±‚å³å¯&lt;/li&gt;&lt;li&gt;ä¸€èˆ¬è€Œè¨€æˆ‘ä»¬åº”ç”¨ç¨‹åº app åœ¨æœ€å¤–å±‚ä¼šåŒ…å«å¾ˆå¤šæ–‡ä»¶ï¼Œä¾‹å¦‚ &lt;code&gt;.gitlab-ci.yml&lt;/code&gt; &lt;code&gt;makefile&lt;/code&gt; &lt;code&gt;.gitignore&lt;/code&gt; ç­‰ç­‰ï¼Œè¿™ç§æ—¶å€™é¡¶å±‚ç›®å½•ä¼šå¾ˆå¤šå¹¶ä¸”ä¼šæœ‰ç‚¹æ‚ä¹±ï¼Œå»ºè®®è¿˜æ˜¯æ”¾åˆ° &lt;code&gt;/pkg&lt;/code&gt; ç›®å½•æ¯”è¾ƒå¥½&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&quot;Kit-Project-Layout&quot;&gt;&lt;a href=&quot;#Kit-Project-Layout&quot; class=&quot;headerlink&quot; title=&quot;Kit Project Layout&quot;/&gt;Kit Project Layout&lt;/h2&gt;&lt;p&gt;kit åº“å…¶å®ä¹Ÿå°±æ˜¯ä¸€äº›åŸºç¡€åº“&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æ¯ä¸€ä¸ªå…¬å¸æ­£å¸¸æ¥è¯´åº”è¯¥&lt;strong&gt;æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªåŸºç¡€åº“é¡¹ç›®&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;kit åº“ä¸€èˆ¬ä¼šåŒ…å«ä¸€äº›å¸¸ç”¨çš„å…¬å…±çš„æ–¹æ³•ï¼Œä¾‹å¦‚ç¼“å­˜ï¼Œé…ç½®ç­‰ç­‰ï¼Œæ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯ &lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/go-kit/kit&quot;&gt;go-kit&lt;/a&gt;&lt;/li&gt;&lt;li&gt;kit åº“å¿…é¡»å…·æœ‰çš„ç‰¹ç‚¹ï¼š&lt;ul&gt;&lt;li&gt;ç»Ÿä¸€&lt;/li&gt;&lt;li&gt;æ ‡å‡†åº“æ–¹å¼å¸ƒå±€&lt;/li&gt;&lt;li&gt;é«˜åº¦æŠ½è±¡&lt;/li&gt;&lt;li&gt;æ”¯æŒæ’ä»¶&lt;/li&gt;&lt;li&gt;å°½é‡å‡å°‘ä¾èµ–&lt;/li&gt;&lt;li&gt;æŒç»­ç»´æŠ¤&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å‡å°‘ä¾èµ–å’ŒæŒç»­ç»´æŠ¤æ˜¯æˆ‘åé¢è¡¥å……çš„ï¼Œè¿™ä¸€ç‚¹å…¶å®å¾ˆé—æ†¾ï¼Œæˆ‘ä»¬éƒ¨é—¨åˆšè¿›æ¥çš„æ—¶å€™æ–¹å‘æ˜¯å¯¹çš„ä¹Ÿå»ºç«‹äº†ä¸€å¥—åŸºç¡€åº“ï¼Œç„¶åå¤§å®¶éƒ½ä½¿ç”¨è¿™åŒä¸€å¥—åº“ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œæˆ‘ä»¬è¿™ä¸€å¥—åº“ä¸€æ˜¯æ²¡äººç»´æŠ¤ï¼ŒäºŒæ˜¯æ²¡æœ‰ä¸€å¥—æœºåˆ¶æ¥è¿›è¡Œè¿­ä»£ï¼Œåˆ°ç°åœ¨å¾ˆå¤šå›¢é˜Ÿå’Œé¡¹ç›®å·²ç»å„æå„çš„äº†ã€‚&lt;br/&gt;è¿™æ ·å…¶å®ä¼šå¯¼è‡´åšå¾ˆå¤šé‡å¤å·¥ä½œä»¥åŠåç»­çš„ä¸€äº›æ”¹åŠ¨å¾ˆéš¾æ¨è¿›ï¼Œå‰è½¦ä¹‹é‰´ï¼Œå¦‚æœæœ‰ç±»ä¼¼çš„æƒ…å†µä¸€å®šè¦åœ¨å°ç«è‹—å‡ºæ¥çš„æ—¶å€™å…ˆæ‘ä½ï¼Œä»å¤§çš„è§’åº¦æ¥è®²ç»Ÿä¸€æœ‰æ—¶å€™æ¯”å¥½ç”¨é‡è¦ï¼Œä¸å¥½ç”¨åº”è¯¥å‚ä¸è´¡çŒ®è€Œä¸æ˜¯å¦èµ·ç‚‰ç¶ã€‚&lt;/p&gt;&lt;h2 id=&quot;Service-Application-Project-Layout&quot;&gt;&lt;a href=&quot;#Service-Application-Project-Layout&quot; class=&quot;headerlink&quot; title=&quot;Service Application Project Layout&quot;/&gt;Service Application Project Layout&lt;/h2&gt;&lt;p&gt;åœ¨è¿™ä¸€å°èŠ‚æˆ‘ä»¬ä¼šå…ˆçœ‹åˆ°æ¯›è€å¸ˆåœ¨è¯¾ä¸Šè®²è§£çš„ä»–ä»¬çš„åº”ç”¨ç¨‹åºç›®å½•çš„è¿­ä»£å˜åŒ–ï¼Œç„¶åè¯´ä¸€äº›æˆ‘æœ€åçš„é‡‡ç”¨çš„ç›®å½•ç»“æ„ä»¥åŠé‡Œé¢çš„å–èˆï¼Œå…³äºå…·ä½“æ€ä¹ˆæ¼”è¿›æ¥çš„å½“ä¸­é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬ä¼šåœ¨ Go å·¥ç¨‹åŒ–è¿™ä¸ªç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« è¯¦ç»†è¯´æ˜ã€‚&lt;/p&gt;&lt;h3 id=&quot;api&quot;&gt;&lt;a href=&quot;#api&quot; class=&quot;headerlink&quot; title=&quot;/api&quot;/&gt;/api&lt;/h3&gt;&lt;p&gt;API å®šä¹‰çš„ç›®å½•ï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯ grpc é‚£è¿™é‡Œé¢ä¸€èˆ¬æ”¾çš„å°±æ˜¯ proto æ–‡ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ä¹Ÿæœ‰å¯èƒ½æ˜¯ openapi/swagger å®šä¹‰æ–‡ä»¶ï¼Œä»¥åŠä»–ä»¬ç”Ÿæˆçš„æ–‡ä»¶ã€‚&lt;/p&gt;&lt;p&gt;ä¸‹é¢ç»™å‡ºä¸€ä¸ªæˆ‘ç°åœ¨ä½¿ç”¨çš„ api ç›®å½•çš„å®šä¹‰ï¼Œå…¶å®å’Œæ¯›è€å¸ˆè¯¾ä¸Šè®²çš„ç±»ä¼¼ï¼Œåé¢è¿˜æœ‰ä¸€ç¯‡æ–‡ç« ä¼šä¸“é—¨è®² api çš„è®¾è®¡ä¼šè®²åˆ°è¿™é‡Œå°±ä¸è¯¦ç»†è®²äº†&lt;/p&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;.&lt;br/&gt;â””â”€â”€ api&lt;br/&gt;    â””â”€â”€ product_name &lt;span class=&quot;hljs-comment&quot;&gt;// äº§å“åç§°&lt;/span&gt;&lt;br/&gt;        â””â”€â”€ app_name &lt;span class=&quot;hljs-comment&quot;&gt;// åº”ç”¨åç§°&lt;/span&gt;&lt;br/&gt;            â””â”€â”€ v1   &lt;span class=&quot;hljs-comment&quot;&gt;// ç‰ˆæœ¬å·&lt;/span&gt;&lt;br/&gt;                â””â”€â”€ v1.proto&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;config-s&quot;&gt;&lt;a href=&quot;#config-s&quot; class=&quot;headerlink&quot; title=&quot;/config(s)&quot;/&gt;/config(s)&lt;/h3&gt;&lt;p&gt;ä¸ºä»€ä¹ˆåŠ ä¸ª(s) æ˜¯è¯¾ä¸Šè®²çš„è¿˜æœ‰å‚è€ƒææ–™ä¸­å¾ˆå¤šéƒ½å« configs ä½†æ˜¯æˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨ config ä½†æ˜¯å«ä¹‰ä¸Šéƒ½æ˜¯ä¸€æ ·çš„&lt;br/&gt;è¿™é‡Œé¢ä¸€èˆ¬æ”¾ç½®é…ç½®æ–‡ä»¶æ–‡ä»¶å’Œé»˜è®¤æ¨¡æ¿&lt;/p&gt;&lt;h3 id=&quot;test&quot;&gt;&lt;a href=&quot;#test&quot; class=&quot;headerlink&quot; title=&quot;/test&quot;/&gt;/test&lt;/h3&gt;&lt;p&gt;é¢å¤–çš„å¤–éƒ¨æµ‹è¯•åº”ç”¨ç¨‹åºå’Œæµ‹è¯•æ•°æ®ã€‚ä¸€èˆ¬ä¼šæ”¾æµ‹è¯•ä¸€äº›è¾…åŠ©æ–¹æ³•å’Œæµ‹è¯•æ•°æ®&lt;/p&gt;&lt;h3 id=&quot;æœåŠ¡ç±»å‹&quot;&gt;&lt;a href=&quot;#æœåŠ¡ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;æœåŠ¡ç±»å‹&quot;/&gt;æœåŠ¡ç±»å‹&lt;/h3&gt;&lt;p&gt;å¾®æœåŠ¡ä¸­çš„ app æœåŠ¡ç±»å‹åˆ†ä¸º 4 ç±»ï¼šinterfaceã€serviceã€jobã€adminã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;interface: å¯¹å¤–çš„ BFF æœåŠ¡ï¼Œæ¥å—æ¥è‡ªç”¨æˆ·çš„è¯·æ±‚ï¼Œæ¯”å¦‚æš´éœ²äº† HTTP/gRPC æ¥å£ã€‚&lt;/li&gt;&lt;li&gt;service: å¯¹å†…çš„å¾®æœåŠ¡ï¼Œä»…æ¥å—æ¥è‡ªå†…éƒ¨å…¶ä»–æœåŠ¡æˆ–è€…ç½‘å…³çš„è¯·æ±‚ï¼Œæ¯”å¦‚æš´éœ²äº† gRPC æ¥å£åªå¯¹å†…æœåŠ¡ã€‚&lt;/li&gt;&lt;li&gt;adminï¼šåŒºåˆ«äº serviceï¼Œæ›´å¤šæ˜¯é¢å‘è¿è¥æµ‹çš„æœåŠ¡ï¼Œé€šå¸¸æ•°æ®æƒé™æ›´é«˜ï¼Œéš”ç¦»å¸¦æ¥æ›´å¥½çš„ä»£ç çº§åˆ«å®‰å…¨ã€‚&lt;/li&gt;&lt;li&gt;job: æµå¼ä»»åŠ¡å¤„ç†çš„æœåŠ¡ï¼Œä¸Šæ¸¸ä¸€èˆ¬ä¾èµ– message brokerã€‚&lt;/li&gt;&lt;li&gt;task: å®šæ—¶ä»»åŠ¡ï¼Œç±»ä¼¼ cronjobï¼Œéƒ¨ç½²åˆ° task æ‰˜ç®¡å¹³å°ä¸­ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://lailin.xyz/images/1612614638378-d00b94ac-f743-414e-bca2-b9d941da7902.png&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;image.png&quot;/&gt;&lt;br/&gt;è¿™ä¸Šé¢æ˜¯æ¯›è€å¸ˆè¯¾ä¸Šè®²è§£çš„ç±»å‹ï¼Œå’Œæˆ‘ä»¬å¸¸ç”¨çš„åšæ³•ç±»ä¼¼ï¼Œä½†æ˜¯æœ‰ç‚¹åŒºåˆ«ï¼ŒåŒæ ·å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨å« &lt;code&gt;myapp&lt;/code&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;myapp-api: è¿™ä¸ªæ˜¯å¯¹å¤–æš´éœ²çš„ api çš„æœåŠ¡ï¼Œå¯ä»¥æ˜¯ http, ä¹Ÿå¯ä»¥æ˜¯ grpc&lt;/li&gt;&lt;li&gt;myapp-cron: è¿™ä¸ªæ˜¯å®šæ—¶ä»»åŠ¡&lt;/li&gt;&lt;li&gt;myapp-job: è¿™ä¸ªç”¨äºå¤„ç†æ¥è‡ª message çš„æµå¼ä»»åŠ¡&lt;/li&gt;&lt;li&gt;myapp-migration: æ•°æ®åº“è¿ç§»ä»»åŠ¡ï¼Œç”¨äºåˆå§‹åŒ–æ•°æ®åº“&lt;/li&gt;&lt;li&gt;scripts/xxx: ä¸€æ¬¡æ€§æ‰§è¡Œçš„è„šæœ¬ï¼Œæœ‰æ—¶å€™ä¼šæœ‰ä¸€äº›è„šæœ¬ä»»åŠ¡&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¤§å¤šå¤§åŒå°å¼‚ï¼Œä¸»è¦æ˜¯ BFF å±‚æˆ‘ä»¬ä¸€èˆ¬æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œä¸ä¼šæ”¾åœ¨åŒä¸€ä¸ªä»“åº“é‡Œé¢ï¼Œ&lt;/p&gt;&lt;h3 id=&quot;é¡¹ç›®å¸ƒå±€-v1&quot;&gt;&lt;a href=&quot;#é¡¹ç›®å¸ƒå±€-v1&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®å¸ƒå±€ v1&quot;/&gt;é¡¹ç›®å¸ƒå±€ v1&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://lailin.xyz/images/1612615089844-dfc6a101-710e-42e4-983f-ea340676b5f4.png&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;image.png&quot;/&gt;&lt;br/&gt;é¡¹ç›®çš„ä¾èµ–è·¯å¾„ä¸º: model -&amp;gt; dao -&amp;gt; service -&amp;gt; apiï¼Œmodel struct ä¸²è”å„ä¸ªå±‚ï¼Œç›´åˆ° api éœ€è¦åš DTO å¯¹è±¡è½¬æ¢ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;model: æ”¾å¯¹åº”â€œå­˜å‚¨å±‚â€çš„ç»“æ„ä½“ï¼Œæ˜¯å¯¹å­˜å‚¨çš„ä¸€ä¸€éšå°„ã€‚&lt;/li&gt;&lt;li&gt;dao: æ•°æ®è¯»å†™å±‚ï¼Œæ•°æ®åº“å’Œç¼“å­˜å…¨éƒ¨åœ¨è¿™å±‚ç»Ÿä¸€å¤„ç†ï¼ŒåŒ…æ‹¬ cache miss å¤„ç†ã€‚&lt;/li&gt;&lt;li&gt;service: ç»„åˆå„ç§æ•°æ®è®¿é—®æ¥æ„å»ºä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;&lt;li&gt;server: ä¾èµ– proto å®šä¹‰çš„æœåŠ¡ä½œä¸ºå…¥å‚ï¼Œæä¾›å¿«æ·çš„å¯åŠ¨æœåŠ¡å…¨å±€æ–¹æ³•ã€‚&lt;/li&gt;&lt;li&gt;api: å®šä¹‰äº† API proto æ–‡ä»¶ï¼Œå’Œç”Ÿæˆçš„ stub ä»£ç ï¼Œå®ƒç”Ÿæˆçš„ interfaceï¼Œå…¶å®ç°è€…åœ¨ service ä¸­ã€‚&lt;/li&gt;&lt;li&gt;service çš„æ–¹æ³•ç­¾åå› ä¸ºå®ç°äº† API çš„ æ¥å£å®šä¹‰ï¼ŒDTO ç›´æ¥åœ¨ä¸šåŠ¡é€»è¾‘å±‚ç›´æ¥ä½¿ç”¨äº†ï¼Œæ›´æœ‰ dao ç›´æ¥ä½¿ç”¨ï¼Œæœ€ç®€åŒ–ä»£ç ã€‚&lt;/li&gt;&lt;li&gt;DO(Domain Object): é¢†åŸŸå¯¹è±¡ï¼Œå°±æ˜¯ä»ç°å®ä¸–ç•Œä¸­æŠ½è±¡å‡ºæ¥çš„æœ‰å½¢æˆ–æ— å½¢çš„ä¸šåŠ¡å®ä½“ã€‚ç¼ºä¹ DTO -&amp;gt; DO çš„å¯¹è±¡è½¬æ¢ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;v1-å­˜åœ¨çš„é—®é¢˜&quot;&gt;&lt;a href=&quot;#v1-å­˜åœ¨çš„é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;v1 å­˜åœ¨çš„é—®é¢˜&quot;/&gt;v1 å­˜åœ¨çš„é—®é¢˜&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;æ²¡æœ‰ DTO å¯¹è±¡ï¼Œmodel ä¸­çš„å¯¹è±¡è´¯ç©¿å…¨å±€ï¼Œæ‰€æœ‰å±‚éƒ½æœ‰&lt;ul&gt;&lt;li&gt;model å±‚çš„æ•°æ®ä¸æ˜¯æ¯ä¸ªæ¥å£éƒ½éœ€è¦çš„ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæœ‰ä¸€äº›é—®é¢˜&lt;/li&gt;&lt;li&gt;åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­å…¶å®ä¹Ÿåå¤æåˆ°äº† â€œå¦‚æœä¸¤æ®µçœ‹ä¼¼é‡å¤çš„ä»£ç ï¼Œå¦‚æœæœ‰ä¸åŒçš„å˜æ›´é€Ÿç‡å’ŒåŸå› ï¼Œé‚£ä¹ˆè¿™ä¸¤æ®µä»£ç å°±ä¸ç®—æ˜¯çœŸæ­£çš„é‡å¤â€&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;server å±‚çš„ä»£ç å¯ä»¥é€šè¿‡åŸºç¡€åº“å¹²æ‰ï¼Œæä¾›ç»Ÿä¸€æœåŠ¡æš´éœ²æ–¹å¼&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;é¡¹ç›®å¸ƒå±€-v2&quot;&gt;&lt;a href=&quot;#é¡¹ç›®å¸ƒå±€-v2&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®å¸ƒå±€ v2&quot;/&gt;é¡¹ç›®å¸ƒå±€ v2&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://lailin.xyz/images/1612615164024-9156a848-53f7-4324-963a-e7e4ae110424.png&quot; srcset=&quot;/img/loading.gif&quot; alt=&quot;image.png&quot;/&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;app ç›®å½•ä¸‹æœ‰ apiã€cmdã€configsã€internal ç›®å½•ï¼Œç›®å½•é‡Œä¸€èˆ¬è¿˜ä¼šæ”¾ç½® READMEã€CHANGELOGã€OWNERSã€‚&lt;/li&gt;&lt;li&gt;&lt;strong&gt;internal:&lt;/strong&gt; æ˜¯ä¸ºäº†é¿å…æœ‰åŒä¸šåŠ¡ä¸‹æœ‰äººè·¨ç›®å½•å¼•ç”¨äº†å†…éƒ¨çš„ bizã€dataã€service ç­‰å†…éƒ¨ structã€‚&lt;ul&gt;&lt;li&gt;å¦‚æœå­˜åœ¨ä¸€ä¸ªä»“åº“å¤šä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ internal é‡Œé¢è¿›è¡Œåˆ†å±‚ï¼Œä¾‹å¦‚ &lt;code&gt;/internal/app&lt;/code&gt; , &lt;code&gt;/internal/job&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;strong&gt;biz&lt;/strong&gt;: ä¸šåŠ¡é€»è¾‘çš„ç»„è£…å±‚ï¼Œç±»ä¼¼ DDD çš„ domain å±‚ï¼Œdata ç±»ä¼¼ DDD çš„ repoï¼Œrepo æ¥å£åœ¨è¿™é‡Œå®šä¹‰ï¼Œä½¿ç”¨ä¾èµ–å€’ç½®çš„åŸåˆ™ã€‚&lt;/li&gt;&lt;li&gt;&lt;strong&gt;data&lt;/strong&gt;: ä¸šåŠ¡æ•°æ®è®¿é—®ï¼ŒåŒ…å« cacheã€db ç­‰å°è£…ï¼Œå®ç°äº† biz çš„ repo æ¥å£ã€‚æˆ‘ä»¬å¯èƒ½ä¼šæŠŠ data ä¸ dao æ··æ·†åœ¨ä¸€èµ·ï¼Œdata åé‡ä¸šåŠ¡çš„å«ä¹‰ï¼Œå®ƒæ‰€è¦åšçš„æ˜¯å°†é¢†åŸŸå¯¹è±¡é‡æ–°æ‹¿å‡ºæ¥ï¼Œæˆ‘ä»¬å»æ‰äº† DDD çš„ infra å±‚ã€‚&lt;/li&gt;&lt;li&gt;&lt;strong&gt;service&lt;/strong&gt;: å®ç°äº† api å®šä¹‰çš„æœåŠ¡å±‚ï¼Œç±»ä¼¼ DDD çš„ application å±‚ï¼Œå¤„ç† DTO åˆ° biz é¢†åŸŸå®ä½“çš„è½¬æ¢(DTO -&amp;gt; DO)ï¼ŒåŒæ—¶ååŒå„ç±» biz äº¤äº’ï¼Œä½†æ˜¯ä¸åº”å¤„ç†å¤æ‚é€»è¾‘ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;PO(Persistent Object): æŒä¹…åŒ–å¯¹è±¡ï¼Œå®ƒè·ŸæŒä¹…å±‚ï¼ˆé€šå¸¸æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼‰çš„æ•°æ®ç»“æ„å½¢æˆä¸€ä¸€å¯¹åº”çš„æ˜ å°„å…³ç³»ï¼Œå¦‚æœæŒä¹…å±‚æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œé‚£ä¹ˆæ•°æ®è¡¨ä¸­çš„æ¯ä¸ªå­—æ®µï¼ˆæˆ–è‹¥å¹²ä¸ªï¼‰å°±å¯¹åº” PO çš„ä¸€ä¸ªï¼ˆæˆ–è‹¥å¹²ä¸ªï¼‰å±æ€§ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ç¤ºä¾‹å¯ä»¥å‚è€ƒ &lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/go-kratos/examples/tree/main/blog&quot;&gt;kratos v2 çš„ example&lt;/a&gt;&lt;/p&gt;&lt;h3 id=&quot;æˆ‘çš„é¡¹ç›®å¸ƒå±€&quot;&gt;&lt;a href=&quot;#æˆ‘çš„é¡¹ç›®å¸ƒå±€&quot; class=&quot;headerlink&quot; title=&quot;æˆ‘çš„é¡¹ç›®å¸ƒå±€&quot;/&gt;æˆ‘çš„é¡¹ç›®å¸ƒå±€&lt;/h3&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br/&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;.&lt;br/&gt;â”œâ”€â”€ api&lt;br/&gt;â”œâ”€â”€ cmd&lt;br/&gt;â”‚   â””â”€â”€ app&lt;br/&gt;â”œâ”€â”€ config&lt;br/&gt;â”œâ”€â”€ internal&lt;br/&gt;â”‚   â”œâ”€â”€ domain&lt;br/&gt;â”‚   â”œâ”€â”€ repo&lt;br/&gt;â”‚   â”œâ”€â”€ service&lt;br/&gt;â”‚   â””â”€â”€ usecase&lt;br/&gt;â””â”€â”€ pkg&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;internal:&lt;/strong&gt; æ˜¯ä¸ºäº†é¿å…æœ‰åŒä¸šåŠ¡ä¸‹æœ‰äººè·¨ç›®å½•å¼•ç”¨äº†å†…éƒ¨çš„å¯¹è±¡&lt;/p&gt;&lt;h2 id=&quot;åº”è¯¥é¿å…çš„åä¹ æƒ¯&quot;&gt;&lt;a href=&quot;#åº”è¯¥é¿å…çš„åä¹ æƒ¯&quot; class=&quot;headerlink&quot; title=&quot;åº”è¯¥é¿å…çš„åä¹ æƒ¯&quot;/&gt;åº”è¯¥é¿å…çš„åä¹ æƒ¯&lt;/h2&gt;&lt;h3 id=&quot;src&quot;&gt;&lt;a href=&quot;#src&quot; class=&quot;headerlink&quot; title=&quot;/src&quot;/&gt;/src&lt;/h3&gt;&lt;p&gt;ä¸€èˆ¬è€Œè¨€ï¼Œåœ¨ Go é¡¹ç›®å½“ä¸­ä¸åº”è¯¥å‡ºç° src ç›®å½•ï¼ŒGo å’Œ Java ä¸åŒï¼Œåœ¨ Go ä¸­æ¯ä¸€ä¸ªç›®å½•éƒ½æ˜¯ä¸€ä¸ªåŒ…ï¼Œæ¯ä¸€ä¸ªåŒ…éƒ½æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œæˆ‘ä»¬ä¸éœ€è¦å°†é¡¹ç›®ä»£ç æ”¾åˆ° src å½“ä¸­ï¼Œä¸è¦ç”¨å†™å…¶ä»–è¯­è¨€çš„æ–¹å¼æ¥å†™ Go&lt;/p&gt;&lt;h3 id=&quot;utilsï¼Œcommon&quot;&gt;&lt;a href=&quot;#utilsï¼Œcommon&quot; class=&quot;headerlink&quot; title=&quot;utilsï¼Œcommon&quot;/&gt;utilsï¼Œcommon&lt;/h3&gt;&lt;p&gt;ä¸è¦åœ¨é¡¹ç›®ä¸­å‡ºç° utils å’Œ common è¿™ç§åŒ…ï¼Œå¦‚æœå‡ºç°è¿™ç§åŒ…ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸èƒ½ä»åŒ…ä¸­çŸ¥é“ä½ è¿™ä¸ªåŒ…çš„ä½œç”¨ï¼Œé•¿ä¹…ä¹‹åè¿™ä¸ªåŒ…å°±ä¼šå˜æˆä¸€ä¸ªå¤§æ‚çƒ©ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½å¾€è¿™é‡Œé¢æ‰”ã€‚&lt;br/&gt;æœ‰çš„åŒå­¦è¿™ä¸ªæ—¶å€™ä¼šé—®è¯´ï¼Œé‚£æˆ‘ä»¬çš„å·¥å…·å‡½æ•°åº”è¯¥æ”¾åˆ°å“ªé‡Œï¼Ÿæ€ä¹ˆæ”¾ï¼Ÿ&lt;br/&gt;ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å½“å‰ä½¿ç”¨ &lt;code&gt;gin&lt;/code&gt; ä½œä¸ºè·¯ç”±æ¡†æ¶ï¼Œä½†æ˜¯ &lt;code&gt;gin&lt;/code&gt; çš„ handler æ³¨å†Œå…¶å®ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬åšäº†ä¸€å±‚å°è£…ï¼Œè¿™ä¸ªæ—¶å€™è¿™ä¸ªå·¥å…·æ–¹æ³•æˆ‘ä»¬ä¸€èˆ¬æ”¾åœ¨ &lt;code&gt;/pkg/ginx&lt;/code&gt; ç›®å½•ä¸‹ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯å¯¹ &lt;code&gt;gin&lt;/code&gt; å¢å¼ºçš„åŒ…ï¼Œä¸ç›´æ¥ä½¿ç”¨ &lt;code&gt;gin&lt;/code&gt; ä½œä¸ºåŒ…åçš„åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä¹Ÿä¼šå¼•ç”¨ &lt;code&gt;gin&lt;/code&gt; ç›¸åŒçš„å‘½åä¸€ä¸ªæ˜¯ä¼šå¯¼è‡´è¯¯è§£ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨åŒæ—¶å¯¼å…¥çš„æ—¶å€™ä¹Ÿä¼šéœ€è¦å»è¿›è¡Œé‡å‘½åä¼šæ¯”è¾ƒéº»çƒ¦&lt;/p&gt;&lt;h2 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;/&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;å…³äºé¡¹ç›®ç›®å½•ç»“æ„è¿™ç§çœŸçš„ç®—æ˜¯è§ä»è§æ™ºï¼Œä¸åŒçš„ç†è®ºæœ‰ä¸åŒçš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æœ‰ä¸¤ä»¶äº‹æ¯”è¾ƒé‡è¦ï¼Œå°±æœåŠ¡åº”ç”¨è€Œè¨€éœ€è¦çµæ´»åº”ç”¨ï¼Œå°±åŸºç¡€åº“è€Œè¨€ä¸€å®šè¦ç»Ÿä¸€ï¼Œåšçš„å¥½ä¸å¥½å’Œè¦ä¸è¦åšæ˜¯ä¸¤ä»¶äº‹æƒ…ï¼Œå¦‚æœå› ä¸ºå½“å‰åšçš„ä¸å¤Ÿå¥½è€Œä¸åšï¼Œé‚£ä¹ˆè¶Šåˆ°åé¢å°±è¶Šåšä¸äº†ã€‚&lt;br/&gt;ä¸‹ä¸€ç¯‡æ–‡ç« ä¼šè®²ä¸€è®²ä¾èµ–æ³¨å…¥æ¡†æ¶ wire çš„ä½¿ç”¨ä¸æœ€ä½³(?)å®è·µ&lt;/p&gt;&lt;h2 id=&quot;å‚è€ƒæ–‡çŒ®&quot;&gt;&lt;a href=&quot;#å‚è€ƒæ–‡çŒ®&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒæ–‡çŒ®&quot;/&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;&lt;ol&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://u.geekbang.org/subject/go?utm_source=lailin.xyz&amp;amp;utm_medium=lailin.xyz&quot;&gt;Go è¿›é˜¶è®­ç»ƒè¥-æå®¢æ—¶é—´&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/golang-standards/project-layout/blob/master/README_zh.md&quot;&gt;golang-standards/project-layout Â· GitHub&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://www.ardanlabs.com/blog/2017/02/package-oriented-design.html&quot;&gt;Package Oriented Design&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://golang.org/doc/go1.4#internalpackages&quot;&gt;Go 1.4 Release Notes - The Go Programming Language&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://travisjeffery.com/b/2019/11/i-ll-take-pkg-over-internal/&quot;&gt;Iâ€™ll take pkg over internal&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1&quot;&gt;https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h2 id=&quot;å…³æ³¨æˆ‘è·å–æ›´æ–°&quot;&gt;&lt;a href=&quot;#å…³æ³¨æˆ‘è·å–æ›´æ–°&quot; class=&quot;headerlink&quot; title=&quot;å…³æ³¨æˆ‘è·å–æ›´æ–°&quot;/&gt;å…³æ³¨æˆ‘è·å–æ›´æ–°&lt;/h2&gt;&lt;p&gt;çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://lailin.xyz&quot;&gt;åšå®¢&lt;/a&gt; å¯ä»¥è®¢é˜… RSSï¼Œä¹Ÿå¯ä»¥ç‚¹å‡»é¦–é¡µé€šè¿‡ webpush è®¢é˜…æµè§ˆå™¨æ¶ˆæ¯&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://github.com/mohuishou&quot;&gt;Github&lt;/a&gt; Follow me&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://www.zhihu.com/people/mo-hui-shou-76&quot;&gt;çŸ¥ä¹&lt;/a&gt; å…³æ³¨è´¦å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘&lt;/li&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;https://toutiao.io/subjects/387401?f=new&quot;&gt;å¼€å‘è€…å¤´æ¡&lt;/a&gt; è®¢é˜…è®¢é˜…å·ï¼Œé¡ºä¾¿ç‚¹ä¸ª ğŸ‘&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f1ab739fd37e62813103eaa50b813d5f</guid>
<title>å…¬å¸å†…Uç›˜ä¸èƒ½å†™å…¥çš„è§£å†³æ–¹æ¡ˆ</title>
<link>https://toutiao.io/k/55xb950</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;article class=&quot;markdown-body mt-4&quot;&gt;
        &lt;h3 id=&quot;ä¸€èƒŒæ™¯&quot;&gt;ä¸€ã€èƒŒæ™¯&lt;/h3&gt;
&lt;p&gt;å› ä¸ºå®‰å…¨åŸå› ï¼Œå…¬å¸çš„ç”µè„‘å®‰è£…äº†å®‰å…¨è½¯ä»¶ï¼Œå¼€å¯å¯åŠ¨åå°±æŠŠUç›˜å†™æƒé™å…³é—­äº†ï¼Œåšä¸»é•¿æœŸæŒ‚è½½ç§»åŠ¨ç¡¬ç›˜ä½¿ç”¨ï¼Œå¯¹æ—¥å¸¸ä½¿ç”¨é€ æˆå¾ˆå¤§å›°æ‰°ã€‚æœ¬æ–‡æä¾›ä¸¤ç§æ€è·¯ï¼Œå¯å®ç°å…¬å¸å†…ç”µè„‘Uç›˜çš„è¯»å†™ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šæœ¬æ–‡åªé’ˆå¯¹windowsã€‚&lt;/p&gt;
&lt;h3 id=&quot;äºŒæ–¹æ³•1æ‰‹åŠ¨ä¿®æ”¹æœ¬åœ°ç»„ç­–ç•¥&quot;&gt;äºŒã€æ–¹æ³•1ï¼šæ‰‹åŠ¨ä¿®æ”¹æœ¬åœ°ç»„ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;ç‚¹å‡»windowsé”®ï¼Œè¾“å…¥gpedit.mscï¼Œæ‰“å¼€æœ¬åœ°ç»„ç­–ç•¥ç¼–è¾‘å™¨ï¼Œä¾æ¬¡æ‰¾åˆ°ï¼šè®¡ç®—æœºé…ç½®--&amp;gt; ç®¡ç†æ¨¡æ¿ --&amp;gt; ç³»ç»Ÿ --&amp;gt; å¯ç§»åŠ¨å­˜å‚¨è®¿é—®ã€‚æ‰¾åˆ°ï¼šå¯ç§»åŠ¨ç£ç›˜:æ‹’ç»å†™å…¥æƒé™ï¼Œå¦‚æœæ˜¯å·²å¼€å¯çŠ¶æ€ï¼Œåˆ™ç¼–è¾‘æ”¹ä¸ºæœªé…ç½®æˆ–å·²ç¦ç”¨å³å¯å®ç°Uç›˜å†™å…¥ã€‚å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼ŒæŠŠUç›˜æ‹”æ‰é‡æ–°æ’å…¥å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://blogpic.chekuspace.com/image-20210208161208393.png&quot; alt=&quot;image-20210208161208393&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;ä¸‰æ–¹æ³•2è™šæ‹Ÿå™¨æ˜ å°„smbè¿œç¨‹è®¿é—®&quot;&gt;ä¸‰ã€æ–¹æ³•2ï¼šè™šæ‹Ÿå™¨æ˜ å°„smbè¿œç¨‹è®¿é—®&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢æ–¹æ³•1å¯¹äºä¸´æ—¶å†™å…¥å¤Ÿç”¨äº†ï¼Œ å¦‚æœæƒ³æŒ‚è½½Uç›˜æˆ–ç§»åŠ¨ç¡¬ç›˜é•¿æœŸä½¿ç”¨ï¼Œæ¯æ¬¡å¼€æœºå¯åŠ¨éƒ½è¦é‡æ–°é…ç½®ä¸€éï¼Œå¾ˆæ˜¯éº»çƒ¦ã€‚ç”±äºå…¬å¸å†…å®‰å…¨è½¯ä»¶æ˜¯ç®¡ç†å‘˜æƒé™å¼€å¯å¯åŠ¨ï¼Œä¸èƒ½é˜»æ­¢å®ƒå°†æœ¬åœ°ç»„ç­–ç•¥ä¸­çš„å¯ç§»åŠ¨ç£ç›˜:æ‹’ç»å†™å…¥æƒé™ç»™å¼€å¯ã€‚é‚£æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ç»•è¿‡è¿™ä¸ªæƒé™å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”æ¡ˆå°±æ˜¯è™šæ‹Ÿæœºï¼Œå¼€æœºå¯åŠ¨æ—¶æŠŠUç›˜æŒ‚è½½åˆ°è™šæ‹Ÿä¸­ï¼Œç„¶åå…±äº«sambaç»™å®¿ä¸»æœºï¼Œå¼€å¯è¯»å†™æƒé™ï¼Œå®¿ä¸»æœºå°±å¯ä»¥æ­£å¸¸è¯»å†™Uç›˜ä¸­çš„å†…å®¹äº†ã€‚&lt;/p&gt;
&lt;p&gt;åšä¸»å®‰è£…çš„æ˜¯VirtualBoxè™šæ‹Ÿæœºã€‚ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯å®‰è£…è½¯ä»¶åŠç³»ç»Ÿï¼Œæ¨èå®‰è£…debianæœ€å°é•œåƒï¼Œå› ä¸ºè¿™ä¸ªé•œåƒåŒ…å°è€Œä¸”å®‰å…¨æ€§é«˜ã€‚æ“ä½œä¹ æƒ¯å’ŒUbuntuä¸€æ ·ï¼Œè¯¦ç»†å®‰è£…è¿‡ç¨‹åŠç½‘ç»œé…ç½®è¯·å‚è€ƒå…¶ä»–æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h5 id=&quot;1å®‰è£…virtualboxæ‰©å±•å¯ç”¨usb30æ”¯æŒ&quot;&gt;1ã€å®‰è£…VirtualBoxæ‰©å±•ï¼Œå¯ç”¨USB3.0æ”¯æŒã€‚&lt;/h5&gt;
&lt;p&gt;é»˜è®¤VirtualBoxæ˜¯ä¸æ”¯æŒUSB3.0çš„ï¼Œéœ€è¦å®‰è£…æ‰©å±•æ‰èƒ½æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½å®˜ç½‘é“¾æ¥: &lt;a href=&quot;https://www.virtualbox.org/wiki/Downloads&quot;&gt;https://www.virtualbox.org/wiki/Downloads&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¯¦ç»†ä¸‹è½½æ•™ç¨‹è¯·å‚è€ƒï¼š&lt;a href=&quot;https://blog.csdn.net/qzhn_/article/details/86365917&quot;&gt;https://blog.csdn.net/qzhn_/article/details/86365917&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…æ‰©å±•åŒ…æ•™ç¨‹å‚è€ƒï¼š&lt;a href=&quot;https://jingyan.baidu.com/article/3052f5a1b2dd39d6f21f862d.html&quot;&gt;https://jingyan.baidu.com/article/3052f5a1b2dd39d6f21f862d.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…å®Œæˆï¼Œæ‰“å¼€è™šæ‹ŸæœºUSBè®¾å¤‡é…ç½®ï¼Œå‡ºç°USB3.0å³è¡¨ç¤ºå®‰è£…æˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://blogpic.chekuspace.com/image-20210208163042492.png&quot; alt=&quot;image-20210208163042492&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;2æŒ‚è½½uç›˜åˆ°è™šæ‹Ÿæœº&quot;&gt;2ã€æŒ‚è½½Uç›˜åˆ°è™šæ‹Ÿæœº&lt;/h5&gt;
&lt;p&gt;è™šæ‹Ÿæœºå…³æœºï¼Œæ‰“å¼€é…ç½®ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ·»åŠ USBè®¾å¤‡ï¼ŒUSBæ§åˆ¶å™¨é€‰æ‹©USB3.0ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://blogpic.chekuspace.com/image-20210208163408809.png&quot; alt=&quot;image-20210208163408809&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯åŠ¨è™šæ‹Ÿæœºï¼Œè¾“å…¥å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo fdisk -l
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‡ºç°ç¡¬ç›˜å³ä¸ºæ˜ å°„æˆåŠŸï¼Œè®°ä½çº¢æ¡†ä¸­çš„Deviceåç§°&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://blogpic.chekuspace.com/image-20210208163231638.png&quot; alt=&quot;image-20210208163231638&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;3é…ç½®è™šæ‹Ÿæœºå¯åŠ¨æŒ‚è½½&quot;&gt;3ã€é…ç½®è™šæ‹Ÿæœºå¯åŠ¨æŒ‚è½½&lt;/h5&gt;
&lt;p&gt;é»˜è®¤ç¡¬ç›˜æ˜¯ä¸ä¼šè‡ªåŠ¨æŒ‚è½½çš„ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆ1ï¼‰å®‰è£…é©±åŠ¨ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo apt-get install ntfs-3g
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(2) ç¼–è¾‘/etc/fstab, å†æœ«å°¾åŠ å…¥å¦‚ä¸‹å†…å®¹å°±å¯ä»¥äº†ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„é…ç½®&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/dev/sdb1       /mnt/move       ntfs-3g defaults,locale=zh_CN.UTF-8     0       0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é‡å¯è™šæ‹Ÿæœºï¼ŒæŸ¥çœ‹/mnt/moveç›®å½•ï¼Œçœ‹æ˜¯ä¸æ˜¯æ­£ç¡®åˆ—å‡ºUç›˜ä¸­çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h5 id=&quot;3é…ç½®samba&quot;&gt;3ã€é…ç½®samba&lt;/h5&gt;
&lt;p&gt;Linuxä¸­å®‰è£…sambaé…ç½®é¡¹å¾ˆå¤šï¼Œä¸€ä¸å°å¿ƒå°±é…ç½®ä¸å¯¹ï¼Œè¿™é‡Œæ¨èä½¿ç”¨dockerå®‰è£…sambaï¼Œæˆ‘ä½¿ç”¨æ˜¯çš„è¿™ä¸ªimageï¼š&lt;a href=&quot;https://github.com/dperson/samba&quot;&gt;https://github.com/dperson/samba&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ï¼ˆ1ï¼‰å®‰è£…dockerï¼Œæ¨èä½¿ç”¨å›½å†…daocloudä¸€é”®å®‰è£…å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -sSL https://get.daocloud.io/docker | sh
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ï¼ˆ2ï¼‰dockerå¯åŠ¨sambaï¼Œå¹¶æ”¯æŒå¼€æœºå¯åŠ¨ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo docker run -d \
    --name samba \
    --restart unless-stopped \
    -p 139:139 \
    -p 445:445 \
    -v /mnt/move:/mount \
    -d dperson/samba \
    -u &quot;youusername;yourpassword&quot; \
    -s &quot;ç§»åŠ¨ç¡¬ç›˜;/mount/;yes;no;no;all;yourusername&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°†å‘½ä»¤ä¸­çš„ç”¨æˆ·åå¯†ç æ”¹æˆä½ è‡ªå·±çš„ï¼Œæ‰§è¡Œå¯åŠ¨ï¼Œåœ¨å®¿ä¸»æœºçš„æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­è¾“å…¥ï¼Œ192.168.56.101æ˜¯æˆ‘çš„è™šæ‹Ÿæœºipï¼ŒæŸ¥çœ‹è‡ªå·±çš„è™šæ‹Ÿæœºipä½¿ç”¨å‘½ä»¤ï¼šsudo ifconfig&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;\\192.168.56.101
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æç¤ºå‡ºå…¥ç”¨æˆ·åã€å¯†ç ã€‚è¾“å…¥æ­£ç¡®åè¿›å…¥å¼¹å‡ºæˆ‘ä»¬ç§»åŠ¨ç¡¬ç›˜è¡¨ç¤ºé…ç½®æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://blogpic.chekuspace.com/image-20210208164925982.png&quot; alt=&quot;image-20210208164925982&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åå¯ä»¥å³é”®â€œç§»åŠ¨ç¡¬ç›˜â€ï¼Œæ˜ å°„ç½‘ç»œé©±åŠ¨å™¨ï¼Œå³å¯å½“æˆæœ¬åœ°ç£ç›˜ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h5 id=&quot;4é…ç½®è™šæ‹Ÿæœºå¼€æœºå¯åŠ¨&quot;&gt;4ã€é…ç½®è™šæ‹Ÿæœºå¼€æœºå¯åŠ¨&lt;/h5&gt;
&lt;p&gt;å³å‡»VirtualBoxä¸­çš„è™šæ‹Ÿæœºï¼Œç‚¹å‡»åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://blogpic.chekuspace.com/image-20210208165241154.png&quot; alt=&quot;image-20210208165241154&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ‰“å¼€æ¡Œé¢ï¼Œå³å‡»å¿«æ·æ–¹å¼ï¼Œç‚¹æœ€ä¸‹é¢çš„å±æ€§ï¼Œç¼–è¾‘â€œç›®æ ‡â€æ ï¼Œé…ç½®æˆheadlessæ¨¡å¼ã€‚å³ä¸æ‰“å¼€VirtualBoxï¼Œç›´æ¥æ— ç•Œé¢å¯åŠ¨è™šæ‹Ÿæœºã€‚å°†ä¸‹é¢ä¸­VirtualBoxè·¯å¾„å’Œè™šæ‹ŸæœºIDæ”¹æˆä½ è‡ªå·±çš„ï¼Œå¹¶ä¿å­˜ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&quot;D:\Program Files\Oracle\VirtualBox\VBoxManage.exe&quot; startvm &quot;{7a1f224f-af3f-4850-bc39-20f76d83db83}&quot; --type headless
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ€åä¸€æ­¥ï¼Œå°†æ­¤å¿«æ·æ–¹å¼ç§»åŠ¨åˆ°ï¼Œå³å¯å¼€å¯å¯åŠ¨è™šæ‹Ÿæœºã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;C:\Users\&amp;lt;your name&amp;gt;\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;å››æ€»ç»“&quot;&gt;å››ã€æ€»ç»“&lt;/h3&gt;
&lt;p&gt;æœ¬æ–‡æä¾›äº†ä¸¤ç§è§£å†³å…¬å¸å†…Uç›˜ä¸èƒ½å†™å…¥çš„æ–¹æ³•ï¼Œç¬¬ä¸€ç§é€‚åˆä¸´æ—¶ä½¿ç”¨ï¼Œç¬¬äºŒç§é€‚åˆé•¿æœŸæŒ‚è½½Uç›˜ä½¿ç”¨ã€‚ä½ è¿˜æœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹æ³•å—ï¼Œæ¬¢è¿è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä½œè€…ï¼š&lt;strong&gt;æœ¨å°ä¸°&lt;/strong&gt;ï¼Œç¾å›¢Javaé«˜çº§å·¥ç¨‹å¸ˆï¼Œä¸å®šæœŸåˆ†äº«è½¯ä»¶ç ”å‘è¿‡ç¨‹ä¸­çš„å®è·µã€æ€è€ƒã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://lesofn.com/jie-jue-gong-si-nei-u-pan-bu-neng-xie-ru-de-wen-ti&quot;&gt;https://lesofn.com/jie-jue-gong-si-nei-u-pan-bu-neng-xie-ru-de-wen-ti&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…¬å…±å·ï¼šJavaç ”å‘&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://blogpic.chekuspace.com/%E4%BA%8C%E7%BB%B4%E7%A0%81%E5%B0%8F_1607785087313.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

    &lt;/article&gt;
&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>b3b8e20cca6b893e339f25e7c46d07f1</guid>
<title>é—²é±¼å¦‚ä½•ä¸€æ‹›ä¿è¯æ¨èæµç¨³å¦‚æ³°å±±</title>
<link>https://toutiao.io/k/mmzvygh</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;é—²é±¼æ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹å“ç‰Œï¼Œæ˜¯ä¸­å›½æœ€å¤§çš„é—²ç½®äº¤æ˜“å¹³å°ï¼Œäº2014å¹´æˆç«‹è‡³ä»Šï¼Œæ˜¯ç»§æ·˜å®ã€å¤©çŒ«ä¹‹åï¼Œé˜¿é‡Œå·´å·´æ­£åœ¨å‚¬ç”Ÿçš„ç¬¬ä¸‰ä¸ªä¸‡äº¿çº§å¹³å°ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;é—²é±¼æŠ€æœ¯éƒ¨ä¸æ–­åœ¨é©±åŠ¨ä¸šåŠ¡å˜é©ï¼Œé€šè¿‡åˆ›æ–°è¿½å¯»æ›´å¤šä»·å€¼ã€‚ä»å‡ºç‰ˆä¹¦ç±ã€å³°ä¼šå‘å£°ï¼Œåˆ°å¼€æºä¸“åˆ©ã€æµ·å¤–ä¼ æ’­ã€‚é—²ä¸ä½ï¼Œä¸Šé—²é±¼â€”â€”æŠ€æœ¯å›¢é˜Ÿå¯¹æè‡´çš„æ¢ç´¢ä¸æ·±è€•æ˜¯æˆ‘ä»¬çš„åº•æ°”ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Â ç«‹å³åŠ å…¥Â &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;span&gt;1ã€æ‹›&lt;/span&gt;&lt;span&gt;&lt;strong&gt;é¡¹ç›®ç»ç†PMO&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;/å®¢æˆ·ç«¯/æœåŠ¡ç«¯/å‰ç«¯/æ•°æ®+ç®—æ³•/è´¨é‡å·¥ç¨‹å¸ˆ&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;2ã€å‘ç®€å†ç»™guicai.gxy@alibaba-inc.com&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;3ã€æ‚¨è¿˜å¯ä»¥åœ¨å¤´æ¡ã€çŸ¥ä¹ã€æ˜é‡‘ã€facebookã€twitteræ‰¾åˆ°æˆ‘ä»¬&lt;/span&gt;&lt;/p&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>ac851d13a3b8f22ccb454d85007648a8</guid>
<title>C++ folly åº“è§£è¯»ä¹‹ Fbstringï¼šä¸€ä¸ªå®Œç¾æ›¿ä»£ std::string çš„åº“ï¼ˆä¸Šï¼‰</title>
<link>https://toutiao.io/k/uftea8o</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; data-website=&quot;https://www.mdnice.com&quot;&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;string å¸¸è§çš„ä¸‰ç§å®ç°æ–¹å¼&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;Fbstring ä»‹ç»&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Storage strategies&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Implementation highlights&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Benchmark&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;ä¸»è¦ç±»&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;å­—ç¬¦ä¸²å­˜å‚¨æ•°æ®ç»“æ„&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;small strings&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;medium strings&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;large strings&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;å¦‚ä½•åŒºåˆ†å­—ç¬¦ä¸²ç±»å‹ category&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å°ç«¯&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¤§ç«¯&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;small strings&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;medium strings&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;large strings&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;category()&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;capacity()&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;size()&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;&lt;p&gt;å­—ç¬¦ä¸²åˆå§‹åŒ–&lt;/p&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;initSmall&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;initMedium&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;initLarge&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ç‰¹æ®Šçš„æ„é€ å‡½æ•° â€”â€” ä¸æ‹·è´ç”¨æˆ·ä¼ å…¥çš„å­—ç¬¦ä¸²&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨å¼•å…¥&lt;span&gt;fbstring&lt;/span&gt;&lt;sup&gt;[1]&lt;/sup&gt;ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå†å›é¡¾ä¸€ä¸‹ string å¸¸è§çš„ä¸‰ç§å®ç°æ–¹å¼ã€‚&lt;/p&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;string å¸¸è§çš„ä¸‰ç§å®ç°æ–¹å¼&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;string ä¸­æ¯”è¾ƒé‡è¦çš„ 3 ä¸ªå­—æ®µï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;char *data. æŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²çš„é¦–åœ°å€ï¼ˆåœ¨ SSO çš„æŸäº›å®ç°æ–¹æ¡ˆä¸­å¯èƒ½æ²¡æœ‰æ­¤å­—æ®µï¼‰ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;size_t size. å­—ç¬¦ä¸²é•¿åº¦ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;size_t capacity. å­—ç¬¦ä¸²å®¹é‡ã€‚capacity &amp;gt;= size. åœ¨å­—ç¬¦ä¸²ç›¸åŠ ã€reserve ç­‰åœºæ™¯ä¸‹ä¼šç”¨åˆ°æ­¤å­—æ®µã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;eager copy&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ªæ˜¯æœ€ç®€å•ã€æœ€å¥½ç†è§£çš„ä¸€ç§ï¼Œåœ¨æ¯æ¬¡æ‹·è´æ—¶å°†åŸ string å¯¹åº”çš„å†…å­˜ä»¥åŠæ‰€æŒæœ‰çš„åŠ¨æ€èµ„æºå®Œæ•´åœ°å¤åˆ¶ä¸€ä»½ï¼Œå³æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå¤„ç†ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.42061855670103093&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93ZmRibpI3oIuqpwUZEpPP1qbfcwlBAz1aV4rCBpdWI7ZVpgpkibatvjAtA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;970&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¼˜ç‚¹ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å®ç°ç®€å•ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ¯ä¸ªå¯¹è±¡äº’ç›¸ç‹¬ç«‹ï¼Œä¸ç”¨è€ƒè™‘é‚£ä¹ˆå¤šä¹±ä¸ƒå…«ç³Ÿçš„åœºæ™¯ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;COW&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ªä¹Ÿç®—æ˜¯è®¡ç®—æœºé‡Œçš„åŸºæœ¬æ€æƒ³äº†ã€‚ä¸åŒäº eager copy çš„æ¯æ¬¡æ‹·è´éƒ½ä¼šå¤åˆ¶ï¼Œæ­¤ç§å®ç°æ–¹å¼ä¸ºå†™æ—¶å¤åˆ¶ï¼Œå³ copy-on-writeã€‚åªæœ‰åœ¨æŸä¸ª string è¦å¯¹å…±äº«å¯¹è±¡è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæ‰ä¼šçœŸæ­£æ‰§è¡Œæ‹·è´ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç”±äºå­˜åœ¨å…±äº«æœºåˆ¶ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ª&lt;code&gt;std::atomic&amp;lt;size_t&amp;gt;&lt;/code&gt;ï¼Œä»£è¡¨è¢«å¤šå°‘å¯¹è±¡å…±äº«ã€‚&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93ZMXiaCOXHNefbeE3OibDoEBh198xRaspYYGOsTSkJyibGzw6KibaH0NDVJw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.49074074074074076&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å†™æ—¶å¤åˆ¶ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.684053651266766&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93Z6EuB4hhlb6qWkaoQTBA9c6kJpWfUVLUd8jBuw9aP7RmLMe5CKic9Ntg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1342&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¼˜ç‚¹ï¼š&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;refcount éœ€è¦åŸå­æ“ä½œï¼Œæ€§èƒ½æœ‰æŸè€—ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æŸäº›æƒ…å†µä¸‹ä¼šå¸¦æ¥æ„å¤–çš„å¼€é”€ã€‚æ¯”å¦‚é const æˆå‘˜ä½¿ç”¨&lt;code&gt;[]&lt;/code&gt;ï¼Œè¿™ä¼šè§¦å‘ COWï¼Œå› ä¸ºæ— æ³•çŸ¥æ™“åº”ç”¨ç¨‹åºæ˜¯å¦ä¼šå¯¹è¿”å›çš„å­—ç¬¦åšä¿®æ”¹ã€‚å…¸å‹çš„å¦‚&lt;span&gt;Legality of COW std::string implementation in C++11&lt;/span&gt;&lt;sup&gt;[2]&lt;/sup&gt;ä¸­ä¸¾çš„ä¾‹å­ï¼š&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;std&lt;/span&gt;::&lt;span&gt;string&lt;/span&gt;Â &lt;span&gt;s&lt;/span&gt;&lt;span&gt;(&lt;span&gt;&quot;str&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;char&lt;/span&gt;*Â pÂ =Â s.data();&lt;br/&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;std&lt;/span&gt;::&lt;span&gt;string&lt;/span&gt;Â &lt;span&gt;s2&lt;/span&gt;&lt;span&gt;(s)&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;Â Â Â Â (&lt;span&gt;void&lt;/span&gt;)Â s[&lt;span&gt;0&lt;/span&gt;];Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â è§¦å‘COW&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;span&gt;std&lt;/span&gt;::&lt;span&gt;cout&lt;/span&gt;Â &amp;lt;&amp;lt;Â *pÂ &amp;lt;&amp;lt;Â &lt;span&gt;&#x27;\n&#x27;&lt;/span&gt;;Â Â Â Â Â Â &lt;span&gt;//Â pæŒ‡å‘çš„åŸæœ‰ç©ºé—´å·²ç»æ— æ•ˆ&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å…¶ä»–æ›´ç»†èŠ‚çš„ç¼ºç‚¹å¯ä»¥å‚è€ƒï¼š&lt;span&gt;std::string çš„ Copy-on-Writeï¼šä¸å¦‚æƒ³è±¡ä¸­ç¾å¥½&lt;/span&gt;&lt;sup&gt;[3]&lt;/sup&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;SSO&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Small String Optimization. &lt;strong&gt;åŸºäºå­—ç¬¦ä¸²å¤§å¤šæ•°æ¯”è¾ƒçŸ­çš„ç‰¹ç‚¹&lt;/strong&gt;ï¼Œåˆ©ç”¨ string å¯¹è±¡æœ¬èº«çš„æ ˆç©ºé—´æ¥å­˜å‚¨çŸ­å­—ç¬¦ä¸²ã€‚è€Œå½“å­—ç¬¦ä¸²é•¿åº¦å¤§äºæŸä¸ªä¸´ç•Œå€¼æ—¶ï¼Œåˆ™ä½¿ç”¨ eager copy çš„æ–¹å¼ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;SSO ä¸‹ï¼Œstring çš„æ•°æ®ç»“æ„ä¼šç¨å¾®å¤æ‚ç‚¹ï¼Œä½¿ç”¨ union æ¥åŒºåˆ†çŸ­å­—ç¬¦ä¸²å’Œé•¿å­—ç¬¦ä¸²çš„åœºæ™¯ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;string&lt;/span&gt;Â {&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;char&lt;/span&gt;Â *start;&lt;br/&gt;Â Â &lt;span&gt;size_t&lt;/span&gt;Â size;&lt;br/&gt;Â Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;int&lt;/span&gt;Â kLocalSizeÂ =Â &lt;span&gt;15&lt;/span&gt;;&lt;br/&gt;Â Â &lt;span&gt;union&lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;char&lt;/span&gt;Â buffer[kLocalSize+&lt;span&gt;1&lt;/span&gt;];Â Â Â Â Â Â &lt;span&gt;//Â æ»¡è¶³æ¡ä»¶æ—¶ï¼Œç”¨æ¥å­˜æ”¾çŸ­å­—ç¬¦ä¸²&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;size_t&lt;/span&gt;Â capacity;&lt;br/&gt;Â Â }data;&lt;br/&gt;};&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;çŸ­å­—ç¬¦ä¸²ï¼ŒSSOï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.9580536912751678&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93ZiaR7rJ8PTQzgEXoCt5PWD1P0oRX2Exiayeicw5WdFXZYwImicw5MxB03Dw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;596&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é•¿å­—ç¬¦ä¸²ï¼Œeager copyï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.5677179962894249&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93ZicA52ZoFv8FiakPqnWMT0PKEOFKlvbYh5eUqgGGjspOia8XeqZ2215icAg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1078&quot;/&gt;&lt;/figure&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ç§æ•°æ®ç»“æ„çš„å®ç°ä¸‹ï¼ŒSSO çš„é˜ˆå€¼ä¸€èˆ¬æ˜¯ 15 å­—èŠ‚ã€‚folly çš„ fbstring åœ¨ SSO åœºæ™¯ä¸‹ï¼Œæ•°æ®ç»“æ„åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå¯ä»¥å­˜å‚¨ 23 ä¸ªå­—èŠ‚ï¼Œåé¢ä¼šæåˆ°ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¼˜ç‚¹ï¼š&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;string å¯¹è±¡å ç”¨ç©ºé—´æ¯” eager copy å’Œ cow è¦å¤§ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Fbstring ä»‹ç»&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;fbstring å¯ä»¥ 100%å…¼å®¹ std::stringã€‚é…åˆä¸‰ç§å­˜å‚¨ç­–ç•¥å’Œ&lt;span&gt;jemalloc&lt;/span&gt;&lt;sup&gt;[4]&lt;/sup&gt;ï¼Œå¯ä»¥æ˜¾è‘—çš„æé«˜ string çš„æ€§èƒ½ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;fbstring æ”¯æŒ 32-bitã€64-bitã€little-endianã€big-endian.&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Storage strategies&lt;/h2&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Small Strings (&amp;lt;= 23 chars) ï¼Œä½¿ç”¨ SSO.&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Medium strings (24 - 255 chars)ï¼Œä½¿ç”¨ eager copy.&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;Large strings (&amp;gt; 255 chars)ï¼Œä½¿ç”¨ COW.&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Implementation highlights&lt;/h2&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ä¸ std::string 100%å…¼å®¹ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;COW å­˜å‚¨æ—¶å¯¹äºå¼•ç”¨è®¡æ•°çº¿ç¨‹å®‰å…¨ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¯¹ Jemalloc å‹å¥½ã€‚å¦‚æœæ£€æµ‹åˆ°ä½¿ç”¨ jemallocï¼Œé‚£ä¹ˆå°†ä½¿ç”¨ jemalloc çš„ä¸€äº›éæ ‡å‡†æ‰©å±•æ¥å£æ¥æé«˜æ€§èƒ½ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;find()&lt;/code&gt;ä½¿ç”¨ç®€åŒ–ç‰ˆçš„&lt;span&gt;Boyer-Moore algorithm&lt;/span&gt;&lt;sup&gt;[5]&lt;/sup&gt;ã€‚åœ¨æŸ¥æ‰¾æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œç›¸å¯¹äº&lt;code&gt;string::find()&lt;/code&gt;æœ‰ 30 å€çš„æ€§èƒ½æå‡ã€‚åœ¨æŸ¥æ‰¾å¤±è´¥çš„æƒ…å†µä¸‹ä¹Ÿæœ‰ 1.5 å€çš„æ€§èƒ½æå‡ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¯ä»¥ä¸ std::string äº’ç›¸è½¬æ¢ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;Benchmark&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨&lt;span&gt;FBStringBenchmark.cpp&lt;/span&gt;&lt;sup&gt;[6]&lt;/sup&gt;ä¸­ã€‚&lt;/p&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ä¸»è¦ç±»&lt;/h1&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.22646007151370678&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93ZiaDT8mBqG62BmaqYFI1uwOR9nR7S0wMQEiavJVaIluib9xhhJlIH9dKSQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1678&quot;/&gt;&lt;/figure&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;code&gt;::folly::fbstring str(&quot;abc&quot;)&lt;/code&gt;ä¸­çš„ fbstring ä¸º basic_fbstring&lt;char&gt;çš„åˆ«å ï¼š&lt;code&gt;typedef basic_fbstring&amp;lt;char&amp;gt; fbstring;&lt;/code&gt;&lt;/char&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;basic&lt;em&gt;fbstring åœ¨ fbstring_core æä¾›çš„æ¥å£ä¹‹ä¸Šï¼Œå®ç°äº† std::string å®šä¹‰çš„æ‰€æœ‰æ¥å£ã€‚é‡Œé¢æœ‰ä¸€ä¸ªç§æœ‰å˜é‡ store&lt;/em&gt;ï¼Œé»˜è®¤å€¼å³ä¸º fbstring_coreã€‚basic_fbstring çš„å®šä¹‰å¦‚ä¸‹ï¼Œæ¯” std::basic_string åªå¤šäº†ä¸€ä¸ªé»˜è®¤çš„æ¨¡æ¿å‚æ•° Storageï¼š&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;template&lt;/span&gt;Â &amp;lt;&lt;br/&gt;Â Â Â Â &lt;span&gt;typename&lt;/span&gt;Â E,&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;T&lt;/span&gt;Â =Â &lt;span&gt;std&lt;/span&gt;:&lt;/span&gt;:char_traits&amp;lt;E&amp;gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;A&lt;/span&gt;Â =Â &lt;span&gt;std&lt;/span&gt;:&lt;/span&gt;:allocator&amp;lt;E&amp;gt;,&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;Storage&lt;/span&gt;Â =Â &lt;span&gt;fbstring_core&lt;/span&gt;&amp;lt;E&amp;gt;&amp;gt;&lt;br/&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;basic_fbstring&lt;/span&gt;;&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;fbstring_core è´Ÿè´£å­—ç¬¦ä¸²çš„å­˜å‚¨åŠå­—ç¬¦ä¸²ç›¸å…³çš„æ“ä½œï¼Œä¾‹å¦‚ initã€copyã€reserveã€shrink ç­‰ç­‰ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å­—ç¬¦ä¸²å­˜å‚¨æ•°æ®ç»“æ„&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ€é‡è¦çš„ 3 ä¸ªæ•°æ®ç»“æ„ union{Char small*, MediumLarge ml*}ã€MediumLargeã€RefCountedï¼Œå®šä¹‰åœ¨ fbstring_core ä¸­ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„å­—ç¬¦ä¸²æ“ä½œéƒ½ç¦»ä¸å¼€è¿™ä¸‰ä¸ªæ•°æ®ç»“æ„ã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;struct&lt;/span&gt;Â &lt;span&gt;RefCounted&lt;/span&gt;Â {&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;std&lt;/span&gt;::atomic&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;Â refCount_;&lt;br/&gt;Â Â Â Â CharÂ data_[&lt;span&gt;1&lt;/span&gt;];&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;static&lt;/span&gt;Â RefCountedÂ *Â &lt;span&gt;create&lt;/span&gt;&lt;span&gt;(&lt;span&gt;size_t&lt;/span&gt;Â *Â size)&lt;/span&gt;&lt;/span&gt;;Â Â Â Â Â Â Â &lt;span&gt;//Â åˆ›å»ºä¸€ä¸ªRefCounted&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;static&lt;/span&gt;Â RefCountedÂ *Â &lt;span&gt;create&lt;/span&gt;&lt;span&gt;(&lt;span&gt;const&lt;/span&gt;Â CharÂ *Â data,Â &lt;span&gt;size_t&lt;/span&gt;Â *Â size)&lt;/span&gt;&lt;/span&gt;;Â Â Â Â Â &lt;span&gt;//Â ditto&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;incrementRefs&lt;/span&gt;&lt;span&gt;(CharÂ *Â p)&lt;/span&gt;&lt;/span&gt;;Â Â Â Â Â &lt;span&gt;//Â å¢åŠ ä¸€ä¸ªå¼•ç”¨&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;decrementRefs&lt;/span&gt;&lt;span&gt;(CharÂ *Â p)&lt;/span&gt;&lt;/span&gt;;Â Â Â Â &lt;span&gt;//Â å‡å°‘ä¸€ä¸ªå¼•ç”¨&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;Â Â Â &lt;span&gt;//Â å…¶ä»–å‡½æ•°å®šä¹‰&lt;/span&gt;&lt;br/&gt;};&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;struct&lt;/span&gt;Â &lt;span&gt;MediumLarge&lt;/span&gt;Â {&lt;/span&gt;&lt;br/&gt;Â Â Char*Â data_;&lt;br/&gt;Â Â &lt;span&gt;size_t&lt;/span&gt;Â size_;&lt;br/&gt;Â Â &lt;span&gt;size_t&lt;/span&gt;Â capacity_;&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;size_t&lt;/span&gt;Â &lt;span&gt;capacity&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;const&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â kIsLittleEndianÂ ?Â capacity_Â &amp;amp;Â capacityExtractMaskÂ :Â capacity_Â &amp;gt;&amp;gt;Â &lt;span&gt;2&lt;/span&gt;;&lt;br/&gt;Â Â }&lt;br/&gt;&lt;br/&gt;Â Â &lt;span&gt;&lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;setCapacity&lt;/span&gt;&lt;span&gt;(&lt;span&gt;size_t&lt;/span&gt;Â cap,Â CategoryÂ cat)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â capacity_Â =Â kIsLittleEndian&lt;br/&gt;Â Â Â Â Â Â Â Â ?Â capÂ |Â (&lt;span&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;(cat)Â &amp;lt;&amp;lt;Â kCategoryShift)&lt;br/&gt;Â Â Â Â Â Â Â Â :Â (capÂ &amp;lt;&amp;lt;Â &lt;span&gt;2&lt;/span&gt;)Â |Â &lt;span&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;(cat);&lt;br/&gt;Â Â }&lt;br/&gt;};&lt;br/&gt;&lt;br/&gt;&lt;span&gt;union&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;uint8_t&lt;/span&gt;Â bytes_[&lt;span&gt;sizeof&lt;/span&gt;(MediumLarge)];Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â ForÂ accessingÂ theÂ lastÂ byte.&lt;/span&gt;&lt;br/&gt;Â Â Â Â CharÂ small_[&lt;span&gt;sizeof&lt;/span&gt;(MediumLarge)Â /Â &lt;span&gt;sizeof&lt;/span&gt;(Char)];&lt;br/&gt;Â Â Â Â MediumLargeÂ ml_;&lt;br/&gt;};&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;small stringsï¼ˆSSOï¼‰æ—¶ï¼Œä½¿ç”¨ union ä¸­çš„ Char small_å­˜å‚¨å­—ç¬¦ä¸²ï¼Œå³å¯¹è±¡æœ¬èº«çš„æ ˆç©ºé—´ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;medium stringsï¼ˆeager copyï¼‰æ—¶ï¼Œä½¿ç”¨ union ä¸­çš„&lt;code&gt;MediumLarge ml_&lt;/code&gt;&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;Char* data_ ï¼šæŒ‡å‘åˆ†é…åœ¨å †ä¸Šçš„å­—ç¬¦ä¸²ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;size&lt;em&gt;t size&lt;/em&gt;ï¼šå­—ç¬¦ä¸²é•¿åº¦ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;size&lt;em&gt;t capacity&lt;/em&gt; ï¼šå­—ç¬¦ä¸²å®¹é‡ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;section&gt;large stringsï¼ˆcowï¼‰æ—¶ï¼Œ ä½¿ç”¨&lt;code&gt;MediumLarge ml_&lt;/code&gt;å’Œ RefCountedï¼š&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;RefCounted.refCount_ ï¼šå…±äº«å­—ç¬¦ä¸²çš„å¼•ç”¨è®¡æ•°ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;RefCounted.data_[1] : &lt;strong&gt;flexible array.&lt;/strong&gt; å­˜æ”¾å­—ç¬¦ä¸²ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;ml*.data&lt;em&gt;æŒ‡å‘ RefCounted.data&lt;/em&gt;ï¼Œml*.size&lt;em&gt;ä¸ ml&lt;/em&gt;.capacity_çš„å«ä¹‰ä¸å˜ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šSSO æƒ…å†µä¸‹çš„ size å’Œ capacity å­˜åœ¨å“ªé‡Œäº†ï¼Ÿ&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;capacity : é¦–å…ˆ SSO çš„åœºæ™¯å¹¶ä¸éœ€è¦ capacityï¼Œå› ä¸ºæ­¤æ—¶åˆ©ç”¨çš„æ˜¯æ ˆç©ºé—´ï¼Œæˆ–è€…ç†è§£æ­¤ç§æƒ…å†µä¸‹çš„ capacity=maxSmallSize.&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;size : åˆ©ç”¨ small_çš„ä¸€ä¸ªå­—èŠ‚æ¥å­˜å‚¨ sizeï¼Œ&lt;strong&gt;è€Œä¸”å…·ä½“å­˜å‚¨çš„ä¸æ˜¯ sizeï¼Œè€Œæ˜¯&lt;code&gt;maxSmallSize - s&lt;/code&gt;&lt;/strong&gt;ï¼ˆmaxSmallSize=23ï¼Œå†è½¬æˆ char ç±»å‹ï¼‰ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ SSO å¤šå­˜å‚¨ä¸€ä¸ªå­—èŠ‚ï¼Œå…·ä½“åŸå› åé¢è¯¦ç»†è®²ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;small strings :&lt;/h2&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93ZjhN2oEDUVuTWib79CBdGUMgDN3qwHdQdd69MyOj7HysicekEkibrNkv0w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.4351851851851852&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;medium strings :&lt;/h2&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93ZVic0tyreDbLuldVOicJzcQrqFr9ncXKB1O9LPk2VObry6SEsva2ZyxwA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.55&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;large strings :&lt;/h2&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93Zn1rF7teY0M2qkaf4qSib0navbPLY308GAJDFPugwQyUYjUcTwia0ar6Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.7777777777777778&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å¦‚ä½•åŒºåˆ†å­—ç¬¦ä¸²ç±»å‹ category&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å­—ç¬¦ä¸²çš„ small/medium/large ç±»å‹å¯¹å¤–éƒ¨é€æ˜ï¼Œè€Œä¸”é’ˆå¯¹å­—ç¬¦ä¸²çš„å„ç§æ“ä½œä¾‹å¦‚ copyã€shrinkã€reserveã€èµ‹å€¼ç­‰ç­‰ï¼Œä¸‰ç§ç±»å‹çš„å¤„ç†æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œ&lt;strong&gt;æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸Šé¢çš„æ•°æ®ç»“æ„ä¸­åšäº›â€œæ‰‹è„šâ€ï¼Œæ¥åŒºåˆ†ä¸åŒçš„å­—ç¬¦ä¸²ç±»å‹ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å› ä¸ºåªæœ‰ä¸‰ç§ç±»å‹ï¼Œæ‰€ä»¥åªéœ€è¦ 2 ä¸ª bit å°±èƒ½å¤ŸåŒºåˆ†ã€‚ç›¸å…³çš„æ•°æ®ç»“æ„ä¸ºï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;typedef&lt;/span&gt;Â &lt;span&gt;uint8_t&lt;/span&gt;Â category_type;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;enum&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;Category&lt;/span&gt;Â :&lt;/span&gt;Â category_typeÂ {&lt;br/&gt;Â Â Â Â isSmallÂ =Â &lt;span&gt;0&lt;/span&gt;,&lt;br/&gt;Â Â Â Â isMediumÂ =Â kIsLittleEndianÂ ?Â &lt;span&gt;0x80&lt;/span&gt;Â :Â &lt;span&gt;0x2&lt;/span&gt;,Â Â Â Â Â Â Â &lt;span&gt;//Â Â 10000000Â ,Â 00000010&lt;/span&gt;&lt;br/&gt;Â Â Â Â isLargeÂ =Â kIsLittleEndianÂ ?Â &lt;span&gt;0x40&lt;/span&gt;Â :Â &lt;span&gt;0x1&lt;/span&gt;,Â Â Â Â Â Â Â Â &lt;span&gt;//Â Â 01000000Â ,Â 00000001&lt;/span&gt;&lt;br/&gt;};&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;kIsLittleEndian ä¸ºåˆ¤æ–­å½“å‰å¹³å°çš„å¤§å°ç«¯ï¼Œå¤§ç«¯å’Œå°ç«¯çš„å­˜å‚¨æ–¹å¼ä¸åŒã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;small strings&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;category ä¸ size å…±åŒå­˜æ”¾åœ¨ small_çš„æœ€åä¸€ä¸ªå­—èŠ‚ä¸­ï¼ˆsize æœ€å¤§ä¸º 23ï¼Œæ‰€ä»¥å¯ä»¥å­˜ä¸‹ï¼‰ï¼Œè€ƒè™‘åˆ°å¤§å°ç«¯ï¼Œæ‰€ä»¥æœ‰ç§»ä½æ“ä½œï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†è®© category()çš„åˆ¤æ–­æ›´ç®€å•ï¼Œåé¢å†è¯¦ç»†åˆ†æã€‚å…·ä½“ä»£ç åœ¨ setSmallSize ä¸­ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;setSmallSize&lt;/span&gt;&lt;span&gt;(&lt;span&gt;size_t&lt;/span&gt;Â s)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â ......&lt;br/&gt;Â Â &lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;auto&lt;/span&gt;Â shiftÂ =Â kIsLittleEndianÂ ?Â &lt;span&gt;0&lt;/span&gt;Â :Â &lt;span&gt;2&lt;/span&gt;;&lt;br/&gt;Â Â small_[maxSmallSize]Â =Â &lt;span&gt;char&lt;/span&gt;((maxSmallSizeÂ -Â s)Â &amp;lt;&amp;lt;Â shift);&lt;br/&gt;Â Â ......&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93Zax1XKEiagk6gzibUib1xofvIASCedCHBDUDxX5Hd5sx07bJ0rWlNzmcGA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-ratio=&quot;0.5787037037037037&quot; data-w=&quot;1080&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;medium strings&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯èƒ½æœ‰äººæ³¨æ„åˆ°äº†ï¼Œåœ¨ MediumLarge ç»“æ„ä½“ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œ&lt;code&gt;capacity()&lt;/code&gt;å’Œ&lt;code&gt;setCapacity(size_t cap, Category cat)&lt;/code&gt;ï¼Œå…¶ä¸­ setCapacity å³åŒæ—¶è®¾ç½® capacity å’Œ category :&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â kCategoryShiftÂ =Â (&lt;span&gt;sizeof&lt;/span&gt;(&lt;span&gt;size_t&lt;/span&gt;)Â -Â &lt;span&gt;1&lt;/span&gt;)Â *Â &lt;span&gt;8&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;setCapacity&lt;/span&gt;&lt;span&gt;(&lt;span&gt;size_t&lt;/span&gt;Â cap,Â CategoryÂ cat)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â capacity_Â =Â kIsLittleEndian&lt;br/&gt;Â Â Â Â Â Â Â Â ?Â capÂ |Â (&lt;span&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;(cat)Â &amp;lt;&amp;lt;Â kCategoryShift)&lt;br/&gt;Â Â Â Â Â Â Â Â :Â (capÂ &amp;lt;&amp;lt;Â &lt;span&gt;2&lt;/span&gt;)Â |Â &lt;span&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;(cat);&lt;br/&gt;}&lt;br/&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å°ç«¯æ—¶ï¼Œå°† category = isMedium = 0x80 å‘å·¦ç§»åŠ¨&lt;code&gt;(sizeof(size_t) - 1) * 8&lt;/code&gt;ä½ï¼Œå³ç§»åˆ°æœ€é«˜ä½çš„å­—èŠ‚ä¸­ï¼Œå†ä¸ capacity åšæˆ–è¿ç®—ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¤§ç«¯æ—¶ï¼Œå°† category = isMedium = 0x2 ä¸ cap &amp;lt;&amp;lt; 2 åšæˆ–è¿ç®—å³å¯ï¼Œå·¦ç§» 2 ä½çš„ç›®çš„æ˜¯ç»™ category ç•™ç©ºé—´ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ 64 ä½æœºå™¨ï¼Œcapacity = 100 :&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.5846153846153846&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93Zefd3fYbBolXBwSNhAzPdoiaCeYktmEic9kNXWMY3DNrP3mu3MqEKAorQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1690&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;large strings&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åŒæ ·ä½¿ç”¨ MediumLarge çš„ setCapacityï¼Œç®—æ³•ç›¸åŒï¼Œåªæ˜¯ category çš„å€¼ä¸åŒã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‡è®¾ 64 ä½æœºå™¨ï¼Œcapacity = 1000 ï¼š&lt;/p&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.6088834053053671&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93Zia50Wt4ZVJf77Uq30WmEic1xXLibgcukRf8YwhYAuErE1HZ4woudxibe3w/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1621&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;category()&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;code&gt;category()&lt;/code&gt;ä¸ºæœ€é‡è¦çš„å‡½æ•°ä¹‹ä¸€ï¼Œä½œç”¨æ˜¯è·å–å­—ç¬¦ä¸²çš„ç±»å‹ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;uint8_t&lt;/span&gt;Â categoryExtractMaskÂ =Â kIsLittleEndianÂ ?Â &lt;span&gt;0xC0&lt;/span&gt;Â :Â &lt;span&gt;0x3&lt;/span&gt;;Â Â Â Â &lt;span&gt;//Â 11000000Â ,Â 00000011&lt;/span&gt;&lt;br/&gt;&lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â lastCharÂ =Â &lt;span&gt;sizeof&lt;/span&gt;(MediumLarge)Â -Â &lt;span&gt;1&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;union&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;uint8_t&lt;/span&gt;Â bytes_[&lt;span&gt;sizeof&lt;/span&gt;(MediumLarge)];Â Â Â Â Â Â Â Â Â Â &lt;span&gt;//Â ForÂ accessingÂ theÂ lastÂ byte.&lt;/span&gt;&lt;br/&gt;Â Â Â Â CharÂ small_[&lt;span&gt;sizeof&lt;/span&gt;(MediumLarge)Â /Â &lt;span&gt;sizeof&lt;/span&gt;(Char)];&lt;br/&gt;Â Â Â Â MediumLargeÂ ml_;&lt;br/&gt;};&lt;br/&gt;&lt;br/&gt;&lt;span&gt;CategoryÂ &lt;span&gt;category&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;const&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;//Â worksÂ forÂ bothÂ big-endianÂ andÂ little-endian&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;static_cast&lt;/span&gt;&amp;lt;Category&amp;gt;(bytes_[lastChar]Â &amp;amp;Â categoryExtractMask);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;bytes_å®šä¹‰åœ¨ union ä¸­ï¼Œä»æ³¨é‡Šå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯ä¸ºäº†é…åˆ lastChar æ›´åŠ æ–¹ä¾¿çš„å–è¯¥ç»“æ„æœ€åä¸€ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é…åˆä¸Šé¢ä¸‰ç§ç±»å‹å­—ç¬¦ä¸²çš„å­˜å‚¨ï¼Œå¯ä»¥å¾ˆå®¹æ˜“ç†è§£è¿™ä¸€è¡Œä»£ç ã€‚&lt;/p&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å°ç«¯&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.4276401564537158&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93ZE62zmLdvmdMeBnCp1vEFM4kKrhDdruiaX4433SzaZiaHQIeaiaaqNe1tQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;767&quot;/&gt;&lt;/figure&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å¤§ç«¯&lt;span/&gt;&lt;/h3&gt;&lt;figure data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;img data-ratio=&quot;0.4050925925925926&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/On8kUXFskR1rE9ibNCZdEF9F2Aib7mx93ZFGl2iaUUicsh2f0UuENHeuqy2PfKRn7vibibX3jASY2dA3gtvIu0eGl0ibg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;864&quot;/&gt;&lt;/figure&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;capacity()&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è·å–å­—ç¬¦ä¸²çš„ capaticyï¼Œå› ä¸º capacity ä¸ category å­˜å‚¨éƒ½åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥ä¸€èµ·çœ‹æ¯”è¾ƒå¥½ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åŒæ ·åˆ†ä¸‰ç§æƒ…å†µã€‚&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;size_t&lt;/span&gt;Â &lt;span&gt;capacity&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;const&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;switch&lt;/span&gt;Â (category())Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â Category::isSmall:&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â maxSmallSize;&lt;br/&gt;Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â Category::isLarge:&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;//Â ForÂ large-sizedÂ strings,Â aÂ multi-referencedÂ chunkÂ hasÂ no&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;//Â availableÂ capacity.Â ThisÂ isÂ becauseÂ anyÂ attemptÂ toÂ append&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;//Â dataÂ wouldÂ triggerÂ aÂ newÂ allocation.&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (RefCounted::refs(ml_.data_)Â &amp;gt;Â &lt;span&gt;1&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â ml_.size_;&lt;br/&gt;Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â Category::isMedium:&lt;br/&gt;Â Â Â Â &lt;span&gt;default&lt;/span&gt;:&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ml_.capacity();&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;small strings : ç›´æ¥è¿”å› maxSmallSizeï¼Œå‰é¢æœ‰åˆ†æè¿‡ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;medium strings : è¿”å› ml_.capacity()ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;large strings :&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;å½“å­—ç¬¦ä¸²å¼•ç”¨å¤§äº 1 æ—¶ï¼Œç›´æ¥è¿”å› sizeã€‚å› ä¸ºæ­¤æ—¶çš„ capacity æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä»»ä½• append data æ“ä½œéƒ½ä¼šè§¦å‘ä¸€æ¬¡ cow&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦åˆ™ï¼Œè¿”å› ml_.capacity()ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;çœ‹ä¸‹ ml.capacity() :&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;uint8_t&lt;/span&gt;Â categoryExtractMaskÂ =Â kIsLittleEndianÂ ?Â &lt;span&gt;0xC0&lt;/span&gt;Â :Â &lt;span&gt;0x3&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â kCategoryShiftÂ =Â (&lt;span&gt;sizeof&lt;/span&gt;(&lt;span&gt;size_t&lt;/span&gt;)Â -Â &lt;span&gt;1&lt;/span&gt;)Â *Â &lt;span&gt;8&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â capacityExtractMaskÂ =Â kIsLittleEndian&lt;br/&gt;Â Â Â Â Â Â ?Â ~(&lt;span&gt;size_t&lt;/span&gt;(categoryExtractMask)Â &amp;lt;&amp;lt;Â kCategoryShift)&lt;br/&gt;Â Â Â Â Â Â :Â &lt;span&gt;0x0&lt;/span&gt;Â &lt;span&gt;/*Â unusedÂ */&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;&lt;span&gt;&lt;span&gt;size_t&lt;/span&gt;Â &lt;span&gt;capacity&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;const&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â kIsLittleEndianÂ ?Â capacity_Â &amp;amp;Â capacityExtractMaskÂ :Â capacity_Â &amp;gt;&amp;gt;Â &lt;span&gt;2&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;categoryExtractMask å’Œ kCategoryShift ä¹‹å‰é‡åˆ°è¿‡ï¼Œåˆ†åˆ«ç”¨æ¥è®¡ç®— category å’Œå°ç«¯æƒ…å†µä¸‹å°† category å·¦ç§» kCategoryShift ä½ã€‚capacityExtractMask çš„ç›®çš„å°±æ˜¯æ¶ˆæ‰ categoryï¼Œè®© capacity_ä¸­åªæœ‰ capacityã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯¹ç€ä¸Šé¢çš„æ¯ç§æƒ…å†µä¸‹å­—ç¬¦ä¸²çš„å­˜å‚¨çš„å›¾ï¼Œåº”è¯¥å¾ˆå¥½ç†è§£ï¼Œè¿™é‡Œä¸ç»†è¯´äº†ã€‚&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;size()&lt;/h2&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;size_t&lt;/span&gt;Â &lt;span&gt;size&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;const&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;size_t&lt;/span&gt;Â retÂ =Â ml_.size_;&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â &lt;span&gt;/*Â constexprÂ */&lt;/span&gt;Â (kIsLittleEndian)Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â WeÂ canÂ saveÂ aÂ coupleÂ instructions,Â becauseÂ theÂ categoryÂ is&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â smallÂ iffÂ theÂ lastÂ char,Â asÂ unsigned,Â isÂ &amp;lt;=Â maxSmallSize.&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;typedef&lt;/span&gt;Â &lt;span&gt;typename&lt;/span&gt;Â &lt;span&gt;std&lt;/span&gt;::make_unsigned&amp;lt;Char&amp;gt;::typeÂ UChar;&lt;br/&gt;Â Â Â Â &lt;span&gt;auto&lt;/span&gt;Â maybeSmallSizeÂ =Â &lt;span&gt;size_t&lt;/span&gt;(maxSmallSize)Â -&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;size_t&lt;/span&gt;(&lt;span&gt;static_cast&lt;/span&gt;&amp;lt;UChar&amp;gt;(small_[maxSmallSize]));&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â WithÂ thisÂ syntax,Â GCCÂ andÂ ClangÂ generateÂ aÂ CMOVÂ insteadÂ ofÂ aÂ branch.&lt;/span&gt;&lt;br/&gt;Â Â Â Â retÂ =Â (&lt;span&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span&gt;ssize_t&lt;/span&gt;&amp;gt;(maybeSmallSize)Â &amp;gt;=Â &lt;span&gt;0&lt;/span&gt;)Â ?Â maybeSmallSizeÂ :Â ret;&lt;br/&gt;Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â retÂ =Â (category()Â ==Â Category::isSmall)Â ?Â smallSize()Â :Â ret;&lt;br/&gt;Â Â }&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â ret;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å°ç«¯çš„æƒ…å†µä¸‹ï¼Œmedium strings å’Œ large strings å¯¹åº”çš„ ml_çš„é«˜å­—èŠ‚å­˜å‚¨çš„æ˜¯ categoryï¼ˆ0x80ã€0x40ï¼‰ï¼Œè€Œ small strings å­˜å‚¨çš„æ˜¯ sizeï¼Œæ‰€ä»¥æ­£å¦‚æ³¨é‡Šè¯´çš„ï¼Œå¯ä»¥å…ˆåˆ¤æ–­ kIsLittleEndian &amp;amp;&amp;amp; maybeSmallï¼Œä¼šå¿«ä¸€äº›ï¼Œä¸éœ€è¦è°ƒç”¨ smallSize()ã€‚è€Œä¸”ç°åœ¨ç»å¤§å¤šæ•°å¹³å°éƒ½æ˜¯å°ç«¯ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœæ˜¯å¤§ç«¯ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯ smallï¼Œè°ƒç”¨ smallSize()ï¼Œå¦åˆ™è¿”å› ml.size_;&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;size_t&lt;/span&gt;Â &lt;span&gt;smallSize&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;const&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â assert(category()Â ==Â Category::isSmall);&lt;br/&gt;Â Â &lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;auto&lt;/span&gt;Â shiftÂ =Â kIsLittleEndianÂ ?Â &lt;span&gt;0&lt;/span&gt;Â :Â &lt;span&gt;2&lt;/span&gt;;&lt;br/&gt;Â Â &lt;span&gt;auto&lt;/span&gt;Â smallShiftedÂ =Â &lt;span&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;(small_[maxSmallSize])Â &amp;gt;&amp;gt;Â shift;&lt;br/&gt;Â Â assert(&lt;span&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;(maxSmallSize)Â &amp;gt;=Â smallShifted);&lt;br/&gt;Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;static_cast&lt;/span&gt;&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;(maxSmallSize)Â -Â smallShifted;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯”è¾ƒç®€å•ï¼Œä¸è¯´äº†ã€‚&lt;/p&gt;&lt;h1 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;å­—ç¬¦ä¸²åˆå§‹åŒ–&lt;/h1&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¦–å…ˆ fbstring_core çš„æ„é€ å‡½æ•°ä¸­ï¼Œæ ¹æ®å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè°ƒç”¨ 3 ç§ä¸åŒç±»å‹çš„åˆå§‹åŒ–å‡½æ•°ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;fbstring_core(&lt;br/&gt;Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â Char*Â &lt;span&gt;const&lt;/span&gt;Â data,&lt;br/&gt;Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â size,&lt;br/&gt;Â Â Â Â &lt;span&gt;bool&lt;/span&gt;Â disableSSOÂ =Â FBSTRING_DISABLE_SSO)Â {&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (!disableSSOÂ &amp;amp;&amp;amp;Â sizeÂ &amp;lt;=Â maxSmallSize)Â {&lt;br/&gt;Â Â Â Â initSmall(data,Â size);&lt;br/&gt;Â Â }Â &lt;span&gt;else&lt;/span&gt;Â &lt;span&gt;if&lt;/span&gt;Â (sizeÂ &amp;lt;=Â maxMediumSize)Â {&lt;br/&gt;Â Â Â Â initMedium(data,Â size);&lt;br/&gt;Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â initLarge(data,Â size);&lt;br/&gt;Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;initSmall&lt;/h2&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;template&lt;/span&gt;Â &amp;lt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;Char&lt;/span&gt;&amp;gt;&lt;br/&gt;&lt;span&gt;inline&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;fbstring_core&lt;/span&gt;&amp;lt;Char&amp;gt;:&lt;/span&gt;:initSmall(&lt;br/&gt;Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â Char*Â &lt;span&gt;const&lt;/span&gt;Â data,&lt;br/&gt;Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â size)Â {&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â IfÂ dataÂ isÂ aligned,Â useÂ fastÂ word-wiseÂ copying.Â Otherwise,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â useÂ conservativeÂ memcpy.&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â TheÂ word-wiseÂ pathÂ readsÂ bytesÂ whichÂ areÂ outsideÂ theÂ rangeÂ of&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â theÂ string,Â andÂ makesÂ ASanÂ unhappy,Â soÂ weÂ disableÂ itÂ when&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â compilingÂ withÂ ASan.&lt;/span&gt;&lt;br/&gt;&lt;span&gt;#&lt;span&gt;ifndef&lt;/span&gt;Â FOLLY_SANITIZE_ADDRESS&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â ((&lt;span&gt;reinterpret_cast&lt;/span&gt;&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;(data)Â &amp;amp;Â (&lt;span&gt;sizeof&lt;/span&gt;(&lt;span&gt;size_t&lt;/span&gt;)Â -Â &lt;span&gt;1&lt;/span&gt;))Â ==Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â byteSizeÂ =Â sizeÂ *Â &lt;span&gt;sizeof&lt;/span&gt;(Char);&lt;br/&gt;Â Â Â Â &lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â wordWidthÂ =Â &lt;span&gt;sizeof&lt;/span&gt;(&lt;span&gt;size_t&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;switch&lt;/span&gt;Â ((byteSizeÂ +Â wordWidthÂ -Â &lt;span&gt;1&lt;/span&gt;)Â /Â wordWidth)Â {Â &lt;span&gt;//Â NumberÂ ofÂ words.&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â &lt;span&gt;3&lt;/span&gt;:&lt;br/&gt;Â Â Â Â Â Â Â Â ml_.capacity_Â =Â &lt;span&gt;reinterpret_cast&lt;/span&gt;&amp;lt;&lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;*&amp;gt;(data)[&lt;span&gt;2&lt;/span&gt;];&lt;br/&gt;Â Â Â Â Â Â Â Â FOLLY_FALLTHROUGH;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â &lt;span&gt;2&lt;/span&gt;:&lt;br/&gt;Â Â Â Â Â Â Â Â ml_.size_Â =Â &lt;span&gt;reinterpret_cast&lt;/span&gt;&amp;lt;&lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;*&amp;gt;(data)[&lt;span&gt;1&lt;/span&gt;];&lt;br/&gt;Â Â Â Â Â Â Â Â FOLLY_FALLTHROUGH;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â &lt;span&gt;1&lt;/span&gt;:&lt;br/&gt;Â Â Â Â Â Â Â Â ml_.data_Â =Â *&lt;span&gt;reinterpret_cast&lt;/span&gt;&amp;lt;Char**&amp;gt;(&lt;span&gt;const_cast&lt;/span&gt;&amp;lt;Char*&amp;gt;(data));&lt;br/&gt;Â Â Â Â Â Â Â Â FOLLY_FALLTHROUGH;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;case&lt;/span&gt;Â &lt;span&gt;0&lt;/span&gt;:&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;break&lt;/span&gt;;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â }Â &lt;span&gt;else&lt;/span&gt;&lt;br/&gt;#endif&lt;br/&gt;Â Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (sizeÂ !=Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â Â Â fbstring_detail::podCopy(data,Â dataÂ +Â size,Â small_);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â }&lt;br/&gt;Â Â setSmallSize(size);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;é¦–å…ˆï¼Œå¦‚æœä¼ å…¥çš„å­—ç¬¦ä¸²åœ°å€æ˜¯å†…å­˜å¯¹é½çš„ï¼Œ&lt;strong&gt;åˆ™é…åˆ reinterpret_cast è¿›è¡Œ word-wise copyï¼Œæé«˜æ•ˆç‡ã€‚&lt;/strong&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å¦åˆ™ï¼Œè°ƒç”¨ podCopy è¿›è¡Œ memcpyã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æœ€åï¼Œé€šè¿‡ setSmallSize è®¾ç½® small string çš„ sizeã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;setSmallSize :&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;setSmallSize&lt;/span&gt;&lt;span&gt;(&lt;span&gt;size_t&lt;/span&gt;Â s)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â &lt;span&gt;//Â Warning:Â thisÂ shouldÂ workÂ withÂ uninitializedÂ stringsÂ too,&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;//Â soÂ don&#x27;tÂ assumeÂ anythingÂ aboutÂ theÂ previousÂ valueÂ of&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;//Â small_[maxSmallSize].&lt;/span&gt;&lt;br/&gt;Â Â assert(sÂ &amp;lt;=Â maxSmallSize);&lt;br/&gt;Â Â &lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;auto&lt;/span&gt;Â shiftÂ =Â kIsLittleEndianÂ ?Â &lt;span&gt;0&lt;/span&gt;Â :Â &lt;span&gt;2&lt;/span&gt;;&lt;br/&gt;Â Â small_[maxSmallSize]Â =Â &lt;span&gt;char&lt;/span&gt;((maxSmallSizeÂ -Â s)Â &amp;lt;&amp;lt;Â shift);&lt;br/&gt;Â Â small_[s]Â =Â &lt;span&gt;&#x27;\0&#x27;&lt;/span&gt;;&lt;br/&gt;Â Â assert(category()Â ==Â Category::isSmallÂ &amp;amp;&amp;amp;Â size()Â ==Â s);&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¹‹å‰æåˆ°è¿‡ï¼Œsmall strings å­˜æ”¾çš„ size ä¸æ˜¯çœŸæ­£çš„ sizeï¼Œæ˜¯&lt;code&gt;maxSmallSize - size&lt;/code&gt;ï¼Œè¿™æ ·åšçš„åŸå› æ˜¯å¯ä»¥ small strings å¯ä»¥å¤šå­˜å‚¨ä¸€ä¸ªå­—èŠ‚ ã€‚&lt;strong&gt;å› ä¸ºå‡å¦‚å­˜å‚¨ size çš„è¯ï¼Œsmall&lt;em&gt;ä¸­æœ€åä¸¤ä¸ªå­—èŠ‚å°±å¾—æ˜¯\0 å’Œ sizeï¼Œä½†æ˜¯å­˜å‚¨&lt;code&gt;maxSmallSize - size&lt;/code&gt;ï¼Œå½“ size == maxSmallSize æ—¶ï¼Œsmall&lt;/em&gt;çš„æœ€åä¸€ä¸ªå­—èŠ‚æ°å¥½ä¹Ÿæ˜¯\0ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;initMedium&lt;/h2&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;template&lt;/span&gt;Â &amp;lt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;Char&lt;/span&gt;&amp;gt;&lt;br/&gt;&lt;span&gt;FOLLY_NOINLINE&lt;/span&gt;Â &lt;span&gt;inline&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;fbstring_core&lt;/span&gt;&amp;lt;Char&amp;gt;:&lt;/span&gt;:initMedium(&lt;br/&gt;Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â Char*Â &lt;span&gt;const&lt;/span&gt;Â data,&lt;br/&gt;Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â size)Â {&lt;br/&gt;Â Â &lt;span&gt;//Â MediumÂ stringsÂ areÂ allocatedÂ normally.Â Don&#x27;tÂ forgetÂ to&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;//Â allocateÂ oneÂ extraÂ CharÂ forÂ theÂ terminatingÂ null.&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;auto&lt;/span&gt;Â &lt;span&gt;const&lt;/span&gt;Â allocSizeÂ =Â goodMallocSize((&lt;span&gt;1&lt;/span&gt;Â +Â size)Â *Â &lt;span&gt;sizeof&lt;/span&gt;(Char));&lt;br/&gt;Â Â ml_.data_Â =Â &lt;span&gt;static_cast&lt;/span&gt;&amp;lt;Char*&amp;gt;(checkedMalloc(allocSize));&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (FOLLY_LIKELY(sizeÂ &amp;gt;Â &lt;span&gt;0&lt;/span&gt;))Â {&lt;br/&gt;Â Â Â Â fbstring_detail::podCopy(data,Â dataÂ +Â size,Â ml_.data_);&lt;br/&gt;Â Â }&lt;br/&gt;Â Â ml_.size_Â =Â size;&lt;br/&gt;Â Â ml_.setCapacity(allocSizeÂ /Â &lt;span&gt;sizeof&lt;/span&gt;(Char)Â -Â &lt;span&gt;1&lt;/span&gt;,Â Category::isMedium);&lt;br/&gt;Â Â ml_.data_[size]Â =Â &lt;span&gt;&#x27;\0&#x27;&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;folly ä¼šé€šè¿‡ canNallocx å‡½æ•°æ£€æµ‹æ˜¯å¦ä½¿ç”¨ jemallocï¼Œå¦‚æœæ˜¯ï¼Œä¼šä½¿ç”¨ jemalloc æ¥æé«˜å†…å­˜åˆ†é…çš„æ€§èƒ½ã€‚å…³äº jemalloc æˆ‘ä¹Ÿä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥æŸ¥ï¼Œæœ‰å¾ˆå¤šèµ„æ–™ã€‚&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;æ‰€æœ‰çš„åŠ¨æ€å†…å­˜åˆ†é…éƒ½ä¼šè°ƒç”¨ goodMallocSizeï¼Œè·å–ä¸€ä¸ªå¯¹ jemalloc å‹å¥½çš„å€¼ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;å†é€šè¿‡ checkedMalloc çœŸæ­£ç”³è¯·å†…å­˜ï¼Œå­˜æ”¾å­—ç¬¦ä¸²ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;è°ƒç”¨ podCopy è¿›è¡Œ memcpyï¼Œä¸ initSmall çš„ podCopy ä¸€æ ·ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æœ€åå†è®¾ç½® sizeã€capacityã€category å’Œ\0ã€‚&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;initLarge&lt;/h2&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;template&lt;/span&gt;Â &amp;lt;&lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;Char&lt;/span&gt;&amp;gt;&lt;br/&gt;&lt;span&gt;FOLLY_NOINLINE&lt;/span&gt;Â &lt;span&gt;inline&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;fbstring_core&lt;/span&gt;&amp;lt;Char&amp;gt;:&lt;/span&gt;:initLarge(&lt;br/&gt;Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â Char*Â &lt;span&gt;const&lt;/span&gt;Â data,&lt;br/&gt;Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â size)Â {&lt;br/&gt;Â Â &lt;span&gt;//Â LargeÂ stringsÂ areÂ allocatedÂ differently&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;size_t&lt;/span&gt;Â effectiveCapacityÂ =Â size;&lt;br/&gt;Â Â &lt;span&gt;auto&lt;/span&gt;Â &lt;span&gt;const&lt;/span&gt;Â newRCÂ =Â RefCounted::create(data,Â &amp;amp;effectiveCapacity);&lt;br/&gt;Â Â ml_.data_Â =Â newRC-&amp;gt;data_;&lt;br/&gt;Â Â ml_.size_Â =Â size;&lt;br/&gt;Â Â ml_.setCapacity(effectiveCapacity,Â Category::isLarge);&lt;br/&gt;Â Â ml_.data_[size]Â =Â &lt;span&gt;&#x27;\0&#x27;&lt;/span&gt;;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸ medium strings æœ€å¤§çš„ä¸åŒæ˜¯ä¼šé€šè¿‡ RefCounted::create åˆ›å»º RefCounted ç”¨äºå…±äº«å­—ç¬¦ä¸²ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;&lt;span&gt;struct&lt;/span&gt;Â &lt;span&gt;RefCounted&lt;/span&gt;Â {&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;std&lt;/span&gt;::atomic&amp;lt;&lt;span&gt;size_t&lt;/span&gt;&amp;gt;Â refCount_;&lt;br/&gt;Â Â Â Â CharÂ data_[&lt;span&gt;1&lt;/span&gt;];&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;constexpr&lt;/span&gt;Â &lt;span&gt;static&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â &lt;span&gt;getDataOffset&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â offsetof(RefCounted,Â data_);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;static&lt;/span&gt;Â RefCounted*Â &lt;span&gt;create&lt;/span&gt;&lt;span&gt;(&lt;span&gt;size_t&lt;/span&gt;*Â size)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â allocSizeÂ =&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â goodMallocSize(getDataOffset()Â +Â (*sizeÂ +Â &lt;span&gt;1&lt;/span&gt;)Â *Â &lt;span&gt;sizeof&lt;/span&gt;(Char));&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;auto&lt;/span&gt;Â resultÂ =Â &lt;span&gt;static_cast&lt;/span&gt;&amp;lt;RefCounted*&amp;gt;(checkedMalloc(allocSize));&lt;br/&gt;Â Â Â Â Â Â result-&amp;gt;refCount_.store(&lt;span&gt;1&lt;/span&gt;,Â &lt;span&gt;std&lt;/span&gt;::memory_order_release);&lt;br/&gt;Â Â Â Â Â Â *sizeÂ =Â (allocSizeÂ -Â getDataOffset())Â /Â &lt;span&gt;sizeof&lt;/span&gt;(Char)Â -Â &lt;span&gt;1&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â result;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;static&lt;/span&gt;Â RefCounted*Â &lt;span&gt;create&lt;/span&gt;&lt;span&gt;(&lt;span&gt;const&lt;/span&gt;Â Char*Â data,Â &lt;span&gt;size_t&lt;/span&gt;*Â size)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â effectiveSizeÂ =Â *size;&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;auto&lt;/span&gt;Â resultÂ =Â create(size);&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;if&lt;/span&gt;Â (FOLLY_LIKELY(effectiveSizeÂ &amp;gt;Â &lt;span&gt;0&lt;/span&gt;))Â {&lt;br/&gt;Â Â Â Â Â Â Â Â fbstring_detail::podCopy(data,Â dataÂ +Â effectiveSize,Â result-&amp;gt;data_);&lt;br/&gt;Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â result;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â };&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;ml*.data*æŒ‡å‘çš„æ˜¯ RefCounted.data_.&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;getDataOffset()ç”¨ offsetof å‡½æ•°è·å– data*åœ¨ RefCounted ç»“æ„ä½“å†…çš„åç§»ï¼Œ&lt;code&gt;Char data*[1]&lt;/code&gt;ä¸º flexible arrayï¼Œå­˜æ”¾å­—ç¬¦ä¸²ã€‚&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;æ³¨æ„å¯¹&lt;code&gt;std::atomic&amp;lt;size_t&amp;gt; refCount_&lt;/code&gt;è¿›è¡ŒåŸå­æ“ä½œçš„ c++ memory model :&lt;/section&gt;&lt;/li&gt;&lt;ul class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;storeï¼Œè®¾ç½®å¼•ç”¨æ•°ä¸º 1 : std::memory_order_release&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;loadï¼Œè·å–å½“å‰å…±äº«å­—ç¬¦ä¸²çš„å¼•ç”¨æ•°: std::memory_order_acquire&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;add/subã€‚å¢åŠ /å‡å°‘ä¸€ä¸ªå¼•ç”¨ : std::memory_order_acq_rel&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;c++ memory model æ˜¯å¦å¤–ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è¯é¢˜ï¼Œå¯ä»¥å‚è€ƒï¼š&lt;/p&gt;&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; class=&quot;list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;Memory model synchronization modes&lt;/span&gt;&lt;sup&gt;[7]&lt;/sup&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzAxNDI5NzEzNg==&amp;amp;mid=2651159677&amp;amp;idx=1&amp;amp;sn=f246d11601ed006b592f813e27f6a4fc&amp;amp;scene=21#wechat_redirect&quot; data-linktype=&quot;2&quot;&gt;ä¸€æ–‡å¸¦ä½ çœ‹æ‡‚ C++11 çš„å†…å­˜æ¨¡å‹&lt;/a&gt;&lt;/section&gt;&lt;/li&gt;&lt;li&gt;&lt;section&gt;&lt;span&gt;C++11 ä¸­çš„å†…å­˜æ¨¡å‹ä¸‹ç¯‡ - C++11 æ”¯æŒçš„å‡ ç§å†…å­˜æ¨¡å‹&lt;/span&gt;&lt;sup&gt;[8]&lt;/sup&gt;&lt;/section&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;ç‰¹æ®Šçš„æ„é€ å‡½æ•° â€”â€” ä¸æ‹·è´ç”¨æˆ·ä¼ å…¥çš„å­—ç¬¦ä¸²&lt;/h2&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šé¢çš„ä¸‰ç§æ„é€ ï¼Œéƒ½æ˜¯å°†åº”ç”¨ç¨‹åºä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œä¸ç®¡ä½¿ç”¨ word-wise copy è¿˜æ˜¯ memcpyï¼Œæ‹·è´åˆ° fbstring_core ä¸­ï¼Œä¸”åœ¨ medium å’Œ large çš„æƒ…å†µä¸‹ï¼Œéœ€è¦åŠ¨æ€åˆ†é…å†…å­˜ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;fbstring æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„æ„é€ å‡½æ•°ï¼Œè®© fbstring_core æ¥ç®¡åº”ç”¨ç¨‹åºè‡ªå·±åˆ†é…çš„å†…å­˜ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;basic_fbstring çš„æ„é€ å‡½æ•°ï¼Œå¹¶è°ƒç”¨ fbstring_core ç›¸åº”çš„æ„é€ å‡½æ•°ã€‚&lt;strong&gt;æ³¨æ„è¿™é‡Œ AcquireMallocatedString ä¸º enum classï¼Œæ¯”ä½¿ç”¨ int å’Œ bool æ›´å¯è¯»ã€‚&lt;/strong&gt;&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;/**&lt;br/&gt;Â *Â DefinesÂ aÂ specialÂ acquisitionÂ methodÂ forÂ constructingÂ fbstring&lt;br/&gt;Â *Â objects.Â AcquireMallocatedStringÂ meansÂ thatÂ theÂ userÂ passesÂ a&lt;br/&gt;Â *Â pointerÂ toÂ aÂ malloc-allocatedÂ stringÂ thatÂ theÂ fbstringÂ objectÂ will&lt;br/&gt;Â *Â takeÂ intoÂ custody.&lt;br/&gt;Â */&lt;/span&gt;&lt;br/&gt;&lt;span&gt;enum&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;AcquireMallocatedString&lt;/span&gt;Â {&lt;/span&gt;};&lt;br/&gt;&lt;br/&gt;&lt;span&gt;//Â NonstandardÂ constructor&lt;/span&gt;&lt;br/&gt;basic_fbstring(value_typeÂ *s,Â size_typeÂ n,Â size_typeÂ c,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â AcquireMallocatedStringÂ a)&lt;br/&gt;Â Â Â Â Â Â :Â store_(s,Â n,Â c,Â a)Â {&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;basic_fbstring è°ƒç”¨ç›¸åº”çš„ fbstring_core æ„é€ å‡½æ•°ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//Â SnatchesÂ aÂ previouslyÂ mallocatedÂ string.Â TheÂ parameterÂ &quot;size&quot;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â isÂ theÂ sizeÂ ofÂ theÂ string,Â andÂ theÂ parameterÂ &quot;allocatedSize&quot;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â isÂ theÂ sizeÂ ofÂ theÂ mallocatedÂ block.Â Â TheÂ stringÂ mustÂ be&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â \0-terminated,Â soÂ allocatedSizeÂ &amp;gt;=Â sizeÂ +Â 1Â andÂ data[size]Â ==Â &#x27;\0&#x27;.&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â SoÂ ifÂ youÂ wantÂ aÂ 2-characterÂ string,Â passÂ malloc(3)Â asÂ &quot;data&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;//Â passÂ 2Â asÂ &quot;size&quot;,Â andÂ passÂ 3Â asÂ &quot;allocatedSize&quot;.&lt;/span&gt;&lt;br/&gt;fbstring_core(CharÂ *Â &lt;span&gt;const&lt;/span&gt;Â data,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â size,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;const&lt;/span&gt;Â &lt;span&gt;size_t&lt;/span&gt;Â allocatedSize,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â AcquireMallocatedString)Â {&lt;br/&gt;Â Â &lt;span&gt;if&lt;/span&gt;Â (sizeÂ &amp;gt;Â &lt;span&gt;0&lt;/span&gt;)Â {&lt;br/&gt;Â Â Â Â FBSTRING_ASSERT(allocatedSizeÂ &amp;gt;=Â sizeÂ +Â &lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;Â Â Â Â FBSTRING_ASSERT(data[size]Â ==Â &lt;span&gt;&#x27;\0&#x27;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â UseÂ theÂ mediumÂ stringÂ storage&lt;/span&gt;&lt;br/&gt;Â Â Â Â ml_.data_Â =Â data;&lt;br/&gt;Â Â Â Â ml_.size_Â =Â size;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â Don&#x27;tÂ forgetÂ aboutÂ nullÂ terminator&lt;/span&gt;&lt;br/&gt;Â Â Â Â ml_.setCapacity(allocatedSizeÂ -Â &lt;span&gt;1&lt;/span&gt;,Â Category::isMedium);&lt;br/&gt;Â Â }Â &lt;span&gt;else&lt;/span&gt;Â {&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â NoÂ needÂ forÂ theÂ memory&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;free&lt;/span&gt;(data);&lt;br/&gt;Â Â Â Â reset();&lt;br/&gt;Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯ä»¥çœ‹å‡ºè¿™é‡Œæ²¡æœ‰æ‹·è´å­—ç¬¦ä¸²çš„è¿‡ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥æ¥ç®¡äº†ä¸Šæ¸¸ä¼ é€’è¿‡æ¥çš„æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æ³¨é‡Šè¯´çš„ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨äº† medium strings çš„å­˜å‚¨æ–¹å¼ã€‚&lt;/p&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯”å¦‚ folly/io/IOBuf.cpp ä¸­çš„è°ƒç”¨ï¼š&lt;/p&gt;&lt;pre data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span/&gt;&lt;code&gt;&lt;span&gt;//Â EnsureÂ NULÂ terminated&lt;/span&gt;&lt;br/&gt;*writableTail()Â =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;&lt;span&gt;fbstringÂ &lt;span&gt;str&lt;/span&gt;&lt;span&gt;(&lt;br/&gt;Â Â Â Â Â Â &lt;span&gt;reinterpret_cast&lt;/span&gt;&amp;lt;&lt;span&gt;char&lt;/span&gt;*&amp;gt;(writableData()),&lt;br/&gt;Â Â Â Â Â Â length(),&lt;br/&gt;Â Â Â Â Â Â capacity(),&lt;br/&gt;Â Â Â Â Â Â AcquireMallocatedString())&lt;/span&gt;&lt;/span&gt;;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;å‚è€ƒèµ„æ–™&lt;/span&gt;&lt;/h3&gt;&lt;section data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span&gt;&lt;span&gt;[1]&lt;/span&gt;&lt;p&gt;fbstring: &lt;em&gt;https://github.com/facebook/folly/blob/master/folly/docs/FBString.md&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[2]&lt;/span&gt;&lt;p&gt;Legality of COW std::string implementation in C++11: &lt;em&gt;https://stackoverflow.com/questions/12199710/legality-of-cow-stdstring-implementation-in-c11&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[3]&lt;/span&gt;&lt;p&gt;std::string çš„ Copy-on-Writeï¼šä¸å¦‚æƒ³è±¡ä¸­ç¾å¥½: &lt;em&gt;https://www.cnblogs.com/promise6522/archive/2012/03/22/2412686.html&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[4]&lt;/span&gt;&lt;p&gt;jemalloc: &lt;em&gt;http://jemalloc.net/&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[5]&lt;/span&gt;&lt;p&gt;Boyer-Moore algorithm: &lt;em&gt;https://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_string-search_algorithm&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[6]&lt;/span&gt;&lt;p&gt;FBStringBenchmark.cpp: &lt;em&gt;https://github.com/facebook/folly/blob/master/folly/test/FBStringBenchmark.cpp&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[7]&lt;/span&gt;&lt;p&gt;Memory model synchronization modes: &lt;em&gt;https://gcc.gnu.org/wiki/Atomic/GCCMM/AtomicSync&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;[8]&lt;/span&gt;&lt;p&gt;C++11 ä¸­çš„å†…å­˜æ¨¡å‹ä¸‹ç¯‡ - C++11 æ”¯æŒçš„å‡ ç§å†…å­˜æ¨¡å‹: &lt;em&gt;https://www.codedump.info/post/20191214-cxx11-memory-model-2/&lt;/em&gt;&lt;/p&gt;&lt;/span&gt;&lt;/section&gt;&lt;/section&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>