<?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
            <channel>
            <title>å¼€å‘è€…å¤´æ¡</title>
            <link>http://toutiao.io/</link>
            <description></description>
<item>
<guid>dd90df23f462174300ae154c29e396f0</guid>
<title>èµ„æ–™ | Linkedin å·¥ç¨‹å›¢é˜Ÿå‡ºå“çš„ SRE å…¥é—¨æ•™ç¨‹</title>
<link>https://toutiao.io/k/zak7avs</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;profile_inner&quot;&gt;
                              &lt;strong class=&quot;profile_nickname&quot;&gt;å¼€å‘è€…å¤´æ¡&lt;/strong&gt;
                              &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;/&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;Weixin ID&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;kaifazhetoutiao&lt;/span&gt;
                              &lt;/p&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;About Feature&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;ç¨‹åºå‘˜åˆ†äº«å¹³å° | å®˜æ–¹åº”ç”¨ä¸‹è½½åœ°å€ï¼šhttp://toutiao.io/download&lt;/span&gt;
                              &lt;/p&gt;
                              
                          &lt;/div&gt;
                          &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>f9c03ef0ee7b37d084a3daa5a1b94123</guid>
<title>Hadoop æ¡†æ¶ï¼šMapReduce åŸºæœ¬åŸç†å’Œå…¥é—¨æ¡ˆä¾‹</title>
<link>https://toutiao.io/k/x2r860r</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;h1&gt;&lt;span&gt;ä¸€ã€MapReduceæ¦‚è¿°&lt;/span&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span&gt;1ã€åŸºæœ¬æ¦‚å¿µ&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;Hadoopæ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼šåˆ†å¸ƒå¼è®¡ç®—çš„æ–¹æ¡ˆMapReduceï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹æ¨¡å‹ï¼Œç”¨äºå¤§è§„æ¨¡æ•°æ®é›†çš„å¹¶è¡Œè¿ç®—ï¼Œå…¶ä¸­Mapï¼ˆæ˜ å°„ï¼‰å’ŒReduceï¼ˆå½’çº¦ï¼‰ã€‚&lt;/p&gt;&lt;p&gt;MapReduceæ—¢æ˜¯ä¸€ä¸ªç¼–ç¨‹æ¨¡å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè®¡ç®—ç»„ä»¶ï¼Œå¤„ç†çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼ŒMapé˜¶æ®µï¼šè´Ÿè´£æŠŠä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªå°ä»»åŠ¡ï¼ŒReduceè´Ÿè´£æŠŠå¤šä¸ªå°ä»»åŠ¡çš„å¤„ç†ç»“æœè¿›è¡Œæ±‡æ€»ã€‚å…¶ä¸­Mapé˜¶æ®µä¸»è¦è¾“å…¥æ˜¯ä¸€å¯¹Key-Valueï¼Œç»è¿‡mapè®¡ç®—åè¾“å‡ºä¸€å¯¹Key-Valueå€¼ï¼›ç„¶åå°†ç›¸åŒKeyåˆå¹¶ï¼Œå½¢æˆKey-Valueé›†åˆï¼›å†å°†è¿™ä¸ªKey-Valueé›†åˆè½¬å…¥Reduceé˜¶æ®µï¼Œç»è¿‡è®¡ç®—è¾“å‡ºæœ€ç»ˆKey-Valueç»“æœé›†ã€‚&lt;/p&gt;&lt;h2&gt;&lt;span&gt;2ã€ç‰¹ç‚¹æè¿°&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;MapReduceå¯ä»¥å®ç°åŸºäºä¸Šåƒå°æœåŠ¡å™¨å¹¶å‘å·¥ä½œï¼Œæä¾›å¾ˆå¼ºå¤§çš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œå¦‚æœå…¶ä¸­å•å°æœåŠ¡æŒ‚æ‰ï¼Œè®¡ç®—ä»»åŠ¡ä¼šè‡ªåŠ¨è½¬ä¹‰åˆ°å¦å¤–èŠ‚ç‚¹æ‰§è¡Œï¼Œä¿è¯é«˜å®¹é”™æ€§ï¼›ä½†æ˜¯MapReduceä¸é€‚åº”äºå®æ—¶è®¡ç®—ä¸æµå¼è®¡ç®—ï¼Œè®¡ç®—çš„æ•°æ®æ˜¯é™æ€çš„ã€‚&lt;/p&gt;&lt;h1&gt;&lt;span&gt;äºŒã€æ“ä½œæ¡ˆä¾‹&lt;/span&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span&gt;1ã€æµç¨‹æè¿°&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.3671875&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvBMfiaK0lXA3qezX67I3l9AOe7A0Y3P1DF6fGKxjY5gKwLHlmtkfgpjzrmIkwe6hdHxJLCvAU8ibPbA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1280&quot;/&gt;&lt;/p&gt;&lt;p&gt;æ•°æ®æ–‡ä»¶ä¸€èˆ¬ä»¥CSVæ ¼å¼å±…å¤šï¼Œæ•°æ®è¡Œé€šå¸¸ä»¥ç©ºæ ¼åˆ†éš”ï¼Œè¿™é‡Œéœ€è¦è€ƒè™‘æ•°æ®å†…å®¹ç‰¹ç‚¹ï¼›&lt;/p&gt;&lt;p&gt;æ–‡ä»¶ç»è¿‡åˆ‡ç‰‡åˆ†é…åœ¨ä¸åŒçš„MapTaskä»»åŠ¡ä¸­å¹¶å‘æ‰§è¡Œï¼›&lt;/p&gt;&lt;p&gt;MapTaskä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ‰§è¡ŒReduceTaskä»»åŠ¡ï¼Œä¾èµ–Mapé˜¶æ®µçš„æ•°æ®ï¼›&lt;/p&gt;&lt;p&gt;ReduceTaskä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œè¾“å‡ºæ–‡ä»¶ç»“æœã€‚&lt;/p&gt;&lt;h2&gt;&lt;span&gt;2ã€åŸºç¡€é…ç½®&lt;/span&gt;&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;hadoop:&lt;br/&gt;Â Â &lt;span&gt;#Â è¯»å–çš„æ–‡ä»¶æº&lt;/span&gt;&lt;br/&gt;Â Â inputPath:Â hdfs:&lt;span&gt;//hop01:9000/hopdir/javaNew.txt&lt;/span&gt;&lt;br/&gt;Â Â &lt;span&gt;#Â è¯¥è·¯å¾„å¿…é¡»æ˜¯ç¨‹åºè¿è¡Œå‰ä¸å­˜åœ¨çš„&lt;/span&gt;&lt;br/&gt;Â Â outputPath:Â /wordOut&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;span&gt;3ã€Mapperç¨‹åº&lt;/span&gt;&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;WordMapper&lt;/span&gt;Â &lt;span&gt;extends&lt;/span&gt;Â &lt;span&gt;Mapper&lt;/span&gt;&amp;lt;&lt;span&gt;LongWritable&lt;/span&gt;,Â &lt;span&gt;Text&lt;/span&gt;,Â &lt;span&gt;Text&lt;/span&gt;,Â &lt;span&gt;IntWritable&lt;/span&gt;&amp;gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â TextÂ mapKeyÂ =Â &lt;span&gt;new&lt;/span&gt;Â Text();&lt;br/&gt;Â Â Â Â IntWritableÂ mapValueÂ =Â &lt;span&gt;new&lt;/span&gt;Â IntWritable(&lt;span&gt;1&lt;/span&gt;);&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;protected&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;map&lt;/span&gt;Â &lt;span&gt;(LongWritableÂ key,Â TextÂ value,Â ContextÂ context)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;throws&lt;/span&gt;Â IOException,Â InterruptedExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â 1ã€è¯»å–è¡Œ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â StringÂ lineÂ =Â value.toString();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â 2ã€è¡Œå†…å®¹åˆ‡å‰²ï¼Œæ ¹æ®æ–‡ä»¶ä¸­åˆ†éš”ç¬¦&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â String[]Â wordsÂ =Â line.split(&lt;span&gt;&quot;Â &quot;&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â 3ã€å­˜å‚¨&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (StringÂ wordÂ :Â words)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â mapKey.set(word);&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â context.write(mapKey,Â mapValue);&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;span&gt;4ã€Reducerç¨‹åº&lt;/span&gt;&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;WordReducer&lt;/span&gt;Â &lt;span&gt;extends&lt;/span&gt;Â &lt;span&gt;Reducer&lt;/span&gt;&amp;lt;&lt;span&gt;Text&lt;/span&gt;,Â &lt;span&gt;IntWritable&lt;/span&gt;,Â &lt;span&gt;Text&lt;/span&gt;,Â &lt;span&gt;IntWritable&lt;/span&gt;&amp;gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;int&lt;/span&gt;Â sumÂ ;&lt;br/&gt;Â Â Â Â IntWritableÂ valueÂ =Â &lt;span&gt;new&lt;/span&gt;Â IntWritable();&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;protected&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;reduce&lt;/span&gt;&lt;span&gt;(TextÂ key,Â Iterable&amp;lt;IntWritable&amp;gt;Â values,ContextÂ context)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;throws&lt;/span&gt;Â IOException,Â InterruptedExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â 1ã€ç´¯åŠ æ±‚å’Œç»Ÿè®¡&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â sumÂ =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (IntWritableÂ countÂ :Â values)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â sumÂ +=Â count.get();&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â 2ã€è¾“å‡ºç»“æœ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â value.set(sum);&lt;br/&gt;Â Â Â Â Â Â Â Â context.write(key,value);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;span&gt;5ã€æ‰§è¡Œç¨‹åº&lt;/span&gt;&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;@RestController&lt;/span&gt;&lt;br/&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;WordWeb&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Resource&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â MapReduceConfigÂ mapReduceConfigÂ ;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@GetMapping&lt;/span&gt;(&lt;span&gt;&quot;/getWord&quot;&lt;/span&gt;)&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â StringÂ &lt;span&gt;getWord&lt;/span&gt;Â &lt;span&gt;()&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â IOException,Â ClassNotFoundException,Â InterruptedExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â å£°æ˜é…ç½®&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â ConfigurationÂ hadoopConfigÂ =Â &lt;span&gt;new&lt;/span&gt;Â Configuration();&lt;br/&gt;Â Â Â Â Â Â Â Â hadoopConfig.set(&lt;span&gt;&quot;fs.hdfs.impl&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â org.apache.hadoop.hdfs.DistributedFileSystem.class.getName()&lt;br/&gt;Â Â Â Â Â Â Â Â );&lt;br/&gt;Â Â Â Â Â Â Â Â hadoopConfig.set(&lt;span&gt;&quot;fs.file.impl&quot;&lt;/span&gt;,&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â org.apache.hadoop.fs.LocalFileSystem.class.getName()&lt;br/&gt;Â Â Â Â Â Â Â Â );&lt;br/&gt;Â Â Â Â Â Â Â Â JobÂ jobÂ =Â Job.getInstance(hadoopConfig);&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â Jobæ‰§è¡Œä½œä¸šÂ è¾“å…¥è·¯å¾„&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â FileInputFormat.addInputPath(job,Â &lt;span&gt;new&lt;/span&gt;Â Path(mapReduceConfig.getInputPath()));&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â Jobæ‰§è¡Œä½œä¸šÂ è¾“å‡ºè·¯å¾„&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â FileOutputFormat.setOutputPath(job,Â &lt;span&gt;new&lt;/span&gt;Â Path(mapReduceConfig.getOutputPath()));&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â è‡ªå®šä¹‰Â Mapperå’ŒReducerÂ ä¸¤ä¸ªé˜¶æ®µçš„ä»»åŠ¡å¤„ç†ç±»&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â job.setMapperClass(WordMapper.class);&lt;br/&gt;Â Â Â Â Â Â Â Â job.setReducerClass(WordReducer.class);&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â è®¾ç½®è¾“å‡ºç»“æœçš„Keyå’ŒValueçš„ç±»å‹&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â job.setOutputKeyClass(Text.class);&lt;br/&gt;Â Â Â Â Â Â Â Â job.setOutputValueClass(IntWritable.class);&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//æ‰§è¡ŒJobç›´åˆ°å®Œæˆ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â job.waitForCompletion(&lt;span&gt;true&lt;/span&gt;);&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;return&lt;/span&gt;Â &lt;span&gt;&quot;success&quot;&lt;/span&gt;Â ;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;span&gt;6ã€æ‰§è¡Œç»“æœæŸ¥çœ‹&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;å°†åº”ç”¨ç¨‹åºæ‰“åŒ…æ”¾åˆ°hop01æœåŠ¡ä¸Šæ‰§è¡Œï¼›&lt;/p&gt;&lt;pre&gt;&lt;code&gt;javaÂ -jarÂ &lt;span&gt;map&lt;/span&gt;-reduce-case01.jar&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.5587628865979382&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvBMfiaK0lXA3qezX67I3l9AOWC6Uiah1aNeBBVtabria5TxO2ZQPcu15HwibianEM8SoEsRSuqyfPnIbzQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;970&quot;/&gt;&lt;/p&gt;&lt;h1&gt;&lt;span&gt;ä¸‰ã€æ¡ˆä¾‹åˆ†æ&lt;/span&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span&gt;1ã€æ•°æ®ç±»å‹&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;Javaæ•°æ®ç±»å‹ä¸å¯¹åº”çš„Hadoopæ•°æ®åºåˆ—åŒ–ç±»å‹ï¼›&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.4794520547945205&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvBMfiaK0lXA3qezX67I3l9AO999VxYKd4ViaSMbIeyOOJHVrL93icHUEMbDRrHLiaxY8z9t891aqXcccw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;876&quot;/&gt;&lt;/p&gt;&lt;h2&gt;&lt;span&gt;2ã€æ ¸å¿ƒæ¨¡å—&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Mapperæ¨¡å—&lt;/strong&gt;ï¼šå¤„ç†è¾“å…¥çš„æ•°æ®ï¼Œä¸šåŠ¡é€»è¾‘åœ¨map()æ–¹æ³•ä¸­å®Œæˆï¼Œè¾“å‡ºçš„æ•°æ®ä¹Ÿæ˜¯KVæ ¼å¼ï¼›&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Reduceræ¨¡å—&lt;/strong&gt;ï¼šå¤„ç†Mapç¨‹åºè¾“å‡ºçš„KVæ•°æ®ï¼Œä¸šåŠ¡é€»è¾‘åœ¨reduce()æ–¹æ³•ä¸­ï¼›&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Driveræ¨¡å—&lt;/strong&gt;ï¼šå°†ç¨‹åºæäº¤åˆ°yarnè¿›è¡Œè°ƒåº¦ï¼Œæäº¤å°è£…äº†è¿è¡Œå‚æ•°çš„jobå¯¹è±¡ï¼›&lt;/p&gt;&lt;h1&gt;&lt;span&gt;å››ã€åºåˆ—åŒ–æ“ä½œ&lt;/span&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span&gt;1ã€åºåˆ—åŒ–ç®€ä»‹&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;åºåˆ—åŒ–ï¼šå°†å†…å­˜ä¸­å¯¹è±¡è½¬æ¢ä¸ºäºŒè¿›åˆ¶çš„å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥é€šè¿‡è¾“å‡ºæµæŒä¹…åŒ–å­˜å‚¨æˆ–è€…ç½‘ç»œä¼ è¾“ï¼›&lt;/p&gt;&lt;p&gt;ååºåˆ—åŒ–ï¼šæ¥æ”¶è¾“å…¥å­—èŠ‚æµæˆ–è€…è¯»å–ç£ç›˜æŒä¹…åŒ–çš„æ•°æ®ï¼ŒåŠ è½½åˆ°å†…å­˜çš„å¯¹è±¡è¿‡ç¨‹ï¼›&lt;/p&gt;&lt;p&gt;Hadoopåºåˆ—åŒ–ç›¸å…³æ¥å£ï¼šWritableå®ç°çš„åºåˆ—åŒ–æœºåˆ¶ã€Comparableç®¡ç†Keyçš„æ’åºé—®é¢˜ï¼›&lt;/p&gt;&lt;h2&gt;&lt;span&gt;2ã€æ¡ˆä¾‹å®ç°&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;æ¡ˆä¾‹æè¿°ï¼šè¯»å–æ–‡ä»¶ï¼Œå¹¶å¯¹æ–‡ä»¶ç›¸åŒçš„è¡Œåšæ•°æ®ç´¯åŠ è®¡ç®—ï¼Œè¾“å‡ºè®¡ç®—ç»“æœï¼›è¯¥æ¡ˆä¾‹æ¼”ç¤ºåœ¨æœ¬åœ°æ‰§è¡Œï¼Œä¸æŠŠJaråŒ…ä¸Šä¼ çš„hadoopæœåŠ¡å™¨ï¼Œé©±åŠ¨é…ç½®ä¸€è‡´ã€‚&lt;/p&gt;&lt;p&gt;&lt;strong&gt;å®ä½“å¯¹è±¡å±æ€§&lt;/strong&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;AddEntity&lt;/span&gt;Â &lt;span&gt;implements&lt;/span&gt;Â &lt;span&gt;Writable&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â addNum01;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â addNum02;&lt;br/&gt;Â Â Â Â &lt;span&gt;private&lt;/span&gt;Â &lt;span&gt;long&lt;/span&gt;Â resNum;&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â æ„é€ æ–¹æ³•&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;AddEntity&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;super&lt;/span&gt;();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;AddEntity&lt;/span&gt;&lt;span&gt;(&lt;span&gt;long&lt;/span&gt;Â addNum01,Â &lt;span&gt;long&lt;/span&gt;Â addNum02)&lt;/span&gt;Â &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;super&lt;/span&gt;();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.addNum01Â =Â addNum01;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.addNum02Â =Â addNum02;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.resNumÂ =Â addNum01Â +Â addNum02;&lt;br/&gt;Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â åºåˆ—åŒ–&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;write&lt;/span&gt;&lt;span&gt;(DataOutputÂ dataOutput)&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â IOExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â dataOutput.writeLong(addNum01);&lt;br/&gt;Â Â Â Â Â Â Â Â dataOutput.writeLong(addNum02);&lt;br/&gt;Â Â Â Â Â Â Â Â dataOutput.writeLong(resNum);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â ååºåˆ—åŒ–&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;readFields&lt;/span&gt;&lt;span&gt;(DataInputÂ dataInput)&lt;/span&gt;Â &lt;span&gt;throws&lt;/span&gt;Â IOExceptionÂ &lt;/span&gt;{&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æ³¨æ„ï¼šååºåˆ—åŒ–é¡ºåºå’Œå†™åºåˆ—åŒ–é¡ºåºä¸€è‡´&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.addNum01Â Â =Â dataInput.readLong();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.addNum02Â =Â dataInput.readLong();&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;this&lt;/span&gt;.resNumÂ =Â dataInput.readLong();&lt;br/&gt;Â Â Â Â }&lt;br/&gt;Â Â Â Â &lt;span&gt;//Â çœç•¥Getå’ŒSetæ–¹æ³•&lt;/span&gt;&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;Mapperæœºåˆ¶&lt;/strong&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;AddMapper&lt;/span&gt;Â &lt;span&gt;extends&lt;/span&gt;Â &lt;span&gt;Mapper&lt;/span&gt;&amp;lt;&lt;span&gt;LongWritable&lt;/span&gt;,Â &lt;span&gt;Text&lt;/span&gt;,Â &lt;span&gt;Text&lt;/span&gt;,Â &lt;span&gt;AddEntity&lt;/span&gt;&amp;gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â TextÂ myKeyÂ =Â &lt;span&gt;new&lt;/span&gt;Â Text();&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;protected&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;map&lt;/span&gt;&lt;span&gt;(LongWritableÂ key,Â TextÂ value,Â ContextÂ context)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;throws&lt;/span&gt;Â IOException,Â InterruptedExceptionÂ &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â è¯»å–è¡Œ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â StringÂ lineÂ =Â value.toString();&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â è¡Œå†…å®¹åˆ‡å‰²&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â String[]Â lineArrÂ =Â line.split(&lt;span&gt;&quot;,&quot;&lt;/span&gt;);&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â å†…å®¹æ ¼å¼å¤„ç†&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â StringÂ lineNumÂ =Â lineArr[&lt;span&gt;0&lt;/span&gt;];&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;long&lt;/span&gt;Â addNum01Â =Â Long.parseLong(lineArr[&lt;span&gt;1&lt;/span&gt;]);&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;long&lt;/span&gt;Â addNum02Â =Â Long.parseLong(lineArr[&lt;span&gt;2&lt;/span&gt;]);&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â myKey.set(lineNum);&lt;br/&gt;Â Â Â Â Â Â Â Â AddEntityÂ myValueÂ =Â &lt;span&gt;new&lt;/span&gt;Â AddEntity(addNum01,addNum02);&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â è¾“å‡º&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â context.write(myKey,Â myValue);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;Reduceræœºåˆ¶&lt;/strong&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;public&lt;/span&gt;Â &lt;span&gt;&lt;span&gt;class&lt;/span&gt;Â &lt;span&gt;AddReducer&lt;/span&gt;Â &lt;span&gt;extends&lt;/span&gt;Â &lt;span&gt;Reducer&lt;/span&gt;&amp;lt;&lt;span&gt;Text&lt;/span&gt;,Â &lt;span&gt;AddEntity&lt;/span&gt;,Â &lt;span&gt;Text&lt;/span&gt;,Â &lt;span&gt;AddEntity&lt;/span&gt;&amp;gt;Â &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;@Override&lt;/span&gt;&lt;br/&gt;Â Â Â Â &lt;span&gt;&lt;span&gt;protected&lt;/span&gt;Â &lt;span&gt;void&lt;/span&gt;Â &lt;span&gt;reduce&lt;/span&gt;&lt;span&gt;(TextÂ key,Â Iterable&amp;lt;AddEntity&amp;gt;Â values,Â ContextÂ context)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â &lt;span&gt;throws&lt;/span&gt;Â IOException,Â InterruptedExceptionÂ &lt;/span&gt;{&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;long&lt;/span&gt;Â addNum01SumÂ =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;long&lt;/span&gt;Â addNum02SumÂ =Â &lt;span&gt;0&lt;/span&gt;;&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â å¤„ç†Keyç›¸åŒ&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;for&lt;/span&gt;Â (AddEntityÂ addEntityÂ :Â values)Â {&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â addNum01SumÂ +=Â addEntity.getAddNum01();&lt;br/&gt;Â Â Â Â Â Â Â Â Â Â Â Â addNum02SumÂ +=Â addEntity.getAddNum02();&lt;br/&gt;Â Â Â Â Â Â Â Â }&lt;br/&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â &lt;span&gt;//Â æœ€ç»ˆè¾“å‡º&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â AddEntityÂ addResÂ =Â &lt;span&gt;new&lt;/span&gt;Â AddEntity(addNum01Sum,Â addNum02Sum);&lt;br/&gt;Â Â Â Â Â Â Â Â context.write(key,Â addRes);&lt;br/&gt;Â Â Â Â }&lt;br/&gt;}&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ¡ˆä¾‹æœ€ç»ˆç»“æœï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages js_insertlocalimg&quot; data-ratio=&quot;0.366&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvBMfiaK0lXA3qezX67I3l9AO9KYVrIJvskZOIrwm0rUfAQicj5AjS7X4jJpLIYKP6hbVgiaX726lK4xw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1000&quot;/&gt;&lt;/p&gt;&lt;h1&gt;&lt;span&gt;äº”ã€æºä»£ç åœ°å€&lt;/span&gt;&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;GitHubÂ·åœ°å€&lt;br/&gt;https:&lt;span&gt;//github.com/cicadasmile/big-data-parent&lt;/span&gt;&lt;br/&gt;GitEEÂ·åœ°å€&lt;br/&gt;https:&lt;span&gt;//gitee.com/cicadasmile/big-data-parent&lt;/span&gt;&lt;br/&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.3783359497645212&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/uUIibyNXbAvCjMheLZtcM2iaVMBOpIUKR4CDRCG9FLT5K6NmGXvG7exrW0TSuDjnTKJQ5PDq8j8Y7PHDd17Z3gicA/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1274&quot;/&gt;&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>9944d0bfa57fb553ea6a64918ebd8c04</guid>
<title>Go å¹¶å‘ç¼–ç¨‹ï¼ˆä¸€ï¼‰ï¼šgoroutine</title>
<link>https://toutiao.io/k/5l5bvv8</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;markdown-body&quot; id=&quot;post-body&quot;&gt;&lt;blockquote&gt;&lt;p&gt;æœ¬ç³»åˆ—ä¸ºæå®¢æ—¶é—´ Go è¿›é˜¶è®­ç»ƒè¥ç¬”è®°ï¼ŒåŒæ­¥ç›´æ’­æ›´æ–°ï¼Œé¢„è®¡ä¸€å‘¨æ›´æ–° 1 ~ 2 ç¯‡æ–‡ç« ï¼Œåˆ° 202103 æœˆæ›´æ–°å®Œæˆ&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;æ¥ä¸‹æ¥ä¼šä¸€å…±ä¼šæœ‰ 4 - 6 ç¯‡æ–‡ç« è®²è§£ Go å¹¶å‘ç¼–ç¨‹ï¼Œå¹¶å‘ç¼–ç¨‹æœ¬èº«æ˜¯ä¸€ä¸ªæŒºå¤§çš„è¯é¢˜ï¼Œåœ¨ç¬¬å››å‘¨çš„ä¸¤èŠ‚è¯¾ï¼Œæ¯›è€å¸ˆèŠ±äº†å°†è¿‘ 7 ä¸ªå°æ—¶è®²è§£è¿™äº›å†…å®¹ï¼Œæˆ‘ä¹Ÿç»“åˆè‡ªå·±çš„ä¸€äº›å¾®ä¸è¶³é“çš„ç»éªŒï¼Œå†åŠ ä¸Šä¸€äº›å¤§ç¥ä»¬çš„æ–‡ç« ï¼Œæ•´ç†å‡ºäº†è¿™ä¸€éƒ¨åˆ†çš„ç¬”è®°ã€‚&lt;br/&gt;å½“ç„¶è¿™é‡Œæ›´å¤šçš„æ˜¯æŠ›ç –å¼•ç‰çš„ä½œç”¨ï¼Œæ›´å¤šçš„è¿˜æ˜¯æˆ‘ä»¬è‡ªå·±è¦æœ‰ç›¸å…³çš„æ„è¯†é¿å…è¸©å‘ï¼Œåœ¨å„ä¸ªå‘çš„è¾¹ç¼˜åå¤æ¨ªè·³ï¼Œå¯èƒ½æˆ‘ä»¬æœ‰ç¼˜ä¼šåœ¨åŒä¸€ä¸ªå‘ä¸­å‘ç°ï¼Œå’¦ï¼ŒåŸæ¥ä½ ä¹Ÿåœ¨è¿™é‡Œ ğŸ˜„&lt;/p&gt;&lt;h2 id=&quot;è¯·å¯¹ä½ åˆ›å»ºçš„-goroutine-è´Ÿè´£&quot;&gt;&lt;a href=&quot;#è¯·å¯¹ä½ åˆ›å»ºçš„-goroutine-è´Ÿè´£&quot; class=&quot;headerlink&quot; title=&quot;è¯·å¯¹ä½ åˆ›å»ºçš„ goroutine è´Ÿè´£&quot;/&gt;è¯·å¯¹ä½ åˆ›å»ºçš„ goroutine è´Ÿè´£&lt;/h2&gt;&lt;h3 id=&quot;ä¸è¦åˆ›å»ºä¸€ä¸ªä½ ä¸çŸ¥é“ä½•æ—¶é€€å‡ºçš„-goroutine&quot;&gt;&lt;a href=&quot;#ä¸è¦åˆ›å»ºä¸€ä¸ªä½ ä¸çŸ¥é“ä½•æ—¶é€€å‡ºçš„-goroutine&quot; class=&quot;headerlink&quot; title=&quot;ä¸è¦åˆ›å»ºä¸€ä¸ªä½ ä¸çŸ¥é“ä½•æ—¶é€€å‡ºçš„ goroutine&quot;/&gt;ä¸è¦åˆ›å»ºä¸€ä¸ªä½ ä¸çŸ¥é“ä½•æ—¶é€€å‡ºçš„ goroutine&lt;/h3&gt;&lt;p&gt;è¯·é˜…è¯»ä¸‹é¢è¿™æ®µä»£ç ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ä¸ºä»€ä¹ˆå…ˆä»ä¸‹é¢è¿™æ®µä»£ç å‡ºå‘ï¼Œæ˜¯å› ä¸ºåœ¨ä¹‹å‰çš„ç»éªŒé‡Œé¢æˆ‘ä»¬å†™äº†å¤§é‡ç±»ä¼¼çš„ä»£ç ï¼Œä¹‹å‰æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”è¿˜å› ä¸ºè¿™ç§ä»£ç å‡ºç°è¿‡çŸ­æš‚çš„äº‹æ•…&lt;/p&gt;&lt;/blockquote&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Week03/blog/01/01.go&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; (
&lt;span class=&quot;hljs-string&quot;&gt;&quot;log&quot;&lt;/span&gt;
&lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http&quot;&lt;/span&gt;
_ &lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http/pprof&quot;&lt;/span&gt;
)

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œé¢æœ‰ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œ&lt;/span&gt;
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
setup()

&lt;span class=&quot;hljs-comment&quot;&gt;// ä¸»æœåŠ¡&lt;/span&gt;
server()

&lt;span class=&quot;hljs-comment&quot;&gt;// for debug&lt;/span&gt;
pprof()

&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; {}
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
mux := http.NewServeMux()
mux.HandleFunc(&lt;span class=&quot;hljs-string&quot;&gt;&quot;/ping&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(w http.ResponseWriter, r *http.Request)&lt;/span&gt;&lt;/span&gt; {
w.Write([]&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;pong&quot;&lt;/span&gt;))
})

&lt;span class=&quot;hljs-comment&quot;&gt;// ä¸»æœåŠ¡&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := http.ListenAndServe(&lt;span class=&quot;hljs-string&quot;&gt;&quot;:8080&quot;&lt;/span&gt;, mux); err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {
log.Panicf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;http server err: %+v&quot;&lt;/span&gt;, err)
&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;
}
}()
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;pprof&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-comment&quot;&gt;// è¾…åŠ©æœåŠ¡ï¼Œç›‘å¬äº†å…¶ä»–ç«¯å£ï¼Œè¿™é‡Œæ˜¯ pprof æœåŠ¡ï¼Œç”¨äº debug&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; http.ListenAndServe(&lt;span class=&quot;hljs-string&quot;&gt;&quot;:8081&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;)
}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çµé­‚æ‹·é—®æ¥äº†ï¼Œè¯·é—®ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å¦‚æœ &lt;code&gt;server&lt;/code&gt; æ˜¯åœ¨å…¶ä»–åŒ…é‡Œé¢ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œä½ çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ä¹ˆï¼Ÿ&lt;/li&gt;&lt;li&gt;&lt;code&gt;main&lt;/code&gt; å‡½æ•°å½“ä¸­æœ€ååœ¨å“ªé‡Œç©ºè½¬å¹²ä»€ä¹ˆï¼Ÿä¼šä¸ä¼šå­˜åœ¨æµªè´¹ï¼Ÿ&lt;/li&gt;&lt;li&gt;å¦‚æœçº¿ä¸Šå‡ºç°äº‹æ•…ï¼Œdebug æœåŠ¡å·²ç»é€€å‡ºï¼Œä½ æƒ³è¦ debug è¿™æ—¶ä½ æ˜¯å¦å¾ˆèŒ«ç„¶ï¼Ÿ&lt;/li&gt;&lt;li&gt;å¦‚æœæŸä¸€å¤©æœåŠ¡çªç„¶é‡å¯ï¼Œä½ å´æ‰¾ä¸åˆ°äº‹æ•…æ—¥å¿—ï¼Œä½ æ˜¯å¦èƒ½æƒ³èµ·è¿™ä¸ª &lt;code&gt;8081&lt;/code&gt; ç«¯å£çš„æœåŠ¡ï¼Ÿ&lt;/li&gt;&lt;/ul&gt;&lt;h4 id=&quot;è¯·å°†é€‰æ‹©æƒç•™ç»™å¯¹æ–¹ï¼Œä¸è¦å¸®åˆ«äººåšé€‰æ‹©&quot;&gt;&lt;a href=&quot;#è¯·å°†é€‰æ‹©æƒç•™ç»™å¯¹æ–¹ï¼Œä¸è¦å¸®åˆ«äººåšé€‰æ‹©&quot; class=&quot;headerlink&quot; title=&quot;è¯·å°†é€‰æ‹©æƒç•™ç»™å¯¹æ–¹ï¼Œä¸è¦å¸®åˆ«äººåšé€‰æ‹©&quot;/&gt;è¯·å°†é€‰æ‹©æƒç•™ç»™å¯¹æ–¹ï¼Œä¸è¦å¸®åˆ«äººåšé€‰æ‹©&lt;/h4&gt;&lt;p&gt;è¯·æŠŠæ˜¯å¦å¹¶å‘çš„é€‰æ‹©æƒäº¤ç»™ä½ çš„è°ƒç”¨è€…ï¼Œè€Œä¸æ˜¯è‡ªå·±å°±ç›´æ¥æ‚„æ‚„çš„ç”¨ä¸Šäº† goroutine&lt;br/&gt;ä¸‹é¢è¿™æ¬¡æ”¹åŠ¨å°†ä¸¤ä¸ªå‡½æ•°æ˜¯å¦å¹¶å‘æ“ä½œçš„é€‰æ‹©æƒç•™ç»™äº† main å‡½æ•°&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; (
&lt;span class=&quot;hljs-string&quot;&gt;&quot;log&quot;&lt;/span&gt;
&lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http&quot;&lt;/span&gt;
_ &lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http/pprof&quot;&lt;/span&gt;
)

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œé¢æœ‰ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œ&lt;/span&gt;
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
setup()

&lt;span class=&quot;hljs-comment&quot;&gt;// for debug&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; pprof()

&lt;span class=&quot;hljs-comment&quot;&gt;// ä¸»æœåŠ¡&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; server()

&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; {}
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
mux := http.NewServeMux()
mux.HandleFunc(&lt;span class=&quot;hljs-string&quot;&gt;&quot;/ping&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(w http.ResponseWriter, r *http.Request)&lt;/span&gt;&lt;/span&gt; {
w.Write([]&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;pong&quot;&lt;/span&gt;))
})

&lt;span class=&quot;hljs-comment&quot;&gt;// ä¸»æœåŠ¡&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := http.ListenAndServe(&lt;span class=&quot;hljs-string&quot;&gt;&quot;:8080&quot;&lt;/span&gt;, mux); err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {
log.Panicf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;http server err: %+v&quot;&lt;/span&gt;, err)
&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;
}
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;pprof&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-comment&quot;&gt;// è¾…åŠ©æœåŠ¡ï¼Œç›‘å¬äº†å…¶ä»–ç«¯å£ï¼Œè¿™é‡Œæ˜¯ pprof æœåŠ¡ï¼Œç”¨äº debug&lt;/span&gt;
http.ListenAndServe(&lt;span class=&quot;hljs-string&quot;&gt;&quot;:8081&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;)
}&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&quot;è¯·ä¸è¦ä½œä¸ºä¸€ä¸ªæ—è§‚è€…&quot;&gt;&lt;a href=&quot;#è¯·ä¸è¦ä½œä¸ºä¸€ä¸ªæ—è§‚è€…&quot; class=&quot;headerlink&quot; title=&quot;è¯·ä¸è¦ä½œä¸ºä¸€ä¸ªæ—è§‚è€…&quot;/&gt;è¯·ä¸è¦ä½œä¸ºä¸€ä¸ªæ—è§‚è€…&lt;/h4&gt;&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸è¦è®©ä¸»è¿›ç¨‹æˆä¸ºä¸€ä¸ªæ—è§‚è€…ï¼Œæ˜æ˜å¯ä»¥å¹²æ´»ï¼Œä½†æ˜¯æœ€åä½¿ç”¨äº†ä¸€ä¸ª &lt;code&gt;select&lt;/code&gt; åœ¨é‚£å„¿ç©ºè·‘&lt;br/&gt;æ„Ÿè°¢ä¸Šä¸€æ­¥å°†æ˜¯å¦å¼‚æ­¥çš„é€‰æ‹©æƒäº¤ç»™äº†æˆ‘( &lt;code&gt;main&lt;/code&gt; )ï¼Œåœ¨æ—è¾¹çœ‹ç€ä¹Ÿæ€ªå°´å°¬çš„&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; (
&lt;span class=&quot;hljs-string&quot;&gt;&quot;log&quot;&lt;/span&gt;
&lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http&quot;&lt;/span&gt;
_ &lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http/pprof&quot;&lt;/span&gt;
)

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œé¢æœ‰ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œ&lt;/span&gt;
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
setup()

&lt;span class=&quot;hljs-comment&quot;&gt;// for debug&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; pprof()

&lt;span class=&quot;hljs-comment&quot;&gt;// ä¸»æœåŠ¡&lt;/span&gt;
server()
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
mux := http.NewServeMux()
mux.HandleFunc(&lt;span class=&quot;hljs-string&quot;&gt;&quot;/ping&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(w http.ResponseWriter, r *http.Request)&lt;/span&gt;&lt;/span&gt; {
w.Write([]&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;pong&quot;&lt;/span&gt;))
})

&lt;span class=&quot;hljs-comment&quot;&gt;// ä¸»æœåŠ¡&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := http.ListenAndServe(&lt;span class=&quot;hljs-string&quot;&gt;&quot;:8080&quot;&lt;/span&gt;, mux); err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {
log.Panicf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;http server err: %+v&quot;&lt;/span&gt;, err)
&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;
}
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;pprof&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-comment&quot;&gt;// è¾…åŠ©æœåŠ¡ï¼Œç›‘å¬äº†å…¶ä»–ç«¯å£ï¼Œè¿™é‡Œæ˜¯ pprof æœåŠ¡ï¼Œç”¨äº debug&lt;/span&gt;
http.ListenAndServe(&lt;span class=&quot;hljs-string&quot;&gt;&quot;:8081&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;)
}&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&quot;ä¸è¦åˆ›å»ºä¸€ä¸ªä½ æ°¸è¿œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šé€€å‡ºçš„-goroutine&quot;&gt;&lt;a href=&quot;#ä¸è¦åˆ›å»ºä¸€ä¸ªä½ æ°¸è¿œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šé€€å‡ºçš„-goroutine&quot; class=&quot;headerlink&quot; title=&quot;ä¸è¦åˆ›å»ºä¸€ä¸ªä½ æ°¸è¿œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šé€€å‡ºçš„ goroutine&quot;/&gt;ä¸è¦åˆ›å»ºä¸€ä¸ªä½ æ°¸è¿œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šé€€å‡ºçš„ goroutine&lt;/h4&gt;&lt;p&gt;æˆ‘ä»¬å†åšä¸€äº›æ”¹é€ ï¼Œä½¿ç”¨ &lt;code&gt;channel&lt;/code&gt; æ¥æ§åˆ¶ï¼Œè§£é‡Šéƒ½å†™åœ¨ä»£ç æ³¨é‡Šé‡Œé¢äº†&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;hljs-keyword&quot;&gt;import&lt;/span&gt; (
&lt;span class=&quot;hljs-string&quot;&gt;&quot;context&quot;&lt;/span&gt;
&lt;span class=&quot;hljs-string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
&lt;span class=&quot;hljs-string&quot;&gt;&quot;log&quot;&lt;/span&gt;
&lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http&quot;&lt;/span&gt;
_ &lt;span class=&quot;hljs-string&quot;&gt;&quot;net/http/pprof&quot;&lt;/span&gt;
&lt;span class=&quot;hljs-string&quot;&gt;&quot;time&quot;&lt;/span&gt;
)

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œé¢æœ‰ä¸€äº›åˆå§‹åŒ–çš„æ“ä½œ&lt;/span&gt;
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
setup()

&lt;span class=&quot;hljs-comment&quot;&gt;// ç”¨äºç›‘å¬æœåŠ¡é€€å‡º&lt;/span&gt;
done := &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; error, &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;)
&lt;span class=&quot;hljs-comment&quot;&gt;// ç”¨äºæ§åˆ¶æœåŠ¡é€€å‡ºï¼Œä¼ å…¥åŒä¸€ä¸ª stopï¼Œåšåˆ°åªè¦æœ‰ä¸€ä¸ªæœåŠ¡é€€å‡ºäº†é‚£ä¹ˆå¦å¤–ä¸€ä¸ªæœåŠ¡ä¹Ÿä¼šéšä¹‹é€€å‡º&lt;/span&gt;
stop := &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{}, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;)
&lt;span class=&quot;hljs-comment&quot;&gt;// for debug&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
done &amp;lt;- pprof(stop)
}()

&lt;span class=&quot;hljs-comment&quot;&gt;// ä¸»æœåŠ¡&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
done &amp;lt;- app(stop)
}()

&lt;span class=&quot;hljs-comment&quot;&gt;// stoped ç”¨äºåˆ¤æ–­å½“å‰ stop çš„çŠ¶æ€&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; stoped &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;
&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™é‡Œå¾ªç¯è¯»å– done è¿™ä¸ª channel&lt;/span&gt;
&lt;span class=&quot;hljs-comment&quot;&gt;// åªè¦æœ‰ä¸€ä¸ªé€€å‡ºäº†ï¼Œæˆ‘ä»¬å°±å…³é—­ stop channel&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; i := &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;hljs-built_in&quot;&gt;cap&lt;/span&gt;(done); i++ {
&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; err := &amp;lt;-done; err != &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt; {
log.Printf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;server exit err: %+v&quot;&lt;/span&gt;, err)
}

&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; !stoped {
stoped = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;hljs-built_in&quot;&gt;close&lt;/span&gt;(stop)
}
}
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(stop &amp;lt;-&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{})&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {
mux := http.NewServeMux()
mux.HandleFunc(&lt;span class=&quot;hljs-string&quot;&gt;&quot;/ping&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(w http.ResponseWriter, r *http.Request)&lt;/span&gt;&lt;/span&gt; {
w.Write([]&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;pong&quot;&lt;/span&gt;))
})

&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; server(mux, &lt;span class=&quot;hljs-string&quot;&gt;&quot;:8080&quot;&lt;/span&gt;, stop)
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;pprof&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(stop &amp;lt;-&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{})&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-comment&quot;&gt;// æ³¨æ„è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†æ¨¡æ‹ŸæœåŠ¡æ„å¤–é€€å‡ºï¼Œç”¨äºéªŒè¯ä¸€ä¸ªæœåŠ¡é€€å‡ºï¼Œå…¶ä»–æœåŠ¡åŒæ—¶é€€å‡ºçš„åœºæ™¯&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
server(http.DefaultServeMux, &lt;span class=&quot;hljs-string&quot;&gt;&quot;:8081&quot;&lt;/span&gt;, stop)
}()

time.Sleep(&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt; * time.Second)
&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; fmt.Errorf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;mock pprof exit&quot;&lt;/span&gt;)
}

&lt;span class=&quot;hljs-comment&quot;&gt;// å¯åŠ¨ä¸€ä¸ªæœåŠ¡&lt;/span&gt;
&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(handler http.Handler, addr &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;, stop &amp;lt;-&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{})&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;error&lt;/span&gt;&lt;/span&gt; {
s := http.Server{
Handler: handler,
Addr:    addr,
}

&lt;span class=&quot;hljs-comment&quot;&gt;// è¿™ä¸ª goroutine æˆ‘ä»¬å¯ä»¥æ§åˆ¶é€€å‡ºï¼Œå› ä¸ºåªè¦ stop è¿™ä¸ª channel close æˆ–è€…æ˜¯å†™å…¥æ•°æ®ï¼Œè¿™é‡Œå°±ä¼šé€€å‡º&lt;/span&gt;
&lt;span class=&quot;hljs-comment&quot;&gt;// åŒæ—¶å› ä¸ºè°ƒç”¨äº† s.Shutdown è°ƒç”¨ä¹‹åï¼Œhttp è¿™ä¸ªå‡½æ•°å¯åŠ¨çš„ http server ä¹Ÿä¼šä¼˜é›…é€€å‡º&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&amp;lt;-stop
log.Printf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;server will exiting, addr: %s&quot;&lt;/span&gt;, addr)
s.Shutdown(context.Background())
}()

&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; s.ListenAndServe()
}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿”å›ç»“æœï¼Œè¿™ä¸ªä»£ç å¯åŠ¨ 5s ä¹‹åå°±ä¼šé€€å‡ºç¨‹åº&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;â¯ &lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; run ./&lt;span class=&quot;hljs-number&quot;&gt;01&lt;/span&gt;_goroutine/&lt;span class=&quot;hljs-number&quot;&gt;04&lt;/span&gt;
&lt;span class=&quot;hljs-number&quot;&gt;2020&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;49&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;43&lt;/span&gt; server exit err: mock pprof exit
&lt;span class=&quot;hljs-number&quot;&gt;2020&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;49&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;43&lt;/span&gt; server will exiting, addr: :&lt;span class=&quot;hljs-number&quot;&gt;8081&lt;/span&gt;
&lt;span class=&quot;hljs-number&quot;&gt;2020&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;49&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;43&lt;/span&gt; server will exiting, addr: :&lt;span class=&quot;hljs-number&quot;&gt;8080&lt;/span&gt;
&lt;span class=&quot;hljs-number&quot;&gt;2020&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;49&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;43&lt;/span&gt; server exit err: http: Server closed&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&quot;æ€è€ƒé¢˜&quot;&gt;&lt;a href=&quot;#æ€è€ƒé¢˜&quot; class=&quot;headerlink&quot; title=&quot;æ€è€ƒé¢˜&quot;/&gt;æ€è€ƒé¢˜&lt;/h4&gt;&lt;p&gt;è™½ç„¶æˆ‘ä»¬å·²ç»ç»è¿‡äº†ä¸‰è½®ä¼˜åŒ–ï¼Œä½†æ˜¯è¿™é‡Œè¿˜æ˜¯æœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹æ€ä¹ˆåš&lt;/p&gt;&lt;ul&gt;&lt;li&gt;è™½ç„¶æˆ‘ä»¬è°ƒç”¨äº† &lt;code&gt;Shutdown&lt;/code&gt; æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å…¶å®å¹¶æ²¡æœ‰å®ç°ä¼˜é›…é€€å‡ºï¼Œç›¸ä¿¡èªæ˜çš„ä½ å¯ä»¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚å¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡ç¬”è®°ï¼š&lt;a href=&quot;https://lailin.xyz/post/go-training-03.html&quot;&gt;Go é”™è¯¯å¤„ç†æœ€ä½³å®è·µ&lt;/a&gt;&lt;/li&gt;&lt;li&gt;åœ¨ &lt;code&gt;server&lt;/code&gt; æ–¹æ³•ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰å¤„ç† &lt;code&gt;panic&lt;/code&gt; çš„é€»è¾‘ï¼Œè¿™é‡Œéœ€è¦å¤„ç†ä¹ˆï¼Ÿå¦‚æœéœ€è¦é‚£è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;ä¸è¦åˆ›å»ºä¸€ä¸ªæ°¸è¿œéƒ½æ— æ³•é€€å‡ºçš„-goroutine-goroutine-æ³„æ¼&quot;&gt;&lt;a href=&quot;#ä¸è¦åˆ›å»ºä¸€ä¸ªæ°¸è¿œéƒ½æ— æ³•é€€å‡ºçš„-goroutine-goroutine-æ³„æ¼&quot; class=&quot;headerlink&quot; title=&quot;ä¸è¦åˆ›å»ºä¸€ä¸ªæ°¸è¿œéƒ½æ— æ³•é€€å‡ºçš„ goroutine [goroutine æ³„æ¼]&quot;/&gt;ä¸è¦åˆ›å»ºä¸€ä¸ªæ°¸è¿œéƒ½æ— æ³•é€€å‡ºçš„ goroutine [goroutine æ³„æ¼]&lt;/h3&gt;&lt;p&gt;å†æ¥çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼Œè¿™ä¹Ÿæ˜¯å¸¸å¸¸ä¼šç”¨åˆ°çš„æ“ä½œ&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;leak&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(w http.ResponseWriter, r *http.Request)&lt;/span&gt;&lt;/span&gt; {
ch := &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;)
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
fmt.Println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;å¼‚æ­¥ä»»åŠ¡åšä¸€äº›æ“ä½œ&quot;&lt;/span&gt;)
&amp;lt;-ch
}()

w.Write([]&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;will leak&quot;&lt;/span&gt;))
}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¤ç”¨ä¸€ä¸‹ä¸Šé¢çš„ server ä»£ç ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå†™å‡ºè¿™ç§ç±»ä¼¼çš„ä»£ç &lt;/p&gt;&lt;ul&gt;&lt;li&gt;http è¯·æ±‚æ¥äº†ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª goroutine å»åšä¸€äº›è€—æ—¶ä¸€ç‚¹çš„å·¥ä½œ&lt;/li&gt;&lt;li&gt;ç„¶åè¿”å›äº†&lt;/li&gt;&lt;li&gt;ç„¶åä¹‹å‰åˆ›å»ºçš„é‚£ä¸ª &lt;strong&gt;goroutine é˜»å¡&lt;/strong&gt;äº†&lt;/li&gt;&lt;li&gt;ç„¶åå°±æ³„æ¼äº†&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ç»å¤§éƒ¨åˆ†çš„ goroutine æ³„æ¼éƒ½æ˜¯å› ä¸º goroutine å½“ä¸­å› ä¸ºå„ç§åŸå› é˜»å¡äº†ï¼Œæˆ‘ä»¬åœ¨å¤–é¢ä¹Ÿæ²¡æœ‰æ§åˆ¶å®ƒé€€å‡ºçš„æ–¹å¼ï¼Œæ‰€ä»¥å°±æ³„æ¼äº†ï¼Œå…·ä½“å¯¼è‡´é˜»å¡çš„å¸¸è§åŸå› ä¼šåœ¨æ¥ä¸‹æ¥çš„ sync åŒ…ã€channel ä¸­è®²åˆ°ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°äº†&lt;br/&gt;æ¥ä¸‹æ¥æˆ‘ä»¬éªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯çœŸçš„æ³„æ¼äº†&lt;br/&gt;å¯åŠ¨ä¹‹åæˆ‘ä»¬è®¿é—®ä¸€ä¸‹: &lt;a href=&quot;http://localhost:8081/debug/pprof/goroutine?debug=1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://localhost:8081/debug/pprof/goroutine?debug=1&lt;/a&gt; æŸ¥çœ‹å½“å‰çš„ goroutine ä¸ªæ•°ä¸º 7&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;goroutine profile: total &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt; @ &lt;span class=&quot;hljs-number&quot;&gt;0x43b945&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x40814f&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x407d8b&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x770998&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x470381&lt;/span&gt;
#&lt;span class=&quot;hljs-number&quot;&gt;0x770997&lt;/span&gt;main.server.func1+&lt;span class=&quot;hljs-number&quot;&gt;0x37&lt;/span&gt;/home/ll/project/Go&lt;span class=&quot;hljs-number&quot;&gt;-000&lt;/span&gt;/Week03/blog/&lt;span class=&quot;hljs-number&quot;&gt;01&lt;/span&gt;_goroutine/&lt;span class=&quot;hljs-number&quot;&gt;05&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;05.&lt;/span&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;71&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬å†è®¿é—®å‡ æ¬¡ &lt;a href=&quot;http://localhost:8080/leak&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://localhost:8080/leak&lt;/a&gt; å¯ä»¥å‘ç° goroutine å¢åŠ åˆ°äº† 15 ä¸ªï¼Œè€Œä¸”ä¸€ç›´ä¸ä¼šä¸‹é™&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;goroutine profile: total &lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;
&lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt; @ &lt;span class=&quot;hljs-number&quot;&gt;0x43b945&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x40814f&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x407d8b&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x770ad0&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0x470381&lt;/span&gt;
#&lt;span class=&quot;hljs-number&quot;&gt;0x770acf&lt;/span&gt;main.leak.func1+&lt;span class=&quot;hljs-number&quot;&gt;0x8f&lt;/span&gt;/home/ll/project/Go&lt;span class=&quot;hljs-number&quot;&gt;-000&lt;/span&gt;/Week03/blog/&lt;span class=&quot;hljs-number&quot;&gt;01&lt;/span&gt;_goroutine/&lt;span class=&quot;hljs-number&quot;&gt;05&lt;/span&gt;/&lt;span class=&quot;hljs-number&quot;&gt;05.&lt;/span&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;83&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;ç¡®ä¿åˆ›å»ºå‡ºçš„-goroutine-çš„å·¥ä½œå·²ç»å®Œæˆ&quot;&gt;&lt;a href=&quot;#ç¡®ä¿åˆ›å»ºå‡ºçš„-goroutine-çš„å·¥ä½œå·²ç»å®Œæˆ&quot; class=&quot;headerlink&quot; title=&quot;ç¡®ä¿åˆ›å»ºå‡ºçš„ goroutine çš„å·¥ä½œå·²ç»å®Œæˆ&quot;/&gt;ç¡®ä¿åˆ›å»ºå‡ºçš„ goroutine çš„å·¥ä½œå·²ç»å®Œæˆ&lt;/h3&gt;&lt;p&gt;è¿™ä¸ªå…¶å®å°±æ˜¯ä¼˜é›…é€€å‡ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½å¯åŠ¨äº†å¾ˆå¤šçš„ goroutine å»å¤„ç†ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯æœåŠ¡é€€å‡ºçš„æ—¶å€™æˆ‘ä»¬å¹¶æ²¡æœ‰è€ƒè™‘åˆ°å°±ç›´æ¥é€€å‡ºäº†ã€‚ä¾‹å¦‚é€€å‡ºå‰æ—¥å¿—æ²¡æœ‰ flush åˆ°ç£ç›˜ï¼Œæˆ‘ä»¬çš„è¯·æ±‚è¿˜æ²¡å®Œå…¨å…³é—­ï¼Œå¼‚æ­¥ worker ä¸­è¿˜æœ‰ job åœ¨æ‰§è¡Œç­‰ç­‰ã€‚&lt;br/&gt;æˆ‘ä»¬ä¹Ÿæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªåŸ‹ç‚¹æœåŠ¡ï¼Œæ¯æ¬¡è¯·æ±‚æˆ‘ä»¬éƒ½ä¼šä¸ŠæŠ¥ä¸€äº›ä¿¡æ¯åˆ°åŸ‹ç‚¹æœåŠ¡ä¸Š&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Reporter åŸ‹ç‚¹æœåŠ¡ä¸ŠæŠ¥&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; Reporter &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {
}

&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; reporter Reporter

&lt;span class=&quot;hljs-comment&quot;&gt;// æ¨¡æ‹Ÿè€—æ—¶&lt;/span&gt;
&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(r Reporter)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;report&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(data &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; {
time.Sleep(time.Second)
fmt.Printf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;report: %s\n&quot;&lt;/span&gt;, data)
}

mux.HandleFunc(&lt;span class=&quot;hljs-string&quot;&gt;&quot;/ping&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(w http.ResponseWriter, r *http.Request)&lt;/span&gt;&lt;/span&gt; {
    &lt;span class=&quot;hljs-comment&quot;&gt;// åœ¨è¯·æ±‚ä¸­å¼‚æ­¥è°ƒç”¨&lt;/span&gt;
    &lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; reporter.report(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ping pong&quot;&lt;/span&gt;)
    fmt.Println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ping&quot;&lt;/span&gt;)
    w.Write([]&lt;span class=&quot;hljs-keyword&quot;&gt;byte&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;pong&quot;&lt;/span&gt;))
})&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘åœ¨å‘é€äº†ä¸€æ¬¡è¯·æ±‚ä¹‹åç›´æ¥é€€å‡ºäº†ï¼Œå¼‚æ­¥ä¸ŠæŠ¥çš„é€»è¾‘æ ¹æœ¬æ²¡æ‰§è¡Œä¸Š&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;â¯ &lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; run ./&lt;span class=&quot;hljs-number&quot;&gt;01&lt;/span&gt;_goroutine/&lt;span class=&quot;hljs-number&quot;&gt;06&lt;/span&gt;
ping
^Csignal: interrupt&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™ä¸ªæœ‰ä¸¤ç§æ”¹æ³•ï¼Œä¸€ç§æ˜¯ç»™ reporter åŠ ä¸Š shutdown æ–¹æ³•ï¼Œç±»ä¼¼ http çš„ shutdownï¼Œç­‰å¾…æ‰€æœ‰çš„å¼‚æ­¥ä¸ŠæŠ¥å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†é€€å‡ºï¼Œå¦å¤–ä¸€ç§æ˜¯æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ ä¸€äº› worker æ¥æ‰§è¡Œï¼Œåœ¨å½“ç„¶è¿™ä¸ª worker ä¹Ÿè¦å®ç°ç±»ä¼¼ shutdown çš„æ–¹æ³•ã€‚ä¸€èˆ¬æ¨èåä¸€ç§ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é¿å…è¯·æ±‚é‡æ¯”è¾ƒå¤§æ—¶ï¼Œåˆ›å»ºå¤§é‡ goroutineï¼Œå½“ç„¶å¦‚æœè¯·æ±‚é‡æ¯”è¾ƒå°ï¼Œä¸ä¼šå¾ˆå¤§ï¼Œç”¨ç¬¬ä¸€ç§ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚&lt;br/&gt;æˆ‘ä»¬ç»™ä¸€ä¸ªç¬¬äºŒç§çš„ç®€å•å®ç°ï¼Œç¬¬ä¸€ç§å¯ä»¥å‚è€ƒ &lt;a href=&quot;https://www.ardanlabs.com/blog/2019/04/concurrency-trap-2-incomplete-work.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.ardanlabs.com/blog/2019/04/concurrency-trap-2-incomplete-work.html&lt;/a&gt;&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Reporter åŸ‹ç‚¹æœåŠ¡ä¸ŠæŠ¥&lt;/span&gt;
&lt;span class=&quot;hljs-keyword&quot;&gt;type&lt;/span&gt; Reporter &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; {
worker   &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt;
messages &lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;
wg       sync.WaitGroup
closed   &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;
}

&lt;span class=&quot;hljs-comment&quot;&gt;// NewReporter NewReporter&lt;/span&gt;
&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;NewReporter&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(worker, buffer &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt;)&lt;/span&gt; *&lt;span class=&quot;hljs-title&quot;&gt;Reporter&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &amp;amp;Reporter{worker: worker, messages: &lt;span class=&quot;hljs-built_in&quot;&gt;make&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;, buffer)}
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(r *Reporter)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(stop &amp;lt;-&lt;span class=&quot;hljs-keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt;{})&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&amp;lt;-stop
r.shutdown()
}()

&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; i := &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;; i &amp;lt; r.worker; i++ {
r.wg.Add(&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)
&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; msg := &lt;span class=&quot;hljs-keyword&quot;&gt;range&lt;/span&gt; r.messages {
time.Sleep(&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt; * time.Second)
fmt.Printf(&lt;span class=&quot;hljs-string&quot;&gt;&quot;report: %s\n&quot;&lt;/span&gt;, msg)
}
r.wg.Done()
}()
}
r.wg.Wait()
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(r *Reporter)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;shutdown&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
r.closed = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;hljs-comment&quot;&gt;// æ³¨æ„ï¼Œè¿™ä¸ªä¸€å®šè¦åœ¨ä¸»æœåŠ¡ç»“æŸä¹‹åå†æ‰§è¡Œï¼Œé¿å…å…³é—­ channel è¿˜æœ‰å…¶ä»–åœ°æ–¹åœ¨å•Šå†™å…¥&lt;/span&gt;
&lt;span class=&quot;hljs-built_in&quot;&gt;close&lt;/span&gt;(r.messages)
}

&lt;span class=&quot;hljs-comment&quot;&gt;// æ¨¡æ‹Ÿè€—æ—¶&lt;/span&gt;
&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(r *Reporter)&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;report&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(data &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; {
&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; r.closed {
&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;
}
r.messages &amp;lt;- data
}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶ååœ¨ main å‡½æ•°ä¸­æˆ‘ä»¬åŠ ä¸Š&lt;/p&gt;&lt;pre&gt;&lt;code class=&quot;hljs go&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {
    reporter.run(stop)
    done &amp;lt;- &lt;span class=&quot;hljs-literal&quot;&gt;nil&lt;/span&gt;
}()&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;æ€»ç»“&quot;&gt;&lt;a href=&quot;#æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;æ€»ç»“&quot;/&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;æ€»ç»“ä¸€ä¸‹è¿™ä¸€éƒ¨åˆ†è®²åˆ°çš„å‡ ä¸ªè¦ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;strong&gt;è¯·å°†æ˜¯å¦å¼‚æ­¥è°ƒç”¨çš„é€‰æ‹©æƒäº¤ç»™è°ƒç”¨è€…&lt;/strong&gt;ï¼Œä¸ç„¶å¾ˆæœ‰å¯èƒ½å¤§å®¶å¹¶ä¸çŸ¥é“ä½ åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢ä½¿ç”¨äº† goroutine&lt;/li&gt;&lt;li&gt;å¦‚æœä½ è¦å¯åŠ¨ä¸€ä¸ª goroutine è¯·å¯¹å®ƒè´Ÿè´£&lt;ol&gt;&lt;li&gt;&lt;strong&gt;æ°¸è¿œä¸è¦å¯åŠ¨ä¸€ä¸ªä½ æ— æ³•æ§åˆ¶å®ƒé€€å‡ºï¼Œæˆ–è€…ä½ æ— æ³•çŸ¥é“å®ƒä½•æ—¶æ¨å‡ºçš„ goroutine&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;è¿˜æœ‰ä¸Šä¸€ç¯‡æåˆ°çš„ï¼Œå¯åŠ¨ goroutine æ—¶è¯·åŠ ä¸Š panic recovery æœºåˆ¶ï¼Œé¿å…æœåŠ¡ç›´æ¥ä¸å¯ç”¨&lt;/li&gt;&lt;li&gt;é€ æˆ goroutine æ³„æ¼çš„ä¸»è¦åŸå› å°±æ˜¯ goroutine ä¸­é€ æˆäº†é˜»å¡ï¼Œå¹¶ä¸”æ²¡æœ‰å¤–éƒ¨æ‰‹æ®µæ§åˆ¶å®ƒé€€å‡º&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;&lt;strong&gt;å°½é‡é¿å…åœ¨è¯·æ±‚ä¸­ç›´æ¥å¯åŠ¨ goroutine æ¥å¤„ç†é—®é¢˜&lt;/strong&gt;ï¼Œè€Œåº”è¯¥é€šè¿‡å¯åŠ¨ worker æ¥è¿›è¡Œæ¶ˆè´¹ï¼Œè¿™æ ·å¯ä»¥é¿å…ç”±äºè¯·æ±‚é‡è¿‡å¤§ï¼Œè€Œå¯¼è‡´å¤§é‡åˆ›å»º goroutine ä»è€Œå¯¼è‡´ oomï¼Œå½“ç„¶å¦‚æœè¯·æ±‚é‡æœ¬èº«éå¸¸å°ï¼Œé‚£å½“æˆ‘æ²¡è¯´&lt;/li&gt;&lt;/ol&gt;&lt;h2 id=&quot;å‚è€ƒæ–‡çŒ®&quot;&gt;&lt;a href=&quot;#å‚è€ƒæ–‡çŒ®&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒæ–‡çŒ®&quot;/&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;&lt;h2 id=&quot;å…³æ³¨æˆ‘è·å–æ›´æ–°&quot;&gt;&lt;a href=&quot;#å…³æ³¨æˆ‘è·å–æ›´æ–°&quot; class=&quot;headerlink&quot; title=&quot;å…³æ³¨æˆ‘è·å–æ›´æ–°&quot;/&gt;å…³æ³¨æˆ‘è·å–æ›´æ–°&lt;/h2&gt;&lt;p&gt;çœ‹åˆ°è¿™é‡Œäº†è¿˜ä¸å…³æ³¨ç‚¹èµèµ°ä¸€æ³¢&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>602006dd38879802691d59faf5c2ad53</guid>
<title>äº†è§£ä¸€ä¸‹ HTTP1.1 Pipelining æŠ€æœ¯</title>
<link>https://toutiao.io/k/mx1jfnt</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p&gt;Â Â Â Â Â Â Â Â ä¸ºä»€ä¹ˆè°ˆHTTP1.1 Pipeliningå‘¢ï¼Ÿä¸»è¦é—®é¢˜æ ¹æºè¿˜æ˜¯æ¥æºäºBeetlexå‚åŠ äº†techempowerçš„æµ‹è¯•ã€‚å…ˆçœ‹ä¸€ä¸‹ä»¥ä¸‹ä¸¤é¡¹æµ‹è¯•çš„ç»“æœï¼š&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.7232219365895458&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/7WiafGUNVvx46EsO2A9jH2Sjn5QFxYLtIZAsQ4ic2WjKINTia4tTs32BTm9epGj7XR0YItHOeiaEtT7Trse4KNL4Ow/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1167&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.7070446735395189&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/7WiafGUNVvx46EsO2A9jH2Sjn5QFxYLtI6WicPfpibicDCOF27eP7trqMmXYialt3qA1EQz5u2uSyKrhShF8TJyfMyw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1164&quot;/&gt;&lt;/p&gt;&lt;p&gt;ä»¥ä¸Šåˆ†åˆ«æ˜¯.netå¹³å°çš„Jsonå’ŒPlaintextçš„æµ‹è¯•ç»“æœï¼Œå…¶å®Plaintextæœ€é«˜èƒ½è·‘700å¤šä¸‡RPSå·²ç»å®Œå…¨è¶…äº†å¯¹ç½‘ç»œIOè¯»å†™æŸè€—çš„è®¤çŸ¥ï¼Œå³ä½¿10Gçš„å…‰å¡ä¹Ÿä¸å¯èƒ½æ¯ç§’æ‰¿è½½1400ä¸‡çš„IO R/Wã€‚Beetlexåœ¨å…¶ä»–æµ‹è¯•ç»“æœéƒ½éå¸¸ä¸é”™ï¼Œä½†åœ¨æœ€åŸºç¡€çš„Plaintextå¾—åˆ°äº†æœ€å·®çš„ç»“æœï¼ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜æˆ‘çœ‹äº†Næ¬¡aspcoreçš„æ¡†æ¶ä»£ç çœ‹æœ‰æ²¡æœ‰ç»†å°çš„å·®å¼‚å¼•èµ·é—®é¢˜ï¼Œç»“æœç»è¿‡Næ¬¡çš„å°è¯•ä¸€å¹´åè¿˜æ˜¯æ— æ³•è§£å†³ã€‚ã€‚ã€‚&lt;img data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/7WiafGUNVvx46EsO2A9jH2Sjn5QFxYLtIfDPPPxibpxegt3OSDHmoaNAcD74BEjfC9ZWnicAp8NwOF8As7WvwO1uQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;20&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;å‘ç°é—®é¢˜&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;Â Â Â Â Â Â Â Â æœ€è¿‘æˆ‘ç¿»çœ‹äº†techempoweré’ˆå¯¹20è½®çš„æµ‹è¯•è¯´æ˜ï¼Œå…¶ä¸­æœ‰ä¸€æ¡è¯´æ˜¯è¦åºŸå¼ƒPlaintexté¡¹ï¼Œè¯´è¿™ä¸€ä¸ªé¡¹å¹¶ä¸ç¬¦åˆå®é™…åº”ç”¨éœ€æ±‚ã€‚åæ¥çœ‹äº†ä¸€ä¸‹è¯„è®ºçš„ä¸€é¡¹&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;0.16829268292682928&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/7WiafGUNVvx46EsO2A9jH2Sjn5QFxYLtIAEc1LEMKZuwa8xM81ZLmleHd9LUaBw5tLgDmQffTbJUDQULS9ibbh9Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;820&quot;/&gt;&lt;/p&gt;&lt;p&gt;åœ¨è¿™é‡Œæˆ‘æ‰çœ‹åˆ°äº†HTTP/1.1çš„pipeliningæè¿°ã€‚ã€‚ã€‚åæ¥æŸ¥äº†ä¸€ä¸‹èµ„æºæ‰å‘ç°techempowerå¥½åƒåœ¨2015å¹´å•ç‹¬ä¸ºPlaintextæµ‹è¯•é¡¹å¼•å…¥pipeliningæ¨¡å¼ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æ¡†æ¶åœ¨å¸¦å®½ä¸Šçš„ååèƒ½åŠ›ï¼Œè€Œbeetlexåœ¨å®ç°HTTP1.1é‡Œå¹¶æ²¡å»å®ç°å®ƒï¼çœ‹åˆ°è¿™ä¿¡æ¯åå¿ƒé‡Œç¬é—´æ— æ•°çš„è‰å°¼é©¬é£˜è¿‡ã€‚ã€‚ã€‚&lt;img data-ratio=&quot;1&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/7WiafGUNVvx46EsO2A9jH2Sjn5QFxYLtInf5Sz97QPLuWTucB8zvZOwq0icZM4b9V6SrhCYCNvQkIDOGuuBIndzw/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;20&quot;/&gt;ï¼ŒåŸå› è¿™ä¸€å¹´é’ˆå¯¹è¿™ä¸€é—®é¢˜çš„è§£å†³æ–¹æ³•å®Œå…¨æ˜¯å§¿åŠ¿ä¸å¯¹ï¼&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;Pipeliningæ¨¡å¼æœ‰ä»€ä¹ˆå¥½ï¼Ÿ&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Â Â Â Â Â Â Â Â åœ¨è¿™é‡Œå…ˆè¯´ä¸€ä¸‹HTTP/1.1çš„åŸºç¡€é€šè®¯æ¨¡å¼ï¼Œå°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚åç­‰å¾…å“åº”åå†å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼›è¿™æ ·æ¯ä¸ªè¯·æ±‚å“åº”æœ€å°‘å ç”¨ä¸€ä¸ªç½‘ç»œè¯»å’Œç½‘ç»œå†™çš„æ“ä½œã€‚åœ¨pipeliningæ¨¡å¼ä¸‹çš„æ“ä½œåˆ™æ˜¯å¯ä»¥åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œç„¶åç­‰å¾…å¤šè¯·æ±‚åŒæ—¶å“åº”ï¼Œè¿™å°±æ„å‘³ç€å¤šè¯·æ±‚å“åº”å¯ä»¥åˆå¹¶åˆ°ä¸€ä¸ªç½‘ç»œè¯»å†™ä¸Šï¼Œè¿™æ ·çš„æ€§èƒ½æä¾›æ˜¯å·¨å¤§çš„.ç”±äºpipeliningæ¨¡å¼çš„ä½¿ç”¨æ˜¯éå¸¸æœ‰é™ï¼Œåªå…è®¸GETå’ŒHEADè¯·æ±‚ï¼Œæ‰€ä»¥å¾ˆå¤šè¯­è¨€çš„HttpClientç»„ä»¶å¹¶ä¸æ”¯æŒè¿™ç§æ–¹å¼ã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;rich_pages&quot; data-ratio=&quot;1.0133333333333334&quot; data-s=&quot;300,640&quot; data-src=&quot;https://mmbiz.qpic.cn/mmbiz_png/7WiafGUNVvx46EsO2A9jH2Sjn5QFxYLtIzCl73C3Pf4Zlt0qcqgeMnzrWOoibtmvZSxWLdLV3EM3qvllziavznuEQ/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;450&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;ä»ä¸Šå›¾å¯ä»¥äº†è§£åˆ°ï¼Œépipeliningæ¨¡å¼ä¸‹ï¼Œä¸‰ä¸ªè¯·æ±‚æœ€å°‘å ç”¨3æ¬¡IOè¯»å†™ï¼Œè€Œä½¿ç”¨pipeliningååˆ™å¯ä»¥ç¼©å‡æˆ1æ¬¡IOè¯»å†™,è¿™æ ·æœ‰å¤šå°‘æ€§èƒ½æå‡å¯ä»¥æŸ¥çœ‹ã€Š&lt;a target=&quot;_blank&quot; href=&quot;http://mp.weixin.qq.com/s?__biz=MzU5NzcwMjI2Mw==&amp;amp;mid=2247485212&amp;amp;idx=1&amp;amp;sn=d070fcc4d2f713991c9cb58128cf67e0&amp;amp;chksm=fe4e2404c939ad12ae0e8173205dd2e94227272b35989057d9aedaa10b08c0beb0bb560bb6c0&amp;amp;scene=21#wechat_redirect&quot; data-itemshowtype=&quot;0&quot; tab=&quot;innerlink&quot; data-linktype=&quot;2&quot;&gt;è¯„ä¼°æœåŠ¡åŸºç¡€æ€§èƒ½åº”è¯¥å‚è€ƒé‚£äº›æŒ‡æ ‡ï¼Ÿ&lt;/a&gt;ã€‹ã€‚å¯¹http1.1çš„pipeliningäº†è§£ å‘ç°&lt;/span&gt;&lt;span&gt;techempowerçš„Plaintextæµ‹è¯•ä¹‹æ‰€ä»¥æœ‰è¿™ä¹ˆé«˜çš„å“åº”èƒ½åŠ›å¹¶ä¸æ˜¯ä¸ºäº†åæ˜ æœåŠ¡å™¨çš„ç½‘ç»œIOé«˜æ•ˆï¼Œè€Œæ˜¯é€šè¿‡pipeliningæ¨¡å¼å®ç°çš„ä¸€ä¸ªé«˜å¸¦&lt;/span&gt;&lt;span&gt;å®½ååçš„æŠ€å·§æµ‹è¯•ï¼Œç”±äºä¸å…·å¤‡å®ç”¨æ€§æ‰€ä»¥æ‰åœ¨è®¨è®ºä¸­æè®®åºŸå¼ƒå®ƒã€‚&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;Â Â Â Â Â Â Â Â ç”±äºæ²¡æœ‰äº†è§£techempowerçš„ç»†èŠ‚å¯¼è‡´ä¸€ç›´è¸©åœ¨è¿™å‘ä¸Šï¼Œæ•´æ•´æµªè´¹äº†å¤§é‡çš„æ—¶é—´å»æŸ¥çœ‹å®ç°é—®é¢˜ï¼›ç”±äºå§¿åŠ¿ä¸å¯¹æœªèƒ½è§£å†³é—®é¢˜ï¼Œä½†åœ¨è°ƒæ•´è¿‡ç¨‹ä¸­ä¹Ÿå°è¯•å„ç§çº¿ç¨‹é˜Ÿåˆ—è°ƒæ•´å’Œæµ‹è¯•æ”¶è·è¿˜æ˜¯æœ‰çš„ï¼Œæ›´é‡è¦çš„ä¸€ç‚¹æ˜¯BeetleXä¸å†ä¸ºè¿™ä¸€é—®é¢˜è€Œçƒ¦æ¼ã€‚&lt;/p&gt;
                &lt;/div&gt;

                

                



                
                &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
<item>
<guid>54d75d086b23d1b1a1035a4e79e89acf</guid>
<title>[æ¨è] è®°ä¸€æ¬¡ MySQL çš„ insert æ­»é”</title>
<link>https://toutiao.io/k/mbyee1y</link>
<content:encoded>&lt;div&gt;&lt;div&gt;&lt;div class=&quot;post-body&quot; itemprop=&quot;articleBody&quot;&gt;

      
      

      
        &lt;p&gt;å…ˆupdateå†insertçš„å¹¶å‘æ­»é”é—®é¢˜åˆ†æã€‚&lt;/p&gt;



&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;èƒŒæ™¯&lt;/h2&gt;

&lt;p&gt;â€œå¦‚æœåº“é‡Œæœ‰å¯¹åº”è®°å½•ï¼Œå°±æ›´æ–°ï¼Œæ²¡æœ‰å°±æ’å…¥â€&lt;/p&gt;

&lt;p&gt;å¾ˆç®€å•çš„ä¸€ä¸ªé€»è¾‘ï¼Œç›¸ä¿¡å¾ˆå¤šäººéƒ½ä¼šé‡åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;æœ€è¿‘çœ‹ä¸€ä¸ªå·¥ç¨‹é‡Œå®ç°ä»£ç æ˜¯è¿™æ ·çš„ï¼Œmysqlæ•°æ®åº“èµ°çš„æ˜¯é»˜è®¤çš„äº‹åŠ¡çº§åˆ«:å¯é‡å¤è¯»ã€‚åŒ…åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;æ›´æ–°ç»“æœ&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;&quot;æˆåŠŸ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ä¸€æ¡æ–°è®°å½•&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;çœ‹èµ·æ¥ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œçº¿ä¸Šé¢‘é¢‘å‡ºç°insertæ­»é”ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œæ€»ç»“ä¸‹ï¼Œåˆ†äº«ä¸‹å®éªŒSQLï¼Œä¾¿äºæœ‰å…´è¶£ç ”ç©¶çš„åŒå­¦å»å¤ç°ã€‚&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`activity_log`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`id`&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;bigint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`user_id`&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#x27;ç”¨æˆ·id&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`activity_id`&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#x27;æ´»åŠ¨id&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;`time_count`&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;COMMENT&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#x27;æ´»åŠ¨å‚ä¸æ¬¡æ•°&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;UNIQUE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`uniq_uid_activity_id`&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`user_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`activity_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnoDB&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;æ›´æ–°è¯­å¥&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;UPDATE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;activity_log&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time_count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time_count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`user_id`&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;5&#x27;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`activity_id`&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;2020&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;æ’å…¥è¯­å¥&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;activity_log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`user_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`activity_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;5&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;2020&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;å¹¶å‘æ‰§è¡Œç°åœº&quot;&gt;å¹¶å‘æ‰§è¡Œç°åœº&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;https://gitee.com/geqiandebei/picture/raw/master/2020-12-6/1607270021456-QQ20201205-0.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ­»é”æ—¥å¿—åˆ†æ&quot;&gt;æ­»é”æ—¥å¿—åˆ†æ&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;æŸ¥çœ‹æœ€è¿‘çš„æ­»é”æ—¥å¿—mysqlå‘½ä»¤ï¼šshow engine innodb status&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;mi&quot;&gt;2020&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;04&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;35&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f7aeb30c700&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TRANSACTION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TRANSACTION&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25906&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ACTIVE&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;35&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;inserting&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tables&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locked&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;LOCK&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WAIT&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;heap&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;360&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;undo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;entries&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;MySQL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5509&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x7f7b0d6f2700&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;51970&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;localhost&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;activity_log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`user_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`activity_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;4&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;2020&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WAITING&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;THIS&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;LOCK&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;GRANTED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;RECORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOCKS&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;space&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;44&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;page&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bits&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;72&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`uniq_uid_activity_id`&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`test`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`activity_log`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;trx&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25906&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lock_mode&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;intention&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;waiting&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Record&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;heap&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PHYSICAL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RECORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_fields&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compact&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bits&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
 &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;73757072656&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d756d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;asc&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;supremum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TRANSACTION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TRANSACTION&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25907&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ACTIVE&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;inserting&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tables&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locked&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;heap&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;360&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;undo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;entries&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;MySQL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5510&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x7f7aeb30c700&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;51971&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;localhost&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;activity_log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`user_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`activity_id`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;5&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#x27;2020&#x27;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HOLDS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;THE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;LOCK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;RECORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOCKS&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;space&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;44&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;page&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bits&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;72&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`uniq_uid_activity_id`&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`test`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`activity_log`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;trx&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25907&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lock_mode&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Record&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;heap&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PHYSICAL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RECORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_fields&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compact&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bits&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
 &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;73757072656&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d756d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;asc&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;supremum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WAITING&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;THIS&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;LOCK&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;GRANTED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;RECORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOCKS&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;space&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;44&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;page&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bits&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;72&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`uniq_uid_activity_id`&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;`test`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;`activity_log`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;trx&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25907&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lock_mode&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;intention&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;waiting&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Record&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;heap&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PHYSICAL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RECORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_fields&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compact&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bits&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
 &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;73757072656&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d756d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;asc&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;supremum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ROLL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BACK&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TRANSACTION&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;------------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;mysqlæ­»é”æ—¥å¿—ä¸­,ä¸åŒç±»å‹é”å¯¹åº”çš„æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;è®°å½•é”&lt;/strong&gt;(LOCK_REC_NOT_GAP): lock_mode X locks rec but not gap&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;é—´éš™é”&lt;/strong&gt;(LOCK_GAP): lock_mode X locks gap before rec&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Next-key&lt;/strong&gt;é”(LOCK_ORNIDARY): lock_mode X&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ’å…¥æ„å‘é”&lt;/strong&gt;(LOCK_INSERT_INTENTION): lock_mode X locks gap before rec insert intention&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;ä¾‹å¤–æƒ…å†µ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœåœ¨supremum record ä¸ŠåŠ é”ï¼Œlocks gap before rec ä¼šçœç•¥æ‰ï¼Œé—´éš™é”ä¼šæ˜¾ç¤ºæˆ lock_mode Xï¼Œæ’å…¥æ„å‘é”ä¼šæ˜¾ç¤ºæˆ lock_mode X insert intentionã€‚è­¬å¦‚ä¸Šé¢çš„&lt;/p&gt;
&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;RECORD&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;LOCKS&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;space&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;44&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;bits&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;72&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;`uniq_uid_activity_id`&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;`test`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`activity_log`&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;trx&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25907&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;lock_mode&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;X&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Record&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;heap&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PHYSICAL&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;RECORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;n_fields&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;compact&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;bits&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
 &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;73757072656&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;d756d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;asc&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;supremum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;çœ‹èµ·æ¥åƒæ˜¯ Next-key é”,ä½†æ˜¯çœ‹ä¸‹é¢çš„ heap no 1 è¡¨ç¤ºè¿™ä¸ªè®°å½•æ˜¯ supremum recordï¼ˆå¦å¤–.infimum record çš„ heap no ä¸º 0ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªé”åº”è¯¥çœ‹ä½œæ˜¯ä¸€ä¸ªé—´éš™é”ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæ¯ä¸ªæ•°æ®é¡µä¸­æœ‰ä¸¤ä¸ªè™šæ‹Ÿçš„è¡Œè®°å½•ï¼Œç”¨æ¥ç•Œå®šè®°å½•çš„è¾¹ç•Œã€‚Infimum æ˜¯æ¯”è¯¥é¡µä¸­ä»»ä½•ä¸»é”®å€¼éƒ½è¦å°çš„å€¼ã€‚Supremum æŒ‡çš„æ˜¯æ¯”ä»»ä½•å¯èƒ½æ‰“çš„å€¼è¿˜è¦å¤§çš„å€¼ã€‚è¿™ä¸¤ä¸ªå€¼åœ¨é¡µåˆ›å»ºæ—¶è¢«å»ºç«‹ï¼Œå¹¶ä¸”ä»»ä½•æƒ…å†µä¸‹ä¸ä¼šåˆ é™¤ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;æœ€ç»ˆåˆ†æ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸¤ä¸ªäº‹åŠ¡updateä¸å­˜åœ¨çš„è®°å½•ï¼Œå…ˆåè·å¾—äº†é—´éš™é”ï¼ˆgapé”ï¼‰ï¼Œgapé”ä¹‹é—´æ˜¯å…¼å®¹çš„æ‰€ä»¥åœ¨updateç¯èŠ‚ä¸ä¼šé˜»å¡ã€‚&lt;/p&gt;

&lt;p&gt;äºŒè€…éƒ½æŒæœ‰gapé”ï¼Œç„¶åå»ç«äº‰æ’å…¥æ„å‘é”ã€‚å½“å­˜åœ¨å…¶ä»–ä¼šè¯æŒæœ‰gapé”çš„æ—¶å€™ï¼Œå½“å‰ä¼šè¯ç”³è¯·ä¸äº†æ’å…¥æ„å‘é”ï¼Œå¯¼è‡´æ­»é”ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ¨èé˜…è¯»&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.qianshan.tech/mysql/%E8%AE%B0%E4%B8%80%E6%AC%A1mysql%E7%9A%84update%E6%AD%BB%E9%94%81.html&quot;&gt;ã€Šè®°ä¸€æ¬¡mysqlçš„updateæ­»é”ã€‹&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://gitee.com/geqiandebei/picture/raw/master/2020-12-6/1607270117025-QQ20201205-1.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

      
    &lt;/div&gt;

    &lt;/div&gt;&lt;/div&gt;</content:encoded>
</item>
</channel></rss>